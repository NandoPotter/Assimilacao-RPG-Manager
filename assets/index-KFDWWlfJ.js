function v5(a,e){for(var t=0;t<e.length;t++){const n=e[t];if(typeof n!="string"&&!Array.isArray(n)){for(const i in n)if(i!=="default"&&!(i in a)){const s=Object.getOwnPropertyDescriptor(n,i);s&&Object.defineProperty(a,i,s.get?s:{enumerable:!0,get:()=>n[i]})}}}return Object.freeze(Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function xy(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var rG={exports:{}},$A={};var AZ;function G5(){if(AZ)return $A;AZ=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var o=null;if(s!==void 0&&(o=""+s),i.key!==void 0&&(o=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:a,type:n,key:o,ref:i!==void 0?i:null,props:s}}return $A.Fragment=e,$A.jsx=t,$A.jsxs=t,$A}var fZ;function B5(){return fZ||(fZ=1,rG.exports=G5()),rG.exports}var m=B5(),lG={exports:{}},Wn={};var mZ;function S5(){if(mZ)return Wn;mZ=1;var a=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),o=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),A=Symbol.for("react.activity"),f=Symbol.iterator;function p(T){return T===null||typeof T!="object"?null:(T=f&&T[f]||T["@@iterator"],typeof T=="function"?T:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},G=Object.assign,B={};function S(T,$,ae){this.props=T,this.context=$,this.refs=B,this.updater=ae||y}S.prototype.isReactComponent={},S.prototype.setState=function(T,$){if(typeof T!="object"&&typeof T!="function"&&T!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,T,$,"setState")},S.prototype.forceUpdate=function(T){this.updater.enqueueForceUpdate(this,T,"forceUpdate")};function N(){}N.prototype=S.prototype;function R(T,$,ae){this.props=T,this.context=$,this.refs=B,this.updater=ae||y}var w=R.prototype=new N;w.constructor=R,G(w,S.prototype),w.isPureReactComponent=!0;var V=Array.isArray;function H(){}var X={H:null,A:null,T:null,S:null},Y=Object.prototype.hasOwnProperty;function M(T,$,ae){var Ie=ae.ref;return{$$typeof:a,type:T,key:$,ref:Ie!==void 0?Ie:null,props:ae}}function E(T,$){return M(T.type,$,T.props)}function O(T){return typeof T=="object"&&T!==null&&T.$$typeof===a}function P(T){var $={"=":"=0",":":"=2"};return"$"+T.replace(/[=:]/g,function(ae){return $[ae]})}var q=/\/+/g;function k(T,$){return typeof T=="object"&&T!==null&&T.key!=null?P(""+T.key):$.toString(36)}function le(T){switch(T.status){case"fulfilled":return T.value;case"rejected":throw T.reason;default:switch(typeof T.status=="string"?T.then(H,H):(T.status="pending",T.then(function($){T.status==="pending"&&(T.status="fulfilled",T.value=$)},function($){T.status==="pending"&&(T.status="rejected",T.reason=$)})),T.status){case"fulfilled":return T.value;case"rejected":throw T.reason}}throw T}function F(T,$,ae,Ie,be){var D=typeof T;(D==="undefined"||D==="boolean")&&(T=null);var de=!1;if(T===null)de=!0;else switch(D){case"bigint":case"string":case"number":de=!0;break;case"object":switch(T.$$typeof){case a:case e:de=!0;break;case h:return de=T._init,F(de(T._payload),$,ae,Ie,be)}}if(de)return be=be(T),de=Ie===""?"."+k(T,0):Ie,V(be)?(ae="",de!=null&&(ae=de.replace(q,"$&/")+"/"),F(be,$,ae,"",function(we){return we})):be!=null&&(O(be)&&(be=E(be,ae+(be.key==null||T&&T.key===be.key?"":(""+be.key).replace(q,"$&/")+"/")+de)),$.push(be)),1;de=0;var ee=Ie===""?".":Ie+":";if(V(T))for(var Ce=0;Ce<T.length;Ce++)Ie=T[Ce],D=ee+k(Ie,Ce),de+=F(Ie,$,ae,D,be);else if(Ce=p(T),typeof Ce=="function")for(T=Ce.call(T),Ce=0;!(Ie=T.next()).done;)Ie=Ie.value,D=ee+k(Ie,Ce++),de+=F(Ie,$,ae,D,be);else if(D==="object"){if(typeof T.then=="function")return F(le(T),$,ae,Ie,be);throw $=String(T),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(T).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.")}return de}function j(T,$,ae){if(T==null)return T;var Ie=[],be=0;return F(T,Ie,"","",function(D){return $.call(ae,D,be++)}),Ie}function Q(T){if(T._status===-1){var $=T._result;$=$(),$.then(function(ae){(T._status===0||T._status===-1)&&(T._status=1,T._result=ae)},function(ae){(T._status===0||T._status===-1)&&(T._status=2,T._result=ae)}),T._status===-1&&(T._status=0,T._result=$)}if(T._status===1)return T._result.default;throw T._result}var ce=typeof reportError=="function"?reportError:function(T){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var $=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof T=="object"&&T!==null&&typeof T.message=="string"?String(T.message):String(T),error:T});if(!window.dispatchEvent($))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",T);return}console.error(T)},oe={map:j,forEach:function(T,$,ae){j(T,function(){$.apply(this,arguments)},ae)},count:function(T){var $=0;return j(T,function(){$++}),$},toArray:function(T){return j(T,function($){return $})||[]},only:function(T){if(!O(T))throw Error("React.Children.only expected to receive a single React element child.");return T}};return Wn.Activity=A,Wn.Children=oe,Wn.Component=S,Wn.Fragment=t,Wn.Profiler=i,Wn.PureComponent=R,Wn.StrictMode=n,Wn.Suspense=c,Wn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=X,Wn.__COMPILER_RUNTIME={__proto__:null,c:function(T){return X.H.useMemoCache(T)}},Wn.cache=function(T){return function(){return T.apply(null,arguments)}},Wn.cacheSignal=function(){return null},Wn.cloneElement=function(T,$,ae){if(T==null)throw Error("The argument must be a React element, but you passed "+T+".");var Ie=G({},T.props),be=T.key;if($!=null)for(D in $.key!==void 0&&(be=""+$.key),$)!Y.call($,D)||D==="key"||D==="__self"||D==="__source"||D==="ref"&&$.ref===void 0||(Ie[D]=$[D]);var D=arguments.length-2;if(D===1)Ie.children=ae;else if(1<D){for(var de=Array(D),ee=0;ee<D;ee++)de[ee]=arguments[ee+2];Ie.children=de}return M(T.type,be,Ie)},Wn.createContext=function(T){return T={$$typeof:o,_currentValue:T,_currentValue2:T,_threadCount:0,Provider:null,Consumer:null},T.Provider=T,T.Consumer={$$typeof:s,_context:T},T},Wn.createElement=function(T,$,ae){var Ie,be={},D=null;if($!=null)for(Ie in $.key!==void 0&&(D=""+$.key),$)Y.call($,Ie)&&Ie!=="key"&&Ie!=="__self"&&Ie!=="__source"&&(be[Ie]=$[Ie]);var de=arguments.length-2;if(de===1)be.children=ae;else if(1<de){for(var ee=Array(de),Ce=0;Ce<de;Ce++)ee[Ce]=arguments[Ce+2];be.children=ee}if(T&&T.defaultProps)for(Ie in de=T.defaultProps,de)be[Ie]===void 0&&(be[Ie]=de[Ie]);return M(T,D,be)},Wn.createRef=function(){return{current:null}},Wn.forwardRef=function(T){return{$$typeof:l,render:T}},Wn.isValidElement=O,Wn.lazy=function(T){return{$$typeof:h,_payload:{_status:-1,_result:T},_init:Q}},Wn.memo=function(T,$){return{$$typeof:u,type:T,compare:$===void 0?null:$}},Wn.startTransition=function(T){var $=X.T,ae={};X.T=ae;try{var Ie=T(),be=X.S;be!==null&&be(ae,Ie),typeof Ie=="object"&&Ie!==null&&typeof Ie.then=="function"&&Ie.then(H,ce)}catch(D){ce(D)}finally{$!==null&&ae.types!==null&&($.types=ae.types),X.T=$}},Wn.unstable_useCacheRefresh=function(){return X.H.useCacheRefresh()},Wn.use=function(T){return X.H.use(T)},Wn.useActionState=function(T,$,ae){return X.H.useActionState(T,$,ae)},Wn.useCallback=function(T,$){return X.H.useCallback(T,$)},Wn.useContext=function(T){return X.H.useContext(T)},Wn.useDebugValue=function(){},Wn.useDeferredValue=function(T,$){return X.H.useDeferredValue(T,$)},Wn.useEffect=function(T,$){return X.H.useEffect(T,$)},Wn.useEffectEvent=function(T){return X.H.useEffectEvent(T)},Wn.useId=function(){return X.H.useId()},Wn.useImperativeHandle=function(T,$,ae){return X.H.useImperativeHandle(T,$,ae)},Wn.useInsertionEffect=function(T,$){return X.H.useInsertionEffect(T,$)},Wn.useLayoutEffect=function(T,$){return X.H.useLayoutEffect(T,$)},Wn.useMemo=function(T,$){return X.H.useMemo(T,$)},Wn.useOptimistic=function(T,$){return X.H.useOptimistic(T,$)},Wn.useReducer=function(T,$,ae){return X.H.useReducer(T,$,ae)},Wn.useRef=function(T){return X.H.useRef(T)},Wn.useState=function(T){return X.H.useState(T)},Wn.useSyncExternalStore=function(T,$,ae){return X.H.useSyncExternalStore(T,$,ae)},Wn.useTransition=function(){return X.H.useTransition()},Wn.version="19.2.3",Wn}var pZ;function xC(){return pZ||(pZ=1,lG.exports=S5()),lG.exports}var J=xC();const xg=xy(J),x5=v5({__proto__:null,default:xg},[J]);var cG={exports:{}},ef={},gG={exports:{}},uG={};var bZ;function Z5(){return bZ||(bZ=1,(function(a){function e(F,j){var Q=F.length;F.push(j);e:for(;0<Q;){var ce=Q-1>>>1,oe=F[ce];if(0<i(oe,j))F[ce]=j,F[Q]=oe,Q=ce;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var j=F[0],Q=F.pop();if(Q!==j){F[0]=Q;e:for(var ce=0,oe=F.length,T=oe>>>1;ce<T;){var $=2*(ce+1)-1,ae=F[$],Ie=$+1,be=F[Ie];if(0>i(ae,Q))Ie<oe&&0>i(be,ae)?(F[ce]=be,F[Ie]=Q,ce=Ie):(F[ce]=ae,F[$]=Q,ce=$);else if(Ie<oe&&0>i(be,Q))F[ce]=be,F[Ie]=Q,ce=Ie;else break e}}return j}function i(F,j){var Q=F.sortIndex-j.sortIndex;return Q!==0?Q:F.id-j.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();a.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,A=null,f=3,p=!1,y=!1,G=!1,B=!1,S=typeof setTimeout=="function"?setTimeout:null,N=typeof clearTimeout=="function"?clearTimeout:null,R=typeof setImmediate<"u"?setImmediate:null;function w(F){for(var j=t(u);j!==null;){if(j.callback===null)n(u);else if(j.startTime<=F)n(u),j.sortIndex=j.expirationTime,e(c,j);else break;j=t(u)}}function V(F){if(G=!1,w(F),!y)if(t(c)!==null)y=!0,H||(H=!0,P());else{var j=t(u);j!==null&&le(V,j.startTime-F)}}var H=!1,X=-1,Y=5,M=-1;function E(){return B?!0:!(a.unstable_now()-M<Y)}function O(){if(B=!1,H){var F=a.unstable_now();M=F;var j=!0;try{e:{y=!1,G&&(G=!1,N(X),X=-1),p=!0;var Q=f;try{t:{for(w(F),A=t(c);A!==null&&!(A.expirationTime>F&&E());){var ce=A.callback;if(typeof ce=="function"){A.callback=null,f=A.priorityLevel;var oe=ce(A.expirationTime<=F);if(F=a.unstable_now(),typeof oe=="function"){A.callback=oe,w(F),j=!0;break t}A===t(c)&&n(c),w(F)}else n(c);A=t(c)}if(A!==null)j=!0;else{var T=t(u);T!==null&&le(V,T.startTime-F),j=!1}}break e}finally{A=null,f=Q,p=!1}j=void 0}}finally{j?P():H=!1}}}var P;if(typeof R=="function")P=function(){R(O)};else if(typeof MessageChannel<"u"){var q=new MessageChannel,k=q.port2;q.port1.onmessage=O,P=function(){k.postMessage(null)}}else P=function(){S(O,0)};function le(F,j){X=S(function(){F(a.unstable_now())},j)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(F){F.callback=null},a.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Y=0<F?Math.floor(1e3/F):5},a.unstable_getCurrentPriorityLevel=function(){return f},a.unstable_next=function(F){switch(f){case 1:case 2:case 3:var j=3;break;default:j=f}var Q=f;f=j;try{return F()}finally{f=Q}},a.unstable_requestPaint=function(){B=!0},a.unstable_runWithPriority=function(F,j){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Q=f;f=F;try{return j()}finally{f=Q}},a.unstable_scheduleCallback=function(F,j,Q){var ce=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ce+Q:ce):Q=ce,F){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=Q+oe,F={id:h++,callback:j,priorityLevel:F,startTime:Q,expirationTime:oe,sortIndex:-1},Q>ce?(F.sortIndex=Q,e(u,F),t(c)===null&&F===t(u)&&(G?(N(X),X=-1):G=!0,le(V,Q-ce))):(F.sortIndex=oe,e(c,F),y||p||(y=!0,H||(H=!0,P()))),F},a.unstable_shouldYield=E,a.unstable_wrapCallback=function(F){var j=f;return function(){var Q=f;f=j;try{return F.apply(this,arguments)}finally{f=Q}}}})(uG)),uG}var yZ;function w5(){return yZ||(yZ=1,gG.exports=Z5()),gG.exports}var dG={exports:{}},Es={};var vZ;function R5(){if(vZ)return Es;vZ=1;var a=xC();function e(c){var u="https://react.dev/errors/"+c;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var h=2;h<arguments.length;h++)u+="&args[]="+encodeURIComponent(arguments[h])}return"Minified React error #"+c+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(c,u,h){var A=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:A==null?null:""+A,children:c,containerInfo:u,implementation:h}}var o=a.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(c,u){if(c==="font")return"";if(typeof u=="string")return u==="use-credentials"?u:""}return Es.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Es.createPortal=function(c,u){var h=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!u||u.nodeType!==1&&u.nodeType!==9&&u.nodeType!==11)throw Error(e(299));return s(c,u,null,h)},Es.flushSync=function(c){var u=o.T,h=n.p;try{if(o.T=null,n.p=2,c)return c()}finally{o.T=u,n.p=h,n.d.f()}},Es.preconnect=function(c,u){typeof c=="string"&&(u?(u=u.crossOrigin,u=typeof u=="string"?u==="use-credentials"?u:"":void 0):u=null,n.d.C(c,u))},Es.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Es.preinit=function(c,u){if(typeof c=="string"&&u&&typeof u.as=="string"){var h=u.as,A=l(h,u.crossOrigin),f=typeof u.integrity=="string"?u.integrity:void 0,p=typeof u.fetchPriority=="string"?u.fetchPriority:void 0;h==="style"?n.d.S(c,typeof u.precedence=="string"?u.precedence:void 0,{crossOrigin:A,integrity:f,fetchPriority:p}):h==="script"&&n.d.X(c,{crossOrigin:A,integrity:f,fetchPriority:p,nonce:typeof u.nonce=="string"?u.nonce:void 0})}},Es.preinitModule=function(c,u){if(typeof c=="string")if(typeof u=="object"&&u!==null){if(u.as==null||u.as==="script"){var h=l(u.as,u.crossOrigin);n.d.M(c,{crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0})}}else u==null&&n.d.M(c)},Es.preload=function(c,u){if(typeof c=="string"&&typeof u=="object"&&u!==null&&typeof u.as=="string"){var h=u.as,A=l(h,u.crossOrigin);n.d.L(c,h,{crossOrigin:A,integrity:typeof u.integrity=="string"?u.integrity:void 0,nonce:typeof u.nonce=="string"?u.nonce:void 0,type:typeof u.type=="string"?u.type:void 0,fetchPriority:typeof u.fetchPriority=="string"?u.fetchPriority:void 0,referrerPolicy:typeof u.referrerPolicy=="string"?u.referrerPolicy:void 0,imageSrcSet:typeof u.imageSrcSet=="string"?u.imageSrcSet:void 0,imageSizes:typeof u.imageSizes=="string"?u.imageSizes:void 0,media:typeof u.media=="string"?u.media:void 0})}},Es.preloadModule=function(c,u){if(typeof c=="string")if(u){var h=l(u.as,u.crossOrigin);n.d.m(c,{as:typeof u.as=="string"&&u.as!=="script"?u.as:void 0,crossOrigin:h,integrity:typeof u.integrity=="string"?u.integrity:void 0})}else n.d.m(c)},Es.requestFormReset=function(c){n.d.r(c)},Es.unstable_batchedUpdates=function(c,u){return c(u)},Es.useFormState=function(c,u,h){return o.H.useFormState(c,u,h)},Es.useFormStatus=function(){return o.H.useHostTransitionStatus()},Es.version="19.2.3",Es}var GZ;function vN(){if(GZ)return dG.exports;GZ=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),dG.exports=R5(),dG.exports}var BZ;function N5(){if(BZ)return ef;BZ=1;var a=w5(),e=xC(),t=vN();function n(r){var g="https://react.dev/errors/"+r;if(1<arguments.length){g+="?args[]="+encodeURIComponent(arguments[1]);for(var C=2;C<arguments.length;C++)g+="&args[]="+encodeURIComponent(arguments[C])}return"Minified React error #"+r+"; visit "+g+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function s(r){var g=r,C=r;if(r.alternate)for(;g.return;)g=g.return;else{r=g;do g=r,(g.flags&4098)!==0&&(C=g.return),r=g.return;while(r)}return g.tag===3?C:null}function o(r){if(r.tag===13){var g=r.memoizedState;if(g===null&&(r=r.alternate,r!==null&&(g=r.memoizedState)),g!==null)return g.dehydrated}return null}function l(r){if(r.tag===31){var g=r.memoizedState;if(g===null&&(r=r.alternate,r!==null&&(g=r.memoizedState)),g!==null)return g.dehydrated}return null}function c(r){if(s(r)!==r)throw Error(n(188))}function u(r){var g=r.alternate;if(!g){if(g=s(r),g===null)throw Error(n(188));return g!==r?null:r}for(var C=r,b=g;;){var x=C.return;if(x===null)break;var W=x.alternate;if(W===null){if(b=x.return,b!==null){C=b;continue}break}if(x.child===W.child){for(W=x.child;W;){if(W===C)return c(x),r;if(W===b)return c(x),g;W=W.sibling}throw Error(n(188))}if(C.return!==b.return)C=x,b=W;else{for(var L=!1,re=x.child;re;){if(re===C){L=!0,C=x,b=W;break}if(re===b){L=!0,b=x,C=W;break}re=re.sibling}if(!L){for(re=W.child;re;){if(re===C){L=!0,C=W,b=x;break}if(re===b){L=!0,b=W,C=x;break}re=re.sibling}if(!L)throw Error(n(189))}}if(C.alternate!==b)throw Error(n(190))}if(C.tag!==3)throw Error(n(188));return C.stateNode.current===C?r:g}function h(r){var g=r.tag;if(g===5||g===26||g===27||g===6)return r;for(r=r.child;r!==null;){if(g=h(r),g!==null)return g;r=r.sibling}return null}var A=Object.assign,f=Symbol.for("react.element"),p=Symbol.for("react.transitional.element"),y=Symbol.for("react.portal"),G=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),N=Symbol.for("react.consumer"),R=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),V=Symbol.for("react.suspense"),H=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),Y=Symbol.for("react.lazy"),M=Symbol.for("react.activity"),E=Symbol.for("react.memo_cache_sentinel"),O=Symbol.iterator;function P(r){return r===null||typeof r!="object"?null:(r=O&&r[O]||r["@@iterator"],typeof r=="function"?r:null)}var q=Symbol.for("react.client.reference");function k(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===q?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case G:return"Fragment";case S:return"Profiler";case B:return"StrictMode";case V:return"Suspense";case H:return"SuspenseList";case M:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case y:return"Portal";case R:return r.displayName||"Context";case N:return(r._context.displayName||"Context")+".Consumer";case w:var g=r.render;return r=r.displayName,r||(r=g.displayName||g.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case X:return g=r.displayName||null,g!==null?g:k(r.type)||"Memo";case Y:g=r._payload,r=r._init;try{return k(r(g))}catch{}}return null}var le=Array.isArray,F=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,j=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q={pending:!1,data:null,method:null,action:null},ce=[],oe=-1;function T(r){return{current:r}}function $(r){0>oe||(r.current=ce[oe],ce[oe]=null,oe--)}function ae(r,g){oe++,ce[oe]=r.current,r.current=g}var Ie=T(null),be=T(null),D=T(null),de=T(null);function ee(r,g){switch(ae(D,g),ae(be,r),ae(Ie,null),g.nodeType){case 9:case 11:r=(r=g.documentElement)&&(r=r.namespaceURI)?Fx(r):0;break;default:if(r=g.tagName,g=g.namespaceURI)g=Fx(g),r=Kx(g,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}$(Ie),ae(Ie,r)}function Ce(){$(Ie),$(be),$(D)}function we(r){r.memoizedState!==null&&ae(de,r);var g=Ie.current,C=Kx(g,r.type);g!==C&&(ae(be,r),ae(Ie,C))}function Ye(r){be.current===r&&($(Ie),$(be)),de.current===r&&($(de),JA._currentValue=Q)}var Ee,pt;function Ke(r){if(Ee===void 0)try{throw Error()}catch(C){var g=C.stack.trim().match(/\n( *(at )?)/);Ee=g&&g[1]||"",pt=-1<C.stack.indexOf(`
    at`)?" (<anonymous>)":-1<C.stack.indexOf("@")?"@unknown:0:0":""}return`
`+Ee+r+pt}var Qe=!1;function Le(r,g){if(!r||Qe)return"";Qe=!0;var C=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var b={DetermineComponentFrameRoot:function(){try{if(g){var Nt=function(){throw Error()};if(Object.defineProperty(Nt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Nt,[])}catch(ut){var at=ut}Reflect.construct(r,[],Nt)}else{try{Nt.call()}catch(ut){at=ut}r.call(Nt.prototype)}}else{try{throw Error()}catch(ut){at=ut}(Nt=r())&&typeof Nt.catch=="function"&&Nt.catch(function(){})}}catch(ut){if(ut&&at&&typeof ut.stack=="string")return[ut.stack,at.stack]}return[null,null]}};b.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var x=Object.getOwnPropertyDescriptor(b.DetermineComponentFrameRoot,"name");x&&x.configurable&&Object.defineProperty(b.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var W=b.DetermineComponentFrameRoot(),L=W[0],re=W[1];if(L&&re){var Se=L.split(`
`),tt=re.split(`
`);for(x=b=0;b<Se.length&&!Se[b].includes("DetermineComponentFrameRoot");)b++;for(;x<tt.length&&!tt[x].includes("DetermineComponentFrameRoot");)x++;if(b===Se.length||x===tt.length)for(b=Se.length-1,x=tt.length-1;1<=b&&0<=x&&Se[b]!==tt[x];)x--;for(;1<=b&&0<=x;b--,x--)if(Se[b]!==tt[x]){if(b!==1||x!==1)do if(b--,x--,0>x||Se[b]!==tt[x]){var mt=`
`+Se[b].replace(" at new "," at ");return r.displayName&&mt.includes("<anonymous>")&&(mt=mt.replace("<anonymous>",r.displayName)),mt}while(1<=b&&0<=x);break}}}finally{Qe=!1,Error.prepareStackTrace=C}return(C=r?r.displayName||r.name:"")?Ke(C):""}function dt(r,g){switch(r.tag){case 26:case 27:case 5:return Ke(r.type);case 16:return Ke("Lazy");case 13:return r.child!==g&&g!==null?Ke("Suspense Fallback"):Ke("Suspense");case 19:return Ke("SuspenseList");case 0:case 15:return Le(r.type,!1);case 11:return Le(r.type.render,!1);case 1:return Le(r.type,!0);case 31:return Ke("Activity");default:return""}}function se(r){try{var g="",C=null;do g+=dt(r,C),C=r,r=r.return;while(r);return g}catch(b){return`
Error generating stack: `+b.message+`
`+b.stack}}var ht=Object.prototype.hasOwnProperty,it=a.unstable_scheduleCallback,Fe=a.unstable_cancelCallback,st=a.unstable_shouldYield,ie=a.unstable_requestPaint,z=a.unstable_now,Ae=a.unstable_getCurrentPriorityLevel,Oe=a.unstable_ImmediatePriority,He=a.unstable_UserBlockingPriority,Me=a.unstable_NormalPriority,It=a.unstable_LowPriority,ft=a.unstable_IdlePriority,Ht=a.log,kt=a.unstable_setDisableYieldValue,Pe=null,je=null;function ot(r){if(typeof Ht=="function"&&kt(r),je&&typeof je.setStrictMode=="function")try{je.setStrictMode(Pe,r)}catch{}}var he=Math.clz32?Math.clz32:ye,Ve=Math.log,Ct=Math.LN2;function ye(r){return r>>>=0,r===0?32:31-(Ve(r)/Ct|0)|0}var Re=256,lt=262144,Kt=4194304;function gt(r){var g=r&42;if(g!==0)return g;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function qe(r,g,C){var b=r.pendingLanes;if(b===0)return 0;var x=0,W=r.suspendedLanes,L=r.pingedLanes;r=r.warmLanes;var re=b&134217727;return re!==0?(b=re&~W,b!==0?x=gt(b):(L&=re,L!==0?x=gt(L):C||(C=re&~r,C!==0&&(x=gt(C))))):(re=b&~W,re!==0?x=gt(re):L!==0?x=gt(L):C||(C=b&~r,C!==0&&(x=gt(C)))),x===0?0:g!==0&&g!==x&&(g&W)===0&&(W=x&-x,C=g&-g,W>=C||W===32&&(C&4194048)!==0)?g:x}function vt(r,g){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&g)===0}function Ut(r,g){switch(r){case 1:case 2:case 4:case 8:case 64:return g+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return g+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ot(){var r=Kt;return Kt<<=1,(Kt&62914560)===0&&(Kt=4194304),r}function $t(r){for(var g=[],C=0;31>C;C++)g.push(r);return g}function Rn(r,g){r.pendingLanes|=g,g!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Kn(r,g,C,b,x,W){var L=r.pendingLanes;r.pendingLanes=C,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=C,r.entangledLanes&=C,r.errorRecoveryDisabledLanes&=C,r.shellSuspendCounter=0;var re=r.entanglements,Se=r.expirationTimes,tt=r.hiddenUpdates;for(C=L&~C;0<C;){var mt=31-he(C),Nt=1<<mt;re[mt]=0,Se[mt]=-1;var at=tt[mt];if(at!==null)for(tt[mt]=null,mt=0;mt<at.length;mt++){var ut=at[mt];ut!==null&&(ut.lane&=-536870913)}C&=~Nt}b!==0&&Ci(r,b,0),W!==0&&x===0&&r.tag!==0&&(r.suspendedLanes|=W&~(L&~g))}function Ci(r,g,C){r.pendingLanes|=g,r.suspendedLanes&=~g;var b=31-he(g);r.entangledLanes|=g,r.entanglements[b]=r.entanglements[b]|1073741824|C&261930}function Ge(r,g){var C=r.entangledLanes|=g;for(r=r.entanglements;C;){var b=31-he(C),x=1<<b;x&g|r[b]&g&&(r[b]|=g),C&=~x}}function Xe(r,g){var C=g&-g;return C=(C&42)!==0?1:Je(C),(C&(r.suspendedLanes|g))!==0?0:C}function Je(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function Zt(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Mt(){var r=j.p;return r!==0?r:(r=window.event,r===void 0?32:cZ(r.type))}function Gt(r,g){var C=j.p;try{return j.p=r,g()}finally{j.p=C}}var Ft=Math.random().toString(36).slice(2),Vt="__reactFiber$"+Ft,U="__reactProps$"+Ft,te="__reactContainer$"+Ft,pe="__reactEvents$"+Ft,Ne="__reactListeners$"+Ft,De="__reactHandles$"+Ft,ke="__reactResources$"+Ft,wt="__reactMarker$"+Ft;function At(r){delete r[Vt],delete r[U],delete r[pe],delete r[Ne],delete r[De]}function bt(r){var g=r[Vt];if(g)return g;for(var C=r.parentNode;C;){if(g=C[te]||C[Vt]){if(C=g.alternate,g.child!==null||C!==null&&C.child!==null)for(r=Ox(r);r!==null;){if(C=r[Vt])return C;r=Ox(r)}return g}r=C,C=r.parentNode}return null}function ct(r){if(r=r[Vt]||r[te]){var g=r.tag;if(g===5||g===6||g===13||g===31||g===26||g===27||g===3)return r}return null}function _t(r){var g=r.tag;if(g===5||g===26||g===27||g===6)return r.stateNode;throw Error(n(33))}function $e(r){var g=r[ke];return g||(g=r[ke]={hoistableStyles:new Map,hoistableScripts:new Map}),g}function ne(r){r[wt]=!0}var ve=new Set,xe={};function We(r,g){Ze(r,g),Ze(r+"Capture",g)}function Ze(r,g){for(xe[r]=g,r=0;r<g.length;r++)ve.add(g[r])}var St=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Xt={},Yt={};function xt(r){return ht.call(Yt,r)?!0:ht.call(Xt,r)?!1:St.test(r)?Yt[r]=!0:(Xt[r]=!0,!1)}function Wt(r,g,C){if(xt(g))if(C===null)r.removeAttribute(g);else{switch(typeof C){case"undefined":case"function":case"symbol":r.removeAttribute(g);return;case"boolean":var b=g.toLowerCase().slice(0,5);if(b!=="data-"&&b!=="aria-"){r.removeAttribute(g);return}}r.setAttribute(g,""+C)}}function qt(r,g,C){if(C===null)r.removeAttribute(g);else{switch(typeof C){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(g);return}r.setAttribute(g,""+C)}}function Et(r,g,C,b){if(b===null)r.removeAttribute(C);else{switch(typeof b){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(C);return}r.setAttributeNS(g,C,""+b)}}function Tt(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function fn(r){var g=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(g==="checkbox"||g==="radio")}function Tn(r,g,C){var b=Object.getOwnPropertyDescriptor(r.constructor.prototype,g);if(!r.hasOwnProperty(g)&&typeof b<"u"&&typeof b.get=="function"&&typeof b.set=="function"){var x=b.get,W=b.set;return Object.defineProperty(r,g,{configurable:!0,get:function(){return x.call(this)},set:function(L){C=""+L,W.call(this,L)}}),Object.defineProperty(r,g,{enumerable:b.enumerable}),{getValue:function(){return C},setValue:function(L){C=""+L},stopTracking:function(){r._valueTracker=null,delete r[g]}}}}function yn(r){if(!r._valueTracker){var g=fn(r)?"checked":"value";r._valueTracker=Tn(r,g,""+r[g])}}function sn(r){if(!r)return!1;var g=r._valueTracker;if(!g)return!0;var C=g.getValue(),b="";return r&&(b=fn(r)?r.checked?"true":"false":r.value),r=b,r!==C?(g.setValue(r),!0):!1}function Jt(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var rn=/[\n"\\]/g;function jt(r){return r.replace(rn,function(g){return"\\"+g.charCodeAt(0).toString(16)+" "})}function ni(r,g,C,b,x,W,L,re){r.name="",L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"?r.type=L:r.removeAttribute("type"),g!=null?L==="number"?(g===0&&r.value===""||r.value!=g)&&(r.value=""+Tt(g)):r.value!==""+Tt(g)&&(r.value=""+Tt(g)):L!=="submit"&&L!=="reset"||r.removeAttribute("value"),g!=null?zn(r,L,Tt(g)):C!=null?zn(r,L,Tt(C)):b!=null&&r.removeAttribute("value"),x==null&&W!=null&&(r.defaultChecked=!!W),x!=null&&(r.checked=x&&typeof x!="function"&&typeof x!="symbol"),re!=null&&typeof re!="function"&&typeof re!="symbol"&&typeof re!="boolean"?r.name=""+Tt(re):r.removeAttribute("name")}function Ei(r,g,C,b,x,W,L,re){if(W!=null&&typeof W!="function"&&typeof W!="symbol"&&typeof W!="boolean"&&(r.type=W),g!=null||C!=null){if(!(W!=="submit"&&W!=="reset"||g!=null)){yn(r);return}C=C!=null?""+Tt(C):"",g=g!=null?""+Tt(g):C,re||g===r.value||(r.value=g),r.defaultValue=g}b=b??x,b=typeof b!="function"&&typeof b!="symbol"&&!!b,r.checked=re?r.checked:!!b,r.defaultChecked=!!b,L!=null&&typeof L!="function"&&typeof L!="symbol"&&typeof L!="boolean"&&(r.name=L),yn(r)}function zn(r,g,C){g==="number"&&Jt(r.ownerDocument)===r||r.defaultValue===""+C||(r.defaultValue=""+C)}function Xi(r,g,C,b){if(r=r.options,g){g={};for(var x=0;x<C.length;x++)g["$"+C[x]]=!0;for(C=0;C<r.length;C++)x=g.hasOwnProperty("$"+r[C].value),r[C].selected!==x&&(r[C].selected=x),x&&b&&(r[C].defaultSelected=!0)}else{for(C=""+Tt(C),g=null,x=0;x<r.length;x++){if(r[x].value===C){r[x].selected=!0,b&&(r[x].defaultSelected=!0);return}g!==null||r[x].disabled||(g=r[x])}g!==null&&(g.selected=!0)}}function On(r,g,C){if(g!=null&&(g=""+Tt(g),g!==r.value&&(r.value=g),C==null)){r.defaultValue!==g&&(r.defaultValue=g);return}r.defaultValue=C!=null?""+Tt(C):""}function yi(r,g,C,b){if(g==null){if(b!=null){if(C!=null)throw Error(n(92));if(le(b)){if(1<b.length)throw Error(n(93));b=b[0]}C=b}C==null&&(C=""),g=C}C=Tt(g),r.defaultValue=C,b=r.textContent,b===C&&b!==""&&b!==null&&(r.value=b),yn(r)}function Yi(r,g){if(g){var C=r.firstChild;if(C&&C===r.lastChild&&C.nodeType===3){C.nodeValue=g;return}}r.textContent=g}var Fi=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Ki(r,g,C){var b=g.indexOf("--")===0;C==null||typeof C=="boolean"||C===""?b?r.setProperty(g,""):g==="float"?r.cssFloat="":r[g]="":b?r.setProperty(g,C):typeof C!="number"||C===0||Fi.has(g)?g==="float"?r.cssFloat=C:r[g]=(""+C).trim():r[g]=C+"px"}function ko(r,g,C){if(g!=null&&typeof g!="object")throw Error(n(62));if(r=r.style,C!=null){for(var b in C)!C.hasOwnProperty(b)||g!=null&&g.hasOwnProperty(b)||(b.indexOf("--")===0?r.setProperty(b,""):b==="float"?r.cssFloat="":r[b]="");for(var x in g)b=g[x],g.hasOwnProperty(x)&&C[x]!==b&&Ki(r,x,b)}else for(var W in g)g.hasOwnProperty(W)&&Ki(r,W,g[W])}function fa(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Lu=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Mc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function So(r){return Mc.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function Ea(){}var Uo=null;function _c(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var js=null,xo=null;function Xc(r){var g=ct(r);if(g&&(r=g.stateNode)){var C=r[U]||null;e:switch(r=g.stateNode,g.type){case"input":if(ni(r,C.value,C.defaultValue,C.defaultValue,C.checked,C.defaultChecked,C.type,C.name),g=C.name,C.type==="radio"&&g!=null){for(C=r;C.parentNode;)C=C.parentNode;for(C=C.querySelectorAll('input[name="'+jt(""+g)+'"][type="radio"]'),g=0;g<C.length;g++){var b=C[g];if(b!==r&&b.form===r.form){var x=b[U]||null;if(!x)throw Error(n(90));ni(b,x.value,x.defaultValue,x.defaultValue,x.checked,x.defaultChecked,x.type,x.name)}}for(g=0;g<C.length;g++)b=C[g],b.form===r.form&&sn(b)}break e;case"textarea":On(r,C.value,C.defaultValue);break e;case"select":g=C.value,g!=null&&Xi(r,!!C.multiple,g,!1)}}}var Yc=!1;function Yl(r,g,C){if(Yc)return r(g,C);Yc=!0;try{var b=r(g);return b}finally{if(Yc=!1,(js!==null||xo!==null)&&(ge(),js&&(g=js,r=xo,xo=js=null,Xc(g),r)))for(g=0;g<r.length;g++)Xc(r[g])}}function Do(r,g){var C=r.stateNode;if(C===null)return null;var b=C[U]||null;if(b===null)return null;C=b[g];e:switch(g){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(b=!b.disabled)||(r=r.type,b=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!b;break e;default:r=!1}if(r)return null;if(C&&typeof C!="function")throw Error(n(231,g,typeof C));return C}var Js=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Pa=!1;if(Js)try{var Jr={};Object.defineProperty(Jr,"passive",{get:function(){Pa=!0}}),window.addEventListener("test",Jr,Jr),window.removeEventListener("test",Jr,Jr)}catch{Pa=!1}var Oo=null,Hc=null,Zo=null;function Ec(){if(Zo)return Zo;var r,g=Hc,C=g.length,b,x="value"in Oo?Oo.value:Oo.textContent,W=x.length;for(r=0;r<C&&g[r]===x[r];r++);var L=C-r;for(b=1;b<=L&&g[C-b]===x[W-b];b++);return Zo=x.slice(r,1<b?1-b:void 0)}function pr(r){var g=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&g===13&&(r=13)):r=g,r===10&&(r=13),32<=r||r===13?r:0}function jo(){return!0}function Pr(){return!1}function Ri(r){function g(C,b,x,W,L){this._reactName=C,this._targetInst=x,this.type=b,this.nativeEvent=W,this.target=L,this.currentTarget=null;for(var re in r)r.hasOwnProperty(re)&&(C=r[re],this[re]=C?C(W):W[re]);return this.isDefaultPrevented=(W.defaultPrevented!=null?W.defaultPrevented:W.returnValue===!1)?jo:Pr,this.isPropagationStopped=Pr,this}return A(g.prototype,{preventDefault:function(){this.defaultPrevented=!0;var C=this.nativeEvent;C&&(C.preventDefault?C.preventDefault():typeof C.returnValue!="unknown"&&(C.returnValue=!1),this.isDefaultPrevented=jo)},stopPropagation:function(){var C=this.nativeEvent;C&&(C.stopPropagation?C.stopPropagation():typeof C.cancelBubble!="unknown"&&(C.cancelBubble=!0),this.isPropagationStopped=jo)},persist:function(){},isPersistent:jo}),g}var Jo={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qr=Ri(Jo),rs=A({},Jo,{view:0,detail:0}),br=Ri(rs),Fc,Po,yr,ma=A({},rs,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Du,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==yr&&(yr&&r.type==="mousemove"?(Fc=r.screenX-yr.screenX,Po=r.screenY-yr.screenY):Po=Fc=0,yr=r),Fc)},movementY:function(r){return"movementY"in r?r.movementY:Po}}),GI=Ri(ma),ki=A({},ma,{dataTransfer:0}),Kc=Ri(ki),ku=A({},rs,{relatedTarget:0}),Vg=Ri(ku),Fa=A({},Jo,{animationName:0,elapsedTime:0,pseudoElement:0}),xs=Ri(Fa),la=A({},Jo,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),wo=Ri(la),Uu=A({},Jo,{data:0}),_C=Ri(Uu),km={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},XC={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},YC={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Um(r){var g=this.nativeEvent;return g.getModifierState?g.getModifierState(r):(r=YC[r])?!!g[r]:!1}function Du(){return Um}var HC=A({},rs,{key:function(r){if(r.key){var g=km[r.key]||r.key;if(g!=="Unidentified")return g}return r.type==="keypress"?(r=pr(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?XC[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Du,charCode:function(r){return r.type==="keypress"?pr(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?pr(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),EC=Ri(HC),Dm=A({},ma,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),BI=Ri(Dm),Om=A({},rs,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Du}),qr=Ri(Om),FC=A({},Jo,{propertyName:0,elapsedTime:0,pseudoElement:0}),xv=Ri(FC),jm=A({},ma,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),Hl=Ri(jm),$r=A({},Jo,{newState:0,oldState:0}),KC=Ri($r),TC=[9,13,27,32],Tc=Js&&"CompositionEvent"in window,El=null;Js&&"documentMode"in document&&(El=document.documentMode);var zc=Js&&"TextEvent"in window&&!El,Ka=Js&&(!Tc||El&&8<El&&11>=El),Ou=" ",zC=!1;function SI(r,g){switch(r){case"keyup":return TC.indexOf(g.keyCode)!==-1;case"keydown":return g.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Mg(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var Fl=!1;function xI(r,g){switch(r){case"compositionend":return Mg(g);case"keypress":return g.which!==32?null:(zC=!0,Ou);case"textInput":return r=g.data,r===Ou&&zC?null:r;default:return null}}function Jm(r,g){if(Fl)return r==="compositionend"||!Tc&&SI(r,g)?(r=Ec(),Zo=Hc=Oo=null,Fl=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(g.ctrlKey||g.altKey||g.metaKey)||g.ctrlKey&&g.altKey){if(g.char&&1<g.char.length)return g.char;if(g.which)return String.fromCharCode(g.which)}return null;case"compositionend":return Ka&&g.locale!=="ko"?null:g.data;default:return null}}var Ps={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function LC(r){var g=r&&r.nodeName&&r.nodeName.toLowerCase();return g==="input"?!!Ps[r.type]:g==="textarea"}function ZI(r,g,C,b){js?xo?xo.push(b):xo=[b]:js=b,g=Kp(g,"onChange"),0<g.length&&(C=new Qr("onChange","change",null,C,b),r.push({event:C,listeners:g}))}var _g=null,Xg=null;function kC(r){Mx(r,0)}function Yg(r){var g=_t(r);if(sn(g))return r}function UC(r,g){if(r==="change")return g}var ju=!1;if(Js){var Lc;if(Js){var Ni="oninput"in document;if(!Ni){var Pm=document.createElement("div");Pm.setAttribute("oninput","return;"),Ni=typeof Pm.oninput=="function"}Lc=Ni}else Lc=!1;ju=Lc&&(!document.documentMode||9<document.documentMode)}function Qm(){_g&&(_g.detachEvent("onpropertychange",DC),Xg=_g=null)}function DC(r){if(r.propertyName==="value"&&Yg(Xg)){var g=[];ZI(g,Xg,r,_c(r)),Yl(kC,g)}}function Ju(r,g,C){r==="focusin"?(Qm(),_g=g,Xg=C,_g.attachEvent("onpropertychange",DC)):r==="focusout"&&Qm()}function Kl(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Yg(Xg)}function qm(r,g){if(r==="click")return Yg(g)}function $m(r,g){if(r==="input"||r==="change")return Yg(g)}function kc(r,g){return r===g&&(r!==0||1/r===1/g)||r!==r&&g!==g}var Wi=typeof Object.is=="function"?Object.is:kc;function Hg(r,g){if(Wi(r,g))return!0;if(typeof r!="object"||r===null||typeof g!="object"||g===null)return!1;var C=Object.keys(r),b=Object.keys(g);if(C.length!==b.length)return!1;for(b=0;b<C.length;b++){var x=C[b];if(!ht.call(g,x)||!Wi(r[x],g[x]))return!1}return!0}function OC(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function jC(r,g){var C=OC(r);r=0;for(var b;C;){if(C.nodeType===3){if(b=r+C.textContent.length,r<=g&&b>=g)return{node:C,offset:g-r};r=b}e:{for(;C;){if(C.nextSibling){C=C.nextSibling;break e}C=C.parentNode}C=void 0}C=OC(C)}}function wI(r,g){return r&&g?r===g?!0:r&&r.nodeType===3?!1:g&&g.nodeType===3?wI(r,g.parentNode):"contains"in r?r.contains(g):r.compareDocumentPosition?!!(r.compareDocumentPosition(g)&16):!1:!1}function RI(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var g=Jt(r.document);g instanceof r.HTMLIFrameElement;){try{var C=typeof g.contentWindow.location.href=="string"}catch{C=!1}if(C)r=g.contentWindow;else break;g=Jt(r.document)}return g}function Eg(r){var g=r&&r.nodeName&&r.nodeName.toLowerCase();return g&&(g==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||g==="textarea"||r.contentEditable==="true")}var ep=Js&&"documentMode"in document&&11>=document.documentMode,Fg=null,NI=null,Kg=null,Qs=!1;function WI(r,g,C){var b=C.window===C?C.document:C.nodeType===9?C:C.ownerDocument;Qs||Fg==null||Fg!==Jt(b)||(b=Fg,"selectionStart"in b&&Eg(b)?b={start:b.selectionStart,end:b.selectionEnd}:(b=(b.ownerDocument&&b.ownerDocument.defaultView||window).getSelection(),b={anchorNode:b.anchorNode,anchorOffset:b.anchorOffset,focusNode:b.focusNode,focusOffset:b.focusOffset}),Kg&&Hg(Kg,b)||(Kg=b,b=Kp(NI,"onSelect"),0<b.length&&(g=new Qr("onSelect","select",null,g,C),r.push({event:g,listeners:b}),g.target=Fg)))}function Tl(r,g){var C={};return C[r.toLowerCase()]=g.toLowerCase(),C["Webkit"+r]="webkit"+g,C["Moz"+r]="moz"+g,C}var Tg={animationend:Tl("Animation","AnimationEnd"),animationiteration:Tl("Animation","AnimationIteration"),animationstart:Tl("Animation","AnimationStart"),transitionrun:Tl("Transition","TransitionRun"),transitionstart:Tl("Transition","TransitionStart"),transitioncancel:Tl("Transition","TransitionCancel"),transitionend:Tl("Transition","TransitionEnd")},Pu={},ls={};Js&&(ls=document.createElement("div").style,"AnimationEvent"in window||(delete Tg.animationend.animation,delete Tg.animationiteration.animation,delete Tg.animationstart.animation),"TransitionEvent"in window||delete Tg.transitionend.transition);function zl(r){if(Pu[r])return Pu[r];if(!Tg[r])return r;var g=Tg[r],C;for(C in g)if(g.hasOwnProperty(C)&&C in ls)return Pu[r]=g[C];return r}var Zs=zl("animationend"),JC=zl("animationiteration"),vr=zl("animationstart"),zg=zl("transitionrun"),Ll=zl("transitionstart"),PC=zl("transitioncancel"),VI=zl("transitionend"),el=new Map,MI="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");MI.push("scrollEnd");function Qa(r,g){el.set(r,g),We(g,[r])}var kl=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var g=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(g))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},wa=[],Uc=0,_I=0;function Ul(){for(var r=Uc,g=_I=Uc=0;g<r;){var C=wa[g];wa[g++]=null;var b=wa[g];wa[g++]=null;var x=wa[g];wa[g++]=null;var W=wa[g];if(wa[g++]=null,b!==null&&x!==null){var L=b.pending;L===null?x.next=x:(x.next=L.next,L.next=x),b.pending=x}W!==0&&XI(C,x,W)}}function Qu(r,g,C,b){wa[Uc++]=r,wa[Uc++]=g,wa[Uc++]=C,wa[Uc++]=b,_I|=b,r.lanes|=b,r=r.alternate,r!==null&&(r.lanes|=b)}function Lg(r,g,C,b){return Qu(r,g,C,b),kg(r)}function Dl(r,g){return Qu(r,null,null,g),kg(r)}function XI(r,g,C){r.lanes|=C;var b=r.alternate;b!==null&&(b.lanes|=C);for(var x=!1,W=r.return;W!==null;)W.childLanes|=C,b=W.alternate,b!==null&&(b.childLanes|=C),W.tag===22&&(r=W.stateNode,r===null||r._visibility&1||(x=!0)),r=W,W=W.return;return r.tag===3?(W=r.stateNode,x&&g!==null&&(x=31-he(C),r=W.hiddenUpdates,b=r[x],b===null?r[x]=[g]:b.push(g),g.lane=C|536870912),W):null}function kg(r){if(50<lg)throw lg=0,cg=null,Error(n(185));for(var g=r.return;g!==null;)r=g,g=r.return;return r.tag===3?r.stateNode:null}var Ol={};function tp(r,g,C,b){this.tag=r,this.key=C,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=g,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=b,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function cs(r,g,C,b){return new tp(r,g,C,b)}function gs(r){return r=r.prototype,!(!r||!r.isReactComponent)}function Gr(r,g){var C=r.alternate;return C===null?(C=cs(r.tag,g,r.key,r.mode),C.elementType=r.elementType,C.type=r.type,C.stateNode=r.stateNode,C.alternate=r,r.alternate=C):(C.pendingProps=g,C.type=r.type,C.flags=0,C.subtreeFlags=0,C.deletions=null),C.flags=r.flags&65011712,C.childLanes=r.childLanes,C.lanes=r.lanes,C.child=r.child,C.memoizedProps=r.memoizedProps,C.memoizedState=r.memoizedState,C.updateQueue=r.updateQueue,g=r.dependencies,C.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext},C.sibling=r.sibling,C.index=r.index,C.ref=r.ref,C.refCleanup=r.refCleanup,C}function qa(r,g){r.flags&=65011714;var C=r.alternate;return C===null?(r.childLanes=0,r.lanes=g,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=C.childLanes,r.lanes=C.lanes,r.child=C.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=C.memoizedProps,r.memoizedState=C.memoizedState,r.updateQueue=C.updateQueue,r.type=C.type,g=C.dependencies,r.dependencies=g===null?null:{lanes:g.lanes,firstContext:g.firstContext}),r}function qu(r,g,C,b,x,W){var L=0;if(b=r,typeof r=="function")gs(r)&&(L=1);else if(typeof r=="string")L=g5(r,C,Ie.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case M:return r=cs(31,C,g,x),r.elementType=M,r.lanes=W,r;case G:return tl(C.children,x,W,g);case B:L=8,x|=24;break;case S:return r=cs(12,C,g,x|2),r.elementType=S,r.lanes=W,r;case V:return r=cs(13,C,g,x),r.elementType=V,r.lanes=W,r;case H:return r=cs(19,C,g,x),r.elementType=H,r.lanes=W,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case R:L=10;break e;case N:L=9;break e;case w:L=11;break e;case X:L=14;break e;case Y:L=16,b=null;break e}L=29,C=Error(n(130,r===null?"null":typeof r,"")),b=null}return g=cs(L,C,g,x),g.elementType=r,g.type=b,g.lanes=W,g}function tl(r,g,C,b){return r=cs(7,r,b,g),r.lanes=C,r}function YI(r,g,C){return r=cs(6,r,null,g),r.lanes=C,r}function np(r){var g=cs(18,null,null,0);return g.stateNode=r,g}function Qo(r,g,C){return g=cs(4,r.children!==null?r.children:[],r.key,g),g.lanes=C,g.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},g}var QC=new WeakMap;function ws(r,g){if(typeof r=="object"&&r!==null){var C=QC.get(r);return C!==void 0?C:(g={value:r,source:g,stack:se(g)},QC.set(r,g),g)}return{value:r,source:g,stack:se(g)}}var qo=[],Dc=0,$u=null,Ug=0,qs=[],Rs=0,Br=null,Sr=1,xr="";function nl(r,g){qo[Dc++]=Ug,qo[Dc++]=$u,$u=r,Ug=g}function qC(r,g,C){qs[Rs++]=Sr,qs[Rs++]=xr,qs[Rs++]=Br,Br=r;var b=Sr;r=xr;var x=32-he(b)-1;b&=~(1<<x),C+=1;var W=32-he(g)+x;if(30<W){var L=x-x%5;W=(b&(1<<L)-1).toString(32),b>>=L,x-=L,Sr=1<<32-he(g)+x|C<<x|b,xr=W+r}else Sr=1<<W|C<<x|b,xr=r}function HI(r){r.return!==null&&(nl(r,1),qC(r,1,0))}function jl(r){for(;r===$u;)$u=qo[--Dc],qo[Dc]=null,Ug=qo[--Dc],qo[Dc]=null;for(;r===Br;)Br=qs[--Rs],qs[Rs]=null,xr=qs[--Rs],qs[Rs]=null,Sr=qs[--Rs],qs[Rs]=null}function ed(r,g){qs[Rs++]=Sr,qs[Rs++]=xr,qs[Rs++]=Br,Sr=g.id,xr=g.overflow,Br=r}var Ra=null,Gi=null,jn=!1,il=null,Na=!1,EI=Error(n(519));function Un(r){var g=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw td(ws(g,r)),EI}function FI(r){var g=r.stateNode,C=r.type,b=r.memoizedProps;switch(g[Vt]=r,g[U]=b,C){case"dialog":Jn("cancel",g),Jn("close",g);break;case"iframe":case"object":case"embed":Jn("load",g);break;case"video":case"audio":for(C=0;C<kA.length;C++)Jn(kA[C],g);break;case"source":Jn("error",g);break;case"img":case"image":case"link":Jn("error",g),Jn("load",g);break;case"details":Jn("toggle",g);break;case"input":Jn("invalid",g),Ei(g,b.value,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name,!0);break;case"select":Jn("invalid",g);break;case"textarea":Jn("invalid",g),yi(g,b.value,b.defaultValue,b.children)}C=b.children,typeof C!="string"&&typeof C!="number"&&typeof C!="bigint"||g.textContent===""+C||b.suppressHydrationWarning===!0||Hx(g.textContent,C)?(b.popover!=null&&(Jn("beforetoggle",g),Jn("toggle",g)),b.onScroll!=null&&Jn("scroll",g),b.onScrollEnd!=null&&Jn("scrollend",g),b.onClick!=null&&(g.onclick=Ea),g=!0):g=!1,g||Un(r,!0)}function ip(r){for(Ra=r.return;Ra;)switch(Ra.tag){case 5:case 31:case 13:Na=!1;return;case 27:case 3:Na=!0;return;default:Ra=Ra.return}}function Oc(r){if(r!==Ra)return!1;if(!jn)return ip(r),jn=!0,!1;var g=r.tag,C;if((C=g!==3&&g!==27)&&((C=g===5)&&(C=r.type,C=!(C!=="form"&&C!=="button")||Dv(r.type,r.memoizedProps)),C=!C),C&&Gi&&Un(r),ip(r),g===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));Gi=Dx(r)}else if(g===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));Gi=Dx(r)}else g===27?(g=Gi,gu(r.type)?(r=Qv,Qv=null,Gi=r):Gi=g):Gi=Ra?Hr(r.stateNode.nextSibling):null;return!0}function jc(){Gi=Ra=null,jn=!1}function $C(){var r=il;return r!==null&&(as===null?as=r:as.push.apply(as,r),il=null),r}function td(r){il===null?il=[r]:il.push(r)}var eA=T(null),al=null,$a=null;function sl(r,g,C){ae(eA,g._currentValue),g._currentValue=C}function Ro(r){r._currentValue=eA.current,$(eA)}function ol(r,g,C){for(;r!==null;){var b=r.alternate;if((r.childLanes&g)!==g?(r.childLanes|=g,b!==null&&(b.childLanes|=g)):b!==null&&(b.childLanes&g)!==g&&(b.childLanes|=g),r===C)break;r=r.return}}function KI(r,g,C,b){var x=r.child;for(x!==null&&(x.return=r);x!==null;){var W=x.dependencies;if(W!==null){var L=x.child;W=W.firstContext;e:for(;W!==null;){var re=W;W=x;for(var Se=0;Se<g.length;Se++)if(re.context===g[Se]){W.lanes|=C,re=W.alternate,re!==null&&(re.lanes|=C),ol(W.return,C,r),b||(L=null);break e}W=re.next}}else if(x.tag===18){if(L=x.return,L===null)throw Error(n(341));L.lanes|=C,W=L.alternate,W!==null&&(W.lanes|=C),ol(L,C,r),L=null}else L=x.child;if(L!==null)L.return=x;else for(L=x;L!==null;){if(L===r){L=null;break}if(x=L.sibling,x!==null){x.return=L.return,L=x;break}L=L.return}x=L}}function Jl(r,g,C,b){r=null;for(var x=g,W=!1;x!==null;){if(!W){if((x.flags&524288)!==0)W=!0;else if((x.flags&262144)!==0)break}if(x.tag===10){var L=x.alternate;if(L===null)throw Error(n(387));if(L=L.memoizedProps,L!==null){var re=x.type;Wi(x.pendingProps.value,L.value)||(r!==null?r.push(re):r=[re])}}else if(x===de.current){if(L=x.alternate,L===null)throw Error(n(387));L.memoizedState.memoizedState!==x.memoizedState.memoizedState&&(r!==null?r.push(JA):r=[JA])}x=x.return}r!==null&&KI(g,r,C,b),g.flags|=262144}function Dg(r){for(r=r.firstContext;r!==null;){if(!Wi(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function Jc(r){al=r,$a=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function Wa(r){return tA(al,r)}function nd(r,g){return al===null&&Jc(r),tA(r,g)}function tA(r,g){var C=g._currentValue;if(g={context:g,memoizedValue:C,next:null},$a===null){if(r===null)throw Error(n(308));$a=g,r.dependencies={lanes:0,firstContext:g},r.flags|=524288}else $a=$a.next=g;return C}var ap=typeof AbortController<"u"?AbortController:function(){var r=[],g=this.signal={aborted:!1,addEventListener:function(C,b){r.push(b)}};this.abort=function(){g.aborted=!0,r.forEach(function(C){return C()})}},sp=a.unstable_scheduleCallback,nA=a.unstable_NormalPriority,gn={$$typeof:R,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function iA(){return{controller:new ap,data:new Map,refCount:0}}function Ta(r){r.refCount--,r.refCount===0&&sp(nA,function(){r.controller.abort()})}var Pc=null,aA=0,rl=0,$o=null;function Og(r,g){if(Pc===null){var C=Pc=[];aA=0,rl=Hv(),$o={status:"pending",value:void 0,then:function(b){C.push(b)}}}return aA++,g.then(sA,sA),g}function sA(){if(--aA===0&&Pc!==null){$o!==null&&($o.status="fulfilled");var r=Pc;Pc=null,rl=0,$o=null;for(var g=0;g<r.length;g++)(0,r[g])()}}function oA(r,g){var C=[],b={status:"pending",value:null,reason:null,then:function(x){C.push(x)}};return r.then(function(){b.status="fulfilled",b.value=g;for(var x=0;x<C.length;x++)(0,C[x])(g)},function(x){for(b.status="rejected",b.reason=x,x=0;x<C.length;x++)(0,C[x])(void 0)}),b}var op=F.S;F.S=function(r,g){ru=z(),typeof g=="object"&&g!==null&&typeof g.then=="function"&&Og(r,g),op!==null&&op(r,g)};var Pl=T(null);function Zr(){var r=Pl.current;return r!==null?r:ui.pooledCache}function jg(r,g){g===null?ae(Pl,Pl.current):ae(Pl,g.pool)}function TI(){var r=Zr();return r===null?null:{parent:gn._currentValue,pool:r}}var Ql=Error(n(460)),id=Error(n(474)),er=Error(n(542)),ad={then:function(){}};function rp(r){return r=r.status,r==="fulfilled"||r==="rejected"}function rA(r,g,C){switch(C=r[C],C===void 0?r.push(g):C!==g&&(g.then(Ea,Ea),g=C),g.status){case"fulfilled":return g.value;case"rejected":throw r=g.reason,lA(r),r;default:if(typeof g.status=="string")g.then(Ea,Ea);else{if(r=ui,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=g,r.status="pending",r.then(function(b){if(g.status==="pending"){var x=g;x.status="fulfilled",x.value=b}},function(b){if(g.status==="pending"){var x=g;x.status="rejected",x.reason=b}})}switch(g.status){case"fulfilled":return g.value;case"rejected":throw r=g.reason,lA(r),r}throw mn=g,Ql}}function Qc(r){try{var g=r._init;return g(r._payload)}catch(C){throw C!==null&&typeof C=="object"&&typeof C.then=="function"?(mn=C,Ql):C}}var mn=null;function zI(){if(mn===null)throw Error(n(459));var r=mn;return mn=null,r}function lA(r){if(r===Ql||r===er)throw Error(n(483))}var ql=null,$l=0;function LI(r){var g=$l;return $l+=1,ql===null&&(ql=[]),rA(ql,r,g)}function sd(r,g){g=g.props.ref,r.ref=g!==void 0?g:null}function od(r,g){throw g.$$typeof===f?Error(n(525)):(r=Object.prototype.toString.call(g),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(g).join(", ")+"}":r)))}function Jg(r){function g(ze,_e){if(r){var et=ze.deletions;et===null?(ze.deletions=[_e],ze.flags|=16):et.push(_e)}}function C(ze,_e){if(!r)return null;for(;_e!==null;)g(ze,_e),_e=_e.sibling;return null}function b(ze){for(var _e=new Map;ze!==null;)ze.key!==null?_e.set(ze.key,ze):_e.set(ze.index,ze),ze=ze.sibling;return _e}function x(ze,_e){return ze=Gr(ze,_e),ze.index=0,ze.sibling=null,ze}function W(ze,_e,et){return ze.index=et,r?(et=ze.alternate,et!==null?(et=et.index,et<_e?(ze.flags|=67108866,_e):et):(ze.flags|=67108866,_e)):(ze.flags|=1048576,_e)}function L(ze){return r&&ze.alternate===null&&(ze.flags|=67108866),ze}function re(ze,_e,et,Rt){return _e===null||_e.tag!==6?(_e=YI(et,ze.mode,Rt),_e.return=ze,_e):(_e=x(_e,et),_e.return=ze,_e)}function Se(ze,_e,et,Rt){var An=et.type;return An===G?mt(ze,_e,et.props.children,Rt,et.key):_e!==null&&(_e.elementType===An||typeof An=="object"&&An!==null&&An.$$typeof===Y&&Qc(An)===_e.type)?(_e=x(_e,et.props),sd(_e,et),_e.return=ze,_e):(_e=qu(et.type,et.key,et.props,null,ze.mode,Rt),sd(_e,et),_e.return=ze,_e)}function tt(ze,_e,et,Rt){return _e===null||_e.tag!==4||_e.stateNode.containerInfo!==et.containerInfo||_e.stateNode.implementation!==et.implementation?(_e=Qo(et,ze.mode,Rt),_e.return=ze,_e):(_e=x(_e,et.children||[]),_e.return=ze,_e)}function mt(ze,_e,et,Rt,An){return _e===null||_e.tag!==7?(_e=tl(et,ze.mode,Rt,An),_e.return=ze,_e):(_e=x(_e,et),_e.return=ze,_e)}function Nt(ze,_e,et){if(typeof _e=="string"&&_e!==""||typeof _e=="number"||typeof _e=="bigint")return _e=YI(""+_e,ze.mode,et),_e.return=ze,_e;if(typeof _e=="object"&&_e!==null){switch(_e.$$typeof){case p:return et=qu(_e.type,_e.key,_e.props,null,ze.mode,et),sd(et,_e),et.return=ze,et;case y:return _e=Qo(_e,ze.mode,et),_e.return=ze,_e;case Y:return _e=Qc(_e),Nt(ze,_e,et)}if(le(_e)||P(_e))return _e=tl(_e,ze.mode,et,null),_e.return=ze,_e;if(typeof _e.then=="function")return Nt(ze,LI(_e),et);if(_e.$$typeof===R)return Nt(ze,nd(ze,_e),et);od(ze,_e)}return null}function at(ze,_e,et,Rt){var An=_e!==null?_e.key:null;if(typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint")return An!==null?null:re(ze,_e,""+et,Rt);if(typeof et=="object"&&et!==null){switch(et.$$typeof){case p:return et.key===An?Se(ze,_e,et,Rt):null;case y:return et.key===An?tt(ze,_e,et,Rt):null;case Y:return et=Qc(et),at(ze,_e,et,Rt)}if(le(et)||P(et))return An!==null?null:mt(ze,_e,et,Rt,null);if(typeof et.then=="function")return at(ze,_e,LI(et),Rt);if(et.$$typeof===R)return at(ze,_e,nd(ze,et),Rt);od(ze,et)}return null}function ut(ze,_e,et,Rt,An){if(typeof Rt=="string"&&Rt!==""||typeof Rt=="number"||typeof Rt=="bigint")return ze=ze.get(et)||null,re(_e,ze,""+Rt,An);if(typeof Rt=="object"&&Rt!==null){switch(Rt.$$typeof){case p:return ze=ze.get(Rt.key===null?et:Rt.key)||null,Se(_e,ze,Rt,An);case y:return ze=ze.get(Rt.key===null?et:Rt.key)||null,tt(_e,ze,Rt,An);case Y:return Rt=Qc(Rt),ut(ze,_e,et,Rt,An)}if(le(Rt)||P(Rt))return ze=ze.get(et)||null,mt(_e,ze,Rt,An,null);if(typeof Rt.then=="function")return ut(ze,_e,et,LI(Rt),An);if(Rt.$$typeof===R)return ut(ze,_e,et,nd(_e,Rt),An);od(_e,Rt)}return null}function on(ze,_e,et,Rt){for(var An=null,Ii=null,ln=_e,Fn=_e=0,$n=null;ln!==null&&Fn<et.length;Fn++){ln.index>Fn?($n=ln,ln=null):$n=ln.sibling;var hi=at(ze,ln,et[Fn],Rt);if(hi===null){ln===null&&(ln=$n);break}r&&ln&&hi.alternate===null&&g(ze,ln),_e=W(hi,_e,Fn),Ii===null?An=hi:Ii.sibling=hi,Ii=hi,ln=$n}if(Fn===et.length)return C(ze,ln),jn&&nl(ze,Fn),An;if(ln===null){for(;Fn<et.length;Fn++)ln=Nt(ze,et[Fn],Rt),ln!==null&&(_e=W(ln,_e,Fn),Ii===null?An=ln:Ii.sibling=ln,Ii=ln);return jn&&nl(ze,Fn),An}for(ln=b(ln);Fn<et.length;Fn++)$n=ut(ln,ze,Fn,et[Fn],Rt),$n!==null&&(r&&$n.alternate!==null&&ln.delete($n.key===null?Fn:$n.key),_e=W($n,_e,Fn),Ii===null?An=$n:Ii.sibling=$n,Ii=$n);return r&&ln.forEach(function(Cu){return g(ze,Cu)}),jn&&nl(ze,Fn),An}function vn(ze,_e,et,Rt){if(et==null)throw Error(n(151));for(var An=null,Ii=null,ln=_e,Fn=_e=0,$n=null,hi=et.next();ln!==null&&!hi.done;Fn++,hi=et.next()){ln.index>Fn?($n=ln,ln=null):$n=ln.sibling;var Cu=at(ze,ln,hi.value,Rt);if(Cu===null){ln===null&&(ln=$n);break}r&&ln&&Cu.alternate===null&&g(ze,ln),_e=W(Cu,_e,Fn),Ii===null?An=Cu:Ii.sibling=Cu,Ii=Cu,ln=$n}if(hi.done)return C(ze,ln),jn&&nl(ze,Fn),An;if(ln===null){for(;!hi.done;Fn++,hi=et.next())hi=Nt(ze,hi.value,Rt),hi!==null&&(_e=W(hi,_e,Fn),Ii===null?An=hi:Ii.sibling=hi,Ii=hi);return jn&&nl(ze,Fn),An}for(ln=b(ln);!hi.done;Fn++,hi=et.next())hi=ut(ln,ze,Fn,hi.value,Rt),hi!==null&&(r&&hi.alternate!==null&&ln.delete(hi.key===null?Fn:hi.key),_e=W(hi,_e,Fn),Ii===null?An=hi:Ii.sibling=hi,Ii=hi);return r&&ln.forEach(function(y5){return g(ze,y5)}),jn&&nl(ze,Fn),An}function xi(ze,_e,et,Rt){if(typeof et=="object"&&et!==null&&et.type===G&&et.key===null&&(et=et.props.children),typeof et=="object"&&et!==null){switch(et.$$typeof){case p:e:{for(var An=et.key;_e!==null;){if(_e.key===An){if(An=et.type,An===G){if(_e.tag===7){C(ze,_e.sibling),Rt=x(_e,et.props.children),Rt.return=ze,ze=Rt;break e}}else if(_e.elementType===An||typeof An=="object"&&An!==null&&An.$$typeof===Y&&Qc(An)===_e.type){C(ze,_e.sibling),Rt=x(_e,et.props),sd(Rt,et),Rt.return=ze,ze=Rt;break e}C(ze,_e);break}else g(ze,_e);_e=_e.sibling}et.type===G?(Rt=tl(et.props.children,ze.mode,Rt,et.key),Rt.return=ze,ze=Rt):(Rt=qu(et.type,et.key,et.props,null,ze.mode,Rt),sd(Rt,et),Rt.return=ze,ze=Rt)}return L(ze);case y:e:{for(An=et.key;_e!==null;){if(_e.key===An)if(_e.tag===4&&_e.stateNode.containerInfo===et.containerInfo&&_e.stateNode.implementation===et.implementation){C(ze,_e.sibling),Rt=x(_e,et.children||[]),Rt.return=ze,ze=Rt;break e}else{C(ze,_e);break}else g(ze,_e);_e=_e.sibling}Rt=Qo(et,ze.mode,Rt),Rt.return=ze,ze=Rt}return L(ze);case Y:return et=Qc(et),xi(ze,_e,et,Rt)}if(le(et))return on(ze,_e,et,Rt);if(P(et)){if(An=P(et),typeof An!="function")throw Error(n(150));return et=An.call(et),vn(ze,_e,et,Rt)}if(typeof et.then=="function")return xi(ze,_e,LI(et),Rt);if(et.$$typeof===R)return xi(ze,_e,nd(ze,et),Rt);od(ze,et)}return typeof et=="string"&&et!==""||typeof et=="number"||typeof et=="bigint"?(et=""+et,_e!==null&&_e.tag===6?(C(ze,_e.sibling),Rt=x(_e,et),Rt.return=ze,ze=Rt):(C(ze,_e),Rt=YI(et,ze.mode,Rt),Rt.return=ze,ze=Rt),L(ze)):C(ze,_e)}return function(ze,_e,et,Rt){try{$l=0;var An=xi(ze,_e,et,Rt);return ql=null,An}catch(ln){if(ln===Ql||ln===er)throw ln;var Ii=cs(29,ln,null,ze.mode);return Ii.lanes=Rt,Ii.return=ze,Ii}}}var qc=Jg(!0),lp=Jg(!1),ec=!1;function cA(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function gA(r,g){r=r.updateQueue,g.updateQueue===r&&(g.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function wr(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function ll(r,g,C){var b=r.updateQueue;if(b===null)return null;if(b=b.shared,(Qn&2)!==0){var x=b.pending;return x===null?g.next=g:(g.next=x.next,x.next=g),b.pending=g,g=kg(r),XI(r,null,C),g}return Qu(r,b,g,C),kg(r)}function tc(r,g,C){if(g=g.updateQueue,g!==null&&(g=g.shared,(C&4194048)!==0)){var b=g.lanes;b&=r.pendingLanes,C|=b,g.lanes=C,Ge(r,C)}}function kI(r,g){var C=r.updateQueue,b=r.alternate;if(b!==null&&(b=b.updateQueue,C===b)){var x=null,W=null;if(C=C.firstBaseUpdate,C!==null){do{var L={lane:C.lane,tag:C.tag,payload:C.payload,callback:null,next:null};W===null?x=W=L:W=W.next=L,C=C.next}while(C!==null);W===null?x=W=g:W=W.next=g}else x=W=g;C={baseState:b.baseState,firstBaseUpdate:x,lastBaseUpdate:W,shared:b.shared,callbacks:b.callbacks},r.updateQueue=C;return}r=C.lastBaseUpdate,r===null?C.firstBaseUpdate=g:r.next=g,C.lastBaseUpdate=g}var uA=!1;function rd(){if(uA){var r=$o;if(r!==null)throw r}}function $c(r,g,C,b){uA=!1;var x=r.updateQueue;ec=!1;var W=x.firstBaseUpdate,L=x.lastBaseUpdate,re=x.shared.pending;if(re!==null){x.shared.pending=null;var Se=re,tt=Se.next;Se.next=null,L===null?W=tt:L.next=tt,L=Se;var mt=r.alternate;mt!==null&&(mt=mt.updateQueue,re=mt.lastBaseUpdate,re!==L&&(re===null?mt.firstBaseUpdate=tt:re.next=tt,mt.lastBaseUpdate=Se))}if(W!==null){var Nt=x.baseState;L=0,mt=tt=Se=null,re=W;do{var at=re.lane&-536870913,ut=at!==re.lane;if(ut?(Dn&at)===at:(b&at)===at){at!==0&&at===rl&&(uA=!0),mt!==null&&(mt=mt.next={lane:0,tag:re.tag,payload:re.payload,callback:null,next:null});e:{var on=r,vn=re;at=g;var xi=C;switch(vn.tag){case 1:if(on=vn.payload,typeof on=="function"){Nt=on.call(xi,Nt,at);break e}Nt=on;break e;case 3:on.flags=on.flags&-65537|128;case 0:if(on=vn.payload,at=typeof on=="function"?on.call(xi,Nt,at):on,at==null)break e;Nt=A({},Nt,at);break e;case 2:ec=!0}}at=re.callback,at!==null&&(r.flags|=64,ut&&(r.flags|=8192),ut=x.callbacks,ut===null?x.callbacks=[at]:ut.push(at))}else ut={lane:at,tag:re.tag,payload:re.payload,callback:re.callback,next:null},mt===null?(tt=mt=ut,Se=Nt):mt=mt.next=ut,L|=at;if(re=re.next,re===null){if(re=x.shared.pending,re===null)break;ut=re,re=ut.next,ut.next=null,x.lastBaseUpdate=ut,x.shared.pending=null}}while(!0);mt===null&&(Se=Nt),x.baseState=Se,x.firstBaseUpdate=tt,x.lastBaseUpdate=mt,W===null&&(x.shared.lanes=0),co|=L,r.lanes=L,r.memoizedState=Nt}}function Rr(r,g){if(typeof r!="function")throw Error(n(191,r));r.call(g)}function za(r,g){var C=r.callbacks;if(C!==null)for(r.callbacks=null,r=0;r<C.length;r++)Rr(C[r],g)}var $s=T(null),us=T(0);function dA(r,g){r=aa,ae(us,r),ae($s,g),aa=r|g.baseLanes}function IA(){ae(us,aa),ae($s,$s.current)}function es(){aa=us.current,$($s),$(us)}var pa=T(null),No=null;function nc(r){var g=r.alternate;ae(Ui,Ui.current&1),ae(pa,r),No===null&&(g===null||$s.current!==null||g.memoizedState!==null)&&(No=r)}function hA(r){ae(Ui,Ui.current),ae(pa,r),No===null&&(No=r)}function cp(r){r.tag===22?(ae(Ui,Ui.current),ae(pa,r),No===null&&(No=r)):cl()}function cl(){ae(Ui,Ui.current),ae(pa,pa.current)}function eo(r){$(pa),No===r&&(No=null),$(Ui)}var Ui=T(0);function UI(r){for(var g=r;g!==null;){if(g.tag===13){var C=g.memoizedState;if(C!==null&&(C=C.dehydrated,C===null||Jv(C)||Pv(C)))return g}else if(g.tag===19&&(g.memoizedProps.revealOrder==="forwards"||g.memoizedProps.revealOrder==="backwards"||g.memoizedProps.revealOrder==="unstable_legacy-backwards"||g.memoizedProps.revealOrder==="together")){if((g.flags&128)!==0)return g}else if(g.child!==null){g.child.return=g,g=g.child;continue}if(g===r)break;for(;g.sibling===null;){if(g.return===null||g.return===r)return null;g=g.return}g.sibling.return=g.return,g=g.sibling}return null}var Ns=0,Gn=null,mi=null,ca=null,DI=!1,Nr=!1,eg=!1,OI=0,ld=0,Wr=null,Zv=0;function Di(){throw Error(n(321))}function CA(r,g){if(g===null)return!1;for(var C=0;C<g.length&&C<r.length;C++)if(!Wi(r[C],g[C]))return!1;return!0}function AA(r,g,C,b,x,W){return Ns=W,Gn=g,g.memoizedState=null,g.updateQueue=null,g.lanes=0,F.H=r===null||r.memoizedState===null?Rp:qg,eg=!1,W=C(b,x),eg=!1,Nr&&(W=up(g,C,b,x)),gp(r),W}function gp(r){F.H=Id;var g=mi!==null&&mi.next!==null;if(Ns=0,ca=mi=Gn=null,DI=!1,ld=0,Wr=null,g)throw Error(n(300));r===null||Vi||(r=r.dependencies,r!==null&&Dg(r)&&(Vi=!0))}function up(r,g,C,b){Gn=r;var x=0;do{if(Nr&&(Wr=null),ld=0,Nr=!1,25<=x)throw Error(n(301));if(x+=1,ca=mi=null,r.updateQueue!=null){var W=r.updateQueue;W.lastEffect=null,W.events=null,W.stores=null,W.memoCache!=null&&(W.memoCache.index=0)}F.H=hd,W=g(C,b)}while(Nr);return W}function wv(){var r=F.H,g=r.useState()[0];return g=typeof g.then=="function"?gd(g):g,r=r.useState()[0],(mi!==null?mi.memoizedState:null)!==r&&(Gn.flags|=1024),g}function fA(){var r=OI!==0;return OI=0,r}function mA(r,g,C){g.updateQueue=r.updateQueue,g.flags&=-2053,r.lanes&=~C}function pA(r){if(DI){for(r=r.memoizedState;r!==null;){var g=r.queue;g!==null&&(g.pending=null),r=r.next}DI=!1}Ns=0,ca=mi=Gn=null,Nr=!1,ld=OI=0,Wr=null}function ds(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ca===null?Gn.memoizedState=ca=r:ca=ca.next=r,ca}function ea(){if(mi===null){var r=Gn.alternate;r=r!==null?r.memoizedState:null}else r=mi.next;var g=ca===null?Gn.memoizedState:ca.next;if(g!==null)ca=g,mi=r;else{if(r===null)throw Gn.alternate===null?Error(n(467)):Error(n(310));mi=r,r={memoizedState:mi.memoizedState,baseState:mi.baseState,baseQueue:mi.baseQueue,queue:mi.queue,next:null},ca===null?Gn.memoizedState=ca=r:ca=ca.next=r}return ca}function cd(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function gd(r){var g=ld;return ld+=1,Wr===null&&(Wr=[]),r=rA(Wr,r,g),g=Gn,(ca===null?g.memoizedState:ca.next)===null&&(g=g.alternate,F.H=g===null||g.memoizedState===null?Rp:qg),r}function jI(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return gd(r);if(r.$$typeof===R)return Wa(r)}throw Error(n(438,String(r)))}function bA(r){var g=null,C=Gn.updateQueue;if(C!==null&&(g=C.memoCache),g==null){var b=Gn.alternate;b!==null&&(b=b.updateQueue,b!==null&&(b=b.memoCache,b!=null&&(g={data:b.data.map(function(x){return x.slice()}),index:0})))}if(g==null&&(g={data:[],index:0}),C===null&&(C=cd(),Gn.updateQueue=C),C.memoCache=g,C=g.data[g.index],C===void 0)for(C=g.data[g.index]=Array(r),b=0;b<r;b++)C[b]=E;return g.index++,C}function gl(r,g){return typeof g=="function"?g(r):g}function JI(r){var g=ea();return yA(g,mi,r)}function yA(r,g,C){var b=r.queue;if(b===null)throw Error(n(311));b.lastRenderedReducer=C;var x=r.baseQueue,W=b.pending;if(W!==null){if(x!==null){var L=x.next;x.next=W.next,W.next=L}g.baseQueue=x=W,b.pending=null}if(W=r.baseState,x===null)r.memoizedState=W;else{g=x.next;var re=L=null,Se=null,tt=g,mt=!1;do{var Nt=tt.lane&-536870913;if(Nt!==tt.lane?(Dn&Nt)===Nt:(Ns&Nt)===Nt){var at=tt.revertLane;if(at===0)Se!==null&&(Se=Se.next={lane:0,revertLane:0,gesture:null,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null}),Nt===rl&&(mt=!0);else if((Ns&at)===at){tt=tt.next,at===rl&&(mt=!0);continue}else Nt={lane:0,revertLane:tt.revertLane,gesture:null,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null},Se===null?(re=Se=Nt,L=W):Se=Se.next=Nt,Gn.lanes|=at,co|=at;Nt=tt.action,eg&&C(W,Nt),W=tt.hasEagerState?tt.eagerState:C(W,Nt)}else at={lane:Nt,revertLane:tt.revertLane,gesture:tt.gesture,action:tt.action,hasEagerState:tt.hasEagerState,eagerState:tt.eagerState,next:null},Se===null?(re=Se=at,L=W):Se=Se.next=at,Gn.lanes|=Nt,co|=Nt;tt=tt.next}while(tt!==null&&tt!==g);if(Se===null?L=W:Se.next=re,!Wi(W,r.memoizedState)&&(Vi=!0,mt&&(C=$o,C!==null)))throw C;r.memoizedState=W,r.baseState=L,r.baseQueue=Se,b.lastRenderedState=W}return x===null&&(b.lanes=0),[r.memoizedState,b.dispatch]}function PI(r){var g=ea(),C=g.queue;if(C===null)throw Error(n(311));C.lastRenderedReducer=r;var b=C.dispatch,x=C.pending,W=g.memoizedState;if(x!==null){C.pending=null;var L=x=x.next;do W=r(W,L.action),L=L.next;while(L!==x);Wi(W,g.memoizedState)||(Vi=!0),g.memoizedState=W,g.baseQueue===null&&(g.baseState=W),C.lastRenderedState=W}return[W,b]}function vA(r,g,C){var b=Gn,x=ea(),W=jn;if(W){if(C===void 0)throw Error(n(407));C=C()}else C=g();var L=!Wi((mi||x).memoizedState,C);if(L&&(x.memoizedState=C,Vi=!0),x=x.queue,ZA(BA.bind(null,b,x,r),[r]),x.getSnapshot!==g||L||ca!==null&&ca.memoizedState.tag&1){if(b.flags|=2048,Pg(9,{destroy:void 0},GA.bind(null,b,x,C,g),null),ui===null)throw Error(n(349));W||(Ns&127)!==0||dp(b,g,C)}return C}function dp(r,g,C){r.flags|=16384,r={getSnapshot:g,value:C},g=Gn.updateQueue,g===null?(g=cd(),Gn.updateQueue=g,g.stores=[r]):(C=g.stores,C===null?g.stores=[r]:C.push(r))}function GA(r,g,C,b){g.value=C,g.getSnapshot=b,SA(g)&&QI(r)}function BA(r,g,C){return C(function(){SA(g)&&QI(r)})}function SA(r){var g=r.getSnapshot;r=r.value;try{var C=g();return!Wi(r,C)}catch{return!0}}function QI(r){var g=Dl(r,2);g!==null&&I(g,r,2)}function ud(r){var g=ds();if(typeof r=="function"){var C=r;if(r=C(),eg){ot(!0);try{C()}finally{ot(!1)}}}return g.memoizedState=g.baseState=r,g.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:r},g}function Ip(r,g,C,b){return r.baseState=C,yA(r,mi,typeof b=="function"?b:gl)}function Rv(r,g,C,b,x){if(ul(r))throw Error(n(485));if(r=g.action,r!==null){var W={payload:x,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(L){W.listeners.push(L)}};F.T!==null?C(!0):W.isTransition=!1,b(W),C=g.pending,C===null?(W.next=g.pending=W,hp(g,W)):(W.next=C.next,g.pending=C.next=W)}}function hp(r,g){var C=g.action,b=g.payload,x=r.state;if(g.isTransition){var W=F.T,L={};F.T=L;try{var re=C(x,b),Se=F.S;Se!==null&&Se(L,re),Cp(r,g,re)}catch(tt){qI(r,g,tt)}finally{W!==null&&L.types!==null&&(W.types=L.types),F.T=W}}else try{W=C(x,b),Cp(r,g,W)}catch(tt){qI(r,g,tt)}}function Cp(r,g,C){C!==null&&typeof C=="object"&&typeof C.then=="function"?C.then(function(b){xA(r,g,b)},function(b){return qI(r,g,b)}):xA(r,g,C)}function xA(r,g,C){g.status="fulfilled",g.value=C,Ap(g),r.state=C,g=r.pending,g!==null&&(C=g.next,C===g?r.pending=null:(C=C.next,g.next=C,hp(r,C)))}function qI(r,g,C){var b=r.pending;if(r.pending=null,b!==null){b=b.next;do g.status="rejected",g.reason=C,Ap(g),g=g.next;while(g!==b)}r.action=null}function Ap(r){r=r.listeners;for(var g=0;g<r.length;g++)(0,r[g])()}function fp(r,g){return g}function mp(r,g){if(jn){var C=ui.formState;if(C!==null){e:{var b=Gn;if(jn){if(Gi){t:{for(var x=Gi,W=Na;x.nodeType!==8;){if(!W){x=null;break t}if(x=Hr(x.nextSibling),x===null){x=null;break t}}W=x.data,x=W==="F!"||W==="F"?x:null}if(x){Gi=Hr(x.nextSibling),b=x.data==="F!";break e}}Un(b)}b=!1}b&&(g=C[0])}}return C=ds(),C.memoizedState=C.baseState=g,b={pending:null,lanes:0,dispatch:null,lastRenderedReducer:fp,lastRenderedState:g},C.queue=b,C=wp.bind(null,Gn,b),b.dispatch=C,b=ud(!1),W=dd.bind(null,Gn,!1,b.queue),b=ds(),x={state:g,dispatch:null,action:r,pending:null},b.queue=x,C=Rv.bind(null,Gn,x,W,C),x.dispatch=C,b.memoizedState=r,[g,C,!1]}function pp(r){var g=ea();return bp(g,mi,r)}function bp(r,g,C){if(g=yA(r,g,fp)[0],r=JI(gl)[0],typeof g=="object"&&g!==null&&typeof g.then=="function")try{var b=gd(g)}catch(L){throw L===Ql?er:L}else b=g;g=ea();var x=g.queue,W=x.dispatch;return C!==g.memoizedState&&(Gn.flags|=2048,Pg(9,{destroy:void 0},Nv.bind(null,x,C),null)),[b,W,r]}function Nv(r,g){r.action=g}function yp(r){var g=ea(),C=mi;if(C!==null)return bp(g,C,r);ea(),g=g.memoizedState,C=ea();var b=C.queue.dispatch;return C.memoizedState=r,[g,b,!1]}function Pg(r,g,C,b){return r={tag:r,create:C,deps:b,inst:g,next:null},g=Gn.updateQueue,g===null&&(g=cd(),Gn.updateQueue=g),C=g.lastEffect,C===null?g.lastEffect=r.next=r:(b=C.next,C.next=r,r.next=b,g.lastEffect=r),r}function vp(){return ea().memoizedState}function $I(r,g,C,b){var x=ds();Gn.flags|=r,x.memoizedState=Pg(1|g,{destroy:void 0},C,b===void 0?null:b)}function eh(r,g,C,b){var x=ea();b=b===void 0?null:b;var W=x.memoizedState.inst;mi!==null&&b!==null&&CA(b,mi.memoizedState.deps)?x.memoizedState=Pg(g,W,C,b):(Gn.flags|=r,x.memoizedState=Pg(1|g,W,C,b))}function Gp(r,g){$I(8390656,8,r,g)}function ZA(r,g){eh(2048,8,r,g)}function Bp(r){Gn.flags|=4;var g=Gn.updateQueue;if(g===null)g=cd(),Gn.updateQueue=g,g.events=[r];else{var C=g.events;C===null?g.events=[r]:C.push(r)}}function Sp(r){var g=ea().memoizedState;return Bp({ref:g,nextImpl:r}),function(){if((Qn&2)!==0)throw Error(n(440));return g.impl.apply(void 0,arguments)}}function xp(r,g){return eh(4,2,r,g)}function to(r,g){return eh(4,4,r,g)}function wA(r,g){if(typeof g=="function"){r=r();var C=g(r);return function(){typeof C=="function"?C():g(null)}}if(g!=null)return r=r(),g.current=r,function(){g.current=null}}function th(r,g,C){C=C!=null?C.concat([r]):null,eh(4,4,wA.bind(null,g,r),C)}function nh(){}function RA(r,g){var C=ea();g=g===void 0?null:g;var b=C.memoizedState;return g!==null&&CA(g,b[1])?b[0]:(C.memoizedState=[r,g],r)}function NA(r,g){var C=ea();g=g===void 0?null:g;var b=C.memoizedState;if(g!==null&&CA(g,b[1]))return b[0];if(b=r(),eg){ot(!0);try{r()}finally{ot(!1)}}return C.memoizedState=[b,g],b}function WA(r,g,C){return C===void 0||(Ns&1073741824)!==0&&(Dn&261930)===0?r.memoizedState=g:(r.memoizedState=C,r=d(),Gn.lanes|=r,co|=r,C)}function VA(r,g,C,b){return Wi(C,g)?C:$s.current!==null?(r=WA(r,C,b),Wi(r,g)||(Vi=!0),r):(Ns&42)===0||(Ns&1073741824)!==0&&(Dn&261930)===0?(Vi=!0,r.memoizedState=C):(r=d(),Gn.lanes|=r,co|=r,g)}function MA(r,g,C,b,x){var W=j.p;j.p=W!==0&&8>W?W:8;var L=F.T,re={};F.T=re,dd(r,!1,g,C);try{var Se=x(),tt=F.S;if(tt!==null&&tt(re,Se),Se!==null&&typeof Se=="object"&&typeof Se.then=="function"){var mt=oA(Se,b);Qg(r,g,mt,hs(r))}else Qg(r,g,b,hs(r))}catch(Nt){Qg(r,g,{then:function(){},status:"rejected",reason:Nt},hs())}finally{j.p=W,L!==null&&re.types!==null&&(L.types=re.types),F.T=L}}function Wv(){}function _A(r,g,C,b){if(r.tag!==5)throw Error(n(476));var x=Zp(r).queue;MA(r,x,g,Q,C===null?Wv:function(){return XA(r),C(b)})}function Zp(r){var g=r.memoizedState;if(g!==null)return g;g={memoizedState:Q,baseState:Q,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:Q},next:null};var C={};return g.next={memoizedState:C,baseState:C,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:gl,lastRenderedState:C},next:null},r.memoizedState=g,r=r.alternate,r!==null&&(r.memoizedState=g),g}function XA(r){var g=Zp(r);g.next===null&&(g=r.alternate.memoizedState),Qg(r,g.next.queue,{},hs())}function YA(){return Wa(JA)}function La(){return ea().memoizedState}function HA(){return ea().memoizedState}function Vv(r){for(var g=r.return;g!==null;){switch(g.tag){case 24:case 3:var C=hs();r=wr(C);var b=ll(g,r,C);b!==null&&(I(b,g,C),tc(b,g,C)),g={cache:iA()},r.payload=g;return}g=g.return}}function Mv(r,g,C){var b=hs();C={lane:b,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null},ul(r)?tg(g,C):(C=Lg(r,g,C,b),C!==null&&(I(C,r,b),Ws(C,g,b)))}function wp(r,g,C){var b=hs();Qg(r,g,C,b)}function Qg(r,g,C,b){var x={lane:b,revertLane:0,gesture:null,action:C,hasEagerState:!1,eagerState:null,next:null};if(ul(r))tg(g,x);else{var W=r.alternate;if(r.lanes===0&&(W===null||W.lanes===0)&&(W=g.lastRenderedReducer,W!==null))try{var L=g.lastRenderedState,re=W(L,C);if(x.hasEagerState=!0,x.eagerState=re,Wi(re,L))return Qu(r,g,x,0),ui===null&&Ul(),!1}catch{}if(C=Lg(r,g,x,b),C!==null)return I(C,r,b),Ws(C,g,b),!0}return!1}function dd(r,g,C,b){if(b={lane:2,revertLane:Hv(),gesture:null,action:b,hasEagerState:!1,eagerState:null,next:null},ul(r)){if(g)throw Error(n(479))}else g=Lg(r,C,b,2),g!==null&&I(g,r,2)}function ul(r){var g=r.alternate;return r===Gn||g!==null&&g===Gn}function tg(r,g){Nr=DI=!0;var C=r.pending;C===null?g.next=g:(g.next=C.next,C.next=g),r.pending=g}function Ws(r,g,C){if((C&4194048)!==0){var b=g.lanes;b&=r.pendingLanes,C|=b,g.lanes=C,Ge(r,C)}}var Id={readContext:Wa,use:jI,useCallback:Di,useContext:Di,useEffect:Di,useImperativeHandle:Di,useLayoutEffect:Di,useInsertionEffect:Di,useMemo:Di,useReducer:Di,useRef:Di,useState:Di,useDebugValue:Di,useDeferredValue:Di,useTransition:Di,useSyncExternalStore:Di,useId:Di,useHostTransitionStatus:Di,useFormState:Di,useActionState:Di,useOptimistic:Di,useMemoCache:Di,useCacheRefresh:Di};Id.useEffectEvent=Di;var Rp={readContext:Wa,use:jI,useCallback:function(r,g){return ds().memoizedState=[r,g===void 0?null:g],r},useContext:Wa,useEffect:Gp,useImperativeHandle:function(r,g,C){C=C!=null?C.concat([r]):null,$I(4194308,4,wA.bind(null,g,r),C)},useLayoutEffect:function(r,g){return $I(4194308,4,r,g)},useInsertionEffect:function(r,g){$I(4,2,r,g)},useMemo:function(r,g){var C=ds();g=g===void 0?null:g;var b=r();if(eg){ot(!0);try{r()}finally{ot(!1)}}return C.memoizedState=[b,g],b},useReducer:function(r,g,C){var b=ds();if(C!==void 0){var x=C(g);if(eg){ot(!0);try{C(g)}finally{ot(!1)}}}else x=g;return b.memoizedState=b.baseState=x,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:x},b.queue=r,r=r.dispatch=Mv.bind(null,Gn,r),[b.memoizedState,r]},useRef:function(r){var g=ds();return r={current:r},g.memoizedState=r},useState:function(r){r=ud(r);var g=r.queue,C=wp.bind(null,Gn,g);return g.dispatch=C,[r.memoizedState,C]},useDebugValue:nh,useDeferredValue:function(r,g){var C=ds();return WA(C,r,g)},useTransition:function(){var r=ud(!1);return r=MA.bind(null,Gn,r.queue,!0,!1),ds().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,g,C){var b=Gn,x=ds();if(jn){if(C===void 0)throw Error(n(407));C=C()}else{if(C=g(),ui===null)throw Error(n(349));(Dn&127)!==0||dp(b,g,C)}x.memoizedState=C;var W={value:C,getSnapshot:g};return x.queue=W,Gp(BA.bind(null,b,W,r),[r]),b.flags|=2048,Pg(9,{destroy:void 0},GA.bind(null,b,W,C,g),null),C},useId:function(){var r=ds(),g=ui.identifierPrefix;if(jn){var C=xr,b=Sr;C=(b&~(1<<32-he(b)-1)).toString(32)+C,g="_"+g+"R_"+C,C=OI++,0<C&&(g+="H"+C.toString(32)),g+="_"}else C=Zv++,g="_"+g+"r_"+C.toString(32)+"_";return r.memoizedState=g},useHostTransitionStatus:YA,useFormState:mp,useActionState:mp,useOptimistic:function(r){var g=ds();g.memoizedState=g.baseState=r;var C={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return g.queue=C,g=dd.bind(null,Gn,!0,C),C.dispatch=g,[r,g]},useMemoCache:bA,useCacheRefresh:function(){return ds().memoizedState=Vv.bind(null,Gn)},useEffectEvent:function(r){var g=ds(),C={impl:r};return g.memoizedState=C,function(){if((Qn&2)!==0)throw Error(n(440));return C.impl.apply(void 0,arguments)}}},qg={readContext:Wa,use:jI,useCallback:RA,useContext:Wa,useEffect:ZA,useImperativeHandle:th,useInsertionEffect:xp,useLayoutEffect:to,useMemo:NA,useReducer:JI,useRef:vp,useState:function(){return JI(gl)},useDebugValue:nh,useDeferredValue:function(r,g){var C=ea();return VA(C,mi.memoizedState,r,g)},useTransition:function(){var r=JI(gl)[0],g=ea().memoizedState;return[typeof r=="boolean"?r:gd(r),g]},useSyncExternalStore:vA,useId:La,useHostTransitionStatus:YA,useFormState:pp,useActionState:pp,useOptimistic:function(r,g){var C=ea();return Ip(C,mi,r,g)},useMemoCache:bA,useCacheRefresh:HA};qg.useEffectEvent=Sp;var hd={readContext:Wa,use:jI,useCallback:RA,useContext:Wa,useEffect:ZA,useImperativeHandle:th,useInsertionEffect:xp,useLayoutEffect:to,useMemo:NA,useReducer:PI,useRef:vp,useState:function(){return PI(gl)},useDebugValue:nh,useDeferredValue:function(r,g){var C=ea();return mi===null?WA(C,r,g):VA(C,mi.memoizedState,r,g)},useTransition:function(){var r=PI(gl)[0],g=ea().memoizedState;return[typeof r=="boolean"?r:gd(r),g]},useSyncExternalStore:vA,useId:La,useHostTransitionStatus:YA,useFormState:yp,useActionState:yp,useOptimistic:function(r,g){var C=ea();return mi!==null?Ip(C,mi,r,g):(C.baseState=r,[r,C.queue.dispatch])},useMemoCache:bA,useCacheRefresh:HA};hd.useEffectEvent=Sp;function $g(r,g,C,b){g=r.memoizedState,C=C(b,g),C=C==null?g:A({},g,C),r.memoizedState=C,r.lanes===0&&(r.updateQueue.baseState=C)}var Cd={enqueueSetState:function(r,g,C){r=r._reactInternals;var b=hs(),x=wr(b);x.payload=g,C!=null&&(x.callback=C),g=ll(r,x,b),g!==null&&(I(g,r,b),tc(g,r,b))},enqueueReplaceState:function(r,g,C){r=r._reactInternals;var b=hs(),x=wr(b);x.tag=1,x.payload=g,C!=null&&(x.callback=C),g=ll(r,x,b),g!==null&&(I(g,r,b),tc(g,r,b))},enqueueForceUpdate:function(r,g){r=r._reactInternals;var C=hs(),b=wr(C);b.tag=2,g!=null&&(b.callback=g),g=ll(r,b,C),g!==null&&(I(g,r,C),tc(g,r,C))}};function Np(r,g,C,b,x,W,L){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(b,W,L):g.prototype&&g.prototype.isPureReactComponent?!Hg(C,b)||!Hg(x,W):!0}function Wp(r,g,C,b){r=g.state,typeof g.componentWillReceiveProps=="function"&&g.componentWillReceiveProps(C,b),typeof g.UNSAFE_componentWillReceiveProps=="function"&&g.UNSAFE_componentWillReceiveProps(C,b),g.state!==r&&Cd.enqueueReplaceState(g,g.state,null)}function ka(r,g){var C=g;if("ref"in g){C={};for(var b in g)b!=="ref"&&(C[b]=g[b])}if(r=r.defaultProps){C===g&&(C=A({},C));for(var x in r)C[x]===void 0&&(C[x]=r[x])}return C}function EA(r){kl(r)}function Vp(r){console.error(r)}function ih(r){kl(r)}function ah(r,g){try{var C=r.onUncaughtError;C(g.value,{componentStack:g.stack})}catch(b){setTimeout(function(){throw b})}}function Mp(r,g,C){try{var b=r.onCaughtError;b(C.value,{componentStack:C.stack,errorBoundary:g.tag===1?g.stateNode:null})}catch(x){setTimeout(function(){throw x})}}function FA(r,g,C){return C=wr(C),C.tag=3,C.payload={element:null},C.callback=function(){ah(r,g)},C}function eu(r){return r=wr(r),r.tag=3,r}function Vs(r,g,C,b){var x=C.type.getDerivedStateFromError;if(typeof x=="function"){var W=b.value;r.payload=function(){return x(W)},r.callback=function(){Mp(g,C,b)}}var L=C.stateNode;L!==null&&typeof L.componentDidCatch=="function"&&(r.callback=function(){Mp(g,C,b),typeof x!="function"&&(Yr===null?Yr=new Set([this]):Yr.add(this));var re=b.stack;this.componentDidCatch(b.value,{componentStack:re!==null?re:""})})}function no(r,g,C,b,x){if(C.flags|=32768,b!==null&&typeof b=="object"&&typeof b.then=="function"){if(g=C.alternate,g!==null&&Jl(g,C,x,!0),C=pa.current,C!==null){switch(C.tag){case 31:case 13:return No===null?wn():C.alternate===null&&di===0&&(di=3),C.flags&=-257,C.flags|=65536,C.lanes=x,b===ad?C.flags|=16384:(g=C.updateQueue,g===null?C.updateQueue=new Set([b]):g.add(b),_v(r,b,x)),!1;case 22:return C.flags|=65536,b===ad?C.flags|=16384:(g=C.updateQueue,g===null?(g={transitions:null,markerInstances:null,retryQueue:new Set([b])},C.updateQueue=g):(C=g.retryQueue,C===null?g.retryQueue=new Set([b]):C.add(b)),_v(r,b,x)),!1}throw Error(n(435,C.tag))}return _v(r,b,x),wn(),!1}if(jn)return g=pa.current,g!==null?((g.flags&65536)===0&&(g.flags|=256),g.flags|=65536,g.lanes=x,b!==EI&&(r=Error(n(422),{cause:b}),td(ws(r,C)))):(b!==EI&&(g=Error(n(423),{cause:b}),td(ws(g,C))),r=r.current.alternate,r.flags|=65536,x&=-x,r.lanes|=x,b=ws(b,C),x=FA(r.stateNode,b,x),kI(r,x),di!==4&&(di=2)),!1;var W=Error(n(520),{cause:b});if(W=ws(W,C),sr===null?sr=[W]:sr.push(W),di!==4&&(di=2),g===null)return!0;b=ws(b,C),C=g;do{switch(C.tag){case 3:return C.flags|=65536,r=x&-x,C.lanes|=r,r=FA(C.stateNode,b,r),kI(C,r),!1;case 1:if(g=C.type,W=C.stateNode,(C.flags&128)===0&&(typeof g.getDerivedStateFromError=="function"||W!==null&&typeof W.componentDidCatch=="function"&&(Yr===null||!Yr.has(W))))return C.flags|=65536,x&=-x,C.lanes|=x,x=eu(x),Vs(x,r,C,b),kI(C,x),!1}C=C.return}while(C!==null);return!1}var sh=Error(n(461)),Vi=!1;function Oi(r,g,C,b){g.child=r===null?lp(g,null,C,b):qc(g,r.child,C,b)}function Ad(r,g,C,b,x){C=C.render;var W=g.ref;if("ref"in b){var L={};for(var re in b)re!=="ref"&&(L[re]=b[re])}else L=b;return Jc(g),b=AA(r,g,C,L,W,x),re=fA(),r!==null&&!Vi?(mA(r,g,x),ir(r,g,x)):(jn&&re&&HI(g),g.flags|=1,Oi(r,g,b,x),g.child)}function fd(r,g,C,b,x){if(r===null){var W=C.type;return typeof W=="function"&&!gs(W)&&W.defaultProps===void 0&&C.compare===null?(g.tag=15,g.type=W,io(r,g,W,b,x)):(r=qu(C.type,null,b,g,g.mode,x),r.ref=g.ref,r.return=g,g.child=r)}if(W=r.child,!ac(r,x)){var L=W.memoizedProps;if(C=C.compare,C=C!==null?C:Hg,C(L,b)&&r.ref===g.ref)return ir(r,g,x)}return g.flags|=1,r=Gr(W,b),r.ref=g.ref,r.return=g,g.child=r}function io(r,g,C,b,x){if(r!==null){var W=r.memoizedProps;if(Hg(W,b)&&r.ref===g.ref)if(Vi=!1,g.pendingProps=b=W,ac(r,x))(r.flags&131072)!==0&&(Vi=!0);else return g.lanes=r.lanes,ir(r,g,x)}return tu(r,g,C,b,x)}function ao(r,g,C,b){var x=b.children,W=r!==null?r.memoizedState:null;if(r===null&&g.stateNode===null&&(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),b.mode==="hidden"){if((g.flags&128)!==0){if(W=W!==null?W.baseLanes|C:C,r!==null){for(b=g.child=r.child,x=0;b!==null;)x=x|b.lanes|b.childLanes,b=b.sibling;b=x&~W}else b=0,g.child=null;return Vr(r,g,W,C,b)}if((C&536870912)!==0)g.memoizedState={baseLanes:0,cachePool:null},r!==null&&jg(g,W!==null?W.cachePool:null),W!==null?dA(g,W):IA(),cp(g);else return b=g.lanes=536870912,Vr(r,g,W!==null?W.baseLanes|C:C,C,b)}else W!==null?(jg(g,W.cachePool),dA(g,W),cl(),g.memoizedState=null):(r!==null&&jg(g,null),IA(),cl());return Oi(r,g,x,C),g.child}function tr(r,g){return r!==null&&r.tag===22||g.stateNode!==null||(g.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),g.sibling}function Vr(r,g,C,b,x){var W=Zr();return W=W===null?null:{parent:gn._currentValue,pool:W},g.memoizedState={baseLanes:C,cachePool:W},r!==null&&jg(g,null),IA(),cp(g),r!==null&&Jl(r,g,b,!0),g.childLanes=x,null}function Wo(r,g){return g=nu({mode:g.mode,children:g.children},r.mode),g.ref=r.ref,r.child=g,g.return=r,g}function Va(r,g,C){return qc(g,r.child,null,C),r=Wo(g,g.pendingProps),r.flags|=2,eo(g),g.memoizedState=null,r}function md(r,g,C){var b=g.pendingProps,x=(g.flags&128)!==0;if(g.flags&=-129,r===null){if(jn){if(b.mode==="hidden")return r=Wo(g,b),g.lanes=536870912,tr(null,r);if(hA(g),(r=Gi)?(r=Ux(r,Na),r=r!==null&&r.data==="&"?r:null,r!==null&&(g.memoizedState={dehydrated:r,treeContext:Br!==null?{id:Sr,overflow:xr}:null,retryLane:536870912,hydrationErrors:null},C=np(r),C.return=g,g.child=C,Ra=g,Gi=null)):r=null,r===null)throw Un(g);return g.lanes=536870912,null}return Wo(g,b)}var W=r.memoizedState;if(W!==null){var L=W.dehydrated;if(hA(g),x)if(g.flags&256)g.flags&=-257,g=Va(r,g,C);else if(g.memoizedState!==null)g.child=r.child,g.flags|=128,g=null;else throw Error(n(558));else if(Vi||Jl(r,g,C,!1),x=(C&r.childLanes)!==0,Vi||x){if(b=ui,b!==null&&(L=Xe(b,C),L!==0&&L!==W.retryLane))throw W.retryLane=L,Dl(r,L),I(b,r,L),sh;wn(),g=Va(r,g,C)}else r=W.treeContext,Gi=Hr(L.nextSibling),Ra=g,jn=!0,il=null,Na=!1,r!==null&&ed(g,r),g=Wo(g,b),g.flags|=4096;return g}return r=Gr(r.child,{mode:b.mode,children:b.children}),r.ref=g.ref,g.child=r,r.return=g,r}function nr(r,g){var C=g.ref;if(C===null)r!==null&&r.ref!==null&&(g.flags|=4194816);else{if(typeof C!="function"&&typeof C!="object")throw Error(n(284));(r===null||r.ref!==C)&&(g.flags|=4194816)}}function tu(r,g,C,b,x){return Jc(g),C=AA(r,g,C,b,void 0,x),b=fA(),r!==null&&!Vi?(mA(r,g,x),ir(r,g,x)):(jn&&b&&HI(g),g.flags|=1,Oi(r,g,C,x),g.child)}function ts(r,g,C,b,x,W){return Jc(g),g.updateQueue=null,C=up(g,b,C,x),gp(r),b=fA(),r!==null&&!Vi?(mA(r,g,W),ir(r,g,W)):(jn&&b&&HI(g),g.flags|=1,Oi(r,g,C,W),g.child)}function Ua(r,g,C,b,x){if(Jc(g),g.stateNode===null){var W=Ol,L=C.contextType;typeof L=="object"&&L!==null&&(W=Wa(L)),W=new C(b,W),g.memoizedState=W.state!==null&&W.state!==void 0?W.state:null,W.updater=Cd,g.stateNode=W,W._reactInternals=g,W=g.stateNode,W.props=b,W.state=g.memoizedState,W.refs={},cA(g),L=C.contextType,W.context=typeof L=="object"&&L!==null?Wa(L):Ol,W.state=g.memoizedState,L=C.getDerivedStateFromProps,typeof L=="function"&&($g(g,C,L,b),W.state=g.memoizedState),typeof C.getDerivedStateFromProps=="function"||typeof W.getSnapshotBeforeUpdate=="function"||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(L=W.state,typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount(),L!==W.state&&Cd.enqueueReplaceState(W,W.state,null),$c(g,b,W,x),rd(),W.state=g.memoizedState),typeof W.componentDidMount=="function"&&(g.flags|=4194308),b=!0}else if(r===null){W=g.stateNode;var re=g.memoizedProps,Se=ka(C,re);W.props=Se;var tt=W.context,mt=C.contextType;L=Ol,typeof mt=="object"&&mt!==null&&(L=Wa(mt));var Nt=C.getDerivedStateFromProps;mt=typeof Nt=="function"||typeof W.getSnapshotBeforeUpdate=="function",re=g.pendingProps!==re,mt||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(re||tt!==L)&&Wp(g,W,b,L),ec=!1;var at=g.memoizedState;W.state=at,$c(g,b,W,x),rd(),tt=g.memoizedState,re||at!==tt||ec?(typeof Nt=="function"&&($g(g,C,Nt,b),tt=g.memoizedState),(Se=ec||Np(g,C,Se,b,at,tt,L))?(mt||typeof W.UNSAFE_componentWillMount!="function"&&typeof W.componentWillMount!="function"||(typeof W.componentWillMount=="function"&&W.componentWillMount(),typeof W.UNSAFE_componentWillMount=="function"&&W.UNSAFE_componentWillMount()),typeof W.componentDidMount=="function"&&(g.flags|=4194308)):(typeof W.componentDidMount=="function"&&(g.flags|=4194308),g.memoizedProps=b,g.memoizedState=tt),W.props=b,W.state=tt,W.context=L,b=Se):(typeof W.componentDidMount=="function"&&(g.flags|=4194308),b=!1)}else{W=g.stateNode,gA(r,g),L=g.memoizedProps,mt=ka(C,L),W.props=mt,Nt=g.pendingProps,at=W.context,tt=C.contextType,Se=Ol,typeof tt=="object"&&tt!==null&&(Se=Wa(tt)),re=C.getDerivedStateFromProps,(tt=typeof re=="function"||typeof W.getSnapshotBeforeUpdate=="function")||typeof W.UNSAFE_componentWillReceiveProps!="function"&&typeof W.componentWillReceiveProps!="function"||(L!==Nt||at!==Se)&&Wp(g,W,b,Se),ec=!1,at=g.memoizedState,W.state=at,$c(g,b,W,x),rd();var ut=g.memoizedState;L!==Nt||at!==ut||ec||r!==null&&r.dependencies!==null&&Dg(r.dependencies)?(typeof re=="function"&&($g(g,C,re,b),ut=g.memoizedState),(mt=ec||Np(g,C,mt,b,at,ut,Se)||r!==null&&r.dependencies!==null&&Dg(r.dependencies))?(tt||typeof W.UNSAFE_componentWillUpdate!="function"&&typeof W.componentWillUpdate!="function"||(typeof W.componentWillUpdate=="function"&&W.componentWillUpdate(b,ut,Se),typeof W.UNSAFE_componentWillUpdate=="function"&&W.UNSAFE_componentWillUpdate(b,ut,Se)),typeof W.componentDidUpdate=="function"&&(g.flags|=4),typeof W.getSnapshotBeforeUpdate=="function"&&(g.flags|=1024)):(typeof W.componentDidUpdate!="function"||L===r.memoizedProps&&at===r.memoizedState||(g.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||L===r.memoizedProps&&at===r.memoizedState||(g.flags|=1024),g.memoizedProps=b,g.memoizedState=ut),W.props=b,W.state=ut,W.context=Se,b=mt):(typeof W.componentDidUpdate!="function"||L===r.memoizedProps&&at===r.memoizedState||(g.flags|=4),typeof W.getSnapshotBeforeUpdate!="function"||L===r.memoizedProps&&at===r.memoizedState||(g.flags|=1024),b=!1)}return W=b,nr(r,g),b=(g.flags&128)!==0,W||b?(W=g.stateNode,C=b&&typeof C.getDerivedStateFromError!="function"?null:W.render(),g.flags|=1,r!==null&&b?(g.child=qc(g,r.child,null,x),g.child=qc(g,null,C,x)):Oi(r,g,C,x),g.memoizedState=W.state,r=g.child):r=ir(r,g,x),r}function ii(r,g,C,b){return jc(),g.flags|=256,Oi(r,g,C,b),g.child}var so={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Vo(r){return{baseLanes:r,cachePool:TI()}}function pd(r,g,C){return r=r!==null?r.childLanes&~C:0,g&&(r|=qn),r}function oo(r,g,C){var b=g.pendingProps,x=!1,W=(g.flags&128)!==0,L;if((L=W)||(L=r!==null&&r.memoizedState===null?!1:(Ui.current&2)!==0),L&&(x=!0,g.flags&=-129),L=(g.flags&32)!==0,g.flags&=-33,r===null){if(jn){if(x?nc(g):cl(),(r=Gi)?(r=Ux(r,Na),r=r!==null&&r.data!=="&"?r:null,r!==null&&(g.memoizedState={dehydrated:r,treeContext:Br!==null?{id:Sr,overflow:xr}:null,retryLane:536870912,hydrationErrors:null},C=np(r),C.return=g,g.child=C,Ra=g,Gi=null)):r=null,r===null)throw Un(g);return Pv(r)?g.lanes=32:g.lanes=536870912,null}var re=b.children;return b=b.fallback,x?(cl(),x=g.mode,re=nu({mode:"hidden",children:re},x),b=tl(b,x,C,null),re.return=g,b.return=g,re.sibling=b,g.child=re,b=g.child,b.memoizedState=Vo(C),b.childLanes=pd(r,L,C),g.memoizedState=so,tr(null,b)):(nc(g),ic(g,re))}var Se=r.memoizedState;if(Se!==null&&(re=Se.dehydrated,re!==null)){if(W)g.flags&256?(nc(g),g.flags&=-257,g=iu(r,g,C)):g.memoizedState!==null?(cl(),g.child=r.child,g.flags|=128,g=null):(cl(),re=b.fallback,x=g.mode,b=nu({mode:"visible",children:b.children},x),re=tl(re,x,C,null),re.flags|=2,b.return=g,re.return=g,b.sibling=re,g.child=b,qc(g,r.child,null,C),b=g.child,b.memoizedState=Vo(C),b.childLanes=pd(r,L,C),g.memoizedState=so,g=tr(null,b));else if(nc(g),Pv(re)){if(L=re.nextSibling&&re.nextSibling.dataset,L)var tt=L.dgst;L=tt,b=Error(n(419)),b.stack="",b.digest=L,td({value:b,source:null,stack:null}),g=iu(r,g,C)}else if(Vi||Jl(r,g,C,!1),L=(C&r.childLanes)!==0,Vi||L){if(L=ui,L!==null&&(b=Xe(L,C),b!==0&&b!==Se.retryLane))throw Se.retryLane=b,Dl(r,b),I(L,r,b),sh;Jv(re)||wn(),g=iu(r,g,C)}else Jv(re)?(g.flags|=192,g.child=r.child,g=null):(r=Se.treeContext,Gi=Hr(re.nextSibling),Ra=g,jn=!0,il=null,Na=!1,r!==null&&ed(g,r),g=ic(g,b.children),g.flags|=4096);return g}return x?(cl(),re=b.fallback,x=g.mode,Se=r.child,tt=Se.sibling,b=Gr(Se,{mode:"hidden",children:b.children}),b.subtreeFlags=Se.subtreeFlags&65011712,tt!==null?re=Gr(tt,re):(re=tl(re,x,C,null),re.flags|=2),re.return=g,b.return=g,b.sibling=re,g.child=b,tr(null,b),b=g.child,re=r.child.memoizedState,re===null?re=Vo(C):(x=re.cachePool,x!==null?(Se=gn._currentValue,x=x.parent!==Se?{parent:Se,pool:Se}:x):x=TI(),re={baseLanes:re.baseLanes|C,cachePool:x}),b.memoizedState=re,b.childLanes=pd(r,L,C),g.memoizedState=so,tr(r.child,b)):(nc(g),C=r.child,r=C.sibling,C=Gr(C,{mode:"visible",children:b.children}),C.return=g,C.sibling=null,r!==null&&(L=g.deletions,L===null?(g.deletions=[r],g.flags|=16):L.push(r)),g.child=C,g.memoizedState=null,C)}function ic(r,g){return g=nu({mode:"visible",children:g},r.mode),g.return=r,r.child=g}function nu(r,g){return r=cs(22,r,null,g),r.lanes=0,r}function iu(r,g,C){return qc(g,r.child,null,C),r=ic(g,g.pendingProps.children),r.flags|=2,g.memoizedState=null,r}function ng(r,g,C){r.lanes|=g;var b=r.alternate;b!==null&&(b.lanes|=g),ol(r.return,g,C)}function bd(r,g,C,b,x,W){var L=r.memoizedState;L===null?r.memoizedState={isBackwards:g,rendering:null,renderingStartTime:0,last:b,tail:C,tailMode:x,treeForkCount:W}:(L.isBackwards=g,L.rendering=null,L.renderingStartTime=0,L.last=b,L.tail=C,L.tailMode=x,L.treeForkCount=W)}function yd(r,g,C){var b=g.pendingProps,x=b.revealOrder,W=b.tail;b=b.children;var L=Ui.current,re=(L&2)!==0;if(re?(L=L&1|2,g.flags|=128):L&=1,ae(Ui,L),Oi(r,g,b,C),b=jn?Ug:0,!re&&r!==null&&(r.flags&128)!==0)e:for(r=g.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&ng(r,C,g);else if(r.tag===19)ng(r,C,g);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===g)break e;for(;r.sibling===null;){if(r.return===null||r.return===g)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(x){case"forwards":for(C=g.child,x=null;C!==null;)r=C.alternate,r!==null&&UI(r)===null&&(x=C),C=C.sibling;C=x,C===null?(x=g.child,g.child=null):(x=C.sibling,C.sibling=null),bd(g,!1,x,C,W,b);break;case"backwards":case"unstable_legacy-backwards":for(C=null,x=g.child,g.child=null;x!==null;){if(r=x.alternate,r!==null&&UI(r)===null){g.child=x;break}r=x.sibling,x.sibling=C,C=x,x=r}bd(g,!0,C,null,W,b);break;case"together":bd(g,!1,null,null,void 0,b);break;default:g.memoizedState=null}return g.child}function ir(r,g,C){if(r!==null&&(g.dependencies=r.dependencies),co|=g.lanes,(C&g.childLanes)===0)if(r!==null){if(Jl(r,g,C,!1),(C&g.childLanes)===0)return null}else return null;if(r!==null&&g.child!==r.child)throw Error(n(153));if(g.child!==null){for(r=g.child,C=Gr(r,r.pendingProps),g.child=C,C.return=g;r.sibling!==null;)r=r.sibling,C=C.sibling=Gr(r,r.pendingProps),C.return=g;C.sibling=null}return g.child}function ac(r,g){return(r.lanes&g)!==0?!0:(r=r.dependencies,!!(r!==null&&Dg(r)))}function vd(r,g,C){switch(g.tag){case 3:ee(g,g.stateNode.containerInfo),sl(g,gn,r.memoizedState.cache),jc();break;case 27:case 5:we(g);break;case 4:ee(g,g.stateNode.containerInfo);break;case 10:sl(g,g.type,g.memoizedProps.value);break;case 31:if(g.memoizedState!==null)return g.flags|=128,hA(g),null;break;case 13:var b=g.memoizedState;if(b!==null)return b.dehydrated!==null?(nc(g),g.flags|=128,null):(C&g.child.childLanes)!==0?oo(r,g,C):(nc(g),r=ir(r,g,C),r!==null?r.sibling:null);nc(g);break;case 19:var x=(r.flags&128)!==0;if(b=(C&g.childLanes)!==0,b||(Jl(r,g,C,!1),b=(C&g.childLanes)!==0),x){if(b)return yd(r,g,C);g.flags|=128}if(x=g.memoizedState,x!==null&&(x.rendering=null,x.tail=null,x.lastEffect=null),ae(Ui,Ui.current),b)break;return null;case 22:return g.lanes=0,ao(r,g,C,g.pendingProps);case 24:sl(g,gn,r.memoizedState.cache)}return ir(r,g,C)}function oh(r,g,C){if(r!==null)if(r.memoizedProps!==g.pendingProps)Vi=!0;else{if(!ac(r,C)&&(g.flags&128)===0)return Vi=!1,vd(r,g,C);Vi=(r.flags&131072)!==0}else Vi=!1,jn&&(g.flags&1048576)!==0&&qC(g,Ug,g.index);switch(g.lanes=0,g.tag){case 16:e:{var b=g.pendingProps;if(r=Qc(g.elementType),g.type=r,typeof r=="function")gs(r)?(b=ka(r,b),g.tag=1,g=Ua(null,g,r,b,C)):(g.tag=0,g=tu(null,g,r,b,C));else{if(r!=null){var x=r.$$typeof;if(x===w){g.tag=11,g=Ad(null,g,r,b,C);break e}else if(x===X){g.tag=14,g=fd(null,g,r,b,C);break e}}throw g=k(r)||r,Error(n(306,g,""))}}return g;case 0:return tu(r,g,g.type,g.pendingProps,C);case 1:return b=g.type,x=ka(b,g.pendingProps),Ua(r,g,b,x,C);case 3:e:{if(ee(g,g.stateNode.containerInfo),r===null)throw Error(n(387));b=g.pendingProps;var W=g.memoizedState;x=W.element,gA(r,g),$c(g,b,null,C);var L=g.memoizedState;if(b=L.cache,sl(g,gn,b),b!==W.cache&&KI(g,[gn],C,!0),rd(),b=L.element,W.isDehydrated)if(W={element:b,isDehydrated:!1,cache:L.cache},g.updateQueue.baseState=W,g.memoizedState=W,g.flags&256){g=ii(r,g,b,C);break e}else if(b!==x){x=ws(Error(n(424)),g),td(x),g=ii(r,g,b,C);break e}else for(r=g.stateNode.containerInfo,r.nodeType===9?r=r.body:r=r.nodeName==="HTML"?r.ownerDocument.body:r,Gi=Hr(r.firstChild),Ra=g,jn=!0,il=null,Na=!0,C=lp(g,null,b,C),g.child=C;C;)C.flags=C.flags&-3|4096,C=C.sibling;else{if(jc(),b===x){g=ir(r,g,C);break e}Oi(r,g,b,C)}g=g.child}return g;case 26:return nr(r,g),r===null?(C=Qx(g.type,null,g.pendingProps,null))?g.memoizedState=C:jn||(C=g.type,r=g.pendingProps,b=Tp(D.current).createElement(C),b[Vt]=g,b[U]=r,Cs(b,C,r),ne(b),g.stateNode=b):g.memoizedState=Qx(g.type,r.memoizedProps,g.pendingProps,r.memoizedState),null;case 27:return we(g),r===null&&jn&&(b=g.stateNode=jx(g.type,g.pendingProps,D.current),Ra=g,Na=!0,x=Gi,gu(g.type)?(Qv=x,Gi=Hr(b.firstChild)):Gi=x),Oi(r,g,g.pendingProps.children,C),nr(r,g),r===null&&(g.flags|=4194304),g.child;case 5:return r===null&&jn&&((x=b=Gi)&&(b=QM(b,g.type,g.pendingProps,Na),b!==null?(g.stateNode=b,Ra=g,Gi=Hr(b.firstChild),Na=!1,x=!0):x=!1),x||Un(g)),we(g),x=g.type,W=g.pendingProps,L=r!==null?r.memoizedProps:null,b=W.children,Dv(x,W)?b=null:L!==null&&Dv(x,L)&&(g.flags|=32),g.memoizedState!==null&&(x=AA(r,g,wv,null,null,C),JA._currentValue=x),nr(r,g),Oi(r,g,b,C),g.child;case 6:return r===null&&jn&&((r=C=Gi)&&(C=qM(C,g.pendingProps,Na),C!==null?(g.stateNode=C,Ra=g,Gi=null,r=!0):r=!1),r||Un(g)),null;case 13:return oo(r,g,C);case 4:return ee(g,g.stateNode.containerInfo),b=g.pendingProps,r===null?g.child=qc(g,null,b,C):Oi(r,g,b,C),g.child;case 11:return Ad(r,g,g.type,g.pendingProps,C);case 7:return Oi(r,g,g.pendingProps,C),g.child;case 8:return Oi(r,g,g.pendingProps.children,C),g.child;case 12:return Oi(r,g,g.pendingProps.children,C),g.child;case 10:return b=g.pendingProps,sl(g,g.type,b.value),Oi(r,g,b.children,C),g.child;case 9:return x=g.type._context,b=g.pendingProps.children,Jc(g),x=Wa(x),b=b(x),g.flags|=1,Oi(r,g,b,C),g.child;case 14:return fd(r,g,g.type,g.pendingProps,C);case 15:return io(r,g,g.type,g.pendingProps,C);case 19:return yd(r,g,C);case 31:return md(r,g,C);case 22:return ao(r,g,C,g.pendingProps);case 24:return Jc(g),b=Wa(gn),r===null?(x=Zr(),x===null&&(x=ui,W=iA(),x.pooledCache=W,W.refCount++,W!==null&&(x.pooledCacheLanes|=C),x=W),g.memoizedState={parent:b,cache:x},cA(g),sl(g,gn,x)):((r.lanes&C)!==0&&(gA(r,g),$c(g,null,null,C),rd()),x=r.memoizedState,W=g.memoizedState,x.parent!==b?(x={parent:b,cache:b},g.memoizedState=x,g.lanes===0&&(g.memoizedState=g.updateQueue.baseState=x),sl(g,gn,b)):(b=W.cache,sl(g,gn,b),b!==x.cache&&KI(g,[gn],C,!0))),Oi(r,g,g.pendingProps.children,C),g.child;case 29:throw g.pendingProps}throw Error(n(156,g.tag))}function Ms(r){r.flags|=4}function sc(r,g,C,b,x){if((g=(r.mode&32)!==0)&&(g=!1),g){if(r.flags|=16777216,(x&335544128)===x)if(r.stateNode.complete)r.flags|=8192;else if(Dt())r.flags|=8192;else throw mn=ad,id}else r.flags&=-16777217}function dl(r,g){if(g.type!=="stylesheet"||(g.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!nZ(g))if(Dt())r.flags|=8192;else throw mn=ad,id}function au(r,g){g!==null&&(r.flags|=4),r.flags&16384&&(g=r.tag!==22?Ot():536870912,r.lanes|=g,go|=g)}function Gd(r,g){if(!jn)switch(r.tailMode){case"hidden":g=r.tail;for(var C=null;g!==null;)g.alternate!==null&&(C=g),g=g.sibling;C===null?r.tail=null:C.sibling=null;break;case"collapsed":C=r.tail;for(var b=null;C!==null;)C.alternate!==null&&(b=C),C=C.sibling;b===null?g||r.tail===null?r.tail=null:r.tail.sibling=null:b.sibling=null}}function Ai(r){var g=r.alternate!==null&&r.alternate.child===r.child,C=0,b=0;if(g)for(var x=r.child;x!==null;)C|=x.lanes|x.childLanes,b|=x.subtreeFlags&65011712,b|=x.flags&65011712,x.return=r,x=x.sibling;else for(x=r.child;x!==null;)C|=x.lanes|x.childLanes,b|=x.subtreeFlags,b|=x.flags,x.return=r,x=x.sibling;return r.subtreeFlags|=b,r.childLanes=C,g}function KA(r,g,C){var b=g.pendingProps;switch(jl(g),g.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ai(g),null;case 1:return Ai(g),null;case 3:return C=g.stateNode,b=null,r!==null&&(b=r.memoizedState.cache),g.memoizedState.cache!==b&&(g.flags|=2048),Ro(gn),Ce(),C.pendingContext&&(C.context=C.pendingContext,C.pendingContext=null),(r===null||r.child===null)&&(Oc(g)?Ms(g):r===null||r.memoizedState.isDehydrated&&(g.flags&256)===0||(g.flags|=1024,$C())),Ai(g),null;case 26:var x=g.type,W=g.memoizedState;return r===null?(Ms(g),W!==null?(Ai(g),dl(g,W)):(Ai(g),sc(g,x,null,b,C))):W?W!==r.memoizedState?(Ms(g),Ai(g),dl(g,W)):(Ai(g),g.flags&=-16777217):(r=r.memoizedProps,r!==b&&Ms(g),Ai(g),sc(g,x,r,b,C)),null;case 27:if(Ye(g),C=D.current,x=g.type,r!==null&&g.stateNode!=null)r.memoizedProps!==b&&Ms(g);else{if(!b){if(g.stateNode===null)throw Error(n(166));return Ai(g),null}r=Ie.current,Oc(g)?FI(g):(r=jx(x,b,C),g.stateNode=r,Ms(g))}return Ai(g),null;case 5:if(Ye(g),x=g.type,r!==null&&g.stateNode!=null)r.memoizedProps!==b&&Ms(g);else{if(!b){if(g.stateNode===null)throw Error(n(166));return Ai(g),null}if(W=Ie.current,Oc(g))FI(g);else{var L=Tp(D.current);switch(W){case 1:W=L.createElementNS("http://www.w3.org/2000/svg",x);break;case 2:W=L.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;default:switch(x){case"svg":W=L.createElementNS("http://www.w3.org/2000/svg",x);break;case"math":W=L.createElementNS("http://www.w3.org/1998/Math/MathML",x);break;case"script":W=L.createElement("div"),W.innerHTML="<script><\/script>",W=W.removeChild(W.firstChild);break;case"select":W=typeof b.is=="string"?L.createElement("select",{is:b.is}):L.createElement("select"),b.multiple?W.multiple=!0:b.size&&(W.size=b.size);break;default:W=typeof b.is=="string"?L.createElement(x,{is:b.is}):L.createElement(x)}}W[Vt]=g,W[U]=b;e:for(L=g.child;L!==null;){if(L.tag===5||L.tag===6)W.appendChild(L.stateNode);else if(L.tag!==4&&L.tag!==27&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===g)break e;for(;L.sibling===null;){if(L.return===null||L.return===g)break e;L=L.return}L.sibling.return=L.return,L=L.sibling}g.stateNode=W;e:switch(Cs(W,x,b),x){case"button":case"input":case"select":case"textarea":b=!!b.autoFocus;break e;case"img":b=!0;break e;default:b=!1}b&&Ms(g)}}return Ai(g),sc(g,g.type,r===null?null:r.memoizedProps,g.pendingProps,C),null;case 6:if(r&&g.stateNode!=null)r.memoizedProps!==b&&Ms(g);else{if(typeof b!="string"&&g.stateNode===null)throw Error(n(166));if(r=D.current,Oc(g)){if(r=g.stateNode,C=g.memoizedProps,b=null,x=Ra,x!==null)switch(x.tag){case 27:case 5:b=x.memoizedProps}r[Vt]=g,r=!!(r.nodeValue===C||b!==null&&b.suppressHydrationWarning===!0||Hx(r.nodeValue,C)),r||Un(g,!0)}else r=Tp(r).createTextNode(b),r[Vt]=g,g.stateNode=r}return Ai(g),null;case 31:if(C=g.memoizedState,r===null||r.memoizedState!==null){if(b=Oc(g),C!==null){if(r===null){if(!b)throw Error(n(318));if(r=g.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(557));r[Vt]=g}else jc(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Ai(g),r=!1}else C=$C(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=C),r=!0;if(!r)return g.flags&256?(eo(g),g):(eo(g),null);if((g.flags&128)!==0)throw Error(n(558))}return Ai(g),null;case 13:if(b=g.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(x=Oc(g),b!==null&&b.dehydrated!==null){if(r===null){if(!x)throw Error(n(318));if(x=g.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(n(317));x[Vt]=g}else jc(),(g.flags&128)===0&&(g.memoizedState=null),g.flags|=4;Ai(g),x=!1}else x=$C(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=x),x=!0;if(!x)return g.flags&256?(eo(g),g):(eo(g),null)}return eo(g),(g.flags&128)!==0?(g.lanes=C,g):(C=b!==null,r=r!==null&&r.memoizedState!==null,C&&(b=g.child,x=null,b.alternate!==null&&b.alternate.memoizedState!==null&&b.alternate.memoizedState.cachePool!==null&&(x=b.alternate.memoizedState.cachePool.pool),W=null,b.memoizedState!==null&&b.memoizedState.cachePool!==null&&(W=b.memoizedState.cachePool.pool),W!==x&&(b.flags|=2048)),C!==r&&C&&(g.child.flags|=8192),au(g,g.updateQueue),Ai(g),null);case 4:return Ce(),r===null&&Tv(g.stateNode.containerInfo),Ai(g),null;case 10:return Ro(g.type),Ai(g),null;case 19:if($(Ui),b=g.memoizedState,b===null)return Ai(g),null;if(x=(g.flags&128)!==0,W=b.rendering,W===null)if(x)Gd(b,!1);else{if(di!==0||r!==null&&(r.flags&128)!==0)for(r=g.child;r!==null;){if(W=UI(r),W!==null){for(g.flags|=128,Gd(b,!1),r=W.updateQueue,g.updateQueue=r,au(g,r),g.subtreeFlags=0,r=C,C=g.child;C!==null;)qa(C,r),C=C.sibling;return ae(Ui,Ui.current&1|2),jn&&nl(g,b.treeForkCount),g.child}r=r.sibling}b.tail!==null&&z()>uo&&(g.flags|=128,x=!0,Gd(b,!1),g.lanes=4194304)}else{if(!x)if(r=UI(W),r!==null){if(g.flags|=128,x=!0,r=r.updateQueue,g.updateQueue=r,au(g,r),Gd(b,!0),b.tail===null&&b.tailMode==="hidden"&&!W.alternate&&!jn)return Ai(g),null}else 2*z()-b.renderingStartTime>uo&&C!==536870912&&(g.flags|=128,x=!0,Gd(b,!1),g.lanes=4194304);b.isBackwards?(W.sibling=g.child,g.child=W):(r=b.last,r!==null?r.sibling=W:g.child=W,b.last=W)}return b.tail!==null?(r=b.tail,b.rendering=r,b.tail=r.sibling,b.renderingStartTime=z(),r.sibling=null,C=Ui.current,ae(Ui,x?C&1|2:C&1),jn&&nl(g,b.treeForkCount),r):(Ai(g),null);case 22:case 23:return eo(g),es(),b=g.memoizedState!==null,r!==null?r.memoizedState!==null!==b&&(g.flags|=8192):b&&(g.flags|=8192),b?(C&536870912)!==0&&(g.flags&128)===0&&(Ai(g),g.subtreeFlags&6&&(g.flags|=8192)):Ai(g),C=g.updateQueue,C!==null&&au(g,C.retryQueue),C=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(C=r.memoizedState.cachePool.pool),b=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(b=g.memoizedState.cachePool.pool),b!==C&&(g.flags|=2048),r!==null&&$(Pl),null;case 24:return C=null,r!==null&&(C=r.memoizedState.cache),g.memoizedState.cache!==C&&(g.flags|=2048),Ro(gn),Ai(g),null;case 25:return null;case 30:return null}throw Error(n(156,g.tag))}function rh(r,g){switch(jl(g),g.tag){case 1:return r=g.flags,r&65536?(g.flags=r&-65537|128,g):null;case 3:return Ro(gn),Ce(),r=g.flags,(r&65536)!==0&&(r&128)===0?(g.flags=r&-65537|128,g):null;case 26:case 27:case 5:return Ye(g),null;case 31:if(g.memoizedState!==null){if(eo(g),g.alternate===null)throw Error(n(340));jc()}return r=g.flags,r&65536?(g.flags=r&-65537|128,g):null;case 13:if(eo(g),r=g.memoizedState,r!==null&&r.dehydrated!==null){if(g.alternate===null)throw Error(n(340));jc()}return r=g.flags,r&65536?(g.flags=r&-65537|128,g):null;case 19:return $(Ui),null;case 4:return Ce(),null;case 10:return Ro(g.type),null;case 22:case 23:return eo(g),es(),r!==null&&$(Pl),r=g.flags,r&65536?(g.flags=r&-65537|128,g):null;case 24:return Ro(gn),null;case 25:return null;default:return null}}function ig(r,g){switch(jl(g),g.tag){case 3:Ro(gn),Ce();break;case 26:case 27:case 5:Ye(g);break;case 4:Ce();break;case 31:g.memoizedState!==null&&eo(g);break;case 13:eo(g);break;case 19:$(Ui);break;case 10:Ro(g.type);break;case 22:case 23:eo(g),es(),r!==null&&$(Pl);break;case 24:Ro(gn)}}function Mr(r,g){try{var C=g.updateQueue,b=C!==null?C.lastEffect:null;if(b!==null){var x=b.next;C=x;do{if((C.tag&r)===r){b=void 0;var W=C.create,L=C.inst;b=W(),L.destroy=b}C=C.next}while(C!==x)}}catch(re){vi(g,g.return,re)}}function Mo(r,g,C){try{var b=g.updateQueue,x=b!==null?b.lastEffect:null;if(x!==null){var W=x.next;b=W;do{if((b.tag&r)===r){var L=b.inst,re=L.destroy;if(re!==void 0){L.destroy=void 0,x=g;var Se=C,tt=re;try{tt()}catch(mt){vi(x,Se,mt)}}}b=b.next}while(b!==W)}}catch(mt){vi(g,g.return,mt)}}function oc(r){var g=r.updateQueue;if(g!==null){var C=r.stateNode;try{za(g,C)}catch(b){vi(r,r.return,b)}}}function TA(r,g,C){C.props=ka(r.type,r.memoizedProps),C.state=r.memoizedState;try{C.componentWillUnmount()}catch(b){vi(r,g,b)}}function _r(r,g){try{var C=r.ref;if(C!==null){switch(r.tag){case 26:case 27:case 5:var b=r.stateNode;break;case 30:b=r.stateNode;break;default:b=r.stateNode}typeof C=="function"?r.refCleanup=C(b):C.current=b}}catch(x){vi(r,g,x)}}function ro(r,g){var C=r.ref,b=r.refCleanup;if(C!==null)if(typeof b=="function")try{b()}catch(x){vi(r,g,x)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof C=="function")try{C(null)}catch(x){vi(r,g,x)}else C.current=null}function lo(r){var g=r.type,C=r.memoizedProps,b=r.stateNode;try{e:switch(g){case"button":case"input":case"select":case"textarea":C.autoFocus&&b.focus();break e;case"img":C.src?b.src=C.src:C.srcSet&&(b.srcset=C.srcSet)}}catch(x){vi(r,r.return,x)}}function _o(r,g,C){try{var b=r.stateNode;UM(b,r.type,C,g),b[U]=g}catch(x){vi(r,r.return,x)}}function ga(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&gu(r.type)||r.tag===4}function Xr(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||ga(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&gu(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function _n(r,g,C){var b=r.tag;if(b===5||b===6)r=r.stateNode,g?(C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C).insertBefore(r,g):(g=C.nodeType===9?C.body:C.nodeName==="HTML"?C.ownerDocument.body:C,g.appendChild(r),C=C._reactRootContainer,C!=null||g.onclick!==null||(g.onclick=Ea));else if(b!==4&&(b===27&&gu(r.type)&&(C=r.stateNode,g=null),r=r.child,r!==null))for(_n(r,g,C),r=r.sibling;r!==null;)_n(r,g,C),r=r.sibling}function li(r,g,C){var b=r.tag;if(b===5||b===6)r=r.stateNode,g?C.insertBefore(r,g):C.appendChild(r);else if(b!==4&&(b===27&&gu(r.type)&&(C=r.stateNode),r=r.child,r!==null))for(li(r,g,C),r=r.sibling;r!==null;)li(r,g,C),r=r.sibling}function ta(r){var g=r.stateNode,C=r.memoizedProps;try{for(var b=r.type,x=g.attributes;x.length;)g.removeAttributeNode(x[0]);Cs(g,b,C),g[Vt]=r,g[U]=C}catch(W){vi(r,r.return,W)}}var Xo=!1,Mi=!1,Il=!1,Bd=typeof WeakSet=="function"?WeakSet:Set,ji=null;function su(r,g){if(r=r.containerInfo,kv=jp,r=RI(r),Eg(r)){if("selectionStart"in r)var C={start:r.selectionStart,end:r.selectionEnd};else e:{C=(C=r.ownerDocument)&&C.defaultView||window;var b=C.getSelection&&C.getSelection();if(b&&b.rangeCount!==0){C=b.anchorNode;var x=b.anchorOffset,W=b.focusNode;b=b.focusOffset;try{C.nodeType,W.nodeType}catch{C=null;break e}var L=0,re=-1,Se=-1,tt=0,mt=0,Nt=r,at=null;t:for(;;){for(var ut;Nt!==C||x!==0&&Nt.nodeType!==3||(re=L+x),Nt!==W||b!==0&&Nt.nodeType!==3||(Se=L+b),Nt.nodeType===3&&(L+=Nt.nodeValue.length),(ut=Nt.firstChild)!==null;)at=Nt,Nt=ut;for(;;){if(Nt===r)break t;if(at===C&&++tt===x&&(re=L),at===W&&++mt===b&&(Se=L),(ut=Nt.nextSibling)!==null)break;Nt=at,at=Nt.parentNode}Nt=ut}C=re===-1||Se===-1?null:{start:re,end:Se}}else C=null}C=C||{start:0,end:0}}else C=null;for(Uv={focusedElem:r,selectionRange:C},jp=!1,ji=g;ji!==null;)if(g=ji,r=g.child,(g.subtreeFlags&1028)!==0&&r!==null)r.return=g,ji=r;else for(;ji!==null;){switch(g=ji,W=g.alternate,r=g.flags,g.tag){case 0:if((r&4)!==0&&(r=g.updateQueue,r=r!==null?r.events:null,r!==null))for(C=0;C<r.length;C++)x=r[C],x.ref.impl=x.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&W!==null){r=void 0,C=g,x=W.memoizedProps,W=W.memoizedState,b=C.stateNode;try{var on=ka(C.type,x);r=b.getSnapshotBeforeUpdate(on,W),b.__reactInternalSnapshotBeforeUpdate=r}catch(vn){vi(C,C.return,vn)}}break;case 3:if((r&1024)!==0){if(r=g.stateNode.containerInfo,C=r.nodeType,C===9)jv(r);else if(C===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":jv(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=g.sibling,r!==null){r.return=g.return,ji=r;break}ji=g.return}}function _p(r,g,C){var b=C.flags;switch(C.tag){case 0:case 11:case 15:hl(r,C),b&4&&Mr(5,C);break;case 1:if(hl(r,C),b&4)if(r=C.stateNode,g===null)try{r.componentDidMount()}catch(L){vi(C,C.return,L)}else{var x=ka(C.type,g.memoizedProps);g=g.memoizedState;try{r.componentDidUpdate(x,g,r.__reactInternalSnapshotBeforeUpdate)}catch(L){vi(C,C.return,L)}}b&64&&oc(C),b&512&&_r(C,C.return);break;case 3:if(hl(r,C),b&64&&(r=C.updateQueue,r!==null)){if(g=null,C.child!==null)switch(C.child.tag){case 27:case 5:g=C.child.stateNode;break;case 1:g=C.child.stateNode}try{za(r,g)}catch(L){vi(C,C.return,L)}}break;case 27:g===null&&b&4&&ta(C);case 26:case 5:hl(r,C),g===null&&b&4&&lo(C),b&512&&_r(C,C.return);break;case 12:hl(r,C);break;case 31:hl(r,C),b&4&&ch(r,C);break;case 13:hl(r,C),b&4&&zA(r,C),b&64&&(r=C.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(C=MM.bind(null,C),$M(r,C))));break;case 22:if(b=C.memoizedState!==null||Xo,!b){g=g!==null&&g.memoizedState!==null||Mi,x=Xo;var W=Mi;Xo=b,(Mi=g)&&!W?gi(r,C,(C.subtreeFlags&8772)!==0):hl(r,C),Xo=x,Mi=W}break;case 30:break;default:hl(r,C)}}function lh(r){var g=r.alternate;g!==null&&(r.alternate=null,lh(g)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(g=r.stateNode,g!==null&&At(g)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var ai=null,ua=!1;function ns(r,g,C){for(C=C.child;C!==null;)rc(r,g,C),C=C.sibling}function rc(r,g,C){if(je&&typeof je.onCommitFiberUnmount=="function")try{je.onCommitFiberUnmount(Pe,C)}catch{}switch(C.tag){case 26:Mi||ro(C,g),ns(r,g,C),C.memoizedState?C.memoizedState.count--:C.stateNode&&(C=C.stateNode,C.parentNode.removeChild(C));break;case 27:Mi||ro(C,g);var b=ai,x=ua;gu(C.type)&&(ai=C.stateNode,ua=!1),ns(r,g,C),DA(C.stateNode),ai=b,ua=x;break;case 5:Mi||ro(C,g);case 6:if(b=ai,x=ua,ai=null,ns(r,g,C),ai=b,ua=x,ai!==null)if(ua)try{(ai.nodeType===9?ai.body:ai.nodeName==="HTML"?ai.ownerDocument.body:ai).removeChild(C.stateNode)}catch(W){vi(C,g,W)}else try{ai.removeChild(C.stateNode)}catch(W){vi(C,g,W)}break;case 18:ai!==null&&(ua?(r=ai,Lx(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,C.stateNode),bh(r)):Lx(ai,C.stateNode));break;case 4:b=ai,x=ua,ai=C.stateNode.containerInfo,ua=!0,ns(r,g,C),ai=b,ua=x;break;case 0:case 11:case 14:case 15:Mo(2,C,g),Mi||Mo(4,C,g),ns(r,g,C);break;case 1:Mi||(ro(C,g),b=C.stateNode,typeof b.componentWillUnmount=="function"&&TA(C,g,b)),ns(r,g,C);break;case 21:ns(r,g,C);break;case 22:Mi=(b=Mi)||C.memoizedState!==null,ns(r,g,C),Mi=b;break;default:ns(r,g,C)}}function ch(r,g){if(g.memoizedState===null&&(r=g.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{bh(r)}catch(C){vi(g,g.return,C)}}}function zA(r,g){if(g.memoizedState===null&&(r=g.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{bh(r)}catch(C){vi(g,g.return,C)}}function Xp(r){switch(r.tag){case 31:case 13:case 19:var g=r.stateNode;return g===null&&(g=r.stateNode=new Bd),g;case 22:return r=r.stateNode,g=r._retryCache,g===null&&(g=r._retryCache=new Bd),g;default:throw Error(n(435,r.tag))}}function na(r,g){var C=Xp(r);g.forEach(function(b){if(!C.has(b)){C.add(b);var x=_M.bind(null,r,b);b.then(x,x)}})}function is(r,g){var C=g.deletions;if(C!==null)for(var b=0;b<C.length;b++){var x=C[b],W=r,L=g,re=L;e:for(;re!==null;){switch(re.tag){case 27:if(gu(re.type)){ai=re.stateNode,ua=!1;break e}break;case 5:ai=re.stateNode,ua=!1;break e;case 3:case 4:ai=re.stateNode.containerInfo,ua=!0;break e}re=re.return}if(ai===null)throw Error(n(160));rc(W,L,x),ai=null,ua=!1,W=x.alternate,W!==null&&(W.return=null),x.return=null}if(g.subtreeFlags&13886)for(g=g.child;g!==null;)lc(g,r),g=g.sibling}var _s=null;function lc(r,g){var C=r.alternate,b=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:is(g,r),Ji(r),b&4&&(Mo(3,r,r.return),Mr(3,r),Mo(5,r,r.return));break;case 1:is(g,r),Ji(r),b&512&&(Mi||C===null||ro(C,C.return)),b&64&&Xo&&(r=r.updateQueue,r!==null&&(b=r.callbacks,b!==null&&(C=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=C===null?b:C.concat(b))));break;case 26:var x=_s;if(is(g,r),Ji(r),b&512&&(Mi||C===null||ro(C,C.return)),b&4){var W=C!==null?C.memoizedState:null;if(b=r.memoizedState,C===null)if(b===null)if(r.stateNode===null){e:{b=r.type,C=r.memoizedProps,x=x.ownerDocument||x;t:switch(b){case"title":W=x.getElementsByTagName("title")[0],(!W||W[wt]||W[Vt]||W.namespaceURI==="http://www.w3.org/2000/svg"||W.hasAttribute("itemprop"))&&(W=x.createElement(b),x.head.insertBefore(W,x.querySelector("head > title"))),Cs(W,b,C),W[Vt]=r,ne(W),b=W;break e;case"link":var L=eZ("link","href",x).get(b+(C.href||""));if(L){for(var re=0;re<L.length;re++)if(W=L[re],W.getAttribute("href")===(C.href==null||C.href===""?null:C.href)&&W.getAttribute("rel")===(C.rel==null?null:C.rel)&&W.getAttribute("title")===(C.title==null?null:C.title)&&W.getAttribute("crossorigin")===(C.crossOrigin==null?null:C.crossOrigin)){L.splice(re,1);break t}}W=x.createElement(b),Cs(W,b,C),x.head.appendChild(W);break;case"meta":if(L=eZ("meta","content",x).get(b+(C.content||""))){for(re=0;re<L.length;re++)if(W=L[re],W.getAttribute("content")===(C.content==null?null:""+C.content)&&W.getAttribute("name")===(C.name==null?null:C.name)&&W.getAttribute("property")===(C.property==null?null:C.property)&&W.getAttribute("http-equiv")===(C.httpEquiv==null?null:C.httpEquiv)&&W.getAttribute("charset")===(C.charSet==null?null:C.charSet)){L.splice(re,1);break t}}W=x.createElement(b),Cs(W,b,C),x.head.appendChild(W);break;default:throw Error(n(468,b))}W[Vt]=r,ne(W),b=W}r.stateNode=b}else tZ(x,r.type,r.stateNode);else r.stateNode=$x(x,b,r.memoizedProps);else W!==b?(W===null?C.stateNode!==null&&(C=C.stateNode,C.parentNode.removeChild(C)):W.count--,b===null?tZ(x,r.type,r.stateNode):$x(x,b,r.memoizedProps)):b===null&&r.stateNode!==null&&_o(r,r.memoizedProps,C.memoizedProps)}break;case 27:is(g,r),Ji(r),b&512&&(Mi||C===null||ro(C,C.return)),C!==null&&b&4&&_o(r,r.memoizedProps,C.memoizedProps);break;case 5:if(is(g,r),Ji(r),b&512&&(Mi||C===null||ro(C,C.return)),r.flags&32){x=r.stateNode;try{Yi(x,"")}catch(on){vi(r,r.return,on)}}b&4&&r.stateNode!=null&&(x=r.memoizedProps,_o(r,x,C!==null?C.memoizedProps:x)),b&1024&&(Il=!0);break;case 6:if(is(g,r),Ji(r),b&4){if(r.stateNode===null)throw Error(n(162));b=r.memoizedProps,C=r.stateNode;try{C.nodeValue=b}catch(on){vi(r,r.return,on)}}break;case 3:if(kp=null,x=_s,_s=zp(g.containerInfo),is(g,r),_s=x,Ji(r),b&4&&C!==null&&C.memoizedState.isDehydrated)try{bh(g.containerInfo)}catch(on){vi(r,r.return,on)}Il&&(Il=!1,Yp(r));break;case 4:b=_s,_s=zp(r.stateNode.containerInfo),is(g,r),Ji(r),_s=b;break;case 12:is(g,r),Ji(r);break;case 31:is(g,r),Ji(r),b&4&&(b=r.updateQueue,b!==null&&(r.updateQueue=null,na(r,b)));break;case 13:is(g,r),Ji(r),r.child.flags&8192&&r.memoizedState!==null!=(C!==null&&C.memoizedState!==null)&&(fl=z()),b&4&&(b=r.updateQueue,b!==null&&(r.updateQueue=null,na(r,b)));break;case 22:x=r.memoizedState!==null;var Se=C!==null&&C.memoizedState!==null,tt=Xo,mt=Mi;if(Xo=tt||x,Mi=mt||Se,is(g,r),Mi=mt,Xo=tt,Ji(r),b&8192)e:for(g=r.stateNode,g._visibility=x?g._visibility&-2:g._visibility|1,x&&(C===null||Se||Xo||Mi||ag(r)),C=null,g=r;;){if(g.tag===5||g.tag===26){if(C===null){Se=C=g;try{if(W=Se.stateNode,x)L=W.style,typeof L.setProperty=="function"?L.setProperty("display","none","important"):L.display="none";else{re=Se.stateNode;var Nt=Se.memoizedProps.style,at=Nt!=null&&Nt.hasOwnProperty("display")?Nt.display:null;re.style.display=at==null||typeof at=="boolean"?"":(""+at).trim()}}catch(on){vi(Se,Se.return,on)}}}else if(g.tag===6){if(C===null){Se=g;try{Se.stateNode.nodeValue=x?"":Se.memoizedProps}catch(on){vi(Se,Se.return,on)}}}else if(g.tag===18){if(C===null){Se=g;try{var ut=Se.stateNode;x?kx(ut,!0):kx(Se.stateNode,!1)}catch(on){vi(Se,Se.return,on)}}}else if((g.tag!==22&&g.tag!==23||g.memoizedState===null||g===r)&&g.child!==null){g.child.return=g,g=g.child;continue}if(g===r)break e;for(;g.sibling===null;){if(g.return===null||g.return===r)break e;C===g&&(C=null),g=g.return}C===g&&(C=null),g.sibling.return=g.return,g=g.sibling}b&4&&(b=r.updateQueue,b!==null&&(C=b.retryQueue,C!==null&&(b.retryQueue=null,na(r,C))));break;case 19:is(g,r),Ji(r),b&4&&(b=r.updateQueue,b!==null&&(r.updateQueue=null,na(r,b)));break;case 30:break;case 21:break;default:is(g,r),Ji(r)}}function Ji(r){var g=r.flags;if(g&2){try{for(var C,b=r.return;b!==null;){if(ga(b)){C=b;break}b=b.return}if(C==null)throw Error(n(160));switch(C.tag){case 27:var x=C.stateNode,W=Xr(r);li(r,W,x);break;case 5:var L=C.stateNode;C.flags&32&&(Yi(L,""),C.flags&=-33);var re=Xr(r);li(r,re,L);break;case 3:case 4:var Se=C.stateNode.containerInfo,tt=Xr(r);_n(r,tt,Se);break;default:throw Error(n(161))}}catch(mt){vi(r,r.return,mt)}r.flags&=-3}g&4096&&(r.flags&=-4097)}function Yp(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var g=r;Yp(g),g.tag===5&&g.flags&1024&&g.stateNode.reset(),r=r.sibling}}function hl(r,g){if(g.subtreeFlags&8772)for(g=g.child;g!==null;)_p(r,g.alternate,g),g=g.sibling}function ag(r){for(r=r.child;r!==null;){var g=r;switch(g.tag){case 0:case 11:case 14:case 15:Mo(4,g,g.return),ag(g);break;case 1:ro(g,g.return);var C=g.stateNode;typeof C.componentWillUnmount=="function"&&TA(g,g.return,C),ag(g);break;case 27:DA(g.stateNode);case 26:case 5:ro(g,g.return),ag(g);break;case 22:g.memoizedState===null&&ag(g);break;case 30:ag(g);break;default:ag(g)}r=r.sibling}}function gi(r,g,C){for(C=C&&(g.subtreeFlags&8772)!==0,g=g.child;g!==null;){var b=g.alternate,x=r,W=g,L=W.flags;switch(W.tag){case 0:case 11:case 15:gi(x,W,C),Mr(4,W);break;case 1:if(gi(x,W,C),b=W,x=b.stateNode,typeof x.componentDidMount=="function")try{x.componentDidMount()}catch(tt){vi(b,b.return,tt)}if(b=W,x=b.updateQueue,x!==null){var re=b.stateNode;try{var Se=x.shared.hiddenCallbacks;if(Se!==null)for(x.shared.hiddenCallbacks=null,x=0;x<Se.length;x++)Rr(Se[x],re)}catch(tt){vi(b,b.return,tt)}}C&&L&64&&oc(W),_r(W,W.return);break;case 27:ta(W);case 26:case 5:gi(x,W,C),C&&b===null&&L&4&&lo(W),_r(W,W.return);break;case 12:gi(x,W,C);break;case 31:gi(x,W,C),C&&L&4&&ch(x,W);break;case 13:gi(x,W,C),C&&L&4&&zA(x,W);break;case 22:W.memoizedState===null&&gi(x,W,C),_r(W,W.return);break;case 30:break;default:gi(x,W,C)}g=g.sibling}}function gh(r,g){var C=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(C=r.memoizedState.cachePool.pool),r=null,g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(r=g.memoizedState.cachePool.pool),r!==C&&(r!=null&&r.refCount++,C!=null&&Ta(C))}function Cl(r,g){r=null,g.alternate!==null&&(r=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==r&&(g.refCount++,r!=null&&Ta(r))}function ba(r,g,C,b){if(g.subtreeFlags&10256)for(g=g.child;g!==null;)Ti(r,g,C,b),g=g.sibling}function Ti(r,g,C,b){var x=g.flags;switch(g.tag){case 0:case 11:case 15:ba(r,g,C,b),x&2048&&Mr(9,g);break;case 1:ba(r,g,C,b);break;case 3:ba(r,g,C,b),x&2048&&(r=null,g.alternate!==null&&(r=g.alternate.memoizedState.cache),g=g.memoizedState.cache,g!==r&&(g.refCount++,r!=null&&Ta(r)));break;case 12:if(x&2048){ba(r,g,C,b),r=g.stateNode;try{var W=g.memoizedProps,L=W.id,re=W.onPostCommit;typeof re=="function"&&re(L,g.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(Se){vi(g,g.return,Se)}}else ba(r,g,C,b);break;case 31:ba(r,g,C,b);break;case 13:ba(r,g,C,b);break;case 23:break;case 22:W=g.stateNode,L=g.alternate,g.memoizedState!==null?W._visibility&2?ba(r,g,C,b):ou(r,g):W._visibility&2?ba(r,g,C,b):(W._visibility|=2,cc(r,g,C,b,(g.subtreeFlags&10256)!==0||!1)),x&2048&&gh(L,g);break;case 24:ba(r,g,C,b),x&2048&&Cl(g.alternate,g);break;default:ba(r,g,C,b)}}function cc(r,g,C,b,x){for(x=x&&((g.subtreeFlags&10256)!==0||!1),g=g.child;g!==null;){var W=r,L=g,re=C,Se=b,tt=L.flags;switch(L.tag){case 0:case 11:case 15:cc(W,L,re,Se,x),Mr(8,L);break;case 23:break;case 22:var mt=L.stateNode;L.memoizedState!==null?mt._visibility&2?cc(W,L,re,Se,x):ou(W,L):(mt._visibility|=2,cc(W,L,re,Se,x)),x&&tt&2048&&gh(L.alternate,L);break;case 24:cc(W,L,re,Se,x),x&&tt&2048&&Cl(L.alternate,L);break;default:cc(W,L,re,Se,x)}g=g.sibling}}function ou(r,g){if(g.subtreeFlags&10256)for(g=g.child;g!==null;){var C=r,b=g,x=b.flags;switch(b.tag){case 22:ou(C,b),x&2048&&gh(b.alternate,b);break;case 24:ou(C,b),x&2048&&Cl(b.alternate,b);break;default:ou(C,b)}g=g.sibling}}var Pi=8192;function sg(r,g,C){if(r.subtreeFlags&Pi)for(r=r.child;r!==null;)ia(r,g,C),r=r.sibling}function ia(r,g,C){switch(r.tag){case 26:sg(r,g,C),r.flags&Pi&&r.memoizedState!==null&&u5(C,_s,r.memoizedState,r.memoizedProps);break;case 5:sg(r,g,C);break;case 3:case 4:var b=_s;_s=zp(r.stateNode.containerInfo),sg(r,g,C),_s=b;break;case 22:r.memoizedState===null&&(b=r.alternate,b!==null&&b.memoizedState!==null?(b=Pi,Pi=16777216,sg(r,g,C),Pi=b):sg(r,g,C));break;default:sg(r,g,C)}}function Xs(r){var g=r.alternate;if(g!==null&&(r=g.child,r!==null)){g.child=null;do g=r.sibling,r.sibling=null,r=g;while(r!==null)}}function Is(r){var g=r.deletions;if((r.flags&16)!==0){if(g!==null)for(var C=0;C<g.length;C++){var b=g[C];ji=b,Sd(b,r)}Xs(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)og(r),r=r.sibling}function og(r){switch(r.tag){case 0:case 11:case 15:Is(r),r.flags&2048&&Mo(9,r,r.return);break;case 3:Is(r);break;case 12:Is(r);break;case 22:var g=r.stateNode;r.memoizedState!==null&&g._visibility&2&&(r.return===null||r.return.tag!==13)?(g._visibility&=-3,uh(r)):Is(r);break;default:Is(r)}}function uh(r){var g=r.deletions;if((r.flags&16)!==0){if(g!==null)for(var C=0;C<g.length;C++){var b=g[C];ji=b,Sd(b,r)}Xs(r)}for(r=r.child;r!==null;){switch(g=r,g.tag){case 0:case 11:case 15:Mo(8,g,g.return),uh(g);break;case 22:C=g.stateNode,C._visibility&2&&(C._visibility&=-3,uh(g));break;default:uh(g)}r=r.sibling}}function Sd(r,g){for(;ji!==null;){var C=ji;switch(C.tag){case 0:case 11:case 15:Mo(8,C,g);break;case 23:case 22:if(C.memoizedState!==null&&C.memoizedState.cachePool!==null){var b=C.memoizedState.cachePool.pool;b!=null&&b.refCount++}break;case 24:Ta(C.memoizedState.cache)}if(b=C.child,b!==null)b.return=C,ji=b;else e:for(C=r;ji!==null;){b=ji;var x=b.sibling,W=b.return;if(lh(b),b===C){ji=null;break e}if(x!==null){x.return=W,ji=x;break e}ji=W}}}var dh={getCacheForType:function(r){var g=Wa(gn),C=g.data.get(r);return C===void 0&&(C=r(),g.data.set(r,C)),C},cacheSignal:function(){return Wa(gn).controller.signal}},Ih=typeof WeakMap=="function"?WeakMap:Map,Qn=0,ui=null,Xn=null,Dn=0,un=0,Ln=null,Nn=!1,En=!1,pi=!1,aa=0,di=0,co=0,Al=0,ar=0,qn=0,go=0,sr=null,as=null,Ys=!1,fl=0,ru=0,uo=1/0,lu=null,Yr=null,zi=0,or=null,Io=null,Yo=0,ml=0,rg=null,hh=null,lg=0,cg=null;function hs(){return(Qn&2)!==0&&Dn!==0?Dn&-Dn:F.T!==null?Hv():Mt()}function d(){if(qn===0)if((Dn&536870912)===0||jn){var r=lt;lt<<=1,(lt&3932160)===0&&(lt=262144),qn=r}else qn=536870912;return r=pa.current,r!==null&&(r.flags|=32),qn}function I(r,g,C){(r===ui&&(un===2||un===9)||r.cancelPendingCommit!==null)&&(Ue(r,0),K(r,Dn,qn,!1)),Rn(r,C),((Qn&2)===0||r!==ui)&&(r===ui&&((Qn&2)===0&&(Al|=C),di===4&&K(r,Dn,qn,!1)),gc(r))}function v(r,g,C){if((Qn&6)!==0)throw Error(n(327));var b=!C&&(g&127)===0&&(g&r.expiredLanes)===0||vt(r,g),x=b?gg(r,g):Hs(r,g,!0),W=b;do{if(x===0){En&&!b&&K(r,g,0,!1);break}else{if(C=r.current.alternate,W&&!_(C)){x=Hs(r,g,!1),W=!1;continue}if(x===2){if(W=g,r.errorRecoveryDisabledLanes&W)var L=0;else L=r.pendingLanes&-536870913,L=L!==0?L:L&536870912?536870912:0;if(L!==0){g=L;e:{var re=r;x=sr;var Se=re.current.memoizedState.isDehydrated;if(Se&&(Ue(re,L).flags|=256),L=Hs(re,L,!1),L!==2){if(pi&&!Se){re.errorRecoveryDisabledLanes|=W,Al|=W,x=4;break e}W=as,as=x,W!==null&&(as===null?as=W:as.push.apply(as,W))}x=L}if(W=!1,x!==2)continue}}if(x===1){Ue(r,0),K(r,g,0,!0);break}e:{switch(b=r,W=x,W){case 0:case 1:throw Error(n(345));case 4:if((g&4194048)!==g)break;case 6:K(b,g,qn,!Nn);break e;case 2:as=null;break;case 3:case 5:break;default:throw Error(n(329))}if((g&62914560)===g&&(x=fl+300-z(),10<x)){if(K(b,g,qn,!Nn),qe(b,0,!0)!==0)break e;Yo=g,b.timeoutHandle=Tx(Z.bind(null,b,C,as,lu,Ys,g,qn,Al,go,Nn,W,"Throttled",-0,0),x);break e}Z(b,C,as,lu,Ys,g,qn,Al,go,Nn,W,null,-0,0)}}break}while(!0);gc(r)}function Z(r,g,C,b,x,W,L,re,Se,tt,mt,Nt,at,ut){if(r.timeoutHandle=-1,Nt=g.subtreeFlags,Nt&8192||(Nt&16785408)===16785408){Nt={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Ea},ia(g,W,Nt);var on=(W&62914560)===W?fl-z():(W&4194048)===W?ru-z():0;if(on=d5(Nt,on),on!==null){Yo=W,r.cancelPendingCommit=on(Bn.bind(null,r,g,W,C,b,x,L,re,Se,mt,Nt,null,at,ut)),K(r,W,L,!tt);return}}Bn(r,g,W,C,b,x,L,re,Se)}function _(r){for(var g=r;;){var C=g.tag;if((C===0||C===11||C===15)&&g.flags&16384&&(C=g.updateQueue,C!==null&&(C=C.stores,C!==null)))for(var b=0;b<C.length;b++){var x=C[b],W=x.getSnapshot;x=x.value;try{if(!Wi(W(),x))return!1}catch{return!1}}if(C=g.child,g.subtreeFlags&16384&&C!==null)C.return=g,g=C;else{if(g===r)break;for(;g.sibling===null;){if(g.return===null||g.return===r)return!0;g=g.return}g.sibling.return=g.return,g=g.sibling}}return!0}function K(r,g,C,b){g&=~ar,g&=~Al,r.suspendedLanes|=g,r.pingedLanes&=~g,b&&(r.warmLanes|=g),b=r.expirationTimes;for(var x=g;0<x;){var W=31-he(x),L=1<<W;b[W]=-1,x&=~L}C!==0&&Ci(r,C,g)}function ge(){return(Qn&6)===0?(LA(0),!1):!0}function Be(){if(Xn!==null){if(un===0)var r=Xn.return;else r=Xn,$a=al=null,pA(r),ql=null,$l=0,r=Xn;for(;r!==null;)ig(r.alternate,r),r=r.return;Xn=null}}function Ue(r,g){var C=r.timeoutHandle;C!==-1&&(r.timeoutHandle=-1,jM(C)),C=r.cancelPendingCommit,C!==null&&(r.cancelPendingCommit=null,C()),Yo=0,Be(),ui=r,Xn=C=Gr(r.current,null),Dn=g,un=0,Ln=null,Nn=!1,En=vt(r,g),pi=!1,go=qn=ar=Al=co=di=0,as=sr=null,Ys=!1,(g&8)!==0&&(g|=g&32);var b=r.entangledLanes;if(b!==0)for(r=r.entanglements,b&=g;0<b;){var x=31-he(b),W=1<<x;g|=r[x],b&=~W}return aa=g,Ul(),C}function Bt(r,g){Gn=null,F.H=Id,g===Ql||g===er?(g=zI(),un=3):g===id?(g=zI(),un=4):un=g===sh?8:g!==null&&typeof g=="object"&&typeof g.then=="function"?6:1,Ln=g,Xn===null&&(di=1,ah(r,ws(g,r.current)))}function Dt(){var r=pa.current;return r===null?!0:(Dn&4194048)===Dn?No===null:(Dn&62914560)===Dn||(Dn&536870912)!==0?r===No:!1}function en(){var r=F.H;return F.H=Id,r===null?Id:r}function nn(){var r=F.A;return F.A=dh,r}function wn(){di=4,Nn||(Dn&4194048)!==Dn&&pa.current!==null||(En=!0),(co&134217727)===0&&(Al&134217727)===0||ui===null||K(ui,Dn,qn,!1)}function Hs(r,g,C){var b=Qn;Qn|=2;var x=en(),W=nn();(ui!==r||Dn!==g)&&(lu=null,Ue(r,g)),g=!1;var L=di;e:do try{if(un!==0&&Xn!==null){var re=Xn,Se=Ln;switch(un){case 8:Be(),L=6;break e;case 3:case 2:case 9:case 6:pa.current===null&&(g=!0);var tt=un;if(un=0,Ln=null,zt(r,re,Se,tt),C&&En){L=0;break e}break;default:tt=un,un=0,Ln=null,zt(r,re,Se,tt)}}xd(),L=di;break}catch(mt){Bt(r,mt)}while(!0);return g&&r.shellSuspendCounter++,$a=al=null,Qn=b,F.H=x,F.A=W,Xn===null&&(ui=null,Dn=0,Ul()),L}function xd(){for(;Xn!==null;)Te(Xn)}function gg(r,g){var C=Qn;Qn|=2;var b=en(),x=nn();ui!==r||Dn!==g?(lu=null,uo=z()+500,Ue(r,g)):En=vt(r,g);e:do try{if(un!==0&&Xn!==null){g=Xn;var W=Ln;t:switch(un){case 1:un=0,Ln=null,zt(r,g,W,1);break;case 2:case 9:if(rp(W)){un=0,Ln=null,rt(g);break}g=function(){un!==2&&un!==9||ui!==r||(un=7),gc(r)},W.then(g,g);break e;case 3:un=7;break e;case 4:un=5;break e;case 7:rp(W)?(un=0,Ln=null,rt(g)):(un=0,Ln=null,zt(r,g,W,7));break;case 5:var L=null;switch(Xn.tag){case 26:L=Xn.memoizedState;case 5:case 27:var re=Xn;if(L?nZ(L):re.stateNode.complete){un=0,Ln=null;var Se=re.sibling;if(Se!==null)Xn=Se;else{var tt=re.return;tt!==null?(Xn=tt,cn(tt)):Xn=null}break t}}un=0,Ln=null,zt(r,g,W,5);break;case 6:un=0,Ln=null,zt(r,g,W,6);break;case 8:Be(),di=6;break e;default:throw Error(n(462))}}nt();break}catch(mt){Bt(r,mt)}while(!0);return $a=al=null,F.H=b,F.A=x,Qn=C,Xn!==null?0:(ui=null,Dn=0,Ul(),di)}function nt(){for(;Xn!==null&&!st();)Te(Xn)}function Te(r){var g=oh(r.alternate,r,aa);r.memoizedProps=r.pendingProps,g===null?cn(r):Xn=g}function rt(r){var g=r,C=g.alternate;switch(g.tag){case 15:case 0:g=ts(C,g,g.pendingProps,g.type,void 0,Dn);break;case 11:g=ts(C,g,g.pendingProps,g.type.render,g.ref,Dn);break;case 5:pA(g);default:ig(C,g),g=Xn=qa(g,aa),g=oh(C,g,aa)}r.memoizedProps=r.pendingProps,g===null?cn(r):Xn=g}function zt(r,g,C,b){$a=al=null,pA(g),ql=null,$l=0;var x=g.return;try{if(no(r,x,g,C,Dn)){di=1,ah(r,ws(C,r.current)),Xn=null;return}}catch(W){if(x!==null)throw Xn=x,W;di=1,ah(r,ws(C,r.current)),Xn=null;return}g.flags&32768?(jn||b===1?r=!0:En||(Dn&536870912)!==0?r=!1:(Nn=r=!0,(b===2||b===9||b===3||b===6)&&(b=pa.current,b!==null&&b.tag===13&&(b.flags|=16384))),Bi(g,r)):cn(g)}function cn(r){var g=r;do{if((g.flags&32768)!==0){Bi(g,Nn);return}r=g.return;var C=KA(g.alternate,g,aa);if(C!==null){Xn=C;return}if(g=g.sibling,g!==null){Xn=g;return}Xn=g=r}while(g!==null);di===0&&(di=5)}function Bi(r,g){do{var C=rh(r.alternate,r);if(C!==null){C.flags&=32767,Xn=C;return}if(C=r.return,C!==null&&(C.flags|=32768,C.subtreeFlags=0,C.deletions=null),!g&&(r=r.sibling,r!==null)){Xn=r;return}Xn=r=C}while(r!==null);di=6,Xn=null}function Bn(r,g,C,b,x,W,L,re,Se){r.cancelPendingCommit=null;do Ch();while(zi!==0);if((Qn&6)!==0)throw Error(n(327));if(g!==null){if(g===r.current)throw Error(n(177));if(W=g.lanes|g.childLanes,W|=_I,Kn(r,C,W,L,re,Se),r===ui&&(Xn=ui=null,Dn=0),Io=g,or=r,Yo=C,ml=W,rg=x,hh=b,(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,XM(Me,function(){return Bx(),null})):(r.callbackNode=null,r.callbackPriority=0),b=(g.flags&13878)!==0,(g.subtreeFlags&13878)!==0||b){b=F.T,F.T=null,x=j.p,j.p=2,L=Qn,Qn|=4;try{su(r,g,C)}finally{Qn=L,j.p=x,F.T=b}}zi=1,si(),ya(),oi()}}function si(){if(zi===1){zi=0;var r=or,g=Io,C=(g.flags&13878)!==0;if((g.subtreeFlags&13878)!==0||C){C=F.T,F.T=null;var b=j.p;j.p=2;var x=Qn;Qn|=4;try{lc(g,r);var W=Uv,L=RI(r.containerInfo),re=W.focusedElem,Se=W.selectionRange;if(L!==re&&re&&re.ownerDocument&&wI(re.ownerDocument.documentElement,re)){if(Se!==null&&Eg(re)){var tt=Se.start,mt=Se.end;if(mt===void 0&&(mt=tt),"selectionStart"in re)re.selectionStart=tt,re.selectionEnd=Math.min(mt,re.value.length);else{var Nt=re.ownerDocument||document,at=Nt&&Nt.defaultView||window;if(at.getSelection){var ut=at.getSelection(),on=re.textContent.length,vn=Math.min(Se.start,on),xi=Se.end===void 0?vn:Math.min(Se.end,on);!ut.extend&&vn>xi&&(L=xi,xi=vn,vn=L);var ze=jC(re,vn),_e=jC(re,xi);if(ze&&_e&&(ut.rangeCount!==1||ut.anchorNode!==ze.node||ut.anchorOffset!==ze.offset||ut.focusNode!==_e.node||ut.focusOffset!==_e.offset)){var et=Nt.createRange();et.setStart(ze.node,ze.offset),ut.removeAllRanges(),vn>xi?(ut.addRange(et),ut.extend(_e.node,_e.offset)):(et.setEnd(_e.node,_e.offset),ut.addRange(et))}}}}for(Nt=[],ut=re;ut=ut.parentNode;)ut.nodeType===1&&Nt.push({element:ut,left:ut.scrollLeft,top:ut.scrollTop});for(typeof re.focus=="function"&&re.focus(),re=0;re<Nt.length;re++){var Rt=Nt[re];Rt.element.scrollLeft=Rt.left,Rt.element.scrollTop=Rt.top}}jp=!!kv,Uv=kv=null}finally{Qn=x,j.p=b,F.T=C}}r.current=g,zi=2}}function ya(){if(zi===2){zi=0;var r=or,g=Io,C=(g.flags&8772)!==0;if((g.subtreeFlags&8772)!==0||C){C=F.T,F.T=null;var b=j.p;j.p=2;var x=Qn;Qn|=4;try{_p(r,g.alternate,g)}finally{Qn=x,j.p=b,F.T=C}}zi=3}}function oi(){if(zi===4||zi===3){zi=0,ie();var r=or,g=Io,C=Yo,b=hh;(g.subtreeFlags&10256)!==0||(g.flags&10256)!==0?zi=5:(zi=0,Io=or=null,pl(r,r.pendingLanes));var x=r.pendingLanes;if(x===0&&(Yr=null),Zt(C),g=g.stateNode,je&&typeof je.onCommitFiberRoot=="function")try{je.onCommitFiberRoot(Pe,g,void 0,(g.current.flags&128)===128)}catch{}if(b!==null){g=F.T,x=j.p,j.p=2,F.T=null;try{for(var W=r.onRecoverableError,L=0;L<b.length;L++){var re=b[L];W(re.value,{componentStack:re.stack})}}finally{F.T=g,j.p=x}}(Yo&3)!==0&&Ch(),gc(r),x=r.pendingLanes,(C&261930)!==0&&(x&42)!==0?r===cg?lg++:(lg=0,cg=r):lg=0,LA(0)}}function pl(r,g){(r.pooledCacheLanes&=g)===0&&(g=r.pooledCache,g!=null&&(r.pooledCache=null,Ta(g)))}function Ch(){return si(),ya(),oi(),Bx()}function Bx(){if(zi!==5)return!1;var r=or,g=ml;ml=0;var C=Zt(Yo),b=F.T,x=j.p;try{j.p=32>C?32:C,F.T=null,C=rg,rg=null;var W=or,L=Yo;if(zi=0,Io=or=null,Yo=0,(Qn&6)!==0)throw Error(n(331));var re=Qn;if(Qn|=4,og(W.current),Ti(W,W.current,L,C),Qn=re,LA(0,!1),je&&typeof je.onPostCommitFiberRoot=="function")try{je.onPostCommitFiberRoot(Pe,W)}catch{}return!0}finally{j.p=x,F.T=b,pl(r,g)}}function Sx(r,g,C){g=ws(C,g),g=FA(r.stateNode,g,2),r=ll(r,g,2),r!==null&&(Rn(r,2),gc(r))}function vi(r,g,C){if(r.tag===3)Sx(r,r,C);else for(;g!==null;){if(g.tag===3){Sx(g,r,C);break}else if(g.tag===1){var b=g.stateNode;if(typeof g.type.getDerivedStateFromError=="function"||typeof b.componentDidCatch=="function"&&(Yr===null||!Yr.has(b))){r=ws(C,r),C=eu(2),b=ll(g,C,2),b!==null&&(Vs(C,b,g,r),Rn(b,2),gc(b));break}}g=g.return}}function _v(r,g,C){var b=r.pingCache;if(b===null){b=r.pingCache=new Ih;var x=new Set;b.set(g,x)}else x=b.get(g),x===void 0&&(x=new Set,b.set(g,x));x.has(C)||(pi=!0,x.add(C),r=VM.bind(null,r,g,C),g.then(r,r))}function VM(r,g,C){var b=r.pingCache;b!==null&&b.delete(g),r.pingedLanes|=r.suspendedLanes&C,r.warmLanes&=~C,ui===r&&(Dn&C)===C&&(di===4||di===3&&(Dn&62914560)===Dn&&300>z()-fl?(Qn&2)===0&&Ue(r,0):ar|=C,go===Dn&&(go=0)),gc(r)}function xx(r,g){g===0&&(g=Ot()),r=Dl(r,g),r!==null&&(Rn(r,g),gc(r))}function MM(r){var g=r.memoizedState,C=0;g!==null&&(C=g.retryLane),xx(r,C)}function _M(r,g){var C=0;switch(r.tag){case 31:case 13:var b=r.stateNode,x=r.memoizedState;x!==null&&(C=x.retryLane);break;case 19:b=r.stateNode;break;case 22:b=r.stateNode._retryCache;break;default:throw Error(n(314))}b!==null&&b.delete(g),xx(r,C)}function XM(r,g){return it(r,g)}var Hp=null,Ah=null,Xv=!1,Ep=!1,Yv=!1,cu=0;function gc(r){r!==Ah&&r.next===null&&(Ah===null?Hp=Ah=r:Ah=Ah.next=r),Ep=!0,Xv||(Xv=!0,HM())}function LA(r,g){if(!Yv&&Ep){Yv=!0;do for(var C=!1,b=Hp;b!==null;){if(r!==0){var x=b.pendingLanes;if(x===0)var W=0;else{var L=b.suspendedLanes,re=b.pingedLanes;W=(1<<31-he(42|r)+1)-1,W&=x&~(L&~re),W=W&201326741?W&201326741|1:W?W|2:0}W!==0&&(C=!0,Nx(b,W))}else W=Dn,W=qe(b,b===ui?W:0,b.cancelPendingCommit!==null||b.timeoutHandle!==-1),(W&3)===0||vt(b,W)||(C=!0,Nx(b,W));b=b.next}while(C);Yv=!1}}function YM(){Zx()}function Zx(){Ep=Xv=!1;var r=0;cu!==0&&OM()&&(r=cu);for(var g=z(),C=null,b=Hp;b!==null;){var x=b.next,W=wx(b,g);W===0?(b.next=null,C===null?Hp=x:C.next=x,x===null&&(Ah=C)):(C=b,(r!==0||(W&3)!==0)&&(Ep=!0)),b=x}zi!==0&&zi!==5||LA(r),cu!==0&&(cu=0)}function wx(r,g){for(var C=r.suspendedLanes,b=r.pingedLanes,x=r.expirationTimes,W=r.pendingLanes&-62914561;0<W;){var L=31-he(W),re=1<<L,Se=x[L];Se===-1?((re&C)===0||(re&b)!==0)&&(x[L]=Ut(re,g)):Se<=g&&(r.expiredLanes|=re),W&=~re}if(g=ui,C=Dn,C=qe(r,r===g?C:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),b=r.callbackNode,C===0||r===g&&(un===2||un===9)||r.cancelPendingCommit!==null)return b!==null&&b!==null&&Fe(b),r.callbackNode=null,r.callbackPriority=0;if((C&3)===0||vt(r,C)){if(g=C&-C,g===r.callbackPriority)return g;switch(b!==null&&Fe(b),Zt(C)){case 2:case 8:C=He;break;case 32:C=Me;break;case 268435456:C=ft;break;default:C=Me}return b=Rx.bind(null,r),C=it(C,b),r.callbackPriority=g,r.callbackNode=C,g}return b!==null&&b!==null&&Fe(b),r.callbackPriority=2,r.callbackNode=null,2}function Rx(r,g){if(zi!==0&&zi!==5)return r.callbackNode=null,r.callbackPriority=0,null;var C=r.callbackNode;if(Ch()&&r.callbackNode!==C)return null;var b=Dn;return b=qe(r,r===ui?b:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),b===0?null:(v(r,b,g),wx(r,z()),r.callbackNode!=null&&r.callbackNode===C?Rx.bind(null,r):null)}function Nx(r,g){if(Ch())return null;v(r,g,!0)}function HM(){JM(function(){(Qn&6)!==0?it(Oe,YM):Zx()})}function Hv(){if(cu===0){var r=rl;r===0&&(r=Re,Re<<=1,(Re&261888)===0&&(Re=256)),cu=r}return cu}function Wx(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:So(""+r)}function Vx(r,g){var C=g.ownerDocument.createElement("input");return C.name=g.name,C.value=g.value,r.id&&C.setAttribute("form",r.id),g.parentNode.insertBefore(C,g),r=new FormData(r),C.parentNode.removeChild(C),r}function EM(r,g,C,b,x){if(g==="submit"&&C&&C.stateNode===x){var W=Wx((x[U]||null).action),L=b.submitter;L&&(g=(g=L[U]||null)?Wx(g.formAction):L.getAttribute("formAction"),g!==null&&(W=g,L=null));var re=new Qr("action","action",null,b,x);r.push({event:re,listeners:[{instance:null,listener:function(){if(b.defaultPrevented){if(cu!==0){var Se=L?Vx(x,L):new FormData(x);_A(C,{pending:!0,data:Se,method:x.method,action:W},null,Se)}}else typeof W=="function"&&(re.preventDefault(),Se=L?Vx(x,L):new FormData(x),_A(C,{pending:!0,data:Se,method:x.method,action:W},W,Se))},currentTarget:x}]})}}for(var Ev=0;Ev<MI.length;Ev++){var Fv=MI[Ev],FM=Fv.toLowerCase(),KM=Fv[0].toUpperCase()+Fv.slice(1);Qa(FM,"on"+KM)}Qa(Zs,"onAnimationEnd"),Qa(JC,"onAnimationIteration"),Qa(vr,"onAnimationStart"),Qa("dblclick","onDoubleClick"),Qa("focusin","onFocus"),Qa("focusout","onBlur"),Qa(zg,"onTransitionRun"),Qa(Ll,"onTransitionStart"),Qa(PC,"onTransitionCancel"),Qa(VI,"onTransitionEnd"),Ze("onMouseEnter",["mouseout","mouseover"]),Ze("onMouseLeave",["mouseout","mouseover"]),Ze("onPointerEnter",["pointerout","pointerover"]),Ze("onPointerLeave",["pointerout","pointerover"]),We("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),We("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),We("onBeforeInput",["compositionend","keypress","textInput","paste"]),We("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),We("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),We("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var kA="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),TM=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(kA));function Mx(r,g){g=(g&4)!==0;for(var C=0;C<r.length;C++){var b=r[C],x=b.event;b=b.listeners;e:{var W=void 0;if(g)for(var L=b.length-1;0<=L;L--){var re=b[L],Se=re.instance,tt=re.currentTarget;if(re=re.listener,Se!==W&&x.isPropagationStopped())break e;W=re,x.currentTarget=tt;try{W(x)}catch(mt){kl(mt)}x.currentTarget=null,W=Se}else for(L=0;L<b.length;L++){if(re=b[L],Se=re.instance,tt=re.currentTarget,re=re.listener,Se!==W&&x.isPropagationStopped())break e;W=re,x.currentTarget=tt;try{W(x)}catch(mt){kl(mt)}x.currentTarget=null,W=Se}}}}function Jn(r,g){var C=g[pe];C===void 0&&(C=g[pe]=new Set);var b=r+"__bubble";C.has(b)||(_x(g,r,2,!1),C.add(b))}function Kv(r,g,C){var b=0;g&&(b|=4),_x(C,r,b,g)}var Fp="_reactListening"+Math.random().toString(36).slice(2);function Tv(r){if(!r[Fp]){r[Fp]=!0,ve.forEach(function(C){C!=="selectionchange"&&(TM.has(C)||Kv(C,!1,r),Kv(C,!0,r))});var g=r.nodeType===9?r:r.ownerDocument;g===null||g[Fp]||(g[Fp]=!0,Kv("selectionchange",!1,g))}}function _x(r,g,C,b){switch(cZ(g)){case 2:var x=C5;break;case 8:x=A5;break;default:x=nG}C=x.bind(null,g,C,r),x=void 0,!Pa||g!=="touchstart"&&g!=="touchmove"&&g!=="wheel"||(x=!0),b?x!==void 0?r.addEventListener(g,C,{capture:!0,passive:x}):r.addEventListener(g,C,!0):x!==void 0?r.addEventListener(g,C,{passive:x}):r.addEventListener(g,C,!1)}function zv(r,g,C,b,x){var W=b;if((g&1)===0&&(g&2)===0&&b!==null)e:for(;;){if(b===null)return;var L=b.tag;if(L===3||L===4){var re=b.stateNode.containerInfo;if(re===x)break;if(L===4)for(L=b.return;L!==null;){var Se=L.tag;if((Se===3||Se===4)&&L.stateNode.containerInfo===x)return;L=L.return}for(;re!==null;){if(L=bt(re),L===null)return;if(Se=L.tag,Se===5||Se===6||Se===26||Se===27){b=W=L;continue e}re=re.parentNode}}b=b.return}Yl(function(){var tt=W,mt=_c(C),Nt=[];e:{var at=el.get(r);if(at!==void 0){var ut=Qr,on=r;switch(r){case"keypress":if(pr(C)===0)break e;case"keydown":case"keyup":ut=EC;break;case"focusin":on="focus",ut=Vg;break;case"focusout":on="blur",ut=Vg;break;case"beforeblur":case"afterblur":ut=Vg;break;case"click":if(C.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ut=GI;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ut=Kc;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ut=qr;break;case Zs:case JC:case vr:ut=xs;break;case VI:ut=xv;break;case"scroll":case"scrollend":ut=br;break;case"wheel":ut=Hl;break;case"copy":case"cut":case"paste":ut=wo;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ut=BI;break;case"toggle":case"beforetoggle":ut=KC}var vn=(g&4)!==0,xi=!vn&&(r==="scroll"||r==="scrollend"),ze=vn?at!==null?at+"Capture":null:at;vn=[];for(var _e=tt,et;_e!==null;){var Rt=_e;if(et=Rt.stateNode,Rt=Rt.tag,Rt!==5&&Rt!==26&&Rt!==27||et===null||ze===null||(Rt=Do(_e,ze),Rt!=null&&vn.push(UA(_e,Rt,et))),xi)break;_e=_e.return}0<vn.length&&(at=new ut(at,on,null,C,mt),Nt.push({event:at,listeners:vn}))}}if((g&7)===0){e:{if(at=r==="mouseover"||r==="pointerover",ut=r==="mouseout"||r==="pointerout",at&&C!==Uo&&(on=C.relatedTarget||C.fromElement)&&(bt(on)||on[te]))break e;if((ut||at)&&(at=mt.window===mt?mt:(at=mt.ownerDocument)?at.defaultView||at.parentWindow:window,ut?(on=C.relatedTarget||C.toElement,ut=tt,on=on?bt(on):null,on!==null&&(xi=s(on),vn=on.tag,on!==xi||vn!==5&&vn!==27&&vn!==6)&&(on=null)):(ut=null,on=tt),ut!==on)){if(vn=GI,Rt="onMouseLeave",ze="onMouseEnter",_e="mouse",(r==="pointerout"||r==="pointerover")&&(vn=BI,Rt="onPointerLeave",ze="onPointerEnter",_e="pointer"),xi=ut==null?at:_t(ut),et=on==null?at:_t(on),at=new vn(Rt,_e+"leave",ut,C,mt),at.target=xi,at.relatedTarget=et,Rt=null,bt(mt)===tt&&(vn=new vn(ze,_e+"enter",on,C,mt),vn.target=et,vn.relatedTarget=xi,Rt=vn),xi=Rt,ut&&on)t:{for(vn=zM,ze=ut,_e=on,et=0,Rt=ze;Rt;Rt=vn(Rt))et++;Rt=0;for(var An=_e;An;An=vn(An))Rt++;for(;0<et-Rt;)ze=vn(ze),et--;for(;0<Rt-et;)_e=vn(_e),Rt--;for(;et--;){if(ze===_e||_e!==null&&ze===_e.alternate){vn=ze;break t}ze=vn(ze),_e=vn(_e)}vn=null}else vn=null;ut!==null&&Xx(Nt,at,ut,vn,!1),on!==null&&xi!==null&&Xx(Nt,xi,on,vn,!0)}}e:{if(at=tt?_t(tt):window,ut=at.nodeName&&at.nodeName.toLowerCase(),ut==="select"||ut==="input"&&at.type==="file")var Ii=UC;else if(LC(at))if(ju)Ii=$m;else{Ii=Kl;var ln=Ju}else ut=at.nodeName,!ut||ut.toLowerCase()!=="input"||at.type!=="checkbox"&&at.type!=="radio"?tt&&fa(tt.elementType)&&(Ii=UC):Ii=qm;if(Ii&&(Ii=Ii(r,tt))){ZI(Nt,Ii,C,mt);break e}ln&&ln(r,at,tt),r==="focusout"&&tt&&at.type==="number"&&tt.memoizedProps.value!=null&&zn(at,"number",at.value)}switch(ln=tt?_t(tt):window,r){case"focusin":(LC(ln)||ln.contentEditable==="true")&&(Fg=ln,NI=tt,Kg=null);break;case"focusout":Kg=NI=Fg=null;break;case"mousedown":Qs=!0;break;case"contextmenu":case"mouseup":case"dragend":Qs=!1,WI(Nt,C,mt);break;case"selectionchange":if(ep)break;case"keydown":case"keyup":WI(Nt,C,mt)}var Fn;if(Tc)e:{switch(r){case"compositionstart":var $n="onCompositionStart";break e;case"compositionend":$n="onCompositionEnd";break e;case"compositionupdate":$n="onCompositionUpdate";break e}$n=void 0}else Fl?SI(r,C)&&($n="onCompositionEnd"):r==="keydown"&&C.keyCode===229&&($n="onCompositionStart");$n&&(Ka&&C.locale!=="ko"&&(Fl||$n!=="onCompositionStart"?$n==="onCompositionEnd"&&Fl&&(Fn=Ec()):(Oo=mt,Hc="value"in Oo?Oo.value:Oo.textContent,Fl=!0)),ln=Kp(tt,$n),0<ln.length&&($n=new _C($n,r,null,C,mt),Nt.push({event:$n,listeners:ln}),Fn?$n.data=Fn:(Fn=Mg(C),Fn!==null&&($n.data=Fn)))),(Fn=zc?xI(r,C):Jm(r,C))&&($n=Kp(tt,"onBeforeInput"),0<$n.length&&(ln=new _C("onBeforeInput","beforeinput",null,C,mt),Nt.push({event:ln,listeners:$n}),ln.data=Fn)),EM(Nt,r,tt,C,mt)}Mx(Nt,g)})}function UA(r,g,C){return{instance:r,listener:g,currentTarget:C}}function Kp(r,g){for(var C=g+"Capture",b=[];r!==null;){var x=r,W=x.stateNode;if(x=x.tag,x!==5&&x!==26&&x!==27||W===null||(x=Do(r,C),x!=null&&b.unshift(UA(r,x,W)),x=Do(r,g),x!=null&&b.push(UA(r,x,W))),r.tag===3)return b;r=r.return}return[]}function zM(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function Xx(r,g,C,b,x){for(var W=g._reactName,L=[];C!==null&&C!==b;){var re=C,Se=re.alternate,tt=re.stateNode;if(re=re.tag,Se!==null&&Se===b)break;re!==5&&re!==26&&re!==27||tt===null||(Se=tt,x?(tt=Do(C,W),tt!=null&&L.unshift(UA(C,tt,Se))):x||(tt=Do(C,W),tt!=null&&L.push(UA(C,tt,Se)))),C=C.return}L.length!==0&&r.push({event:g,listeners:L})}var LM=/\r\n?/g,kM=/\u0000|\uFFFD/g;function Yx(r){return(typeof r=="string"?r:""+r).replace(LM,`
`).replace(kM,"")}function Hx(r,g){return g=Yx(g),Yx(r)===g}function Si(r,g,C,b,x,W){switch(C){case"children":typeof b=="string"?g==="body"||g==="textarea"&&b===""||Yi(r,b):(typeof b=="number"||typeof b=="bigint")&&g!=="body"&&Yi(r,""+b);break;case"className":qt(r,"class",b);break;case"tabIndex":qt(r,"tabindex",b);break;case"dir":case"role":case"viewBox":case"width":case"height":qt(r,C,b);break;case"style":ko(r,b,W);break;case"data":if(g!=="object"){qt(r,"data",b);break}case"src":case"href":if(b===""&&(g!=="a"||C!=="href")){r.removeAttribute(C);break}if(b==null||typeof b=="function"||typeof b=="symbol"||typeof b=="boolean"){r.removeAttribute(C);break}b=So(""+b),r.setAttribute(C,b);break;case"action":case"formAction":if(typeof b=="function"){r.setAttribute(C,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof W=="function"&&(C==="formAction"?(g!=="input"&&Si(r,g,"name",x.name,x,null),Si(r,g,"formEncType",x.formEncType,x,null),Si(r,g,"formMethod",x.formMethod,x,null),Si(r,g,"formTarget",x.formTarget,x,null)):(Si(r,g,"encType",x.encType,x,null),Si(r,g,"method",x.method,x,null),Si(r,g,"target",x.target,x,null)));if(b==null||typeof b=="symbol"||typeof b=="boolean"){r.removeAttribute(C);break}b=So(""+b),r.setAttribute(C,b);break;case"onClick":b!=null&&(r.onclick=Ea);break;case"onScroll":b!=null&&Jn("scroll",r);break;case"onScrollEnd":b!=null&&Jn("scrollend",r);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(n(61));if(C=b.__html,C!=null){if(x.children!=null)throw Error(n(60));r.innerHTML=C}}break;case"multiple":r.multiple=b&&typeof b!="function"&&typeof b!="symbol";break;case"muted":r.muted=b&&typeof b!="function"&&typeof b!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(b==null||typeof b=="function"||typeof b=="boolean"||typeof b=="symbol"){r.removeAttribute("xlink:href");break}C=So(""+b),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",C);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":b!=null&&typeof b!="function"&&typeof b!="symbol"?r.setAttribute(C,""+b):r.removeAttribute(C);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":b&&typeof b!="function"&&typeof b!="symbol"?r.setAttribute(C,""):r.removeAttribute(C);break;case"capture":case"download":b===!0?r.setAttribute(C,""):b!==!1&&b!=null&&typeof b!="function"&&typeof b!="symbol"?r.setAttribute(C,b):r.removeAttribute(C);break;case"cols":case"rows":case"size":case"span":b!=null&&typeof b!="function"&&typeof b!="symbol"&&!isNaN(b)&&1<=b?r.setAttribute(C,b):r.removeAttribute(C);break;case"rowSpan":case"start":b==null||typeof b=="function"||typeof b=="symbol"||isNaN(b)?r.removeAttribute(C):r.setAttribute(C,b);break;case"popover":Jn("beforetoggle",r),Jn("toggle",r),Wt(r,"popover",b);break;case"xlinkActuate":Et(r,"http://www.w3.org/1999/xlink","xlink:actuate",b);break;case"xlinkArcrole":Et(r,"http://www.w3.org/1999/xlink","xlink:arcrole",b);break;case"xlinkRole":Et(r,"http://www.w3.org/1999/xlink","xlink:role",b);break;case"xlinkShow":Et(r,"http://www.w3.org/1999/xlink","xlink:show",b);break;case"xlinkTitle":Et(r,"http://www.w3.org/1999/xlink","xlink:title",b);break;case"xlinkType":Et(r,"http://www.w3.org/1999/xlink","xlink:type",b);break;case"xmlBase":Et(r,"http://www.w3.org/XML/1998/namespace","xml:base",b);break;case"xmlLang":Et(r,"http://www.w3.org/XML/1998/namespace","xml:lang",b);break;case"xmlSpace":Et(r,"http://www.w3.org/XML/1998/namespace","xml:space",b);break;case"is":Wt(r,"is",b);break;case"innerText":case"textContent":break;default:(!(2<C.length)||C[0]!=="o"&&C[0]!=="O"||C[1]!=="n"&&C[1]!=="N")&&(C=Lu.get(C)||C,Wt(r,C,b))}}function Lv(r,g,C,b,x,W){switch(C){case"style":ko(r,b,W);break;case"dangerouslySetInnerHTML":if(b!=null){if(typeof b!="object"||!("__html"in b))throw Error(n(61));if(C=b.__html,C!=null){if(x.children!=null)throw Error(n(60));r.innerHTML=C}}break;case"children":typeof b=="string"?Yi(r,b):(typeof b=="number"||typeof b=="bigint")&&Yi(r,""+b);break;case"onScroll":b!=null&&Jn("scroll",r);break;case"onScrollEnd":b!=null&&Jn("scrollend",r);break;case"onClick":b!=null&&(r.onclick=Ea);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!xe.hasOwnProperty(C))e:{if(C[0]==="o"&&C[1]==="n"&&(x=C.endsWith("Capture"),g=C.slice(2,x?C.length-7:void 0),W=r[U]||null,W=W!=null?W[C]:null,typeof W=="function"&&r.removeEventListener(g,W,x),typeof b=="function")){typeof W!="function"&&W!==null&&(C in r?r[C]=null:r.hasAttribute(C)&&r.removeAttribute(C)),r.addEventListener(g,b,x);break e}C in r?r[C]=b:b===!0?r.setAttribute(C,""):Wt(r,C,b)}}}function Cs(r,g,C){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Jn("error",r),Jn("load",r);var b=!1,x=!1,W;for(W in C)if(C.hasOwnProperty(W)){var L=C[W];if(L!=null)switch(W){case"src":b=!0;break;case"srcSet":x=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,g));default:Si(r,g,W,L,C,null)}}x&&Si(r,g,"srcSet",C.srcSet,C,null),b&&Si(r,g,"src",C.src,C,null);return;case"input":Jn("invalid",r);var re=W=L=x=null,Se=null,tt=null;for(b in C)if(C.hasOwnProperty(b)){var mt=C[b];if(mt!=null)switch(b){case"name":x=mt;break;case"type":L=mt;break;case"checked":Se=mt;break;case"defaultChecked":tt=mt;break;case"value":W=mt;break;case"defaultValue":re=mt;break;case"children":case"dangerouslySetInnerHTML":if(mt!=null)throw Error(n(137,g));break;default:Si(r,g,b,mt,C,null)}}Ei(r,W,re,Se,tt,L,x,!1);return;case"select":Jn("invalid",r),b=L=W=null;for(x in C)if(C.hasOwnProperty(x)&&(re=C[x],re!=null))switch(x){case"value":W=re;break;case"defaultValue":L=re;break;case"multiple":b=re;default:Si(r,g,x,re,C,null)}g=W,C=L,r.multiple=!!b,g!=null?Xi(r,!!b,g,!1):C!=null&&Xi(r,!!b,C,!0);return;case"textarea":Jn("invalid",r),W=x=b=null;for(L in C)if(C.hasOwnProperty(L)&&(re=C[L],re!=null))switch(L){case"value":b=re;break;case"defaultValue":x=re;break;case"children":W=re;break;case"dangerouslySetInnerHTML":if(re!=null)throw Error(n(91));break;default:Si(r,g,L,re,C,null)}yi(r,b,x,W);return;case"option":for(Se in C)C.hasOwnProperty(Se)&&(b=C[Se],b!=null)&&(Se==="selected"?r.selected=b&&typeof b!="function"&&typeof b!="symbol":Si(r,g,Se,b,C,null));return;case"dialog":Jn("beforetoggle",r),Jn("toggle",r),Jn("cancel",r),Jn("close",r);break;case"iframe":case"object":Jn("load",r);break;case"video":case"audio":for(b=0;b<kA.length;b++)Jn(kA[b],r);break;case"image":Jn("error",r),Jn("load",r);break;case"details":Jn("toggle",r);break;case"embed":case"source":case"link":Jn("error",r),Jn("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(tt in C)if(C.hasOwnProperty(tt)&&(b=C[tt],b!=null))switch(tt){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,g));default:Si(r,g,tt,b,C,null)}return;default:if(fa(g)){for(mt in C)C.hasOwnProperty(mt)&&(b=C[mt],b!==void 0&&Lv(r,g,mt,b,C,void 0));return}}for(re in C)C.hasOwnProperty(re)&&(b=C[re],b!=null&&Si(r,g,re,b,C,null))}function UM(r,g,C,b){switch(g){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var x=null,W=null,L=null,re=null,Se=null,tt=null,mt=null;for(ut in C){var Nt=C[ut];if(C.hasOwnProperty(ut)&&Nt!=null)switch(ut){case"checked":break;case"value":break;case"defaultValue":Se=Nt;default:b.hasOwnProperty(ut)||Si(r,g,ut,null,b,Nt)}}for(var at in b){var ut=b[at];if(Nt=C[at],b.hasOwnProperty(at)&&(ut!=null||Nt!=null))switch(at){case"type":W=ut;break;case"name":x=ut;break;case"checked":tt=ut;break;case"defaultChecked":mt=ut;break;case"value":L=ut;break;case"defaultValue":re=ut;break;case"children":case"dangerouslySetInnerHTML":if(ut!=null)throw Error(n(137,g));break;default:ut!==Nt&&Si(r,g,at,ut,b,Nt)}}ni(r,L,re,Se,tt,mt,W,x);return;case"select":ut=L=re=at=null;for(W in C)if(Se=C[W],C.hasOwnProperty(W)&&Se!=null)switch(W){case"value":break;case"multiple":ut=Se;default:b.hasOwnProperty(W)||Si(r,g,W,null,b,Se)}for(x in b)if(W=b[x],Se=C[x],b.hasOwnProperty(x)&&(W!=null||Se!=null))switch(x){case"value":at=W;break;case"defaultValue":re=W;break;case"multiple":L=W;default:W!==Se&&Si(r,g,x,W,b,Se)}g=re,C=L,b=ut,at!=null?Xi(r,!!C,at,!1):!!b!=!!C&&(g!=null?Xi(r,!!C,g,!0):Xi(r,!!C,C?[]:"",!1));return;case"textarea":ut=at=null;for(re in C)if(x=C[re],C.hasOwnProperty(re)&&x!=null&&!b.hasOwnProperty(re))switch(re){case"value":break;case"children":break;default:Si(r,g,re,null,b,x)}for(L in b)if(x=b[L],W=C[L],b.hasOwnProperty(L)&&(x!=null||W!=null))switch(L){case"value":at=x;break;case"defaultValue":ut=x;break;case"children":break;case"dangerouslySetInnerHTML":if(x!=null)throw Error(n(91));break;default:x!==W&&Si(r,g,L,x,b,W)}On(r,at,ut);return;case"option":for(var on in C)at=C[on],C.hasOwnProperty(on)&&at!=null&&!b.hasOwnProperty(on)&&(on==="selected"?r.selected=!1:Si(r,g,on,null,b,at));for(Se in b)at=b[Se],ut=C[Se],b.hasOwnProperty(Se)&&at!==ut&&(at!=null||ut!=null)&&(Se==="selected"?r.selected=at&&typeof at!="function"&&typeof at!="symbol":Si(r,g,Se,at,b,ut));return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var vn in C)at=C[vn],C.hasOwnProperty(vn)&&at!=null&&!b.hasOwnProperty(vn)&&Si(r,g,vn,null,b,at);for(tt in b)if(at=b[tt],ut=C[tt],b.hasOwnProperty(tt)&&at!==ut&&(at!=null||ut!=null))switch(tt){case"children":case"dangerouslySetInnerHTML":if(at!=null)throw Error(n(137,g));break;default:Si(r,g,tt,at,b,ut)}return;default:if(fa(g)){for(var xi in C)at=C[xi],C.hasOwnProperty(xi)&&at!==void 0&&!b.hasOwnProperty(xi)&&Lv(r,g,xi,void 0,b,at);for(mt in b)at=b[mt],ut=C[mt],!b.hasOwnProperty(mt)||at===ut||at===void 0&&ut===void 0||Lv(r,g,mt,at,b,ut);return}}for(var ze in C)at=C[ze],C.hasOwnProperty(ze)&&at!=null&&!b.hasOwnProperty(ze)&&Si(r,g,ze,null,b,at);for(Nt in b)at=b[Nt],ut=C[Nt],!b.hasOwnProperty(Nt)||at===ut||at==null&&ut==null||Si(r,g,Nt,at,b,ut)}function Ex(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function DM(){if(typeof performance.getEntriesByType=="function"){for(var r=0,g=0,C=performance.getEntriesByType("resource"),b=0;b<C.length;b++){var x=C[b],W=x.transferSize,L=x.initiatorType,re=x.duration;if(W&&re&&Ex(L)){for(L=0,re=x.responseEnd,b+=1;b<C.length;b++){var Se=C[b],tt=Se.startTime;if(tt>re)break;var mt=Se.transferSize,Nt=Se.initiatorType;mt&&Ex(Nt)&&(Se=Se.responseEnd,L+=mt*(Se<re?1:(re-tt)/(Se-tt)))}if(--b,g+=8*(W+L)/(x.duration/1e3),r++,10<r)break}}if(0<r)return g/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var kv=null,Uv=null;function Tp(r){return r.nodeType===9?r:r.ownerDocument}function Fx(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function Kx(r,g){if(r===0)switch(g){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&g==="foreignObject"?0:r}function Dv(r,g){return r==="textarea"||r==="noscript"||typeof g.children=="string"||typeof g.children=="number"||typeof g.children=="bigint"||typeof g.dangerouslySetInnerHTML=="object"&&g.dangerouslySetInnerHTML!==null&&g.dangerouslySetInnerHTML.__html!=null}var Ov=null;function OM(){var r=window.event;return r&&r.type==="popstate"?r===Ov?!1:(Ov=r,!0):(Ov=null,!1)}var Tx=typeof setTimeout=="function"?setTimeout:void 0,jM=typeof clearTimeout=="function"?clearTimeout:void 0,zx=typeof Promise=="function"?Promise:void 0,JM=typeof queueMicrotask=="function"?queueMicrotask:typeof zx<"u"?function(r){return zx.resolve(null).then(r).catch(PM)}:Tx;function PM(r){setTimeout(function(){throw r})}function gu(r){return r==="head"}function Lx(r,g){var C=g,b=0;do{var x=C.nextSibling;if(r.removeChild(C),x&&x.nodeType===8)if(C=x.data,C==="/$"||C==="/&"){if(b===0){r.removeChild(x),bh(g);return}b--}else if(C==="$"||C==="$?"||C==="$~"||C==="$!"||C==="&")b++;else if(C==="html")DA(r.ownerDocument.documentElement);else if(C==="head"){C=r.ownerDocument.head,DA(C);for(var W=C.firstChild;W;){var L=W.nextSibling,re=W.nodeName;W[wt]||re==="SCRIPT"||re==="STYLE"||re==="LINK"&&W.rel.toLowerCase()==="stylesheet"||C.removeChild(W),W=L}}else C==="body"&&DA(r.ownerDocument.body);C=x}while(C);bh(g)}function kx(r,g){var C=r;r=0;do{var b=C.nextSibling;if(C.nodeType===1?g?(C._stashedDisplay=C.style.display,C.style.display="none"):(C.style.display=C._stashedDisplay||"",C.getAttribute("style")===""&&C.removeAttribute("style")):C.nodeType===3&&(g?(C._stashedText=C.nodeValue,C.nodeValue=""):C.nodeValue=C._stashedText||""),b&&b.nodeType===8)if(C=b.data,C==="/$"){if(r===0)break;r--}else C!=="$"&&C!=="$?"&&C!=="$~"&&C!=="$!"||r++;C=b}while(C)}function jv(r){var g=r.firstChild;for(g&&g.nodeType===10&&(g=g.nextSibling);g;){var C=g;switch(g=g.nextSibling,C.nodeName){case"HTML":case"HEAD":case"BODY":jv(C),At(C);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(C.rel.toLowerCase()==="stylesheet")continue}r.removeChild(C)}}function QM(r,g,C,b){for(;r.nodeType===1;){var x=C;if(r.nodeName.toLowerCase()!==g.toLowerCase()){if(!b&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(b){if(!r[wt])switch(g){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(W=r.getAttribute("rel"),W==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(W!==x.rel||r.getAttribute("href")!==(x.href==null||x.href===""?null:x.href)||r.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin)||r.getAttribute("title")!==(x.title==null?null:x.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(W=r.getAttribute("src"),(W!==(x.src==null?null:x.src)||r.getAttribute("type")!==(x.type==null?null:x.type)||r.getAttribute("crossorigin")!==(x.crossOrigin==null?null:x.crossOrigin))&&W&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(g==="input"&&r.type==="hidden"){var W=x.name==null?null:""+x.name;if(x.type==="hidden"&&r.getAttribute("name")===W)return r}else return r;if(r=Hr(r.nextSibling),r===null)break}return null}function qM(r,g,C){if(g==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!C||(r=Hr(r.nextSibling),r===null))return null;return r}function Ux(r,g){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!g||(r=Hr(r.nextSibling),r===null))return null;return r}function Jv(r){return r.data==="$?"||r.data==="$~"}function Pv(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function $M(r,g){var C=r.ownerDocument;if(r.data==="$~")r._reactRetry=g;else if(r.data!=="$?"||C.readyState!=="loading")g();else{var b=function(){g(),C.removeEventListener("DOMContentLoaded",b)};C.addEventListener("DOMContentLoaded",b),r._reactRetry=b}}function Hr(r){for(;r!=null;r=r.nextSibling){var g=r.nodeType;if(g===1||g===3)break;if(g===8){if(g=r.data,g==="$"||g==="$!"||g==="$?"||g==="$~"||g==="&"||g==="F!"||g==="F")break;if(g==="/$"||g==="/&")return null}}return r}var Qv=null;function Dx(r){r=r.nextSibling;for(var g=0;r;){if(r.nodeType===8){var C=r.data;if(C==="/$"||C==="/&"){if(g===0)return Hr(r.nextSibling);g--}else C!=="$"&&C!=="$!"&&C!=="$?"&&C!=="$~"&&C!=="&"||g++}r=r.nextSibling}return null}function Ox(r){r=r.previousSibling;for(var g=0;r;){if(r.nodeType===8){var C=r.data;if(C==="$"||C==="$!"||C==="$?"||C==="$~"||C==="&"){if(g===0)return r;g--}else C!=="/$"&&C!=="/&"||g++}r=r.previousSibling}return null}function jx(r,g,C){switch(g=Tp(C),r){case"html":if(r=g.documentElement,!r)throw Error(n(452));return r;case"head":if(r=g.head,!r)throw Error(n(453));return r;case"body":if(r=g.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function DA(r){for(var g=r.attributes;g.length;)r.removeAttributeNode(g[0]);At(r)}var Er=new Map,Jx=new Set;function zp(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var ug=j.d;j.d={f:e5,r:t5,D:n5,C:i5,L:a5,m:s5,X:r5,S:o5,M:l5};function e5(){var r=ug.f(),g=ge();return r||g}function t5(r){var g=ct(r);g!==null&&g.tag===5&&g.type==="form"?XA(g):ug.r(r)}var fh=typeof document>"u"?null:document;function Px(r,g,C){var b=fh;if(b&&typeof g=="string"&&g){var x=jt(g);x='link[rel="'+r+'"][href="'+x+'"]',typeof C=="string"&&(x+='[crossorigin="'+C+'"]'),Jx.has(x)||(Jx.add(x),r={rel:r,crossOrigin:C,href:g},b.querySelector(x)===null&&(g=b.createElement("link"),Cs(g,"link",r),ne(g),b.head.appendChild(g)))}}function n5(r){ug.D(r),Px("dns-prefetch",r,null)}function i5(r,g){ug.C(r,g),Px("preconnect",r,g)}function a5(r,g,C){ug.L(r,g,C);var b=fh;if(b&&r&&g){var x='link[rel="preload"][as="'+jt(g)+'"]';g==="image"&&C&&C.imageSrcSet?(x+='[imagesrcset="'+jt(C.imageSrcSet)+'"]',typeof C.imageSizes=="string"&&(x+='[imagesizes="'+jt(C.imageSizes)+'"]')):x+='[href="'+jt(r)+'"]';var W=x;switch(g){case"style":W=mh(r);break;case"script":W=ph(r)}Er.has(W)||(r=A({rel:"preload",href:g==="image"&&C&&C.imageSrcSet?void 0:r,as:g},C),Er.set(W,r),b.querySelector(x)!==null||g==="style"&&b.querySelector(OA(W))||g==="script"&&b.querySelector(jA(W))||(g=b.createElement("link"),Cs(g,"link",r),ne(g),b.head.appendChild(g)))}}function s5(r,g){ug.m(r,g);var C=fh;if(C&&r){var b=g&&typeof g.as=="string"?g.as:"script",x='link[rel="modulepreload"][as="'+jt(b)+'"][href="'+jt(r)+'"]',W=x;switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":W=ph(r)}if(!Er.has(W)&&(r=A({rel:"modulepreload",href:r},g),Er.set(W,r),C.querySelector(x)===null)){switch(b){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(C.querySelector(jA(W)))return}b=C.createElement("link"),Cs(b,"link",r),ne(b),C.head.appendChild(b)}}}function o5(r,g,C){ug.S(r,g,C);var b=fh;if(b&&r){var x=$e(b).hoistableStyles,W=mh(r);g=g||"default";var L=x.get(W);if(!L){var re={loading:0,preload:null};if(L=b.querySelector(OA(W)))re.loading=5;else{r=A({rel:"stylesheet",href:r,"data-precedence":g},C),(C=Er.get(W))&&qv(r,C);var Se=L=b.createElement("link");ne(Se),Cs(Se,"link",r),Se._p=new Promise(function(tt,mt){Se.onload=tt,Se.onerror=mt}),Se.addEventListener("load",function(){re.loading|=1}),Se.addEventListener("error",function(){re.loading|=2}),re.loading|=4,Lp(L,g,b)}L={type:"stylesheet",instance:L,count:1,state:re},x.set(W,L)}}}function r5(r,g){ug.X(r,g);var C=fh;if(C&&r){var b=$e(C).hoistableScripts,x=ph(r),W=b.get(x);W||(W=C.querySelector(jA(x)),W||(r=A({src:r,async:!0},g),(g=Er.get(x))&&$v(r,g),W=C.createElement("script"),ne(W),Cs(W,"link",r),C.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},b.set(x,W))}}function l5(r,g){ug.M(r,g);var C=fh;if(C&&r){var b=$e(C).hoistableScripts,x=ph(r),W=b.get(x);W||(W=C.querySelector(jA(x)),W||(r=A({src:r,async:!0,type:"module"},g),(g=Er.get(x))&&$v(r,g),W=C.createElement("script"),ne(W),Cs(W,"link",r),C.head.appendChild(W)),W={type:"script",instance:W,count:1,state:null},b.set(x,W))}}function Qx(r,g,C,b){var x=(x=D.current)?zp(x):null;if(!x)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof C.precedence=="string"&&typeof C.href=="string"?(g=mh(C.href),C=$e(x).hoistableStyles,b=C.get(g),b||(b={type:"style",instance:null,count:0,state:null},C.set(g,b)),b):{type:"void",instance:null,count:0,state:null};case"link":if(C.rel==="stylesheet"&&typeof C.href=="string"&&typeof C.precedence=="string"){r=mh(C.href);var W=$e(x).hoistableStyles,L=W.get(r);if(L||(x=x.ownerDocument||x,L={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},W.set(r,L),(W=x.querySelector(OA(r)))&&!W._p&&(L.instance=W,L.state.loading=5),Er.has(r)||(C={rel:"preload",as:"style",href:C.href,crossOrigin:C.crossOrigin,integrity:C.integrity,media:C.media,hrefLang:C.hrefLang,referrerPolicy:C.referrerPolicy},Er.set(r,C),W||c5(x,r,C,L.state))),g&&b===null)throw Error(n(528,""));return L}if(g&&b!==null)throw Error(n(529,""));return null;case"script":return g=C.async,C=C.src,typeof C=="string"&&g&&typeof g!="function"&&typeof g!="symbol"?(g=ph(C),C=$e(x).hoistableScripts,b=C.get(g),b||(b={type:"script",instance:null,count:0,state:null},C.set(g,b)),b):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function mh(r){return'href="'+jt(r)+'"'}function OA(r){return'link[rel="stylesheet"]['+r+"]"}function qx(r){return A({},r,{"data-precedence":r.precedence,precedence:null})}function c5(r,g,C,b){r.querySelector('link[rel="preload"][as="style"]['+g+"]")?b.loading=1:(g=r.createElement("link"),b.preload=g,g.addEventListener("load",function(){return b.loading|=1}),g.addEventListener("error",function(){return b.loading|=2}),Cs(g,"link",C),ne(g),r.head.appendChild(g))}function ph(r){return'[src="'+jt(r)+'"]'}function jA(r){return"script[async]"+r}function $x(r,g,C){if(g.count++,g.instance===null)switch(g.type){case"style":var b=r.querySelector('style[data-href~="'+jt(C.href)+'"]');if(b)return g.instance=b,ne(b),b;var x=A({},C,{"data-href":C.href,"data-precedence":C.precedence,href:null,precedence:null});return b=(r.ownerDocument||r).createElement("style"),ne(b),Cs(b,"style",x),Lp(b,C.precedence,r),g.instance=b;case"stylesheet":x=mh(C.href);var W=r.querySelector(OA(x));if(W)return g.state.loading|=4,g.instance=W,ne(W),W;b=qx(C),(x=Er.get(x))&&qv(b,x),W=(r.ownerDocument||r).createElement("link"),ne(W);var L=W;return L._p=new Promise(function(re,Se){L.onload=re,L.onerror=Se}),Cs(W,"link",b),g.state.loading|=4,Lp(W,C.precedence,r),g.instance=W;case"script":return W=ph(C.src),(x=r.querySelector(jA(W)))?(g.instance=x,ne(x),x):(b=C,(x=Er.get(W))&&(b=A({},C),$v(b,x)),r=r.ownerDocument||r,x=r.createElement("script"),ne(x),Cs(x,"link",b),r.head.appendChild(x),g.instance=x);case"void":return null;default:throw Error(n(443,g.type))}else g.type==="stylesheet"&&(g.state.loading&4)===0&&(b=g.instance,g.state.loading|=4,Lp(b,C.precedence,r));return g.instance}function Lp(r,g,C){for(var b=C.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),x=b.length?b[b.length-1]:null,W=x,L=0;L<b.length;L++){var re=b[L];if(re.dataset.precedence===g)W=re;else if(W!==x)break}W?W.parentNode.insertBefore(r,W.nextSibling):(g=C.nodeType===9?C.head:C,g.insertBefore(r,g.firstChild))}function qv(r,g){r.crossOrigin==null&&(r.crossOrigin=g.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=g.referrerPolicy),r.title==null&&(r.title=g.title)}function $v(r,g){r.crossOrigin==null&&(r.crossOrigin=g.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=g.referrerPolicy),r.integrity==null&&(r.integrity=g.integrity)}var kp=null;function eZ(r,g,C){if(kp===null){var b=new Map,x=kp=new Map;x.set(C,b)}else x=kp,b=x.get(C),b||(b=new Map,x.set(C,b));if(b.has(r))return b;for(b.set(r,null),C=C.getElementsByTagName(r),x=0;x<C.length;x++){var W=C[x];if(!(W[wt]||W[Vt]||r==="link"&&W.getAttribute("rel")==="stylesheet")&&W.namespaceURI!=="http://www.w3.org/2000/svg"){var L=W.getAttribute(g)||"";L=r+L;var re=b.get(L);re?re.push(W):b.set(L,[W])}}return b}function tZ(r,g,C){r=r.ownerDocument||r,r.head.insertBefore(C,g==="title"?r.querySelector("head > title"):null)}function g5(r,g,C){if(C===1||g.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof g.precedence!="string"||typeof g.href!="string"||g.href==="")break;return!0;case"link":if(typeof g.rel!="string"||typeof g.href!="string"||g.href===""||g.onLoad||g.onError)break;return g.rel==="stylesheet"?(r=g.disabled,typeof g.precedence=="string"&&r==null):!0;case"script":if(g.async&&typeof g.async!="function"&&typeof g.async!="symbol"&&!g.onLoad&&!g.onError&&g.src&&typeof g.src=="string")return!0}return!1}function nZ(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function u5(r,g,C,b){if(C.type==="stylesheet"&&(typeof b.media!="string"||matchMedia(b.media).matches!==!1)&&(C.state.loading&4)===0){if(C.instance===null){var x=mh(b.href),W=g.querySelector(OA(x));if(W){g=W._p,g!==null&&typeof g=="object"&&typeof g.then=="function"&&(r.count++,r=Up.bind(r),g.then(r,r)),C.state.loading|=4,C.instance=W,ne(W);return}W=g.ownerDocument||g,b=qx(b),(x=Er.get(x))&&qv(b,x),W=W.createElement("link"),ne(W);var L=W;L._p=new Promise(function(re,Se){L.onload=re,L.onerror=Se}),Cs(W,"link",b),C.instance=W}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(C,g),(g=C.state.preload)&&(C.state.loading&3)===0&&(r.count++,C=Up.bind(r),g.addEventListener("load",C),g.addEventListener("error",C))}}var eG=0;function d5(r,g){return r.stylesheets&&r.count===0&&Op(r,r.stylesheets),0<r.count||0<r.imgCount?function(C){var b=setTimeout(function(){if(r.stylesheets&&Op(r,r.stylesheets),r.unsuspend){var W=r.unsuspend;r.unsuspend=null,W()}},6e4+g);0<r.imgBytes&&eG===0&&(eG=62500*DM());var x=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Op(r,r.stylesheets),r.unsuspend)){var W=r.unsuspend;r.unsuspend=null,W()}},(r.imgBytes>eG?50:800)+g);return r.unsuspend=C,function(){r.unsuspend=null,clearTimeout(b),clearTimeout(x)}}:null}function Up(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Op(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Dp=null;function Op(r,g){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Dp=new Map,g.forEach(I5,r),Dp=null,Up.call(r))}function I5(r,g){if(!(g.state.loading&4)){var C=Dp.get(r);if(C)var b=C.get(null);else{C=new Map,Dp.set(r,C);for(var x=r.querySelectorAll("link[data-precedence],style[data-precedence]"),W=0;W<x.length;W++){var L=x[W];(L.nodeName==="LINK"||L.getAttribute("media")!=="not all")&&(C.set(L.dataset.precedence,L),b=L)}b&&C.set(null,b)}x=g.instance,L=x.getAttribute("data-precedence"),W=C.get(L)||b,W===b&&C.set(null,x),C.set(L,x),this.count++,b=Up.bind(this),x.addEventListener("load",b),x.addEventListener("error",b),W?W.parentNode.insertBefore(x,W.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(x,r.firstChild)),g.state.loading|=4}}var JA={$$typeof:R,Provider:null,Consumer:null,_currentValue:Q,_currentValue2:Q,_threadCount:0};function h5(r,g,C,b,x,W,L,re,Se){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=$t(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$t(0),this.hiddenUpdates=$t(null),this.identifierPrefix=b,this.onUncaughtError=x,this.onCaughtError=W,this.onRecoverableError=L,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Se,this.incompleteTransitions=new Map}function iZ(r,g,C,b,x,W,L,re,Se,tt,mt,Nt){return r=new h5(r,g,C,L,Se,tt,mt,Nt,re),g=1,W===!0&&(g|=24),W=cs(3,null,null,g),r.current=W,W.stateNode=r,g=iA(),g.refCount++,r.pooledCache=g,g.refCount++,W.memoizedState={element:b,isDehydrated:C,cache:g},cA(W),r}function aZ(r){return r?(r=Ol,r):Ol}function sZ(r,g,C,b,x,W){x=aZ(x),b.context===null?b.context=x:b.pendingContext=x,b=wr(g),b.payload={element:C},W=W===void 0?null:W,W!==null&&(b.callback=W),C=ll(r,b,g),C!==null&&(I(C,r,g),tc(C,r,g))}function oZ(r,g){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var C=r.retryLane;r.retryLane=C!==0&&C<g?C:g}}function tG(r,g){oZ(r,g),(r=r.alternate)&&oZ(r,g)}function rZ(r){if(r.tag===13||r.tag===31){var g=Dl(r,67108864);g!==null&&I(g,r,67108864),tG(r,67108864)}}function lZ(r){if(r.tag===13||r.tag===31){var g=hs();g=Je(g);var C=Dl(r,g);C!==null&&I(C,r,g),tG(r,g)}}var jp=!0;function C5(r,g,C,b){var x=F.T;F.T=null;var W=j.p;try{j.p=2,nG(r,g,C,b)}finally{j.p=W,F.T=x}}function A5(r,g,C,b){var x=F.T;F.T=null;var W=j.p;try{j.p=8,nG(r,g,C,b)}finally{j.p=W,F.T=x}}function nG(r,g,C,b){if(jp){var x=iG(b);if(x===null)zv(r,g,b,Jp,C),gZ(r,b);else if(m5(x,r,g,C,b))b.stopPropagation();else if(gZ(r,b),g&4&&-1<f5.indexOf(r)){for(;x!==null;){var W=ct(x);if(W!==null)switch(W.tag){case 3:if(W=W.stateNode,W.current.memoizedState.isDehydrated){var L=gt(W.pendingLanes);if(L!==0){var re=W;for(re.pendingLanes|=2,re.entangledLanes|=2;L;){var Se=1<<31-he(L);re.entanglements[1]|=Se,L&=~Se}gc(W),(Qn&6)===0&&(uo=z()+500,LA(0))}}break;case 31:case 13:re=Dl(W,2),re!==null&&I(re,W,2),ge(),tG(W,2)}if(W=iG(b),W===null&&zv(r,g,b,Jp,C),W===x)break;x=W}x!==null&&b.stopPropagation()}else zv(r,g,b,null,C)}}function iG(r){return r=_c(r),aG(r)}var Jp=null;function aG(r){if(Jp=null,r=bt(r),r!==null){var g=s(r);if(g===null)r=null;else{var C=g.tag;if(C===13){if(r=o(g),r!==null)return r;r=null}else if(C===31){if(r=l(g),r!==null)return r;r=null}else if(C===3){if(g.stateNode.current.memoizedState.isDehydrated)return g.tag===3?g.stateNode.containerInfo:null;r=null}else g!==r&&(r=null)}}return Jp=r,null}function cZ(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Ae()){case Oe:return 2;case He:return 8;case Me:case It:return 32;case ft:return 268435456;default:return 32}default:return 32}}var sG=!1,uu=null,du=null,Iu=null,PA=new Map,QA=new Map,hu=[],f5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function gZ(r,g){switch(r){case"focusin":case"focusout":uu=null;break;case"dragenter":case"dragleave":du=null;break;case"mouseover":case"mouseout":Iu=null;break;case"pointerover":case"pointerout":PA.delete(g.pointerId);break;case"gotpointercapture":case"lostpointercapture":QA.delete(g.pointerId)}}function qA(r,g,C,b,x,W){return r===null||r.nativeEvent!==W?(r={blockedOn:g,domEventName:C,eventSystemFlags:b,nativeEvent:W,targetContainers:[x]},g!==null&&(g=ct(g),g!==null&&rZ(g)),r):(r.eventSystemFlags|=b,g=r.targetContainers,x!==null&&g.indexOf(x)===-1&&g.push(x),r)}function m5(r,g,C,b,x){switch(g){case"focusin":return uu=qA(uu,r,g,C,b,x),!0;case"dragenter":return du=qA(du,r,g,C,b,x),!0;case"mouseover":return Iu=qA(Iu,r,g,C,b,x),!0;case"pointerover":var W=x.pointerId;return PA.set(W,qA(PA.get(W)||null,r,g,C,b,x)),!0;case"gotpointercapture":return W=x.pointerId,QA.set(W,qA(QA.get(W)||null,r,g,C,b,x)),!0}return!1}function uZ(r){var g=bt(r.target);if(g!==null){var C=s(g);if(C!==null){if(g=C.tag,g===13){if(g=o(C),g!==null){r.blockedOn=g,Gt(r.priority,function(){lZ(C)});return}}else if(g===31){if(g=l(C),g!==null){r.blockedOn=g,Gt(r.priority,function(){lZ(C)});return}}else if(g===3&&C.stateNode.current.memoizedState.isDehydrated){r.blockedOn=C.tag===3?C.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Pp(r){if(r.blockedOn!==null)return!1;for(var g=r.targetContainers;0<g.length;){var C=iG(r.nativeEvent);if(C===null){C=r.nativeEvent;var b=new C.constructor(C.type,C);Uo=b,C.target.dispatchEvent(b),Uo=null}else return g=ct(C),g!==null&&rZ(g),r.blockedOn=C,!1;g.shift()}return!0}function dZ(r,g,C){Pp(r)&&C.delete(g)}function p5(){sG=!1,uu!==null&&Pp(uu)&&(uu=null),du!==null&&Pp(du)&&(du=null),Iu!==null&&Pp(Iu)&&(Iu=null),PA.forEach(dZ),QA.forEach(dZ)}function Qp(r,g){r.blockedOn===g&&(r.blockedOn=null,sG||(sG=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,p5)))}var qp=null;function IZ(r){qp!==r&&(qp=r,a.unstable_scheduleCallback(a.unstable_NormalPriority,function(){qp===r&&(qp=null);for(var g=0;g<r.length;g+=3){var C=r[g],b=r[g+1],x=r[g+2];if(typeof b!="function"){if(aG(b||C)===null)continue;break}var W=ct(C);W!==null&&(r.splice(g,3),g-=3,_A(W,{pending:!0,data:x,method:C.method,action:b},b,x))}}))}function bh(r){function g(Se){return Qp(Se,r)}uu!==null&&Qp(uu,r),du!==null&&Qp(du,r),Iu!==null&&Qp(Iu,r),PA.forEach(g),QA.forEach(g);for(var C=0;C<hu.length;C++){var b=hu[C];b.blockedOn===r&&(b.blockedOn=null)}for(;0<hu.length&&(C=hu[0],C.blockedOn===null);)uZ(C),C.blockedOn===null&&hu.shift();if(C=(r.ownerDocument||r).$$reactFormReplay,C!=null)for(b=0;b<C.length;b+=3){var x=C[b],W=C[b+1],L=x[U]||null;if(typeof W=="function")L||IZ(C);else if(L){var re=null;if(W&&W.hasAttribute("formAction")){if(x=W,L=W[U]||null)re=L.formAction;else if(aG(x)!==null)continue}else re=L.action;typeof re=="function"?C[b+1]=re:(C.splice(b,3),b-=3),IZ(C)}}}function hZ(){function r(W){W.canIntercept&&W.info==="react-transition"&&W.intercept({handler:function(){return new Promise(function(L){return x=L})},focusReset:"manual",scroll:"manual"})}function g(){x!==null&&(x(),x=null),b||setTimeout(C,20)}function C(){if(!b&&!navigation.transition){var W=navigation.currentEntry;W&&W.url!=null&&navigation.navigate(W.url,{state:W.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var b=!1,x=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",g),navigation.addEventListener("navigateerror",g),setTimeout(C,100),function(){b=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",g),navigation.removeEventListener("navigateerror",g),x!==null&&(x(),x=null)}}}function oG(r){this._internalRoot=r}$p.prototype.render=oG.prototype.render=function(r){var g=this._internalRoot;if(g===null)throw Error(n(409));var C=g.current,b=hs();sZ(C,b,r,g,null,null)},$p.prototype.unmount=oG.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var g=r.containerInfo;sZ(r.current,2,null,r,null,null),ge(),g[te]=null}};function $p(r){this._internalRoot=r}$p.prototype.unstable_scheduleHydration=function(r){if(r){var g=Mt();r={blockedOn:null,target:r,priority:g};for(var C=0;C<hu.length&&g!==0&&g<hu[C].priority;C++);hu.splice(C,0,r),C===0&&uZ(r)}};var CZ=e.version;if(CZ!=="19.2.3")throw Error(n(527,CZ,"19.2.3"));j.findDOMNode=function(r){var g=r._reactInternals;if(g===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=u(g),r=r!==null?h(r):null,r=r===null?null:r.stateNode,r};var b5={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:F,reconcilerVersion:"19.2.3"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var eb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!eb.isDisabled&&eb.supportsFiber)try{Pe=eb.inject(b5),je=eb}catch{}}return ef.createRoot=function(r,g){if(!i(r))throw Error(n(299));var C=!1,b="",x=EA,W=Vp,L=ih;return g!=null&&(g.unstable_strictMode===!0&&(C=!0),g.identifierPrefix!==void 0&&(b=g.identifierPrefix),g.onUncaughtError!==void 0&&(x=g.onUncaughtError),g.onCaughtError!==void 0&&(W=g.onCaughtError),g.onRecoverableError!==void 0&&(L=g.onRecoverableError)),g=iZ(r,1,!1,null,null,C,b,null,x,W,L,hZ),r[te]=g.current,Tv(r),new oG(g)},ef.hydrateRoot=function(r,g,C){if(!i(r))throw Error(n(299));var b=!1,x="",W=EA,L=Vp,re=ih,Se=null;return C!=null&&(C.unstable_strictMode===!0&&(b=!0),C.identifierPrefix!==void 0&&(x=C.identifierPrefix),C.onUncaughtError!==void 0&&(W=C.onUncaughtError),C.onCaughtError!==void 0&&(L=C.onCaughtError),C.onRecoverableError!==void 0&&(re=C.onRecoverableError),C.formState!==void 0&&(Se=C.formState)),g=iZ(r,1,!0,g,C??null,b,x,Se,W,L,re,hZ),g.context=aZ(null),C=g.current,b=hs(),b=Je(b),x=wr(b),x.callback=null,ll(C,x,b),C=b,g.current.lanes=C,Rn(g,C),gc(g),r[te]=g.current,Tv(r),new $p(g)},ef.version="19.2.3",ef}var SZ;function W5(){if(SZ)return cG.exports;SZ=1;function a(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(a)}catch(e){console.error(e)}}return a(),cG.exports=N5(),cG.exports}var V5=W5();const M5=xy(V5);var GN=a=>{throw TypeError(a)},_5=(a,e,t)=>e.has(a)||GN("Cannot "+t),IG=(a,e,t)=>(_5(a,e,"read from private field"),t?t.call(a):e.get(a)),X5=(a,e,t)=>e.has(a)?GN("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(a):e.set(a,t),xZ="popstate";function Y5(a={}){function e(i,s){let{pathname:o="/",search:l="",hash:c=""}=Rg(i.location.hash.substring(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Jf("",{pathname:o,search:l,hash:c},s.state&&s.state.usr||null,s.state&&s.state.key||"default")}function t(i,s){let o=i.document.querySelector("base"),l="";if(o&&o.getAttribute("href")){let c=i.location.href,u=c.indexOf("#");l=u===-1?c:c.slice(0,u)}return l+"#"+(typeof s=="string"?s:Zc(s))}function n(i,s){ra(i.pathname.charAt(0)==="/",`relative pathnames are not supported in hash history.push(${JSON.stringify(s)})`)}return E5(e,t,n,a)}function kn(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function ra(a,e){if(!a){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function H5(){return Math.random().toString(36).substring(2,10)}function ZZ(a,e){return{usr:a.state,key:a.key,idx:e}}function Jf(a,e,t=null,n){return{pathname:typeof a=="string"?a:a.pathname,search:"",hash:"",...typeof e=="string"?Rg(e):e,state:t,key:e&&e.key||n||H5()}}function Zc({pathname:a="/",search:e="",hash:t=""}){return e&&e!=="?"&&(a+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(a+=t.charAt(0)==="#"?t:"#"+t),a}function Rg(a){let e={};if(a){let t=a.indexOf("#");t>=0&&(e.hash=a.substring(t),a=a.substring(0,t));let n=a.indexOf("?");n>=0&&(e.search=a.substring(n),a=a.substring(0,n)),a&&(e.pathname=a)}return e}function E5(a,e,t,n={}){let{window:i=document.defaultView,v5Compat:s=!1}=n,o=i.history,l="POP",c=null,u=h();u==null&&(u=0,o.replaceState({...o.state,idx:u},""));function h(){return(o.state||{idx:null}).idx}function A(){l="POP";let B=h(),S=B==null?null:B-u;u=B,c&&c({action:l,location:G.location,delta:S})}function f(B,S){l="PUSH";let N=Jf(G.location,B,S);t&&t(N,B),u=h()+1;let R=ZZ(N,u),w=G.createHref(N);try{o.pushState(R,"",w)}catch(V){if(V instanceof DOMException&&V.name==="DataCloneError")throw V;i.location.assign(w)}s&&c&&c({action:l,location:G.location,delta:1})}function p(B,S){l="REPLACE";let N=Jf(G.location,B,S);t&&t(N,B),u=h();let R=ZZ(N,u),w=G.createHref(N);o.replaceState(R,"",w),s&&c&&c({action:l,location:G.location,delta:0})}function y(B){return BN(B)}let G={get action(){return l},get location(){return a(i,o)},listen(B){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(xZ,A),c=B,()=>{i.removeEventListener(xZ,A),c=null}},createHref(B){return e(i,B)},createURL:y,encodeLocation(B){let S=y(B);return{pathname:S.pathname,search:S.search,hash:S.hash}},push:f,replace:p,go(B){return o.go(B)}};return G}function BN(a,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),kn(t,"No window.location.(origin|href) available to create URL");let n=typeof a=="string"?a:Zc(a);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}var Sf,wZ=class{constructor(a){if(X5(this,Sf,new Map),a)for(let[e,t]of a)this.set(e,t)}get(a){if(IG(this,Sf).has(a))return IG(this,Sf).get(a);if(a.defaultValue!==void 0)return a.defaultValue;throw new Error("No value found for context")}set(a,e){IG(this,Sf).set(a,e)}};Sf=new WeakMap;var F5=new Set(["lazy","caseSensitive","path","id","index","children"]);function K5(a){return F5.has(a)}var T5=new Set(["lazy","caseSensitive","path","id","index","middleware","children"]);function z5(a){return T5.has(a)}function L5(a){return a.index===!0}function Pf(a,e,t=[],n={},i=!1){return a.map((s,o)=>{let l=[...t,String(o)],c=typeof s.id=="string"?s.id:l.join("-");if(kn(s.index!==!0||!s.children,"Cannot specify children on an index route"),kn(i||!n[c],`Found a route id collision on id "${c}".  Route id's must be globally unique within Data Router usages`),L5(s)){let u={...s,id:c};return n[c]=RZ(u,e(u)),u}else{let u={...s,id:c,children:void 0};return n[c]=RZ(u,e(u)),s.children&&(u.children=Pf(s.children,e,l,n,i)),u}})}function RZ(a,e){return Object.assign(a,{...e,...typeof e.lazy=="object"&&e.lazy!=null?{lazy:{...a.lazy,...e.lazy}}:{}})}function Su(a,e,t="/"){return xf(a,e,t,!1)}function xf(a,e,t,n){let i=typeof e=="string"?Rg(e):e,s=kr(i.pathname||"/",t);if(s==null)return null;let o=SN(a);U5(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let u=n_(s);l=e_(o[c],u,n)}return l}function k5(a,e){let{route:t,pathname:n,params:i}=a;return{id:t.id,pathname:n,params:i,data:e[t.id],loaderData:e[t.id],handle:t.handle}}function SN(a,e=[],t=[],n="",i=!1){let s=(o,l,c=i,u)=>{let h={relativePath:u===void 0?o.path||"":u,caseSensitive:o.caseSensitive===!0,childrenIndex:l,route:o};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(n)&&c)return;kn(h.relativePath.startsWith(n),`Absolute route path "${h.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(n.length)}let A=Sc([n,h.relativePath]),f=t.concat(h);o.children&&o.children.length>0&&(kn(o.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${A}".`),SN(o.children,e,f,A,c)),!(o.path==null&&!o.index)&&e.push({path:A,score:q5(A,o.index),routesMeta:f})};return a.forEach((o,l)=>{if(o.path===""||!o.path?.includes("?"))s(o,l);else for(let c of xN(o.path))s(o,l,!0,c)}),e}function xN(a){let e=a.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),s=t.replace(/\?$/,"");if(n.length===0)return i?[s,""]:[s];let o=xN(n.join("/")),l=[];return l.push(...o.map(c=>c===""?s:[s,c].join("/"))),i&&l.push(...o),l.map(c=>a.startsWith("/")&&c===""?"/":c)}function U5(a){a.sort((e,t)=>e.score!==t.score?t.score-e.score:$5(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var D5=/^:[\w-]+$/,O5=3,j5=2,J5=1,P5=10,Q5=-2,NZ=a=>a==="*";function q5(a,e){let t=a.split("/"),n=t.length;return t.some(NZ)&&(n+=Q5),e&&(n+=j5),t.filter(i=>!NZ(i)).reduce((i,s)=>i+(D5.test(s)?O5:s===""?J5:P5),n)}function $5(a,e){return a.length===e.length&&a.slice(0,-1).every((n,i)=>n===e[i])?a[a.length-1]-e[e.length-1]:0}function e_(a,e,t=!1){let{routesMeta:n}=a,i={},s="/",o=[];for(let l=0;l<n.length;++l){let c=n[l],u=l===n.length-1,h=s==="/"?e:e.slice(s.length)||"/",A=B0({path:c.relativePath,caseSensitive:c.caseSensitive,end:u},h),f=c.route;if(!A&&u&&t&&!n[n.length-1].route.index&&(A=B0({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!A)return null;Object.assign(i,A.params),o.push({params:i,pathname:Sc([s,A.pathname]),pathnameBase:s_(Sc([s,A.pathnameBase])),route:f}),A.pathnameBase!=="/"&&(s=Sc([s,A.pathnameBase]))}return o}function B0(a,e){typeof a=="string"&&(a={path:a,caseSensitive:!1,end:!0});let[t,n]=t_(a.path,a.caseSensitive,a.end),i=e.match(t);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:n.reduce((u,{paramName:h,isOptional:A},f)=>{if(h==="*"){let y=l[f]||"";o=s.slice(0,s.length-y.length).replace(/(.)\/+$/,"$1")}const p=l[f];return A&&!p?u[h]=void 0:u[h]=(p||"").replace(/%2F/g,"/"),u},{}),pathname:s,pathnameBase:o,pattern:a}}function t_(a,e=!1,t=!0){ra(a==="*"||!a.endsWith("*")||a.endsWith("/*"),`Route path "${a}" will be treated as if it were "${a.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${a.replace(/\*$/,"/*")}".`);let n=[],i="^"+a.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return a.endsWith("*")?(n.push({paramName:"*"}),i+=a==="*"||a==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":a!==""&&a!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function n_(a){try{return a.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ra(!1,`The URL path "${a}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),a}}function kr(a,e){if(e==="/")return a;if(!a.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=a.charAt(t);return n&&n!=="/"?null:a.slice(t)||"/"}function i_({basename:a,pathname:e}){return e==="/"?a:Sc([a,e])}var ZN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Zy=a=>ZN.test(a);function a_(a,e="/"){let{pathname:t,search:n="",hash:i=""}=typeof a=="string"?Rg(a):a,s;if(t)if(Zy(t))s=t;else{if(t.includes("//")){let o=t;t=t.replace(/\/\/+/g,"/"),ra(!1,`Pathnames cannot have embedded double slashes - normalizing ${o} -> ${t}`)}t.startsWith("/")?s=WZ(t.substring(1),"/"):s=WZ(t,e)}else s=e;return{pathname:s,search:o_(n),hash:r_(i)}}function WZ(a,e){let t=e.replace(/\/+$/,"").split("/");return a.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function hG(a,e,t,n){return`Cannot include a '${a}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function wN(a){return a.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function wy(a){let e=wN(a);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function Ry(a,e,t,n=!1){let i;typeof a=="string"?i=Rg(a):(i={...a},kn(!i.pathname||!i.pathname.includes("?"),hG("?","pathname","search",i)),kn(!i.pathname||!i.pathname.includes("#"),hG("#","pathname","hash",i)),kn(!i.search||!i.search.includes("#"),hG("#","search","hash",i)));let s=a===""||i.pathname==="",o=s?"/":i.pathname,l;if(o==null)l=t;else{let A=e.length-1;if(!n&&o.startsWith("..")){let f=o.split("/");for(;f[0]==="..";)f.shift(),A-=1;i.pathname=f.join("/")}l=A>=0?e[A]:"/"}let c=a_(i,l),u=o&&o!=="/"&&o.endsWith("/"),h=(s||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(u||h)&&(c.pathname+="/"),c}var Sc=a=>a.join("/").replace(/\/\/+/g,"/"),s_=a=>a.replace(/\/+$/,"").replace(/^\/*/,"/"),o_=a=>!a||a==="?"?"":a.startsWith("?")?a:"?"+a,r_=a=>!a||a==="#"?"":a.startsWith("#")?a:"#"+a,Gm=class{constructor(a,e,t,n=!1){this.status=a,this.statusText=e||"",this.internal=n,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function Qf(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.internal=="boolean"&&"data"in a}function Bm(a){return a.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var RN=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function NN(a,e){let t=a;if(typeof t!="string"||!ZN.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let n=t,i=!1;if(RN)try{let s=new URL(window.location.href),o=t.startsWith("//")?new URL(s.protocol+t):new URL(t),l=kr(o.pathname,e);o.origin===s.origin&&l!=null?t=l+o.search+o.hash:i=!0}catch{ra(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:n,isExternal:i,to:t}}var Ru=Symbol("Uninstrumented");function l_(a,e){let t={lazy:[],"lazy.loader":[],"lazy.action":[],"lazy.middleware":[],middleware:[],loader:[],action:[]};a.forEach(i=>i({id:e.id,index:e.index,path:e.path,instrument(s){let o=Object.keys(t);for(let l of o)s[l]&&t[l].push(s[l])}}));let n={};if(typeof e.lazy=="function"&&t.lazy.length>0){let i=iC(t.lazy,e.lazy,()=>{});i&&(n.lazy=i)}if(typeof e.lazy=="object"){let i=e.lazy;["middleware","loader","action"].forEach(s=>{let o=i[s],l=t[`lazy.${s}`];if(typeof o=="function"&&l.length>0){let c=iC(l,o,()=>{});c&&(n.lazy=Object.assign(n.lazy||{},{[s]:c}))}})}return["loader","action"].forEach(i=>{let s=e[i];if(typeof s=="function"&&t[i].length>0){let o=s[Ru]??s,l=iC(t[i],o,(...c)=>VZ(c[0]));l&&(l[Ru]=o,n[i]=l)}}),e.middleware&&e.middleware.length>0&&t.middleware.length>0&&(n.middleware=e.middleware.map(i=>{let s=i[Ru]??i,o=iC(t.middleware,s,(...l)=>VZ(l[0]));return o?(o[Ru]=s,o):i})),n}function c_(a,e){let t={navigate:[],fetch:[]};if(e.forEach(n=>n({instrument(i){let s=Object.keys(i);for(let o of s)i[o]&&t[o].push(i[o])}})),t.navigate.length>0){let n=a.navigate[Ru]??a.navigate,i=iC(t.navigate,n,(...s)=>{let[o,l]=s;return{to:typeof o=="number"||typeof o=="string"?o:o?Zc(o):".",...MZ(a,l??{})}});i&&(i[Ru]=n,a.navigate=i)}if(t.fetch.length>0){let n=a.fetch[Ru]??a.fetch,i=iC(t.fetch,n,(...s)=>{let[o,,l,c]=s;return{href:l??".",fetcherKey:o,...MZ(a,c??{})}});i&&(i[Ru]=n,a.fetch=i)}return a}function iC(a,e,t){return a.length===0?null:async(...n)=>{let i=await WN(a,t(...n),()=>e(...n),a.length-1);if(i.type==="error")throw i.value;return i.value}}async function WN(a,e,t,n){let i=a[n],s;if(i){let o,l=async()=>(o?console.error("You cannot call instrumented handlers more than once"):o=WN(a,e,t,n-1),s=await o,kn(s,"Expected a result"),s.type==="error"&&s.value instanceof Error?{status:"error",error:s.value}:{status:"success",error:void 0});try{await i(l,e)}catch(c){console.error("An instrumentation function threw an error:",c)}o||await l(),await o}else try{s={type:"success",value:await t()}}catch(o){s={type:"error",value:o}}return s||{type:"error",value:new Error("No result assigned in instrumentation chain.")}}function VZ(a){let{request:e,context:t,params:n,unstable_pattern:i}=a;return{request:g_(e),params:{...n},unstable_pattern:i,context:u_(t)}}function MZ(a,e){return{currentUrl:Zc(a.state.location),..."formMethod"in e?{formMethod:e.formMethod}:{},..."formEncType"in e?{formEncType:e.formEncType}:{},..."formData"in e?{formData:e.formData}:{},..."body"in e?{body:e.body}:{}}}function g_(a){return{method:a.method,url:a.url,headers:{get:(...e)=>a.headers.get(...e)}}}function u_(a){if(I_(a)){let e={...a};return Object.freeze(e),e}else return{get:e=>a.get(e)}}var d_=Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function I_(a){if(a===null||typeof a!="object")return!1;const e=Object.getPrototypeOf(a);return e===Object.prototype||e===null||Object.getOwnPropertyNames(e).sort().join("\0")===d_}var VN=["POST","PUT","PATCH","DELETE"],h_=new Set(VN),C_=["GET",...VN],A_=new Set(C_),MN=new Set([301,302,303,307,308]),f_=new Set([307,308]),CG={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},m_={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},tf={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},p_=a=>({hasErrorBoundary:!!a.hasErrorBoundary}),_N="remix-router-transitions",XN=Symbol("ResetLoaderData");function b_(a){const e=a.window?a.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u";kn(a.routes.length>0,"You must provide a non-empty routes array to createRouter");let n=a.hydrationRouteProperties||[],i=a.mapRouteProperties||p_,s=i;if(a.unstable_instrumentations){let Ge=a.unstable_instrumentations;s=Xe=>({...i(Xe),...l_(Ge.map(Je=>Je.route).filter(Boolean),Xe)})}let o={},l=Pf(a.routes,s,void 0,o),c,u=a.basename||"/";u.startsWith("/")||(u=`/${u}`);let h=a.dataStrategy||S_,A={...a.future},f=null,p=new Set,y=null,G=null,B=null,S=a.hydrationData!=null,N=Su(l,a.history.location,u),R=!1,w=null,V;if(N==null&&!a.patchRoutesOnNavigation){let Ge=Kr(404,{pathname:a.history.location.pathname}),{matches:Xe,route:Je}=tb(l);V=!0,N=Xe,w={[Je.id]:Ge}}else if(N&&!a.hydrationData&&Ot(N,l,a.history.location.pathname).active&&(N=null),N)if(N.some(Ge=>Ge.route.lazy))V=!1;else if(!N.some(Ge=>Q2(Ge.route)))V=!0;else{let Ge=a.hydrationData?a.hydrationData.loaderData:null,Xe=a.hydrationData?a.hydrationData.errors:null;if(Xe){let Je=N.findIndex(Zt=>Xe[Zt.route.id]!==void 0);V=N.slice(0,Je+1).every(Zt=>!t2(Zt.route,Ge,Xe))}else V=N.every(Je=>!t2(Je.route,Ge,Xe))}else{V=!1,N=[];let Ge=Ot(null,l,a.history.location.pathname);Ge.active&&Ge.matches&&(R=!0,N=Ge.matches)}let H,X={historyAction:a.history.action,location:a.history.location,matches:N,initialized:V,navigation:CG,restoreScrollPosition:a.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:a.hydrationData&&a.hydrationData.loaderData||{},actionData:a.hydrationData&&a.hydrationData.actionData||null,errors:a.hydrationData&&a.hydrationData.errors||w,fetchers:new Map,blockers:new Map},Y="POP",M=null,E=!1,O,P=!1,q=new Map,k=null,le=!1,F=!1,j=new Set,Q=new Map,ce=0,oe=-1,T=new Map,$=new Set,ae=new Map,Ie=new Map,be=new Set,D=new Map,de,ee=null;function Ce(){if(f=a.history.listen(({action:Ge,location:Xe,delta:Je})=>{if(de){de(),de=void 0;return}ra(D.size===0||Je!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let Zt=lt({currentLocation:X.location,nextLocation:Xe,historyAction:Ge});if(Zt&&Je!=null){let Mt=new Promise(Gt=>{de=Gt});a.history.go(Je*-1),Re(Zt,{state:"blocked",location:Xe,proceed(){Re(Zt,{state:"proceeding",proceed:void 0,reset:void 0,location:Xe}),Mt.then(()=>a.history.go(Je))},reset(){let Gt=new Map(X.blockers);Gt.set(Zt,tf),Ee({blockers:Gt})}}),M?.resolve(),M=null;return}return Le(Ge,Xe)}),t){L_(e,q);let Ge=()=>k_(e,q);e.addEventListener("pagehide",Ge),k=()=>e.removeEventListener("pagehide",Ge)}return X.initialized||Le("POP",X.location,{initialHydration:!0}),H}function we(){f&&f(),k&&k(),p.clear(),O&&O.abort(),X.fetchers.forEach((Ge,Xe)=>kt(Xe)),X.blockers.forEach((Ge,Xe)=>ye(Xe))}function Ye(Ge){return p.add(Ge),()=>p.delete(Ge)}function Ee(Ge,Xe={}){Ge.matches&&(Ge.matches=Ge.matches.map(Mt=>{let Gt=o[Mt.route.id],Ft=Mt.route;return Ft.element!==Gt.element||Ft.errorElement!==Gt.errorElement||Ft.hydrateFallbackElement!==Gt.hydrateFallbackElement?{...Mt,route:Gt}:Mt})),X={...X,...Ge};let Je=[],Zt=[];X.fetchers.forEach((Mt,Gt)=>{Mt.state==="idle"&&(be.has(Gt)?Je.push(Gt):Zt.push(Gt))}),be.forEach(Mt=>{!X.fetchers.has(Mt)&&!Q.has(Mt)&&Je.push(Mt)}),[...p].forEach(Mt=>Mt(X,{deletedFetchers:Je,newErrors:Ge.errors??null,viewTransitionOpts:Xe.viewTransitionOpts,flushSync:Xe.flushSync===!0})),Je.forEach(Mt=>kt(Mt)),Zt.forEach(Mt=>X.fetchers.delete(Mt))}function pt(Ge,Xe,{flushSync:Je}={}){let Zt=X.actionData!=null&&X.navigation.formMethod!=null&&Us(X.navigation.formMethod)&&X.navigation.state==="loading"&&Ge.state?._isRedirect!==!0,Mt;Xe.actionData?Object.keys(Xe.actionData).length>0?Mt=Xe.actionData:Mt=null:Zt?Mt=X.actionData:Mt=null;let Gt=Xe.loaderData?LZ(X.loaderData,Xe.loaderData,Xe.matches||[],Xe.errors):X.loaderData,Ft=X.blockers;Ft.size>0&&(Ft=new Map(Ft),Ft.forEach((pe,Ne)=>Ft.set(Ne,tf)));let Vt=le?!1:Ut(Ge,Xe.matches||X.matches),U=E===!0||X.navigation.formMethod!=null&&Us(X.navigation.formMethod)&&Ge.state?._isRedirect!==!0;c&&(l=c,c=void 0),le||Y==="POP"||(Y==="PUSH"?a.history.push(Ge,Ge.state):Y==="REPLACE"&&a.history.replace(Ge,Ge.state));let te;if(Y==="POP"){let pe=q.get(X.location.pathname);pe&&pe.has(Ge.pathname)?te={currentLocation:X.location,nextLocation:Ge}:q.has(Ge.pathname)&&(te={currentLocation:Ge,nextLocation:X.location})}else if(P){let pe=q.get(X.location.pathname);pe?pe.add(Ge.pathname):(pe=new Set([Ge.pathname]),q.set(X.location.pathname,pe)),te={currentLocation:X.location,nextLocation:Ge}}Ee({...Xe,actionData:Mt,loaderData:Gt,historyAction:Y,location:Ge,initialized:!0,navigation:CG,revalidation:"idle",restoreScrollPosition:Vt,preventScrollReset:U,blockers:Ft},{viewTransitionOpts:te,flushSync:Je===!0}),Y="POP",E=!1,P=!1,le=!1,F=!1,M?.resolve(),M=null,ee?.resolve(),ee=null}async function Ke(Ge,Xe){if(M?.resolve(),M=null,typeof Ge=="number"){M||(M=OZ());let ke=M.promise;return a.history.go(Ge),ke}let Je=e2(X.location,X.matches,u,Ge,Xe?.fromRouteId,Xe?.relative),{path:Zt,submission:Mt,error:Gt}=_Z(!1,Je,Xe),Ft=X.location,Vt=Jf(X.location,Zt,Xe&&Xe.state);Vt={...Vt,...a.history.encodeLocation(Vt)};let U=Xe&&Xe.replace!=null?Xe.replace:void 0,te="PUSH";U===!0?te="REPLACE":U===!1||Mt!=null&&Us(Mt.formMethod)&&Mt.formAction===X.location.pathname+X.location.search&&(te="REPLACE");let pe=Xe&&"preventScrollReset"in Xe?Xe.preventScrollReset===!0:void 0,Ne=(Xe&&Xe.flushSync)===!0,De=lt({currentLocation:Ft,nextLocation:Vt,historyAction:te});if(De){Re(De,{state:"blocked",location:Vt,proceed(){Re(De,{state:"proceeding",proceed:void 0,reset:void 0,location:Vt}),Ke(Ge,Xe)},reset(){let ke=new Map(X.blockers);ke.set(De,tf),Ee({blockers:ke})}});return}await Le(te,Vt,{submission:Mt,pendingError:Gt,preventScrollReset:pe,replace:Xe&&Xe.replace,enableViewTransition:Xe&&Xe.viewTransition,flushSync:Ne,callSiteDefaultShouldRevalidate:Xe&&Xe.unstable_defaultShouldRevalidate})}function Qe(){ee||(ee=OZ()),He(),Ee({revalidation:"loading"});let Ge=ee.promise;return X.navigation.state==="submitting"?Ge:X.navigation.state==="idle"?(Le(X.historyAction,X.location,{startUninterruptedRevalidation:!0}),Ge):(Le(Y||X.historyAction,X.navigation.location,{overrideNavigation:X.navigation,enableViewTransition:P===!0}),Ge)}async function Le(Ge,Xe,Je){O&&O.abort(),O=null,Y=Ge,le=(Je&&Je.startUninterruptedRevalidation)===!0,vt(X.location,X.matches),E=(Je&&Je.preventScrollReset)===!0,P=(Je&&Je.enableViewTransition)===!0;let Zt=c||l,Mt=Je&&Je.overrideNavigation,Gt=Je?.initialHydration&&X.matches&&X.matches.length>0&&!R?X.matches:Su(Zt,Xe,u),Ft=(Je&&Je.flushSync)===!0;if(Gt&&X.initialized&&!F&&M_(X.location,Xe)&&!(Je&&Je.submission&&Us(Je.submission.formMethod))){pt(Xe,{matches:Gt},{flushSync:Ft});return}let Vt=Ot(Gt,Zt,Xe.pathname);if(Vt.active&&Vt.matches&&(Gt=Vt.matches),!Gt){let{error:At,notFoundMatches:bt,route:ct}=Kt(Xe.pathname);pt(Xe,{matches:bt,loaderData:{},errors:{[ct.id]:At}},{flushSync:Ft});return}O=new AbortController;let U=$h(a.history,Xe,O.signal,Je&&Je.submission),te=a.getContext?await a.getContext():new wZ,pe;if(Je&&Je.pendingError)pe=[xu(Gt).route.id,{type:"error",error:Je.pendingError}];else if(Je&&Je.submission&&Us(Je.submission.formMethod)){let At=await dt(U,Xe,Je.submission,Gt,te,Vt.active,Je&&Je.initialHydration===!0,{replace:Je.replace,flushSync:Ft});if(At.shortCircuited)return;if(At.pendingActionResult){let[bt,ct]=At.pendingActionResult;if(gr(ct)&&Qf(ct.error)&&ct.error.status===404){O=null,pt(Xe,{matches:At.matches,loaderData:{},errors:{[bt]:ct.error}});return}}Gt=At.matches||Gt,pe=At.pendingActionResult,Mt=AG(Xe,Je.submission),Ft=!1,Vt.active=!1,U=$h(a.history,U.url,U.signal)}let{shortCircuited:Ne,matches:De,loaderData:ke,errors:wt}=await se(U,Xe,Gt,te,Vt.active,Mt,Je&&Je.submission,Je&&Je.fetcherSubmission,Je&&Je.replace,Je&&Je.initialHydration===!0,Ft,pe,Je&&Je.callSiteDefaultShouldRevalidate);Ne||(O=null,pt(Xe,{matches:De||Gt,...kZ(pe),loaderData:ke,errors:wt}))}async function dt(Ge,Xe,Je,Zt,Mt,Gt,Ft,Vt={}){He();let U=T_(Xe,Je);if(Ee({navigation:U},{flushSync:Vt.flushSync===!0}),Gt){let Ne=await $t(Zt,Xe.pathname,Ge.signal);if(Ne.type==="aborted")return{shortCircuited:!0};if(Ne.type==="error"){if(Ne.partialMatches.length===0){let{matches:ke,route:wt}=tb(l);return{matches:ke,pendingActionResult:[wt.id,{type:"error",error:Ne.error}]}}let De=xu(Ne.partialMatches).route.id;return{matches:Ne.partialMatches,pendingActionResult:[De,{type:"error",error:Ne.error}]}}else if(Ne.matches)Zt=Ne.matches;else{let{notFoundMatches:De,error:ke,route:wt}=Kt(Xe.pathname);return{matches:De,pendingActionResult:[wt.id,{type:"error",error:ke}]}}}let te,pe=I0(Zt,Xe);if(!pe.route.action&&!pe.route.lazy)te={type:"error",error:Kr(405,{method:Ge.method,pathname:Xe.pathname,routeId:pe.route.id})};else{let Ne=lC(s,o,Ge,Zt,pe,Ft?[]:n,Mt),De=await Ae(Ge,Ne,Mt,null);if(te=De[pe.route.id],!te){for(let ke of Zt)if(De[ke.route.id]){te=De[ke.route.id];break}}if(Ge.signal.aborted)return{shortCircuited:!0}}if(eI(te)){let Ne;return Vt&&Vt.replace!=null?Ne=Vt.replace:Ne=KZ(te.response.headers.get("Location"),new URL(Ge.url),u)===X.location.pathname+X.location.search,await z(Ge,te,!0,{submission:Je,replace:Ne}),{shortCircuited:!0}}if(gr(te)){let Ne=xu(Zt,pe.route.id);return(Vt&&Vt.replace)!==!0&&(Y="PUSH"),{matches:Zt,pendingActionResult:[Ne.route.id,te,pe.route.id]}}return{matches:Zt,pendingActionResult:[pe.route.id,te]}}async function se(Ge,Xe,Je,Zt,Mt,Gt,Ft,Vt,U,te,pe,Ne,De){let ke=Gt||AG(Xe,Ft),wt=Ft||Vt||DZ(ke),At=!le&&!te;if(Mt){if(At){let Wt=ht(Ne);Ee({navigation:ke,...Wt!==void 0?{actionData:Wt}:{}},{flushSync:pe})}let xt=await $t(Je,Xe.pathname,Ge.signal);if(xt.type==="aborted")return{shortCircuited:!0};if(xt.type==="error"){if(xt.partialMatches.length===0){let{matches:qt,route:Et}=tb(l);return{matches:qt,loaderData:{},errors:{[Et.id]:xt.error}}}let Wt=xu(xt.partialMatches).route.id;return{matches:xt.partialMatches,loaderData:{},errors:{[Wt]:xt.error}}}else if(xt.matches)Je=xt.matches;else{let{error:Wt,notFoundMatches:qt,route:Et}=Kt(Xe.pathname);return{matches:qt,loaderData:{},errors:{[Et.id]:Wt}}}}let bt=c||l,{dsMatches:ct,revalidatingFetchers:_t}=XZ(Ge,Zt,s,o,a.history,X,Je,wt,Xe,te?[]:n,te===!0,F,j,be,ae,$,bt,u,a.patchRoutesOnNavigation!=null,Ne,De);if(oe=++ce,!a.dataStrategy&&!ct.some(xt=>xt.shouldLoad)&&!ct.some(xt=>xt.route.middleware&&xt.route.middleware.length>0)&&_t.length===0){let xt=he();return pt(Xe,{matches:Je,loaderData:{},errors:Ne&&gr(Ne[1])?{[Ne[0]]:Ne[1].error}:null,...kZ(Ne),...xt?{fetchers:new Map(X.fetchers)}:{}},{flushSync:pe}),{shortCircuited:!0}}if(At){let xt={};if(!Mt){xt.navigation=ke;let Wt=ht(Ne);Wt!==void 0&&(xt.actionData=Wt)}_t.length>0&&(xt.fetchers=it(_t)),Ee(xt,{flushSync:pe})}_t.forEach(xt=>{je(xt.key),xt.controller&&Q.set(xt.key,xt.controller)});let $e=()=>_t.forEach(xt=>je(xt.key));O&&O.signal.addEventListener("abort",$e);let{loaderResults:ne,fetcherResults:ve}=await Oe(ct,_t,Ge,Zt);if(Ge.signal.aborted)return{shortCircuited:!0};O&&O.signal.removeEventListener("abort",$e),_t.forEach(xt=>Q.delete(xt.key));let xe=nb(ne);if(xe)return await z(Ge,xe.result,!0,{replace:U}),{shortCircuited:!0};if(xe=nb(ve),xe)return $.add(xe.key),await z(Ge,xe.result,!0,{replace:U}),{shortCircuited:!0};let{loaderData:We,errors:Ze}=zZ(X,Je,ne,Ne,_t,ve);te&&X.errors&&(Ze={...X.errors,...Ze});let St=he(),Xt=Ve(oe),Yt=St||Xt||_t.length>0;return{matches:Je,loaderData:We,errors:Ze,...Yt?{fetchers:new Map(X.fetchers)}:{}}}function ht(Ge){if(Ge&&!gr(Ge[1]))return{[Ge[0]]:Ge[1].data};if(X.actionData)return Object.keys(X.actionData).length===0?null:X.actionData}function it(Ge){return Ge.forEach(Xe=>{let Je=X.fetchers.get(Xe.key),Zt=nf(void 0,Je?Je.data:void 0);X.fetchers.set(Xe.key,Zt)}),new Map(X.fetchers)}async function Fe(Ge,Xe,Je,Zt){je(Ge);let Mt=(Zt&&Zt.flushSync)===!0,Gt=c||l,Ft=e2(X.location,X.matches,u,Je,Xe,Zt?.relative),Vt=Su(Gt,Ft,u),U=Ot(Vt,Gt,Ft);if(U.active&&U.matches&&(Vt=U.matches),!Vt){It(Ge,Xe,Kr(404,{pathname:Ft}),{flushSync:Mt});return}let{path:te,submission:pe,error:Ne}=_Z(!0,Ft,Zt);if(Ne){It(Ge,Xe,Ne,{flushSync:Mt});return}let De=a.getContext?await a.getContext():new wZ,ke=(Zt&&Zt.preventScrollReset)===!0;if(pe&&Us(pe.formMethod)){await st(Ge,Xe,te,Vt,De,U.active,Mt,ke,pe,Zt&&Zt.unstable_defaultShouldRevalidate);return}ae.set(Ge,{routeId:Xe,path:te}),await ie(Ge,Xe,te,Vt,De,U.active,Mt,ke,pe)}async function st(Ge,Xe,Je,Zt,Mt,Gt,Ft,Vt,U,te){He(),ae.delete(Ge);let pe=X.fetchers.get(Ge);Me(Ge,z_(U,pe),{flushSync:Ft});let Ne=new AbortController,De=$h(a.history,Je,Ne.signal,U);if(Gt){let Tt=await $t(Zt,new URL(De.url).pathname,De.signal,Ge);if(Tt.type==="aborted")return;if(Tt.type==="error"){It(Ge,Xe,Tt.error,{flushSync:Ft});return}else if(Tt.matches)Zt=Tt.matches;else{It(Ge,Xe,Kr(404,{pathname:Je}),{flushSync:Ft});return}}let ke=I0(Zt,Je);if(!ke.route.action&&!ke.route.lazy){let Tt=Kr(405,{method:U.formMethod,pathname:Je,routeId:Xe});It(Ge,Xe,Tt,{flushSync:Ft});return}Q.set(Ge,Ne);let wt=ce,At=lC(s,o,De,Zt,ke,n,Mt),bt=await Ae(De,At,Mt,Ge),ct=bt[ke.route.id];if(!ct){for(let Tt of At)if(bt[Tt.route.id]){ct=bt[Tt.route.id];break}}if(De.signal.aborted){Q.get(Ge)===Ne&&Q.delete(Ge);return}if(be.has(Ge)){if(eI(ct)||gr(ct)){Me(Ge,pg(void 0));return}}else{if(eI(ct))if(Q.delete(Ge),oe>wt){Me(Ge,pg(void 0));return}else return $.add(Ge),Me(Ge,nf(U)),z(De,ct,!1,{fetcherSubmission:U,preventScrollReset:Vt});if(gr(ct)){It(Ge,Xe,ct.error);return}}let _t=X.navigation.location||X.location,$e=$h(a.history,_t,Ne.signal),ne=c||l,ve=X.navigation.state!=="idle"?Su(ne,X.navigation.location,u):X.matches;kn(ve,"Didn't find any matches after fetcher action");let xe=++ce;T.set(Ge,xe);let We=nf(U,ct.data);X.fetchers.set(Ge,We);let{dsMatches:Ze,revalidatingFetchers:St}=XZ($e,Mt,s,o,a.history,X,ve,U,_t,n,!1,F,j,be,ae,$,ne,u,a.patchRoutesOnNavigation!=null,[ke.route.id,ct],te);St.filter(Tt=>Tt.key!==Ge).forEach(Tt=>{let fn=Tt.key,Tn=X.fetchers.get(fn),yn=nf(void 0,Tn?Tn.data:void 0);X.fetchers.set(fn,yn),je(fn),Tt.controller&&Q.set(fn,Tt.controller)}),Ee({fetchers:new Map(X.fetchers)});let Xt=()=>St.forEach(Tt=>je(Tt.key));Ne.signal.addEventListener("abort",Xt);let{loaderResults:Yt,fetcherResults:xt}=await Oe(Ze,St,$e,Mt);if(Ne.signal.aborted)return;if(Ne.signal.removeEventListener("abort",Xt),T.delete(Ge),Q.delete(Ge),St.forEach(Tt=>Q.delete(Tt.key)),X.fetchers.has(Ge)){let Tt=pg(ct.data);X.fetchers.set(Ge,Tt)}let Wt=nb(Yt);if(Wt)return z($e,Wt.result,!1,{preventScrollReset:Vt});if(Wt=nb(xt),Wt)return $.add(Wt.key),z($e,Wt.result,!1,{preventScrollReset:Vt});let{loaderData:qt,errors:Et}=zZ(X,ve,Yt,void 0,St,xt);Ve(xe),X.navigation.state==="loading"&&xe>oe?(kn(Y,"Expected pending action"),O&&O.abort(),pt(X.navigation.location,{matches:ve,loaderData:qt,errors:Et,fetchers:new Map(X.fetchers)})):(Ee({errors:Et,loaderData:LZ(X.loaderData,qt,ve,Et),fetchers:new Map(X.fetchers)}),F=!1)}async function ie(Ge,Xe,Je,Zt,Mt,Gt,Ft,Vt,U){let te=X.fetchers.get(Ge);Me(Ge,nf(U,te?te.data:void 0),{flushSync:Ft});let pe=new AbortController,Ne=$h(a.history,Je,pe.signal);if(Gt){let ct=await $t(Zt,new URL(Ne.url).pathname,Ne.signal,Ge);if(ct.type==="aborted")return;if(ct.type==="error"){It(Ge,Xe,ct.error,{flushSync:Ft});return}else if(ct.matches)Zt=ct.matches;else{It(Ge,Xe,Kr(404,{pathname:Je}),{flushSync:Ft});return}}let De=I0(Zt,Je);Q.set(Ge,pe);let ke=ce,wt=lC(s,o,Ne,Zt,De,n,Mt),bt=(await Ae(Ne,wt,Mt,Ge))[De.route.id];if(Q.get(Ge)===pe&&Q.delete(Ge),!Ne.signal.aborted){if(be.has(Ge)){Me(Ge,pg(void 0));return}if(eI(bt))if(oe>ke){Me(Ge,pg(void 0));return}else{$.add(Ge),await z(Ne,bt,!1,{preventScrollReset:Vt});return}if(gr(bt)){It(Ge,Xe,bt.error);return}Me(Ge,pg(bt.data))}}async function z(Ge,Xe,Je,{submission:Zt,fetcherSubmission:Mt,preventScrollReset:Gt,replace:Ft}={}){Je||(M?.resolve(),M=null),Xe.response.headers.has("X-Remix-Revalidate")&&(F=!0);let Vt=Xe.response.headers.get("Location");kn(Vt,"Expected a Location header on the redirect Response"),Vt=KZ(Vt,new URL(Ge.url),u);let U=Jf(X.location,Vt,{_isRedirect:!0});if(t){let wt=!1;if(Xe.response.headers.has("X-Remix-Reload-Document"))wt=!0;else if(Zy(Vt)){const At=BN(Vt,!0);wt=At.origin!==e.location.origin||kr(At.pathname,u)==null}if(wt){Ft?e.location.replace(Vt):e.location.assign(Vt);return}}O=null;let te=Ft===!0||Xe.response.headers.has("X-Remix-Replace")?"REPLACE":"PUSH",{formMethod:pe,formAction:Ne,formEncType:De}=X.navigation;!Zt&&!Mt&&pe&&Ne&&De&&(Zt=DZ(X.navigation));let ke=Zt||Mt;if(f_.has(Xe.response.status)&&ke&&Us(ke.formMethod))await Le(te,U,{submission:{...ke,formAction:Vt},preventScrollReset:Gt||E,enableViewTransition:Je?P:void 0});else{let wt=AG(U,Zt);await Le(te,U,{overrideNavigation:wt,fetcherSubmission:Mt,preventScrollReset:Gt||E,enableViewTransition:Je?P:void 0})}}async function Ae(Ge,Xe,Je,Zt){let Mt,Gt={};try{Mt=await Z_(h,Ge,Xe,Zt,Je,!1)}catch(Ft){return Xe.filter(Vt=>Vt.shouldLoad).forEach(Vt=>{Gt[Vt.route.id]={type:"error",error:Ft}}),Gt}if(Ge.signal.aborted)return Gt;if(!Us(Ge.method))for(let Ft of Xe){if(Mt[Ft.route.id]?.type==="error")break;!Mt.hasOwnProperty(Ft.route.id)&&!X.loaderData.hasOwnProperty(Ft.route.id)&&(!X.errors||!X.errors.hasOwnProperty(Ft.route.id))&&Ft.shouldCallHandler()&&(Mt[Ft.route.id]={type:"error",result:new Error(`No result returned from dataStrategy for route ${Ft.route.id}`)})}for(let[Ft,Vt]of Object.entries(Mt))if(H_(Vt)){let U=Vt.result;Gt[Ft]={type:"redirect",response:W_(U,Ge,Ft,Xe,u)}}else Gt[Ft]=await N_(Vt);return Gt}async function Oe(Ge,Xe,Je,Zt){let Mt=Ae(Je,Ge,Zt,null),Gt=Promise.all(Xe.map(async U=>{if(U.matches&&U.match&&U.request&&U.controller){let pe=(await Ae(U.request,U.matches,Zt,U.key))[U.match.route.id];return{[U.key]:pe}}else return Promise.resolve({[U.key]:{type:"error",error:Kr(404,{pathname:U.path})}})})),Ft=await Mt,Vt=(await Gt).reduce((U,te)=>Object.assign(U,te),{});return{loaderResults:Ft,fetcherResults:Vt}}function He(){F=!0,ae.forEach((Ge,Xe)=>{Q.has(Xe)&&j.add(Xe),je(Xe)})}function Me(Ge,Xe,Je={}){X.fetchers.set(Ge,Xe),Ee({fetchers:new Map(X.fetchers)},{flushSync:(Je&&Je.flushSync)===!0})}function It(Ge,Xe,Je,Zt={}){let Mt=xu(X.matches,Xe);kt(Ge),Ee({errors:{[Mt.route.id]:Je},fetchers:new Map(X.fetchers)},{flushSync:(Zt&&Zt.flushSync)===!0})}function ft(Ge){return Ie.set(Ge,(Ie.get(Ge)||0)+1),be.has(Ge)&&be.delete(Ge),X.fetchers.get(Ge)||m_}function Ht(Ge,Xe){je(Ge,Xe?.reason),Me(Ge,pg(null))}function kt(Ge){let Xe=X.fetchers.get(Ge);Q.has(Ge)&&!(Xe&&Xe.state==="loading"&&T.has(Ge))&&je(Ge),ae.delete(Ge),T.delete(Ge),$.delete(Ge),be.delete(Ge),j.delete(Ge),X.fetchers.delete(Ge)}function Pe(Ge){let Xe=(Ie.get(Ge)||0)-1;Xe<=0?(Ie.delete(Ge),be.add(Ge)):Ie.set(Ge,Xe),Ee({fetchers:new Map(X.fetchers)})}function je(Ge,Xe){let Je=Q.get(Ge);Je&&(Je.abort(Xe),Q.delete(Ge))}function ot(Ge){for(let Xe of Ge){let Je=ft(Xe),Zt=pg(Je.data);X.fetchers.set(Xe,Zt)}}function he(){let Ge=[],Xe=!1;for(let Je of $){let Zt=X.fetchers.get(Je);kn(Zt,`Expected fetcher: ${Je}`),Zt.state==="loading"&&($.delete(Je),Ge.push(Je),Xe=!0)}return ot(Ge),Xe}function Ve(Ge){let Xe=[];for(let[Je,Zt]of T)if(Zt<Ge){let Mt=X.fetchers.get(Je);kn(Mt,`Expected fetcher: ${Je}`),Mt.state==="loading"&&(je(Je),T.delete(Je),Xe.push(Je))}return ot(Xe),Xe.length>0}function Ct(Ge,Xe){let Je=X.blockers.get(Ge)||tf;return D.get(Ge)!==Xe&&D.set(Ge,Xe),Je}function ye(Ge){X.blockers.delete(Ge),D.delete(Ge)}function Re(Ge,Xe){let Je=X.blockers.get(Ge)||tf;kn(Je.state==="unblocked"&&Xe.state==="blocked"||Je.state==="blocked"&&Xe.state==="blocked"||Je.state==="blocked"&&Xe.state==="proceeding"||Je.state==="blocked"&&Xe.state==="unblocked"||Je.state==="proceeding"&&Xe.state==="unblocked",`Invalid blocker state transition: ${Je.state} -> ${Xe.state}`);let Zt=new Map(X.blockers);Zt.set(Ge,Xe),Ee({blockers:Zt})}function lt({currentLocation:Ge,nextLocation:Xe,historyAction:Je}){if(D.size===0)return;D.size>1&&ra(!1,"A router only supports one blocker at a time");let Zt=Array.from(D.entries()),[Mt,Gt]=Zt[Zt.length-1],Ft=X.blockers.get(Mt);if(!(Ft&&Ft.state==="proceeding")&&Gt({currentLocation:Ge,nextLocation:Xe,historyAction:Je}))return Mt}function Kt(Ge){let Xe=Kr(404,{pathname:Ge}),Je=c||l,{matches:Zt,route:Mt}=tb(Je);return{notFoundMatches:Zt,route:Mt,error:Xe}}function gt(Ge,Xe,Je){if(y=Ge,B=Xe,G=Je||null,!S&&X.navigation===CG){S=!0;let Zt=Ut(X.location,X.matches);Zt!=null&&Ee({restoreScrollPosition:Zt})}return()=>{y=null,B=null,G=null}}function qe(Ge,Xe){return G&&G(Ge,Xe.map(Zt=>k5(Zt,X.loaderData)))||Ge.key}function vt(Ge,Xe){if(y&&B){let Je=qe(Ge,Xe);y[Je]=B()}}function Ut(Ge,Xe){if(y){let Je=qe(Ge,Xe),Zt=y[Je];if(typeof Zt=="number")return Zt}return null}function Ot(Ge,Xe,Je){if(a.patchRoutesOnNavigation)if(Ge){if(Object.keys(Ge[0].params).length>0)return{active:!0,matches:xf(Xe,Je,u,!0)}}else return{active:!0,matches:xf(Xe,Je,u,!0)||[]};return{active:!1,matches:null}}async function $t(Ge,Xe,Je,Zt){if(!a.patchRoutesOnNavigation)return{type:"success",matches:Ge};let Mt=Ge;for(;;){let Gt=c==null,Ft=c||l,Vt=o;try{await a.patchRoutesOnNavigation({signal:Je,path:Xe,matches:Mt,fetcherKey:Zt,patch:(pe,Ne)=>{Je.aborted||YZ(pe,Ne,Ft,Vt,s,!1)}})}catch(pe){return{type:"error",error:pe,partialMatches:Mt}}finally{Gt&&!Je.aborted&&(l=[...l])}if(Je.aborted)return{type:"aborted"};let U=Su(Ft,Xe,u),te=null;if(U){if(Object.keys(U[0].params).length===0)return{type:"success",matches:U};if(te=xf(Ft,Xe,u,!0),!(te&&Mt.length<te.length&&Rn(Mt,te.slice(0,Mt.length))))return{type:"success",matches:U}}if(te||(te=xf(Ft,Xe,u,!0)),!te||Rn(Mt,te))return{type:"success",matches:null};Mt=te}}function Rn(Ge,Xe){return Ge.length===Xe.length&&Ge.every((Je,Zt)=>Je.route.id===Xe[Zt].route.id)}function Kn(Ge){o={},c=Pf(Ge,s,void 0,o)}function Ci(Ge,Xe,Je=!1){let Zt=c==null;YZ(Ge,Xe,c||l,o,s,Je),Zt&&(l=[...l],Ee({}))}return H={get basename(){return u},get future(){return A},get state(){return X},get routes(){return l},get window(){return e},initialize:Ce,subscribe:Ye,enableScrollRestoration:gt,navigate:Ke,fetch:Fe,revalidate:Qe,createHref:Ge=>a.history.createHref(Ge),encodeLocation:Ge=>a.history.encodeLocation(Ge),getFetcher:ft,resetFetcher:Ht,deleteFetcher:Pe,dispose:we,getBlocker:Ct,deleteBlocker:ye,patchRoutes:Ci,_internalFetchControllers:Q,_internalSetRoutes:Kn,_internalSetStateDoNotUseOrYouWillBreakYourApp(Ge){Ee(Ge)}},a.unstable_instrumentations&&(H=c_(H,a.unstable_instrumentations.map(Ge=>Ge.router).filter(Boolean))),H}function y_(a){return a!=null&&("formData"in a&&a.formData!=null||"body"in a&&a.body!==void 0)}function e2(a,e,t,n,i,s){let o,l;if(i){o=[];for(let u of e)if(o.push(u),u.route.id===i){l=u;break}}else o=e,l=e[e.length-1];let c=Ry(n||".",wy(o),kr(a.pathname,t)||a.pathname,s==="path");if(n==null&&(c.search=a.search,c.hash=a.hash),(n==null||n===""||n===".")&&l){let u=$2(c.search);if(l.route.index&&!u)c.search=c.search?c.search.replace(/^\?/,"?index&"):"?index";else if(!l.route.index&&u){let h=new URLSearchParams(c.search),A=h.getAll("index");h.delete("index"),A.filter(p=>p).forEach(p=>h.append("index",p));let f=h.toString();c.search=f?`?${f}`:""}}return t!=="/"&&(c.pathname=i_({basename:t,pathname:c.pathname})),Zc(c)}function _Z(a,e,t){if(!t||!y_(t))return{path:e};if(t.formMethod&&!K_(t.formMethod))return{path:e,error:Kr(405,{method:t.formMethod})};let n=()=>({path:e,error:Kr(400,{type:"invalid-body"})}),s=(t.formMethod||"get").toUpperCase(),o=TN(e);if(t.body!==void 0){if(t.formEncType==="text/plain"){if(!Us(s))return n();let A=typeof t.body=="string"?t.body:t.body instanceof FormData||t.body instanceof URLSearchParams?Array.from(t.body.entries()).reduce((f,[p,y])=>`${f}${p}=${y}
`,""):String(t.body);return{path:e,submission:{formMethod:s,formAction:o,formEncType:t.formEncType,formData:void 0,json:void 0,text:A}}}else if(t.formEncType==="application/json"){if(!Us(s))return n();try{let A=typeof t.body=="string"?JSON.parse(t.body):t.body;return{path:e,submission:{formMethod:s,formAction:o,formEncType:t.formEncType,formData:void 0,json:A,text:void 0}}}catch{return n()}}}kn(typeof FormData=="function","FormData is not available in this environment");let l,c;if(t.formData)l=i2(t.formData),c=t.formData;else if(t.body instanceof FormData)l=i2(t.body),c=t.body;else if(t.body instanceof URLSearchParams)l=t.body,c=TZ(l);else if(t.body==null)l=new URLSearchParams,c=new FormData;else try{l=new URLSearchParams(t.body),c=TZ(l)}catch{return n()}let u={formMethod:s,formAction:o,formEncType:t&&t.formEncType||"application/x-www-form-urlencoded",formData:c,json:void 0,text:void 0};if(Us(u.formMethod))return{path:e,submission:u};let h=Rg(e);return a&&h.search&&$2(h.search)&&l.append("index",""),h.search=`?${l}`,{path:Zc(h),submission:u}}function XZ(a,e,t,n,i,s,o,l,c,u,h,A,f,p,y,G,B,S,N,R,w){let V=R?gr(R[1])?R[1].error:R[1].data:void 0,H=i.createURL(s.location),X=i.createURL(c),Y;if(h&&s.errors){let le=Object.keys(s.errors)[0];Y=o.findIndex(F=>F.route.id===le)}else if(R&&gr(R[1])){let le=R[0];Y=o.findIndex(F=>F.route.id===le)-1}let M=R?R[1].statusCode:void 0,E=M&&M>=400,O={currentUrl:H,currentParams:s.matches[0]?.params||{},nextUrl:X,nextParams:o[0].params,...l,actionResult:V,actionStatus:M},P=Bm(o),q=o.map((le,F)=>{let{route:j}=le,Q=null;if(Y!=null&&F>Y?Q=!1:j.lazy?Q=!0:Q2(j)?h?Q=t2(j,s.loaderData,s.errors):v_(s.loaderData,s.matches[F],le)&&(Q=!0):Q=!1,Q!==null)return n2(t,n,a,P,le,u,e,Q);let ce=!1;typeof w=="boolean"?ce=w:E?ce=!1:(A||H.pathname+H.search===X.pathname+X.search||H.search!==X.search||G_(s.matches[F],le))&&(ce=!0);let oe={...O,defaultShouldRevalidate:ce},T=Mf(le,oe);return n2(t,n,a,P,le,u,e,T,oe,w)}),k=[];return y.forEach((le,F)=>{if(h||!o.some(Ie=>Ie.route.id===le.routeId)||p.has(F))return;let j=s.fetchers.get(F),Q=j&&j.state!=="idle"&&j.data===void 0,ce=Su(B,le.path,S);if(!ce){if(N&&Q)return;k.push({key:F,routeId:le.routeId,path:le.path,matches:null,match:null,request:null,controller:null});return}if(G.has(F))return;let oe=I0(ce,le.path),T=new AbortController,$=$h(i,le.path,T.signal),ae=null;if(f.has(F))f.delete(F),ae=lC(t,n,$,ce,oe,u,e);else if(Q)A&&(ae=lC(t,n,$,ce,oe,u,e));else{let Ie;typeof w=="boolean"?Ie=w:E?Ie=!1:Ie=A;let be={...O,defaultShouldRevalidate:Ie};Mf(oe,be)&&(ae=lC(t,n,$,ce,oe,u,e,be))}ae&&k.push({key:F,routeId:le.routeId,path:le.path,matches:ae,match:oe,request:$,controller:T})}),{dsMatches:q,revalidatingFetchers:k}}function Q2(a){return a.loader!=null||a.middleware!=null&&a.middleware.length>0}function t2(a,e,t){if(a.lazy)return!0;if(!Q2(a))return!1;let n=e!=null&&a.id in e,i=t!=null&&t[a.id]!==void 0;return!n&&i?!1:typeof a.loader=="function"&&a.loader.hydrate===!0?!0:!n&&!i}function v_(a,e,t){let n=!e||t.route.id!==e.route.id,i=!a.hasOwnProperty(t.route.id);return n||i}function G_(a,e){let t=a.route.path;return a.pathname!==e.pathname||t!=null&&t.endsWith("*")&&a.params["*"]!==e.params["*"]}function Mf(a,e){if(a.route.shouldRevalidate){let t=a.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}function YZ(a,e,t,n,i,s){let o;if(a){let u=n[a];kn(u,`No route found to patch children into: routeId = ${a}`),u.children||(u.children=[]),o=u.children}else o=t;let l=[],c=[];if(e.forEach(u=>{let h=o.find(A=>YN(u,A));h?c.push({existingRoute:h,newRoute:u}):l.push(u)}),l.length>0){let u=Pf(l,i,[a||"_","patch",String(o?.length||"0")],n);o.push(...u)}if(s&&c.length>0)for(let u=0;u<c.length;u++){let{existingRoute:h,newRoute:A}=c[u],f=h,[p]=Pf([A],i,[],{},!0);Object.assign(f,{element:p.element?p.element:f.element,errorElement:p.errorElement?p.errorElement:f.errorElement,hydrateFallbackElement:p.hydrateFallbackElement?p.hydrateFallbackElement:f.hydrateFallbackElement})}}function YN(a,e){return"id"in a&&"id"in e&&a.id===e.id?!0:a.index===e.index&&a.path===e.path&&a.caseSensitive===e.caseSensitive?(!a.children||a.children.length===0)&&(!e.children||e.children.length===0)?!0:a.children.every((t,n)=>e.children?.some(i=>YN(t,i))):!1}var HZ=new WeakMap,HN=({key:a,route:e,manifest:t,mapRouteProperties:n})=>{let i=t[e.id];if(kn(i,"No route found in manifest"),!i.lazy||typeof i.lazy!="object")return;let s=i.lazy[a];if(!s)return;let o=HZ.get(i);o||(o={},HZ.set(i,o));let l=o[a];if(l)return l;let c=(async()=>{let u=K5(a),A=i[a]!==void 0&&a!=="hasErrorBoundary";if(u)ra(!u,"Route property "+a+" is not a supported lazy route property. This property will be ignored."),o[a]=Promise.resolve();else if(A)ra(!1,`Route "${i.id}" has a static property "${a}" defined. The lazy property will be ignored.`);else{let f=await s();f!=null&&(Object.assign(i,{[a]:f}),Object.assign(i,n(i)))}typeof i.lazy=="object"&&(i.lazy[a]=void 0,Object.values(i.lazy).every(f=>f===void 0)&&(i.lazy=void 0))})();return o[a]=c,c},EZ=new WeakMap;function B_(a,e,t,n,i){let s=t[a.id];if(kn(s,"No route found in manifest"),!a.lazy)return{lazyRoutePromise:void 0,lazyHandlerPromise:void 0};if(typeof a.lazy=="function"){let h=EZ.get(s);if(h)return{lazyRoutePromise:h,lazyHandlerPromise:h};let A=(async()=>{kn(typeof a.lazy=="function","No lazy route function found");let f=await a.lazy(),p={};for(let y in f){let G=f[y];if(G===void 0)continue;let B=z5(y),N=s[y]!==void 0&&y!=="hasErrorBoundary";B?ra(!B,"Route property "+y+" is not a supported property to be returned from a lazy route function. This property will be ignored."):N?ra(!N,`Route "${s.id}" has a static property "${y}" defined but its lazy function is also returning a value for this property. The lazy route property "${y}" will be ignored.`):p[y]=G}Object.assign(s,p),Object.assign(s,{...n(s),lazy:void 0})})();return EZ.set(s,A),A.catch(()=>{}),{lazyRoutePromise:A,lazyHandlerPromise:A}}let o=Object.keys(a.lazy),l=[],c;for(let h of o){if(i&&i.includes(h))continue;let A=HN({key:h,route:a,manifest:t,mapRouteProperties:n});A&&(l.push(A),h===e&&(c=A))}let u=l.length>0?Promise.all(l).then(()=>{}):void 0;return u?.catch(()=>{}),c?.catch(()=>{}),{lazyRoutePromise:u,lazyHandlerPromise:c}}async function FZ(a){let e=a.matches.filter(i=>i.shouldLoad),t={};return(await Promise.all(e.map(i=>i.resolve()))).forEach((i,s)=>{t[e[s].route.id]=i}),t}async function S_(a){return a.matches.some(e=>e.route.middleware)?EN(a,()=>FZ(a)):FZ(a)}function EN(a,e){return x_(a,e,n=>{if(F_(n))throw n;return n},X_,t);function t(n,i,s){if(s)return Promise.resolve(Object.assign(s.value,{[i]:{type:"error",result:n}}));{let{matches:o}=a,l=Math.min(Math.max(o.findIndex(u=>u.route.id===i),0),Math.max(o.findIndex(u=>u.shouldCallHandler()),0)),c=xu(o,o[l].route.id).route.id;return Promise.resolve({[c]:{type:"error",result:n}})}}}async function x_(a,e,t,n,i){let{matches:s,request:o,params:l,context:c,unstable_pattern:u}=a,h=s.flatMap(f=>f.route.middleware?f.route.middleware.map(p=>[f.route.id,p]):[]);return await FN({request:o,params:l,context:c,unstable_pattern:u},h,e,t,n,i)}async function FN(a,e,t,n,i,s,o=0){let{request:l}=a;if(l.signal.aborted)throw l.signal.reason??new Error(`Request aborted: ${l.method} ${l.url}`);let c=e[o];if(!c)return await t();let[u,h]=c,A,f=async()=>{if(A)throw new Error("You may only call `next()` once per middleware");try{return A={value:await FN(a,e,t,n,i,s,o+1)},A.value}catch(p){return A={value:await s(p,u,A)},A.value}};try{let p=await h(a,f),y=p!=null?n(p):void 0;return i(y)?y:A?y??A.value:(A={value:await f()},A.value)}catch(p){return await s(p,u,A)}}function KN(a,e,t,n,i){let s=HN({key:"middleware",route:n.route,manifest:e,mapRouteProperties:a}),o=B_(n.route,Us(t.method)?"action":"loader",e,a,i);return{middleware:s,route:o.lazyRoutePromise,handler:o.lazyHandlerPromise}}function n2(a,e,t,n,i,s,o,l,c=null,u){let h=!1,A=KN(a,e,t,i,s);return{...i,_lazyPromises:A,shouldLoad:l,shouldRevalidateArgs:c,shouldCallHandler(f){return h=!0,c?typeof u=="boolean"?Mf(i,{...c,defaultShouldRevalidate:u}):typeof f=="boolean"?Mf(i,{...c,defaultShouldRevalidate:f}):Mf(i,c):l},resolve(f){let{lazy:p,loader:y,middleware:G}=i.route,B=h||l||f&&!Us(t.method)&&(p||y),S=G&&G.length>0&&!y&&!p;return B&&(Us(t.method)||!S)?w_({request:t,unstable_pattern:n,match:i,lazyHandlerPromise:A?.handler,lazyRoutePromise:A?.route,handlerOverride:f,scopedContext:o}):Promise.resolve({type:"data",result:void 0})}}}function lC(a,e,t,n,i,s,o,l=null){return n.map(c=>c.route.id!==i.route.id?{...c,shouldLoad:!1,shouldRevalidateArgs:l,shouldCallHandler:()=>!1,_lazyPromises:KN(a,e,t,c,s),resolve:()=>Promise.resolve({type:"data",result:void 0})}:n2(a,e,t,Bm(n),c,s,o,!0,l))}async function Z_(a,e,t,n,i,s){t.some(u=>u._lazyPromises?.middleware)&&await Promise.all(t.map(u=>u._lazyPromises?.middleware));let o={request:e,unstable_pattern:Bm(t),params:t[0].params,context:i,matches:t},c=await a({...o,fetcherKey:n,runClientMiddleware:u=>{let h=o;return EN(h,()=>u({...h,fetcherKey:n,runClientMiddleware:()=>{throw new Error("Cannot call `runClientMiddleware()` from within an `runClientMiddleware` handler")}}))}});try{await Promise.all(t.flatMap(u=>[u._lazyPromises?.handler,u._lazyPromises?.route]))}catch{}return c}async function w_({request:a,unstable_pattern:e,match:t,lazyHandlerPromise:n,lazyRoutePromise:i,handlerOverride:s,scopedContext:o}){let l,c,u=Us(a.method),h=u?"action":"loader",A=f=>{let p,y=new Promise((S,N)=>p=N);c=()=>p(),a.signal.addEventListener("abort",c);let G=S=>typeof f!="function"?Promise.reject(new Error(`You cannot call the handler for a route which defines a boolean "${h}" [routeId: ${t.route.id}]`)):f({request:a,unstable_pattern:e,params:t.params,context:o},...S!==void 0?[S]:[]),B=(async()=>{try{return{type:"data",result:await(s?s(N=>G(N)):G())}}catch(S){return{type:"error",result:S}}})();return Promise.race([B,y])};try{let f=u?t.route.action:t.route.loader;if(n||i)if(f){let p,[y]=await Promise.all([A(f).catch(G=>{p=G}),n,i]);if(p!==void 0)throw p;l=y}else{await n;let p=u?t.route.action:t.route.loader;if(p)[l]=await Promise.all([A(p),i]);else if(h==="action"){let y=new URL(a.url),G=y.pathname+y.search;throw Kr(405,{method:a.method,pathname:G,routeId:t.route.id})}else return{type:"data",result:void 0}}else if(f)l=await A(f);else{let p=new URL(a.url),y=p.pathname+p.search;throw Kr(404,{pathname:y})}}catch(f){return{type:"error",result:f}}finally{c&&a.signal.removeEventListener("abort",c)}return l}async function R_(a){let e=a.headers.get("Content-Type");return e&&/\bapplication\/json\b/.test(e)?a.body==null?null:a.json():a.text()}async function N_(a){let{result:e,type:t}=a;if(q2(e)){let n;try{n=await R_(e)}catch(i){return{type:"error",error:i}}return t==="error"?{type:"error",error:new Gm(e.status,e.statusText,n),statusCode:e.status,headers:e.headers}:{type:"data",data:n,statusCode:e.status,headers:e.headers}}return t==="error"?UZ(e)?e.data instanceof Error?{type:"error",error:e.data,statusCode:e.init?.status,headers:e.init?.headers?new Headers(e.init.headers):void 0}:{type:"error",error:__(e),statusCode:Qf(e)?e.status:void 0,headers:e.init?.headers?new Headers(e.init.headers):void 0}:{type:"error",error:e,statusCode:Qf(e)?e.status:void 0}:UZ(e)?{type:"data",data:e.data,statusCode:e.init?.status,headers:e.init?.headers?new Headers(e.init.headers):void 0}:{type:"data",data:e}}function W_(a,e,t,n,i){let s=a.headers.get("Location");if(kn(s,"Redirects returned/thrown from loaders/actions must have a Location header"),!Zy(s)){let o=n.slice(0,n.findIndex(l=>l.route.id===t)+1);s=e2(new URL(e.url),o,i,s),a.headers.set("Location",s)}return a}function KZ(a,e,t){if(Zy(a)){let n=a,i=n.startsWith("//")?new URL(e.protocol+n):new URL(n),s=kr(i.pathname,t)!=null;if(i.origin===e.origin&&s)return i.pathname+i.search+i.hash}return a}function $h(a,e,t,n){let i=a.createURL(TN(e)).toString(),s={signal:t};if(n&&Us(n.formMethod)){let{formMethod:o,formEncType:l}=n;s.method=o.toUpperCase(),l==="application/json"?(s.headers=new Headers({"Content-Type":l}),s.body=JSON.stringify(n.json)):l==="text/plain"?s.body=n.text:l==="application/x-www-form-urlencoded"&&n.formData?s.body=i2(n.formData):s.body=n.formData}return new Request(i,s)}function i2(a){let e=new URLSearchParams;for(let[t,n]of a.entries())e.append(t,typeof n=="string"?n:n.name);return e}function TZ(a){let e=new FormData;for(let[t,n]of a.entries())e.append(t,n);return e}function V_(a,e,t,n=!1,i=!1){let s={},o=null,l,c=!1,u={},h=t&&gr(t[1])?t[1].error:void 0;return a.forEach(A=>{if(!(A.route.id in e))return;let f=A.route.id,p=e[f];if(kn(!eI(p),"Cannot handle redirect results in processLoaderData"),gr(p)){let y=p.error;if(h!==void 0&&(y=h,h=void 0),o=o||{},i)o[f]=y;else{let G=xu(a,f);o[G.route.id]==null&&(o[G.route.id]=y)}n||(s[f]=XN),c||(c=!0,l=Qf(p.error)?p.error.status:500),p.headers&&(u[f]=p.headers)}else s[f]=p.data,p.statusCode&&p.statusCode!==200&&!c&&(l=p.statusCode),p.headers&&(u[f]=p.headers)}),h!==void 0&&t&&(o={[t[0]]:h},t[2]&&(s[t[2]]=void 0)),{loaderData:s,errors:o,statusCode:l||200,loaderHeaders:u}}function zZ(a,e,t,n,i,s){let{loaderData:o,errors:l}=V_(e,t,n);return i.filter(c=>!c.matches||c.matches.some(u=>u.shouldLoad)).forEach(c=>{let{key:u,match:h,controller:A}=c;if(A&&A.signal.aborted)return;let f=s[u];if(kn(f,"Did not find corresponding fetcher result"),gr(f)){let p=xu(a.matches,h?.route.id);l&&l[p.route.id]||(l={...l,[p.route.id]:f.error}),a.fetchers.delete(u)}else if(eI(f))kn(!1,"Unhandled fetcher revalidation redirect");else{let p=pg(f.data);a.fetchers.set(u,p)}}),{loaderData:o,errors:l}}function LZ(a,e,t,n){let i=Object.entries(e).filter(([,s])=>s!==XN).reduce((s,[o,l])=>(s[o]=l,s),{});for(let s of t){let o=s.route.id;if(!e.hasOwnProperty(o)&&a.hasOwnProperty(o)&&s.route.loader&&(i[o]=a[o]),n&&n.hasOwnProperty(o))break}return i}function kZ(a){return a?gr(a[1])?{actionData:{}}:{actionData:{[a[0]]:a[1].data}}:{}}function xu(a,e){return(e?a.slice(0,a.findIndex(n=>n.route.id===e)+1):[...a]).reverse().find(n=>n.route.hasErrorBoundary===!0)||a[0]}function tb(a){let e=a.length===1?a[0]:a.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Kr(a,{pathname:e,routeId:t,method:n,type:i,message:s}={}){let o="Unknown Server Error",l="Unknown @remix-run/router error";return a===400?(o="Bad Request",n&&e&&t?l=`You made a ${n} request to "${e}" but did not provide a \`loader\` for route "${t}", so there is no way to handle the request.`:i==="invalid-body"&&(l="Unable to encode submission body")):a===403?(o="Forbidden",l=`Route "${t}" does not match URL "${e}"`):a===404?(o="Not Found",l=`No route matches URL "${e}"`):a===405&&(o="Method Not Allowed",n&&e&&t?l=`You made a ${n.toUpperCase()} request to "${e}" but did not provide an \`action\` for route "${t}", so there is no way to handle the request.`:n&&(l=`Invalid request method "${n.toUpperCase()}"`)),new Gm(a||500,o,new Error(l),!0)}function nb(a){let e=Object.entries(a);for(let t=e.length-1;t>=0;t--){let[n,i]=e[t];if(eI(i))return{key:n,result:i}}}function TN(a){let e=typeof a=="string"?Rg(a):a;return Zc({...e,hash:""})}function M_(a,e){return a.pathname!==e.pathname||a.search!==e.search?!1:a.hash===""?e.hash!=="":a.hash===e.hash?!0:e.hash!==""}function __(a){return new Gm(a.init?.status??500,a.init?.statusText??"Internal Server Error",a.data)}function X_(a){return a!=null&&typeof a=="object"&&Object.entries(a).every(([e,t])=>typeof e=="string"&&Y_(t))}function Y_(a){return a!=null&&typeof a=="object"&&"type"in a&&"result"in a&&(a.type==="data"||a.type==="error")}function H_(a){return q2(a.result)&&MN.has(a.result.status)}function gr(a){return a.type==="error"}function eI(a){return(a&&a.type)==="redirect"}function UZ(a){return typeof a=="object"&&a!=null&&"type"in a&&"data"in a&&"init"in a&&a.type==="DataWithResponseInit"}function q2(a){return a!=null&&typeof a.status=="number"&&typeof a.statusText=="string"&&typeof a.headers=="object"&&typeof a.body<"u"}function E_(a){return MN.has(a)}function F_(a){return q2(a)&&E_(a.status)&&a.headers.has("Location")}function K_(a){return A_.has(a.toUpperCase())}function Us(a){return h_.has(a.toUpperCase())}function $2(a){return new URLSearchParams(a).getAll("index").some(e=>e==="")}function I0(a,e){let t=typeof e=="string"?Rg(e).search:e.search;if(a[a.length-1].route.index&&$2(t||""))return a[a.length-1];let n=wN(a);return n[n.length-1]}function DZ(a){let{formMethod:e,formAction:t,formEncType:n,text:i,formData:s,json:o}=a;if(!(!e||!t||!n)){if(i!=null)return{formMethod:e,formAction:t,formEncType:n,formData:void 0,json:void 0,text:i};if(s!=null)return{formMethod:e,formAction:t,formEncType:n,formData:s,json:void 0,text:void 0};if(o!==void 0)return{formMethod:e,formAction:t,formEncType:n,formData:void 0,json:o,text:void 0}}}function AG(a,e){return e?{state:"loading",location:a,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:a,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function T_(a,e){return{state:"submitting",location:a,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function nf(a,e){return a?{state:"loading",formMethod:a.formMethod,formAction:a.formAction,formEncType:a.formEncType,formData:a.formData,json:a.json,text:a.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function z_(a,e){return{state:"submitting",formMethod:a.formMethod,formAction:a.formAction,formEncType:a.formEncType,formData:a.formData,json:a.json,text:a.text,data:e?e.data:void 0}}function pg(a){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:a}}function L_(a,e){try{let t=a.sessionStorage.getItem(_N);if(t){let n=JSON.parse(t);for(let[i,s]of Object.entries(n||{}))s&&Array.isArray(s)&&e.set(i,new Set(s||[]))}}catch{}}function k_(a,e){if(e.size>0){let t={};for(let[n,i]of e)t[n]=[...i];try{a.sessionStorage.setItem(_N,JSON.stringify(t))}catch(n){ra(!1,`Failed to save applied view transitions in sessionStorage (${n}).`)}}}function OZ(){let a,e,t=new Promise((n,i)=>{a=async s=>{n(s);try{await t}catch{}},e=async s=>{i(s);try{await t}catch{}}});return{promise:t,resolve:a,reject:e}}var mI=J.createContext(null);mI.displayName="DataRouter";var Sm=J.createContext(null);Sm.displayName="DataRouterState";var zN=J.createContext(!1);function U_(){return J.useContext(zN)}var eS=J.createContext({isTransitioning:!1});eS.displayName="ViewTransition";var LN=J.createContext(new Map);LN.displayName="Fetchers";var D_=J.createContext(null);D_.displayName="Await";var mr=J.createContext(null);mr.displayName="Navigation";var Ny=J.createContext(null);Ny.displayName="Location";var Ur=J.createContext({outlet:null,matches:[],isDataRoute:!1});Ur.displayName="Route";var tS=J.createContext(null);tS.displayName="RouteError";var kN="REACT_ROUTER_ERROR",O_="REDIRECT",j_="ROUTE_ERROR_RESPONSE";function J_(a){if(a.startsWith(`${kN}:${O_}:{`))try{let e=JSON.parse(a.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function P_(a){if(a.startsWith(`${kN}:${j_}:{`))try{let e=JSON.parse(a.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Gm(e.status,e.statusText,e.data)}catch{}}function Q_(a,{relative:e}={}){kn(ZC(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=J.useContext(mr),{hash:i,pathname:s,search:o}=xm(a,{relative:e}),l=s;return t!=="/"&&(l=s==="/"?t:Sc([t,s])),n.createHref({pathname:l,search:o,hash:i})}function ZC(){return J.useContext(Ny)!=null}function Fu(){return kn(ZC(),"useLocation() may be used only in the context of a <Router> component."),J.useContext(Ny).location}var UN="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function DN(a){J.useContext(mr).static||J.useLayoutEffect(a)}function Ng(){let{isDataRoute:a}=J.useContext(Ur);return a?dX():q_()}function q_(){kn(ZC(),"useNavigate() may be used only in the context of a <Router> component.");let a=J.useContext(mI),{basename:e,navigator:t}=J.useContext(mr),{matches:n}=J.useContext(Ur),{pathname:i}=Fu(),s=JSON.stringify(wy(n)),o=J.useRef(!1);return DN(()=>{o.current=!0}),J.useCallback((c,u={})=>{if(ra(o.current,UN),!o.current)return;if(typeof c=="number"){t.go(c);return}let h=Ry(c,JSON.parse(s),i,u.relative==="path");a==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Sc([e,h.pathname])),(u.replace?t.replace:t.push)(h,u.state,u)},[e,t,s,i,a])}var $_=J.createContext(null);function eX(a){let e=J.useContext(Ur).outlet;return J.useMemo(()=>e&&J.createElement($_.Provider,{value:a},e),[e,a])}function ON(){let{matches:a}=J.useContext(Ur),e=a[a.length-1];return e?e.params:{}}function xm(a,{relative:e}={}){let{matches:t}=J.useContext(Ur),{pathname:n}=Fu(),i=JSON.stringify(wy(t));return J.useMemo(()=>Ry(a,JSON.parse(i),n,e==="path"),[a,i,n,e])}function tX(a,e,t,n,i){kn(ZC(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:s}=J.useContext(mr),{matches:o}=J.useContext(Ur),l=o[o.length-1],c=l?l.params:{},u=l?l.pathname:"/",h=l?l.pathnameBase:"/",A=l&&l.route;{let N=A&&A.path||"";JN(u,!A||N.endsWith("*")||N.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${u}" (under <Route path="${N}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${N}"> to <Route path="${N==="/"?"*":`${N}/*`}">.`)}let f=Fu(),p;p=f;let y=p.pathname||"/",G=y;if(h!=="/"){let N=h.replace(/^\//,"").split("/");G="/"+y.replace(/^\//,"").split("/").slice(N.length).join("/")}let B=Su(a,{pathname:G});return ra(A||B!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),ra(B==null||B[B.length-1].route.element!==void 0||B[B.length-1].route.Component!==void 0||B[B.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`),oX(B&&B.map(N=>Object.assign({},N,{params:Object.assign({},c,N.params),pathname:Sc([h,s.encodeLocation?s.encodeLocation(N.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:N.pathname]),pathnameBase:N.pathnameBase==="/"?h:Sc([h,s.encodeLocation?s.encodeLocation(N.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:N.pathnameBase])})),o,t,n,i)}function nX(){let a=uX(),e=Qf(a)?`${a.status} ${a.statusText}`:a instanceof Error?a.message:JSON.stringify(a),t=a instanceof Error?a.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},o=null;return console.error("Error handled by React Router default ErrorBoundary:",a),o=J.createElement(J.Fragment,null,J.createElement("p",null," Hey developer "),J.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",J.createElement("code",{style:s},"ErrorBoundary")," or"," ",J.createElement("code",{style:s},"errorElement")," prop on your route.")),J.createElement(J.Fragment,null,J.createElement("h2",null,"Unexpected Application Error!"),J.createElement("h3",{style:{fontStyle:"italic"}},e),t?J.createElement("pre",{style:i},t):null,o)}var iX=J.createElement(nX,null),jN=class extends J.Component{constructor(a){super(a),this.state={location:a.location,revalidation:a.revalidation,error:a.error}}static getDerivedStateFromError(a){return{error:a}}static getDerivedStateFromProps(a,e){return e.location!==a.location||e.revalidation!=="idle"&&a.revalidation==="idle"?{error:a.error,location:a.location,revalidation:a.revalidation}:{error:a.error!==void 0?a.error:e.error,location:e.location,revalidation:a.revalidation||e.revalidation}}componentDidCatch(a,e){this.props.onError?this.props.onError(a,e):console.error("React Router caught the following error during render",a)}render(){let a=this.state.error;if(this.context&&typeof a=="object"&&a&&"digest"in a&&typeof a.digest=="string"){const t=P_(a.digest);t&&(a=t)}let e=a!==void 0?J.createElement(Ur.Provider,{value:this.props.routeContext},J.createElement(tS.Provider,{value:a,children:this.props.component})):this.props.children;return this.context?J.createElement(aX,{error:a},e):e}};jN.contextType=zN;var fG=new WeakMap;function aX({children:a,error:e}){let{basename:t}=J.useContext(mr);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let n=J_(e.digest);if(n){let i=fG.get(e);if(i)throw i;let s=NN(n.location,t);if(RN&&!fG.get(e))if(s.isExternal||n.reloadDocument)window.location.href=s.absoluteURL||s.to;else{const o=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(s.to,{replace:n.replace}));throw fG.set(e,o),o}return J.createElement("meta",{httpEquiv:"refresh",content:`0;url=${s.absoluteURL||s.to}`})}}return a}function sX({routeContext:a,match:e,children:t}){let n=J.useContext(mI);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),J.createElement(Ur.Provider,{value:a},t)}function oX(a,e=[],t=null,n=null,i=null){if(a==null){if(!t)return null;if(t.errors)a=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)a=t.matches;else return null}let s=a,o=t?.errors;if(o!=null){let h=s.findIndex(A=>A.route.id&&o?.[A.route.id]!==void 0);kn(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(o).join(",")}`),s=s.slice(0,Math.min(s.length,h+1))}let l=!1,c=-1;if(t)for(let h=0;h<s.length;h++){let A=s[h];if((A.route.HydrateFallback||A.route.hydrateFallbackElement)&&(c=h),A.route.id){let{loaderData:f,errors:p}=t,y=A.route.loader&&!f.hasOwnProperty(A.route.id)&&(!p||p[A.route.id]===void 0);if(A.route.lazy||y){l=!0,c>=0?s=s.slice(0,c+1):s=[s[0]];break}}}let u=t&&n?(h,A)=>{n(h,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:Bm(t.matches),errorInfo:A})}:void 0;return s.reduceRight((h,A,f)=>{let p,y=!1,G=null,B=null;t&&(p=o&&A.route.id?o[A.route.id]:void 0,G=A.route.errorElement||iX,l&&(c<0&&f===0?(JN("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),y=!0,B=null):c===f&&(y=!0,B=A.route.hydrateFallbackElement||null)));let S=e.concat(s.slice(0,f+1)),N=()=>{let R;return p?R=G:y?R=B:A.route.Component?R=J.createElement(A.route.Component,null):A.route.element?R=A.route.element:R=h,J.createElement(sX,{match:A,routeContext:{outlet:h,matches:S,isDataRoute:t!=null},children:R})};return t&&(A.route.ErrorBoundary||A.route.errorElement||f===0)?J.createElement(jN,{location:t.location,revalidation:t.revalidation,component:G,error:p,children:N(),routeContext:{outlet:null,matches:S,isDataRoute:!0},onError:u}):N()},null)}function nS(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function rX(a){let e=J.useContext(mI);return kn(e,nS(a)),e}function lX(a){let e=J.useContext(Sm);return kn(e,nS(a)),e}function cX(a){let e=J.useContext(Ur);return kn(e,nS(a)),e}function iS(a){let e=cX(a),t=e.matches[e.matches.length-1];return kn(t.route.id,`${a} can only be used on routes that contain a unique "id"`),t.route.id}function gX(){return iS("useRouteId")}function uX(){let a=J.useContext(tS),e=lX("useRouteError"),t=iS("useRouteError");return a!==void 0?a:e.errors?.[t]}function dX(){let{router:a}=rX("useNavigate"),e=iS("useNavigate"),t=J.useRef(!1);return DN(()=>{t.current=!0}),J.useCallback(async(i,s={})=>{ra(t.current,UN),t.current&&(typeof i=="number"?await a.navigate(i):await a.navigate(i,{fromRouteId:e,...s}))},[a,e])}var jZ={};function JN(a,e,t){!e&&!jZ[a]&&(jZ[a]=!0,ra(!1,t))}var JZ={};function PZ(a,e){!a&&!JZ[e]&&(JZ[e]=!0,console.warn(e))}var IX="useOptimistic",QZ=x5[IX],hX=()=>{};function CX(a){return QZ?QZ(a):[a,hX]}function AX(a){let e={hasErrorBoundary:a.hasErrorBoundary||a.ErrorBoundary!=null||a.errorElement!=null};return a.Component&&(a.element&&ra(!1,"You should not include both `Component` and `element` on your route - `Component` will be used."),Object.assign(e,{element:J.createElement(a.Component),Component:void 0})),a.HydrateFallback&&(a.hydrateFallbackElement&&ra(!1,"You should not include both `HydrateFallback` and `hydrateFallbackElement` on your route - `HydrateFallback` will be used."),Object.assign(e,{hydrateFallbackElement:J.createElement(a.HydrateFallback),HydrateFallback:void 0})),a.ErrorBoundary&&(a.errorElement&&ra(!1,"You should not include both `ErrorBoundary` and `errorElement` on your route - `ErrorBoundary` will be used."),Object.assign(e,{errorElement:J.createElement(a.ErrorBoundary),ErrorBoundary:void 0})),e}var fX=["HydrateFallback","hydrateFallbackElement"],mX=class{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=n=>{this.status==="pending"&&(this.status="resolved",e(n))},this.reject=n=>{this.status==="pending"&&(this.status="rejected",t(n))}})}};function pX({router:a,flushSync:e,onError:t,unstable_useTransitions:n}){n=U_()||n;let[s,o]=J.useState(a.state),[l,c]=CX(s),[u,h]=J.useState(),[A,f]=J.useState({isTransitioning:!1}),[p,y]=J.useState(),[G,B]=J.useState(),[S,N]=J.useState(),R=J.useRef(new Map),w=J.useCallback((Y,{deletedFetchers:M,newErrors:E,flushSync:O,viewTransitionOpts:P})=>{E&&t&&Object.values(E).forEach(k=>t(k,{location:Y.location,params:Y.matches[0]?.params??{},unstable_pattern:Bm(Y.matches)})),Y.fetchers.forEach((k,le)=>{k.data!==void 0&&R.current.set(le,k.data)}),M.forEach(k=>R.current.delete(k)),PZ(O===!1||e!=null,'You provided the `flushSync` option to a router update, but you are not using the `<RouterProvider>` from `react-router/dom` so `ReactDOM.flushSync()` is unavailable.  Please update your app to `import { RouterProvider } from "react-router/dom"` and ensure you have `react-dom` installed as a dependency to use the `flushSync` option.');let q=a.window!=null&&a.window.document!=null&&typeof a.window.document.startViewTransition=="function";if(PZ(P==null||q,"You provided the `viewTransition` option to a router update, but you do not appear to be running in a DOM environment as `window.startViewTransition` is not available."),!P||!q){e&&O?e(()=>o(Y)):n===!1?o(Y):J.startTransition(()=>{n===!0&&c(k=>qZ(k,Y)),o(Y)});return}if(e&&O){e(()=>{G&&(p?.resolve(),G.skipTransition()),f({isTransitioning:!0,flushSync:!0,currentLocation:P.currentLocation,nextLocation:P.nextLocation})});let k=a.window.document.startViewTransition(()=>{e(()=>o(Y))});k.finished.finally(()=>{e(()=>{y(void 0),B(void 0),h(void 0),f({isTransitioning:!1})})}),e(()=>B(k));return}G?(p?.resolve(),G.skipTransition(),N({state:Y,currentLocation:P.currentLocation,nextLocation:P.nextLocation})):(h(Y),f({isTransitioning:!0,flushSync:!1,currentLocation:P.currentLocation,nextLocation:P.nextLocation}))},[a.window,e,G,p,n,c,t]);J.useLayoutEffect(()=>a.subscribe(w),[a,w]),J.useEffect(()=>{A.isTransitioning&&!A.flushSync&&y(new mX)},[A]),J.useEffect(()=>{if(p&&u&&a.window){let Y=u,M=p.promise,E=a.window.document.startViewTransition(async()=>{n===!1?o(Y):J.startTransition(()=>{n===!0&&c(O=>qZ(O,Y)),o(Y)}),await M});E.finished.finally(()=>{y(void 0),B(void 0),h(void 0),f({isTransitioning:!1})}),B(E)}},[u,p,a.window,n,c]),J.useEffect(()=>{p&&u&&l.location.key===u.location.key&&p.resolve()},[p,G,l.location,u]),J.useEffect(()=>{!A.isTransitioning&&S&&(h(S.state),f({isTransitioning:!0,flushSync:!1,currentLocation:S.currentLocation,nextLocation:S.nextLocation}),N(void 0))},[A.isTransitioning,S]);let V=J.useMemo(()=>({createHref:a.createHref,encodeLocation:a.encodeLocation,go:Y=>a.navigate(Y),push:(Y,M,E)=>a.navigate(Y,{state:M,preventScrollReset:E?.preventScrollReset}),replace:(Y,M,E)=>a.navigate(Y,{replace:!0,state:M,preventScrollReset:E?.preventScrollReset})}),[a]),H=a.basename||"/",X=J.useMemo(()=>({router:a,navigator:V,static:!1,basename:H,onError:t}),[a,V,H,t]);return J.createElement(J.Fragment,null,J.createElement(mI.Provider,{value:X},J.createElement(Sm.Provider,{value:l},J.createElement(LN.Provider,{value:R.current},J.createElement(eS.Provider,{value:A},J.createElement(GX,{basename:H,location:l.location,navigationType:l.historyAction,navigator:V,unstable_useTransitions:n},J.createElement(bX,{routes:a.routes,future:a.future,state:l,onError:t})))))),null)}function qZ(a,e){return{...a,navigation:e.navigation.state!=="idle"?e.navigation:a.navigation,revalidation:e.revalidation!=="idle"?e.revalidation:a.revalidation,actionData:e.navigation.state!=="submitting"?e.actionData:a.actionData,fetchers:e.fetchers}}var bX=J.memo(yX);function yX({routes:a,future:e,state:t,onError:n}){return tX(a,void 0,t,n,e)}function a2({to:a,replace:e,state:t,relative:n}){kn(ZC(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=J.useContext(mr);ra(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:s}=J.useContext(Ur),{pathname:o}=Fu(),l=Ng(),c=Ry(a,wy(s),o,n==="path"),u=JSON.stringify(c);return J.useEffect(()=>{l(JSON.parse(u),{replace:e,state:t,relative:n})},[l,u,n,e,t]),null}function vX(a){return eX(a.context)}function GX({basename:a="/",children:e=null,location:t,navigationType:n="POP",navigator:i,static:s=!1,unstable_useTransitions:o}){kn(!ZC(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=a.replace(/^\/*/,"/"),c=J.useMemo(()=>({basename:l,navigator:i,static:s,unstable_useTransitions:o,future:{}}),[l,i,s,o]);typeof t=="string"&&(t=Rg(t));let{pathname:u="/",search:h="",hash:A="",state:f=null,key:p="default"}=t,y=J.useMemo(()=>{let G=kr(u,l);return G==null?null:{location:{pathname:G,search:h,hash:A,state:f,key:p},navigationType:n}},[l,u,h,A,f,p,n]);return ra(y!=null,`<Router basename="${l}"> is not able to match the URL "${u}${h}${A}" because it does not start with the basename, so the <Router> won't render anything.`),y==null?null:J.createElement(mr.Provider,{value:c},J.createElement(Ny.Provider,{children:e,value:y}))}var h0="get",C0="application/x-www-form-urlencoded";function Wy(a){return typeof HTMLElement<"u"&&a instanceof HTMLElement}function BX(a){return Wy(a)&&a.tagName.toLowerCase()==="button"}function SX(a){return Wy(a)&&a.tagName.toLowerCase()==="form"}function xX(a){return Wy(a)&&a.tagName.toLowerCase()==="input"}function ZX(a){return!!(a.metaKey||a.altKey||a.ctrlKey||a.shiftKey)}function wX(a,e){return a.button===0&&(!e||e==="_self")&&!ZX(a)}var ib=null;function RX(){if(ib===null)try{new FormData(document.createElement("form"),0),ib=!1}catch{ib=!0}return ib}var NX=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function mG(a){return a!=null&&!NX.has(a)?(ra(!1,`"${a}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${C0}"`),null):a}function WX(a,e){let t,n,i,s,o;if(SX(a)){let l=a.getAttribute("action");n=l?kr(l,e):null,t=a.getAttribute("method")||h0,i=mG(a.getAttribute("enctype"))||C0,s=new FormData(a)}else if(BX(a)||xX(a)&&(a.type==="submit"||a.type==="image")){let l=a.form;if(l==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let c=a.getAttribute("formaction")||l.getAttribute("action");if(n=c?kr(c,e):null,t=a.getAttribute("formmethod")||l.getAttribute("method")||h0,i=mG(a.getAttribute("formenctype"))||mG(l.getAttribute("enctype"))||C0,s=new FormData(l,a),!RX()){let{name:u,type:h,value:A}=a;if(h==="image"){let f=u?`${u}.`:"";s.append(`${f}x`,"0"),s.append(`${f}y`,"0")}else u&&s.append(u,A)}}else{if(Wy(a))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=h0,n=null,i=C0,o=a}return s&&i==="text/plain"&&(o=s,s=void 0),{action:n,method:t.toLowerCase(),encType:i,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function aS(a,e){if(a===!1||a===null||typeof a>"u")throw new Error(e)}function VX(a,e,t){let n=typeof a=="string"?new URL(a,typeof window>"u"?"server://singlefetch/":window.location.origin):a;return n.pathname==="/"?n.pathname=`_root.${t}`:e&&kr(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${t}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${t}`,n}async function MX(a,e){if(a.id in e)return e[a.id];try{let t=await import(a.module);return e[a.id]=t,t}catch(t){return console.error(`Error loading route module \`${a.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function _X(a){return a==null?!1:a.href==null?a.rel==="preload"&&typeof a.imageSrcSet=="string"&&typeof a.imageSizes=="string":typeof a.rel=="string"&&typeof a.href=="string"}async function XX(a,e,t){let n=await Promise.all(a.map(async i=>{let s=e.routes[i.route.id];if(s){let o=await MX(s,t);return o.links?o.links():[]}return[]}));return FX(n.flat(1).filter(_X).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function $Z(a,e,t,n,i,s){let o=(c,u)=>t[u]?c.route.id!==t[u].route.id:!0,l=(c,u)=>t[u].pathname!==c.pathname||t[u].route.path?.endsWith("*")&&t[u].params["*"]!==c.params["*"];return s==="assets"?e.filter((c,u)=>o(c,u)||l(c,u)):s==="data"?e.filter((c,u)=>{let h=n.routes[c.route.id];if(!h||!h.hasLoader)return!1;if(o(c,u)||l(c,u))return!0;if(c.route.shouldRevalidate){let A=c.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(a,window.origin),nextParams:c.params,defaultShouldRevalidate:!0});if(typeof A=="boolean")return A}return!0}):[]}function YX(a,e,{includeHydrateFallback:t}={}){return HX(a.map(n=>{let i=e.routes[n.route.id];if(!i)return[];let s=[i.module];return i.clientActionModule&&(s=s.concat(i.clientActionModule)),i.clientLoaderModule&&(s=s.concat(i.clientLoaderModule)),t&&i.hydrateFallbackModule&&(s=s.concat(i.hydrateFallbackModule)),i.imports&&(s=s.concat(i.imports)),s}).flat(1))}function HX(a){return[...new Set(a)]}function EX(a){let e={},t=Object.keys(a).sort();for(let n of t)e[n]=a[n];return e}function FX(a,e){let t=new Set;return new Set(e),a.reduce((n,i)=>{let s=JSON.stringify(EX(i));return t.has(s)||(t.add(s),n.push({key:s,link:i})),n},[])}function PN(){let a=J.useContext(mI);return aS(a,"You must render this element inside a <DataRouterContext.Provider> element"),a}function KX(){let a=J.useContext(Sm);return aS(a,"You must render this element inside a <DataRouterStateContext.Provider> element"),a}var sS=J.createContext(void 0);sS.displayName="FrameworkContext";function QN(){let a=J.useContext(sS);return aS(a,"You must render this element inside a <HydratedRouter> element"),a}function TX(a,e){let t=J.useContext(sS),[n,i]=J.useState(!1),[s,o]=J.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:h,onTouchStart:A}=e,f=J.useRef(null);J.useEffect(()=>{if(a==="render"&&o(!0),a==="viewport"){let G=S=>{S.forEach(N=>{o(N.isIntersecting)})},B=new IntersectionObserver(G,{threshold:.5});return f.current&&B.observe(f.current),()=>{B.disconnect()}}},[a]),J.useEffect(()=>{if(n){let G=setTimeout(()=>{o(!0)},100);return()=>{clearTimeout(G)}}},[n]);let p=()=>{i(!0)},y=()=>{i(!1),o(!1)};return t?a!=="intent"?[s,f,{}]:[s,f,{onFocus:af(l,p),onBlur:af(c,y),onMouseEnter:af(u,p),onMouseLeave:af(h,y),onTouchStart:af(A,p)}]:[!1,f,{}]}function af(a,e){return t=>{a&&a(t),t.defaultPrevented||e(t)}}function zX({page:a,...e}){let{router:t}=PN(),n=J.useMemo(()=>Su(t.routes,a,t.basename),[t.routes,a,t.basename]);return n?J.createElement(kX,{page:a,matches:n,...e}):null}function LX(a){let{manifest:e,routeModules:t}=QN(),[n,i]=J.useState([]);return J.useEffect(()=>{let s=!1;return XX(a,e,t).then(o=>{s||i(o)}),()=>{s=!0}},[a,e,t]),n}function kX({page:a,matches:e,...t}){let n=Fu(),{manifest:i,routeModules:s}=QN(),{basename:o}=PN(),{loaderData:l,matches:c}=KX(),u=J.useMemo(()=>$Z(a,e,c,i,n,"data"),[a,e,c,i,n]),h=J.useMemo(()=>$Z(a,e,c,i,n,"assets"),[a,e,c,i,n]),A=J.useMemo(()=>{if(a===n.pathname+n.search+n.hash)return[];let y=new Set,G=!1;if(e.forEach(S=>{let N=i.routes[S.route.id];!N||!N.hasLoader||(!u.some(R=>R.route.id===S.route.id)&&S.route.id in l&&s[S.route.id]?.shouldRevalidate||N.hasClientLoader?G=!0:y.add(S.route.id))}),y.size===0)return[];let B=VX(a,o,"data");return G&&y.size>0&&B.searchParams.set("_routes",e.filter(S=>y.has(S.route.id)).map(S=>S.route.id).join(",")),[B.pathname+B.search]},[o,l,n,i,u,e,a,s]),f=J.useMemo(()=>YX(h,i),[h,i]),p=LX(h);return J.createElement(J.Fragment,null,A.map(y=>J.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),f.map(y=>J.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),p.map(({key:y,link:G})=>J.createElement("link",{key:y,nonce:t.nonce,...G})))}function UX(...a){return e=>{a.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var DX=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{DX&&(window.__reactRouterVersion="7.11.0")}catch{}function OX(a,e){return b_({basename:e?.basename,getContext:e?.getContext,future:e?.future,history:Y5({window:e?.window}),hydrationData:jX(),routes:a,mapRouteProperties:AX,hydrationRouteProperties:fX,dataStrategy:e?.dataStrategy,patchRoutesOnNavigation:e?.patchRoutesOnNavigation,window:e?.window,unstable_instrumentations:e?.unstable_instrumentations}).initialize()}function jX(){let a=window?.__staticRouterHydrationData;return a&&a.errors&&(a={...a,errors:JX(a.errors)}),a}function JX(a){if(!a)return null;let e=Object.entries(a),t={};for(let[n,i]of e)if(i&&i.__type==="RouteErrorResponse")t[n]=new Gm(i.status,i.statusText,i.data,i.internal===!0);else if(i&&i.__type==="Error"){if(i.__subType){let s=window[i.__subType];if(typeof s=="function")try{let o=new s(i.message);o.stack="",t[n]=o}catch{}}if(t[n]==null){let s=new Error(i.message);s.stack="",t[n]=s}}else t[n]=i;return t}var qN=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,$N=J.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:i,reloadDocument:s,replace:o,state:l,target:c,to:u,preventScrollReset:h,viewTransition:A,unstable_defaultShouldRevalidate:f,...p},y){let{basename:G,unstable_useTransitions:B}=J.useContext(mr),S=typeof u=="string"&&qN.test(u),N=NN(u,G);u=N.to;let R=Q_(u,{relative:i}),[w,V,H]=TX(n,p),X=qX(u,{replace:o,state:l,target:c,preventScrollReset:h,relative:i,viewTransition:A,unstable_defaultShouldRevalidate:f,unstable_useTransitions:B});function Y(E){e&&e(E),E.defaultPrevented||X(E)}let M=J.createElement("a",{...p,...H,href:N.absoluteURL||R,onClick:N.isExternal||s?e:Y,ref:UX(y,V),target:c,"data-discover":!S&&t==="render"?"true":void 0});return w&&!S?J.createElement(J.Fragment,null,M,J.createElement(zX,{page:R})):M});$N.displayName="Link";var bc=J.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:i=!1,style:s,to:o,viewTransition:l,children:c,...u},h){let A=xm(o,{relative:u.relative}),f=Fu(),p=J.useContext(Sm),{navigator:y,basename:G}=J.useContext(mr),B=p!=null&&iY(A)&&l===!0,S=y.encodeLocation?y.encodeLocation(A).pathname:A.pathname,N=f.pathname,R=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;t||(N=N.toLowerCase(),R=R?R.toLowerCase():null,S=S.toLowerCase()),R&&G&&(R=kr(R,G)||R);const w=S!=="/"&&S.endsWith("/")?S.length-1:S.length;let V=N===S||!i&&N.startsWith(S)&&N.charAt(w)==="/",H=R!=null&&(R===S||!i&&R.startsWith(S)&&R.charAt(S.length)==="/"),X={isActive:V,isPending:H,isTransitioning:B},Y=V?e:void 0,M;typeof n=="function"?M=n(X):M=[n,V?"active":null,H?"pending":null,B?"transitioning":null].filter(Boolean).join(" ");let E=typeof s=="function"?s(X):s;return J.createElement($N,{...u,"aria-current":Y,className:M,ref:h,style:E,to:o,viewTransition:l},typeof c=="function"?c(X):c)});bc.displayName="NavLink";var PX=J.forwardRef(({discover:a="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:i,state:s,method:o=h0,action:l,onSubmit:c,relative:u,preventScrollReset:h,viewTransition:A,unstable_defaultShouldRevalidate:f,...p},y)=>{let{unstable_useTransitions:G}=J.useContext(mr),B=tY(),S=nY(l,{relative:u}),N=o.toLowerCase()==="get"?"get":"post",R=typeof l=="string"&&qN.test(l),w=V=>{if(c&&c(V),V.defaultPrevented)return;V.preventDefault();let H=V.nativeEvent.submitter,X=H?.getAttribute("formmethod")||o,Y=()=>B(H||V.currentTarget,{fetcherKey:e,method:X,navigate:t,replace:i,state:s,relative:u,preventScrollReset:h,viewTransition:A,unstable_defaultShouldRevalidate:f});G&&t!==!1?J.startTransition(()=>Y()):Y()};return J.createElement("form",{ref:y,method:N,action:S,onSubmit:n?c:w,...p,"data-discover":!R&&a==="render"?"true":void 0})});PX.displayName="Form";function QX(a){return`${a} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function eW(a){let e=J.useContext(mI);return kn(e,QX(a)),e}function qX(a,{target:e,replace:t,state:n,preventScrollReset:i,relative:s,viewTransition:o,unstable_defaultShouldRevalidate:l,unstable_useTransitions:c}={}){let u=Ng(),h=Fu(),A=xm(a,{relative:s});return J.useCallback(f=>{if(wX(f,e)){f.preventDefault();let p=t!==void 0?t:Zc(h)===Zc(A),y=()=>u(a,{replace:p,state:n,preventScrollReset:i,relative:s,viewTransition:o,unstable_defaultShouldRevalidate:l});c?J.startTransition(()=>y()):y()}},[h,u,A,t,n,e,a,i,s,o,l,c])}var $X=0,eY=()=>`__${String(++$X)}__`;function tY(){let{router:a}=eW("useSubmit"),{basename:e}=J.useContext(mr),t=gX(),n=a.fetch,i=a.navigate;return J.useCallback(async(s,o={})=>{let{action:l,method:c,encType:u,formData:h,body:A}=WX(s,e);if(o.navigate===!1){let f=o.fetcherKey||eY();await n(f,t,o.action||l,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:h,body:A,formMethod:o.method||c,formEncType:o.encType||u,flushSync:o.flushSync})}else await i(o.action||l,{unstable_defaultShouldRevalidate:o.unstable_defaultShouldRevalidate,preventScrollReset:o.preventScrollReset,formData:h,body:A,formMethod:o.method||c,formEncType:o.encType||u,replace:o.replace,state:o.state,fromRouteId:t,flushSync:o.flushSync,viewTransition:o.viewTransition})},[n,i,e,t])}function nY(a,{relative:e}={}){let{basename:t}=J.useContext(mr),n=J.useContext(Ur);kn(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),s={...xm(a||".",{relative:e})},o=Fu();if(a==null){s.search=o.search;let l=new URLSearchParams(s.search),c=l.getAll("index");if(c.some(h=>h==="")){l.delete("index"),c.filter(A=>A).forEach(A=>l.append("index",A));let h=l.toString();s.search=h?`?${h}`:""}}return(!a||a===".")&&i.route.index&&(s.search=s.search?s.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(s.pathname=s.pathname==="/"?t:Sc([t,s.pathname])),Zc(s)}function iY(a,{relative:e}={}){let t=J.useContext(eS);kn(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=eW("useViewTransitionState"),i=xm(a,{relative:e});if(!t.isTransitioning)return!1;let s=kr(t.currentLocation.pathname,n)||t.currentLocation.pathname,o=kr(t.nextLocation.pathname,n)||t.nextLocation.pathname;return B0(i.pathname,o)!=null||B0(i.pathname,s)!=null}var aY=vN();function sY(a){return J.createElement(pX,{flushSync:aY.flushSync,...a})}function Vy(a,e){var t={};for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&e.indexOf(n)<0&&(t[n]=a[n]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(a);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(a,n[i])&&(t[n[i]]=a[n[i]]);return t}function oY(a,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function l(h){try{u(n.next(h))}catch(A){o(A)}}function c(h){try{u(n.throw(h))}catch(A){o(A)}}function u(h){h.done?s(h.value):i(h.value).then(l,c)}u((n=n.apply(a,e||[])).next())})}const rY=a=>a?(...e)=>a(...e):(...e)=>fetch(...e);class oS extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class lY extends oS{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ew extends oS{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class tw extends oS{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var s2;(function(a){a.Any="any",a.ApNortheast1="ap-northeast-1",a.ApNortheast2="ap-northeast-2",a.ApSouth1="ap-south-1",a.ApSoutheast1="ap-southeast-1",a.ApSoutheast2="ap-southeast-2",a.CaCentral1="ca-central-1",a.EuCentral1="eu-central-1",a.EuWest1="eu-west-1",a.EuWest2="eu-west-2",a.EuWest3="eu-west-3",a.SaEast1="sa-east-1",a.UsEast1="us-east-1",a.UsWest1="us-west-1",a.UsWest2="us-west-2"})(s2||(s2={}));class cY{constructor(e,{headers:t={},customFetch:n,region:i=s2.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=rY(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return oY(this,arguments,void 0,function*(t,n={}){var i;let s,o;try{const{headers:l,method:c,body:u,signal:h,timeout:A}=n;let f={},{region:p}=n;p||(p=this.region);const y=new URL(`${this.url}/${t}`);p&&p!=="any"&&(f["x-region"]=p,y.searchParams.set("forceFunctionRegion",p));let G;u&&(l&&!Object.prototype.hasOwnProperty.call(l,"Content-Type")||!l)?typeof Blob<"u"&&u instanceof Blob||u instanceof ArrayBuffer?(f["Content-Type"]="application/octet-stream",G=u):typeof u=="string"?(f["Content-Type"]="text/plain",G=u):typeof FormData<"u"&&u instanceof FormData?G=u:(f["Content-Type"]="application/json",G=JSON.stringify(u)):G=u;let B=h;A&&(o=new AbortController,s=setTimeout(()=>o.abort(),A),h?(B=o.signal,h.addEventListener("abort",()=>o.abort())):B=o.signal);const S=yield this.fetch(y.toString(),{method:c||"POST",headers:Object.assign(Object.assign(Object.assign({},f),this.headers),l),body:G,signal:B}).catch(V=>{throw new lY(V)}),N=S.headers.get("x-relay-error");if(N&&N==="true")throw new ew(S);if(!S.ok)throw new tw(S);let R=((i=S.headers.get("Content-Type"))!==null&&i!==void 0?i:"text/plain").split(";")[0].trim(),w;return R==="application/json"?w=yield S.json():R==="application/octet-stream"||R==="application/pdf"?w=yield S.blob():R==="text/event-stream"?w=S:R==="multipart/form-data"?w=yield S.formData():w=yield S.text(),{data:w,error:null,response:S}}catch(l){return{data:null,error:l,response:l instanceof tw||l instanceof ew?l.context:void 0}}finally{s&&clearTimeout(s)}})}}var gY=class extends Error{constructor(a){super(a.message),this.name="PostgrestError",this.details=a.details,this.hint=a.hint,this.code=a.code}},uY=class{constructor(a){var e,t;this.shouldThrowOnError=!1,this.method=a.method,this.url=a.url,this.headers=new Headers(a.headers),this.schema=a.schema,this.body=a.body,this.shouldThrowOnError=(e=a.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=a.signal,this.isMaybeSingle=(t=a.isMaybeSingle)!==null&&t!==void 0?t:!1,a.fetch?this.fetch=a.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(a,e){return this.headers=new Headers(this.headers),this.headers.set(a,e),this}then(a,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let i=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async s=>{let o=null,l=null,c=null,u=s.status,h=s.statusText;if(s.ok){var A,f;if(t.method!=="HEAD"){var p;const S=await s.text();S===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((p=t.headers.get("Accept"))===null||p===void 0)&&p.includes("application/vnd.pgrst.plan+text"))?l=S:l=JSON.parse(S))}const G=(A=t.headers.get("Prefer"))===null||A===void 0?void 0:A.match(/count=(exact|planned|estimated)/),B=(f=s.headers.get("content-range"))===null||f===void 0?void 0:f.split("/");G&&B&&B.length>1&&(c=parseInt(B[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(l)&&(l.length>1?(o={code:"PGRST116",details:`Results contain ${l.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},l=null,c=null,u=406,h="Not Acceptable"):l.length===1?l=l[0]:l=null)}else{var y;const G=await s.text();try{o=JSON.parse(G),Array.isArray(o)&&s.status===404&&(l=[],o=null,u=200,h="OK")}catch{s.status===404&&G===""?(u=204,h="No Content"):o={message:G}}if(o&&t.isMaybeSingle&&(!(o==null||(y=o.details)===null||y===void 0)&&y.includes("0 rows"))&&(o=null,u=200,h="OK"),o&&t.shouldThrowOnError)throw new gY(o)}return{error:o,data:l,count:c,status:u,statusText:h}});return this.shouldThrowOnError||(i=i.catch(s=>{var o;let l="";const c=s?.cause;if(c){var u,h,A,f;const y=(u=c?.message)!==null&&u!==void 0?u:"",G=(h=c?.code)!==null&&h!==void 0?h:"";l=`${(A=s?.name)!==null&&A!==void 0?A:"FetchError"}: ${s?.message}`,l+=`

Caused by: ${(f=c?.name)!==null&&f!==void 0?f:"Error"}: ${y}`,G&&(l+=` (${G})`),c?.stack&&(l+=`
${c.stack}`)}else{var p;l=(p=s?.stack)!==null&&p!==void 0?p:""}return{error:{message:`${(o=s?.name)!==null&&o!==void 0?o:"FetchError"}: ${s?.message}`,details:l,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),i.then(a,e)}returns(){return this}overrideTypes(){return this}},dY=class extends uY{select(a){let e=!1;const t=(a??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(a,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:i=n}={}){const s=i?`${i}.order`:"order",o=this.url.searchParams.get(s);return this.url.searchParams.set(s,`${o?`${o},`:""}${a}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(a,{foreignTable:e,referencedTable:t=e}={}){const n=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(n,`${a}`),this}range(a,e,{foreignTable:t,referencedTable:n=t}={}){const i=typeof n>"u"?"offset":`${n}.offset`,s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${a}`),this.url.searchParams.set(s,`${e-a+1}`),this}abortSignal(a){return this.signal=a,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:a=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:i=!1,format:s="text"}={}){var o;const l=[a?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,i?"wal":null].filter(Boolean).join("|"),c=(o=this.headers.get("Accept"))!==null&&o!==void 0?o:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${s}; for="${c}"; options=${l};`),s==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(a){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${a}`),this}};const nw=new RegExp("[,()]");var eC=class extends dY{eq(a,e){return this.url.searchParams.append(a,`eq.${e}`),this}neq(a,e){return this.url.searchParams.append(a,`neq.${e}`),this}gt(a,e){return this.url.searchParams.append(a,`gt.${e}`),this}gte(a,e){return this.url.searchParams.append(a,`gte.${e}`),this}lt(a,e){return this.url.searchParams.append(a,`lt.${e}`),this}lte(a,e){return this.url.searchParams.append(a,`lte.${e}`),this}like(a,e){return this.url.searchParams.append(a,`like.${e}`),this}likeAllOf(a,e){return this.url.searchParams.append(a,`like(all).{${e.join(",")}}`),this}likeAnyOf(a,e){return this.url.searchParams.append(a,`like(any).{${e.join(",")}}`),this}ilike(a,e){return this.url.searchParams.append(a,`ilike.${e}`),this}ilikeAllOf(a,e){return this.url.searchParams.append(a,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(a,e){return this.url.searchParams.append(a,`ilike(any).{${e.join(",")}}`),this}regexMatch(a,e){return this.url.searchParams.append(a,`match.${e}`),this}regexIMatch(a,e){return this.url.searchParams.append(a,`imatch.${e}`),this}is(a,e){return this.url.searchParams.append(a,`is.${e}`),this}isDistinct(a,e){return this.url.searchParams.append(a,`isdistinct.${e}`),this}in(a,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&nw.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(a,`in.(${t})`),this}notIn(a,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&nw.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(a,`not.in.(${t})`),this}contains(a,e){return typeof e=="string"?this.url.searchParams.append(a,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(a,`cs.{${e.join(",")}}`):this.url.searchParams.append(a,`cs.${JSON.stringify(e)}`),this}containedBy(a,e){return typeof e=="string"?this.url.searchParams.append(a,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(a,`cd.{${e.join(",")}}`):this.url.searchParams.append(a,`cd.${JSON.stringify(e)}`),this}rangeGt(a,e){return this.url.searchParams.append(a,`sr.${e}`),this}rangeGte(a,e){return this.url.searchParams.append(a,`nxl.${e}`),this}rangeLt(a,e){return this.url.searchParams.append(a,`sl.${e}`),this}rangeLte(a,e){return this.url.searchParams.append(a,`nxr.${e}`),this}rangeAdjacent(a,e){return this.url.searchParams.append(a,`adj.${e}`),this}overlaps(a,e){return typeof e=="string"?this.url.searchParams.append(a,`ov.${e}`):this.url.searchParams.append(a,`ov.{${e.join(",")}}`),this}textSearch(a,e,{config:t,type:n}={}){let i="";n==="plain"?i="pl":n==="phrase"?i="ph":n==="websearch"&&(i="w");const s=t===void 0?"":`(${t})`;return this.url.searchParams.append(a,`${i}fts${s}.${e}`),this}match(a){return Object.entries(a).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(a,e,t){return this.url.searchParams.append(a,`not.${e}.${t}`),this}or(a,{foreignTable:e,referencedTable:t=e}={}){const n=t?`${t}.or`:"or";return this.url.searchParams.append(n,`(${a})`),this}filter(a,e,t){return this.url.searchParams.append(a,`${e}.${t}`),this}},IY=class{constructor(a,{headers:e={},schema:t,fetch:n}){this.url=a,this.headers=new Headers(e),this.schema=t,this.fetch=n}select(a,e){const{head:t=!1,count:n}=e??{},i=t?"HEAD":"GET";let s=!1;const o=(a??"*").split("").map(l=>/\s/.test(l)&&!s?"":(l==='"'&&(s=!s),l)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new eC({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(a,{count:e,defaultToNull:t=!0}={}){var n;const i="POST";if(e&&this.headers.append("Prefer",`count=${e}`),t||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const s=a.reduce((o,l)=>o.concat(Object.keys(l)),[]);if(s.length>0){const o=[...new Set(s)].map(l=>`"${l}"`);this.url.searchParams.set("columns",o.join(","))}}return new eC({method:i,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}upsert(a,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:i=!0}={}){var s;const o="POST";if(this.headers.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&this.url.searchParams.set("on_conflict",e),n&&this.headers.append("Prefer",`count=${n}`),i||this.headers.append("Prefer","missing=default"),Array.isArray(a)){const l=a.reduce((c,u)=>c.concat(Object.keys(u)),[]);if(l.length>0){const c=[...new Set(l)].map(u=>`"${u}"`);this.url.searchParams.set("columns",c.join(","))}}return new eC({method:o,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}update(a,{count:e}={}){var t;const n="PATCH";return e&&this.headers.append("Prefer",`count=${e}`),new eC({method:n,url:this.url,headers:this.headers,schema:this.schema,body:a,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}delete({count:a}={}){var e;const t="DELETE";return a&&this.headers.append("Prefer",`count=${a}`),new eC({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch})}},hY=class tW{constructor(e,{headers:t={},schema:n,fetch:i}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=i}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new IY(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new tW(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:i=!1,count:s}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let u;n||i?(l=n?"HEAD":"GET",Object.entries(t).filter(([A,f])=>f!==void 0).map(([A,f])=>[A,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([A,f])=>{c.searchParams.append(A,f)})):(l="POST",u=t);const h=new Headers(this.headers);return s&&h.set("Prefer",`count=${s}`),new eC({method:l,url:c,headers:h,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};class CY{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,i=parseInt(n.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const AY="2.89.0",fY=`realtime-js/${AY}`,nW="1.0.0",mY="2.0.0",iw=nW,o2=1e4,pY=1e3,bY=100;var Bu;(function(a){a[a.connecting=0]="connecting",a[a.open=1]="open",a[a.closing=2]="closing",a[a.closed=3]="closed"})(Bu||(Bu={}));var Da;(function(a){a.closed="closed",a.errored="errored",a.joined="joined",a.joining="joining",a.leaving="leaving"})(Da||(Da={}));var wl;(function(a){a.close="phx_close",a.error="phx_error",a.join="phx_join",a.reply="phx_reply",a.leave="phx_leave",a.access_token="access_token"})(wl||(wl={}));var r2;(function(a){a.websocket="websocket"})(r2||(r2={}));var Jd;(function(a){a.Connecting="connecting",a.Open="open",a.Closing="closing",a.Closed="closed"})(Jd||(Jd={}));class yY{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const i=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,i)}_encodeJsonUserBroadcastPush(e){var t,n;const i=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:{},o=new TextEncoder().encode(JSON.stringify(i)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,o)}_encodeUserBroadcastPush(e,t,n){var i,s;const o=e.topic,l=(i=e.ref)!==null&&i!==void 0?i:"",c=(s=e.join_ref)!==null&&s!==void 0?s:"",u=e.payload.event,h=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},A=Object.keys(h).length===0?"":JSON.stringify(h);if(c.length>255)throw new Error(`joinRef length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`ref length ${l.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`topic length ${o.length} exceeds maximum of 255`);if(u.length>255)throw new Error(`userEvent length ${u.length} exceeds maximum of 255`);if(A.length>255)throw new Error(`metadata length ${A.length} exceeds maximum of 255`);const f=this.USER_BROADCAST_PUSH_META_LENGTH+c.length+l.length+o.length+u.length+A.length,p=new ArrayBuffer(this.HEADER_LENGTH+f);let y=new DataView(p),G=0;y.setUint8(G++,this.KINDS.userBroadcastPush),y.setUint8(G++,c.length),y.setUint8(G++,l.length),y.setUint8(G++,o.length),y.setUint8(G++,u.length),y.setUint8(G++,A.length),y.setUint8(G++,t),Array.from(c,S=>y.setUint8(G++,S.charCodeAt(0))),Array.from(l,S=>y.setUint8(G++,S.charCodeAt(0))),Array.from(o,S=>y.setUint8(G++,S.charCodeAt(0))),Array.from(u,S=>y.setUint8(G++,S.charCodeAt(0))),Array.from(A,S=>y.setUint8(G++,S.charCodeAt(0)));var B=new Uint8Array(p.byteLength+n.byteLength);return B.set(new Uint8Array(p),0),B.set(new Uint8Array(n),p.byteLength),B.buffer}decode(e,t){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return t(n)}if(typeof e=="string"){const n=JSON.parse(e),[i,s,o,l,c]=n;return t({join_ref:i,ref:s,topic:o,event:l,payload:c})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),i=new TextDecoder;if(n===this.KINDS.userBroadcast)return this._decodeUserBroadcast(e,t,i)}_decodeUserBroadcast(e,t,n){const i=t.getUint8(1),s=t.getUint8(2),o=t.getUint8(3),l=t.getUint8(4);let c=this.HEADER_LENGTH+4;const u=n.decode(e.slice(c,c+i));c=c+i;const h=n.decode(e.slice(c,c+s));c=c+s;const A=n.decode(e.slice(c,c+o));c=c+o;const f=e.slice(c,e.byteLength),p=l===this.JSON_ENCODING?JSON.parse(n.decode(f)):f,y={type:this.BROADCAST_EVENT,event:h,payload:p};return o>0&&(y.meta=JSON.parse(A)),{join_ref:null,ref:null,topic:u,event:this.BROADCAST_EVENT,payload:y}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e?.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}}let iW=class{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}};var Hi;(function(a){a.abstime="abstime",a.bool="bool",a.date="date",a.daterange="daterange",a.float4="float4",a.float8="float8",a.int2="int2",a.int4="int4",a.int4range="int4range",a.int8="int8",a.int8range="int8range",a.json="json",a.jsonb="jsonb",a.money="money",a.numeric="numeric",a.oid="oid",a.reltime="reltime",a.text="text",a.time="time",a.timestamp="timestamp",a.timestamptz="timestamptz",a.timetz="timetz",a.tsrange="tsrange",a.tstzrange="tstzrange"})(Hi||(Hi={}));const aw=(a,e,t={})=>{var n;const i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((s,o)=>(s[o]=vY(o,a,e,i),s),{}):{}},vY=(a,e,t,n)=>{const i=e.find(l=>l.name===a),s=i?.type,o=t[a];return s&&!n.includes(s)?aW(s,o):l2(o)},aW=(a,e)=>{if(a.charAt(0)==="_"){const t=a.slice(1,a.length);return xY(e,t)}switch(a){case Hi.bool:return GY(e);case Hi.float4:case Hi.float8:case Hi.int2:case Hi.int4:case Hi.int8:case Hi.numeric:case Hi.oid:return BY(e);case Hi.json:case Hi.jsonb:return SY(e);case Hi.timestamp:return ZY(e);case Hi.abstime:case Hi.date:case Hi.daterange:case Hi.int4range:case Hi.int8range:case Hi.money:case Hi.reltime:case Hi.text:case Hi.time:case Hi.timestamptz:case Hi.timetz:case Hi.tsrange:case Hi.tstzrange:return l2(e);default:return l2(e)}},l2=a=>a,GY=a=>{switch(a){case"t":return!0;case"f":return!1;default:return a}},BY=a=>{if(typeof a=="string"){const e=parseFloat(a);if(!Number.isNaN(e))return e}return a},SY=a=>{if(typeof a=="string")try{return JSON.parse(a)}catch{return a}return a},xY=(a,e)=>{if(typeof a!="string")return a;const t=a.length-1,n=a[t];if(a[0]==="{"&&n==="}"){let s;const o=a.slice(1,t);try{s=JSON.parse("["+o+"]")}catch{s=o?o.split(","):[]}return s.map(l=>aW(e,l))}return a},ZY=a=>typeof a=="string"?a.replace(" ","T"):a,sW=a=>{const e=new URL(a);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class pG{constructor(e,t,n={},i=o2){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var sw;(function(a){a.SYNC="sync",a.JOIN="join",a.LEAVE="leave"})(sw||(sw={}));class _f{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:s,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=_f.syncState(this.state,i,s,o),this.pendingDiffs.forEach(c=>{this.state=_f.syncDiff(this.state,c,s,o)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},i=>{const{onJoin:s,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=_f.syncDiff(this.state,i,s,o),l())}),this.onJoin((i,s,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:s,newPresences:o})}),this.onLeave((i,s,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:s,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){const s=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(s,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const A=s[u];if(A){const f=h.map(B=>B.presence_ref),p=A.map(B=>B.presence_ref),y=h.filter(B=>p.indexOf(B.presence_ref)<0),G=A.filter(B=>f.indexOf(B.presence_ref)<0);y.length>0&&(l[u]=y),G.length>0&&(c[u]=G)}else l[u]=h}),this.syncDiff(s,{joins:l,leaves:c},n,i)}static syncDiff(e,t,n,i){const{joins:s,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(s,(l,c)=>{var u;const h=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),h.length>0){const A=e[l].map(p=>p.presence_ref),f=h.filter(p=>A.indexOf(p.presence_ref)<0);e[l].unshift(...f)}n(l,h,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const h=c.map(A=>A.presence_ref);u=u.filter(A=>h.indexOf(A.presence_ref)<0),e[l]=u,i(l,u,c),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const i=e[n];return"metas"in i?t[n]=i.metas.map(s=>(s.presence_ref=s.phx_ref,delete s.phx_ref,delete s.phx_ref_prev,s)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var ow;(function(a){a.ALL="*",a.INSERT="INSERT",a.UPDATE="UPDATE",a.DELETE="DELETE"})(ow||(ow={}));var Xf;(function(a){a.BROADCAST="broadcast",a.PRESENCE="presence",a.POSTGRES_CHANGES="postgres_changes",a.SYSTEM="system"})(Xf||(Xf={}));var bg;(function(a){a.SUBSCRIBED="SUBSCRIBED",a.TIMED_OUT="TIMED_OUT",a.CLOSED="CLOSED",a.CHANNEL_ERROR="CHANNEL_ERROR"})(bg||(bg={}));class aC{constructor(e,t={config:{}},n){var i,s;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=Da.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new pG(this,wl.join,this.params,this.timeout),this.rejoinTimer=new iW(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Da.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(o=>o.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Da.closed,this.socket._remove(this)}),this._onError(o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Da.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Da.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",o=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,o),this.state=Da.errored,this.rejoinTimer.scheduleTimeout())}),this._on(wl.reply,{},(o,l)=>{this._trigger(this._replyEventName(l),o)}),this.presence=new _f(this),this.broadcastEndpointURL=sW(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((s=(i=this.params.config)===null||i===void 0?void 0:i.broadcast)===null||s===void 0)&&s.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,i,s;if(this.socket.isConnected()||this.socket.connect(),this.state==Da.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&i!==void 0?i:[],h=!!this.bindings[Xf.PRESENCE]&&this.bindings[Xf.PRESENCE].length>0||((s=this.params.config.presence)===null||s===void 0?void 0:s.enabled)===!0,A={},f={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(A.access_token=this.socket.accessTokenValue),this._onError(p=>e?.(bg.CHANNEL_ERROR,p)),this._onClose(()=>e?.(bg.CLOSED)),this.updateJoinPayload(Object.assign({config:f},A)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var y;if(this.socket._isManualToken()||this.socket.setAuth(),p===void 0){e?.(bg.SUBSCRIBED);return}else{const G=this.bindings.postgres_changes,B=(y=G?.length)!==null&&y!==void 0?y:0,S=[];for(let N=0;N<B;N++){const R=G[N],{filter:{event:w,schema:V,table:H,filter:X}}=R,Y=p&&p[N];if(Y&&Y.event===w&&aC.isFilterValueEqual(Y.schema,V)&&aC.isFilterValueEqual(Y.table,H)&&aC.isFilterValueEqual(Y.filter,X))S.push(Object.assign(Object.assign({},R),{id:Y.id}));else{this.unsubscribe(),this.state=Da.errored,e?.(bg.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=S,e&&e(bg.SUBSCRIBED);return}}).receive("error",p=>{this.state=Da.errored,e?.(bg.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e?.(bg.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===Da.joined&&e===Xf.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var i;if(t==null)return Promise.reject("Payload is required for httpSend()");const s={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(s.Authorization=`Bearer ${this.socket.accessTokenValue}`);const o={method:"POST",headers:s,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},l=await this._fetchWithTimeout(this.broadcastEndpointURL,o,(i=n.timeout)!==null&&i!==void 0?i:this.timeout);if(l.status===202)return{success:!0};let c=l.statusText;try{const u=await l.json();c=u.error||u.message||c}catch{}return Promise.reject(new Error(c))}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:s,payload:o}=e,l={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(l.Authorization=`Bearer ${this.socket.accessTokenValue}`);const c={method:"POST",headers:l,body:JSON.stringify({messages:[{topic:this.subTopic,event:s,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(s=>{var o,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&s("ok"),u.receive("ok",()=>s("ok")),u.receive("error",()=>s("error")),u.receive("timeout",()=>s("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=Da.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(wl.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new pG(this,wl.leave,{},e),n.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Da.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const i=new AbortController,s=setTimeout(()=>i.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(s),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new pG(this,e,t,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>bY){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,s;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:h}=wl;if(n&&[l,c,u,h].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,t,n);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var y,G,B;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((B=(G=p.filter)===null||G===void 0?void 0:G.event)===null||B===void 0?void 0:B.toLocaleLowerCase())===o}).map(p=>p.callback(f,n)):(s=this.bindings[o])===null||s===void 0||s.filter(p=>{var y,G,B,S,N,R;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const w=p.id,V=(y=p.filter)===null||y===void 0?void 0:y.event;return w&&((G=t.ids)===null||G===void 0?void 0:G.includes(w))&&(V==="*"||V?.toLocaleLowerCase()===((B=t.data)===null||B===void 0?void 0:B.type.toLocaleLowerCase()))}else{const w=(N=(S=p?.filter)===null||S===void 0?void 0:S.event)===null||N===void 0?void 0:N.toLocaleLowerCase();return w==="*"||w===((R=t?.event)===null||R===void 0?void 0:R.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:G,table:B,commit_timestamp:S,type:N,errors:R}=y;f=Object.assign(Object.assign({},{schema:G,table:B,commit_timestamp:S,eventType:N,new:{},old:{},errors:R}),this._getPayloadRecords(y))}p.callback(f,n)})}_isClosed(){return this.state===Da.closed}_isJoined(){return this.state===Da.joined}_isJoining(){return this.state===Da.joining}_isLeaving(){return this.state===Da.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const i=e.toLocaleLowerCase(),s={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(s):this.bindings[i]=[s],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var s;return!(((s=i.type)===null||s===void 0?void 0:s.toLocaleLowerCase())===n&&aC.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(wl.close,{},e)}_onError(e){this._on(wl.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Da.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=aw(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=aw(e.columns,e.old_record)),t}}const bG=()=>{},ab={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wY=[1e3,2e3,5e3,1e4],RY=1e4,NY=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class WY{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=o2,this.transport=null,this.heartbeatIntervalMs=ab.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=bG,this.ref=0,this.reconnectTimer=null,this.vsn=iw,this.logger=bG,this.conn=null,this.sendBuffer=[],this.serializer=new yY,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>i?(...s)=>i(...s):(...s)=>fetch(...s),!(!((n=t?.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${r2.websocket}`,this.httpEndpoint=sW(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t?.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=CY.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Bu.connecting:return Jd.Connecting;case Bu.open:return Jd.Open;case Bu.closing:return Jd.Closing;default:return Jd.Closed}}isConnected(){return this.connectionState()===Jd.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(s=>s.topic===n);if(i)return i;{const s=new aC(`realtime:${e}`,t,this);return this.channels.push(s),s}}push(e){const{topic:t,event:n,payload:i,ref:s}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${n} (${s})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(pY,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},ab.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:s,ref:o}=t,l=o?`(${o})`:"",c=s.status||"";this.log("receive",`${c} ${n} ${i} ${l}`.trim(),s),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(i,s,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Bu.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Bu.open||this.conn.readyState===Bu.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(wl.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([NY],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(i){this.log("error","Error fetching access token from callback",i),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(i=>{const s={access_token:t,version:fY};t&&i.updateJoinPayload(s),i.joinedOnce&&i._isJoined()&&i._push(wl.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new iW(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},ab.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,i,s,o,l,c,u,h,A,f,p;switch(this.transport=(t=e?.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e?.timeout)!==null&&n!==void 0?n:o2,this.heartbeatIntervalMs=(i=e?.heartbeatIntervalMs)!==null&&i!==void 0?i:ab.HEARTBEAT_INTERVAL,this.worker=(s=e?.worker)!==null&&s!==void 0?s:!1,this.accessToken=(o=e?.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e?.heartbeatCallback)!==null&&l!==void 0?l:bG,this.vsn=(c=e?.vsn)!==null&&c!==void 0?c:iw,e?.params&&(this.params=e.params),e?.logger&&(this.logger=e.logger),(e?.logLevel||e?.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(u=e?.reconnectAfterMs)!==null&&u!==void 0?u:(y=>wY[y-1]||RY),this.vsn){case nW:this.encode=(h=e?.encode)!==null&&h!==void 0?h:((y,G)=>G(JSON.stringify(y))),this.decode=(A=e?.decode)!==null&&A!==void 0?A:((y,G)=>G(JSON.parse(y)));break;case mY:this.encode=(f=e?.encode)!==null&&f!==void 0?f:this.serializer.encode.bind(this.serializer),this.decode=(p=e?.decode)!==null&&p!==void 0?p:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e?.workerUrl}}}var qf=class extends Error{constructor(a,e){super(a),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&e.icebergType?.includes("CommitState")===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function VY(a,e,t){const n=new URL(e,a);if(t)for(const[i,s]of Object.entries(t))s!==void 0&&n.searchParams.set(i,s);return n.toString()}async function MY(a){return!a||a.type==="none"?{}:a.type==="bearer"?{Authorization:`Bearer ${a.token}`}:a.type==="header"?{[a.name]:a.value}:a.type==="custom"?await a.getHeaders():{}}function _Y(a){const e=a.fetchImpl??globalThis.fetch;return{async request({method:t,path:n,query:i,body:s,headers:o}){const l=VY(a.baseUrl,n,i),c=await MY(a.auth),u=await e(l,{method:t,headers:{...s?{"Content-Type":"application/json"}:{},...c,...o},body:s?JSON.stringify(s):void 0}),h=await u.text(),A=(u.headers.get("content-type")||"").includes("application/json"),f=A&&h?JSON.parse(h):h;if(!u.ok){const p=A?f:void 0,y=p?.error;throw new qf(y?.message??`Request failed with status ${u.status}`,{status:u.status,icebergType:y?.type,icebergCode:y?.code,details:p})}return{status:u.status,headers:u.headers,data:f}}}}function sb(a){return a.join("")}var XY=class{constructor(a,e=""){this.client=a,this.prefix=e}async listNamespaces(a){const e=a?{parent:sb(a.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(a,e){const t={namespace:a.namespace,properties:e?.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(a){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${sb(a.namespace)}`})}async loadNamespaceMetadata(a){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${sb(a.namespace)}`})).data.properties}}async namespaceExists(a){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${sb(a.namespace)}`}),!0}catch(e){if(e instanceof qf&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(a,e){try{return await this.createNamespace(a,e)}catch(t){if(t instanceof qf&&t.status===409)return;throw t}}};function yh(a){return a.join("")}var YY=class{constructor(a,e="",t){this.client=a,this.prefix=e,this.accessDelegation=t}async listTables(a){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${yh(a.namespace)}/tables`})).data.identifiers}async createTable(a,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${yh(a.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(a,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${yh(a.namespace)}/tables/${a.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(a,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${yh(a.namespace)}/tables/${a.name}`,query:{purgeRequested:String(e?.purge??!1)}})}async loadTable(a){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${yh(a.namespace)}/tables/${a.name}`,headers:e})).data.metadata}async tableExists(a){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${yh(a.namespace)}/tables/${a.name}`,headers:e}),!0}catch(t){if(t instanceof qf&&t.status===404)return!1;throw t}}async createTableIfNotExists(a,e){try{return await this.createTable(a,e)}catch(t){if(t instanceof qf&&t.status===409)return await this.loadTable({namespace:a.namespace,name:e.name});throw t}}},HY=class{constructor(a){let e="v1";a.catalogName&&(e+=`/${a.catalogName}`);const t=a.baseUrl.endsWith("/")?a.baseUrl:`${a.baseUrl}/`;this.client=_Y({baseUrl:t,auth:a.auth,fetchImpl:a.fetch}),this.accessDelegation=a.accessDelegation?.join(","),this.namespaceOps=new XY(this.client,e),this.tableOps=new YY(this.client,e,this.accessDelegation)}async listNamespaces(a){return this.namespaceOps.listNamespaces(a)}async createNamespace(a,e){return this.namespaceOps.createNamespace(a,e)}async dropNamespace(a){await this.namespaceOps.dropNamespace(a)}async loadNamespaceMetadata(a){return this.namespaceOps.loadNamespaceMetadata(a)}async listTables(a){return this.tableOps.listTables(a)}async createTable(a,e){return this.tableOps.createTable(a,e)}async updateTable(a,e){return this.tableOps.updateTable(a,e)}async dropTable(a,e){await this.tableOps.dropTable(a,e)}async loadTable(a){return this.tableOps.loadTable(a)}async namespaceExists(a){return this.namespaceOps.namespaceExists(a)}async tableExists(a){return this.tableOps.tableExists(a)}async createNamespaceIfNotExists(a,e){return this.namespaceOps.createNamespaceIfNotExists(a,e)}async createTableIfNotExists(a,e){return this.tableOps.createTableIfNotExists(a,e)}},My=class extends Error{constructor(a){super(a),this.__isStorageError=!0,this.name="StorageError"}};function sa(a){return typeof a=="object"&&a!==null&&"__isStorageError"in a}var EY=class extends My{constructor(a,e,t){super(a),this.name="StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},c2=class extends My{constructor(a,e){super(a),this.name="StorageUnknownError",this.originalError=e}};const rS=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),FY=()=>Response,g2=a=>{if(Array.isArray(a))return a.map(t=>g2(t));if(typeof a=="function"||a!==Object(a))return a;const e={};return Object.entries(a).forEach(([t,n])=>{const i=t.replace(/([-_][a-z])/gi,s=>s.toUpperCase().replace(/[-_]/g,""));e[i]=g2(n)}),e},KY=a=>{if(typeof a!="object"||a===null)return!1;const e=Object.getPrototypeOf(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},TY=a=>!a||typeof a!="string"||a.length===0||a.length>100||a.trim()!==a||a.includes("/")||a.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(a);function $f(a){"@babel/helpers - typeof";return $f=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},$f(a)}function zY(a,e){if($f(a)!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var n=t.call(a,e);if($f(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function LY(a){var e=zY(a,"string");return $f(e)=="symbol"?e:e+""}function kY(a,e,t){return(e=LY(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function rw(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function xn(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?rw(Object(t),!0).forEach(function(n){kY(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):rw(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}const yG=a=>{var e;return a.msg||a.message||a.error_description||(typeof a.error=="string"?a.error:(e=a.error)===null||e===void 0?void 0:e.message)||JSON.stringify(a)},UY=async(a,e,t)=>{a instanceof await FY()&&!t?.noResolveJson?a.json().then(n=>{const i=a.status||500,s=n?.statusCode||i+"";e(new EY(yG(n),i,s))}).catch(n=>{e(new c2(yG(n),n))}):e(new c2(yG(a),a))},DY=(a,e,t,n)=>{const i={method:a,headers:e?.headers||{}};return a==="GET"||!n?i:(KY(n)?(i.headers=xn({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(n)):i.body=n,e?.duplex&&(i.duplex=e.duplex),xn(xn({},i),t))};async function Zm(a,e,t,n,i,s){return new Promise((o,l)=>{a(t,DY(e,n,i,s)).then(c=>{if(!c.ok)throw c;return n?.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>UY(c,l,n))})}async function em(a,e,t,n){return Zm(a,"GET",e,t,n)}async function Zl(a,e,t,n,i){return Zm(a,"POST",e,n,i,t)}async function u2(a,e,t,n,i){return Zm(a,"PUT",e,n,i,t)}async function OY(a,e,t,n){return Zm(a,"HEAD",e,xn(xn({},t),{},{noResolveJson:!0}),n)}async function lS(a,e,t,n,i){return Zm(a,"DELETE",e,n,i,t)}var jY=class{constructor(a,e){this.downloadFn=a,this.shouldThrowOnError=e}then(a,e){return this.execute().then(a,e)}async execute(){var a=this;try{return{data:(await a.downloadFn()).body,error:null}}catch(e){if(a.shouldThrowOnError)throw e;if(sa(e))return{data:null,error:e};throw e}}};let oW;oW=Symbol.toStringTag;var JY=class{constructor(a,e){this.downloadFn=a,this.shouldThrowOnError=e,this[oW]="BlobDownloadBuilder",this.promise=null}asStream(){return new jY(this.downloadFn,this.shouldThrowOnError)}then(a,e){return this.getPromise().then(a,e)}catch(a){return this.getPromise().catch(a)}finally(a){return this.getPromise().finally(a)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var a=this;try{return{data:await(await a.downloadFn()).blob(),error:null}}catch(e){if(a.shouldThrowOnError)throw e;if(sa(e))return{data:null,error:e};throw e}}};const PY={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},lw={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var QY=class{constructor(a,e={},t,n){this.shouldThrowOnError=!1,this.url=a,this.headers=e,this.bucketId=t,this.fetch=rS(n)}throwOnError(){return this.shouldThrowOnError=!0,this}async uploadOrUpdate(a,e,t,n){var i=this;try{let s;const o=xn(xn({},lw),n);let l=xn(xn({},i.headers),a==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&t instanceof Blob?(s=new FormData,s.append("cacheControl",o.cacheControl),c&&s.append("metadata",i.encodeMetadata(c)),s.append("",t)):typeof FormData<"u"&&t instanceof FormData?(s=t,s.has("cacheControl")||s.append("cacheControl",o.cacheControl),c&&!s.has("metadata")&&s.append("metadata",i.encodeMetadata(c))):(s=t,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=i.toBase64(i.encodeMetadata(c))),(typeof ReadableStream<"u"&&s instanceof ReadableStream||s&&typeof s=="object"&&"pipe"in s&&typeof s.pipe=="function")&&!o.duplex&&(o.duplex="half")),n?.headers&&(l=xn(xn({},l),n.headers));const u=i._removeEmptyFolders(e),h=i._getFinalPath(u),A=await(a=="PUT"?u2:Zl)(i.fetch,`${i.url}/object/${h}`,s,xn({headers:l},o?.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:A.Id,fullPath:A.Key},error:null}}catch(s){if(i.shouldThrowOnError)throw s;if(sa(s))return{data:null,error:s};throw s}}async upload(a,e,t){return this.uploadOrUpdate("POST",a,e,t)}async uploadToSignedUrl(a,e,t,n){var i=this;const s=i._removeEmptyFolders(a),o=i._getFinalPath(s),l=new URL(i.url+`/object/upload/sign/${o}`);l.searchParams.set("token",e);try{let c;const u=xn({upsert:lw.upsert},n),h=xn(xn({},i.headers),{"x-upsert":String(u.upsert)});return typeof Blob<"u"&&t instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",t)):typeof FormData<"u"&&t instanceof FormData?(c=t,c.append("cacheControl",u.cacheControl)):(c=t,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType),{data:{path:s,fullPath:(await u2(i.fetch,l.toString(),c,{headers:h})).Key},error:null}}catch(c){if(i.shouldThrowOnError)throw c;if(sa(c))return{data:null,error:c};throw c}}async createSignedUploadUrl(a,e){var t=this;try{let n=t._getFinalPath(a);const i=xn({},t.headers);e?.upsert&&(i["x-upsert"]="true");const s=await Zl(t.fetch,`${t.url}/object/upload/sign/${n}`,{},{headers:i}),o=new URL(t.url+s.url),l=o.searchParams.get("token");if(!l)throw new My("No token returned by API");return{data:{signedUrl:o.toString(),path:a,token:l},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(sa(n))return{data:null,error:n};throw n}}async update(a,e,t){return this.uploadOrUpdate("PUT",a,e,t)}async move(a,e,t){var n=this;try{return{data:await Zl(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:a,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:n.headers}),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(sa(i))return{data:null,error:i};throw i}}async copy(a,e,t){var n=this;try{return{data:{path:(await Zl(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:a,destinationKey:e,destinationBucket:t?.destinationBucket},{headers:n.headers})).Key},error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(sa(i))return{data:null,error:i};throw i}}async createSignedUrl(a,e,t){var n=this;try{let i=n._getFinalPath(a),s=await Zl(n.fetch,`${n.url}/object/sign/${i}`,xn({expiresIn:e},t?.transform?{transform:t.transform}:{}),{headers:n.headers});const o=t?.download?`&download=${t.download===!0?"":t.download}`:"";return s={signedUrl:encodeURI(`${n.url}${s.signedURL}${o}`)},{data:s,error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(sa(i))return{data:null,error:i};throw i}}async createSignedUrls(a,e,t){var n=this;try{const i=await Zl(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:a},{headers:n.headers}),s=t?.download?`&download=${t.download===!0?"":t.download}`:"";return{data:i.map(o=>xn(xn({},o),{},{signedUrl:o.signedURL?encodeURI(`${n.url}${o.signedURL}${s}`):null})),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(sa(i))return{data:null,error:i};throw i}}download(a,e){const t=typeof e?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(e?.transform||{}),i=n?`?${n}`:"",s=this._getFinalPath(a),o=()=>em(this.fetch,`${this.url}/${t}/${s}${i}`,{headers:this.headers,noResolveJson:!0});return new JY(o,this.shouldThrowOnError)}async info(a){var e=this;const t=e._getFinalPath(a);try{return{data:g2(await em(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})),error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(sa(n))return{data:null,error:n};throw n}}async exists(a){var e=this;const t=e._getFinalPath(a);try{return await OY(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(sa(n)&&n instanceof c2){const i=n.originalError;if([400,404].includes(i?.status))return{data:!1,error:n}}throw n}}getPublicUrl(a,e){const t=this._getFinalPath(a),n=[],i=e?.download?`download=${e.download===!0?"":e.download}`:"";i!==""&&n.push(i);const s=typeof e?.transform<"u"?"render/image":"object",o=this.transformOptsToQueryString(e?.transform||{});o!==""&&n.push(o);let l=n.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${s}/public/${t}${l}`)}}}async remove(a){var e=this;try{return{data:await lS(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:a},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}async list(a,e,t){var n=this;try{const i=xn(xn(xn({},PY),e),{},{prefix:a||""});return{data:await Zl(n.fetch,`${n.url}/object/list/${n.bucketId}`,i,{headers:n.headers},t),error:null}}catch(i){if(n.shouldThrowOnError)throw i;if(sa(i))return{data:null,error:i};throw i}}async listV2(a,e){var t=this;try{const n=xn({},a);return{data:await Zl(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,n,{headers:t.headers},e),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(sa(n))return{data:null,error:n};throw n}}encodeMetadata(a){return JSON.stringify(a)}toBase64(a){return typeof Buffer<"u"?Buffer.from(a).toString("base64"):btoa(a)}_getFinalPath(a){return`${this.bucketId}/${a.replace(/^\/+/,"")}`}_removeEmptyFolders(a){return a.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(a){const e=[];return a.width&&e.push(`width=${a.width}`),a.height&&e.push(`height=${a.height}`),a.resize&&e.push(`resize=${a.resize}`),a.format&&e.push(`format=${a.format}`),a.quality&&e.push(`quality=${a.quality}`),e.join("&")}};const rW="2.89.0",lW={"X-Client-Info":`storage-js/${rW}`};var qY=class{constructor(a,e={},t,n){this.shouldThrowOnError=!1;const i=new URL(a);n?.useNewHostname&&/supabase\.(co|in|red)$/.test(i.hostname)&&!i.hostname.includes("storage.supabase.")&&(i.hostname=i.hostname.replace("supabase.","storage.supabase.")),this.url=i.href.replace(/\/$/,""),this.headers=xn(xn({},lW),e),this.fetch=rS(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async listBuckets(a){var e=this;try{const t=e.listBucketOptionsToQueryString(a);return{data:await em(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}async getBucket(a){var e=this;try{return{data:await em(e.fetch,`${e.url}/bucket/${a}`,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}async createBucket(a,e={public:!1}){var t=this;try{return{data:await Zl(t.fetch,`${t.url}/bucket`,{id:a,name:a,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(sa(n))return{data:null,error:n};throw n}}async updateBucket(a,e){var t=this;try{return{data:await u2(t.fetch,`${t.url}/bucket/${a}`,{id:a,name:a,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(sa(n))return{data:null,error:n};throw n}}async emptyBucket(a){var e=this;try{return{data:await Zl(e.fetch,`${e.url}/bucket/${a}/empty`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}async deleteBucket(a){var e=this;try{return{data:await lS(e.fetch,`${e.url}/bucket/${a}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}listBucketOptionsToQueryString(a){const e={};return a&&("limit"in a&&(e.limit=String(a.limit)),"offset"in a&&(e.offset=String(a.offset)),a.search&&(e.search=a.search),a.sortColumn&&(e.sortColumn=a.sortColumn),a.sortOrder&&(e.sortOrder=a.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},$Y=class{constructor(a,e={},t){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=xn(xn({},lW),e),this.fetch=rS(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(a){var e=this;try{return{data:await Zl(e.fetch,`${e.url}/bucket`,{name:a},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}async listBuckets(a){var e=this;try{const t=new URLSearchParams;a?.limit!==void 0&&t.set("limit",a.limit.toString()),a?.offset!==void 0&&t.set("offset",a.offset.toString()),a?.sortColumn&&t.set("sortColumn",a.sortColumn),a?.sortOrder&&t.set("sortOrder",a.sortOrder),a?.search&&t.set("search",a.search);const n=t.toString(),i=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return{data:await em(e.fetch,i,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}async deleteBucket(a){var e=this;try{return{data:await lS(e.fetch,`${e.url}/bucket/${a}`,{},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(sa(t))return{data:null,error:t};throw t}}from(a){var e=this;if(!TY(a))throw new My("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new HY({baseUrl:this.url,catalogName:a,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(t,{get(i,s){const o=i[s];return typeof o!="function"?o:async(...l)=>{try{return{data:await o.apply(i,l),error:null}}catch(c){if(n)throw c;return{data:null,error:c}}}}})}};const cS={"X-Client-Info":`storage-js/${rW}`,"Content-Type":"application/json"};var cW=class extends Error{constructor(a){super(a),this.__isStorageVectorsError=!0,this.name="StorageVectorsError"}};function ur(a){return typeof a=="object"&&a!==null&&"__isStorageVectorsError"in a}var vG=class extends cW{constructor(a,e,t){super(a),this.name="StorageVectorsApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},eH=class extends cW{constructor(a,e){super(a),this.name="StorageVectorsUnknownError",this.originalError=e}};const gS=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),tH=a=>{if(typeof a!="object"||a===null)return!1;const e=Object.getPrototypeOf(a);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in a)&&!(Symbol.iterator in a)},cw=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),nH=async(a,e,t)=>{if(a&&typeof a=="object"&&"status"in a&&"ok"in a&&typeof a.status=="number"&&!t?.noResolveJson){const n=a.status||500,i=a;if(typeof i.json=="function")i.json().then(s=>{const o=s?.statusCode||s?.code||n+"";e(new vG(cw(s),n,o))}).catch(()=>{const s=n+"";e(new vG(i.statusText||`HTTP ${n} error`,n,s))});else{const s=n+"";e(new vG(i.statusText||`HTTP ${n} error`,n,s))}}else e(new eH(cw(a),a))},iH=(a,e,t,n)=>{const i={method:a,headers:e?.headers||{}};return n?(tH(n)?(i.headers=xn({"Content-Type":"application/json"},e?.headers),i.body=JSON.stringify(n)):i.body=n,xn(xn({},i),t)):i};async function aH(a,e,t,n,i,s){return new Promise((o,l)=>{a(t,iH(e,n,i,s)).then(c=>{if(!c.ok)throw c;if(n?.noResolveJson)return c;const u=c.headers.get("content-type");return!u||!u.includes("application/json")?{}:c.json()}).then(c=>o(c)).catch(c=>nH(c,l,n))})}async function dr(a,e,t,n,i){return aH(a,"POST",e,n,i,t)}var sH=class{constructor(a,e={},t){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=xn(xn({},cS),e),this.fetch=gS(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createIndex(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/CreateIndex`,a,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async getIndex(a,e){var t=this;try{return{data:await dr(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:a,indexName:e},{headers:t.headers}),error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}async listIndexes(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/ListIndexes`,a,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async deleteIndex(a,e){var t=this;try{return{data:await dr(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:a,indexName:e},{headers:t.headers})||{},error:null}}catch(n){if(t.shouldThrowOnError)throw n;if(ur(n))return{data:null,error:n};throw n}}},oH=class{constructor(a,e={},t){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=xn(xn({},cS),e),this.fetch=gS(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async putVectors(a){var e=this;try{if(a.vectors.length<1||a.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return{data:await dr(e.fetch,`${e.url}/PutVectors`,a,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async getVectors(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/GetVectors`,a,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async listVectors(a){var e=this;try{if(a.segmentCount!==void 0){if(a.segmentCount<1||a.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(a.segmentIndex!==void 0&&(a.segmentIndex<0||a.segmentIndex>=a.segmentCount))throw new Error(`segmentIndex must be between 0 and ${a.segmentCount-1}`)}return{data:await dr(e.fetch,`${e.url}/ListVectors`,a,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async queryVectors(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/QueryVectors`,a,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async deleteVectors(a){var e=this;try{if(a.keys.length<1||a.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return{data:await dr(e.fetch,`${e.url}/DeleteVectors`,a,{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}},rH=class{constructor(a,e={},t){this.shouldThrowOnError=!1,this.url=a.replace(/\/$/,""),this.headers=xn(xn({},cS),e),this.fetch=gS(t)}throwOnError(){return this.shouldThrowOnError=!0,this}async createBucket(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:a},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async getBucket(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:a},{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async listBuckets(a={}){var e=this;try{return{data:await dr(e.fetch,`${e.url}/ListVectorBuckets`,a,{headers:e.headers}),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}async deleteBucket(a){var e=this;try{return{data:await dr(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:a},{headers:e.headers})||{},error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(ur(t))return{data:null,error:t};throw t}}},lH=class extends rH{constructor(a,e={}){super(a,e.headers||{},e.fetch)}from(a){return new cH(this.url,this.headers,a,this.fetch)}async createBucket(a){var e=()=>super.createBucket,t=this;return e().call(t,a)}async getBucket(a){var e=()=>super.getBucket,t=this;return e().call(t,a)}async listBuckets(a={}){var e=()=>super.listBuckets,t=this;return e().call(t,a)}async deleteBucket(a){var e=()=>super.deleteBucket,t=this;return e().call(t,a)}},cH=class extends sH{constructor(a,e,t,n){super(a,e,n),this.vectorBucketName=t}async createIndex(a){var e=()=>super.createIndex,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(a={}){var e=()=>super.listIndexes,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(a){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,a)}async deleteIndex(a){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,a)}index(a){return new gH(this.url,this.headers,this.vectorBucketName,a,this.fetch)}},gH=class extends oH{constructor(a,e,t,n,i){super(a,e,i),this.vectorBucketName=t,this.indexName=n}async putVectors(a){var e=()=>super.putVectors,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(a){var e=()=>super.getVectors,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(a={}){var e=()=>super.listVectors,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(a){var e=()=>super.queryVectors,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(a){var e=()=>super.deleteVectors,t=this;return e().call(t,xn(xn({},a),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},uH=class extends qY{constructor(a,e={},t,n){super(a,e,t,n)}from(a){return new QY(this.url,this.headers,a,this.fetch)}get vectors(){return new lH(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new $Y(this.url+"/iceberg",this.headers,this.fetch)}};const gW="2.89.0",tC=30*1e3,d2=3,GG=d2*tC,dH="http://localhost:9999",IH="supabase.auth.token",hH={"X-Client-Info":`gotrue-js/${gW}`},I2="X-Supabase-Api-Version",uW={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},CH=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,AH=600*1e3;class tm extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function hn(a){return typeof a=="object"&&a!==null&&"__isAuthError"in a}class fH extends tm{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function mH(a){return hn(a)&&a.name==="AuthApiError"}class Pd extends tm{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class Wg extends tm{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}}class cr extends Wg{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function pH(a){return hn(a)&&a.name==="AuthSessionMissingError"}class vh extends Wg{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class ob extends Wg{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class rb extends Wg{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function bH(a){return hn(a)&&a.name==="AuthImplicitGrantRedirectError"}class gw extends Wg{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class yH extends Wg{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class h2 extends Wg{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function BG(a){return hn(a)&&a.name==="AuthRetryableFetchError"}class uw extends Wg{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class C2 extends Wg{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const S0="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),dw=` 	
\r=`.split(""),vH=(()=>{const a=new Array(128);for(let e=0;e<a.length;e+=1)a[e]=-1;for(let e=0;e<dw.length;e+=1)a[dw[e].charCodeAt(0)]=-2;for(let e=0;e<S0.length;e+=1)a[S0[e].charCodeAt(0)]=e;return a})();function Iw(a,e,t){if(a!==null)for(e.queue=e.queue<<8|a,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(S0[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(S0[n]),e.queuedBits-=6}}function dW(a,e,t){const n=vH[a];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(a)}"`)}}function hw(a){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},s=o=>{SH(o,n,t)};for(let o=0;o<a.length;o+=1)dW(a.charCodeAt(o),i,s);return e.join("")}function GH(a,e){if(a<=127){e(a);return}else if(a<=2047){e(192|a>>6),e(128|a&63);return}else if(a<=65535){e(224|a>>12),e(128|a>>6&63),e(128|a&63);return}else if(a<=1114111){e(240|a>>18),e(128|a>>12&63),e(128|a>>6&63),e(128|a&63);return}throw new Error(`Unrecognized Unicode codepoint: ${a.toString(16)}`)}function BH(a,e){for(let t=0;t<a.length;t+=1){let n=a.charCodeAt(t);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(a.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}GH(n,e)}}function SH(a,e,t){if(e.utf8seq===0){if(a<=127){t(a);return}for(let n=1;n<6;n+=1)if((a>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=a&31;else if(e.utf8seq===3)e.codepoint=a&15;else if(e.utf8seq===4)e.codepoint=a&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(a<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|a&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function cC(a){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<a.length;i+=1)dW(a.charCodeAt(i),t,n);return new Uint8Array(e)}function xH(a){const e=[];return BH(a,t=>e.push(t)),new Uint8Array(e)}function tI(a){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};return a.forEach(i=>Iw(i,t,n)),Iw(null,t,n),e.join("")}function ZH(a){return Math.round(Date.now()/1e3)+a}function wH(){return Symbol("auth-callback")}const ys=()=>typeof window<"u"&&typeof document<"u",Zd={tested:!1,writable:!1},IW=()=>{if(!ys())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Zd.tested)return Zd.writable;const a=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(a,a),globalThis.localStorage.removeItem(a),Zd.tested=!0,Zd.writable=!0}catch{Zd.tested=!0,Zd.writable=!1}return Zd.writable};function RH(a){const e={},t=new URL(a);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,s)=>{e[s]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}const hW=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),NH=a=>typeof a=="object"&&a!==null&&"status"in a&&"ok"in a&&"json"in a&&typeof a.json=="function",nC=async(a,e,t)=>{await a.setItem(e,JSON.stringify(t))},wd=async(a,e)=>{const t=await a.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},As=async(a,e)=>{await a.removeItem(e)};class _y{constructor(){this.promise=new _y.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}_y.promiseConstructor=Promise;function SG(a){const e=a.split(".");if(e.length!==3)throw new C2("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!CH.test(e[n]))throw new C2("JWT not in base64url format");return{header:JSON.parse(hw(e[0])),payload:JSON.parse(hw(e[1])),signature:cC(e[2]),raw:{header:e[0],payload:e[1]}}}async function WH(a){return await new Promise(e=>{setTimeout(()=>e(null),a)})}function VH(a,e){return new Promise((n,i)=>{(async()=>{for(let s=0;s<1/0;s++)try{const o=await a(s);if(!e(s,null,o)){n(o);return}}catch(o){if(!e(s,o)){i(o);return}}})()})}function MH(a){return("0"+a.toString(16)).substr(-2)}function _H(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let i="";for(let s=0;s<56;s++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,MH).join("")}async function XH(a){const t=new TextEncoder().encode(a),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(s=>String.fromCharCode(s)).join("")}async function YH(a){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),a;const t=await XH(a);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Gh(a,e,t=!1){const n=_H();let i=n;t&&(i+="/PASSWORD_RECOVERY"),await nC(a,`${e}-code-verifier`,i);const s=await YH(n);return[s,n===s?"plain":"s256"]}const HH=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function EH(a){const e=a.headers.get(I2);if(!e||!e.match(HH))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function FH(a){if(!a)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(a<=e)throw new Error("JWT has expired")}function KH(a){switch(a){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const TH=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Bh(a){if(!TH.test(a))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function xG(){const a={};return new Proxy(a,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function zH(a,e){return new Proxy(a,{get:(t,n,i)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const s=n.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)"||s==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,n,i)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,n,i)}})}function Cw(a){return JSON.parse(JSON.stringify(a))}const Ud=a=>a.msg||a.message||a.error_description||a.error||JSON.stringify(a),LH=[502,503,504];async function Aw(a){var e;if(!NH(a))throw new h2(Ud(a),0);if(LH.includes(a.status))throw new h2(Ud(a),a.status);let t;try{t=await a.json()}catch(s){throw new Pd(Ud(s),s)}let n;const i=EH(a);if(i&&i.getTime()>=uW["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new uw(Ud(t),a.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new cr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((s,o)=>s&&typeof o=="string",!0))throw new uw(Ud(t),a.status,t.weak_password.reasons);throw new fH(Ud(t),a.status||500,n)}const kH=(a,e,t,n)=>{const i={method:a,headers:e?.headers||{}};return a==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function Sn(a,e,t,n){var i;const s=Object.assign({},n?.headers);s[I2]||(s[I2]=uW["2024-01-01"].name),n?.jwt&&(s.Authorization=`Bearer ${n.jwt}`);const o=(i=n?.query)!==null&&i!==void 0?i:{};n?.redirectTo&&(o.redirect_to=n.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await UH(a,e,t+l,{headers:s,noResolveJson:n?.noResolveJson},{},n?.body);return n?.xform?n?.xform(c):{data:Object.assign({},c),error:null}}async function UH(a,e,t,n,i,s){const o=kH(e,n,i,s);let l;try{l=await a(t,Object.assign({},o))}catch(c){throw console.error(c),new h2(Ud(c),0)}if(l.ok||await Aw(l),n?.noResolveJson)return l;try{return await l.json()}catch(c){await Aw(c)}}function xl(a){var e;let t=null;jH(a)&&(t=Object.assign({},a),a.expires_at||(t.expires_at=ZH(a.expires_in)));const n=(e=a.user)!==null&&e!==void 0?e:a;return{data:{session:t,user:n},error:null}}function fw(a){const e=xl(a);return!e.error&&a.weak_password&&typeof a.weak_password=="object"&&Array.isArray(a.weak_password.reasons)&&a.weak_password.reasons.length&&a.weak_password.message&&typeof a.weak_password.message=="string"&&a.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=a.weak_password),e}function Zu(a){var e;return{data:{user:(e=a.user)!==null&&e!==void 0?e:a},error:null}}function DH(a){return{data:a,error:null}}function OH(a){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:s}=a,o=Vy(a,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:s},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function mw(a){return a}function jH(a){return a.access_token&&a.refresh_token&&a.expires_in}const ZG=["global","local","others"];class JH{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=hW(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=ZG[0]){if(ZG.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${ZG.join(", ")}`);try{return await Sn(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(hn(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Sn(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Zu})}catch(n){if(hn(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=Vy(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n?.newEmail,delete i.newEmail),await Sn(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:OH,redirectTo:t?.redirectTo})}catch(t){if(hn(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Sn(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Zu})}catch(t){if(hn(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,s,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},h=await Sn(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:mw});if(h.error)throw h.error;const A=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const G=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),B=JSON.parse(y.split(";")[1].split("=")[1]);u[`${B}Page`]=G}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},A),u),error:null}}catch(u){if(hn(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){Bh(e);try{return await Sn(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Zu})}catch(t){if(hn(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Bh(e);try{return await Sn(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Zu})}catch(n){if(hn(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Bh(e);try{return await Sn(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Zu})}catch(n){if(hn(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Bh(e.userId);try{const{data:t,error:n}=await Sn(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(hn(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Bh(e.userId),Bh(e.id);try{return{data:await Sn(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(hn(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,i,s,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},h=await Sn(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(s=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&s!==void 0?s:""},xform:mw});if(h.error)throw h.error;const A=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const G=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),B=JSON.parse(y.split(";")[1].split("=")[1]);u[`${B}Page`]=G}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},A),u),error:null}}catch(u){if(hn(u))return{data:{clients:[]},error:u};throw u}}async _createOAuthClient(e){try{return await Sn(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(hn(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Sn(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(hn(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Sn(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(hn(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await Sn(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(hn(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Sn(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(hn(t))return{data:null,error:t};throw t}}}function pw(a={}){return{getItem:e=>a[e]||null,setItem:(e,t)=>{a[e]=t},removeItem:e=>{delete a[e]}}}const Sh={debug:!!(globalThis&&IW()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class CW extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class PH extends CW{}async function QH(a,e,t){Sh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",a,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),Sh.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",a)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(a,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){Sh.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",a,i.name);try{return await t()}finally{Sh.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",a,i.name)}}else{if(e===0)throw Sh.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",a),new PH(`Acquiring an exclusive Navigator LockManager lock "${a}" immediately failed`);if(Sh.debug)try{const s=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(s,null,"  "))}catch(s){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",s)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}function qH(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function AW(a){if(!/^0x[a-fA-F0-9]{40}$/.test(a))throw new Error(`@supabase/auth-js: Address "${a}" is invalid.`);return a.toLowerCase()}function $H(a){return parseInt(a,16)}function eE(a){const e=new TextEncoder().encode(a);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function tE(a){var e;const{chainId:t,domain:n,expirationTime:i,issuedAt:s=new Date,nonce:o,notBefore:l,requestId:c,resources:u,scheme:h,uri:A,version:f}=a;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(o&&o.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${o}`);if(!A)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(f!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${f}`);if(!((e=a.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${a.statement}`)}const p=AW(a.address),y=h?`${h}://${n}`:n,G=a.statement?`${a.statement}
`:"",B=`${y} wants you to sign in with your Ethereum account:
${p}

${G}`;let S=`URI: ${A}
Version: ${f}
Chain ID: ${t}${o?`
Nonce: ${o}`:""}
Issued At: ${s.toISOString()}`;if(i&&(S+=`
Expiration Time: ${i.toISOString()}`),l&&(S+=`
Not Before: ${l.toISOString()}`),c&&(S+=`
Request ID: ${c}`),u){let N=`
Resources:`;for(const R of u){if(!R||typeof R!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${R}`);N+=`
- ${R}`}S+=N}return`${B}
${S}`}class Ya extends Error{constructor({message:e,code:t,cause:n,name:i}){var s;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(s=i??(n instanceof Error?n.name:void 0))!==null&&s!==void 0?s:"Unknown Error",this.code=t}}class x0 extends Ya{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function nE({error:a,options:e}){var t,n,i;const{publicKey:s}=e;if(!s)throw Error("options was missing required publicKey property");if(a.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ya({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else if(a.name==="ConstraintError"){if(((t=s.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Ya({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:a});if(e.mediation==="conditional"&&((n=s.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Ya({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:a});if(((i=s.authenticatorSelection)===null||i===void 0?void 0:i.userVerification)==="required")return new Ya({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:a})}else{if(a.name==="InvalidStateError")return new Ya({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:a});if(a.name==="NotAllowedError")return new Ya({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});if(a.name==="NotSupportedError")return s.pubKeyCredParams.filter(l=>l.type==="public-key").length===0?new Ya({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:a}):new Ya({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:a});if(a.name==="SecurityError"){const o=window.location.hostname;if(fW(o)){if(s.rp.id!==o)return new Ya({message:`The RP ID "${s.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else return new Ya({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a})}else if(a.name==="TypeError"){if(s.user.id.byteLength<1||s.user.id.byteLength>64)return new Ya({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:a})}else if(a.name==="UnknownError")return new Ya({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a})}return new Ya({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}function iE({error:a,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(a.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Ya({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:a})}else{if(a.name==="NotAllowedError")return new Ya({message:a.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a});if(a.name==="SecurityError"){const n=window.location.hostname;if(fW(n)){if(t.rpId!==n)return new Ya({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:a})}else return new Ya({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:a})}else if(a.name==="UnknownError")return new Ya({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:a})}return new Ya({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:a})}class aE{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const sE=new aE;function oE(a){if(!a)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(a);const{challenge:e,user:t,excludeCredentials:n}=a,i=Vy(a,["challenge","user","excludeCredentials"]),s=cC(e).buffer,o=Object.assign(Object.assign({},t),{id:cC(t.id).buffer}),l=Object.assign(Object.assign({},i),{challenge:s,user:o});if(n&&n.length>0){l.excludeCredentials=new Array(n.length);for(let c=0;c<n.length;c++){const u=n[c];l.excludeCredentials[c]=Object.assign(Object.assign({},u),{id:cC(u.id).buffer,type:u.type||"public-key",transports:u.transports})}}return l}function rE(a){if(!a)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(a);const{challenge:e,allowCredentials:t}=a,n=Vy(a,["challenge","allowCredentials"]),i=cC(e).buffer,s=Object.assign(Object.assign({},n),{challenge:i});if(t&&t.length>0){s.allowCredentials=new Array(t.length);for(let o=0;o<t.length;o++){const l=t[o];s.allowCredentials[o]=Object.assign(Object.assign({},l),{id:cC(l.id).buffer,type:l.type||"public-key",transports:l.transports})}}return s}function lE(a){var e;if("toJSON"in a&&typeof a.toJSON=="function")return a.toJSON();const t=a;return{id:a.id,rawId:a.id,response:{attestationObject:tI(new Uint8Array(a.response.attestationObject)),clientDataJSON:tI(new Uint8Array(a.response.clientDataJSON))},type:"public-key",clientExtensionResults:a.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function cE(a){var e;if("toJSON"in a&&typeof a.toJSON=="function")return a.toJSON();const t=a,n=a.getClientExtensionResults(),i=a.response;return{id:a.id,rawId:a.id,response:{authenticatorData:tI(new Uint8Array(i.authenticatorData)),clientDataJSON:tI(new Uint8Array(i.clientDataJSON)),signature:tI(new Uint8Array(i.signature)),userHandle:i.userHandle?tI(new Uint8Array(i.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function fW(a){return a==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(a)}function bw(){var a,e;return!!(ys()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((a=navigator?.credentials)===null||a===void 0?void 0:a.create)=="function"&&typeof((e=navigator?.credentials)===null||e===void 0?void 0:e.get)=="function")}async function gE(a){try{const e=await navigator.credentials.create(a);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new x0("Browser returned unexpected credential type",e)}:{data:null,error:new x0("Empty credential response",e)}}catch(e){return{data:null,error:nE({error:e,options:a})}}}async function uE(a){try{const e=await navigator.credentials.get(a);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new x0("Browser returned unexpected credential type",e)}:{data:null,error:new x0("Empty credential response",e)}}catch(e){return{data:null,error:iE({error:e,options:a})}}}const dE={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},IE={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Z0(...a){const e=i=>i!==null&&typeof i=="object"&&!Array.isArray(i),t=i=>i instanceof ArrayBuffer||ArrayBuffer.isView(i),n={};for(const i of a)if(i)for(const s in i){const o=i[s];if(o!==void 0)if(Array.isArray(o))n[s]=o;else if(t(o))n[s]=o;else if(e(o)){const l=n[s];e(l)?n[s]=Z0(l,o):n[s]=Z0(o)}else n[s]=o}return n}function hE(a,e){return Z0(dE,a,e||{})}function CE(a,e){return Z0(IE,a,e||{})}class AE{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:i},s){try{const{data:o,error:l}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!o)return{data:null,error:l};const c=i??sE.createNewAbortSignal();if(o.webauthn.type==="create"){const{user:u}=o.webauthn.credential_options.publicKey;u.name||(u.name=`${u.id}:${n}`),u.displayName||(u.displayName=u.name)}switch(o.webauthn.type){case"create":{const u=hE(o.webauthn.credential_options.publicKey,s?.create),{data:h,error:A}=await gE({publicKey:u,signal:c});return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:A}}case"request":{const u=CE(o.webauthn.credential_options.publicKey,s?.request),{data:h,error:A}=await uE(Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:u,signal:c}));return h?{data:{factorId:e,challengeId:o.id,webauthn:{type:o.webauthn.type,credential_response:h}},error:null}:{data:null,error:A}}}}catch(o){return hn(o)?{data:null,error:o}:{data:null,error:new Pd("Unexpected error in challenge",o)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!t)return{data:null,error:new tm("rpId is required for WebAuthn authentication")};try{if(!bw())return{data:null,error:new Pd("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:i},{request:s});if(!o)return{data:null,error:l};const{webauthn:c}=o;return this._verify({factorId:e,challengeId:o.challengeId,webauthn:{type:c.type,rpId:t,rpOrigins:n,credential_response:c.credential_response}})}catch(o){return hn(o)?{data:null,error:o}:{data:null,error:new Pd("Unexpected error in authenticate",o)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:i}={}},s){if(!t)return{data:null,error:new tm("rpId is required for WebAuthn registration")};try{if(!bw())return{data:null,error:new Pd("Browser does not support WebAuthn",null)};const{data:o,error:l}=await this._enroll({friendlyName:e});if(!o)return await this.client.mfa.listFactors().then(h=>{var A;return(A=h.data)===null||A===void 0?void 0:A.all.find(f=>f.factor_type==="webauthn"&&f.friendly_name===e&&f.status!=="unverified")}).then(h=>h?this.client.mfa.unenroll({factorId:h?.id}):void 0),{data:null,error:l};const{data:c,error:u}=await this._challenge({factorId:o.id,friendlyName:o.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:i},{create:s});return c?this._verify({factorId:o.id,challengeId:c.challengeId,webauthn:{rpId:t,rpOrigins:n,type:c.webauthn.type,credential_response:c.webauthn.credential_response}}):{data:null,error:u}}catch(o){return hn(o)?{data:null,error:o}:{data:null,error:new Pd("Unexpected error in register",o)}}}}qH();const fE={url:dH,storageKey:IH,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:hH,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1};async function yw(a,e,t){return await t()}const xh={};class nm{get jwks(){var e,t;return(t=(e=xh[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){xh[this.storageKey]=Object.assign(Object.assign({},xh[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=xh[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){xh[this.storageKey]=Object.assign(Object.assign({},xh[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,i;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const s=Object.assign(Object.assign({},fE),e);if(this.storageKey=s.storageKey,this.instanceID=(t=nm.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,nm.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.instanceID>0&&ys()){const o=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(o),this.logDebugMessages&&console.trace(o)}if(this.persistSession=s.persistSession,this.autoRefreshToken=s.autoRefreshToken,this.admin=new JH({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=hW(s.fetch),this.lock=s.lock||yw,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,this.throwOnError=s.throwOnError,s.lock?this.lock=s.lock:this.persistSession&&ys()&&(!((n=globalThis?.navigator)===null||n===void 0)&&n.locks)?this.lock=QH:this.lock=yw,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new AE(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:IW()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=pw(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=pw(this.memoryStorage)),ys()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(o){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",o)}(i=this.broadcastChannel)===null||i===void 0||i.addEventListener("message",async o=>{this._debug("received broadcast notification from other tab or client",o),await this._notifyAllSubscribers(o.data.event,o.data.session,!1)})}this.initialize()}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${gW}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},n="none";if(ys()&&(t=RH(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),ys()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:s}=await this._getSessionFromURL(t,n);if(s){if(this._debug("#_initialize()","error detecting session from URL",s),bH(s)){const c=(e=s.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:s}}return await this._removeSession(),{error:s}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return hn(t)?this._returnResult({error:t}):this._returnResult({error:new Pd("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{const s=await Sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:xl}),{data:o,error:l}=s;if(l||!o)return this._returnResult({data:{user:null,session:null},error:l});const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(s){if(hn(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signUp(e){var t,n,i;try{let s;if("email"in e){const{email:h,password:A,options:f}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await Gh(this.storage,this.storageKey)),s=await Sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:h,password:A,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:p,code_challenge_method:y},xform:xl})}else if("phone"in e){const{phone:h,password:A,options:f}=e;s=await Sn(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:A,data:(n=f?.data)!==null&&n!==void 0?n:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:xl})}else throw new ob("You must provide either an email or phone number and a password");const{data:o,error:l}=s;if(l||!o)return await As(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:l});const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(s){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithPassword(e){try{let t;if("email"in e){const{email:s,password:o,options:l}=e;t=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:s,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:fw})}else if("phone"in e){const{phone:s,password:o,options:l}=e;t=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:s,password:o,gotrue_meta_security:{captcha_token:l?.captchaToken}},xform:fw})}else throw new ob("You must provide either an email or phone number and a password");const{data:n,error:i}=t;if(i)return this._returnResult({data:{user:null,session:null},error:i});if(!n||!n.session||!n.user){const s=new vh;return this._returnResult({data:{user:null,session:null},error:s})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(hn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,i,s;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(s=e.options)===null||s===void 0?void 0:s.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,i,s,o,l,c,u,h,A,f;let p,y;if("message"in e)p=e.message,y=e.signature;else{const{chain:G,wallet:B,statement:S,options:N}=e;let R;if(ys())if(typeof B=="object")R=B;else{const M=window;if("ethereum"in M&&typeof M.ethereum=="object"&&"request"in M.ethereum&&typeof M.ethereum.request=="function")R=M.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof B!="object"||!N?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");R=B}const w=new URL((t=N?.url)!==null&&t!==void 0?t:window.location.href),V=await R.request({method:"eth_requestAccounts"}).then(M=>M).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!V||V.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const H=AW(V[0]);let X=(n=N?.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!X){const M=await R.request({method:"eth_chainId"});X=$H(M)}const Y={domain:w.host,address:H,statement:S,uri:w.href,version:"1",chainId:X,nonce:(i=N?.signInWithEthereum)===null||i===void 0?void 0:i.nonce,issuedAt:(o=(s=N?.signInWithEthereum)===null||s===void 0?void 0:s.issuedAt)!==null&&o!==void 0?o:new Date,expirationTime:(l=N?.signInWithEthereum)===null||l===void 0?void 0:l.expirationTime,notBefore:(c=N?.signInWithEthereum)===null||c===void 0?void 0:c.notBefore,requestId:(u=N?.signInWithEthereum)===null||u===void 0?void 0:u.requestId,resources:(h=N?.signInWithEthereum)===null||h===void 0?void 0:h.resources};p=tE(Y),y=await R.request({method:"personal_sign",params:[eE(p),H]})}try{const{data:G,error:B}=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:p,signature:y},!((A=e.options)===null||A===void 0)&&A.captchaToken?{gotrue_meta_security:{captcha_token:(f=e.options)===null||f===void 0?void 0:f.captchaToken}}:null),xform:xl});if(B)throw B;if(!G||!G.session||!G.user){const S=new vh;return this._returnResult({data:{user:null,session:null},error:S})}return G.session&&(await this._saveSession(G.session),await this._notifyAllSubscribers("SIGNED_IN",G.session)),this._returnResult({data:Object.assign({},G),error:B})}catch(G){if(hn(G))return this._returnResult({data:{user:null,session:null},error:G});throw G}}async signInWithSolana(e){var t,n,i,s,o,l,c,u,h,A,f,p;let y,G;if("message"in e)y=e.message,G=e.signature;else{const{chain:B,wallet:S,statement:N,options:R}=e;let w;if(ys())if(typeof S=="object")w=S;else{const H=window;if("solana"in H&&typeof H.solana=="object"&&("signIn"in H.solana&&typeof H.solana.signIn=="function"||"signMessage"in H.solana&&typeof H.solana.signMessage=="function"))w=H.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!R?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");w=S}const V=new URL((t=R?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in w&&w.signIn){const H=await w.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},R?.signInWithSolana),{version:"1",domain:V.host,uri:V.href}),N?{statement:N}:null));let X;if(Array.isArray(H)&&H[0]&&typeof H[0]=="object")X=H[0];else if(H&&typeof H=="object"&&"signedMessage"in H&&"signature"in H)X=H;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in X&&"signature"in X&&(typeof X.signedMessage=="string"||X.signedMessage instanceof Uint8Array)&&X.signature instanceof Uint8Array)y=typeof X.signedMessage=="string"?X.signedMessage:new TextDecoder().decode(X.signedMessage),G=X.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in w)||typeof w.signMessage!="function"||!("publicKey"in w)||typeof w!="object"||!w.publicKey||!("toBase58"in w.publicKey)||typeof w.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${V.host} wants you to sign in with your Solana account:`,w.publicKey.toBase58(),...N?["",N,""]:[""],"Version: 1",`URI: ${V.href}`,`Issued At: ${(i=(n=R?.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((s=R?.signInWithSolana)===null||s===void 0)&&s.notBefore?[`Not Before: ${R.signInWithSolana.notBefore}`]:[],...!((o=R?.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${R.signInWithSolana.expirationTime}`]:[],...!((l=R?.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${R.signInWithSolana.chainId}`]:[],...!((c=R?.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${R.signInWithSolana.nonce}`]:[],...!((u=R?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${R.signInWithSolana.requestId}`]:[],...!((A=(h=R?.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||A===void 0)&&A.length?["Resources",...R.signInWithSolana.resources.map(X=>`- ${X}`)]:[]].join(`
`);const H=await w.signMessage(new TextEncoder().encode(y),"utf8");if(!H||!(H instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");G=H}}try{const{data:B,error:S}=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:tI(G)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:xl});if(S)throw S;if(!B||!B.session||!B.user){const N=new vh;return this._returnResult({data:{user:null,session:null},error:N})}return B.session&&(await this._saveSession(B.session),await this._notifyAllSubscribers("SIGNED_IN",B.session)),this._returnResult({data:Object.assign({},B),error:S})}catch(B){if(hn(B))return this._returnResult({data:{user:null,session:null},error:B});throw B}}async _exchangeCodeForSession(e){const t=await wd(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t??"").split("/");try{if(!n&&this.flowType==="pkce")throw new yH;const{data:s,error:o}=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:xl});if(await As(this.storage,`${this.storageKey}-code-verifier`),o)throw o;if(!s||!s.session||!s.user){const l=new vh;return this._returnResult({data:{user:null,session:null,redirectType:null},error:l})}return s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),this._returnResult({data:Object.assign(Object.assign({},s),{redirectType:i??null}),error:o})}catch(s){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(s))return this._returnResult({data:{user:null,session:null,redirectType:null},error:s});throw s}}async signInWithIdToken(e){try{const{options:t,provider:n,token:i,access_token:s,nonce:o}=e,l=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:s,nonce:o,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:xl}),{data:c,error:u}=l;if(u)return this._returnResult({data:{user:null,session:null},error:u});if(!c||!c.session||!c.user){const h=new vh;return this._returnResult({data:{user:null,session:null},error:h})}return c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),this._returnResult({data:c,error:u})}catch(t){if(hn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,i,s,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await Gh(this.storage,this.storageKey));const{error:A}=await Sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c?.data)!==null&&t!==void 0?t:{},create_user:(n=c?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:A})}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:h}=await Sn(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c?.data)!==null&&i!==void 0?i:{},create_user:(s=c?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:c?.captchaToken},channel:(o=c?.channel)!==null&&o!==void 0?o:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:u?.message_id},error:h})}throw new ob("You must provide either an email or phone number.")}catch(l){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(l))return this._returnResult({data:{user:null,session:null},error:l});throw l}}async verifyOtp(e){var t,n;try{let i,s;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,s=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:l}=await Sn(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:s}}),redirectTo:i,xform:xl});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c?.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),this._returnResult({data:{user:u,session:c},error:null})}catch(i){if(hn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}}async signInWithSSO(e){var t,n,i,s,o;try{let l=null,c=null;this.flowType==="pkce"&&([l,c]=await Gh(this.storage,this.storageKey));const u=await Sn(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:l,code_challenge_method:c}),headers:this.headers,xform:DH});return!((s=u.data)===null||s===void 0)&&s.url&&ys()&&!(!((o=e.options)===null||o===void 0)&&o.skipBrowserRedirect)&&window.location.assign(u.data.url),this._returnResult(u)}catch(l){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(l))return this._returnResult({data:null,error:l});throw l}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new cr;const{error:i}=await Sn(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:i})})}catch(e){if(hn(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:s}=e,{error:o}=await Sn(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}},redirectTo:s?.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:o})}else if("phone"in e){const{phone:n,type:i,options:s}=e,{data:o,error:l}=await Sn(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:s?.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:o?.message_id},error:l})}throw new ob("You must provide either an email or phone number and a type")}catch(t){if(hn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await wd(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<GG:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await wd(this.userStorage,this.storageKey+"-user");o?.user?e.user=o.user:e.user=xG()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const o={value:this.suppressGetSessionWarning};e.user=zH(e.user,o),o.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{session:null},error:s}):this._returnResult({data:{session:i},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(-1,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await Sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Zu}):await this._useSession(async t=>{var n,i,s;const{data:o,error:l}=t;if(l)throw l;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new cr}:await Sn(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(s=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&s!==void 0?s:void 0,xform:Zu})})}catch(t){if(hn(t))return pH(t)&&(await this._removeSession(),await As(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:i,error:s}=n;if(s)throw s;if(!i.session)throw new cr;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await Gh(this.storage,this.storageKey));const{data:u,error:h}=await Sn(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:Zu});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),this._returnResult({data:{user:o.user},error:null})})}catch(n){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new cr;const t=Date.now()/1e3;let n=t,i=!0,s=null;const{payload:o}=SG(e.access_token);if(o.exp&&(n=o.exp,i=n<=t),i){const{data:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return this._returnResult({data:{user:null,session:null},error:c});if(!l)return{data:{user:null,session:null},error:null};s=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;s={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)}return this._returnResult({data:{user:s.user,session:s},error:null})}catch(t){if(hn(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!e?.refresh_token)throw new cr;const{data:i,error:s}=await this._callRefreshToken(e.refresh_token);return s?this._returnResult({data:{user:null,session:null},error:s}):i?this._returnResult({data:{user:i.user,session:i},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(hn(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!ys())throw new rb("No browser detected.");if(e.error||e.error_description||e.error_code)throw new rb(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new gw("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new rb("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new gw("No code detected.");const{data:N,error:R}=await this._exchangeCodeForSession(e.code);if(R)throw R;const w=new URL(window.location.href);return w.searchParams.delete("code"),window.history.replaceState(window.history.state,"",w.toString()),{data:{session:N.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:s,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!s||!l||!o||!u)throw new rb("No session defined in URL");const h=Math.round(Date.now()/1e3),A=parseInt(l);let f=h+A;c&&(f=parseInt(c));const p=f-h;p*1e3<=tC&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${A}s`);const y=f-A;h-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,h):h-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,h);const{data:G,error:B}=await this._getUser(s);if(B)throw B;const S={provider_token:n,provider_refresh_token:i,access_token:s,expires_in:A,expires_at:f,refresh_token:o,token_type:u,user:G.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:S,redirectType:e.type},error:null})}catch(n){if(hn(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await wd(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:i,error:s}=t;if(s)return this._returnResult({error:s});const o=(n=i.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(mH(l)&&(l.status===404||l.status===401||l.status===403)))return this._returnResult({error:l})}return e!=="others"&&(await this._removeSession(),await As(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=wH(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{const{data:{session:s},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",s)),this._debug("INITIAL_SESSION","callback id",e,"session",s)}catch(s){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",s),console.error(s)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await Gh(this.storage,this.storageKey,!0));try{return await Sn(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(s){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(s))return this._returnResult({data:null,error:s});throw s}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:i}=await this._useSession(async s=>{var o,l,c,u,h;const{data:A,error:f}=s;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await Sn(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=A.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return ys()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n?.url),this._returnResult({data:{provider:e.provider,url:n?.url},error:null})}catch(n){if(hn(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:i,data:{session:s}}=t;if(i)throw i;const{options:o,provider:l,token:c,access_token:u,nonce:h}=e,A=await Sn(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=s?.access_token)!==null&&n!==void 0?n:void 0,body:{provider:l,id_token:c,access_token:u,nonce:h,link_identity:!0,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:xl}),{data:f,error:p}=A;return p?this._returnResult({data:{user:null,session:null},error:p}):!f||!f.session||!f.user?this._returnResult({data:{user:null,session:null},error:new vh}):(f.session&&(await this._saveSession(f.session),await this._notifyAllSubscribers("USER_UPDATED",f.session)),this._returnResult({data:f,error:p}))}catch(i){if(await As(this.storage,`${this.storageKey}-code-verifier`),hn(i))return this._returnResult({data:{user:null,session:null},error:i});throw i}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;const{data:s,error:o}=t;if(o)throw o;return await Sn(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=s.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await VH(async i=>(i>0&&await WH(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await Sn(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:xl})),(i,s)=>{const o=200*Math.pow(2,i);return s&&BG(s)&&Date.now()+o-n<tC})}catch(n){if(this._debug(t,"error",n),hn(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),ys()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await wd(this.storage,this.storageKey);if(i&&this.userStorage){let o=await wd(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await nC(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o?.user)!==null&&e!==void 0?e:xG()}else if(i&&!i.user&&!i.user){const o=await wd(this.storage,this.storageKey+"-user");o&&o?.user?(i.user=o.user,await As(this.storage,this.storageKey+"-user"),await nC(this.storage,this.storageKey,i)):i.user=xG()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const s=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<GG;if(this._debug(n,`session has${s?"":" not"} expired with margin of ${GG}s`),s){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),BG(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(i.access_token);!l&&o?.user?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new cr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new _y;const{data:s,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!s.session)throw new cr;await this._saveSession(s.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",s.session);const l={data:s.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(s){if(this._debug(i,"error",s),hn(s)){const o={data:null,error:s};return BG(s)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(s),s}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const s=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){s.push(c)}});if(await Promise.all(o),s.length>0){for(let l=0;l<s.length;l+=1)console.error(s[l]);throw s[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await As(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await nC(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const s=Cw(i);await nC(this.storage,this.storageKey,s)}else{const i=Cw(t);await nC(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await As(this.storage,this.storageKey),await As(this.storage,this.storageKey+"-code-verifier"),await As(this.storage,this.storageKey+"-user"),this.userStorage&&await As(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&ys()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),tC);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/tC);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${tC}ms, refresh threshold is ${d2} ticks`),i<=d2&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof CW)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!ys()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const i=[`provider=${encodeURIComponent(t)}`];if(n?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n?.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[s,o]=await Gh(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(s)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(n?.queryParams){const s=new URLSearchParams(n.queryParams);i.push(s.toString())}return n?.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:i,error:s}=t;return s?this._returnResult({data:null,error:s}):await Sn(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;const{data:s,error:o}=t;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:c,error:u}=await Sn(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=s?.session)===null||n===void 0?void 0:n.access_token});return u?this._returnResult({data:null,error:u}):(e.factorType==="totp"&&c.type==="totp"&&(!((i=c?.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),this._returnResult({data:c,error:null}))})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:s}=t;if(s)return this._returnResult({data:null,error:s});const o=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?lE(e.webauthn.credential_response):cE(e.webauthn.credential_response)})}:{code:e.code}),{data:l,error:c}=await Sn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:o,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});return c?this._returnResult({data:null,error:c}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+l.expires_in},l)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",l),this._returnResult({data:l,error:c}))})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:s}=t;if(s)return this._returnResult({data:null,error:s});const o=await Sn(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=i?.session)===null||n===void 0?void 0:n.access_token});if(o.error)return o;const{data:l}=o;if(l.type!=="webauthn")return{data:l,error:null};switch(l.webauthn.type){case"create":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:oE(l.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},l),{webauthn:Object.assign(Object.assign({},l.webauthn),{credential_options:Object.assign(Object.assign({},l.webauthn.credential_options),{publicKey:rE(l.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const i={all:[],phone:[],totp:[],webauthn:[]};for(const s of(e=t?.factors)!==null&&e!==void 0?e:[])i.all.push(s),s.status==="verified"&&i[s.factor_type].push(s);return{data:i,error:null}}async _getAuthenticatorAssuranceLevel(){var e,t;const{data:{session:n},error:i}=await this.getSession();if(i)return this._returnResult({data:null,error:i});if(!n)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:s}=SG(n.access_token);let o=null;s.aal&&(o=s.aal);let l=o;((t=(e=n.user.factors)===null||e===void 0?void 0:e.filter(h=>h.status==="verified"))!==null&&t!==void 0?t:[]).length>0&&(l="aal2");const u=s.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:u},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:i}=t;return i?this._returnResult({data:null,error:i}):n?await Sn(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new cr})})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:i},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new cr});const o=await Sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"approve"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&ys()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(n){if(hn(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:i},error:s}=n;if(s)return this._returnResult({data:null,error:s});if(!i)return this._returnResult({data:null,error:new cr});const o=await Sn(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:i.access_token,body:{action:"deny"},xform:l=>({data:l,error:null})});return o.data&&o.data.redirect_url&&ys()&&!t?.skipBrowserRedirect&&window.location.assign(o.data.redirect_url),o})}catch(n){if(hn(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await Sn(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:i=>({data:i,error:null})}):this._returnResult({data:null,error:new cr})})}catch(e){if(hn(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:i}=t;return i?this._returnResult({data:null,error:i}):n?(await Sn(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new cr})})}catch(t){if(hn(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(l=>l.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(l=>l.kid===e),n&&this.jwks_cached_at+AH>i)return n;const{data:s,error:o}=await Sn(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!s.keys||s.keys.length===0||(this.jwks=s,this.jwks_cached_at=i,n=s.keys.find(l=>l.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:p,error:y}=await this.getSession();if(y||!p.session)return this._returnResult({data:null,error:y});n=p.session.access_token}const{header:i,payload:s,signature:o,raw:{header:l,payload:c}}=SG(n);t?.allowExpired||FH(s.exp);const u=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!u){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:s,header:i,signature:o},error:null}}const h=KH(i.alg),A=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,A,o,xH(`${l}.${c}`)))throw new C2("Invalid JWT signature");return{data:{claims:s,header:i,signature:o},error:null}}catch(n){if(hn(n))return this._returnResult({data:null,error:n});throw n}}}nm.nextInstanceID={};const mE=nm,pE="2.89.0";let Zf="";typeof Deno<"u"?Zf="deno":typeof document<"u"?Zf="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Zf="react-native":Zf="node";const bE={"X-Client-Info":`supabase-js-${Zf}/${pE}`},yE={headers:bE},vE={schema:"public"},GE={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},BE={};function im(a){"@babel/helpers - typeof";return im=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},im(a)}function SE(a,e){if(im(a)!="object"||!a)return a;var t=a[Symbol.toPrimitive];if(t!==void 0){var n=t.call(a,e);if(im(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(a)}function xE(a){var e=SE(a,"string");return im(e)=="symbol"?e:e+""}function ZE(a,e,t){return(e=xE(e))in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function vw(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(a,i).enumerable})),t.push.apply(t,n)}return t}function ha(a){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?vw(Object(t),!0).forEach(function(n){ZE(a,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):vw(Object(t)).forEach(function(n){Object.defineProperty(a,n,Object.getOwnPropertyDescriptor(t,n))})}return a}const wE=a=>a?(...e)=>a(...e):(...e)=>fetch(...e),RE=()=>Headers,NE=(a,e,t)=>{const n=wE(t),i=RE();return async(s,o)=>{var l;const c=(l=await e())!==null&&l!==void 0?l:a;let u=new i(o?.headers);return u.has("apikey")||u.set("apikey",a),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),n(s,ha(ha({},o),{},{headers:u}))}};function WE(a){return a.endsWith("/")?a:a+"/"}function VE(a,e){var t,n;const{db:i,auth:s,realtime:o,global:l}=a,{db:c,auth:u,realtime:h,global:A}=e,f={db:ha(ha({},c),i),auth:ha(ha({},u),s),realtime:ha(ha({},h),o),storage:{},global:ha(ha(ha({},A),l),{},{headers:ha(ha({},(t=A?.headers)!==null&&t!==void 0?t:{}),(n=l?.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return a.accessToken?f.accessToken=a.accessToken:delete f.accessToken,f}function ME(a){const e=a?.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(WE(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var _E=class extends mE{constructor(a){super(a)}},XE=class{constructor(a,e,t){var n,i;this.supabaseUrl=a,this.supabaseKey=e;const s=ME(a);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",s),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",s),this.storageUrl=new URL("storage/v1",s),this.functionsUrl=new URL("functions/v1",s);const o=`sb-${s.hostname.split(".")[0]}-auth-token`,l={db:vE,realtime:BE,auth:ha(ha({},GE),{},{storageKey:o}),global:yE},c=VE(t??{},l);if(this.storageKey=(n=c.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(i=c.global.headers)!==null&&i!==void 0?i:{},c.accessToken)this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(h,A)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(A)} is not possible`)}});else{var u;this.auth=this._initSupabaseAuthClient((u=c.auth)!==null&&u!==void 0?u:{},this.headers,c.global.fetch)}this.fetch=NE(e,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(ha({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.accessToken&&this.accessToken().then(h=>this.realtime.setAuth(h)).catch(h=>console.warn("Failed to set initial Realtime auth token:",h)),this.rest=new hY(new URL("rest/v1",s).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),this.storage=new uH(this.storageUrl.href,this.headers,this.fetch,t?.storage),c.accessToken||this._listenForAuthEvents()}get functions(){return new cY(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(a){return this.rest.from(a)}schema(a){return this.rest.schema(a)}rpc(a,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(a,e,t)}channel(a,e={config:{}}){return this.realtime.channel(a,e)}getChannels(){return this.realtime.getChannels()}removeChannel(a){return this.realtime.removeChannel(a)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var a=this,e,t;if(a.accessToken)return await a.accessToken();const{data:n}=await a.auth.getSession();return(e=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:a.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:a,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:i,storageKey:s,flowType:o,lock:l,debug:c,throwOnError:u},h,A){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new _E({url:this.authUrl.href,headers:ha(ha({},f),h),storageKey:s,autoRefreshToken:a,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:i,flowType:o,lock:l,debug:c,throwOnError:u,fetch:A,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(a){return new WY(this.realtimeUrl.href,ha(ha({},a),{},{params:ha(ha({},{apikey:this.supabaseKey}),a?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((a,e)=>{this._handleTokenChanged(a,"CLIENT",e?.access_token)})}_handleTokenChanged(a,e,t){(a==="TOKEN_REFRESHED"||a==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):a==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const YE=(a,e,t)=>new XE(a,e,t);function HE(){if(typeof window<"u"||typeof process>"u")return!1;const a=process.version;if(a==null)return!1;const e=a.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}HE()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const mW="https://qkxckmqseqzxsadwqpbk.supabase.co",EE="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFreGNrbXFzZXF6eHNhZHdxcGJrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYwOTg1NDUsImV4cCI6MjA4MTY3NDU0NX0.dmqFBbXrI2rPFjMGPmYK-Cb0dkhskDZvHBMwVPJsZd4";console.log("Inicializando Supabase Client em:",mW);const Lt=YE(mW,EE,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!1},global:{headers:{"x-my-custom-header":"rpg-manager"}}}),FE=()=>{const[a,e]=J.useState(null);return J.useEffect(()=>{(async()=>{const{data:n}=await Lt.auth.getSession();e(!!n.session)})()},[]),a===null?m.jsx("div",{style:{height:"100vh",width:"100vw",background:"#121214"}}):a?m.jsx(a2,{to:"/dashboard",replace:!0}):m.jsx(a2,{to:"/login",replace:!0})},Gw=["Voc se afastou demais... o Parasita est assumindo o controle.","Esta memria no existe.  uma alucinao da infeco.","Silncio. Voc consegue ouvir a colmeia chamando?","Sua conscincia falhou. Apenas o instinto resta aqui.","Voc caminhou para o vazio. No h nada aqui alm de fome.","Cuidado. Quando voc olha para o abismo, o Parasita olha de volta."];function KE(){const a=Ng(),[e,t]=J.useState("");return J.useEffect(()=>{const n=Gw[Math.floor(Math.random()*Gw.length)];t(n)},[]),m.jsxs("div",{className:"not-found-container",children:[m.jsx("div",{className:"vignette-overlay"}),m.jsx("div",{className:"pulse-background"}),m.jsxs("div",{className:"content-wrapper",children:[m.jsx("div",{className:"hallucination-wrapper",children:m.jsx("h1",{className:"hallucination-text","data-text":"404",children:"404"})}),m.jsx("h2",{className:"status-text",children:"DISSOCIAO DETECTADA"}),m.jsx("p",{className:"visceral-description",children:e}),m.jsx("div",{className:"action-area",children:m.jsx("button",{className:"btn-resist",onClick:()=>a("/dashboard"),children:"RETOMAR CONSCINCIA"})})]})]})}const A2={async login(a,e){const{data:t,error:n}=await Lt.auth.signInWithPassword({email:a,password:e});if(n)throw n;return t},async logout(){const{error:a}=await Lt.auth.signOut();if(a)throw a},async register(a,e,t){const{data:n,error:i}=await Lt.auth.signUp({email:a,password:e,options:{data:{display_name:t,role:"infectado"}}});if(i)throw i;return n},async updateUserMode(a,e){const t=await Lt.from("profiles").update({role:e}).eq("id",a);if(t.error)throw t.error;const n=await Lt.auth.updateUser({data:{role:e}});if(n.error)throw n.error;return n.data}},f2="Assimilao RPG Manager",pW="Alfa 1.0",TE="Expecto Node.js",zE="Sistema de Gesto de Campanhas",LE="desenvolvimento",bW="/Assimilacao-RPG-Manager/assets/LogoAssimilacao-CUkfiYtP.png";function kE(){const a=Ng(),[e,t]=J.useState(!1),[n,i]=J.useState(""),[s,o]=J.useState(""),[l,c]=J.useState(!1),[u,h]=J.useState(!1),[A,f]=J.useState(!1),[p,y]=J.useState(!1),[G,B]=J.useState(""),[S,N]=J.useState(""),[R,w]=J.useState(""),[V,H]=J.useState(""),X=async E=>{if(E.preventDefault(),!n||!s){alert("Preencha email e senha");return}t(!0);try{await A2.login(n,s),a("/dashboard")}catch(O){console.error("ERRO CRTICO NO LOGIN:",O),alert("Erro ao entrar: "+(O.message||"Erro desconhecido"))}finally{t(!1)}},Y=async E=>{if(E.preventDefault(),R!==V){alert("As senhas no coincidem. Por favor, verifique.");return}t(!0),setTimeout(()=>{t(!1),f(!1),y(!0)},800)},M=E=>{E.preventDefault(),t(!0),setTimeout(()=>{t(!1),h(!1),y(!0)},800)};return m.jsxs("div",{className:"auth-page",style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh"},children:[e&&m.jsxs("div",{className:"loading-overlay",children:[m.jsx("div",{className:"loading-spinner"}),m.jsx("p",{children:"Processando..."})]}),m.jsxs("div",{className:"auth-container",style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[m.jsxs("div",{className:"auth-box",children:[m.jsxs("div",{className:"auth-header",children:[m.jsx("img",{src:bW,alt:"Logo",className:"auth-logo"}),m.jsx("h1",{className:"auth-title",children:f2}),m.jsx("p",{className:"auth-subtitle",children:zE}),m.jsx("p",{className:"auth-mode",children:LE})]}),m.jsxs("form",{className:"auth-form",onSubmit:X,children:[m.jsxs("div",{className:"auth-form-group",children:[m.jsx("label",{className:"auth-label",children:"Email:"}),m.jsx("input",{type:"email",className:"auth-input",placeholder:"Digite seu email",required:!0,value:n,onChange:E=>i(E.target.value)})]}),m.jsxs("div",{className:"auth-form-group",children:[m.jsx("label",{className:"auth-label",children:"Senha:"}),m.jsxs("div",{className:"password-input-container",children:[m.jsx("input",{type:l?"text":"password",className:"auth-input",placeholder:"Digite sua senha",required:!0,value:s,onChange:E=>o(E.target.value)}),m.jsx("button",{type:"button",className:"toggle-password-btn",onClick:()=>c(!l),children:l?"Ocultar":"Mostrar"})]}),m.jsx("button",{type:"button",className:"link-btn",onClick:()=>h(!0),children:"Esqueci minha senha."})]}),m.jsx("button",{type:"submit",className:"auth-button",disabled:e,children:e?"Entrando...":"Entrar"}),m.jsxs("div",{className:"auth-register-link",children:[m.jsx("span",{children:"No tem uma conta? "}),m.jsx("button",{type:"button",className:"link-btn",onClick:()=>f(!0),children:"Cadastre-se aqui."})]})]}),m.jsxs("div",{className:"auth-footer",children:[m.jsxs("span",{children:[" ",new Date().getFullYear()," - ",TE]}),m.jsxs("span",{children:["Verso ",pW]})]})]}),m.jsxs("div",{style:{marginTop:"2rem",maxWidth:"500px",textAlign:"center",color:"#6b7280",fontSize:"0.75rem",lineHeight:"1.4",borderTop:"1px solid #374151",paddingTop:"1rem"},children:[m.jsx("p",{style:{fontWeight:"bold",textTransform:"uppercase",marginBottom:"0.5rem",color:"#ef4444"},children:"Aviso Legal / Disclaimer"}),m.jsxs("p",{children:["Este  um projeto ",m.jsx("strong",{children:"no oficial (Fan-Made)"}),", sem fins lucrativos, desenvolvido para fins de estudo e apoio  comunidade."]}),m.jsx("p",{style:{marginTop:"0.5rem"},children:'"Assimilao RPG", seus logotipos e terminologias so propriedade intelectual de seus criadores.'})]})]}),A&&m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box",children:[m.jsx("h2",{className:"modal-title",children:"Cadastro de Usurio"}),m.jsxs("form",{onSubmit:Y,children:[m.jsx("input",{type:"text",placeholder:"Username",required:!0,value:G,onChange:E=>B(E.target.value)}),m.jsx("input",{type:"email",placeholder:"Email",required:!0,value:S,onChange:E=>N(E.target.value)}),m.jsx("input",{type:"password",placeholder:"Senha",required:!0,value:R,onChange:E=>w(E.target.value)}),m.jsx("input",{type:"password",placeholder:"Confirme sua senha",required:!0,value:V,onChange:E=>H(E.target.value),style:{marginTop:"10px",borderColor:V&&R!==V?"red":""}}),m.jsxs("div",{className:"modal-password-buttons",children:[m.jsx("button",{type:"submit",className:"auth-button",children:"Cadastrar"}),m.jsx("button",{type:"button",className:"modal-cancel-btn",onClick:()=>f(!1),children:"Cancelar"})]})]})]})}),u&&m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box",children:[m.jsx("h2",{className:"modal-title",children:"Recuperar Senha"}),m.jsxs("form",{onSubmit:M,children:[m.jsx("input",{type:"email",placeholder:"Digite seu email",required:!0}),m.jsxs("div",{className:"modal-password-buttons",children:[m.jsx("button",{type:"submit",className:"auth-button",children:"Enviar link"}),m.jsx("button",{type:"button",className:"modal-cancel-btn",onClick:()=>h(!1),children:"Cancelar"})]})]})]})}),p&&m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box",style:{border:"1px solid #eab308"},children:[m.jsx("h2",{className:"modal-title",style:{color:"#eab308"},children:"Funcionalidade Indisponvel"}),m.jsxs("p",{style:{marginTop:"1rem",color:"#d1d5db"},children:["Obrigado pelo interesse!",m.jsx("br",{}),m.jsx("br",{}),"No momento, o ",m.jsx("strong",{children:"registro de novos usurios"})," e a ",m.jsx("strong",{children:"recuperao de conta"})," esto desabilitados, pois estamos em fase de testes fechados (Prottipo Alpha)."]}),m.jsx("p",{style:{marginTop:"1rem",fontSize:"0.9rem",color:"#9ca3af"},children:"Se voc faz parte da equipe oficial do Assimilao, utilize as credenciais de teste fornecidas."}),m.jsx("button",{type:"button",className:"auth-button",style:{marginTop:"1.5rem",backgroundColor:"#374151"},onClick:()=>y(!1),children:"Entendi"})]})})]})}const yW=J.createContext(void 0);function UE({children:a}){const[e,t]=J.useState(null),[n,i]=J.useState(null),[s,o]=J.useState("infectado"),[l,c]=J.useState(!0),u=f=>{if(!f)return;const p=f.user_metadata;p&&(i(p.display_name||"Username"),o(p.role||"infectado"))};J.useEffect(()=>{Lt.auth.getSession().then(({data:{session:p}})=>{p?.user&&(t(p.user),u(p.user)),c(!1)});const{data:{subscription:f}}=Lt.auth.onAuthStateChange(async(p,y)=>{y?.user?(t(y.user),u(y.user)):(t(null),c(!1))});return()=>f.unsubscribe()},[]);const h=async()=>{if(!e)return;const f=s==="assimilador"?"infectado":"assimilador";o(f);try{await A2.updateUserMode(e.id,f),await Lt.auth.refreshSession()}catch(p){console.error("Erro ao salvar modo:",p),o(s)}},A=async()=>{try{await A2.logout()}catch(f){console.error(f)}};return m.jsx(yW.Provider,{value:{user:e,username:n,role:s,isLoading:l,toggleRole:h,signOut:A},children:a})}function vW(){const a=J.useContext(yW);if(a===void 0)throw new Error("useAuth deve ser usado dentro de um AuthProvider");return a}function DE({mode:a,onToggleMode:e}){const{signOut:t}=vW(),n=Ng(),[i,s]=J.useState(!1),o=async()=>{try{await t(),n("/login")}catch(u){console.error("Erro ao deslogar:",u)}},l=()=>{e(),n("/dashboard"),s(!1)},c=()=>{s(!1)};return m.jsxs(m.Fragment,{children:[m.jsxs("header",{className:"mobile-navbar",children:[m.jsx("button",{className:"mobile-toggle-btn",onClick:()=>s(!i),"aria-label":"Abrir Menu",children:""}),m.jsx("div",{className:"mobile-brand",children:m.jsx("span",{className:"brand-text",children:f2})})]}),m.jsx("div",{className:`sidebar-overlay ${i?"visible":""}`,onClick:()=>s(!1)}),m.jsxs("aside",{className:`sidebar ${i?"mobile-open":""}`,children:[m.jsxs("div",{className:"sidebar-header",children:[m.jsx("img",{src:bW,alt:"Logo",className:"sidebar-logo"}),m.jsx("h2",{children:f2})]}),m.jsxs("nav",{className:"sidebar-nav",children:[m.jsx(bc,{to:"/dashboard",end:!0,className:({isActive:u})=>u?"nav-btn active":"nav-btn",onClick:c,children:"Dashboard"}),m.jsx("div",{className:"divider"}),a==="assimilador"?m.jsxs(m.Fragment,{children:[m.jsx(bc,{to:"/dashboard/campaigns",className:({isActive:u})=>u?"nav-btn active":"nav-btn",children:"Gesto de Campanhas"}),m.jsx(bc,{to:"/dashboard/gestao-de-itens",className:({isActive:u})=>u?"nav-btn active":"nav-btn",children:"Depsitos de Itens"}),m.jsx(bc,{to:"/dashboard/gestao-de-mundo",className:({isActive:u})=>u?"nav-btn active":"nav-btn",children:"Manipulao de Mundos"}),m.jsx(bc,{to:"/dashboard/gestao-de-ameacas",className:({isActive:u})=>u?"nav-btn active":"nav-btn",children:"Criador de conflitos"})]}):m.jsxs(m.Fragment,{children:[m.jsx(bc,{to:"/dashboard/infectados",className:({isActive:u})=>u?"nav-btn active":"nav-btn",onClick:c,children:"Personagens"}),m.jsx(bc,{to:"/dashboard/campaignsview",className:({isActive:u})=>u?"nav-btn active":"nav-btn",children:"Ver Campanhas"})]})]}),m.jsxs("div",{className:"sidebar-footer",children:[m.jsxs("div",{className:`dt-switch-housing mode-${a}`,onClick:l,title:"Alternar Perspectiva (Salva no Banco)",children:[m.jsx("span",{className:"dt-label label-assimilador",children:"ASSIMILADOR"}),m.jsx("span",{className:"dt-label label-infectado",children:"INFECTADO"}),m.jsx("div",{className:"dt-switch-lever",children:m.jsx("div",{className:"dt-lever-led"})})]}),m.jsxs("div",{className:"footer-info",children:[m.jsxs("p",{className:"sidebar-version",children:["v ",pW]}),m.jsx("button",{onClick:o,className:"logout-btn",children:"Sair do Sistema"})]})]})]})]})}function OE(){const{role:a,toggleRole:e,username:t,isLoading:n,user:i}=vW();return n?m.jsxs("div",{className:"loading-overlay",children:[m.jsx("div",{className:"loading-spinner"}),m.jsx("p",{children:"Sincronizando dados da conta..."})]}):i?m.jsxs("div",{className:`dashboard-container theme-${a}`,children:[m.jsx(DE,{mode:a,onToggleMode:e}),m.jsxs("main",{className:"content-area",children:[m.jsx("header",{className:"dashboard-header",children:m.jsxs("h1",{className:"user-role",children:["Bem-vindo, ",m.jsxs("span",{className:"highlight",children:[t||"Viajante","!"]})]})}),m.jsx(vX,{})]})]}):m.jsx(a2,{to:"/login",replace:!0})}const qi={async listMyCharacters(){const{data:a,error:e}=await Lt.from("characters").select("*").order("created_at",{ascending:!1});if(e)throw e;return a},async getCharacterById(a){const{data:e,error:t}=await Lt.from("characters").select("*").eq("id",a).single();return t?null:e},async deleteCharacter(a){const{error:e}=await Lt.from("characters").delete().eq("id",a);if(e)throw e},async uploadAvatar(a,e){if(a.size>2*1024*1024)throw new Error("A imagem deve ter no mximo 2MB.");const t=a.name.split(".").pop(),i=`${`${e}-${Date.now()}.${t}`}`,{error:s}=await Lt.storage.from("character-avatars").upload(i,a);if(s)throw s;const{data:o}=Lt.storage.from("character-avatars").getPublicUrl(i);return o.publicUrl},async createCharacter(a){const{data:e,error:t}=await Lt.from("characters").insert([a]).select().single();if(t)throw t;return e},async updateCharacter(a,e){const{data:t,error:n}=await Lt.from("characters").update(e).eq("id",a).select().single();if(n)throw n;return t},async getCharacteristicsByIds(a){if(!a||a.length===0)return[];const{data:e,error:t}=await Lt.from("characteristics").select("*").in("id",a);if(t)throw t;return e},async getAllCharacteristics(){const{data:a,error:e}=await Lt.from("characteristics").select("*").order("name",{ascending:!0});if(e)throw e;return a},async populateInventoryFromKit(a,e){const{data:t,error:n}=await Lt.from("starting_kits").select("items_list").eq("name",e).single();if(n||!t){console.error("Erro ao buscar kit:",n);return}const i=t.items_list.map(c=>({character_id:a,item_id:c.id,quantity:c.qty,location:"BACKPACK",is_dropped:!1,is_visible:!0})),s={character_id:a,item_id:"I00034",quantity:1,location:"EQUIPPED",is_dropped:!1,is_visible:!0},o=[...i,s],{error:l}=await Lt.from("character_inventory").insert(o);if(l)throw console.error("Erro ao inserir itens:",l),new Error("Falha ao entregar os itens iniciais.")},async getCharacterInventory(a){const{data:e,error:t}=await Lt.from("character_inventory").select(`
        *,
        items (
          id,
          name,
          description,
          category,
          slots,
          traits
        )
      `).eq("character_id",a).order("created_at",{ascending:!0});if(t)throw t;return e.map(n=>({inventory_id:n.id,character_id:n.character_id,location:n.location,quantity:n.quantity,notes:n.notes,is_dropped:n.is_dropped,is_visible:n.is_visible,item_id:n.items.id,name:n.items.name,description:n.items.description,category:n.items.category,slots:n.items.slots||1,traits:n.items.traits||{}}))},async updateGenericInventory(a,e){const{error:t}=await Lt.from("character_inventory").update(e).eq("id",a);if(t)throw t},async updateItemLocation(a,e){const{error:t}=await Lt.from("character_inventory").update({location:e}).eq("id",a);if(t)throw t},async transferItem(a,e,t){const{data:n,error:i}=await Lt.from("character_inventory").select("*").eq("id",a).single();if(i||!n)throw new Error("Item de origem no encontrado.");if(n.quantity<e)throw new Error("Quantidade insuficiente.");const{data:s}=await Lt.from("character_inventory").select("*").eq("character_id",n.character_id).eq("item_id",n.item_id).eq("location",t).eq("is_dropped",!1).maybeSingle();if(s){const o=s.quantity+e,{error:l}=await Lt.from("character_inventory").update({quantity:o}).eq("id",s.id);if(l)throw l;n.quantity===e?await Lt.from("character_inventory").delete().eq("id",a):await Lt.from("character_inventory").update({quantity:n.quantity-e}).eq("id",a)}else if(n.quantity===e){const{error:o}=await Lt.from("character_inventory").update({location:t}).eq("id",a);if(o)throw o}else{await Lt.from("character_inventory").update({quantity:n.quantity-e}).eq("id",a);const o={character_id:n.character_id,item_id:n.item_id,quantity:e,location:t,is_dropped:!1,is_visible:!0,notes:n.notes},{error:l}=await Lt.from("character_inventory").insert([o]);if(l)throw l}}};function jE(){const a=Ng(),[e,t]=J.useState(null),[n,i]=J.useState(!0);return J.useEffect(()=>{async function s(){try{const o=await qi.listMyCharacters();o&&o.length>0&&t(o[0])}catch(o){console.error("Falha ao carregar viso geral",o)}finally{i(!1)}}s()},[]),n?m.jsx("div",{className:"overview-loading",children:"Sintonizando..."}):m.jsxs("div",{className:"overview-container",children:[m.jsxs("div",{className:"overview-header",children:[m.jsx("h2",{className:"overview-title",children:"Resumo da Jornada"}),m.jsx("p",{className:"overview-subtitle",children:"O mundo mudou. Adapte-se ou seja assimilado."})]}),m.jsxs("div",{className:"overview-grid",children:[m.jsxs("div",{className:"overview-card survivor-card",children:[m.jsxs("div",{className:"card-header-row",children:[m.jsx("span",{className:"card-label",children:"ltimo Infectado"}),e&&m.jsx("span",{className:`status-tag ${e.status==="Morto"?"dead":"alive"}`,children:e.status})]}),e?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"char-highlight",children:[m.jsx("div",{className:"char-avatar-frame",children:e.avatar_url?m.jsx("img",{src:e.avatar_url,alt:e.name}):m.jsx("div",{className:"avatar-placeholder",children:e.name.charAt(0)})}),m.jsxs("div",{className:"char-details",children:[m.jsx("h3",{children:e.name}),m.jsx("p",{className:"char-occupation",children:e.background?.occupation||"Sem Ocupao"}),m.jsx("p",{className:"char-gen",children:e.generation})]})]}),m.jsxs("div",{className:"vitals-grid",children:[m.jsxs("div",{className:"vital-box health",children:[m.jsx("span",{className:"vital-label",children:"Sade"}),m.jsxs("span",{className:"vital-value",children:[e.vitals.health.current," ",m.jsxs("span",{className:"vital-max",children:["/ ",e.vitals.health.max]})]})]}),m.jsxs("div",{className:"vital-box det",children:[m.jsx("span",{className:"vital-label",children:"Determinao"}),m.jsxs("span",{className:"vital-value",children:[e.vitals.determination.current," ",m.jsxs("span",{className:"vital-max",children:["/ ",e.vitals.determination.max]})]})]}),m.jsxs("div",{className:"vital-box ass",children:[m.jsx("span",{className:"vital-label",children:"Assimilao"}),m.jsxs("span",{className:"vital-value",children:[e.vitals.assimilation.current," ",m.jsxs("span",{className:"vital-max",children:["/ ",e.vitals.assimilation.max]})]})]})]}),m.jsx("div",{className:"card-actions",children:m.jsx("button",{className:"btn-primary-action",onClick:()=>a(`/dashboard/ficha-interativa/${e.id}`),children:"Abrir Ficha"})})]}):m.jsxs("div",{className:"empty-survivor",children:[m.jsx("p",{children:"Nenhum registro encontrado nos escombros."}),m.jsx("button",{className:"btn-create-action",onClick:()=>a("/dashboard/criador-de-infectado"),children:"Criar Personagem"})]})]}),m.jsxs("div",{className:"overview-card campaign-card",children:[m.jsx("div",{className:"card-header-row",children:m.jsx("span",{className:"card-label",children:"ltima Campanha"})}),m.jsxs("div",{className:"campaign-placeholder",children:[m.jsx("h3",{children:"Nenhuma Campanha Vinculada"}),m.jsx("p",{children:"Voc no est participando de nenhuma mesa ativa no momento."}),m.jsx("button",{className:"btn-secondary-action",onClick:()=>a("/dashboard/campaignsview"),children:"Procurar Mesas"})]})]}),m.jsxs("div",{className:"overview-card shortcuts-card",children:[m.jsx("div",{className:"card-header-row",children:m.jsx("span",{className:"card-label",children:"Acesso Rpido"})}),m.jsxs("div",{className:"shortcuts-list",children:[m.jsxs("button",{className:"shortcut-item",onClick:()=>a("/dashboard/criador-de-infectado"),children:[m.jsx("span",{className:"sc-icon",children:"+"})," Novo Personagem"]}),m.jsxs("button",{className:"shortcut-item",onClick:()=>a("/dashboard/infectados"),children:[m.jsx("span",{className:"sc-icon",children:""})," Meus Personagens"]}),m.jsxs("button",{className:"shortcut-item",disabled:!0,style:{opacity:.5,cursor:"not-allowed"},children:[m.jsx("span",{className:"sc-icon",children:"?"})," Ver campanhas (Em Breve)"]})]})]})]})]})}const wG=5,Bw=15;function JE(){const a=Ng(),[e,t]=J.useState([]),[n,i]=J.useState(!0),[s,o]=J.useState(!1),[l,c]=J.useState(null),[u,h]=J.useState(""),[A,f]=J.useState(!1);J.useEffect(()=>{p()},[]);const p=async()=>{try{const V=await qi.listMyCharacters();t(V)}catch(V){console.error("Erro ao carregar personagens:",V)}finally{i(!1)}},y=e.filter(V=>V.status!=="Em Criao"),G=e.filter(V=>V.status==="Em Criao"),B=()=>{if(G.length>=wG){alert(`Limite de ${wG} rascunhos atingido.`);return}if(y.length>=Bw){alert("Limite de personagens ativos atingido.");return}a("/dashboard/criador-de-infectado")},S=V=>{c(V),h(""),o(!0)},N=()=>{o(!1),c(null),h("")},R=async()=>{if(l&&u===l.name){f(!0);try{await qi.deleteCharacter(l.id),t(V=>V.filter(H=>H.id!==l.id)),N()}catch(V){console.error("Erro ao deletar:",V),alert("No foi possvel excluir o personagem.")}finally{f(!1)}}},w=({char:V,isDraft:H})=>{const X=V.vitals?.determination?.current??1,Y=V.vitals?.assimilation?.current??0,M=V.name?V.name.charAt(0).toUpperCase():"?";return m.jsxs("div",{className:`char-card ${H?"card-draft":""}`,children:[m.jsxs("div",{className:"card-header",children:[m.jsxs("div",{className:"header-stats-stack",children:[m.jsxs("span",{className:"stat-item",title:"Determinao",children:["DET ",X]}),m.jsxs("span",{className:"stat-item",title:"Assimilao",children:["ASS ",Y]})]}),m.jsx("div",{className:"header-name",children:V.name}),m.jsx("div",{className:"header-status",children:m.jsxs("p",{style:{fontSize:"0.75rem"},children:[m.jsx("span",{style:{color:V.status==="Saudvel"||V.status==="Escoriado"?"#5f5":V.status==="Lacerado"||V.status==="Ferido"?"#fa0":V.status==="Debilitado"||V.status==="Incapacitado"?"rgba(121, 24, 24, 1)":V.status==="Morto"?"#555":(V.status==="Em Criao","#88aacc"),fontSize:"1.2rem",lineHeight:0},title:V.status,children:" "}),V.status]})})]}),m.jsx("div",{className:"card-body",children:m.jsx("div",{className:"char-avatar-placeholder",children:V.avatar_url?m.jsx("img",{src:V.avatar_url,alt:V.name,style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"}}):M})}),m.jsxs("div",{className:"card-footer",children:[m.jsx("button",{className:"btn-trash",onClick:()=>S(V),title:"Excluir",children:m.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[m.jsx("polyline",{points:"3 6 5 6 21 6"}),m.jsx("path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"})]})}),H?m.jsx(bc,{to:`/dashboard/criador-de-infectado/${V.id}`,className:"btn-card-action btn-continue",style:{textDecoration:"none",display:"flex",justifyContent:"center",alignItems:"center"},children:"CONTINUAR"}):m.jsx(bc,{to:`/dashboard/ficha-interativa/${V.id}`,className:"btn-card-action btn-play",style:{textDecoration:"none",display:"flex",justifyContent:"center",alignItems:"center"},children:"ABRIR"})]})]})};return n?m.jsx("div",{className:"chars-page-container",style:{display:"flex",justifyContent:"center",paddingTop:"50px"},children:m.jsx("p",{style:{color:"#666"},children:"Carregando registros..."})}):m.jsxs("div",{className:"chars-page-container",children:[m.jsxs("header",{className:"chars-header",children:[m.jsxs("div",{className:"chars-header-text",children:[m.jsx("h1",{className:"chars-title",children:"Meus Personagens"}),m.jsx("p",{className:"chars-subtitle",children:"Gerencie suas fichas e rascunhos"})]}),m.jsxs("button",{className:"btn-new-char",onClick:B,children:[m.jsx("span",{style:{fontSize:"1.5rem",lineHeight:0,marginRight:"8px",marginBottom:"2px"},children:"+"}),"NOVO"]})]}),G.length>0&&m.jsxs("section",{className:"drafts-section",children:[m.jsxs("div",{className:"drafts-header-row",children:[m.jsxs("h2",{className:"section-label",children:["EM CRIAO (",G.length,"/",wG,")"]}),m.jsx("div",{className:"divider-line"})]}),m.jsx("div",{className:"chars-grid",children:G.map(V=>m.jsx(w,{char:V,isDraft:!0},V.id))})]}),m.jsxs("div",{className:"active-section-divider",children:[m.jsxs("div",{className:"text-group",children:[m.jsx("h2",{className:"section-label",children:"ATIVOS"}),m.jsxs("p",{className:"chars-subtitle-small",children:[y.length," / ",Bw]})]}),m.jsx("div",{className:"divider-line"})]}),y.length===0?m.jsx("div",{className:"empty-state",children:G.length===0&&m.jsxs(m.Fragment,{children:[m.jsx("h2",{children:"Nenhum registro encontrado."}),m.jsx("p",{children:"O sistema no detectou assinaturas vitais."})]})}):m.jsx("div",{className:"chars-grid",children:y.map(V=>m.jsx(w,{char:V},V.id))}),s&&l&&m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box delete-modal",children:[m.jsx("h3",{className:"delete-title",children:"EXCLUIR REGISTRO"}),m.jsxs("p",{className:"delete-warn",children:["Esta ao  permanente e ",m.jsx("strong",{children:"no pode ser desfeita"}),". Todos os dados, itens e histrico sero apagados."]}),m.jsxs("p",{className:"delete-instruction",children:["Para confirmar, digite ",m.jsxs("span",{className:"highlight-delete",children:['"',l.name,'"']})," abaixo:"]}),m.jsx("input",{type:"text",className:"delete-input",placeholder:"Nome do personagem",value:u,onChange:V=>h(V.target.value),autoFocus:!0}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-cancel",onClick:N,disabled:A,children:"Cancelar"}),m.jsx("button",{className:"btn-confirm-delete",onClick:R,disabled:u!==l.name||A,children:A?"Apagando...":"EXCLUIR"})]})]})})]})}const _a={generation:{title:"Gerao",text1:"Determina a poca em que um(a) Infectado(a) nasceu em relao ao Colapso. Infectados da Gerao Pr-Colapso nasceram e foram criados antes do evento; a Gerao-Colapso passou pelo Colapso entre os 5 e 12 anos; j a Gerao Ps-Colapso nasceu depois ou tinha menos de 5 anos durante o evento."},occupation:{title:"Ocupao",text1:"Refere-se a sua funo, o empenho dirio em sua vida. Ajuda a delinear melhor suas rotinas e sua posio perante o grupo de Infectados e as comunidades que o conhecem.",table:{headers:["Exemplos:"],rows:[["Negociador(a) pilantra"],["Clinico(a) geral"],["Fazendeiro(a) bairrista"],["Aristocrata decadente"],["Mercenario(a) por necessidade"]]}},defining_event:{title:"Evento Marcante",text1:"Refere-se a um evento do passado que moldou a forma como o(a) Infectado(a) v o mundo. Pode se referir a uma tragdia pessoal, um momento de superao ou um fato isolado que o impactou.",table:{headers:["Exemplos:"],rows:[["Sobrevivente da queda de So Leopoldo"],["Abandonado(a) por seus companheiros"],["Lder destronado(a) pelo irmo"],["Caado(a) pelos motoqueiros do Pico Verde"],["Viveu escondido(a) entre o lixo"]]}},purposes:{title:"Propsitos",text1:"Metas de uma personagem Infectada que, ao concludas, geram um momento de Clareza de Propsito."},characteristics:{title:"Caractersticas",text1:"Traos nicos que definem detalhes e particularidades do personagem. Elas permitem personalizar o(a) Infectado(a) alm dos nmeros da Ficha, destacando talentos, comportamentos, adaptaes e conexes com o mundo ao seu redor."},starting_kit:{title:"Kits Iniciais",text1:"Define as posses iniciais do seu Infectado, ou seja, seus equipamentos iniciais para comear suas aventuras."},instincts:{title:"Instintos",text1:"Os Instintos representam as caractersticas inerentes dos seres vivos, seja atravs de fora muscular, raciocnio, ou at mesmo os 5 sentidos. Estes so os atributos que regem o mundo animal.",text2:"Animais possuem mais pontos nessas Aptides e tendem a us-las de maneira mais natural. O parasita dentro de todos os Infectados no tem Prticas ou Conhecimentos, mas  muito mais conectado aos seus Instintos que o homem moderno.",table:{headers:["Valor","Pessoa"],rows:[["1","ENFRAQUECIDA"],["2","NORMAL"],["3","DE DESTAQUE"],["4","EXTRAORDINRIA"],["5","NO PICE"]]}},influencia:{title:"Influncia",text1:"A capacidade dos Infectados de influenciar outras pessoas. Seu magnetismo pessoal, carisma, habilidade com palavras e liderana.",text2:"Inclui a capacidade de intimidar ameaas e sua credibilidade. Pode ser testada em aes ou percepes de terceiros que envolvam aparncia, olhares, cheiros, palavras, gestos e afins.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["1","TMIDA","Tem dificuldades sociais"],["2","EQUILIBRADA","No se destaca"],["3","PERSUASIVA"," cativante e convincente"],["4","MAGNTICA"," a estrela da festa em todas as festas"],["5","LDER","Capaz de inspirar e encantar ou de intimidar e dominar"]]},text3:"Influncia deve ser a base de qualquer teste que envolva relaes pessoais, convencimento, manipulao e para imprimir sentimentos em outros. Testes que influenciem comportamento de terceiros em geral so norteados por este Instinto.",text4:"Passivamente, a Influncia interfere na forma como as pessoas os percebem. Despertar respeitabilidade, confiabilidade, segurana, atrao, boa vontade, interesse ou at medo so consequncias naturais dos Infectados com muitos pontos em Influncia."},percepcao:{title:"Percepo",text1:"Rege a capacidade sensorial dos Infectados, incluindo sentidos e ateno.",text2:"Usado em testes para perceber nuances, notar detalhes, enxergar longas distncias, identificar odores e at mesmo pontaria.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["1","DISTRADA","No percebe detalhes bvios, constantemente area"],["2","ATENTA","Percebe o que est ao seu redor, mas sem acuidade"],["3","PERSPICAZ","Nota detalhes sutis e padres com facilidade"],["4","AGUADA","Sentidos apurados, como os de um predador em alerta"],["5","VIGILANTE","Percebe tudo ao seu redor como um radar vivo"]]},text3:"Percepo  a base para os testes de deteco em sentido amplo. Envolve perceber segundas intenes se rolado com Expresso, notar uma dificuldade sutil no caminhar de outra personagem em cena se rolado com Atletismo ou at mesmo para perceber condies meteorolgicas com Geografia. Pode ser provocado pelo(a) Assimilador(a) sem explicar a razo ou mesmo ser rolado em segredo por este.",text4:""},potencia:{title:"Potncia",text1:"Capacidade de exercer fora fsica e resistir a presses externas.",text2:"Mede seu poder fsico, incluindo a capacidade de realizar movimentos rpidos e potentes.  o atributo que define tanto a fora bruta quanto a capacidade de trao e exploso, combinando potncia muscular e agilidade dinmica.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["1","FRACA","Dificuldade em realizar esforos fsicos"],["2","FUNCIONAL","Consegue lidar com atividades fsicas comuns"],["3","FORTE","Capaz de feitos fsicos respeitveis"],["4","PODEROSA","Mostra primor em fora bruta e exploso muscular, capaz de superar obstculos fsicos extremos"],["5","TITNICA","Fora poucas vezes vista na raa humana, capaz de realizar proezas fsicas extraordinrias"]]},text3:"Todo teste que envolva intensidade fsica deve ser parametrizado por Potncia, mas existem casos em que seria exigido teste em conjunto com Conhecimentos, uma vez que podem ter efeito prtico (como medicina, para serrar um osso).",text4:"Potncia no significa necessariamente um aumento de massa corporal, mas sim a capacidade de exercer fora ou a exploso muscular propriamente dita, no interferindo diretamente na estatura ou peso dos Infectados, mas sim em suas capacidades, podendo ter um impacto fsico muito notvel ou sutil, acompanhando o conceito da personagem."},reacao:{title:"Reao",text1:"Instinto bsico que mede a velocidade e preciso das reaes dos Infectados.",text2:"Geralmente  posto  prova em situaes em que a personagem precise agir rapidamente e no tenha se preparado.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["1","LENTA","Reflexos lentos e descoordenados"],["2","ESPERTA","Reage dentro do esperado para situaes comuns"],["3","GIL","Reage com velocidade acima da mdia"],["4","VELOZ","Reflexos quase instantneos, como um felino"],["5","RELMPAGO","Reage antes mesmo de perceber o perigo, como um sexto sentido"]]},text3:"Reao ser o Instinto eleito para a rolagem sempre que no houver tempo para pensar sobre a ao, caso o(a) Infectado(a) tenha sido surpreendido(a) e precise reagir rapidamente ou caso esteja realizando atividade naturalmente reflexiva como desviar de pedras caindo do telhado ou ao similar.",text4:"Geralmente na primeira rodada de um Conflito, a Reao ser o Instinto mais indicado, assim como para qualquer ao naturalmente reativa em relao a aes de terceiros."},resolucao:{title:"Resoluo",text1:"Resistncia fsica, resilincia mental e empenho.",text2:"Representa a capacidade dos Infectados de resistir  presso psicolgica e suas resistncias fsicas e fisiolgicas.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["1","VACILANTE","Desiste facilmente diante de desafios"],["2","ESTVEL","Mantm a calma em situaes comuns"],["3","DETERMINADA","Resiste a presses e persiste em seus objetivos"],["4","INQUEBRVEL","Quase imune a presses psicolgicas e fsicas"],["5","INDOMVEL","Fora de vontade inabalvel, capaz de superar qualquer obstculo"]]},text3:"Resoluo  o Instinto de resistncia. Usado para resistir  Intimidao, para evitar queda de Determinao aps sofrer uma grande perda, para resistir aos prprios impulsos, para resistir a ferimentos, envenenamento ou hemorragia, ou at mesmo para realizar uma ao quando est sob efeito de alguma condio que a afete. Caso tente atacar algum que ama, ainda que seja por autodefesa, precisaria testar esse ataque com Resoluo.",text4:"Um(a) Infectado(a) testaria Resoluo com Armas para atacar com uma faca em local sob efeito de um incndio, pois a fumaa dificultaria a viso e a respirao, portanto quem lutar melhor ser aquele que conseguir ser mais resoluto."},sagacidade:{title:"Sagacidade",text1:"Facilidade para entender e interpretar informaes, explicaes ou situaes, deduzir ou concluir resultados; agudeza de esprito; perspiccia, argcia, astcia.",text2:"A Sagacidade  testada para chegar a concluses baseadas em seus Conhecimentos ou exercer de forma astuta e inteligente qualquer atividade.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["1","INGNUA","Dificuldade em entender situaes complexas"],["2","RAZOVEL","Compreende o bsico, mas sem grandes sacadas"],["3","ASTUTA","Consegue deduzir e interpretar informaes com facilidade"],["4","BRILHANTE","Mente afiada, capaz de resolver problemas complexos rapidamente"],["5","GNIAL","Inteligncia quase sobrenatural, capaz de prever e manipular situaes com maestria"]]},text3:"Pode ser testado com Engenharia para fazer um projeto ou com Geografia para interpretar um mapa. Porm a Sagacidade no se limita somente a Conhecimentos, pode testar tambm astcia e inteligncia na execuo de outras tarefas, como se esconder com Furtividade, ou confeccionar manufaturas.",text4:"Um(a) Infectado(a) pode testar Medicina com Sagacidade para identificar sintomas visveis de uma fratura em sua perna, porm, para trat-la sem anestesia o teste seria de Medicina com Resoluo, pois sua capacidade de resistir  dor seria mais determinante para o resultado que entendimento ou interpretao."},knowledge:{title:"Conhecimentos",text1:"Os Conhecimentos so adquiridos atravs de longo perodo de investigao e estudo. Conhecimentos tambm podem ser usados em testes ativos para realizar algo, como um teste de Biologia para construir uma pequena fazenda ou Erudio para no violar nenhum costume em interao com um grupo de cultura muito diferente.",textC:"Animais no possuem nveis nessas aptides.",table:{headers:["Nvel","Pessoa"],rows:[["0","LEIGA"],["1","INFORMADA"],["2","CONHECEDORA"],["3","ESTUDIOSA"],["4","MESTRA"],["5","SBIA"]]}},biologia:{title:"Biologia",text1:"O campo do conhecimento que estuda a vida em todas as suas formas e como elas interagem com o meio ambiente.",text2:"Inclui o estudo biolgico do ser humano, a fauna, a flora e outros seres vivos. Alm disso, abrange a qumica orgnica, que investiga a estrutura, propriedades e reaes dos compostos qumicos que formam a base da vida. Essa aptido  voltada para a pesquisa sobre a origem, evoluo, adaptao e o funcionamento dos organismos.",table:{headers:["Valor","Nvel","Descrio"],rows:[["0","LEIGA","No possui conhecimento cientfico ou emprico sobre biologia"],["1","CURIOSA","Conhece o bsico sobre biologia, como anatomia e ciclos de vida"],["2","NATURALISTA","Entende conceitos intermedirios, como ecologia, fisiologia e reaes orgnicas comuns"],["3","BILOGA","Domina conhecimentos avanados, como gentica, microbiologia e sntese de compostos orgnicos"],["4","ESPECIALISTA","Referncia em sua rea, capaz de realizar pesquisas complexas e desenvolver novas tecnologias"],["5","PIONEIRA","Revoluciona o campo com descobertas e teorias inovadoras como Graziela Maciel Barroso"]]},text3:"",text4:""},erudicao:{title:"Erudio",text1:"Histria humana, culturas, artes, cincias polticas, filosofia, sociologia e psicologia so os principais conhecimentos eruditos.",text2:"Alm do conhecimento terico, rege prtica de exerccios de manuteno da sade mental, trabalhos artsticos e facilita a compreenso da cultura e caractersticas de civilizaes presentes e passadas.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","LEIGA","No possui conhecimento sobre culturas ou cincias humanas"],["1","INFORMADA","Conhece teorias bsicas e tem noo artstica"],["2","ESTUDANTE","Conhece histria humana, arte e culturas"],["3","ERUDITA","Domina teorias complexas e debates contemporneos"],["4","MENTORA","Guia outros com sabedoria e conhecimento profundo"],["5","ILUMINADA","Sua compreenso da condio humana  quase transcendental"]]},textE:"A Erudio pode ser testada em apresentao artstica ou sesso de terapia para recuperar pontos de Determinao de aliados. Cada 1 Sucesso, restaura um Ponto de Determinao, mas cada Presso retira um ponto."},engenharia:{title:"Engenharia",text1:"Conhecimentos tcnicos e cientficos sobre Matemtica, Fsica, Qumica Inorgnica e Engenharia.",text2:"Essa aptido abrange a aplicao prtica de princpios matemticos e fsicos para projetar, construir e manter estruturas, mquinas, sistemas e processos. Inclui desde a construo de pontes e edifcios at a criao de tecnologias avanadas e a resoluo de problemas complexos por meio de clculos precisos e mtodo cientfico.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","LEIGA","No dispe de qualquer conhecimento matemtico"],["1","ENTUSIASTA","Conhece princpios bsicos de matemtica e fsica"],["2","TCNICA","Aplica conceitos prticos em projetos simples"],["3","ENGENHEIRA","Domina teorias avanadas e realiza projetos complexos"],["4","INVENTORA","Cria solues inovadoras e revolucionrias"],["5","VISIONRIA","Redefine os limites da engenharia com ideias disruptivas, como Marie Curie e Alan Turing"]]}},geografia:{title:"Geografia",text1:"Investigaes sobre a Terra, seus fenmenos naturais e a interao entre o ambiente e as sociedades humanas.",text2:"Inclui o estudo de mapas, climas, ecossistemas, relevos e recursos naturais. ajudando a entender como as civilizaes se adaptam e transformam o espao geogrfico.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","LEIGA","No tem noo de clima, relevo ou qualquer base de orientao geogrfica"],["1","INEXPERIENTE","Conhece mapas bsicos e sabe localizar os pontos cardeais"],["2","VIAJANTE","Identifica caractersticas gerais de regies e padres climticos"],["3","EXPLORADORA","Domina conhecimentos avanados sobre cartografia e ecossistemas"],["4","GEGRAFA","Referncia em estudos geogrficos e ambientais"],["5","DOUTORA EM GEOGRAFIA","Sua compreenso do planeta, seus relevos, biomas, climas e ciclos  capaz de prever eventos naturais futuros e interpretar mudanas geogrficas antes que elas se manifestem de forma mais notvel"]]}},medicina:{title:"Medicina",text1:"Conhecimento sobre sade humana e suas reas conectadas, inclui tambm a medicina veterinria.",text2:"Alm do conhecimento terico, inclui a prtica de tratamentos relacionados, como diagnstico, cirurgia, prescrio de medicamentos e reabilitao. Essa aptido  essencial para a cura de doenas, a manuteno da sade e a compreenso do funcionamento do corpo humano e animal.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","LEIGA","Desconhece at mesmo prticas simples de manuteno da sade"],["1","QUE SABE PRIMEIROS SOCORROS","Conhece primeiros socorros e noes bsicas de sade"],["2","ESTUDIOSA DE MEDICINA","Realiza diagnsticos simples e tratamentos comuns"],["3","MDICA","Domina tcnicas avanadas e cirurgias complexas"],["4","CIRURGI ou PESQUISADORA","Referncia em sua especialidade, capaz de salvar vidas em situaes crticas e criar solues para endemias"],["5","CIENTISTA DISRUPTIVA","Realiza procedimentos que desafiam o conhecimento convencional,  capaz de desenvolver aes de conteno e tratamento at mesmo de pandemias, como Rosalind Franklin"]]},textE:"A Medicina  a Aptido testada para realizar tratamento mdico, possibilitando a Regenerao de Pontos de Sade e Nveis de Sade."},seguranca:{title:"Segurana",text1:"Conhecimento que engloba medidas de segurana.",text2:"De mecanismos rudimentares at os mais complexos, incluindo avaliao de riscos, manuteno preventiva e proteo contra ameaas. Em um mundo ps-apocalptico, essa Aptido  essencial para garantir a sobrevivncia, proteger recursos e evitar desastres. Inclui a criao de barreiras fsicas, sistemas de alarme, armadilhas e rotinas de segurana para situaes cotidianas ou extremas.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","LEIGA","No tem conhecimento sobre sistemas ou rotinas de segurana"],["1","PRECAVIDA","Conhece noes bsicas de segurana, como trancar portas ou evitar reas perigosas, mas no possui treinamento"],["2","VIGIA","Aplica medidas simples de segurana no dia a dia, como criar barreiras rudimentares ou identificar riscos latentes"],["3","PROTETORA","Domina tcnicas intermedirias, como instalar sistemas de alarme, criar armadilhas e realizar manuteno preventiva bsica"],["4","ESTRATEGISTA","Capaz de tornar fortalezas impenetrveis, sistemas de defesa infalveis e protocolos que garantem a sobrevivncia em qualquer cenrio possvel"],["5","GUARDI","Capaz de tornar fortalezas impenetrveis, sistemas de defesa infalveis e protocolos que garantem a sobrevivncia em qualquer cenrio possvel"]]}},practices:{title:"Prticas",text1:"As Prticas regem as Aptides desenvolvidas e exercitveis por treino e/ou prtica recorrente. Pode estar relacionado ou no com o uso de objetos e outras ferramentas.",table:{headers:["Nvel","Pessoa"],rows:[["0","INBIL"],["1","ENTUSIASTA"],["2","INICIANTE"],["3","PRATICANTE"],["4","PROFISSIONAL"],["5","EXTRAORDINRIA"]]}},armas:{title:"Armas",text1:"Prtica relacionada ao uso eficiente de armas, sejam elas brancas ou de fogo.",text2:"Inclui tcnicas de combate, preciso, manuteno e adaptao a diferentes tipos de armamento.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","INBIL","Nunca segurou uma arma"],["1","AFICIONADA","Sabe segurar uma arma, mas no tem prtica ou preciso"],["2","HABILIDOSA","Treina regularmente, consegue acertar alvos com alguma preciso"],["3","DUELISTA","Utiliza armas com maestria em situaes de combate ou caa"],["4","ARMEIRA","Especialista reconhecida, capaz de treinar guerreiros e improvisar com diferentes armas"],["5","VETERANA","Mestra de armas, com habilidades extraordinrias e preciso infalvel"]]}},atletismo:{title:"Atletismo",text1:"Prtica relacionada ao condicionamento fsico, incluindo corrida, salto, natao e outras atividades que exigem fora, agilidade e resistncia.",text2:" essencial para superar obstculos fsicos e manter o corpo em forma.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","INBIL","No pratica atividades fsicas"],["1","FUNCIONAL","Realiza atividades fsicas ocasionais, sem treino consistente"],["2","PRATICANTE","Treina regularmente, mantendo um bom condicionamento fsico"],["3","ATLETA","Utiliza suas habilidades atlticas para superar desafios"],["4","ATLETA DE ALTA-PERFORMANCE","Referncia de proeza fsica na regio, capaz de treinar outros atletas"],["5","IMBATVEL","Dispe de habilidades fsicas que desafiam os limites humanos"]]}},expressao:{title:"Expresso",text1:"Prtica relacionada  comunicao e  arte, incluindo oratria, escrita, msica, dana e outras formas de expresso criativa.",text2:" usada para influenciar, emocionar e transmitir ideias.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","INBIL","No sabe se expressar adequadamente"],["1","ACANHADA","Consegue passar a mensagem, mas lhe falta clareza e no passa confiana"],["2","COMUNICADORA","Fala bem, tem interaes sociais regulares e consegue transmitir emoes"],["3","PERSUASIVA","Se expressa de forma eficaz e toca coraes com suas palavras e performances"],["4","ENCANTADORA","Dramaturga, negociadora ou oradora com grande reputao"],["5","CONE","Capacidade de comunicao reconhecida, admirada e recontada"]]}},furtividade:{title:"Furtividade",text1:"Prtica relacionada  capacidade de se mover silenciosamente, passar despercebido, esconder objetos e realizar aes sem chamar ateno.",text2:"Inclui tcnicas de camuflagem, infiltrao, evaso e ocultao de itens em locais estratgicos.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","INBIL","Desastrada e nada sutil"],["1","DISCRETA","J se escondeu como brincadeira na infncia"],["2","CUIDADOSA","Entende o bsico de camuflagem"],["3","INFILTRADORA","Tem treinamento em infiltrao e ocultao"],["4","NINJA","Especialista em infiltrao capaz de entrar e sair de quase qualquer lugar sem ser notado"],["5","FANTASMA","Quase indetectvel, a mestra furtiva evita cmeras, olhares e ateno sem deixar qualquer rastro de sua presena no local"]]}},manufaturas:{title:"Manufaturas",text1:"Prtica relacionada  criao, reparo e modificao de objetos, ferramentas e estruturas.",text2:"Inclui habilidades como carpintaria, metalurgia, costura e engenharia prtica.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","INBIL","No possui habilidades manuais"],["1","COORDENADA","Consegue enrolar fumo e fazer pequenos reparos"],["2","PRENDADA","Pode confeccionar e reparar objetos com eventual desperdcio de material"],["3","ARTES","Produz itens teis com qualidade consistente e  econmico com matria-prima"],["4","CONSTRUTORA","O reconhecimento por suas criaes a precede"],["5","INOVADORA","Criadora de obras-primas como Leonardo da Vinci ou Santos Dumont"]]},text3:"",text4:""},sobrevivencia:{title:"Sobrevivncia",text1:"Prtica relacionada  capacidade de sobreviver em ambientes hostis.",text2:"Inclui tcnicas de caa, pesca, construo de abrigos, obteno de gua e fogo, e identificao de perigos naturais.",table:{headers:["Valor","Pessoa","Descrio"],rows:[["0","INBIL","No sabe fazer o bsico"],["1","CAMPISTA","Tem instruo simples e pouca prtica"],["2","ESCOTEIRA","Sabe se virar em ambientes naturais"],["3","PATRULHEIRA","Capaz de guiar um grupo em uma mata fechada"],["4","MATEIRA","Se adapta a qualquer ambiente"],["5","EXPLORADORA","Domina qualquer ambiente como um nativo"]]}}},Xa=({textKey:a,descriptions:e})=>{const[t,n]=J.useState(!1),i=e[a];if(!i)return null;const s=o=>{o.stopPropagation(),n(!t)};return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"info-icon-container",onClick:s,children:m.jsx("span",{className:"info-icon-symbol",children:"i"})}),t&&m.jsx("div",{className:"info-modal-overlay",onClick:()=>n(!1),children:m.jsxs("div",{className:"info-modal-content",onClick:o=>o.stopPropagation(),children:[m.jsxs("div",{className:"info-modal-header",children:[m.jsx("h3",{className:"info-modal-title",children:i.title}),m.jsx("button",{className:"info-modal-close",onClick:()=>n(!1),children:""})]}),m.jsxs("div",{className:"info-modal-body",children:[m.jsx("p",{className:"info-text",children:i.text1}),m.jsx("p",{className:"info-text",children:i.text2}),m.jsx("p",{className:"info-text-cent",children:i.textC}),i.table&&m.jsx("div",{className:"info-table-wrapper",children:m.jsxs("table",{className:"info-table",children:[m.jsx("thead",{children:m.jsx("tr",{children:i.table.headers.map((o,l)=>m.jsx("th",{children:o},l))})}),m.jsx("tbody",{children:i.table.rows.map((o,l)=>m.jsx("tr",{children:o.map((c,u)=>m.jsx("td",{children:c},u))},l))})]})}),i.textE&&m.jsxs("p",{className:"info-text-especial",children:[m.jsx("span",{children:"ESPECIAL: "}),i.textE]}),m.jsx("p",{className:"info-text",children:i.text3}),m.jsx("p",{className:"info-text",children:i.text4})]})]})})]})},Zh={influencia:"Influncia",percepcao:"Percepo",potencia:"Potncia",reacao:"Reao",resolucao:"Resoluo",sagacidade:"Sagacidade",biologia:"Biologia",erudicao:"Erudio",engenharia:"Engenharia",geografia:"Geografia",medicina:"Medicina",seguranca:"Segurana",armas:"Armas",atletismo:"Atletismo",expressao:"Expresso",furtividade:"Furtividade",manufaturas:"Manufaturas",sobrevivencia:"Sobrevivncia"},RG={nome:"",geracao:"Colapso",ocupacao:"",evento:"",descricao:"",p1:"",p2:"",c1:"",c2:"",instintos:{influencia:1,percepcao:1,potencia:1,reacao:1,resolucao:1,sagacidade:1},aptidoes:{biologia:0,erudicao:0,engenharia:0,geografia:0,medicina:0,seguranca:0,armas:0,atletismo:0,expressao:0,furtividade:0,manufaturas:0,sobrevivencia:0},aptidoesBase:{},xpDisponivel:7,kitName:"",caracteristicas:[]};function PE(){const a=Ng(),{id:e}=ON(),t=J.useRef(null),[n,i]=J.useState(1),[s,o]=J.useState(RG),[l,c]=J.useState(!1),[u,h]=J.useState(null),[A,f]=J.useState(!1),[p,y]=J.useState(3),[G,B]=J.useState(7),[S,N]=J.useState([]),[R,w]=J.useState([]),[V,H]=J.useState(null),[X,Y]=J.useState(null),[M,E]=J.useState({isOpen:!1,title:"",message:"",type:"info"});J.useEffect(()=>{setTimeout(()=>{t.current&&t.current.scrollIntoView({behavior:"smooth",block:"start"})},100)},[n]),J.useEffect(()=>{(async()=>{try{const[Ce,we]=await Promise.all([Lt.from("characteristics").select("*").order("cost",{ascending:!0}),Lt.from("starting_kits").select("*")]);if(Ce.error)throw Ce.error;if(we.error)throw we.error;N(Ce.data||[]),w(we.data||[]),e&&(f(!0),await O(e))}catch(Ce){console.error("Erro na inicializao:",Ce)}finally{f(!1)}})()},[e]);const O=async ee=>{const Ce=await qi.getCharacterById(ee);if(!Ce){ae("Erro","Personagem no encontrado.","error"),a("/dashboard/characters");return}const we={nome:Ce.name,geracao:Ce.generation,ocupacao:Ce.background?.occupation||"",evento:Ce.background?.event||"",descricao:Ce.background?.description||"",p1:Ce.background?.purposes?.p1||"",p2:Ce.background?.purposes?.p2||"",c1:Ce.background?.purposes?.c1||"",c2:Ce.background?.purposes?.c2||"",instintos:Ce.instincts||RG.instintos,aptidoes:Ce.aptitudes||RG.aptidoes,aptidoesBase:Ce.base_aptitudes||{},xpDisponivel:Ce.xp_available??7,kitName:Ce.kit_name||"",caracteristicas:Ce.characteristics_ids||[]};o(we),h(Ce.id),Ce.avatar_url&&Y(Ce.avatar_url),P(we.instintos,we.aptidoes)},P=(ee,Ce)=>{let we=0;Object.values(ee).forEach(Ee=>we+=Ee-1),y(3-we);let Ye=0;Object.values(Ce).forEach(Ee=>Ye+=Ee),B(7-Ye)},q=ee=>ee.type==="ou"&&ee.options?ee.options.some(Ce=>q(Ce)):ee.key&&ee.val!==void 0?((ee.type==="instintos"?s.instintos[ee.key]:s.aptidoes[ee.key])||0)>=ee.val:!1,k=ee=>!ee||ee.length===0?!0:(Array.isArray(ee)?ee:[]).every(we=>q(we));J.useEffect(()=>{if(S.length===0)return;const ee=s.caracteristicas.filter(Ce=>{const we=S.find(Ye=>Ye.id===Ce);return we&&!k(we.requirements)});if(ee.length>0){let Ce=0;const we=s.caracteristicas.filter(Ye=>{if(ee.includes(Ye)){const Ee=S.find(pt=>pt.id===Ye);return Ee&&(Ce+=Ee.cost),!1}return!0});o(Ye=>({...Ye,caracteristicas:we,xpDisponivel:Ye.xpDisponivel+Ce}))}},[s.aptidoes,s.instintos,S]);const le=ee=>{if(ee.target.files&&ee.target.files[0]){const Ce=ee.target.files[0];if(Ce.size>2*1024*1024){ae("Erro","Mximo de 2MB.","error");return}H(Ce),Y(URL.createObjectURL(Ce))}},F=(ee,Ce,we)=>{const Ye=ee==="instintos"?p:G,Ee=ee==="instintos"?s.instintos[Ce]:s.aptidoes[Ce],pt=ee==="instintos"?1:0,Ke=ee==="instintos"?3:2;if(we>0&&Ye<=0){ae("Sem Pontos","Sem pontos disponveis.","error");return}if(Ee+we<pt||Ee+we>Ke)return;const Qe={...s};ee==="instintos"?Qe.instintos[Ce]=Ee+we:Qe.aptidoes[Ce]=Ee+we,o(Qe),ee==="instintos"?y(Le=>Le-we):B(Le=>Le-we)},j=(ee,Ce)=>{const we=s.aptidoes[ee],Ye=s.aptidoesBase[ee]||0;if(Ce<0){if(we<=Ye)return;let Ee=we===1?2:we===2?4:6;o(pt=>({...pt,aptidoes:{...pt.aptidoes,[ee]:we-1},xpDisponivel:pt.xpDisponivel+Ee}))}else{if(we>=3)return;let Ee=we===0?2:we===1?4:6;if(s.xpDisponivel<Ee){ae("Erro",`XP Insuficiente (${Ee} XP).`,"error");return}o(pt=>({...pt,aptidoes:{...pt.aptidoes,[ee]:we+1},xpDisponivel:pt.xpDisponivel-Ee}))}},Q=(ee,Ce,we)=>{if(s.caracteristicas.includes(ee))o(Ye=>({...Ye,caracteristicas:Ye.caracteristicas.filter(Ee=>Ee!==ee),xpDisponivel:Ye.xpDisponivel+Ce}));else{if(!k(we)||s.xpDisponivel<Ce)return;o(Ye=>({...Ye,caracteristicas:[...Ye.caracteristicas,ee],xpDisponivel:Ye.xpDisponivel-Ce}))}},ce=(ee,Ce)=>{const we=s.instintos.potencia||1,Ye=s.instintos.resolucao||1,Ee=6*(1+we+Ye);return{user_id:ee,name:s.nome,avatar_url:Ce,generation:s.geracao,status:"Em Criao",is_draft:!0,background:{occupation:s.ocupacao,event:s.evento,description:s.descricao,purposes:{p1:s.p1,p2:s.p2,c1:s.c1,c2:s.c2}},instincts:s.instintos,aptitudes:s.aptidoes,base_aptitudes:s.aptidoesBase,vitals:{health:{current:Ee,max:Ee,temp:0},determination:{current:9,max:9},assimilation:{current:1,max:1}},xp_available:s.xpDisponivel,kit_name:s.kitName,characteristics_ids:s.caracteristicas}},oe=async()=>{c(!0);try{const{data:{user:ee}}=await Lt.auth.getUser();if(!ee)throw new Error("Sesso invlida.");let Ce=null;V&&(Ce=await qi.uploadAvatar(V,ee.id));const we=ce(ee.id,Ce);let Ye;return u?(Ce||delete we.avatar_url,Ye=await qi.updateCharacter(u,we)):(Ye=await qi.createCharacter(we),h(Ye.id)),!0}catch(ee){return console.error(ee),ae("Erro",ee.message,"error"),!1}finally{c(!1)}},T=async()=>{if(!s.kitName){ae("Ateno","Selecione um Kit Inicial.","error");return}c(!0);try{if(!u)throw new Error("ID do rascunho perdido.");await qi.populateInventoryFromKit(u,s.kitName),await qi.updateCharacter(u,{status:"Saudvel",is_draft:!1,kit_name:s.kitName,characteristics_ids:s.caracteristicas,aptitudes:s.aptidoes,xp_available:s.xpDisponivel}),ae("Sucesso","Personagem Criado com Sucesso!","success")}catch(ee){console.error("Erro na finalizao:",ee),ae("Erro",ee.message||"Falha ao processar criao.","error"),c(!1)}},$=async()=>{if(n===1){if(!s.nome){ae("Erro","Nome obrigatrio.","error");return}await oe()&&i(2)}else if(n===2){if(p>0){ae("Erro","Gaste seus pontos de Instintos!","error");return}if(G>0){ae("Erro","Gaste seus pontos de Aptides!","error");return}o(Ce=>({...Ce,aptidoesBase:{...Ce.aptidoes}})),await oe()&&i(3)}else T()},ae=(ee,Ce,we)=>E({isOpen:!0,title:ee,message:Ce,type:we}),Ie=()=>{E(ee=>({...ee,isOpen:!1})),M.title==="Sucesso"&&a("/dashboard/infectados")},be=ee=>!ee||ee.length===0?m.jsx("span",{className:"req-success",children:"Livre"}):ee.map((Ce,we)=>{const Ye=we>0?m.jsx("span",{className:"req-neutral",style:{color:"#888"},children:", "}):null;if(Ce.type==="ou"&&Ce.options)return m.jsxs(xg.Fragment,{children:[Ye,Ce.options.map((pt,Ke)=>m.jsxs(xg.Fragment,{children:[Ke>0&&m.jsx("span",{className:"req-neutral",style:{color:"#888"},children:" ou "}),m.jsxs("span",{className:q(pt)?"req-success":"req-fail",children:[pt.key?Zh[pt.key]||pt.key:"Req"," ",pt.val]})]},Ke))]},we);const Ee=q(Ce);return m.jsxs(xg.Fragment,{children:[Ye,m.jsxs("span",{className:Ee?"req-success":"req-fail",children:[Ce.key?Zh[Ce.key]||Ce.key:"Req"," ",Ce.val]})]},we)}),D=(ee,Ce,we)=>m.jsxs("div",{className:"stat-row",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("span",{className:"stat-name",style:{color:"#ccc",fontSize:"0.85rem"},children:ee}),m.jsx(Xa,{textKey:Ce,descriptions:_a})]}),m.jsxs("div",{className:"stat-control",children:[m.jsx("button",{className:"btn-mini",onClick:()=>F(we,Ce,-1),children:"-"}),m.jsx("span",{className:"stat-value",children:we==="instintos"?s.instintos[Ce]:s.aptidoes[Ce]}),m.jsx("button",{className:"btn-mini",onClick:()=>F(we,Ce,1),children:"+"})]})]},Ce),de=(ee,Ce)=>{const we=s.aptidoesBase[Ce]||0,Ye=s.aptidoes[Ce]||0,Ee=Ye-we,pt=Ye===0?"2XP":Ye===1?"4XP":Ye===2?"6XP":"MAX";return m.jsxs("div",{className:"stat-row",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("span",{className:"stat-name",style:{color:"#ccc",fontSize:"0.85rem"},children:ee}),m.jsx(Xa,{textKey:Ce,descriptions:_a})]}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px"},children:[m.jsxs("div",{className:"upgrade-math",children:[m.jsx("span",{className:"math-base",children:we}),"+",m.jsx("span",{className:`math-added ${Ee>0?"active":""}`,children:Ee}),"=",m.jsx("span",{className:"math-total",children:Ye})]}),m.jsxs("div",{className:"stat-control",children:[m.jsx("button",{className:"btn-mini",onClick:()=>j(Ce,-1),disabled:Ye<=we,style:{opacity:Ye<=we?.3:1},children:"-"}),m.jsx("span",{className:"next-cost-preview",children:pt}),m.jsx("button",{className:"btn-mini",onClick:()=>j(Ce,1),disabled:Ye>=3,style:{opacity:Ye>=3?.3:1},children:"+"})]})]})]},Ce)};return A?m.jsx("div",{className:"creator-container",style:{justifyContent:"center",alignItems:"center"},children:"Carregando rascunho..."}):m.jsxs("div",{className:"creator-container",children:[m.jsx("div",{ref:t,style:{scrollMarginTop:"100px"}}),m.jsx("div",{className:"wizard-header",children:m.jsxs("div",{className:"wizard-title-row",children:[m.jsxs("h2",{className:"wizard-title",children:["Criao de Infectado - ",n,"/3"]}),m.jsx("div",{className:"wizard-steps",children:[1,2,3].map(ee=>m.jsx("div",{className:`step-indicator ${n>=ee?"active":""}`},ee))})]})}),m.jsx("div",{className:"wizard-content",children:m.jsxs("div",{className:"wizard-wrapper",children:[n===1&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"form-section compact-section",children:[m.jsx("div",{className:"header-compact",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Identidade"})}),m.jsxs("div",{className:"identity-grid",children:[m.jsxs("div",{className:"identity-col-left",children:[m.jsxs("div",{className:"input-group",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("label",{style:{marginBottom:0,color:"var(--cor-tema)"},children:"Nome"}),m.jsx(Xa,{textKey:"char_name",descriptions:_a})]}),m.jsx("input",{className:"input-field",value:s.nome,onChange:ee=>o({...s,nome:ee.target.value}),placeholder:"Nome"})]}),m.jsxs("div",{className:"input-group",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("label",{style:{marginBottom:0,color:"var(--cor-tema)"},children:"Gerao"}),m.jsx(Xa,{textKey:"generation",descriptions:_a})]}),m.jsxs("select",{className:"input-field",value:s.geracao,onChange:ee=>o({...s,geracao:ee.target.value}),children:[m.jsx("option",{children:"Pr-Colapso"}),m.jsx("option",{children:"Colapso"}),m.jsx("option",{children:"Ps-Colapso"})]})]}),m.jsxs("div",{className:"input-group",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("label",{style:{marginBottom:0,color:"var(--cor-tema)"},children:"Ocupao"}),m.jsx(Xa,{textKey:"occupation",descriptions:_a})]}),m.jsx("input",{className:"input-field",value:s.ocupacao,onChange:ee=>o({...s,ocupacao:ee.target.value})})]}),m.jsxs("div",{className:"input-group",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("label",{style:{marginBottom:0,color:"var(--cor-tema)"},children:"Evento Marcante"}),m.jsx(Xa,{textKey:"defining_event",descriptions:_a})]}),m.jsx("input",{className:"input-field",value:s.evento,onChange:ee=>o({...s,evento:ee.target.value})})]})]}),m.jsxs("div",{className:"identity-col-right",children:[m.jsxs("div",{className:"input-group",children:[m.jsx("label",{style:{color:"var(--cor-tema)"},children:"Foto"}),m.jsxs("div",{className:"avatar-upload-container",children:[m.jsx("div",{className:"avatar-preview-circle",style:{backgroundImage:X?`url(${X})`:"none"},children:!X&&m.jsx("span",{className:"avatar-placeholder-icon",children:"?"})}),m.jsxs("div",{className:"avatar-controls",children:[m.jsx("input",{type:"file",id:"avatar-upload-input",accept:".png, .gif, .webp",onChange:le,style:{display:"none"}}),m.jsx("label",{htmlFor:"avatar-upload-input",className:"btn-upload-custom",children:"Escolher Arquivo"}),m.jsx("span",{className:"avatar-help-text",children:"Aceita: .WEBP, .PNG, .GIF (Mx 2MB)"})]})]})]}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("label",{style:{color:"#88aacc",fontSize:"0.85rem",marginBottom:0},children:"Descrio"}),m.jsx(Xa,{textKey:"visual_description",descriptions:_a})]}),m.jsx("textarea",{className:"input-field text-area-full",value:s.descricao,onChange:ee=>o({...s,descricao:ee.target.value})})]})]})]}),m.jsxs("div",{className:"form-section compact-section",children:[m.jsx("div",{className:"header-compact",children:m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Propsitos"}),m.jsx(Xa,{textKey:"purposes",descriptions:_a})]})}),m.jsxs("div",{className:"stats-grid-container",children:[m.jsxs("div",{children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("h4",{className:"subtitle-std",style:{margin:0,color:"var(--cor-tema)"},children:"Pessoais"}),m.jsx(Xa,{textKey:"personal_purpose",descriptions:_a})]}),m.jsx("input",{className:"input-field mb-2",placeholder:"Propsito 1",value:s.p1,onChange:ee=>o({...s,p1:ee.target.value})}),m.jsx("input",{className:"input-field",placeholder:"Propsito 2",value:s.p2,onChange:ee=>o({...s,p2:ee.target.value})})]}),m.jsxs("div",{children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"5px"},children:[m.jsx("h4",{className:"subtitle-std",style:{margin:0,color:"var(--cor-tema)"},children:"Coletivos"}),m.jsx(Xa,{textKey:"collective_purpose",descriptions:_a})]}),m.jsx("input",{className:"input-field mb-2",placeholder:"Propsito 1",value:s.c1,onChange:ee=>o({...s,c1:ee.target.value})}),m.jsx("input",{className:"input-field",placeholder:"Propsito 2",value:s.c2,onChange:ee=>o({...s,c2:ee.target.value})})]})]})]})]}),n===2&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"form-section compact-section",children:[m.jsxs("div",{className:"header-compact",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Instintos"}),m.jsx(Xa,{textKey:"instincts",descriptions:_a})]}),m.jsxs("span",{className:"points-remaining",children:["Pontos: ",p]})]}),m.jsxs("div",{className:"stats-grid-3col",children:[D("Influncia","influencia","instintos"),D("Percepo","percepcao","instintos"),D("Potncia","potencia","instintos"),D("Reao","reacao","instintos"),D("Resoluo","resolucao","instintos"),D("Sagacidade","sagacidade","instintos")]})]}),m.jsxs("div",{className:"form-section compact-section",children:[m.jsxs("div",{className:"header-compact",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Aptides"}),m.jsx(Xa,{textKey:"aptitudes",descriptions:_a})]}),m.jsxs("span",{className:"points-remaining",children:["Pontos: ",G]})]}),m.jsxs("div",{className:"aptitudes-split-row compact-gap",children:[m.jsxs("div",{className:"compact-col",children:[m.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"5px",gap:"5px"},children:[m.jsx("h4",{className:"subtitle-std text-center",style:{margin:0,color:"var(--cor-tema)"},children:"Conhecimentos"}),m.jsx(Xa,{textKey:"knowledge",descriptions:_a})]}),m.jsx("div",{className:"stats-list-vertical",children:["biologia","erudicao","engenharia","geografia","medicina","seguranca"].map(ee=>D(Zh[ee],ee,"aptidoes"))})]}),m.jsxs("div",{className:"compact-col",children:[m.jsxs("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"5px",gap:"5px"},children:[m.jsx("h4",{className:"subtitle-std text-center",style:{margin:0,color:"var(--cor-tema)"},children:"Prticas"}),m.jsx(Xa,{textKey:"practices",descriptions:_a})]}),m.jsx("div",{className:"stats-list-vertical",children:["armas","atletismo","expressao","furtividade","manufaturas","sobrevivencia"].map(ee=>D(Zh[ee],ee,"aptidoes"))})]})]})]})]}),n===3&&m.jsxs("div",{className:"step3-grid",children:[m.jsx("div",{className:"step3-col-left",children:m.jsxs("div",{className:"form-section characteristics-container",children:[m.jsxs("div",{className:"header-compact",style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Caractersticas"}),m.jsx(Xa,{textKey:"characteristics",descriptions:_a})]}),m.jsx("div",{className:"characteristics-list",children:S.length===0?m.jsx("p",{style:{padding:"20px",color:"#666"},children:"Sem regras..."}):S.map(ee=>{const Ce=s.caracteristicas.includes(ee.id),we=!k(ee.requirements)&&!Ce;return m.jsxs("div",{className:`carac-row ${we?"locked":""}`,onClick:()=>!we&&Q(ee.id,ee.cost,ee.requirements),children:[m.jsxs("label",{className:"circular-checkbox-container",children:[m.jsx("input",{type:"checkbox",checked:Ce,readOnly:!0}),m.jsx("span",{className:`circular-checkmark ${we?"locked-check":""}`})]}),m.jsxs("div",{className:"carac-info",children:[m.jsx("div",{className:"carac-name",style:{color:Ce?"var(--cor-tema)":"#fff"},children:ee.name}),m.jsx("div",{className:"carac-desc",children:ee.description}),m.jsxs("div",{className:"carac-req",children:[m.jsx("span",{className:"req-static",children:"Req: "}),be(ee.requirements)]}),m.jsxs("div",{className:"carac-cost",children:[ee.cost," XP"]})]})]},ee.id)})})]})}),m.jsxs("div",{className:"step3-col-right",children:[m.jsxs("div",{className:"xp-panel",children:[m.jsx("span",{className:"xp-label",children:"XP DISPONVEL"}),m.jsx("span",{className:"xp-value",children:s.xpDisponivel})]}),m.jsxs("div",{className:"form-section expanded-section",children:[m.jsxs("div",{className:"header-compact",children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Evoluir Aptides"}),m.jsx("p",{className:"evolution-hint",children:"01 (2XP) | 12 (4XP) | 23 (6XP)"})]}),m.jsxs("div",{className:"aptitudes-split-row compact-gap",style:{overflowY:"auto",flex:1},children:[m.jsx("div",{className:"compact-col",style:{display:"flex",flexDirection:"column",height:"100%"},children:m.jsx("div",{className:"stats-list-vertical",style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:["biologia","erudicao","engenharia","geografia","medicina","seguranca"].map(ee=>de(Zh[ee],ee))})}),m.jsx("div",{className:"compact-col",style:{display:"flex",flexDirection:"column",height:"100%"},children:m.jsx("div",{className:"stats-list-vertical",style:{flex:1,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:["armas","atletismo","expressao","furtividade","manufaturas","sobrevivencia"].map(ee=>de(Zh[ee],ee))})})]})]}),m.jsxs("div",{className:"form-section compact-section kit-section",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px",marginBottom:"10px"},children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:0,borderBottom:"none"},children:"Kit Inicial"}),m.jsx(Xa,{textKey:"starting_kit",descriptions:_a})]}),m.jsxs("select",{className:"input-field",value:s.kitName,onChange:ee=>o({...s,kitName:ee.target.value}),children:[m.jsx("option",{value:"",children:"Selecione..."}),R.map(ee=>m.jsx("option",{value:ee.name,children:ee.name},ee.id))]}),m.jsx("div",{className:"kit-items-display",children:R.find(ee=>ee.name===s.kitName)?.items_description||"Selecione um kit."})]})]})]})]})}),m.jsxs("div",{className:"creator-footer",children:[m.jsx("button",{className:"btn-nav btn-back",onClick:()=>n>1?i(n-1):a("/dashboard/infectados"),disabled:l,children:n===1?"Cancelar":"Voltar"}),m.jsx("button",{className:"btn-nav btn-next",onClick:$,disabled:l,style:{cursor:l?"wait":"pointer",opacity:l?.7:1,display:"flex",alignItems:"center",gap:"10px"},children:l?"SALVANDO...":n===3?"FINALIZAR":"PRXIMO"})]}),M.isOpen&&m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box",children:[m.jsx("div",{className:"modal-title",children:M.title}),m.jsx("div",{className:"modal-message",children:M.message}),m.jsx("button",{className:"modal-btn",onClick:Ie,children:"Entendido"})]})})]})}function QE({name:a,generation:e,occupation:t,onBack:n}){return m.jsxs("header",{className:"sheet-header",children:[m.jsx("div",{className:"char-actions",children:m.jsxs("button",{className:"btn-save-sheet",onClick:n,children:[m.jsx("span",{children:""})," VOLTAR"]})}),m.jsxs("div",{className:"char-identity",children:[m.jsx("h1",{className:"char-name-title",children:a}),m.jsxs("span",{className:"char-gen-subtitle",children:[e," | ",t]})]})]})}function qE({determination:a,assimilation:e,onUpdate:t}){const n="var(--cor-assim-evolutiva)",i="var(--cor-assim-inoportuna)",o=()=>{a.max>0&&t({determination:{...a,max:a.max-1},assimilation:{...e,max:e.max+1}})},l=()=>{e.max>0&&t({determination:{...a,max:a.max+1},assimilation:{...e,max:e.max-1}})},c=h=>{const A=h+1,f=A===a.current?A-1:A;t({determination:{...a,current:f}})},u=h=>{const A=e.max-h,f=A===e.current?A-1:A;t({assimilation:{...e,current:f}})};return m.jsxs("div",{className:"tug-wrapper",children:[m.jsxs("div",{className:"tug-track-container",children:[Array.from({length:a.max}).map((h,A)=>{const f=A<a.current;return m.jsx("svg",{className:"tug-triangle",viewBox:"0 0 14 20",preserveAspectRatio:"none",onClick:()=>c(A),children:m.jsx("path",{d:"M0,0 L0,20 L14,10 Z",fill:f?n:"transparent",stroke:n,strokeWidth:2,vectorEffect:"non-scaling-stroke"})},`det-${A}`)}),Array.from({length:e.max}).map((h,A)=>{const f=A>=e.max-e.current;return m.jsx("svg",{className:"tug-triangle",viewBox:"0 0 14 20",preserveAspectRatio:"none",onClick:()=>u(A),children:m.jsx("path",{d:"M14,0 L14,20 L0,10 Z",fill:f?i:"transparent",stroke:i,strokeWidth:2,vectorEffect:"non-scaling-stroke"})},`ass-${A}`)})]}),m.jsxs("div",{className:"tug-controls-row",children:[m.jsx("div",{className:"tug-circle det-circle",children:a.max}),m.jsxs("div",{className:"tug-buttons-group",children:[m.jsx("button",{className:"btn-tug-adjust",onClick:o,title:"Aumentar Assimilao",children:"<"}),m.jsx("span",{style:{fontSize:"0.6rem",color:"#666",textTransform:"uppercase",letterSpacing:"0.5px"},children:"EQUILBRIO"}),m.jsx("button",{className:"btn-tug-adjust",onClick:l,title:"Aumentar Determinao",children:">"})]}),m.jsx("div",{className:"tug-circle ass-circle",children:e.max})]})]})}function $E({health:a,instincts:e,onUpdate:t,onStatusChange:n}){const i=a.temp||0,s=a.current,o=1+(e.resolucao||0)+(e.potencia||0),c=o*6,u=s+i,h=y=>{n&&(y===0?n("Morto"):y<=o?n("Incapacitado"):y<=o*2?n("Debilitado"):y<=o*3?n("Ferido"):y<=o*4?n("Lacerado"):y<=o*5?n("Escoriado"):n("Saudvel"))},A=y=>{const G=Math.max(0,Math.min(c,s+y));t({...a,current:G,max:c,temp:i}),h(G)},f=y=>{const G=Math.max(0,i+y);t({...a,current:s,max:c,temp:G})},p=(y,G,B)=>{const S=(y-1)*o,N=[];for(let R=1;R<=o;R++){const w=S+R,V=s>=w;N.push(m.jsx("div",{className:`hp-segment ${B} ${V?"active":""}`},R))}return m.jsx("div",{className:"hp-box-container",children:m.jsxs("div",{className:"hp-box-segments",children:[N,m.jsx("div",{className:"hp-box-label-overlay",children:G})]})})};return m.jsxs("div",{className:"health-section",children:[m.jsxs("div",{className:"health-header-grid",children:[m.jsxs("div",{className:"health-ctrl-group",children:[m.jsx("span",{className:"health-ctrl-title",style:{color:"#00bbff"},children:"Temp"}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-health-adjust",onClick:()=>f(-1),children:"-"}),m.jsx("button",{className:"btn-health-adjust",onClick:()=>f(1),children:"+"})]})]}),m.jsxs("div",{className:"health-display-box",children:[m.jsxs("div",{className:"health-total-val",children:[u," ",m.jsxs("span",{style:{fontSize:"1rem",color:"#666"},children:["/ ",c]})]}),m.jsx("span",{className:"health-label-small",children:"Estado Geral"})]}),m.jsxs("div",{className:"health-ctrl-group",children:[m.jsx("span",{className:"health-ctrl-title",style:{color:"#4caf50"},children:"Real"}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-health-adjust",onClick:()=>A(-1),children:"-"}),m.jsx("button",{className:"btn-health-adjust",onClick:()=>A(1),children:"+"})]})]})]}),m.jsxs("div",{className:"health-groups-container",children:[m.jsxs("div",{className:"health-group-row",children:[m.jsx("span",{className:"health-group-title",children:"Ativa Recuperao aps repouso completo"}),m.jsxs("div",{className:"health-boxes-wrapper",children:[p(6,"Saudvel","green"),p(5,"Escoriao","green")]})]}),m.jsxs("div",{className:"health-group-row",children:[m.jsx("span",{className:"health-group-title",children:"Ativa a Recuperao aps uma semana"}),m.jsxs("div",{className:"health-boxes-wrapper",children:[p(4,"Lacerao","yellow"),p(3,"Ferimentos","yellow")]}),m.jsx("div",{className:"hp-legend-row",children:"-1 sucesso em testes"})]}),m.jsxs("div",{className:"health-group-row",children:[m.jsx("span",{className:"health-group-title",children:"Necessita de cuidados mdico"}),m.jsxs("div",{className:"health-boxes-wrapper",children:[m.jsxs("div",{className:"hp-box-container",children:[p(2,"Debilitao","red").props.children,m.jsxs("span",{className:"hp-box-specific-legend",children:["Incapaz de agir",m.jsx("br",{}),"-2 sucessos"]})]}),m.jsxs("div",{className:"hp-box-container",children:[p(1,"Incapacitao","red").props.children,m.jsxs("span",{className:"hp-box-specific-legend",children:["Inconsciente",m.jsx("br",{}),"Aes exigem 2 adaptaes"]})]})]})]})]})]})}function e9({background:a,onSave:e}){const[t,n]=J.useState(a);J.useEffect(()=>{n(a)},[a]);const i=(o,l,c)=>{n(c?u=>({...u,purposes:{...u.purposes,[c]:l}}):u=>({...u,[o]:l}))},s=()=>{e(t)};return m.jsxs("div",{className:"attr-group-container",style:{marginBottom:"10px",padding:"10px"},children:[m.jsx("div",{className:"group-title",children:"Origens"}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"10px"},children:[m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"Ocupao"}),m.jsx("input",{className:"input-dark-sheet",value:t.occupation,onChange:o=>i("occupation",o.target.value),onBlur:s})]}),m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"Evento Marcante"}),m.jsx("input",{className:"input-dark-sheet",value:t.event,onChange:o=>i("event",o.target.value),onBlur:s})]})]}),m.jsxs("div",{className:"purposes-grid",children:[m.jsxs("div",{className:"purpose-col",children:[m.jsx("span",{className:"purpose-title",children:"Pessoais"}),m.jsx("input",{className:"input-dark-sheet purpose-input",placeholder:"Propsito 1",value:t.purposes.p1,onChange:o=>i("purposes",o.target.value,"p1"),onBlur:s}),m.jsx("input",{className:"input-dark-sheet purpose-input",placeholder:"Propsito 2",value:t.purposes.p2,onChange:o=>i("purposes",o.target.value,"p2"),onBlur:s})]}),m.jsxs("div",{className:"purpose-col",children:[m.jsx("span",{className:"purpose-title",children:"Coletivos"}),m.jsx("input",{className:"input-dark-sheet purpose-input",placeholder:"Propsito 1",value:t.purposes.c1,onChange:o=>i("purposes",o.target.value,"c1"),onBlur:s}),m.jsx("input",{className:"input-dark-sheet purpose-input",placeholder:"Propsito 2",value:t.purposes.c2,onChange:o=>i("purposes",o.target.value,"c2"),onBlur:s})]})]})]})}const t9={influencia:"Influncia",percepcao:"Percepo",potencia:"Potncia",reacao:"Reao",resolucao:"Resoluo",sagacidade:"Sagacidade",biologia:"Biologia",erudicao:"Erudio",engenharia:"Engenharia",geografia:"Geografia",medicina:"Medicina",seguranca:"Segurana",armas:"Armas",atletismo:"Atletismo",expressao:"Expresso",furtividade:"Furtividade",manufaturas:"Manufaturas",sobrevivencia:"Sobrevivncia"};function n9({instincts:a,aptitudes:e,currentAssimilation:t,currentDetermination:n,onUpdate:i,onSpendAssimilation:s,onSpendDetermination:o,onSelectionChange:l}){const[c,u]=J.useState(!1),[h,A]=J.useState(!1),[f,p]=J.useState(!1),[y,G]=J.useState(!1),[B,S]=J.useState(a),[N,R]=J.useState(e),[w,V]=J.useState([]),[H,X]=J.useState([]);J.useEffect(()=>{S(a),R(e)},[a,e]);const Y=()=>{c?(i&&i({instincts:B,aptitudes:N}),u(!1)):u(!0)},M=(k,le,F,j)=>{k.stopPropagation(),le==="instinct"?S(Q=>({...Q,[F]:Math.max(0,(Q[F]||0)+j)})):R(Q=>({...Q,[F]:Math.max(0,(Q[F]||0)+j)}))},E=()=>{if(h)A(!1),V([]),l&&l([],H,!1);else{const k=t>=1,le=n>=2;!k&&!le?G(!0):p(!0)}},O=k=>{k==="assimilation"&&s?s():k==="determination"&&o&&o(2),A(!0),V([]),X([]),p(!1),l&&l([],[],!0)},P=(k,le)=>{let F=[...w],j=[...H];if(le==="instinct")w.includes(k)?F=w.filter(Q=>Q!==k):h?w.length<2?F=[...w,k]:F=[w[1],k]:F=[k];else{if(h)return;H.includes(k)?j=[]:j=[k]}V(F),X(j),l&&l(F,j,h)},q=(k,le,F)=>{const j=F==="instinct"?w.includes(k):H.includes(k),Q=F==="aptitude"&&h,ce=j?h?"selected-blue":"selected":"";return m.jsxs("div",{className:`mini-card ${ce} ${Q?"disabled":""}`,onClick:()=>!Q&&P(k,F),children:[m.jsxs("div",{className:"mc-left",children:[m.jsx("div",{className:"mc-selector"}),m.jsx("span",{className:"mini-label",children:t9[k]||k}),m.jsx(Xa,{textKey:k,descriptions:_a})]}),m.jsxs("div",{className:"mc-right",children:[c&&m.jsx("button",{className:"btn-attr-tiny",onClick:oe=>M(oe,F,k,-1),children:"-"}),m.jsx("span",{className:"mini-val",children:le}),c&&m.jsx("button",{className:"btn-attr-tiny",onClick:oe=>M(oe,F,k,1),children:"+"})]})]},k)};return m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px",height:"100%"},children:[m.jsxs("div",{className:"attr-group-container",children:[m.jsxs("div",{className:"instincts-header-grid",children:[m.jsxs("div",{style:{display:"flex",alignItems:"center"},children:[m.jsx("span",{className:`group-title ${h?"blue-mode":""}`,children:"Instintos"}),m.jsx(Xa,{textKey:"instincts",descriptions:_a})]}),m.jsxs("button",{className:`btn-toggle-assimilated btn-toggle-center ${h?"active-blue":""}`,onClick:E,children:[m.jsx("span",{className:"dot-indicator"}),"Agir por Instinto"]}),m.jsx("button",{className:`btn-edit-small btn-edit-right ${c?"saving":""}`,onClick:Y,children:c?"Salvar":"Editar"})]}),m.jsx("div",{className:"grid-instincts",children:Object.entries(B).map(([k,le])=>q(k,le,"instinct"))})]}),m.jsxs("div",{className:"attr-group-container",style:{opacity:h?.3:1,filter:h?"grayscale(100%)":"none",transition:"0.3s"},children:[m.jsxs("div",{className:"group-header-simple",children:[m.jsx("span",{className:"group-title",children:"Conhecimentos"}),m.jsx(Xa,{textKey:"knowledge",descriptions:_a})]}),m.jsx("div",{className:"grid-aptitudes",children:["biologia","erudicao","engenharia","geografia","medicina","seguranca"].map(k=>q(k,N[k],"aptitude"))})]}),m.jsxs("div",{className:"attr-group-container",style:{opacity:h?.3:1,filter:h?"grayscale(100%)":"none",transition:"0.3s"},children:[m.jsxs("div",{className:"group-header-simple",children:[m.jsx("span",{className:"group-title",children:"Prticas"}),m.jsx(Xa,{textKey:"practices",descriptions:_a})]}),m.jsx("div",{className:"grid-aptitudes",children:["armas","atletismo","expressao","furtividade","manufaturas","sobrevivencia"].map(k=>q(k,N[k],"aptitude"))})]}),f&&m.jsx("div",{className:"dramatic-overlay",children:m.jsxs("div",{className:"dramatic-box",children:[m.jsx("span",{className:"dramatic-title",children:"Fuso Neural"}),m.jsx("p",{className:"dramatic-text",children:"Ao Agir por Instinto, o infectado elege dois instintos ou usa o mesmo instinto duas vezes, ignorando suas outras Aptides."}),m.jsx("p",{className:"dramatic-text",children:"Todos os D6 sero trocados por D12."}),m.jsx("p",{className:"dramatic-text",children:"Para acessar seus instintos primordiais e agir atravs do Parasita, um preo deve ser pago."}),m.jsxs("div",{className:"dramatic-choices",children:[t>=1&&m.jsxs("button",{className:"btn-choice cost-assimilation",onClick:()=>O("assimilation"),children:[m.jsx("span",{children:"Fundir Conscincia"}),m.jsx("span",{style:{fontSize:"0.7rem",opacity:.8},children:"1 Ponto de Assimilao"})]}),n>=2&&m.jsxs("button",{className:"btn-choice cost-determination",onClick:()=>O("determination"),children:[m.jsx("span",{children:"Forar Limites"}),m.jsx("span",{style:{fontSize:"0.7rem",opacity:.8},children:"2 Pontos de Determinao"})]})]}),m.jsx("button",{className:"btn-dramatic-cancel",onClick:()=>p(!1),children:"Cancelar Conexo"})]})}),y&&m.jsx("div",{className:"dramatic-overlay",children:m.jsxs("div",{className:"dramatic-box error-mode",children:[m.jsx("span",{className:"dramatic-title error",children:"Falha Crtica"}),m.jsxs("p",{className:"dramatic-text",children:["Sua mente est fragmentada e sua vontade esgotada.",m.jsx("br",{}),m.jsx("br",{}),"Voc no possui recursos para Agir por Instinto."]}),m.jsx("button",{className:"btn-warning-close",onClick:()=>G(!1),children:"Retornar"})]})})]})}function i9({characterId:a}){return console.log("Aba de assimilaes preparada para o personagem:",a),m.jsx("div",{style:{display:"flex",justifyContent:"center",alignSelf:"center",padding:"40px",color:"rgba(255,255,255,0.5)",fontStyle:"italic",fontSize:"1.1rem",width:"100%",textAlign:"center"},children:"~ assimilaes em breve ~"})}function a9({title:a,items:e,onEdit:t}){const[n,i]=J.useState(0),[s,o]=J.useState(null),l=6,c=Math.ceil(e.length/l),u=n<c-1,h=n>0,A=e.length>l,f=e.slice(n*l,(n+1)*l);return m.jsxs("div",{className:"paginated-wrapper",children:[m.jsxs("div",{className:"paginated-header",style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsx("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:m.jsxs("span",{className:"group-title",style:{marginBottom:0,borderBottom:"none"},children:[a," ",m.jsx("span",{className:"counter-badge",children:e.length})]})}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[A&&m.jsxs("span",{className:"page-indicator-text",style:{marginRight:"5px"},children:[n+1," / ",c]}),t&&m.jsx("button",{className:"btn-edit-small",onClick:t,children:"EDITAR"})]})]}),m.jsxs("div",{className:"paginated-body",children:[m.jsx("button",{className:"side-nav-btn",disabled:!h,onClick:()=>i(p=>p-1),style:{visibility:A?"visible":"hidden"},children:""}),m.jsx("div",{className:"paginated-content-area",children:e.length===0?m.jsx("div",{className:"empty-paginated-state",children:"Nenhum registro."}):m.jsx("div",{className:"paginated-grid-3x2",children:f.map(p=>m.jsx("div",{className:"simple-card",onClick:()=>o(p),children:m.jsx("span",{className:"simple-card-text card-title-standard",children:p.name})},p.id))})}),m.jsx("button",{className:"side-nav-btn",disabled:!u,onClick:()=>i(p=>p+1),style:{visibility:A?"visible":"hidden"},children:""})]}),s&&m.jsx("div",{className:"detail-overlay-backdrop",onClick:()=>o(null),children:m.jsxs("div",{className:"detail-card-expanded modal-glow-standard",onClick:p=>p.stopPropagation(),children:[m.jsxs("div",{className:"expanded-header-area",children:[m.jsx("span",{className:"expanded-title card-title-standard",children:s.name}),m.jsxs("span",{className:"expanded-type",children:["Custo: ",s.cost," XP"]})]}),m.jsx("p",{className:"expanded-desc",children:s.description}),m.jsx("button",{className:"btn-close-modal-wide",onClick:()=>o(null),children:"Fechar"})]})})]})}const s9="/Assimilacao-RPG-Manager/assets/rules-active-D1thrEPO.svg",o9="/Assimilacao-RPG-Manager/assets/rules-broken-C38gu3Dg.svg",r9={influencia:"Influncia",percepcao:"Percepo",potencia:"Potncia",reacao:"Reao",resolucao:"Resoluo",sagacidade:"Sagacidade",biologia:"Biologia",erudicao:"Erudio",engenharia:"Engenharia",geografia:"Geografia",medicina:"Medicina",seguranca:"Segurana",armas:"Armas",atletismo:"Atletismo",expressao:"Expresso",furtividade:"Furtividade",manufaturas:"Manufaturas",sobrevivencia:"Sobrevivncia"};function l9({ids:a,instincts:e,aptitudes:t,onUpdate:n}){const[i,s]=J.useState([]),[o,l]=J.useState([]),[c,u]=J.useState(!0),[h,A]=J.useState(!1),[f,p]=J.useState(!1);J.useEffect(()=>{(async()=>{if(!a||a.length===0){s([]),u(!1);return}try{const w=await qi.getCharacteristicsByIds(a);s(w||[])}catch(w){console.error(w)}finally{u(!1)}})()},[a]),J.useEffect(()=>{h&&o.length===0&&(async()=>{try{const w=await qi.getAllCharacteristics();l(w||[])}catch(w){console.error("Erro ao carregar lista completa:",w)}})()},[h,o.length]);const y=R=>R.type==="ou"&&R.options?R.options.some(w=>y(w)):R.key&&R.val!==void 0?((R.type==="instintos"?e[R.key]:t[R.key])||0)>=R.val:!1,G=R=>f||!R||R.length===0?!0:(Array.isArray(R)?R:[]).every(V=>y(V)),B=R=>!R||R.length===0?m.jsx("span",{style:{color:"#666"},children:"Livre"}):R.map((w,V)=>{const H=f?!0:y(w),X=w.key?r9[w.key]||w.key:"Req",Y=w.type==="ou"?"Opes...":`${X} ${w.val}`;return m.jsxs("span",{style:{marginRight:"6px",color:H?"#4caf50":"#ff5555"},children:[Y," ",V<R.length-1?",":""]},V)}),S=R=>{if(!n||!a)return;const w=[...a,R.id];n(w),s(V=>[...V,R])},N=R=>{if(!n||!a)return;const w=a.filter(V=>V!==R);n(w),s(V=>V.filter(H=>H.id!==R))};return c?m.jsx("div",{style:{color:"#666",fontSize:"0.8rem"},children:"Carregando..."}):m.jsxs(m.Fragment,{children:[m.jsx(a9,{title:"Caractersticas",items:i,onEdit:()=>A(!0)}),h&&m.jsx("div",{className:"detail-overlay-backdrop",onClick:()=>A(!1),children:m.jsxs("div",{className:"detail-card-expanded",style:{width:"90%",maxWidth:"900px",height:"85%",maxHeight:"700px",display:"flex",flexDirection:"column"},onClick:R=>R.stopPropagation(),children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"10px",marginBottom:"10px"},children:[m.jsx("span",{className:"expanded-title",children:"Gerenciar Caractersticas"}),m.jsx("button",{className:`btn-req-break ${f?"broken":""}`,onClick:()=>p(!f),title:f?"Regras Ignoradas (Permite tudo)":"Regras Ativas (Valida requisitos)",children:m.jsx("img",{src:f?o9:s9,alt:"Status Regra",className:"icon-req-status"})})]}),m.jsx("div",{className:"char-editor-list",children:o.map(R=>{const w=i.some(X=>X.id===R.id),V=G(R.requirements),H=!w&&!V&&!f;return m.jsxs("div",{className:`char-edit-card ${w?"owned":""} ${H?"locked":""}`,children:[m.jsxs("div",{className:"char-edit-info",children:[m.jsx("span",{className:"char-edit-title",children:R.name}),m.jsx("div",{className:"char-edit-req",children:B(R.requirements)}),m.jsx("span",{className:"char-edit-desc",children:R.description})]}),m.jsxs("div",{className:"char-edit-actions",children:[m.jsx("button",{className:"btn-feat-action add",disabled:w||H,onClick:()=>S(R),title:w?"Adquirido":H?"Requisito Insuficiente":"Adicionar",children:"+"}),m.jsx("button",{className:"btn-feat-action remove",disabled:!w,onClick:()=>N(R.id),title:"Remover",children:"-"})]})]},R.id)})}),m.jsx("button",{className:"btn-close-modal-wide",style:{marginTop:"auto"},onClick:()=>A(!1),children:"Concluir"})]})})]})}function c9({characterId:a}){const[e,t]=J.useState([]),[n,i]=J.useState(!0),[s,o]=J.useState(null),[l,c]=J.useState(null),[u,h]=J.useState(null),[A,f]=J.useState(null),[p,y]=J.useState(1);J.useEffect(()=>{G()},[a]);const G=async()=>{try{const j=(await qi.getCharacterInventory(a)).filter(Q=>Q.is_visible!==!1);t(j)}catch(F){console.error(F)}finally{i(!1)}},B=F=>({WEAPON:"Arma",weapon:"Arma",EQUIPMENT:"Equipamento",equipment:"Equipamento",CONSUMABLE:"Consumvel",consumable:"Consumvel",MATERIAL:"Material",material:"Material",MISC:"Diversos",misc:"Diversos",AMMO:"Munio",ammo:"Munio"})[F]||F,S=F=>F==="BACKPACK"?"a Mochila":F==="EQUIPPED"?"os Equipados":F==="REFUGE"?"o Refgio":F,N=F=>F===1?"1 Espao":`${F} Espaos`,R=e.filter(F=>F.location==="EQUIPPED"),V=R.find(F=>F.traits&&F.traits.backpack_capacity&&!F.is_dropped)?.traits.backpack_capacity||0,H=R.find(F=>F.traits&&F.traits.backpack_capacity&&F.is_dropped),X=e.filter(F=>F.location==="BACKPACK"),Y=X.reduce((F,j)=>F+j.slots*j.quantity,0),M=e.filter(F=>F.location==="REFUGE"),E=(F,j)=>{t(Q=>Q.map(ce=>ce.inventory_id===F?{...ce,...j}:ce))},O=(F,j)=>{if(H){if(j==="BACKPACK"){c("Voc largou sua mochila! Recupere-a antes de guardar itens.");return}if(F.location==="BACKPACK"){c("Este item est na mochila que voc largou no cho!");return}}F.quantity>1?(y(1),f({item:F,target:j,max:F.quantity})):P(F,j,1)},P=async(F,j,Q)=>{const ce=F.slots*Q;if(j==="EQUIPPED"){const oe=R.some(T=>T.item_id===F.item_id);if(R.length>=4&&!oe){c("Slots de equipamento cheios (Mx 4).");return}}if(j==="BACKPACK"&&F.location!=="BACKPACK"&&Y+ce>V){c(`Mochila cheia! Requer: ${ce} | Livre: ${V-Y}`);return}try{await qi.transferItem(F.inventory_id,Q,j),G()}catch(oe){console.error(oe),c("Erro ao mover item: "+(oe.message||"Erro desconhecido"))}},q=F=>{h({msg:"Largar a mochila no cho? Voc perder acesso aos itens nela temporariamente.",action:async()=>{E(F.inventory_id,{is_dropped:!0});try{qi.updateGenericInventory&&await qi.updateGenericInventory(F.inventory_id,{is_dropped:!0})}catch(j){console.error(j)}}})},k=async F=>{E(F.inventory_id,{is_dropped:!1});try{qi.updateGenericInventory&&await qi.updateGenericInventory(F.inventory_id,{is_dropped:!1})}catch(j){console.error(j)}},le=F=>{h({msg:"Declarar como PERDIDA? A mochila e TODOS os itens dentro dela sumiro da ficha para sempre.",action:async()=>{const j=X.map(Q=>Q.inventory_id);j.push(F.inventory_id),t(Q=>Q.filter(ce=>!j.includes(ce.inventory_id)));try{if(qi.updateGenericInventory)for(const Q of j)await qi.updateGenericInventory(Q,{is_visible:!1,is_dropped:!1})}catch(Q){console.error(Q),G()}}})};return n?m.jsx("div",{style:{padding:"20px",color:"#888"},children:"Carregando..."}):m.jsxs("div",{className:"inv-container",children:[m.jsxs("div",{className:"inv-section-header",children:[m.jsx("span",{className:"group-title",children:"Equipados"}),m.jsxs("span",{className:"inv-capacity-indicator",children:[R.length," / 4"]})]}),m.jsx("div",{className:"inv-equipped-grid",children:Array.from({length:4}).map((F,j)=>{const Q=R[j],ce=Q&&Q.traits.backpack_capacity,oe=Q?.is_dropped;return m.jsx("div",{className:`inv-slot-card ${Q?"":"empty"} ${oe?"dropped":""}`,children:Q?m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"inv-slot-top",children:[m.jsxs("span",{className:"inv-item-name",children:[Q.name,Q.quantity>1&&m.jsxs("span",{style:{color:"var(--cor-tema)",marginLeft:"4px"},children:["x",Q.quantity]})]}),m.jsx("button",{className:"btn-inspect-icon",onClick:()=>o(Q),children:""})]}),m.jsx("span",{className:"inv-item-type",children:B(Q.category)}),ce&&m.jsx("span",{style:{fontSize:"0.6rem",color:oe?"#ff5555":"#4caf50",margin:"2px 0"},children:oe?"LARGADA NO CHO":`+ ${Q.traits.backpack_capacity} Espaos`}),m.jsx("p",{className:"inv-item-desc",children:Q.description}),m.jsx("div",{className:"inv-actions",children:ce?oe?m.jsxs(m.Fragment,{children:[m.jsx("button",{className:"btn-success",onClick:()=>k(Q),children:"Recuperar"}),m.jsx("button",{className:"btn-danger",onClick:()=>le(Q),children:"Perdida"})]}):m.jsxs(m.Fragment,{children:[m.jsx("button",{className:"btn-danger",onClick:()=>q(Q),title:"Largar para fugir",children:"Largar"}),m.jsx("button",{onClick:()=>O(Q,"REFUGE"),children:" Refgio"})]}):m.jsxs(m.Fragment,{children:[m.jsx("button",{onClick:()=>O(Q,"BACKPACK"),children:" Mochila"}),m.jsx("button",{onClick:()=>O(Q,"REFUGE"),children:" Refgio"})]})})]}):m.jsx("span",{className:"inv-empty-text",children:"Vazio"})},j)})}),m.jsxs("div",{className:"inv-split-area",children:[m.jsxs("div",{className:"inv-column backpack-col",children:[H&&m.jsxs("div",{className:"inv-backpack-overlay",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.85)",zIndex:10,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",padding:"20px"},children:[m.jsx("strong",{style:{color:"#ff5555",fontSize:"1.2rem"},children:"MOCHILA LARGADA"}),m.jsxs("p",{style:{fontSize:"0.8rem",marginTop:"10px",color:"#ccc"},children:["Voc largou sua mochila. ",m.jsx("br",{}),m.jsx("strong",{children:"Recupere-a"})," na rea de equipamentos para acessar."]})]}),m.jsxs("div",{className:"inv-section-header",children:[m.jsx("span",{className:"group-title",children:"Mochila"}),m.jsxs("span",{className:`inv-capacity-indicator ${Y>V?"overload":""}`,children:[Y," / ",V," Espaos"]})]}),m.jsxs("div",{className:"inv-list-scroll",children:[X.length===0&&m.jsxs("div",{className:"inv-empty-state",children:["Vazia (",V," slots)."]}),X.map(F=>{const j=F.slots*F.quantity;return m.jsxs("div",{className:"inv-backpack-card",children:[m.jsxs("div",{className:"inv-col-info",children:[m.jsxs("span",{className:"inv-item-name",children:[F.name,F.quantity>1&&m.jsxs("span",{className:"inv-qty",children:["x",F.quantity]})]}),m.jsx("span",{className:"inv-item-cat-small",children:B(F.category)}),m.jsx("span",{className:"inv-slots-badge",style:{marginTop:"auto"},children:N(j)})]}),m.jsx("div",{className:"inv-col-desc",children:F.description}),m.jsxs("div",{className:"inv-col-actions",children:[m.jsxs("div",{className:"inv-actions-top-row",children:[m.jsx("button",{className:"btn-bp-action",title:"Detalhes",onClick:()=>o(F),children:""}),m.jsx("button",{className:"btn-bp-action",title:"Equipar Item",onClick:()=>O(F,"EQUIPPED"),children:"Equipar"})]}),m.jsx("button",{className:"btn-bp-action btn-bp-refuge",onClick:()=>O(F,"REFUGE"),children:"Refgio"})]})]},F.inventory_id)})]})]}),m.jsxs("div",{className:"inv-column refuge-col",children:[m.jsxs("div",{className:"inv-section-header",children:[m.jsx("span",{className:"group-title",children:"Refgio"}),m.jsx("span",{className:"inv-capacity-indicator",children:""})]}),m.jsxs("div",{className:"inv-list-scroll",children:[M.length===0&&m.jsx("div",{className:"inv-empty-state",children:"Nada no refgio."}),M.map(F=>m.jsxs("div",{className:"inv-refuge-item",children:[m.jsxs("div",{className:"inv-refuge-info",children:[m.jsx("span",{className:"inv-refuge-name",children:F.name}),m.jsx("span",{className:"inv-qty-badge",children:F.quantity})]}),m.jsxs("div",{className:"inv-refuge-actions",children:[m.jsx("button",{className:"btn-ref-action",onClick:()=>o(F),children:""}),m.jsx("button",{className:"btn-ref-action",onClick:()=>O(F,"BACKPACK"),children:"Pegar"}),m.jsx("button",{className:"btn-ref-action",onClick:()=>O(F,"EQUIPPED"),children:"Usar"})]})]},F.inventory_id))]})]})]}),l&&m.jsx("div",{className:"detail-overlay-backdrop",style:{zIndex:9999},onClick:()=>c(null),children:m.jsxs("div",{className:"dramatic-box error-mode",onClick:F=>F.stopPropagation(),children:[m.jsx("span",{className:"dramatic-title error",children:"Ateno"}),m.jsx("p",{className:"dramatic-text",children:l}),m.jsx("button",{className:"btn-dramatic-cancel",onClick:()=>c(null),style:{width:"100%",border:"1px solid #ff5555",padding:"10px",color:"#fff",background:"rgba(255,0,0,0.1)"},children:"Entendido"})]})}),u&&m.jsx("div",{className:"detail-overlay-backdrop",style:{zIndex:9999},children:m.jsxs("div",{className:"dramatic-box",onClick:F=>F.stopPropagation(),children:[m.jsx("span",{className:"dramatic-title",children:"Confirmao"}),m.jsx("p",{className:"dramatic-text",children:u.msg}),m.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[m.jsx("button",{className:"btn-choice",style:{flex:1,justifyContent:"center"},onClick:()=>h(null),children:"Cancelar"}),m.jsx("button",{className:"btn-choice cost-determination",style:{flex:1,justifyContent:"center"},onClick:()=>{u.action(),h(null)},children:"Confirmar"})]})]})}),A&&m.jsx("div",{className:"detail-overlay-backdrop",style:{zIndex:9999},onClick:()=>f(null),children:m.jsxs("div",{className:"detail-card-expanded",style:{width:"300px",minHeight:"auto"},onClick:F=>F.stopPropagation(),children:[m.jsxs("div",{className:"expanded-header-area",children:[m.jsx("span",{className:"expanded-title",style:{color:"#fff",fontSize:"1.2rem"},children:"Mover Item"}),m.jsx("span",{className:"expanded-type",children:A.item.name})]}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px",alignItems:"center"},children:[m.jsxs("p",{style:{color:"#ccc",fontSize:"0.9rem",textAlign:"center"},children:["Quantas unidades deseja mover para ",m.jsx("strong",{children:S(A.target)}),"?"]}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[m.jsx("button",{className:"btn-attr-tiny",style:{width:"30px",height:"30px",fontSize:"1.2rem"},onClick:()=>y(Math.max(1,p-1)),children:"-"}),m.jsx("input",{type:"number",className:"input-dark-sheet",style:{width:"60px",textAlign:"center",fontSize:"1.2rem",fontWeight:"bold"},value:p,onChange:F=>y(Math.min(A.max,Math.max(1,parseInt(F.target.value)||1)))}),m.jsx("button",{className:"btn-attr-tiny",style:{width:"30px",height:"30px",fontSize:"1.2rem"},onClick:()=>y(Math.min(A.max,p+1)),children:"+"})]}),m.jsxs("span",{style:{fontSize:"0.7rem",color:"#666"},children:["Mximo disponvel: ",A.max]}),m.jsxs("div",{style:{display:"flex",gap:"10px",width:"100%",marginTop:"10px"},children:[m.jsx("button",{className:"btn-close-modal-wide",style:{background:"#333",boxShadow:"none"},onClick:()=>f(null),children:"Cancelar"}),m.jsx("button",{className:"btn-close-modal-wide",style:{background:"var(--cor-tema)",color:"#000"},onClick:()=>{P(A.item,A.target,p),f(null)},children:"Mover"})]})]})]})}),s&&m.jsx("div",{className:"detail-overlay-backdrop",onClick:()=>o(null),children:m.jsxs("div",{className:"detail-card-expanded",onClick:F=>F.stopPropagation(),children:[m.jsxs("div",{className:"expanded-header-area",children:[m.jsx("span",{className:"expanded-title",style:{color:"#fff"},children:s.name}),m.jsx("span",{className:"expanded-type",children:B(s.category)})]}),m.jsxs("div",{style:{flex:1,overflowY:"auto"},children:[m.jsx("p",{className:"expanded-desc",children:s.description}),m.jsxs("div",{style:{marginTop:"15px",display:"flex",gap:"10px",flexWrap:"wrap"},children:[m.jsxs("span",{className:"inv-slots-badge",style:{fontSize:"0.8rem"},children:["Ocupa: ",N(s.slots)]}),s.quantity>1&&m.jsxs("span",{className:"inv-slots-badge",style:{fontSize:"0.8rem",borderColor:"var(--cor-tema)",color:"var(--cor-tema)"},children:["Qtd: ",s.quantity]})]})]}),m.jsx("button",{className:"btn-close-modal-wide",style:{marginTop:"20px"},onClick:()=>o(null),children:"Fechar"})]})})]})}var NG={exports:{}},dg={};var Sw;function g9(){return Sw||(Sw=1,dg.ConcurrentRoot=1,dg.ContinuousEventPriority=8,dg.DefaultEventPriority=32,dg.DiscreteEventPriority=2,dg.IdleEventPriority=268435456,dg.LegacyRoot=0,dg.NoEventPriority=0),dg}var xw;function u9(){return xw||(xw=1,NG.exports=g9()),NG.exports}var A0=u9();const wm="182",Dd={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Od={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},GW=0,m2=1,BW=2,d9=3,SW=0,gC=1,Yf=2,nI=3,wc=0,Ss=1,po=2,Wl=0,lI=1,p2=2,b2=3,y2=4,xW=5,wu=100,ZW=101,wW=102,RW=103,NW=104,WW=200,VW=201,MW=202,_W=203,w0=204,R0=205,XW=206,YW=207,HW=208,EW=209,FW=210,KW=211,TW=212,zW=213,LW=214,N0=0,W0=1,V0=2,II=3,M0=4,_0=5,X0=6,Y0=7,Rm=0,kW=1,UW=2,zr=0,uS=1,dS=2,IS=3,Xy=4,hS=5,CS=6,AS=7,v2="attached",DW="detached",_u=300,Vl=301,Xu=302,CC=303,am=304,wC=306,sm=1e3,Ca=1001,om=1002,Ba=1003,fS=1004,I9=1004,sC=1005,h9=1005,Pn=1006,Hf=1007,C9=1007,Gc=1008,G2=1008,os=1009,Yy=1010,Hy=1011,AC=1012,Nm=1013,fr=1014,$i=1015,Aa=1016,Ey=1017,Fy=1018,fC=1020,mS=35902,pS=35899,bS=1021,yS=1022,Sa=1023,Rc=1026,Nu=1027,Wm=1028,Vm=1029,hI=1030,Ky=1031,A9=1032,Ty=1033,Ef=33776,Ff=33777,Kf=33778,Tf=33779,H0=35840,E0=35841,F0=35842,K0=35843,T0=36196,z0=37492,L0=37496,k0=37488,U0=37489,D0=37490,O0=37491,j0=37808,J0=37809,P0=37810,Q0=37811,q0=37812,$0=37813,ey=37814,ty=37815,ny=37816,iy=37817,ay=37818,sy=37819,oy=37820,ry=37821,ly=36492,cy=36494,gy=36495,uy=36283,dy=36284,Iy=36285,hy=36286,OW=2200,jW=2201,JW=2202,rm=2300,Cy=2301,f0=2302,iI=2400,aI=2401,lm=2402,zy=2500,vS=2501,f9=0,m9=1,p9=2,PW=3200,QW=3201,b9=3202,y9=3203,Ku=0,qW=1,vg="",Bs="srgb",Ml="srgb-linear",cm="linear",bi="srgb",v9="",G9="rg",B9="ga",S9=0,jd=7680,x9=7681,Z9=7682,w9=7683,R9=34055,N9=34056,W9=5386,V9=512,M9=513,_9=514,X9=515,Y9=516,H9=517,E9=518,B2=519,$W=512,eV=513,tV=514,Ly=515,nV=516,iV=517,ky=518,aV=519,gm=35044,sV=35048,F9=35040,K9=35045,T9=35049,z9=35041,L9=35046,k9=35050,U9=35042,D9="100",S2="300 es",Ir=2e3,mC=2001,O9={COMPUTE:"compute",RENDER:"render"},j9={PERSPECTIVE:"perspective",LINEAR:"linear",FLAT:"flat"},J9={NORMAL:"normal",CENTROID:"centroid",SAMPLE:"sample",FIRST:"first",EITHER:"either"};function oV(a){for(let e=a.length-1;e>=0;--e)if(a[e]>=65535)return!0;return!1}const P9={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function oC(a,e){return new P9[a](e)}function rV(a){return ArrayBuffer.isView(a)&&!(a instanceof DataView)}function um(a){return document.createElementNS("http://www.w3.org/1999/xhtml",a)}function lV(){const a=um("canvas");return a.style.display="block",a}const Zw={};let Yu=null;function Q9(a){Yu=a}function q9(){return Yu}function dm(...a){const e="THREE."+a.shift();Yu?Yu("log",e,...a):console.log(e,...a)}function Qt(...a){const e="THREE."+a.shift();Yu?Yu("warn",e,...a):console.warn(e,...a)}function Cn(...a){const e="THREE."+a.shift();Yu?Yu("error",e,...a):console.error(e,...a)}function pC(...a){const e=a.join(" ");e in Zw||(Zw[e]=!0,Qt(...a))}function $9(a,e,t){return new Promise(function(n,i){function s(){switch(a.clientWaitSync(e,a.SYNC_FLUSH_COMMANDS_BIT,0)){case a.WAIT_FAILED:i();break;case a.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}let Nc=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}};const Fs=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let ww=1234567;const cI=Math.PI/180,bC=180/Math.PI;function Cr(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Fs[a&255]+Fs[a>>8&255]+Fs[a>>16&255]+Fs[a>>24&255]+"-"+Fs[e&255]+Fs[e>>8&255]+"-"+Fs[e>>16&15|64]+Fs[e>>24&255]+"-"+Fs[t&63|128]+Fs[t>>8&255]+"-"+Fs[t>>16&255]+Fs[t>>24&255]+Fs[n&255]+Fs[n>>8&255]+Fs[n>>16&255]+Fs[n>>24&255]).toLowerCase()}function Zn(a,e,t){return Math.max(e,Math.min(t,a))}function GS(a,e){return(a%e+e)%e}function eF(a,e,t,n,i){return n+(a-e)*(i-n)/(t-e)}function tF(a,e,t){return a!==e?(t-a)/(e-a):0}function zf(a,e,t){return(1-t)*a+t*e}function nF(a,e,t,n){return zf(a,e,1-Math.exp(-t*n))}function iF(a,e=1){return e-Math.abs(GS(a,e*2)-e)}function aF(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*(3-2*a))}function sF(a,e,t){return a<=e?0:a>=t?1:(a=(a-e)/(t-e),a*a*a*(a*(a*6-15)+10))}function oF(a,e){return a+Math.floor(Math.random()*(e-a+1))}function rF(a,e){return a+Math.random()*(e-a)}function lF(a){return a*(.5-Math.random())}function cF(a){a!==void 0&&(ww=a);let e=ww+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function gF(a){return a*cI}function uF(a){return a*bC}function dF(a){return(a&a-1)===0&&a!==0}function IF(a){return Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function hF(a){return Math.pow(2,Math.floor(Math.log(a)/Math.LN2))}function CF(a,e,t,n,i){const s=Math.cos,o=Math.sin,l=s(t/2),c=o(t/2),u=s((e+n)/2),h=o((e+n)/2),A=s((e-n)/2),f=o((e-n)/2),p=s((n-e)/2),y=o((n-e)/2);switch(i){case"XYX":a.set(l*h,c*A,c*f,l*u);break;case"YZY":a.set(c*f,l*h,c*A,l*u);break;case"ZXZ":a.set(c*A,c*f,l*h,l*u);break;case"XZX":a.set(l*h,c*y,c*p,l*u);break;case"YXY":a.set(c*p,l*h,c*y,l*u);break;case"ZYZ":a.set(c*y,c*p,l*h,l*u);break;default:Qt("MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function bo(a,e){switch(e.constructor){case Float32Array:return a;case Uint32Array:return a/4294967295;case Uint16Array:return a/65535;case Uint8Array:return a/255;case Int32Array:return Math.max(a/2147483647,-1);case Int16Array:return Math.max(a/32767,-1);case Int8Array:return Math.max(a/127,-1);default:throw new Error("Invalid component type.")}}function Hn(a,e){switch(e.constructor){case Float32Array:return a;case Uint32Array:return Math.round(a*4294967295);case Uint16Array:return Math.round(a*65535);case Uint8Array:return Math.round(a*255);case Int32Array:return Math.round(a*2147483647);case Int16Array:return Math.round(a*32767);case Int8Array:return Math.round(a*127);default:throw new Error("Invalid component type.")}}const cV={DEG2RAD:cI,RAD2DEG:bC,generateUUID:Cr,clamp:Zn,euclideanModulo:GS,mapLinear:eF,inverseLerp:tF,lerp:zf,damp:nF,pingpong:iF,smoothstep:aF,smootherstep:sF,randInt:oF,randFloat:rF,randFloatSpread:lF,seededRandom:cF,degToRad:gF,radToDeg:uF,isPowerOfTwo:dF,ceilPowerOfTwo:IF,floorPowerOfTwo:hF,setQuaternionFromProperEuler:CF,normalize:Hn,denormalize:bo};class yt{constructor(e=0,t=0){yt.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Zn(this.x,e.x,t.x),this.y=Zn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=Zn(this.x,e,t),this.y=Zn(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Zn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Zn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*n-o*i+e.x,this.y=s*i+o*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}let xa=class{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,o,l){let c=n[i+0],u=n[i+1],h=n[i+2],A=n[i+3],f=s[o+0],p=s[o+1],y=s[o+2],G=s[o+3];if(l<=0){e[t+0]=c,e[t+1]=u,e[t+2]=h,e[t+3]=A;return}if(l>=1){e[t+0]=f,e[t+1]=p,e[t+2]=y,e[t+3]=G;return}if(A!==G||c!==f||u!==p||h!==y){let B=c*f+u*p+h*y+A*G;B<0&&(f=-f,p=-p,y=-y,G=-G,B=-B);let S=1-l;if(B<.9995){const N=Math.acos(B),R=Math.sin(N);S=Math.sin(S*N)/R,l=Math.sin(l*N)/R,c=c*S+f*l,u=u*S+p*l,h=h*S+y*l,A=A*S+G*l}else{c=c*S+f*l,u=u*S+p*l,h=h*S+y*l,A=A*S+G*l;const N=1/Math.sqrt(c*c+u*u+h*h+A*A);c*=N,u*=N,h*=N,A*=N}}e[t]=c,e[t+1]=u,e[t+2]=h,e[t+3]=A}static multiplyQuaternionsFlat(e,t,n,i,s,o){const l=n[i],c=n[i+1],u=n[i+2],h=n[i+3],A=s[o],f=s[o+1],p=s[o+2],y=s[o+3];return e[t]=l*y+h*A+c*p-u*f,e[t+1]=c*y+h*f+u*A-l*p,e[t+2]=u*y+h*p+l*f-c*A,e[t+3]=h*y-l*A-c*f-u*p,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,s=e._z,o=e._order,l=Math.cos,c=Math.sin,u=l(n/2),h=l(i/2),A=l(s/2),f=c(n/2),p=c(i/2),y=c(s/2);switch(o){case"XYZ":this._x=f*h*A+u*p*y,this._y=u*p*A-f*h*y,this._z=u*h*y+f*p*A,this._w=u*h*A-f*p*y;break;case"YXZ":this._x=f*h*A+u*p*y,this._y=u*p*A-f*h*y,this._z=u*h*y-f*p*A,this._w=u*h*A+f*p*y;break;case"ZXY":this._x=f*h*A-u*p*y,this._y=u*p*A+f*h*y,this._z=u*h*y+f*p*A,this._w=u*h*A-f*p*y;break;case"ZYX":this._x=f*h*A-u*p*y,this._y=u*p*A+f*h*y,this._z=u*h*y-f*p*A,this._w=u*h*A+f*p*y;break;case"YZX":this._x=f*h*A+u*p*y,this._y=u*p*A+f*h*y,this._z=u*h*y-f*p*A,this._w=u*h*A-f*p*y;break;case"XZY":this._x=f*h*A-u*p*y,this._y=u*p*A-f*h*y,this._z=u*h*y+f*p*A,this._w=u*h*A+f*p*y;break;default:Qt("Quaternion: .setFromEuler() encountered an unknown order: "+o)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],o=t[1],l=t[5],c=t[9],u=t[2],h=t[6],A=t[10],f=n+l+A;if(f>0){const p=.5/Math.sqrt(f+1);this._w=.25/p,this._x=(h-c)*p,this._y=(s-u)*p,this._z=(o-i)*p}else if(n>l&&n>A){const p=2*Math.sqrt(1+n-l-A);this._w=(h-c)/p,this._x=.25*p,this._y=(i+o)/p,this._z=(s+u)/p}else if(l>A){const p=2*Math.sqrt(1+l-n-A);this._w=(s-u)/p,this._x=(i+o)/p,this._y=.25*p,this._z=(c+h)/p}else{const p=2*Math.sqrt(1+A-n-l);this._w=(o-i)/p,this._x=(s+u)/p,this._y=(c+h)/p,this._z=.25*p}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<1e-8?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Zn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,o=e._w,l=t._x,c=t._y,u=t._z,h=t._w;return this._x=n*h+o*l+i*u-s*c,this._y=i*h+o*c+s*l-n*u,this._z=s*h+o*u+n*c-i*l,this._w=o*h-n*l-i*c-s*u,this._onChangeCallback(),this}slerp(e,t){if(t<=0)return this;if(t>=1)return this.copy(e);let n=e._x,i=e._y,s=e._z,o=e._w,l=this.dot(e);l<0&&(n=-n,i=-i,s=-s,o=-o,l=-l);let c=1-t;if(l<.9995){const u=Math.acos(l),h=Math.sin(u);c=Math.sin(c*u)/h,t=Math.sin(t*u)/h,this._x=this._x*c+n*t,this._y=this._y*c+i*t,this._z=this._z*c+s*t,this._w=this._w*c+o*t,this._onChangeCallback()}else this._x=this._x*c+n*t,this._y=this._y*c+i*t,this._z=this._z*c+s*t,this._w=this._w*c+o*t,this.normalize();return this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}};class ue{constructor(e=0,t=0,n=0){ue.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(Rw.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(Rw.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,o=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*o,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*o,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*o,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z,c=e.w,u=2*(o*i-l*n),h=2*(l*t-s*i),A=2*(s*n-o*t);return this.x=t+c*u+o*A-l*h,this.y=n+c*h+l*u-s*A,this.z=i+c*A+s*h-o*u,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Zn(this.x,e.x,t.x),this.y=Zn(this.y,e.y,t.y),this.z=Zn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=Zn(this.x,e,t),this.y=Zn(this.y,e,t),this.z=Zn(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Zn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,o=t.x,l=t.y,c=t.z;return this.x=i*c-s*l,this.y=s*o-n*c,this.z=n*l-i*o,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return WG.copy(this).projectOnVector(e),this.sub(WG)}reflect(e){return this.sub(WG.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(Zn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const WG=new ue,Rw=new xa;class Vn{constructor(e,t,n,i,s,o,l,c,u){Vn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,l,c,u)}set(e,t,n,i,s,o,l,c,u){const h=this.elements;return h[0]=e,h[1]=i,h[2]=l,h[3]=t,h[4]=s,h[5]=c,h[6]=n,h[7]=o,h[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],l=n[3],c=n[6],u=n[1],h=n[4],A=n[7],f=n[2],p=n[5],y=n[8],G=i[0],B=i[3],S=i[6],N=i[1],R=i[4],w=i[7],V=i[2],H=i[5],X=i[8];return s[0]=o*G+l*N+c*V,s[3]=o*B+l*R+c*H,s[6]=o*S+l*w+c*X,s[1]=u*G+h*N+A*V,s[4]=u*B+h*R+A*H,s[7]=u*S+h*w+A*X,s[2]=f*G+p*N+y*V,s[5]=f*B+p*R+y*H,s[8]=f*S+p*w+y*X,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8];return t*o*h-t*l*u-n*s*h+n*l*c+i*s*u-i*o*c}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=h*o-l*u,f=l*c-h*s,p=u*s-o*c,y=t*A+n*f+i*p;if(y===0)return this.set(0,0,0,0,0,0,0,0,0);const G=1/y;return e[0]=A*G,e[1]=(i*u-h*n)*G,e[2]=(l*n-i*o)*G,e[3]=f*G,e[4]=(h*t-i*c)*G,e[5]=(i*s-l*t)*G,e[6]=p*G,e[7]=(n*c-u*t)*G,e[8]=(o*t-n*s)*G,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,o,l){const c=Math.cos(s),u=Math.sin(s);return this.set(n*c,n*u,-n*(c*o+u*l)+o+e,-i*u,i*c,-i*(-u*o+c*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(VG.makeScale(e,t)),this}rotate(e){return this.premultiply(VG.makeRotation(-e)),this}translate(e,t){return this.premultiply(VG.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const VG=new Vn,Nw=new Vn().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),Ww=new Vn().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function AF(){const a={enabled:!0,workingColorSpace:Ml,spaces:{},convert:function(i,s,o){return this.enabled===!1||s===o||!s||!o||(this.spaces[s].transfer===bi&&(i.r=Zg(i.r),i.g=Zg(i.g),i.b=Zg(i.b)),this.spaces[s].primaries!==this.spaces[o].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[o].fromXYZ)),this.spaces[o].transfer===bi&&(i.r=uC(i.r),i.g=uC(i.g),i.b=uC(i.b))),i},workingToColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},colorSpaceToWorking:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===vg?cm:this.spaces[i].transfer},getToneMappingMode:function(i){return this.spaces[i].outputColorSpaceConfig.toneMappingMode||"standard"},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,o){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[o].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace},fromWorkingColorSpace:function(i,s){return pC("ColorManagement: .fromWorkingColorSpace() has been renamed to .workingToColorSpace()."),a.workingToColorSpace(i,s)},toWorkingColorSpace:function(i,s){return pC("ColorManagement: .toWorkingColorSpace() has been renamed to .colorSpaceToWorking()."),a.colorSpaceToWorking(i,s)}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return a.define({[Ml]:{primaries:e,whitePoint:n,transfer:cm,toXYZ:Nw,fromXYZ:Ww,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:Bs},outputColorSpaceConfig:{drawingBufferColorSpace:Bs}},[Bs]:{primaries:e,whitePoint:n,transfer:bi,toXYZ:Nw,fromXYZ:Ww,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:Bs}}}),a}const ei=AF();function Zg(a){return a<.04045?a*.0773993808:Math.pow(a*.9478672986+.0521327014,2.4)}function uC(a){return a<.0031308?a*12.92:1.055*Math.pow(a,.41666)-.055}let wh;class gV{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{wh===void 0&&(wh=um("canvas")),wh.width=e.width,wh.height=e.height;const i=wh.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=wh}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=um("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let o=0;o<s.length;o++)s[o]=Zg(s[o]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Zg(t[n]/255)*255):t[n]=Zg(t[n]);return{data:t,width:e.width,height:e.height}}else return Qt("ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let fF=0;class Wu{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:fF++}),this.uuid=Cr(),this.data=e,this.dataReady=!0,this.version=0}getSize(e){const t=this.data;return typeof HTMLVideoElement<"u"&&t instanceof HTMLVideoElement?e.set(t.videoWidth,t.videoHeight,0):typeof VideoFrame<"u"&&t instanceof VideoFrame?e.set(t.displayHeight,t.displayWidth,0):t!==null?e.set(t.width,t.height,t.depth||0):e.set(0,0,0),e}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let o=0,l=i.length;o<l;o++)i[o].isDataTexture?s.push(MG(i[o].image)):s.push(MG(i[o]))}else s=MG(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function MG(a){return typeof HTMLImageElement<"u"&&a instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&a instanceof ImageBitmap?gV.getDataURL(a):a.data?{data:Array.from(a.data),width:a.width,height:a.height,type:a.data.constructor.name}:(Qt("Texture: Unable to serialize Texture."),{})}let mF=0;const _G=new ue;class fi extends Nc{constructor(e=fi.DEFAULT_IMAGE,t=fi.DEFAULT_MAPPING,n=Ca,i=Ca,s=Pn,o=Gc,l=Sa,c=os,u=fi.DEFAULT_ANISOTROPY,h=vg){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:mF++}),this.uuid=Cr(),this.name="",this.source=new Wu(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=o,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new yt(0,0),this.repeat=new yt(1,1),this.center=new yt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Vn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=h,this.userData={},this.updateRanges=[],this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.isArrayTexture=!!(e&&e.depth&&e.depth>1),this.pmremVersion=0}get width(){return this.source.getSize(_G).x}get height(){return this.source.getSize(_G).y}get depth(){return this.source.getSize(_G).z}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.isArrayTexture=e.isArrayTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}setValues(e){for(const t in e){const n=e[t];if(n===void 0){Qt(`Texture.setValues(): parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Qt(`Texture.setValues(): property '${t}' does not exist.`);continue}i&&n&&i.isVector2&&n.isVector2||i&&n&&i.isVector3&&n.isVector3||i&&n&&i.isMatrix3&&n.isMatrix3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.7,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==_u)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case sm:e.x=e.x-Math.floor(e.x);break;case Ca:e.x=e.x<0?0:1;break;case om:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case sm:e.y=e.y-Math.floor(e.y);break;case Ca:e.y=e.y<0?0:1;break;case om:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}fi.DEFAULT_IMAGE=null;fi.DEFAULT_MAPPING=_u;fi.DEFAULT_ANISOTROPY=1;class ri{constructor(e=0,t=0,n=0,i=1){ri.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*n+o[8]*i+o[12]*s,this.y=o[1]*t+o[5]*n+o[9]*i+o[13]*s,this.z=o[2]*t+o[6]*n+o[10]*i+o[14]*s,this.w=o[3]*t+o[7]*n+o[11]*i+o[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const c=e.elements,u=c[0],h=c[4],A=c[8],f=c[1],p=c[5],y=c[9],G=c[2],B=c[6],S=c[10];if(Math.abs(h-f)<.01&&Math.abs(A-G)<.01&&Math.abs(y-B)<.01){if(Math.abs(h+f)<.1&&Math.abs(A+G)<.1&&Math.abs(y+B)<.1&&Math.abs(u+p+S-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const R=(u+1)/2,w=(p+1)/2,V=(S+1)/2,H=(h+f)/4,X=(A+G)/4,Y=(y+B)/4;return R>w&&R>V?R<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(R),i=H/n,s=X/n):w>V?w<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(w),n=H/i,s=Y/i):V<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(V),n=X/s,i=Y/s),this.set(n,i,s,t),this}let N=Math.sqrt((B-y)*(B-y)+(A-G)*(A-G)+(f-h)*(f-h));return Math.abs(N)<.001&&(N=1),this.x=(B-y)/N,this.y=(A-G)/N,this.z=(f-h)/N,this.w=Math.acos((u+p+S-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Zn(this.x,e.x,t.x),this.y=Zn(this.y,e.y,t.y),this.z=Zn(this.z,e.z,t.z),this.w=Zn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=Zn(this.x,e,t),this.y=Zn(this.y,e,t),this.z=Zn(this.z,e,t),this.w=Zn(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(Zn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class BS extends Nc{constructor(e=1,t=1,n={}){super(),n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Pn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1,depth:1,multiview:!1},n),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=n.depth,this.scissor=new ri(0,0,e,t),this.scissorTest=!1,this.viewport=new ri(0,0,e,t);const i={width:e,height:t,depth:n.depth},s=new fi(i);this.textures=[];const o=n.count;for(let l=0;l<o;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0,this.textures[l].renderTarget=this;this._setTextureOptions(n),this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=null,this.depthTexture=n.depthTexture,this.samples=n.samples,this.multiview=n.multiview}_setTextureOptions(e={}){const t={minFilter:Pn,generateMipmaps:!1,flipY:!1,internalFormat:null};e.mapping!==void 0&&(t.mapping=e.mapping),e.wrapS!==void 0&&(t.wrapS=e.wrapS),e.wrapT!==void 0&&(t.wrapT=e.wrapT),e.wrapR!==void 0&&(t.wrapR=e.wrapR),e.magFilter!==void 0&&(t.magFilter=e.magFilter),e.minFilter!==void 0&&(t.minFilter=e.minFilter),e.format!==void 0&&(t.format=e.format),e.type!==void 0&&(t.type=e.type),e.anisotropy!==void 0&&(t.anisotropy=e.anisotropy),e.colorSpace!==void 0&&(t.colorSpace=e.colorSpace),e.flipY!==void 0&&(t.flipY=e.flipY),e.generateMipmaps!==void 0&&(t.generateMipmaps=e.generateMipmaps),e.internalFormat!==void 0&&(t.internalFormat=e.internalFormat);for(let n=0;n<this.textures.length;n++)this.textures[n].setValues(t)}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n,this.textures[i].isData3DTexture!==!0&&(this.textures[i].isArrayTexture=this.textures[i].image.depth>1);this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new Wu(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class yo extends BS{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Uy extends fi{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ba,this.minFilter=Ba,this.wrapR=Ca,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class pF extends yo{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Uy(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Dy extends fi{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Ba,this.minFilter=Ba,this.wrapR=Ca,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class bF extends yo{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new Dy(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class Za{constructor(e=new ue(1/0,1/0,1/0),t=new ue(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(bl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(bl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=bl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let o=0,l=s.count;o<l;o++)e.isMesh===!0?e.getVertexPosition(o,bl):bl.fromBufferAttribute(s,o),bl.applyMatrix4(e.matrixWorld),this.expandByPoint(bl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),lb.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),lb.copy(n.boundingBox)),lb.applyMatrix4(e.matrixWorld),this.union(lb)}const i=e.children;for(let s=0,o=i.length;s<o;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,bl),bl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(sf),cb.subVectors(this.max,sf),Rh.subVectors(e.a,sf),Nh.subVectors(e.b,sf),Wh.subVectors(e.c,sf),Au.subVectors(Nh,Rh),fu.subVectors(Wh,Nh),Rd.subVectors(Rh,Wh);let t=[0,-Au.z,Au.y,0,-fu.z,fu.y,0,-Rd.z,Rd.y,Au.z,0,-Au.x,fu.z,0,-fu.x,Rd.z,0,-Rd.x,-Au.y,Au.x,0,-fu.y,fu.x,0,-Rd.y,Rd.x,0];return!XG(t,Rh,Nh,Wh,cb)||(t=[1,0,0,0,1,0,0,0,1],!XG(t,Rh,Nh,Wh,cb))?!1:(gb.crossVectors(Au,fu),t=[gb.x,gb.y,gb.z],XG(t,Rh,Nh,Wh,cb))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,bl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(bl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Ig[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Ig[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Ig[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Ig[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Ig[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Ig[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Ig[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Ig[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Ig),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}toJSON(){return{min:this.min.toArray(),max:this.max.toArray()}}fromJSON(e){return this.min.fromArray(e.min),this.max.fromArray(e.max),this}}const Ig=[new ue,new ue,new ue,new ue,new ue,new ue,new ue,new ue],bl=new ue,lb=new Za,Rh=new ue,Nh=new ue,Wh=new ue,Au=new ue,fu=new ue,Rd=new ue,sf=new ue,cb=new ue,gb=new ue,Nd=new ue;function XG(a,e,t,n,i){for(let s=0,o=a.length-3;s<=o;s+=3){Nd.fromArray(a,s);const l=i.x*Math.abs(Nd.x)+i.y*Math.abs(Nd.y)+i.z*Math.abs(Nd.z),c=e.dot(Nd),u=t.dot(Nd),h=n.dot(Nd);if(Math.max(-Math.max(c,u,h),Math.min(c,u,h))>l)return!1}return!0}const yF=new Za,of=new ue,YG=new ue;class Ha{constructor(e=new ue,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):yF.setFromPoints(e).getCenter(n);let i=0;for(let s=0,o=e.length;s<o;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;of.subVectors(e,this.center);const t=of.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(of,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(YG.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(of.copy(e.center).add(YG)),this.expandByPoint(of.copy(e.center).sub(YG))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}toJSON(){return{radius:this.radius,center:this.center.toArray()}}fromJSON(e){return this.radius=e.radius,this.center.fromArray(e.center),this}}const hg=new ue,HG=new ue,ub=new ue,mu=new ue,EG=new ue,db=new ue,FG=new ue;let pI=class{constructor(e=new ue,t=new ue(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,hg)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=hg.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(hg.copy(this.origin).addScaledVector(this.direction,t),hg.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){HG.copy(e).add(t).multiplyScalar(.5),ub.copy(t).sub(e).normalize(),mu.copy(this.origin).sub(HG);const s=e.distanceTo(t)*.5,o=-this.direction.dot(ub),l=mu.dot(this.direction),c=-mu.dot(ub),u=mu.lengthSq(),h=Math.abs(1-o*o);let A,f,p,y;if(h>0)if(A=o*c-l,f=o*l-c,y=s*h,A>=0)if(f>=-y)if(f<=y){const G=1/h;A*=G,f*=G,p=A*(A+o*f+2*l)+f*(o*A+f+2*c)+u}else f=s,A=Math.max(0,-(o*f+l)),p=-A*A+f*(f+2*c)+u;else f=-s,A=Math.max(0,-(o*f+l)),p=-A*A+f*(f+2*c)+u;else f<=-y?(A=Math.max(0,-(-o*s+l)),f=A>0?-s:Math.min(Math.max(-s,-c),s),p=-A*A+f*(f+2*c)+u):f<=y?(A=0,f=Math.min(Math.max(-s,-c),s),p=f*(f+2*c)+u):(A=Math.max(0,-(o*s+l)),f=A>0?s:Math.min(Math.max(-s,-c),s),p=-A*A+f*(f+2*c)+u);else f=o>0?-s:s,A=Math.max(0,-(o*f+l)),p=-A*A+f*(f+2*c)+u;return n&&n.copy(this.origin).addScaledVector(this.direction,A),i&&i.copy(HG).addScaledVector(ub,f),p}intersectSphere(e,t){hg.subVectors(e.center,this.origin);const n=hg.dot(this.direction),i=hg.dot(hg)-n*n,s=e.radius*e.radius;if(i>s)return null;const o=Math.sqrt(s-i),l=n-o,c=n+o;return c<0?null:l<0?this.at(c,t):this.at(l,t)}intersectsSphere(e){return e.radius<0?!1:this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,o,l,c;const u=1/this.direction.x,h=1/this.direction.y,A=1/this.direction.z,f=this.origin;return u>=0?(n=(e.min.x-f.x)*u,i=(e.max.x-f.x)*u):(n=(e.max.x-f.x)*u,i=(e.min.x-f.x)*u),h>=0?(s=(e.min.y-f.y)*h,o=(e.max.y-f.y)*h):(s=(e.max.y-f.y)*h,o=(e.min.y-f.y)*h),n>o||s>i||((s>n||isNaN(n))&&(n=s),(o<i||isNaN(i))&&(i=o),A>=0?(l=(e.min.z-f.z)*A,c=(e.max.z-f.z)*A):(l=(e.max.z-f.z)*A,c=(e.min.z-f.z)*A),n>c||l>i)||((l>n||n!==n)&&(n=l),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,hg)!==null}intersectTriangle(e,t,n,i,s){EG.subVectors(t,e),db.subVectors(n,e),FG.crossVectors(EG,db);let o=this.direction.dot(FG),l;if(o>0){if(i)return null;l=1}else if(o<0)l=-1,o=-o;else return null;mu.subVectors(this.origin,e);const c=l*this.direction.dot(db.crossVectors(mu,db));if(c<0)return null;const u=l*this.direction.dot(EG.cross(mu));if(u<0||c+u>o)return null;const h=-l*mu.dot(FG);return h<0?null:this.at(h/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}};class pn{constructor(e,t,n,i,s,o,l,c,u,h,A,f,p,y,G,B){pn.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,o,l,c,u,h,A,f,p,y,G,B)}set(e,t,n,i,s,o,l,c,u,h,A,f,p,y,G,B){const S=this.elements;return S[0]=e,S[4]=t,S[8]=n,S[12]=i,S[1]=s,S[5]=o,S[9]=l,S[13]=c,S[2]=u,S[6]=h,S[10]=A,S[14]=f,S[3]=p,S[7]=y,S[11]=G,S[15]=B,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new pn().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return this.determinant()===0?(e.set(1,0,0),t.set(0,1,0),n.set(0,0,1),this):(e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this)}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){if(e.determinant()===0)return this.identity();const t=this.elements,n=e.elements,i=1/Vh.setFromMatrixColumn(e,0).length(),s=1/Vh.setFromMatrixColumn(e,1).length(),o=1/Vh.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*o,t[9]=n[9]*o,t[10]=n[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,o=Math.cos(n),l=Math.sin(n),c=Math.cos(i),u=Math.sin(i),h=Math.cos(s),A=Math.sin(s);if(e.order==="XYZ"){const f=o*h,p=o*A,y=l*h,G=l*A;t[0]=c*h,t[4]=-c*A,t[8]=u,t[1]=p+y*u,t[5]=f-G*u,t[9]=-l*c,t[2]=G-f*u,t[6]=y+p*u,t[10]=o*c}else if(e.order==="YXZ"){const f=c*h,p=c*A,y=u*h,G=u*A;t[0]=f+G*l,t[4]=y*l-p,t[8]=o*u,t[1]=o*A,t[5]=o*h,t[9]=-l,t[2]=p*l-y,t[6]=G+f*l,t[10]=o*c}else if(e.order==="ZXY"){const f=c*h,p=c*A,y=u*h,G=u*A;t[0]=f-G*l,t[4]=-o*A,t[8]=y+p*l,t[1]=p+y*l,t[5]=o*h,t[9]=G-f*l,t[2]=-o*u,t[6]=l,t[10]=o*c}else if(e.order==="ZYX"){const f=o*h,p=o*A,y=l*h,G=l*A;t[0]=c*h,t[4]=y*u-p,t[8]=f*u+G,t[1]=c*A,t[5]=G*u+f,t[9]=p*u-y,t[2]=-u,t[6]=l*c,t[10]=o*c}else if(e.order==="YZX"){const f=o*c,p=o*u,y=l*c,G=l*u;t[0]=c*h,t[4]=G-f*A,t[8]=y*A+p,t[1]=A,t[5]=o*h,t[9]=-l*h,t[2]=-u*h,t[6]=p*A+y,t[10]=f-G*A}else if(e.order==="XZY"){const f=o*c,p=o*u,y=l*c,G=l*u;t[0]=c*h,t[4]=-A,t[8]=u*h,t[1]=f*A+G,t[5]=o*h,t[9]=p*A-y,t[2]=y*A-p,t[6]=l*h,t[10]=G*A+f}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(vF,e,GF)}lookAt(e,t,n){const i=this.elements;return rr.subVectors(e,t),rr.lengthSq()===0&&(rr.z=1),rr.normalize(),pu.crossVectors(n,rr),pu.lengthSq()===0&&(Math.abs(n.z)===1?rr.x+=1e-4:rr.z+=1e-4,rr.normalize(),pu.crossVectors(n,rr)),pu.normalize(),Ib.crossVectors(rr,pu),i[0]=pu.x,i[4]=Ib.x,i[8]=rr.x,i[1]=pu.y,i[5]=Ib.y,i[9]=rr.y,i[2]=pu.z,i[6]=Ib.z,i[10]=rr.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,o=n[0],l=n[4],c=n[8],u=n[12],h=n[1],A=n[5],f=n[9],p=n[13],y=n[2],G=n[6],B=n[10],S=n[14],N=n[3],R=n[7],w=n[11],V=n[15],H=i[0],X=i[4],Y=i[8],M=i[12],E=i[1],O=i[5],P=i[9],q=i[13],k=i[2],le=i[6],F=i[10],j=i[14],Q=i[3],ce=i[7],oe=i[11],T=i[15];return s[0]=o*H+l*E+c*k+u*Q,s[4]=o*X+l*O+c*le+u*ce,s[8]=o*Y+l*P+c*F+u*oe,s[12]=o*M+l*q+c*j+u*T,s[1]=h*H+A*E+f*k+p*Q,s[5]=h*X+A*O+f*le+p*ce,s[9]=h*Y+A*P+f*F+p*oe,s[13]=h*M+A*q+f*j+p*T,s[2]=y*H+G*E+B*k+S*Q,s[6]=y*X+G*O+B*le+S*ce,s[10]=y*Y+G*P+B*F+S*oe,s[14]=y*M+G*q+B*j+S*T,s[3]=N*H+R*E+w*k+V*Q,s[7]=N*X+R*O+w*le+V*ce,s[11]=N*Y+R*P+w*F+V*oe,s[15]=N*M+R*q+w*j+V*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],o=e[1],l=e[5],c=e[9],u=e[13],h=e[2],A=e[6],f=e[10],p=e[14],y=e[3],G=e[7],B=e[11],S=e[15],N=c*p-u*f,R=l*p-u*A,w=l*f-c*A,V=o*p-u*h,H=o*f-c*h,X=o*A-l*h;return t*(G*N-B*R+S*w)-n*(y*N-B*V+S*H)+i*(y*R-G*V+S*X)-s*(y*w-G*H+B*X)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],o=e[4],l=e[5],c=e[6],u=e[7],h=e[8],A=e[9],f=e[10],p=e[11],y=e[12],G=e[13],B=e[14],S=e[15],N=A*B*u-G*f*u+G*c*p-l*B*p-A*c*S+l*f*S,R=y*f*u-h*B*u-y*c*p+o*B*p+h*c*S-o*f*S,w=h*G*u-y*A*u+y*l*p-o*G*p-h*l*S+o*A*S,V=y*A*c-h*G*c-y*l*f+o*G*f+h*l*B-o*A*B,H=t*N+n*R+i*w+s*V;if(H===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const X=1/H;return e[0]=N*X,e[1]=(G*f*s-A*B*s-G*i*p+n*B*p+A*i*S-n*f*S)*X,e[2]=(l*B*s-G*c*s+G*i*u-n*B*u-l*i*S+n*c*S)*X,e[3]=(A*c*s-l*f*s-A*i*u+n*f*u+l*i*p-n*c*p)*X,e[4]=R*X,e[5]=(h*B*s-y*f*s+y*i*p-t*B*p-h*i*S+t*f*S)*X,e[6]=(y*c*s-o*B*s-y*i*u+t*B*u+o*i*S-t*c*S)*X,e[7]=(o*f*s-h*c*s+h*i*u-t*f*u-o*i*p+t*c*p)*X,e[8]=w*X,e[9]=(y*A*s-h*G*s-y*n*p+t*G*p+h*n*S-t*A*S)*X,e[10]=(o*G*s-y*l*s+y*n*u-t*G*u-o*n*S+t*l*S)*X,e[11]=(h*l*s-o*A*s-h*n*u+t*A*u+o*n*p-t*l*p)*X,e[12]=V*X,e[13]=(h*G*i-y*A*i+y*n*f-t*G*f-h*n*B+t*A*B)*X,e[14]=(y*l*i-o*G*i-y*n*c+t*G*c+o*n*B-t*l*B)*X,e[15]=(o*A*i-h*l*i+h*n*c-t*A*c-o*n*f+t*l*f)*X,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,o=e.x,l=e.y,c=e.z,u=s*o,h=s*l;return this.set(u*o+n,u*l-i*c,u*c+i*l,0,u*l+i*c,h*l+n,h*c-i*o,0,u*c-i*l,h*c+i*o,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,o){return this.set(1,n,s,0,e,1,o,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,o=t._y,l=t._z,c=t._w,u=s+s,h=o+o,A=l+l,f=s*u,p=s*h,y=s*A,G=o*h,B=o*A,S=l*A,N=c*u,R=c*h,w=c*A,V=n.x,H=n.y,X=n.z;return i[0]=(1-(G+S))*V,i[1]=(p+w)*V,i[2]=(y-R)*V,i[3]=0,i[4]=(p-w)*H,i[5]=(1-(f+S))*H,i[6]=(B+N)*H,i[7]=0,i[8]=(y+R)*X,i[9]=(B-N)*X,i[10]=(1-(f+G))*X,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;if(e.x=i[12],e.y=i[13],e.z=i[14],this.determinant()===0)return n.set(1,1,1),t.identity(),this;let s=Vh.set(i[0],i[1],i[2]).length();const o=Vh.set(i[4],i[5],i[6]).length(),l=Vh.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),yl.copy(this);const u=1/s,h=1/o,A=1/l;return yl.elements[0]*=u,yl.elements[1]*=u,yl.elements[2]*=u,yl.elements[4]*=h,yl.elements[5]*=h,yl.elements[6]*=h,yl.elements[8]*=A,yl.elements[9]*=A,yl.elements[10]*=A,t.setFromRotationMatrix(yl),n.x=s,n.y=o,n.z=l,this}makePerspective(e,t,n,i,s,o,l=Ir,c=!1){const u=this.elements,h=2*s/(t-e),A=2*s/(n-i),f=(t+e)/(t-e),p=(n+i)/(n-i);let y,G;if(c)y=s/(o-s),G=o*s/(o-s);else if(l===Ir)y=-(o+s)/(o-s),G=-2*o*s/(o-s);else if(l===mC)y=-o/(o-s),G=-o*s/(o-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return u[0]=h,u[4]=0,u[8]=f,u[12]=0,u[1]=0,u[5]=A,u[9]=p,u[13]=0,u[2]=0,u[6]=0,u[10]=y,u[14]=G,u[3]=0,u[7]=0,u[11]=-1,u[15]=0,this}makeOrthographic(e,t,n,i,s,o,l=Ir,c=!1){const u=this.elements,h=2/(t-e),A=2/(n-i),f=-(t+e)/(t-e),p=-(n+i)/(n-i);let y,G;if(c)y=1/(o-s),G=o/(o-s);else if(l===Ir)y=-2/(o-s),G=-(o+s)/(o-s);else if(l===mC)y=-1/(o-s),G=-s/(o-s);else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return u[0]=h,u[4]=0,u[8]=0,u[12]=f,u[1]=0,u[5]=A,u[9]=0,u[13]=p,u[2]=0,u[6]=0,u[10]=y,u[14]=G,u[3]=0,u[7]=0,u[11]=0,u[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Vh=new ue,yl=new pn,vF=new ue(0,0,0),GF=new ue(1,1,1),pu=new ue,Ib=new ue,rr=new ue,Vw=new pn,Mw=new xa;class vo{constructor(e=0,t=0,n=0,i=vo.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],o=i[4],l=i[8],c=i[1],u=i[5],h=i[9],A=i[2],f=i[6],p=i[10];switch(t){case"XYZ":this._y=Math.asin(Zn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-h,p),this._z=Math.atan2(-o,s)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-Zn(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-A,s),this._z=0);break;case"ZXY":this._x=Math.asin(Zn(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-A,p),this._z=Math.atan2(-o,u)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-Zn(A,-1,1)),Math.abs(A)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-o,u));break;case"YZX":this._z=Math.asin(Zn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-h,u),this._y=Math.atan2(-A,s)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-Zn(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-h,p),this._y=0);break;default:Qt("Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return Vw.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Vw,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Mw.setFromEuler(this),this.setFromQuaternion(Mw,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}vo.DEFAULT_ORDER="XYZ";class yC{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let BF=0;const _w=new ue,Mh=new xa,Cg=new pn,hb=new ue,rf=new ue,SF=new ue,xF=new xa,Xw=new ue(1,0,0),Yw=new ue(0,1,0),Hw=new ue(0,0,1),Ew={type:"added"},ZF={type:"removed"},_h={type:"childadded",child:null},KG={type:"childremoved",child:null};class ti extends Nc{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:BF++}),this.uuid=Cr(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ti.DEFAULT_UP.clone();const e=new ue,t=new vo,n=new xa,i=new ue(1,1,1);function s(){n.setFromEuler(t,!1)}function o(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(o),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new pn},normalMatrix:{value:new Vn}}),this.matrix=new pn,this.matrixWorld=new pn,this.matrixAutoUpdate=ti.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ti.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new yC,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Mh.setFromAxisAngle(e,t),this.quaternion.multiply(Mh),this}rotateOnWorldAxis(e,t){return Mh.setFromAxisAngle(e,t),this.quaternion.premultiply(Mh),this}rotateX(e){return this.rotateOnAxis(Xw,e)}rotateY(e){return this.rotateOnAxis(Yw,e)}rotateZ(e){return this.rotateOnAxis(Hw,e)}translateOnAxis(e,t){return _w.copy(e).applyQuaternion(this.quaternion),this.position.add(_w.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Xw,e)}translateY(e){return this.translateOnAxis(Yw,e)}translateZ(e){return this.translateOnAxis(Hw,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Cg.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?hb.copy(e):hb.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),rf.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Cg.lookAt(rf,hb,this.up):Cg.lookAt(hb,rf,this.up),this.quaternion.setFromRotationMatrix(Cg),i&&(Cg.extractRotation(i.matrixWorld),Mh.setFromRotationMatrix(Cg),this.quaternion.premultiply(Mh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(Cn("Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(Ew),_h.child=e,this.dispatchEvent(_h),_h.child=null):Cn("Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(ZF),KG.child=e,this.dispatchEvent(KG),KG.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Cg.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Cg.multiply(e.parent.matrixWorld)),e.applyMatrix4(Cg),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(Ew),_h.child=e,this.dispatchEvent(_h),_h.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const o=this.children[n].getObjectByProperty(e,t);if(o!==void 0)return o}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rf,e,SF),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(rf,xF,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,o=i.length;s<o;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.7,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.geometryInfo=this._geometryInfo.map(l=>({...l,boundingBox:l.boundingBox?l.boundingBox.toJSON():void 0,boundingSphere:l.boundingSphere?l.boundingSphere.toJSON():void 0})),i.instanceInfo=this._instanceInfo.map(l=>({...l})),i.availableInstanceIds=this._availableInstanceIds.slice(),i.availableGeometryIds=this._availableGeometryIds.slice(),i.nextIndexStart=this._nextIndexStart,i.nextVertexStart=this._nextVertexStart,i.geometryCount=this._geometryCount,i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.matricesTexture=this._matricesTexture.toJSON(e),i.indirectTexture=this._indirectTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere=this.boundingSphere.toJSON()),this.boundingBox!==null&&(i.boundingBox=this.boundingBox.toJSON()));function s(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let u=0,h=c.length;u<h;u++){const A=c[u];s(e.shapes,A)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(s(e.materials,this.material[c]));i.material=l}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];i.animations.push(s(e.animations,c))}}if(t){const l=o(e.geometries),c=o(e.materials),u=o(e.textures),h=o(e.images),A=o(e.shapes),f=o(e.skeletons),p=o(e.animations),y=o(e.nodes);l.length>0&&(n.geometries=l),c.length>0&&(n.materials=c),u.length>0&&(n.textures=u),h.length>0&&(n.images=h),A.length>0&&(n.shapes=A),f.length>0&&(n.skeletons=f),p.length>0&&(n.animations=p),y.length>0&&(n.nodes=y)}return n.object=i,n;function o(l){const c=[];for(const u in l){const h=l[u];delete h.metadata,c.push(h)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}ti.DEFAULT_UP=new ue(0,1,0);ti.DEFAULT_MATRIX_AUTO_UPDATE=!0;ti.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const vl=new ue,Ag=new ue,TG=new ue,fg=new ue,Xh=new ue,Yh=new ue,Fw=new ue,zG=new ue,LG=new ue,kG=new ue,UG=new ri,DG=new ri,OG=new ri;class Lo{constructor(e=new ue,t=new ue,n=new ue){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),vl.subVectors(e,t),i.cross(vl);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){vl.subVectors(i,t),Ag.subVectors(n,t),TG.subVectors(e,t);const o=vl.dot(vl),l=vl.dot(Ag),c=vl.dot(TG),u=Ag.dot(Ag),h=Ag.dot(TG),A=o*u-l*l;if(A===0)return s.set(0,0,0),null;const f=1/A,p=(u*c-l*h)*f,y=(o*h-l*c)*f;return s.set(1-p-y,y,p)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,fg)===null?!1:fg.x>=0&&fg.y>=0&&fg.x+fg.y<=1}static getInterpolation(e,t,n,i,s,o,l,c){return this.getBarycoord(e,t,n,i,fg)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,fg.x),c.addScaledVector(o,fg.y),c.addScaledVector(l,fg.z),c)}static getInterpolatedAttribute(e,t,n,i,s,o){return UG.setScalar(0),DG.setScalar(0),OG.setScalar(0),UG.fromBufferAttribute(e,t),DG.fromBufferAttribute(e,n),OG.fromBufferAttribute(e,i),o.setScalar(0),o.addScaledVector(UG,s.x),o.addScaledVector(DG,s.y),o.addScaledVector(OG,s.z),o}static isFrontFacing(e,t,n,i){return vl.subVectors(n,t),Ag.subVectors(e,t),vl.cross(Ag).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return vl.subVectors(this.c,this.b),Ag.subVectors(this.a,this.b),vl.cross(Ag).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Lo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Lo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,s){return Lo.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return Lo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Lo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let o,l;Xh.subVectors(i,n),Yh.subVectors(s,n),zG.subVectors(e,n);const c=Xh.dot(zG),u=Yh.dot(zG);if(c<=0&&u<=0)return t.copy(n);LG.subVectors(e,i);const h=Xh.dot(LG),A=Yh.dot(LG);if(h>=0&&A<=h)return t.copy(i);const f=c*A-h*u;if(f<=0&&c>=0&&h<=0)return o=c/(c-h),t.copy(n).addScaledVector(Xh,o);kG.subVectors(e,s);const p=Xh.dot(kG),y=Yh.dot(kG);if(y>=0&&p<=y)return t.copy(s);const G=p*u-c*y;if(G<=0&&u>=0&&y<=0)return l=u/(u-y),t.copy(n).addScaledVector(Yh,l);const B=h*y-p*A;if(B<=0&&A-h>=0&&p-y>=0)return Fw.subVectors(s,i),l=(A-h)/(A-h+(p-y)),t.copy(i).addScaledVector(Fw,l);const S=1/(B+G+f);return o=G*S,l=f*S,t.copy(n).addScaledVector(Xh,o).addScaledVector(Yh,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const uV={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},bu={h:0,s:0,l:0},Cb={h:0,s:0,l:0};function jG(a,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?a+(e-a)*6*t:t<1/2?e:t<2/3?a+(e-a)*6*(2/3-t):a}class tn{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=Bs){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ei.colorSpaceToWorking(this,t),this}setRGB(e,t,n,i=ei.workingColorSpace){return this.r=e,this.g=t,this.b=n,ei.colorSpaceToWorking(this,i),this}setHSL(e,t,n,i=ei.workingColorSpace){if(e=GS(e,1),t=Zn(t,0,1),n=Zn(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,o=2*n-s;this.r=jG(o,s,e+1/3),this.g=jG(o,s,e),this.b=jG(o,s,e-1/3)}return ei.colorSpaceToWorking(this,i),this}setStyle(e,t=Bs){function n(s){s!==void 0&&parseFloat(s)<1&&Qt("Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const o=i[1],l=i[2];switch(o){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:Qt("Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],o=s.length;if(o===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(o===6)return this.setHex(parseInt(s,16),t);Qt("Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=Bs){const n=uV[e.toLowerCase()];return n!==void 0?this.setHex(n,t):Qt("Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Zg(e.r),this.g=Zg(e.g),this.b=Zg(e.b),this}copyLinearToSRGB(e){return this.r=uC(e.r),this.g=uC(e.g),this.b=uC(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=Bs){return ei.workingToColorSpace(Ks.copy(this),e),Math.round(Zn(Ks.r*255,0,255))*65536+Math.round(Zn(Ks.g*255,0,255))*256+Math.round(Zn(Ks.b*255,0,255))}getHexString(e=Bs){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ei.workingColorSpace){ei.workingToColorSpace(Ks.copy(this),t);const n=Ks.r,i=Ks.g,s=Ks.b,o=Math.max(n,i,s),l=Math.min(n,i,s);let c,u;const h=(l+o)/2;if(l===o)c=0,u=0;else{const A=o-l;switch(u=h<=.5?A/(o+l):A/(2-o-l),o){case n:c=(i-s)/A+(i<s?6:0);break;case i:c=(s-n)/A+2;break;case s:c=(n-i)/A+4;break}c/=6}return e.h=c,e.s=u,e.l=h,e}getRGB(e,t=ei.workingColorSpace){return ei.workingToColorSpace(Ks.copy(this),t),e.r=Ks.r,e.g=Ks.g,e.b=Ks.b,e}getStyle(e=Bs){ei.workingToColorSpace(Ks.copy(this),e);const t=Ks.r,n=Ks.g,i=Ks.b;return e!==Bs?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(bu),this.setHSL(bu.h+e,bu.s+t,bu.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(bu),e.getHSL(Cb);const n=zf(bu.h,Cb.h,t),i=zf(bu.s,Cb.s,t),s=zf(bu.l,Cb.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Ks=new tn;tn.NAMES=uV;let wF=0;class Os extends Nc{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:wF++}),this.uuid=Cr(),this.name="",this.type="Material",this.blending=lI,this.side=wc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=w0,this.blendDst=R0,this.blendEquation=wu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new tn(0,0,0),this.blendAlpha=0,this.depthFunc=II,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=B2,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jd,this.stencilZFail=jd,this.stencilZPass=jd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){Qt(`Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){Qt(`Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.7,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.sheenColorMap&&this.sheenColorMap.isTexture&&(n.sheenColorMap=this.sheenColorMap.toJSON(e).uuid),this.sheenRoughnessMap&&this.sheenRoughnessMap.isTexture&&(n.sheenRoughnessMap=this.sheenRoughnessMap.toJSON(e).uuid),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==lI&&(n.blending=this.blending),this.side!==wc&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==w0&&(n.blendSrc=this.blendSrc),this.blendDst!==R0&&(n.blendDst=this.blendDst),this.blendEquation!==wu&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==II&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==B2&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==jd&&(n.stencilFail=this.stencilFail),this.stencilZFail!==jd&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==jd&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.allowOverride===!1&&(n.allowOverride=!1),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const o=[];for(const l in s){const c=s[l];delete c.metadata,o.push(c)}return o}if(t){const s=i(e.textures),o=i(e.images);s.length>0&&(n.textures=s),o.length>0&&(n.images=o)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.allowOverride=e.allowOverride,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class Wc extends Os{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new tn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vo,this.combine=Rm,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Gg=RF();function RF(){const a=new ArrayBuffer(4),e=new Float32Array(a),t=new Uint32Array(a),n=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const u=c-127;u<-27?(n[c]=0,n[c|256]=32768,i[c]=24,i[c|256]=24):u<-14?(n[c]=1024>>-u-14,n[c|256]=1024>>-u-14|32768,i[c]=-u-1,i[c|256]=-u-1):u<=15?(n[c]=u+15<<10,n[c|256]=u+15<<10|32768,i[c]=13,i[c|256]=13):u<128?(n[c]=31744,n[c|256]=64512,i[c]=24,i[c|256]=24):(n[c]=31744,n[c|256]=64512,i[c]=13,i[c|256]=13)}const s=new Uint32Array(2048),o=new Uint32Array(64),l=new Uint32Array(64);for(let c=1;c<1024;++c){let u=c<<13,h=0;for(;(u&8388608)===0;)u<<=1,h-=8388608;u&=-8388609,h+=947912704,s[c]=u|h}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)o[c]=c<<23;o[31]=1199570944,o[32]=2147483648;for(let c=33;c<63;++c)o[c]=2147483648+(c-32<<23);o[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(l[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:s,exponentTable:o,offsetTable:l}}function Ko(a){Math.abs(a)>65504&&Qt("DataUtils.toHalfFloat(): Value out of range."),a=Zn(a,-65504,65504),Gg.floatView[0]=a;const e=Gg.uint32View[0],t=e>>23&511;return Gg.baseTable[t]+((e&8388607)>>Gg.shiftTable[t])}function wf(a){const e=a>>10;return Gg.uint32View[0]=Gg.mantissaTable[Gg.offsetTable[e]+(a&1023)]+Gg.exponentTable[e],Gg.floatView[0]}class sI{static toHalfFloat(e){return Ko(e)}static fromHalfFloat(e){return wf(e)}}const Ma=new ue,Ab=new yt;let NF=0;class Zi{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:NF++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=gm,this.updateRanges=[],this.gpuType=$i,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Ab.fromBufferAttribute(this,t),Ab.applyMatrix3(e),this.setXY(t,Ab.x,Ab.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ma.fromBufferAttribute(this,t),Ma.applyMatrix3(e),this.setXYZ(t,Ma.x,Ma.y,Ma.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ma.fromBufferAttribute(this,t),Ma.applyMatrix4(e),this.setXYZ(t,Ma.x,Ma.y,Ma.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ma.fromBufferAttribute(this,t),Ma.applyNormalMatrix(e),this.setXYZ(t,Ma.x,Ma.y,Ma.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ma.fromBufferAttribute(this,t),Ma.transformDirection(e),this.setXYZ(t,Ma.x,Ma.y,Ma.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=bo(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Hn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=bo(t,this.array)),t}setX(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=bo(t,this.array)),t}setY(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=bo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=bo(t,this.array)),t}setW(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array),i=Hn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array),i=Hn(i,this.array),s=Hn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==gm&&(e.usage=this.usage),e}}class WF extends Zi{constructor(e,t,n){super(new Int8Array(e),t,n)}}class VF extends Zi{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class MF extends Zi{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class _F extends Zi{constructor(e,t,n){super(new Int16Array(e),t,n)}}class SS extends Zi{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class XF extends Zi{constructor(e,t,n){super(new Int32Array(e),t,n)}}class xS extends Zi{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class YF extends Zi{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=wf(this.array[e*this.itemSize]);return this.normalized&&(t=bo(t,this.array)),t}setX(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize]=Ko(t),this}getY(e){let t=wf(this.array[e*this.itemSize+1]);return this.normalized&&(t=bo(t,this.array)),t}setY(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize+1]=Ko(t),this}getZ(e){let t=wf(this.array[e*this.itemSize+2]);return this.normalized&&(t=bo(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize+2]=Ko(t),this}getW(e){let t=wf(this.array[e*this.itemSize+3]);return this.normalized&&(t=bo(t,this.array)),t}setW(e,t){return this.normalized&&(t=Hn(t,this.array)),this.array[e*this.itemSize+3]=Ko(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array)),this.array[e+0]=Ko(t),this.array[e+1]=Ko(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array),i=Hn(i,this.array)),this.array[e+0]=Ko(t),this.array[e+1]=Ko(n),this.array[e+2]=Ko(i),this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array),i=Hn(i,this.array),s=Hn(s,this.array)),this.array[e+0]=Ko(t),this.array[e+1]=Ko(n),this.array[e+2]=Ko(i),this.array[e+3]=Ko(s),this}}class an extends Zi{constructor(e,t,n){super(new Float32Array(e),t,n)}}let HF=0;const Fr=new pn,JG=new ti,Hh=new ue,lr=new Za,lf=new Za,ss=new ue;class Mn extends Nc{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:HF++}),this.uuid=Cr(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.indirectOffset=0,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(oV(e)?xS:SS)(e,1):this.index=e,this}setIndirect(e,t=0){return this.indirect=e,this.indirectOffset=t,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Vn().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Fr.makeRotationFromQuaternion(e),this.applyMatrix4(Fr),this}rotateX(e){return Fr.makeRotationX(e),this.applyMatrix4(Fr),this}rotateY(e){return Fr.makeRotationY(e),this.applyMatrix4(Fr),this}rotateZ(e){return Fr.makeRotationZ(e),this.applyMatrix4(Fr),this}translate(e,t,n){return Fr.makeTranslation(e,t,n),this.applyMatrix4(Fr),this}scale(e,t,n){return Fr.makeScale(e,t,n),this.applyMatrix4(Fr),this}lookAt(e){return JG.lookAt(e),JG.updateMatrix(),this.applyMatrix4(JG.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Hh).negate(),this.translate(Hh.x,Hh.y,Hh.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,s=e.length;i<s;i++){const o=e[i];n.push(o.x,o.y,o.z||0)}this.setAttribute("position",new an(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&Qt("BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Za);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Cn("BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new ue(-1/0,-1/0,-1/0),new ue(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];lr.setFromBufferAttribute(s),this.morphTargetsRelative?(ss.addVectors(this.boundingBox.min,lr.min),this.boundingBox.expandByPoint(ss),ss.addVectors(this.boundingBox.max,lr.max),this.boundingBox.expandByPoint(ss)):(this.boundingBox.expandByPoint(lr.min),this.boundingBox.expandByPoint(lr.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&Cn('BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ha);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){Cn("BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new ue,1/0);return}if(e){const n=this.boundingSphere.center;if(lr.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++){const l=t[s];lf.setFromBufferAttribute(l),this.morphTargetsRelative?(ss.addVectors(lr.min,lf.min),lr.expandByPoint(ss),ss.addVectors(lr.max,lf.max),lr.expandByPoint(ss)):(lr.expandByPoint(lf.min),lr.expandByPoint(lf.max))}lr.getCenter(n);let i=0;for(let s=0,o=e.count;s<o;s++)ss.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(ss));if(t)for(let s=0,o=t.length;s<o;s++){const l=t[s],c=this.morphTargetsRelative;for(let u=0,h=l.count;u<h;u++)ss.fromBufferAttribute(l,u),c&&(Hh.fromBufferAttribute(e,u),ss.add(Hh)),i=Math.max(i,n.distanceToSquared(ss))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&Cn('BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){Cn("BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Zi(new Float32Array(4*n.count),4));const o=this.getAttribute("tangent"),l=[],c=[];for(let Y=0;Y<n.count;Y++)l[Y]=new ue,c[Y]=new ue;const u=new ue,h=new ue,A=new ue,f=new yt,p=new yt,y=new yt,G=new ue,B=new ue;function S(Y,M,E){u.fromBufferAttribute(n,Y),h.fromBufferAttribute(n,M),A.fromBufferAttribute(n,E),f.fromBufferAttribute(s,Y),p.fromBufferAttribute(s,M),y.fromBufferAttribute(s,E),h.sub(u),A.sub(u),p.sub(f),y.sub(f);const O=1/(p.x*y.y-y.x*p.y);isFinite(O)&&(G.copy(h).multiplyScalar(y.y).addScaledVector(A,-p.y).multiplyScalar(O),B.copy(A).multiplyScalar(p.x).addScaledVector(h,-y.x).multiplyScalar(O),l[Y].add(G),l[M].add(G),l[E].add(G),c[Y].add(B),c[M].add(B),c[E].add(B))}let N=this.groups;N.length===0&&(N=[{start:0,count:e.count}]);for(let Y=0,M=N.length;Y<M;++Y){const E=N[Y],O=E.start,P=E.count;for(let q=O,k=O+P;q<k;q+=3)S(e.getX(q+0),e.getX(q+1),e.getX(q+2))}const R=new ue,w=new ue,V=new ue,H=new ue;function X(Y){V.fromBufferAttribute(i,Y),H.copy(V);const M=l[Y];R.copy(M),R.sub(V.multiplyScalar(V.dot(M))).normalize(),w.crossVectors(H,M);const O=w.dot(c[Y])<0?-1:1;o.setXYZW(Y,R.x,R.y,R.z,O)}for(let Y=0,M=N.length;Y<M;++Y){const E=N[Y],O=E.start,P=E.count;for(let q=O,k=O+P;q<k;q+=3)X(e.getX(q+0)),X(e.getX(q+1)),X(e.getX(q+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Zi(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let f=0,p=n.count;f<p;f++)n.setXYZ(f,0,0,0);const i=new ue,s=new ue,o=new ue,l=new ue,c=new ue,u=new ue,h=new ue,A=new ue;if(e)for(let f=0,p=e.count;f<p;f+=3){const y=e.getX(f+0),G=e.getX(f+1),B=e.getX(f+2);i.fromBufferAttribute(t,y),s.fromBufferAttribute(t,G),o.fromBufferAttribute(t,B),h.subVectors(o,s),A.subVectors(i,s),h.cross(A),l.fromBufferAttribute(n,y),c.fromBufferAttribute(n,G),u.fromBufferAttribute(n,B),l.add(h),c.add(h),u.add(h),n.setXYZ(y,l.x,l.y,l.z),n.setXYZ(G,c.x,c.y,c.z),n.setXYZ(B,u.x,u.y,u.z)}else for(let f=0,p=t.count;f<p;f+=3)i.fromBufferAttribute(t,f+0),s.fromBufferAttribute(t,f+1),o.fromBufferAttribute(t,f+2),h.subVectors(o,s),A.subVectors(i,s),h.cross(A),n.setXYZ(f+0,h.x,h.y,h.z),n.setXYZ(f+1,h.x,h.y,h.z),n.setXYZ(f+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ss.fromBufferAttribute(e,t),ss.normalize(),e.setXYZ(t,ss.x,ss.y,ss.z)}toNonIndexed(){function e(l,c){const u=l.array,h=l.itemSize,A=l.normalized,f=new u.constructor(c.length*h);let p=0,y=0;for(let G=0,B=c.length;G<B;G++){l.isInterleavedBufferAttribute?p=c[G]*l.data.stride+l.offset:p=c[G]*h;for(let S=0;S<h;S++)f[y++]=u[p++]}return new Zi(f,h,A)}if(this.index===null)return Qt("BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Mn,n=this.index.array,i=this.attributes;for(const l in i){const c=i[l],u=e(c,n);t.setAttribute(l,u)}const s=this.morphAttributes;for(const l in s){const c=[],u=s[l];for(let h=0,A=u.length;h<A;h++){const f=u[h],p=e(f,n);c.push(p)}t.morphAttributes[l]=c}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let l=0,c=o.length;l<c;l++){const u=o[l];t.addGroup(u.start,u.count,u.materialIndex)}return t}toJSON(){const e={metadata:{version:4.7,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const u in c)c[u]!==void 0&&(e[u]=c[u]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const u=n[c];e.data.attributes[c]=u.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const u=this.morphAttributes[c],h=[];for(let A=0,f=u.length;A<f;A++){const p=u[A];h.push(p.toJSON(e.data))}h.length>0&&(i[c]=h,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere=l.toJSON()),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const u in i){const h=i[u];this.setAttribute(u,h.clone(t))}const s=e.morphAttributes;for(const u in s){const h=[],A=s[u];for(let f=0,p=A.length;f<p;f++)h.push(A[f].clone(t));this.morphAttributes[u]=h}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let u=0,h=o.length;u<h;u++){const A=o[u];this.addGroup(A.start,A.count,A.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const Kw=new pn,Wd=new pI,fb=new Ha,Tw=new ue,mb=new ue,pb=new ue,bb=new ue,PG=new ue,yb=new ue,zw=new ue,vb=new ue;class _i extends ti{constructor(e=new Mn,t=new Wc){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.count=1,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,o=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const l=this.morphTargetInfluences;if(s&&l){yb.set(0,0,0);for(let c=0,u=s.length;c<u;c++){const h=l[c],A=s[c];h!==0&&(PG.fromBufferAttribute(A,e),o?yb.addScaledVector(PG,h):yb.addScaledVector(PG.sub(t),h))}t.add(yb)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),fb.copy(n.boundingSphere),fb.applyMatrix4(s),Wd.copy(e.ray).recast(e.near),!(fb.containsPoint(Wd.origin)===!1&&(Wd.intersectSphere(fb,Tw)===null||Wd.origin.distanceToSquared(Tw)>(e.far-e.near)**2))&&(Kw.copy(s).invert(),Wd.copy(e.ray).applyMatrix4(Kw),!(n.boundingBox!==null&&Wd.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,Wd)))}_computeIntersections(e,t,n){let i;const s=this.geometry,o=this.material,l=s.index,c=s.attributes.position,u=s.attributes.uv,h=s.attributes.uv1,A=s.attributes.normal,f=s.groups,p=s.drawRange;if(l!==null)if(Array.isArray(o))for(let y=0,G=f.length;y<G;y++){const B=f[y],S=o[B.materialIndex],N=Math.max(B.start,p.start),R=Math.min(l.count,Math.min(B.start+B.count,p.start+p.count));for(let w=N,V=R;w<V;w+=3){const H=l.getX(w),X=l.getX(w+1),Y=l.getX(w+2);i=Gb(this,S,e,n,u,h,A,H,X,Y),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=B.materialIndex,t.push(i))}}else{const y=Math.max(0,p.start),G=Math.min(l.count,p.start+p.count);for(let B=y,S=G;B<S;B+=3){const N=l.getX(B),R=l.getX(B+1),w=l.getX(B+2);i=Gb(this,o,e,n,u,h,A,N,R,w),i&&(i.faceIndex=Math.floor(B/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(o))for(let y=0,G=f.length;y<G;y++){const B=f[y],S=o[B.materialIndex],N=Math.max(B.start,p.start),R=Math.min(c.count,Math.min(B.start+B.count,p.start+p.count));for(let w=N,V=R;w<V;w+=3){const H=w,X=w+1,Y=w+2;i=Gb(this,S,e,n,u,h,A,H,X,Y),i&&(i.faceIndex=Math.floor(w/3),i.face.materialIndex=B.materialIndex,t.push(i))}}else{const y=Math.max(0,p.start),G=Math.min(c.count,p.start+p.count);for(let B=y,S=G;B<S;B+=3){const N=B,R=B+1,w=B+2;i=Gb(this,o,e,n,u,h,A,N,R,w),i&&(i.faceIndex=Math.floor(B/3),t.push(i))}}}}function EF(a,e,t,n,i,s,o,l){let c;if(e.side===Ss?c=n.intersectTriangle(o,s,i,!0,l):c=n.intersectTriangle(i,s,o,e.side===wc,l),c===null)return null;vb.copy(l),vb.applyMatrix4(a.matrixWorld);const u=t.ray.origin.distanceTo(vb);return u<t.near||u>t.far?null:{distance:u,point:vb.clone(),object:a}}function Gb(a,e,t,n,i,s,o,l,c,u){a.getVertexPosition(l,mb),a.getVertexPosition(c,pb),a.getVertexPosition(u,bb);const h=EF(a,e,t,n,mb,pb,bb,zw);if(h){const A=new ue;Lo.getBarycoord(zw,mb,pb,bb,A),i&&(h.uv=Lo.getInterpolatedAttribute(i,l,c,u,A,new yt)),s&&(h.uv1=Lo.getInterpolatedAttribute(s,l,c,u,A,new yt)),o&&(h.normal=Lo.getInterpolatedAttribute(o,l,c,u,A,new ue),h.normal.dot(n.direction)>0&&h.normal.multiplyScalar(-1));const f={a:l,b:c,c:u,normal:new ue,materialIndex:0};Lo.getNormal(mb,pb,bb,f.normal),h.face=f,h.barycoord=A}return h}class bI extends Mn{constructor(e=1,t=1,n=1,i=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:o};const l=this;i=Math.floor(i),s=Math.floor(s),o=Math.floor(o);const c=[],u=[],h=[],A=[];let f=0,p=0;y("z","y","x",-1,-1,n,t,e,o,s,0),y("z","y","x",1,-1,n,t,-e,o,s,1),y("x","z","y",1,1,e,n,t,i,o,2),y("x","z","y",1,-1,e,n,-t,i,o,3),y("x","y","z",1,-1,e,t,n,i,s,4),y("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new an(u,3)),this.setAttribute("normal",new an(h,3)),this.setAttribute("uv",new an(A,2));function y(G,B,S,N,R,w,V,H,X,Y,M){const E=w/X,O=V/Y,P=w/2,q=V/2,k=H/2,le=X+1,F=Y+1;let j=0,Q=0;const ce=new ue;for(let oe=0;oe<F;oe++){const T=oe*O-q;for(let $=0;$<le;$++){const ae=$*E-P;ce[G]=ae*N,ce[B]=T*R,ce[S]=k,u.push(ce.x,ce.y,ce.z),ce[G]=0,ce[B]=0,ce[S]=H>0?1:-1,h.push(ce.x,ce.y,ce.z),A.push($/X),A.push(1-oe/Y),j+=1}}for(let oe=0;oe<Y;oe++)for(let T=0;T<X;T++){const $=f+T+le*oe,ae=f+T+le*(oe+1),Ie=f+(T+1)+le*(oe+1),be=f+(T+1)+le*oe;c.push($,ae,be),c.push(ae,Ie,be),Q+=6}l.addGroup(p,Q,M),p+=Q,f+=j}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bI(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function vC(a){const e={};for(const t in a){e[t]={};for(const n in a[t]){const i=a[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(Qt("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function Co(a){const e={};for(let t=0;t<a.length;t++){const n=vC(a[t]);for(const i in n)e[i]=n[i]}return e}function FF(a){const e=[];for(let t=0;t<a.length;t++)e.push(a[t].clone());return e}function dV(a){const e=a.getRenderTarget();return e===null?a.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ei.workingColorSpace}const Im={clone:vC,merge:Co};var KF=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,TF=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ds extends Os{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=KF,this.fragmentShader=TF,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=vC(e.uniforms),this.uniformsGroups=FF(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this.defaultAttributeValues=Object.assign({},e.defaultAttributeValues),this.index0AttributeName=e.index0AttributeName,this.uniformsNeedUpdate=e.uniformsNeedUpdate,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const o=this.uniforms[i].value;o&&o.isTexture?t.uniforms[i]={type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?t.uniforms[i]={type:"c",value:o.getHex()}:o&&o.isVector2?t.uniforms[i]={type:"v2",value:o.toArray()}:o&&o.isVector3?t.uniforms[i]={type:"v3",value:o.toArray()}:o&&o.isVector4?t.uniforms[i]={type:"v4",value:o.toArray()}:o&&o.isMatrix3?t.uniforms[i]={type:"m3",value:o.toArray()}:o&&o.isMatrix4?t.uniforms[i]={type:"m4",value:o.toArray()}:t.uniforms[i]={value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class Oy extends ti{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new pn,this.projectionMatrix=new pn,this.projectionMatrixInverse=new pn,this.coordinateSystem=Ir,this._reversedDepth=!1}get reversedDepth(){return this._reversedDepth}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const yu=new ue,Lw=new yt,kw=new yt;class Ga extends Oy{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=bC*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(cI*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return bC*2*Math.atan(Math.tan(cI*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){yu.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(yu.x,yu.y).multiplyScalar(-e/yu.z),yu.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(yu.x,yu.y).multiplyScalar(-e/yu.z)}getViewSize(e,t){return this.getViewBounds(e,Lw,kw),t.subVectors(kw,Lw)}setViewOffset(e,t,n,i,s,o){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(cI*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const o=this.view;if(this.view!==null&&this.view.enabled){const c=o.fullWidth,u=o.fullHeight;s+=o.offsetX*i/c,t-=o.offsetY*n/u,i*=o.width/c,n*=o.height/u}const l=this.filmOffset;l!==0&&(s+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Eh=-90,Fh=1;class IV extends ti{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Ga(Eh,Fh,e,t);i.layers=this.layers,this.add(i);const s=new Ga(Eh,Fh,e,t);s.layers=this.layers,this.add(s);const o=new Ga(Eh,Fh,e,t);o.layers=this.layers,this.add(o);const l=new Ga(Eh,Fh,e,t);l.layers=this.layers,this.add(l);const c=new Ga(Eh,Fh,e,t);c.layers=this.layers,this.add(c);const u=new Ga(Eh,Fh,e,t);u.layers=this.layers,this.add(u)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,o,l,c]=t;for(const u of t)this.remove(u);if(e===Ir)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),o.up.set(0,0,1),o.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===mC)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),o.up.set(0,0,-1),o.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const u of t)this.add(u),u.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,o,l,c,u,h]=this.children,A=e.getRenderTarget(),f=e.getActiveCubeFace(),p=e.getActiveMipmapLevel(),y=e.xr.enabled;e.xr.enabled=!1;const G=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,o),e.setRenderTarget(n,2,i),e.render(t,l),e.setRenderTarget(n,3,i),e.render(t,c),e.setRenderTarget(n,4,i),e.render(t,u),n.texture.generateMipmaps=G,e.setRenderTarget(n,5,i),e.render(t,h),e.setRenderTarget(A,f,p),e.xr.enabled=y,n.texture.needsPMREMUpdate=!0}}class Mm extends fi{constructor(e=[],t=Vl,n,i,s,o,l,c,u,h){super(e,t,n,i,s,o,l,c,u,h),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class jy extends yo{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new Mm(i),this._setTextureOptions(t),this.texture.isRenderTargetTexture=!0}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new bI(5,5,5),s=new Ds({name:"CubemapFromEquirect",uniforms:vC(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ss,blending:Wl});s.uniforms.tEquirect.value=t;const o=new _i(i,s),l=t.minFilter;return t.minFilter===Gc&&(t.minFilter=Pn),new IV(1,10,this).update(e,o),t.minFilter=l,o.geometry.dispose(),o.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,n,i);e.setRenderTarget(s)}}class rC extends ti{constructor(){super(),this.isGroup=!0,this.type="Group"}}const zF={type:"move"};class m0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new rC,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new rC,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new ue,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new ue),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new rC,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new ue,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new ue),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,o=null;const l=this._targetRay,c=this._grip,u=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(u&&e.hand){o=!0;for(const G of e.hand.values()){const B=t.getJointPose(G,n),S=this._getHandJoint(u,G);B!==null&&(S.matrix.fromArray(B.transform.matrix),S.matrix.decompose(S.position,S.rotation,S.scale),S.matrixWorldNeedsUpdate=!0,S.jointRadius=B.radius),S.visible=B!==null}const h=u.joints["index-finger-tip"],A=u.joints["thumb-tip"],f=h.position.distanceTo(A.position),p=.02,y=.005;u.inputState.pinching&&f>p+y?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&f<=p-y&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(zF)))}return l!==null&&(l.visible=i!==null),c!==null&&(c.visible=s!==null),u!==null&&(u.visible=o!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new rC;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class Jy{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new tn(e),this.density=t}clone(){return new Jy(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class Py{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new tn(e),this.near=t,this.far=n}clone(){return new Py(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let _m=class extends ti{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new vo,this.environmentIntensity=1,this.environmentRotation=new vo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class Qy{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=gm,this.updateRanges=[],this.version=0,this.uuid=Cr()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Cr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=Cr()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const ho=new ue;class hr{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)ho.fromBufferAttribute(this,t),ho.applyMatrix4(e),this.setXYZ(t,ho.x,ho.y,ho.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)ho.fromBufferAttribute(this,t),ho.applyNormalMatrix(e),this.setXYZ(t,ho.x,ho.y,ho.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)ho.fromBufferAttribute(this,t),ho.transformDirection(e),this.setXYZ(t,ho.x,ho.y,ho.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=bo(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=Hn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=Hn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=Hn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=Hn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=Hn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=bo(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=bo(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=bo(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=bo(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array),i=Hn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=Hn(t,this.array),n=Hn(n,this.array),i=Hn(i,this.array),s=Hn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){dm("InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new Zi(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new hr(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){dm("InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class ZS extends Os{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new tn(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let Kh;const cf=new ue,Th=new ue,zh=new ue,Lh=new yt,gf=new yt,hV=new pn,Bb=new ue,uf=new ue,Sb=new ue,Uw=new yt,QG=new yt,Dw=new yt;class CV extends ti{constructor(e=new ZS){if(super(),this.isSprite=!0,this.type="Sprite",Kh===void 0){Kh=new Mn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Qy(t,5);Kh.setIndex([0,1,2,0,2,3]),Kh.setAttribute("position",new hr(n,3,0,!1)),Kh.setAttribute("uv",new hr(n,2,3,!1))}this.geometry=Kh,this.material=e,this.center=new yt(.5,.5),this.count=1}raycast(e,t){e.camera===null&&Cn('Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Th.setFromMatrixScale(this.matrixWorld),hV.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),zh.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Th.multiplyScalar(-zh.z);const n=this.material.rotation;let i,s;n!==0&&(s=Math.cos(n),i=Math.sin(n));const o=this.center;xb(Bb.set(-.5,-.5,0),zh,o,Th,i,s),xb(uf.set(.5,-.5,0),zh,o,Th,i,s),xb(Sb.set(.5,.5,0),zh,o,Th,i,s),Uw.set(0,0),QG.set(1,0),Dw.set(1,1);let l=e.ray.intersectTriangle(Bb,uf,Sb,!1,cf);if(l===null&&(xb(uf.set(-.5,.5,0),zh,o,Th,i,s),QG.set(0,1),l=e.ray.intersectTriangle(Bb,Sb,uf,!1,cf),l===null))return;const c=e.ray.origin.distanceTo(cf);c<e.near||c>e.far||t.push({distance:c,point:cf.clone(),uv:Lo.getInterpolation(cf,Bb,uf,Sb,Uw,QG,Dw,new yt),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function xb(a,e,t,n,i,s){Lh.subVectors(a,t).addScalar(.5).multiply(n),i!==void 0?(gf.x=s*Lh.x-i*Lh.y,gf.y=i*Lh.x+s*Lh.y):gf.copy(Lh),a.copy(e),a.x+=gf.x,a.y+=gf.y,a.applyMatrix4(hV)}const Zb=new ue,Ow=new ue;class AV extends ti{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const i=t.splice(n,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){Zb.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Zb);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Zb.setFromMatrixPosition(e.matrixWorld),Ow.setFromMatrixPosition(this.matrixWorld);const n=Zb.distanceTo(Ow)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let o=t[i].distance;if(t[i].object.visible&&(o-=o*t[i].hysteresis),n>=o)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,s=n.length;i<s;i++){const o=n[i];t.object.levels.push({object:o.object.uuid,distance:o.distance,hysteresis:o.hysteresis})}return t}}const jw=new ue,Jw=new ri,Pw=new ri,LF=new ue,Qw=new pn,wb=new ue,qG=new Ha,qw=new pn,$G=new pI;class fV extends _i{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=v2,this.bindMatrix=new pn,this.bindMatrixInverse=new pn,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new Za),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,wb),this.boundingBox.expandByPoint(wb)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new Ha),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,wb),this.boundingSphere.expandByPoint(wb)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),qG.copy(this.boundingSphere),qG.applyMatrix4(i),e.ray.intersectsSphere(qG)!==!1&&(qw.copy(i).invert(),$G.copy(e.ray).applyMatrix4(qw),!(this.boundingBox!==null&&$G.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,$G)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new ri,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===v2?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===DW?this.bindMatrixInverse.copy(this.bindMatrix).invert():Qt("SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;Jw.fromBufferAttribute(i.attributes.skinIndex,e),Pw.fromBufferAttribute(i.attributes.skinWeight,e),jw.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const o=Pw.getComponent(s);if(o!==0){const l=Jw.getComponent(s);Qw.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),t.addScaledVector(LF.copy(jw).applyMatrix4(Qw),o)}}return t.applyMatrix4(this.bindMatrixInverse)}}class wS extends ti{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Lr extends fi{constructor(e=null,t=1,n=1,i,s,o,l,c,u=Ba,h=Ba,A,f){super(null,o,l,c,u,h,i,s,A,f),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const $w=new pn,kF=new pn;class qy{constructor(e=[],t=[]){this.uuid=Cr(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.previousBoneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){Qt("Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new pn)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new pn;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,o=e.length;s<o;s++){const l=e[s]?e[s].matrixWorld:kF;$w.multiplyMatrices(l,t[s]),$w.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new qy(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Lr(t,e,e,Sa,$i);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const s=e.bones[n];let o=t[s];o===void 0&&(Qt("Skeleton: No bone found with UUID:",s),o=new wS),this.bones.push(o),this.boneInverses.push(new pn().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.7,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const o=t[i];e.bones.push(o.uuid);const l=n[i];e.boneInverses.push(l.toArray())}return e}}class CI extends Zi{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const kh=new pn,eR=new pn,Rb=[],tR=new Za,UF=new pn,df=new _i,If=new Ha;class dC extends _i{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new CI(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,UF)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new Za),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,kh),tR.copy(e.boundingBox).applyMatrix4(kh),this.boundingBox.union(tR)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new Ha),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,kh),If.copy(e.boundingSphere).applyMatrix4(kh),this.boundingSphere.union(If)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,o=e*s+1;for(let l=0;l<n.length;l++)n[l]=i[o+l]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(df.geometry=this.geometry,df.material=this.material,df.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),If.copy(this.boundingSphere),If.applyMatrix4(n),e.ray.intersectsSphere(If)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,kh),eR.multiplyMatrices(n,kh),df.matrixWorld=eR,df.raycast(e,Rb);for(let o=0,l=Rb.length;o<l;o++){const c=Rb[o];c.instanceId=s,c.object=this,t.push(c)}Rb.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new CI(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new Lr(new Float32Array(i*this.count),i,this.count,Wm,$i));const s=this.morphTexture.source.data.data;let o=0;for(let u=0;u<n.length;u++)o+=n[u];const l=this.geometry.morphTargetsRelative?1:1-o,c=i*e;s[c]=l,s.set(n,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const eB=new ue,DF=new ue,OF=new Vn;class yg{constructor(e=new ue(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=eB.subVectors(n,t).cross(DF.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(eB),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||OF.getNormalMatrix(e),i=this.coplanarPoint(eB).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Vd=new Ha,jF=new yt(.5,.5),Nb=new ue;class RC{constructor(e=new yg,t=new yg,n=new yg,i=new yg,s=new yg,o=new yg){this.planes=[e,t,n,i,s,o]}set(e,t,n,i,s,o){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(i),l[4].copy(s),l[5].copy(o),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=Ir,n=!1){const i=this.planes,s=e.elements,o=s[0],l=s[1],c=s[2],u=s[3],h=s[4],A=s[5],f=s[6],p=s[7],y=s[8],G=s[9],B=s[10],S=s[11],N=s[12],R=s[13],w=s[14],V=s[15];if(i[0].setComponents(u-o,p-h,S-y,V-N).normalize(),i[1].setComponents(u+o,p+h,S+y,V+N).normalize(),i[2].setComponents(u+l,p+A,S+G,V+R).normalize(),i[3].setComponents(u-l,p-A,S-G,V-R).normalize(),n)i[4].setComponents(c,f,B,w).normalize(),i[5].setComponents(u-c,p-f,S-B,V-w).normalize();else if(i[4].setComponents(u-c,p-f,S-B,V-w).normalize(),t===Ir)i[5].setComponents(u+c,p+f,S+B,V+w).normalize();else if(t===mC)i[5].setComponents(c,f,B,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Vd.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Vd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Vd)}intersectsSprite(e){Vd.center.set(0,0,0);const t=jF.distanceTo(e.center);return Vd.radius=.7071067811865476+t,Vd.applyMatrix4(e.matrixWorld),this.intersectsSphere(Vd)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(Nb.x=i.normal.x>0?e.max.x:e.min.x,Nb.y=i.normal.y>0?e.max.y:e.min.y,Nb.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(Nb)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}const uc=new pn,dc=new RC;class $y{constructor(){this.coordinateSystem=Ir}intersectsObject(e,t){if(!t.isArrayCamera||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(uc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),dc.setFromProjectionMatrix(uc,i.coordinateSystem,i.reversedDepth),dc.intersectsObject(e))return!0}return!1}intersectsSprite(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(uc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),dc.setFromProjectionMatrix(uc,i.coordinateSystem,i.reversedDepth),dc.intersectsSprite(e))return!0}return!1}intersectsSphere(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(uc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),dc.setFromProjectionMatrix(uc,i.coordinateSystem,i.reversedDepth),dc.intersectsSphere(e))return!0}return!1}intersectsBox(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(uc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),dc.setFromProjectionMatrix(uc,i.coordinateSystem,i.reversedDepth),dc.intersectsBox(e))return!0}return!1}containsPoint(e,t){if(!t||!t.cameras||t.cameras.length===0)return!1;for(let n=0;n<t.cameras.length;n++){const i=t.cameras[n];if(uc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),dc.setFromProjectionMatrix(uc,i.coordinateSystem,i.reversedDepth),dc.containsPoint(e))return!0}return!1}clone(){return new $y}}function tB(a,e){return a-e}function JF(a,e){return a.z-e.z}function PF(a,e){return e.z-a.z}class QF{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const s=this.pool,o=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const l=s[this.index];o.push(l),this.index++,l.start=e,l.count=t,l.z=n,l.index=i}reset(){this.list.length=0,this.index=0}}const Ho=new pn,qF=new tn(1,1,1),nR=new RC,$F=new $y,Wb=new Za,Md=new Ha,hf=new ue,iR=new ue,eK=new ue,nB=new QF,Ts=new _i,Vb=[];function tK(a,e,t=0){const n=e.itemSize;if(a.isInterleavedBufferAttribute||a.array.constructor!==e.array.constructor){const i=a.count;for(let s=0;s<i;s++)for(let o=0;o<n;o++)e.setComponent(s+t,o,a.getComponent(s,o))}else e.array.set(a.array,t*n);e.needsUpdate=!0}function _d(a,e){if(a.constructor!==e.constructor){const t=Math.min(a.length,e.length);for(let n=0;n<t;n++)e[n]=a[n]}else{const t=Math.min(a.length,e.length);e.set(new a.constructor(a.buffer,0,t))}}class mV extends _i{constructor(e,t,n=t*2,i){super(new Mn,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Lr(t,e,e,Sa,$i);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new Lr(t,e,e,Vm,fr);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new Lr(t,e,e,Sa,$i);n.colorSpace=ei.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const o=e.getAttribute(s),{array:l,itemSize:c,normalized:u}=o,h=new l.constructor(n*c),A=new Zi(h,c,u);t.setAttribute(s,A)}if(e.getIndex()!==null){const s=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new Zi(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),s=t.getAttribute(n);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Za);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,Ho),this.getBoundingBoxAt(s,Wb).applyMatrix4(Ho),e.union(Wb)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ha);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,Ho),this.getBoundingSphereAt(s,Md).applyMatrix4(Ho),e.union(Md)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(tB),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;Ho.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const o=this._colorsTexture;return o&&(qF.toArray(o.image.data,i*4),o.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const o=e.getIndex();if(o!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?o.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(tB),c=this._availableGeometryIds.shift(),s[c]=i):(c=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(c,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,c}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=n.getIndex()!==null,s=n.getIndex(),o=t.getIndex(),l=this._geometryInfo[e];if(i&&o.count>l.reservedIndexCount||t.attributes.position.count>l.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const c=l.vertexStart,u=l.reservedVertexCount;l.vertexCount=t.getAttribute("position").count;for(const h in n.attributes){const A=t.getAttribute(h),f=n.getAttribute(h);tK(A,f,c);const p=A.itemSize;for(let y=A.count,G=u;y<G;y++){const B=c+y;for(let S=0;S<p;S++)f.setComponent(B,S,0)}f.needsUpdate=!0,f.addUpdateRange(c*p,u*p)}if(i){const h=l.indexStart,A=l.reservedIndexCount;l.indexCount=t.getIndex().count;for(let f=0;f<o.count;f++)s.setX(h+f,c+o.getX(f));for(let f=o.count,p=A;f<p;f++)s.setX(h+f,c);s.needsUpdate=!0,s.addUpdateRange(h,l.reservedIndexCount)}return l.start=i?l.indexStart:l.vertexStart,l.count=i?l.indexCount:l.vertexCount,l.boundingBox=null,t.boundingBox!==null&&(l.boundingBox=t.boundingBox.clone()),l.boundingSphere=null,t.boundingSphere!==null&&(l.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let i=0,s=n.length;i<s;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((o,l)=>l).sort((o,l)=>n[o].vertexStart-n[l].vertexStart),s=this.geometry;for(let o=0,l=n.length;o<l;o++){const c=i[o],u=n[c];if(u.active!==!1){if(s.index!==null){if(u.indexStart!==t){const{indexStart:h,vertexStart:A,reservedIndexCount:f}=u,p=s.index,y=p.array,G=e-A;for(let B=h;B<h+f;B++)y[B]=y[B]+G;p.array.copyWithin(t,h,h+f),p.addUpdateRange(t,f),p.needsUpdate=!0,u.indexStart=t}t+=u.reservedIndexCount}if(u.vertexStart!==e){const{vertexStart:h,reservedVertexCount:A}=u,f=s.attributes;for(const p in f){const y=f[p],{array:G,itemSize:B}=y;G.copyWithin(e*B,h*B,(h+A)*B),y.addUpdateRange(e*B,A*B),y.needsUpdate=!0}u.vertexStart=e}e+=u.reservedVertexCount,u.start=s.index?u.indexStart:u.vertexStart,this._nextIndexStart=s.index?u.indexStart+u.reservedIndexCount:0,this._nextVertexStart=u.vertexStart+u.reservedVertexCount}}return this._visibilityChanged=!0,this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new Za,o=n.index,l=n.attributes.position;for(let c=i.start,u=i.start+i.count;c<u;c++){let h=c;o&&(h=o.getX(h)),s.expandByPoint(hf.fromBufferAttribute(l,h))}i.boundingBox=s}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new Ha;this.getBoundingBoxAt(e,Wb),Wb.getCenter(s.center);const o=n.index,l=n.attributes.position;let c=0;for(let u=i.start,h=i.start+i.count;u<h;u++){let A=u;o&&(A=o.getX(A)),hf.fromBufferAttribute(l,A),c=Math.max(c,s.center.distanceToSquared(hf))}s.radius=Math.sqrt(c),i.boundingSphere=s}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(tB);t[t.length-1]===n.length-1;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);_d(this._multiDrawCounts,i),_d(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const o=this._indirectTexture,l=this._matricesTexture,c=this._colorsTexture;o.dispose(),this._initIndirectTexture(),_d(o.image.data,this._indirectTexture.image.data),l.dispose(),this._initMatricesTexture(),_d(l.image.data,this._matricesTexture.image.data),c&&(c.dispose(),this._initColorsTexture(),_d(c.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(l=>l.active);if(Math.max(...n.map(l=>l.vertexStart+l.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(c=>c.indexStart+c.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new Mn,this._initializeGeometry(s));const o=this.geometry;s.index&&_d(s.index.array,o.index.array);for(const l in s.attributes)_d(s.attributes[l].array,o.attributes[l].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,o=this.geometry;Ts.material=this.material,Ts.geometry.index=o.index,Ts.geometry.attributes=o.attributes,Ts.geometry.boundingBox===null&&(Ts.geometry.boundingBox=new Za),Ts.geometry.boundingSphere===null&&(Ts.geometry.boundingSphere=new Ha);for(let l=0,c=n.length;l<c;l++){if(!n[l].visible||!n[l].active)continue;const u=n[l].geometryIndex,h=i[u];Ts.geometry.setDrawRange(h.start,h.count),this.getMatrixAt(l,Ts.matrixWorld).premultiply(s),this.getBoundingBoxAt(u,Ts.geometry.boundingBox),this.getBoundingSphereAt(u,Ts.geometry.boundingSphere),Ts.raycast(e,Vb);for(let A=0,f=Vb.length;A<f;A++){const p=Vb[A];p.object=this,p.batchId=l,t.push(p)}Vb.length=0}Ts.material=null,Ts.geometry.index=null,Ts.geometry.attributes={},Ts.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._availableInstanceIds=e._availableInstanceIds.slice(),this._availableGeometryIds=e._availableGeometryIds.slice(),this._nextIndexStart=e._nextIndexStart,this._nextVertexStart=e._nextVertexStart,this._geometryCount=e._geometryCount,this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._indirectTexture=e._indirectTexture.clone(),this._indirectTexture.image.data=this._indirectTexture.image.data.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const o=i.getIndex(),l=o===null?1:o.array.BYTES_PER_ELEMENT,c=this._instanceInfo,u=this._multiDrawStarts,h=this._multiDrawCounts,A=this._geometryInfo,f=this.perObjectFrustumCulled,p=this._indirectTexture,y=p.image.data,G=n.isArrayCamera?$F:nR;f&&!n.isArrayCamera&&(Ho.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),nR.setFromProjectionMatrix(Ho,n.coordinateSystem,n.reversedDepth));let B=0;if(this.sortObjects){Ho.copy(this.matrixWorld).invert(),hf.setFromMatrixPosition(n.matrixWorld).applyMatrix4(Ho),iR.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(Ho);for(let R=0,w=c.length;R<w;R++)if(c[R].visible&&c[R].active){const V=c[R].geometryIndex;this.getMatrixAt(R,Ho),this.getBoundingSphereAt(V,Md).applyMatrix4(Ho);let H=!1;if(f&&(H=!G.intersectsSphere(Md,n)),!H){const X=A[V],Y=eK.subVectors(Md.center,hf).dot(iR);nB.push(X.start,X.count,Y,R)}}const S=nB.list,N=this.customSort;N===null?S.sort(s.transparent?PF:JF):N.call(this,S,n);for(let R=0,w=S.length;R<w;R++){const V=S[R];u[B]=V.start*l,h[B]=V.count,y[B]=V.index,B++}nB.reset()}else for(let S=0,N=c.length;S<N;S++)if(c[S].visible&&c[S].active){const R=c[S].geometryIndex;let w=!1;if(f&&(this.getMatrixAt(S,Ho),this.getBoundingSphereAt(R,Md).applyMatrix4(Ho),w=!G.intersectsSphere(Md,n)),!w){const V=A[R];u[B]=V.start*l,h[B]=V.count,y[B]=S,B++}}p.needsUpdate=!0,this._multiDrawCount=B,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,s,o){this.onBeforeRender(e,null,i,s,o)}}class Go extends Os{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new tn(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const Ay=new ue,fy=new ue,aR=new pn,Cf=new pI,Mb=new Ha,iB=new ue,sR=new ue;let Hu=class extends ti{constructor(e=new Mn,t=new Go){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)Ay.fromBufferAttribute(t,i-1),fy.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=Ay.distanceTo(fy);e.setAttribute("lineDistance",new an(n,1))}else Qt("Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Mb.copy(n.boundingSphere),Mb.applyMatrix4(i),Mb.radius+=s,e.ray.intersectsSphere(Mb)===!1)return;aR.copy(i).invert(),Cf.copy(e.ray).applyMatrix4(aR);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=this.isLineSegments?2:1,h=n.index,f=n.attributes.position;if(h!==null){const p=Math.max(0,o.start),y=Math.min(h.count,o.start+o.count);for(let G=p,B=y-1;G<B;G+=u){const S=h.getX(G),N=h.getX(G+1),R=_b(this,e,Cf,c,S,N,G);R&&t.push(R)}if(this.isLineLoop){const G=h.getX(y-1),B=h.getX(p),S=_b(this,e,Cf,c,G,B,y-1);S&&t.push(S)}}else{const p=Math.max(0,o.start),y=Math.min(f.count,o.start+o.count);for(let G=p,B=y-1;G<B;G+=u){const S=_b(this,e,Cf,c,G,G+1,G);S&&t.push(S)}if(this.isLineLoop){const G=_b(this,e,Cf,c,y-1,p,y-1);G&&t.push(G)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}};function _b(a,e,t,n,i,s,o){const l=a.geometry.attributes.position;if(Ay.fromBufferAttribute(l,i),fy.fromBufferAttribute(l,s),t.distanceSqToSegment(Ay,fy,iB,sR)>n)return;iB.applyMatrix4(a.matrixWorld);const u=e.ray.origin.distanceTo(iB);if(!(u<e.near||u>e.far))return{distance:u,point:sR.clone().applyMatrix4(a.matrixWorld),index:o,face:null,faceIndex:null,barycoord:null,object:a}}const oR=new ue,rR=new ue;class Vc extends Hu{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)oR.fromBufferAttribute(t,i),rR.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+oR.distanceTo(rR);e.setAttribute("lineDistance",new an(n,1))}else Qt("LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class pV extends Hu{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class RS extends Os{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new tn(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const lR=new pn,x2=new pI,Xb=new Ha,Yb=new ue;class bV extends ti{constructor(e=new Mn,t=new RS){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,o=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),Xb.copy(n.boundingSphere),Xb.applyMatrix4(i),Xb.radius+=s,e.ray.intersectsSphere(Xb)===!1)return;lR.copy(i).invert(),x2.copy(e.ray).applyMatrix4(lR);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,u=n.index,A=n.attributes.position;if(u!==null){const f=Math.max(0,o.start),p=Math.min(u.count,o.start+o.count);for(let y=f,G=p;y<G;y++){const B=u.getX(y);Yb.fromBufferAttribute(A,B),cR(Yb,B,c,i,e,t,this)}}else{const f=Math.max(0,o.start),p=Math.min(A.count,o.start+o.count);for(let y=f,G=p;y<G;y++)Yb.fromBufferAttribute(A,y),cR(Yb,y,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=i.length;s<o;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function cR(a,e,t,n,i,s,o){const l=x2.distanceSqToPoint(a);if(l<t){const c=new ue;x2.closestPointToPoint(a,c),c.applyMatrix4(n);const u=i.ray.origin.distanceTo(c);if(u<i.near||u>i.far)return;s.push({distance:u,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:o})}}class yV extends fi{constructor(e,t,n,i,s=Pn,o=Pn,l,c,u){super(e,t,n,i,s,o,l,c,u),this.isVideoTexture=!0,this.generateMipmaps=!1,this._requestVideoFrameCallbackId=0;const h=this;function A(){h.needsUpdate=!0,h._requestVideoFrameCallbackId=e.requestVideoFrameCallback(A)}"requestVideoFrameCallback"in e&&(this._requestVideoFrameCallbackId=e.requestVideoFrameCallback(A))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}dispose(){this._requestVideoFrameCallbackId!==0&&(this.source.data.cancelVideoFrameCallback(this._requestVideoFrameCallbackId),this._requestVideoFrameCallbackId=0),super.dispose()}}class nK extends yV{constructor(e,t,n,i,s,o,l,c){super({},e,t,n,i,s,o,l,c),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class iK extends fi{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Ba,this.minFilter=Ba,this.generateMipmaps=!1,this.needsUpdate=!0}}class ev extends fi{constructor(e,t,n,i,s,o,l,c,u,h,A,f){super(null,o,l,c,u,h,i,s,A,f),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class aK extends ev{constructor(e,t,n,i,s,o){super(e,t,n,s,o),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=Ca,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class sK extends ev{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,Vl),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class oK extends fi{constructor(e,t,n,i,s,o,l,c,u){super(e,t,n,i,s,o,l,c,u),this.isCanvasTexture=!0,this.needsUpdate=!0}}class GC extends fi{constructor(e,t,n=fr,i,s,o,l=Ba,c=Ba,u,h=Rc,A=1){if(h!==Rc&&h!==Nu)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");const f={width:e,height:t,depth:A};super(f,i,s,o,l,c,h,n,u),this.isDepthTexture=!0,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Wu(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class vV extends GC{constructor(e,t=fr,n=Vl,i,s,o=Ba,l=Ba,c,u=Rc){const h={width:e,height:e,depth:1},A=[h,h,h,h,h,h];super(e,e,t,n,i,s,o,l,c,u),this.image=A,this.isCubeDepthTexture=!0,this.isCubeTexture=!0}get images(){return this.image}set images(e){this.image=e}}class NS extends fi{constructor(e=null){super(),this.sourceTexture=e,this.isExternalTexture=!0}copy(e){return super.copy(e),this.sourceTexture=e.sourceTexture,this}}class tv extends Mn{constructor(e=1,t=1,n=4,i=8,s=1){super(),this.type="CapsuleGeometry",this.parameters={radius:e,height:t,capSegments:n,radialSegments:i,heightSegments:s},t=Math.max(0,t),n=Math.max(1,Math.floor(n)),i=Math.max(3,Math.floor(i)),s=Math.max(1,Math.floor(s));const o=[],l=[],c=[],u=[],h=t/2,A=Math.PI/2*e,f=t,p=2*A+f,y=n*2+s,G=i+1,B=new ue,S=new ue;for(let N=0;N<=y;N++){let R=0,w=0,V=0,H=0;if(N<=n){const M=N/n,E=M*Math.PI/2;w=-h-e*Math.cos(E),V=e*Math.sin(E),H=-e*Math.cos(E),R=M*A}else if(N<=n+s){const M=(N-n)/s;w=-h+M*t,V=e,H=0,R=A+M*f}else{const M=(N-n-s)/n,E=M*Math.PI/2;w=h+e*Math.sin(E),V=e*Math.cos(E),H=e*Math.sin(E),R=A+f+M*A}const X=Math.max(0,Math.min(1,R/p));let Y=0;N===0?Y=.5/i:N===y&&(Y=-.5/i);for(let M=0;M<=i;M++){const E=M/i,O=E*Math.PI*2,P=Math.sin(O),q=Math.cos(O);S.x=-V*q,S.y=w,S.z=V*P,l.push(S.x,S.y,S.z),B.set(-V*q,H,V*P),B.normalize(),c.push(B.x,B.y,B.z),u.push(E+Y,X)}if(N>0){const M=(N-1)*G;for(let E=0;E<i;E++){const O=M+E,P=M+E+1,q=N*G+E,k=N*G+E+1;o.push(O,P,q),o.push(P,k,q)}}}this.setIndex(o),this.setAttribute("position",new an(l,3)),this.setAttribute("normal",new an(c,3)),this.setAttribute("uv",new an(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new tv(e.radius,e.height,e.capSegments,e.radialSegments,e.heightSegments)}}class nv extends Mn{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],o=[],l=[],c=[],u=new ue,h=new yt;o.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let A=0,f=3;A<=t;A++,f+=3){const p=n+A/t*i;u.x=e*Math.cos(p),u.y=e*Math.sin(p),o.push(u.x,u.y,u.z),l.push(0,0,1),h.x=(o[f]/e+1)/2,h.y=(o[f+1]/e+1)/2,c.push(h.x,h.y)}for(let A=1;A<=t;A++)s.push(A,A+1,0);this.setIndex(s),this.setAttribute("position",new an(o,3)),this.setAttribute("normal",new an(l,3)),this.setAttribute("uv",new an(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new nv(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class Xm extends Mn{constructor(e=1,t=1,n=1,i=32,s=1,o=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:o,thetaStart:l,thetaLength:c};const u=this;i=Math.floor(i),s=Math.floor(s);const h=[],A=[],f=[],p=[];let y=0;const G=[],B=n/2;let S=0;N(),o===!1&&(e>0&&R(!0),t>0&&R(!1)),this.setIndex(h),this.setAttribute("position",new an(A,3)),this.setAttribute("normal",new an(f,3)),this.setAttribute("uv",new an(p,2));function N(){const w=new ue,V=new ue;let H=0;const X=(t-e)/n;for(let Y=0;Y<=s;Y++){const M=[],E=Y/s,O=E*(t-e)+e;for(let P=0;P<=i;P++){const q=P/i,k=q*c+l,le=Math.sin(k),F=Math.cos(k);V.x=O*le,V.y=-E*n+B,V.z=O*F,A.push(V.x,V.y,V.z),w.set(le,X,F).normalize(),f.push(w.x,w.y,w.z),p.push(q,1-E),M.push(y++)}G.push(M)}for(let Y=0;Y<i;Y++)for(let M=0;M<s;M++){const E=G[M][Y],O=G[M+1][Y],P=G[M+1][Y+1],q=G[M][Y+1];(e>0||M!==0)&&(h.push(E,O,q),H+=3),(t>0||M!==s-1)&&(h.push(O,P,q),H+=3)}u.addGroup(S,H,0),S+=H}function R(w){const V=y,H=new yt,X=new ue;let Y=0;const M=w===!0?e:t,E=w===!0?1:-1;for(let P=1;P<=i;P++)A.push(0,B*E,0),f.push(0,E,0),p.push(.5,.5),y++;const O=y;for(let P=0;P<=i;P++){const k=P/i*c+l,le=Math.cos(k),F=Math.sin(k);X.x=M*F,X.y=B*E,X.z=M*le,A.push(X.x,X.y,X.z),f.push(0,E,0),H.x=le*.5+.5,H.y=F*.5*E+.5,p.push(H.x,H.y),y++}for(let P=0;P<i;P++){const q=V+P,k=O+P;w===!0?h.push(k,k+1,q):h.push(k+1,k,q),Y+=3}u.addGroup(S,Y,w===!0?1:2),S+=Y}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xm(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Ym extends Xm{constructor(e=1,t=1,n=32,i=1,s=!1,o=0,l=Math.PI*2){super(0,e,t,n,i,s,o,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:o,thetaLength:l}}static fromJSON(e){return new Ym(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class Tu extends Mn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],o=[];l(i),u(n),h(),this.setAttribute("position",new an(s,3)),this.setAttribute("normal",new an(s.slice(),3)),this.setAttribute("uv",new an(o,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function l(N){const R=new ue,w=new ue,V=new ue;for(let H=0;H<t.length;H+=3)p(t[H+0],R),p(t[H+1],w),p(t[H+2],V),c(R,w,V,N)}function c(N,R,w,V){const H=V+1,X=[];for(let Y=0;Y<=H;Y++){X[Y]=[];const M=N.clone().lerp(w,Y/H),E=R.clone().lerp(w,Y/H),O=H-Y;for(let P=0;P<=O;P++)P===0&&Y===H?X[Y][P]=M:X[Y][P]=M.clone().lerp(E,P/O)}for(let Y=0;Y<H;Y++)for(let M=0;M<2*(H-Y)-1;M++){const E=Math.floor(M/2);M%2===0?(f(X[Y][E+1]),f(X[Y+1][E]),f(X[Y][E])):(f(X[Y][E+1]),f(X[Y+1][E+1]),f(X[Y+1][E]))}}function u(N){const R=new ue;for(let w=0;w<s.length;w+=3)R.x=s[w+0],R.y=s[w+1],R.z=s[w+2],R.normalize().multiplyScalar(N),s[w+0]=R.x,s[w+1]=R.y,s[w+2]=R.z}function h(){const N=new ue;for(let R=0;R<s.length;R+=3){N.x=s[R+0],N.y=s[R+1],N.z=s[R+2];const w=B(N)/2/Math.PI+.5,V=S(N)/Math.PI+.5;o.push(w,1-V)}y(),A()}function A(){for(let N=0;N<o.length;N+=6){const R=o[N+0],w=o[N+2],V=o[N+4],H=Math.max(R,w,V),X=Math.min(R,w,V);H>.9&&X<.1&&(R<.2&&(o[N+0]+=1),w<.2&&(o[N+2]+=1),V<.2&&(o[N+4]+=1))}}function f(N){s.push(N.x,N.y,N.z)}function p(N,R){const w=N*3;R.x=e[w+0],R.y=e[w+1],R.z=e[w+2]}function y(){const N=new ue,R=new ue,w=new ue,V=new ue,H=new yt,X=new yt,Y=new yt;for(let M=0,E=0;M<s.length;M+=9,E+=6){N.set(s[M+0],s[M+1],s[M+2]),R.set(s[M+3],s[M+4],s[M+5]),w.set(s[M+6],s[M+7],s[M+8]),H.set(o[E+0],o[E+1]),X.set(o[E+2],o[E+3]),Y.set(o[E+4],o[E+5]),V.copy(N).add(R).add(w).divideScalar(3);const O=B(V);G(H,E+0,N,O),G(X,E+2,R,O),G(Y,E+4,w,O)}}function G(N,R,w,V){V<0&&N.x===1&&(o[R]=N.x-1),w.x===0&&w.z===0&&(o[R]=V/2/Math.PI+.5)}function B(N){return Math.atan2(N.z,-N.x)}function S(N){return Math.atan2(-N.y,Math.sqrt(N.x*N.x+N.z*N.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Tu(e.vertices,e.indices,e.radius,e.detail)}}class iv extends Tu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],o=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,o,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new iv(e.radius,e.detail)}}const Hb=new ue,Eb=new ue,aB=new ue,Fb=new Lo;class WS extends Mn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(cI*t),o=e.getIndex(),l=e.getAttribute("position"),c=o?o.count:l.count,u=[0,0,0],h=["a","b","c"],A=new Array(3),f={},p=[];for(let y=0;y<c;y+=3){o?(u[0]=o.getX(y),u[1]=o.getX(y+1),u[2]=o.getX(y+2)):(u[0]=y,u[1]=y+1,u[2]=y+2);const{a:G,b:B,c:S}=Fb;if(G.fromBufferAttribute(l,u[0]),B.fromBufferAttribute(l,u[1]),S.fromBufferAttribute(l,u[2]),Fb.getNormal(aB),A[0]=`${Math.round(G.x*i)},${Math.round(G.y*i)},${Math.round(G.z*i)}`,A[1]=`${Math.round(B.x*i)},${Math.round(B.y*i)},${Math.round(B.z*i)}`,A[2]=`${Math.round(S.x*i)},${Math.round(S.y*i)},${Math.round(S.z*i)}`,!(A[0]===A[1]||A[1]===A[2]||A[2]===A[0]))for(let N=0;N<3;N++){const R=(N+1)%3,w=A[N],V=A[R],H=Fb[h[N]],X=Fb[h[R]],Y=`${w}_${V}`,M=`${V}_${w}`;M in f&&f[M]?(aB.dot(f[M].normal)<=s&&(p.push(H.x,H.y,H.z),p.push(X.x,X.y,X.z)),f[M]=null):Y in f||(f[Y]={index0:u[N],index1:u[R],normal:aB.clone()})}}for(const y in f)if(f[y]){const{index0:G,index1:B}=f[y];Hb.fromBufferAttribute(l,G),Eb.fromBufferAttribute(l,B),p.push(Hb.x,Hb.y,Hb.z),p.push(Eb.x,Eb.y,Eb.z)}this.setAttribute("position",new an(p,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class _l{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){Qt("Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let o=1;o<=e;o++)n=this.getPoint(o/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const s=n.length;let o;t?o=t:o=e*n[s-1];let l=0,c=s-1,u;for(;l<=c;)if(i=Math.floor(l+(c-l)/2),u=n[i]-o,u<0)l=i+1;else if(u>0)c=i-1;else{c=i;break}if(i=c,n[i]===o)return i/(s-1);const h=n[i],f=n[i+1]-h,p=(o-h)/f;return(i+p)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const o=this.getPoint(i),l=this.getPoint(s),c=t||(o.isVector2?new yt:new ue);return c.copy(l).sub(o).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new ue,i=[],s=[],o=[],l=new ue,c=new pn;for(let p=0;p<=e;p++){const y=p/e;i[p]=this.getTangentAt(y,new ue)}s[0]=new ue,o[0]=new ue;let u=Number.MAX_VALUE;const h=Math.abs(i[0].x),A=Math.abs(i[0].y),f=Math.abs(i[0].z);h<=u&&(u=h,n.set(1,0,0)),A<=u&&(u=A,n.set(0,1,0)),f<=u&&n.set(0,0,1),l.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],l),o[0].crossVectors(i[0],s[0]);for(let p=1;p<=e;p++){if(s[p]=s[p-1].clone(),o[p]=o[p-1].clone(),l.crossVectors(i[p-1],i[p]),l.length()>Number.EPSILON){l.normalize();const y=Math.acos(Zn(i[p-1].dot(i[p]),-1,1));s[p].applyMatrix4(c.makeRotationAxis(l,y))}o[p].crossVectors(i[p],s[p])}if(t===!0){let p=Math.acos(Zn(s[0].dot(s[e]),-1,1));p/=e,i[0].dot(l.crossVectors(s[0],s[e]))>0&&(p=-p);for(let y=1;y<=e;y++)s[y].applyMatrix4(c.makeRotationAxis(i[y],p*y)),o[y].crossVectors(i[y],s[y])}return{tangents:i,normals:s,binormals:o}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.7,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class av extends _l{constructor(e=0,t=0,n=1,i=1,s=0,o=Math.PI*2,l=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=o,this.aClockwise=l,this.aRotation=c}getPoint(e,t=new yt){const n=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const o=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(o?s=0:s=i),this.aClockwise===!0&&!o&&(s===i?s=-i:s=s-i);const l=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(l),u=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const h=Math.cos(this.aRotation),A=Math.sin(this.aRotation),f=c-this.aX,p=u-this.aY;c=f*h-p*A+this.aX,u=f*A+p*h+this.aY}return n.set(c,u)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class GV extends av{constructor(e,t,n,i,s,o){super(e,t,n,n,i,s,o),this.isArcCurve=!0,this.type="ArcCurve"}}function VS(){let a=0,e=0,t=0,n=0;function i(s,o,l,c){a=s,e=l,t=-3*s+3*o-2*l-c,n=2*s-2*o+l+c}return{initCatmullRom:function(s,o,l,c,u){i(o,l,u*(l-s),u*(c-o))},initNonuniformCatmullRom:function(s,o,l,c,u,h,A){let f=(o-s)/u-(l-s)/(u+h)+(l-o)/h,p=(l-o)/h-(c-o)/(h+A)+(c-l)/A;f*=h,p*=h,i(o,l,f,p)},calc:function(s){const o=s*s,l=o*s;return a+e*s+t*o+n*l}}}const Kb=new ue,sB=new VS,oB=new VS,rB=new VS;class BV extends _l{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new ue){const n=t,i=this.points,s=i.length,o=(s-(this.closed?0:1))*e;let l=Math.floor(o),c=o-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:c===0&&l===s-1&&(l=s-2,c=1);let u,h;this.closed||l>0?u=i[(l-1)%s]:(Kb.subVectors(i[0],i[1]).add(i[0]),u=Kb);const A=i[l%s],f=i[(l+1)%s];if(this.closed||l+2<s?h=i[(l+2)%s]:(Kb.subVectors(i[s-1],i[s-2]).add(i[s-1]),h=Kb),this.curveType==="centripetal"||this.curveType==="chordal"){const p=this.curveType==="chordal"?.5:.25;let y=Math.pow(u.distanceToSquared(A),p),G=Math.pow(A.distanceToSquared(f),p),B=Math.pow(f.distanceToSquared(h),p);G<1e-4&&(G=1),y<1e-4&&(y=G),B<1e-4&&(B=G),sB.initNonuniformCatmullRom(u.x,A.x,f.x,h.x,y,G,B),oB.initNonuniformCatmullRom(u.y,A.y,f.y,h.y,y,G,B),rB.initNonuniformCatmullRom(u.z,A.z,f.z,h.z,y,G,B)}else this.curveType==="catmullrom"&&(sB.initCatmullRom(u.x,A.x,f.x,h.x,this.tension),oB.initCatmullRom(u.y,A.y,f.y,h.y,this.tension),rB.initCatmullRom(u.z,A.z,f.z,h.z,this.tension));return n.set(sB.calc(c),oB.calc(c),rB.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new ue().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function gR(a,e,t,n,i){const s=(n-e)*.5,o=(i-t)*.5,l=a*a,c=a*l;return(2*t-2*n+s+o)*c+(-3*t+3*n-2*s-o)*l+s*a+t}function rK(a,e){const t=1-a;return t*t*e}function lK(a,e){return 2*(1-a)*a*e}function cK(a,e){return a*a*e}function Lf(a,e,t,n){return rK(a,e)+lK(a,t)+cK(a,n)}function gK(a,e){const t=1-a;return t*t*t*e}function uK(a,e){const t=1-a;return 3*t*t*a*e}function dK(a,e){return 3*(1-a)*a*a*e}function IK(a,e){return a*a*a*e}function kf(a,e,t,n,i){return gK(a,e)+uK(a,t)+dK(a,n)+IK(a,i)}class MS extends _l{constructor(e=new yt,t=new yt,n=new yt,i=new yt){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new yt){const n=t,i=this.v0,s=this.v1,o=this.v2,l=this.v3;return n.set(kf(e,i.x,s.x,o.x,l.x),kf(e,i.y,s.y,o.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class SV extends _l{constructor(e=new ue,t=new ue,n=new ue,i=new ue){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new ue){const n=t,i=this.v0,s=this.v1,o=this.v2,l=this.v3;return n.set(kf(e,i.x,s.x,o.x,l.x),kf(e,i.y,s.y,o.y,l.y),kf(e,i.z,s.z,o.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class _S extends _l{constructor(e=new yt,t=new yt){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new yt){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new yt){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class xV extends _l{constructor(e=new ue,t=new ue){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new ue){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new ue){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class XS extends _l{constructor(e=new yt,t=new yt,n=new yt){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new yt){const n=t,i=this.v0,s=this.v1,o=this.v2;return n.set(Lf(e,i.x,s.x,o.x),Lf(e,i.y,s.y,o.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class YS extends _l{constructor(e=new ue,t=new ue,n=new ue){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new ue){const n=t,i=this.v0,s=this.v1,o=this.v2;return n.set(Lf(e,i.x,s.x,o.x),Lf(e,i.y,s.y,o.y),Lf(e,i.z,s.z,o.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class HS extends _l{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new yt){const n=t,i=this.points,s=(i.length-1)*e,o=Math.floor(s),l=s-o,c=i[o===0?o:o-1],u=i[o],h=i[o>i.length-2?i.length-1:o+1],A=i[o>i.length-3?i.length-1:o+2];return n.set(gR(l,c.x,u.x,h.x,A.x),gR(l,c.y,u.y,h.y,A.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new yt().fromArray(i))}return this}}var my=Object.freeze({__proto__:null,ArcCurve:GV,CatmullRomCurve3:BV,CubicBezierCurve:MS,CubicBezierCurve3:SV,EllipseCurve:av,LineCurve:_S,LineCurve3:xV,QuadraticBezierCurve:XS,QuadraticBezierCurve3:YS,SplineCurve:HS});class ZV extends _l{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new my[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const o=i[s]-n,l=this.curves[s],c=l.getLength(),u=c===0?0:1-o/c;return l.getPointAt(u,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const o=s[i],l=o.isEllipseCurve?e*2:o.isLineCurve||o.isLineCurve3?1:o.isSplineCurve?e*o.points.length:e,c=o.getPoints(l);for(let u=0;u<c.length;u++){const h=c[u];n&&n.equals(h)||(t.push(h),n=h)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new my[i.type]().fromJSON(i))}return this}}class py extends ZV{constructor(e){super(),this.type="Path",this.currentPoint=new yt,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new _S(this.currentPoint.clone(),new yt(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new XS(this.currentPoint.clone(),new yt(e,t),new yt(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,o){const l=new MS(this.currentPoint.clone(),new yt(e,t),new yt(n,i),new yt(s,o));return this.curves.push(l),this.currentPoint.set(s,o),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new HS(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,o){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+l,t+c,n,i,s,o),this}absarc(e,t,n,i,s,o){return this.absellipse(e,t,n,n,i,s,o),this}ellipse(e,t,n,i,s,o,l,c){const u=this.currentPoint.x,h=this.currentPoint.y;return this.absellipse(e+u,t+h,n,i,s,o,l,c),this}absellipse(e,t,n,i,s,o,l,c){const u=new av(e,t,n,i,s,o,l,c);if(this.curves.length>0){const A=u.getPoint(0);A.equals(this.currentPoint)||this.lineTo(A.x,A.y)}this.curves.push(u);const h=u.getPoint(1);return this.currentPoint.copy(h),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}let gI=class extends py{constructor(e){super(e),this.uuid=Cr(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new py().fromJSON(i))}return this}};function hK(a,e,t=2){const n=e&&e.length,i=n?e[0]*t:a.length;let s=wV(a,0,i,t,!0);const o=[];if(!s||s.next===s.prev)return o;let l,c,u;if(n&&(s=pK(a,e,s,t)),a.length>80*t){l=a[0],c=a[1];let h=l,A=c;for(let f=t;f<i;f+=t){const p=a[f],y=a[f+1];p<l&&(l=p),y<c&&(c=y),p>h&&(h=p),y>A&&(A=y)}u=Math.max(h-l,A-c),u=u!==0?32767/u:0}return hm(s,o,t,l,c,u,0),o}function wV(a,e,t,n,i){let s;if(i===NK(a,e,t,n)>0)for(let o=e;o<t;o+=n)s=uR(o/n|0,a[o],a[o+1],s);else for(let o=t-n;o>=e;o-=n)s=uR(o/n|0,a[o],a[o+1],s);return s&&BC(s,s.next)&&(Am(s),s=s.next),s}function AI(a,e){if(!a)return a;e||(e=a);let t=a,n;do if(n=!1,!t.steiner&&(BC(t,t.next)||oa(t.prev,t,t.next)===0)){if(Am(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function hm(a,e,t,n,i,s,o){if(!a)return;!o&&s&&BK(a,n,i,s);let l=a;for(;a.prev!==a.next;){const c=a.prev,u=a.next;if(s?AK(a,n,i,s):CK(a)){e.push(c.i,a.i,u.i),Am(a),a=u.next,l=u.next;continue}if(a=u,a===l){o?o===1?(a=fK(AI(a),e),hm(a,e,t,n,i,s,2)):o===2&&mK(a,e,t,n,i,s):hm(AI(a),e,t,n,i,s,1);break}}}function CK(a){const e=a.prev,t=a,n=a.next;if(oa(e,t,n)>=0)return!1;const i=e.x,s=t.x,o=n.x,l=e.y,c=t.y,u=n.y,h=Math.min(i,s,o),A=Math.min(l,c,u),f=Math.max(i,s,o),p=Math.max(l,c,u);let y=n.next;for(;y!==e;){if(y.x>=h&&y.x<=f&&y.y>=A&&y.y<=p&&Rf(i,l,s,c,o,u,y.x,y.y)&&oa(y.prev,y,y.next)>=0)return!1;y=y.next}return!0}function AK(a,e,t,n){const i=a.prev,s=a,o=a.next;if(oa(i,s,o)>=0)return!1;const l=i.x,c=s.x,u=o.x,h=i.y,A=s.y,f=o.y,p=Math.min(l,c,u),y=Math.min(h,A,f),G=Math.max(l,c,u),B=Math.max(h,A,f),S=Z2(p,y,e,t,n),N=Z2(G,B,e,t,n);let R=a.prevZ,w=a.nextZ;for(;R&&R.z>=S&&w&&w.z<=N;){if(R.x>=p&&R.x<=G&&R.y>=y&&R.y<=B&&R!==i&&R!==o&&Rf(l,h,c,A,u,f,R.x,R.y)&&oa(R.prev,R,R.next)>=0||(R=R.prevZ,w.x>=p&&w.x<=G&&w.y>=y&&w.y<=B&&w!==i&&w!==o&&Rf(l,h,c,A,u,f,w.x,w.y)&&oa(w.prev,w,w.next)>=0))return!1;w=w.nextZ}for(;R&&R.z>=S;){if(R.x>=p&&R.x<=G&&R.y>=y&&R.y<=B&&R!==i&&R!==o&&Rf(l,h,c,A,u,f,R.x,R.y)&&oa(R.prev,R,R.next)>=0)return!1;R=R.prevZ}for(;w&&w.z<=N;){if(w.x>=p&&w.x<=G&&w.y>=y&&w.y<=B&&w!==i&&w!==o&&Rf(l,h,c,A,u,f,w.x,w.y)&&oa(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function fK(a,e){let t=a;do{const n=t.prev,i=t.next.next;!BC(n,i)&&NV(n,t,t.next,i)&&Cm(n,i)&&Cm(i,n)&&(e.push(n.i,t.i,i.i),Am(t),Am(t.next),t=a=i),t=t.next}while(t!==a);return AI(t)}function mK(a,e,t,n,i,s){let o=a;do{let l=o.next.next;for(;l!==o.prev;){if(o.i!==l.i&&ZK(o,l)){let c=WV(o,l);o=AI(o,o.next),c=AI(c,c.next),hm(o,e,t,n,i,s,0),hm(c,e,t,n,i,s,0);return}l=l.next}o=o.next}while(o!==a)}function pK(a,e,t,n){const i=[];for(let s=0,o=e.length;s<o;s++){const l=e[s]*n,c=s<o-1?e[s+1]*n:a.length,u=wV(a,l,c,n,!1);u===u.next&&(u.steiner=!0),i.push(xK(u))}i.sort(bK);for(let s=0;s<i.length;s++)t=yK(i[s],t);return t}function bK(a,e){let t=a.x-e.x;if(t===0&&(t=a.y-e.y,t===0)){const n=(a.next.y-a.y)/(a.next.x-a.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=n-i}return t}function yK(a,e){const t=vK(a,e);if(!t)return e;const n=WV(t,a);return AI(n,n.next),AI(t,t.next)}function vK(a,e){let t=e;const n=a.x,i=a.y;let s=-1/0,o;if(BC(a,t))return t;do{if(BC(a,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const A=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(A<=n&&A>s&&(s=A,o=t.x<t.next.x?t:t.next,A===n))return o}t=t.next}while(t!==e);if(!o)return null;const l=o,c=o.x,u=o.y;let h=1/0;t=o;do{if(n>=t.x&&t.x>=c&&n!==t.x&&RV(i<u?n:s,i,c,u,i<u?s:n,i,t.x,t.y)){const A=Math.abs(i-t.y)/(n-t.x);Cm(t,a)&&(A<h||A===h&&(t.x>o.x||t.x===o.x&&GK(o,t)))&&(o=t,h=A)}t=t.next}while(t!==l);return o}function GK(a,e){return oa(a.prev,a,e.prev)<0&&oa(e.next,a,a.next)<0}function BK(a,e,t,n){let i=a;do i.z===0&&(i.z=Z2(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==a);i.prevZ.nextZ=null,i.prevZ=null,SK(i)}function SK(a){let e,t=1;do{let n=a,i;a=null;let s=null;for(e=0;n;){e++;let o=n,l=0;for(let u=0;u<t&&(l++,o=o.nextZ,!!o);u++);let c=t;for(;l>0||c>0&&o;)l!==0&&(c===0||!o||n.z<=o.z)?(i=n,n=n.nextZ,l--):(i=o,o=o.nextZ,c--),s?s.nextZ=i:a=i,i.prevZ=s,s=i;n=o}s.nextZ=null,t*=2}while(e>1);return a}function Z2(a,e,t,n,i){return a=(a-t)*i|0,e=(e-n)*i|0,a=(a|a<<8)&16711935,a=(a|a<<4)&252645135,a=(a|a<<2)&858993459,a=(a|a<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,a|e<<1}function xK(a){let e=a,t=a;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==a);return t}function RV(a,e,t,n,i,s,o,l){return(i-o)*(e-l)>=(a-o)*(s-l)&&(a-o)*(n-l)>=(t-o)*(e-l)&&(t-o)*(s-l)>=(i-o)*(n-l)}function Rf(a,e,t,n,i,s,o,l){return!(a===o&&e===l)&&RV(a,e,t,n,i,s,o,l)}function ZK(a,e){return a.next.i!==e.i&&a.prev.i!==e.i&&!wK(a,e)&&(Cm(a,e)&&Cm(e,a)&&RK(a,e)&&(oa(a.prev,a,e.prev)||oa(a,e.prev,e))||BC(a,e)&&oa(a.prev,a,a.next)>0&&oa(e.prev,e,e.next)>0)}function oa(a,e,t){return(e.y-a.y)*(t.x-e.x)-(e.x-a.x)*(t.y-e.y)}function BC(a,e){return a.x===e.x&&a.y===e.y}function NV(a,e,t,n){const i=zb(oa(a,e,t)),s=zb(oa(a,e,n)),o=zb(oa(t,n,a)),l=zb(oa(t,n,e));return!!(i!==s&&o!==l||i===0&&Tb(a,t,e)||s===0&&Tb(a,n,e)||o===0&&Tb(t,a,n)||l===0&&Tb(t,e,n))}function Tb(a,e,t){return e.x<=Math.max(a.x,t.x)&&e.x>=Math.min(a.x,t.x)&&e.y<=Math.max(a.y,t.y)&&e.y>=Math.min(a.y,t.y)}function zb(a){return a>0?1:a<0?-1:0}function wK(a,e){let t=a;do{if(t.i!==a.i&&t.next.i!==a.i&&t.i!==e.i&&t.next.i!==e.i&&NV(t,t.next,a,e))return!0;t=t.next}while(t!==a);return!1}function Cm(a,e){return oa(a.prev,a,a.next)<0?oa(a,e,a.next)>=0&&oa(a,a.prev,e)>=0:oa(a,e,a.prev)<0||oa(a,a.next,e)<0}function RK(a,e){let t=a,n=!1;const i=(a.x+e.x)/2,s=(a.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==a);return n}function WV(a,e){const t=w2(a.i,a.x,a.y),n=w2(e.i,e.x,e.y),i=a.next,s=e.prev;return a.next=e,e.prev=a,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function uR(a,e,t,n){const i=w2(a,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function Am(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function w2(a,e,t){return{i:a,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function NK(a,e,t,n){let i=0;for(let s=e,o=t-n;s<t;s+=n)i+=(a[o]-a[s])*(a[s+1]+a[o+1]),o=s;return i}class WK{static triangulate(e,t,n=2){return hK(e,t,n)}}class Nl{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return n*.5}static isClockWise(e){return Nl.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];dR(e),IR(n,e);let o=e.length;t.forEach(dR);for(let c=0;c<t.length;c++)i.push(o),o+=t[c].length,IR(n,t[c]);const l=WK.triangulate(n,i);for(let c=0;c<l.length;c+=3)s.push(l.slice(c,c+3));return s}}function dR(a){const e=a.length;e>2&&a[e-1].equals(a[0])&&a.pop()}function IR(a,e){for(let t=0;t<e.length;t++)a.push(e[t].x),a.push(e[t].y)}class sv extends Mn{constructor(e=new gI([new yt(.5,.5),new yt(-.5,.5),new yt(-.5,-.5),new yt(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],s=[];for(let l=0,c=e.length;l<c;l++){const u=e[l];o(u)}this.setAttribute("position",new an(i,3)),this.setAttribute("uv",new an(s,2)),this.computeVertexNormals();function o(l){const c=[],u=t.curveSegments!==void 0?t.curveSegments:12,h=t.steps!==void 0?t.steps:1,A=t.depth!==void 0?t.depth:1;let f=t.bevelEnabled!==void 0?t.bevelEnabled:!0,p=t.bevelThickness!==void 0?t.bevelThickness:.2,y=t.bevelSize!==void 0?t.bevelSize:p-.1,G=t.bevelOffset!==void 0?t.bevelOffset:0,B=t.bevelSegments!==void 0?t.bevelSegments:3;const S=t.extrudePath,N=t.UVGenerator!==void 0?t.UVGenerator:VK;let R,w=!1,V,H,X,Y;if(S){R=S.getSpacedPoints(h),w=!0,f=!1;const Ke=S.isCatmullRomCurve3?S.closed:!1;V=S.computeFrenetFrames(h,Ke),H=new ue,X=new ue,Y=new ue}f||(B=0,p=0,y=0,G=0);const M=l.extractPoints(u);let E=M.shape;const O=M.holes;if(!Nl.isClockWise(E)){E=E.reverse();for(let Ke=0,Qe=O.length;Ke<Qe;Ke++){const Le=O[Ke];Nl.isClockWise(Le)&&(O[Ke]=Le.reverse())}}function q(Ke){const Le=10000000000000001e-36;let dt=Ke[0];for(let se=1;se<=Ke.length;se++){const ht=se%Ke.length,it=Ke[ht],Fe=it.x-dt.x,st=it.y-dt.y,ie=Fe*Fe+st*st,z=Math.max(Math.abs(it.x),Math.abs(it.y),Math.abs(dt.x),Math.abs(dt.y)),Ae=Le*z*z;if(ie<=Ae){Ke.splice(ht,1),se--;continue}dt=it}}q(E),O.forEach(q);const k=O.length,le=E;for(let Ke=0;Ke<k;Ke++){const Qe=O[Ke];E=E.concat(Qe)}function F(Ke,Qe,Le){return Qe||Cn("ExtrudeGeometry: vec does not exist"),Ke.clone().addScaledVector(Qe,Le)}const j=E.length;function Q(Ke,Qe,Le){let dt,se,ht;const it=Ke.x-Qe.x,Fe=Ke.y-Qe.y,st=Le.x-Ke.x,ie=Le.y-Ke.y,z=it*it+Fe*Fe,Ae=it*ie-Fe*st;if(Math.abs(Ae)>Number.EPSILON){const Oe=Math.sqrt(z),He=Math.sqrt(st*st+ie*ie),Me=Qe.x-Fe/Oe,It=Qe.y+it/Oe,ft=Le.x-ie/He,Ht=Le.y+st/He,kt=((ft-Me)*ie-(Ht-It)*st)/(it*ie-Fe*st);dt=Me+it*kt-Ke.x,se=It+Fe*kt-Ke.y;const Pe=dt*dt+se*se;if(Pe<=2)return new yt(dt,se);ht=Math.sqrt(Pe/2)}else{let Oe=!1;it>Number.EPSILON?st>Number.EPSILON&&(Oe=!0):it<-Number.EPSILON?st<-Number.EPSILON&&(Oe=!0):Math.sign(Fe)===Math.sign(ie)&&(Oe=!0),Oe?(dt=-Fe,se=it,ht=Math.sqrt(z)):(dt=it,se=Fe,ht=Math.sqrt(z/2))}return new yt(dt/ht,se/ht)}const ce=[];for(let Ke=0,Qe=le.length,Le=Qe-1,dt=Ke+1;Ke<Qe;Ke++,Le++,dt++)Le===Qe&&(Le=0),dt===Qe&&(dt=0),ce[Ke]=Q(le[Ke],le[Le],le[dt]);const oe=[];let T,$=ce.concat();for(let Ke=0,Qe=k;Ke<Qe;Ke++){const Le=O[Ke];T=[];for(let dt=0,se=Le.length,ht=se-1,it=dt+1;dt<se;dt++,ht++,it++)ht===se&&(ht=0),it===se&&(it=0),T[dt]=Q(Le[dt],Le[ht],Le[it]);oe.push(T),$=$.concat(T)}let ae;if(B===0)ae=Nl.triangulateShape(le,O);else{const Ke=[],Qe=[];for(let Le=0;Le<B;Le++){const dt=Le/B,se=p*Math.cos(dt*Math.PI/2),ht=y*Math.sin(dt*Math.PI/2)+G;for(let it=0,Fe=le.length;it<Fe;it++){const st=F(le[it],ce[it],ht);Ce(st.x,st.y,-se),dt===0&&Ke.push(st)}for(let it=0,Fe=k;it<Fe;it++){const st=O[it];T=oe[it];const ie=[];for(let z=0,Ae=st.length;z<Ae;z++){const Oe=F(st[z],T[z],ht);Ce(Oe.x,Oe.y,-se),dt===0&&ie.push(Oe)}dt===0&&Qe.push(ie)}}ae=Nl.triangulateShape(Ke,Qe)}const Ie=ae.length,be=y+G;for(let Ke=0;Ke<j;Ke++){const Qe=f?F(E[Ke],$[Ke],be):E[Ke];w?(X.copy(V.normals[0]).multiplyScalar(Qe.x),H.copy(V.binormals[0]).multiplyScalar(Qe.y),Y.copy(R[0]).add(X).add(H),Ce(Y.x,Y.y,Y.z)):Ce(Qe.x,Qe.y,0)}for(let Ke=1;Ke<=h;Ke++)for(let Qe=0;Qe<j;Qe++){const Le=f?F(E[Qe],$[Qe],be):E[Qe];w?(X.copy(V.normals[Ke]).multiplyScalar(Le.x),H.copy(V.binormals[Ke]).multiplyScalar(Le.y),Y.copy(R[Ke]).add(X).add(H),Ce(Y.x,Y.y,Y.z)):Ce(Le.x,Le.y,A/h*Ke)}for(let Ke=B-1;Ke>=0;Ke--){const Qe=Ke/B,Le=p*Math.cos(Qe*Math.PI/2),dt=y*Math.sin(Qe*Math.PI/2)+G;for(let se=0,ht=le.length;se<ht;se++){const it=F(le[se],ce[se],dt);Ce(it.x,it.y,A+Le)}for(let se=0,ht=O.length;se<ht;se++){const it=O[se];T=oe[se];for(let Fe=0,st=it.length;Fe<st;Fe++){const ie=F(it[Fe],T[Fe],dt);w?Ce(ie.x,ie.y+R[h-1].y,R[h-1].x+Le):Ce(ie.x,ie.y,A+Le)}}}D(),de();function D(){const Ke=i.length/3;if(f){let Qe=0,Le=j*Qe;for(let dt=0;dt<Ie;dt++){const se=ae[dt];we(se[2]+Le,se[1]+Le,se[0]+Le)}Qe=h+B*2,Le=j*Qe;for(let dt=0;dt<Ie;dt++){const se=ae[dt];we(se[0]+Le,se[1]+Le,se[2]+Le)}}else{for(let Qe=0;Qe<Ie;Qe++){const Le=ae[Qe];we(Le[2],Le[1],Le[0])}for(let Qe=0;Qe<Ie;Qe++){const Le=ae[Qe];we(Le[0]+j*h,Le[1]+j*h,Le[2]+j*h)}}n.addGroup(Ke,i.length/3-Ke,0)}function de(){const Ke=i.length/3;let Qe=0;ee(le,Qe),Qe+=le.length;for(let Le=0,dt=O.length;Le<dt;Le++){const se=O[Le];ee(se,Qe),Qe+=se.length}n.addGroup(Ke,i.length/3-Ke,1)}function ee(Ke,Qe){let Le=Ke.length;for(;--Le>=0;){const dt=Le;let se=Le-1;se<0&&(se=Ke.length-1);for(let ht=0,it=h+B*2;ht<it;ht++){const Fe=j*ht,st=j*(ht+1),ie=Qe+dt+Fe,z=Qe+se+Fe,Ae=Qe+se+st,Oe=Qe+dt+st;Ye(ie,z,Ae,Oe)}}}function Ce(Ke,Qe,Le){c.push(Ke),c.push(Qe),c.push(Le)}function we(Ke,Qe,Le){Ee(Ke),Ee(Qe),Ee(Le);const dt=i.length/3,se=N.generateTopUV(n,i,dt-3,dt-2,dt-1);pt(se[0]),pt(se[1]),pt(se[2])}function Ye(Ke,Qe,Le,dt){Ee(Ke),Ee(Qe),Ee(dt),Ee(Qe),Ee(Le),Ee(dt);const se=i.length/3,ht=N.generateSideWallUV(n,i,se-6,se-3,se-2,se-1);pt(ht[0]),pt(ht[1]),pt(ht[3]),pt(ht[1]),pt(ht[2]),pt(ht[3])}function Ee(Ke){i.push(c[Ke*3+0]),i.push(c[Ke*3+1]),i.push(c[Ke*3+2])}function pt(Ke){s.push(Ke.x),s.push(Ke.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return MK(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,o=e.shapes.length;s<o;s++){const l=t[e.shapes[s]];n.push(l)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new my[i.type]().fromJSON(i)),new sv(n,e.options)}}const VK={generateTopUV:function(a,e,t,n,i){const s=e[t*3],o=e[t*3+1],l=e[n*3],c=e[n*3+1],u=e[i*3],h=e[i*3+1];return[new yt(s,o),new yt(l,c),new yt(u,h)]},generateSideWallUV:function(a,e,t,n,i,s){const o=e[t*3],l=e[t*3+1],c=e[t*3+2],u=e[n*3],h=e[n*3+1],A=e[n*3+2],f=e[i*3],p=e[i*3+1],y=e[i*3+2],G=e[s*3],B=e[s*3+1],S=e[s*3+2];return Math.abs(l-h)<Math.abs(o-u)?[new yt(o,1-c),new yt(u,1-A),new yt(f,1-y),new yt(G,1-S)]:[new yt(l,1-c),new yt(h,1-A),new yt(p,1-y),new yt(B,1-S)]}};function MK(a,e,t){if(t.shapes=[],Array.isArray(a))for(let n=0,i=a.length;n<i;n++){const s=a[n];t.shapes.push(s.uuid)}else t.shapes.push(a.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class Hm extends Tu{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Hm(e.radius,e.detail)}}class ov extends Mn{constructor(e=[new yt(0,-.5),new yt(.5,0),new yt(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=Zn(i,0,Math.PI*2);const s=[],o=[],l=[],c=[],u=[],h=1/t,A=new ue,f=new yt,p=new ue,y=new ue,G=new ue;let B=0,S=0;for(let N=0;N<=e.length-1;N++)switch(N){case 0:B=e[N+1].x-e[N].x,S=e[N+1].y-e[N].y,p.x=S*1,p.y=-B,p.z=S*0,G.copy(p),p.normalize(),c.push(p.x,p.y,p.z);break;case e.length-1:c.push(G.x,G.y,G.z);break;default:B=e[N+1].x-e[N].x,S=e[N+1].y-e[N].y,p.x=S*1,p.y=-B,p.z=S*0,y.copy(p),p.x+=G.x,p.y+=G.y,p.z+=G.z,p.normalize(),c.push(p.x,p.y,p.z),G.copy(y)}for(let N=0;N<=t;N++){const R=n+N*h*i,w=Math.sin(R),V=Math.cos(R);for(let H=0;H<=e.length-1;H++){A.x=e[H].x*w,A.y=e[H].y,A.z=e[H].x*V,o.push(A.x,A.y,A.z),f.x=N/t,f.y=H/(e.length-1),l.push(f.x,f.y);const X=c[3*H+0]*w,Y=c[3*H+1],M=c[3*H+0]*V;u.push(X,Y,M)}}for(let N=0;N<t;N++)for(let R=0;R<e.length-1;R++){const w=R+N*e.length,V=w,H=w+e.length,X=w+e.length+1,Y=w+1;s.push(V,H,Y),s.push(X,Y,H)}this.setIndex(s),this.setAttribute("position",new an(o,3)),this.setAttribute("uv",new an(l,2)),this.setAttribute("normal",new an(u,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ov(e.points,e.segments,e.phiStart,e.phiLength)}}class Em extends Tu{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Em(e.radius,e.detail)}}class Xl extends Mn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,o=t/2,l=Math.floor(n),c=Math.floor(i),u=l+1,h=c+1,A=e/l,f=t/c,p=[],y=[],G=[],B=[];for(let S=0;S<h;S++){const N=S*f-o;for(let R=0;R<u;R++){const w=R*A-s;y.push(w,-N,0),G.push(0,0,1),B.push(R/l),B.push(1-S/c)}}for(let S=0;S<c;S++)for(let N=0;N<l;N++){const R=N+u*S,w=N+u*(S+1),V=N+1+u*(S+1),H=N+1+u*S;p.push(R,w,H),p.push(w,V,H)}this.setIndex(p),this.setAttribute("position",new an(y,3)),this.setAttribute("normal",new an(G,3)),this.setAttribute("uv",new an(B,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Xl(e.width,e.height,e.widthSegments,e.heightSegments)}}class rv extends Mn{constructor(e=.5,t=1,n=32,i=1,s=0,o=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:o},n=Math.max(3,n),i=Math.max(1,i);const l=[],c=[],u=[],h=[];let A=e;const f=(t-e)/i,p=new ue,y=new yt;for(let G=0;G<=i;G++){for(let B=0;B<=n;B++){const S=s+B/n*o;p.x=A*Math.cos(S),p.y=A*Math.sin(S),c.push(p.x,p.y,p.z),u.push(0,0,1),y.x=(p.x/t+1)/2,y.y=(p.y/t+1)/2,h.push(y.x,y.y)}A+=f}for(let G=0;G<i;G++){const B=G*(n+1);for(let S=0;S<n;S++){const N=S+B,R=N,w=N+n+1,V=N+n+2,H=N+1;l.push(R,w,H),l.push(w,V,H)}}this.setIndex(l),this.setAttribute("position",new an(c,3)),this.setAttribute("normal",new an(u,3)),this.setAttribute("uv",new an(h,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new rv(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class lv extends Mn{constructor(e=new gI([new yt(0,.5),new yt(-.5,-.5),new yt(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],o=[];let l=0,c=0;if(Array.isArray(e)===!1)u(e);else for(let h=0;h<e.length;h++)u(e[h]),this.addGroup(l,c,h),l+=c,c=0;this.setIndex(n),this.setAttribute("position",new an(i,3)),this.setAttribute("normal",new an(s,3)),this.setAttribute("uv",new an(o,2));function u(h){const A=i.length/3,f=h.extractPoints(t);let p=f.shape;const y=f.holes;Nl.isClockWise(p)===!1&&(p=p.reverse());for(let B=0,S=y.length;B<S;B++){const N=y[B];Nl.isClockWise(N)===!0&&(y[B]=N.reverse())}const G=Nl.triangulateShape(p,y);for(let B=0,S=y.length;B<S;B++){const N=y[B];p=p.concat(N)}for(let B=0,S=p.length;B<S;B++){const N=p[B];i.push(N.x,N.y,0),s.push(0,0,1),o.push(N.x,N.y)}for(let B=0,S=G.length;B<S;B++){const N=G[B],R=N[0]+A,w=N[1]+A,V=N[2]+A;n.push(R,w,V),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return _K(t,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const o=t[e.shapes[i]];n.push(o)}return new lv(n,e.curveSegments)}}function _K(a,e){if(e.shapes=[],Array.isArray(a))for(let t=0,n=a.length;t<n;t++){const i=a[t];e.shapes.push(i.uuid)}else e.shapes.push(a.uuid);return e}class Fm extends Mn{constructor(e=1,t=32,n=16,i=0,s=Math.PI*2,o=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:o,thetaLength:l},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(o+l,Math.PI);let u=0;const h=[],A=new ue,f=new ue,p=[],y=[],G=[],B=[];for(let S=0;S<=n;S++){const N=[],R=S/n;let w=0;S===0&&o===0?w=.5/t:S===n&&c===Math.PI&&(w=-.5/t);for(let V=0;V<=t;V++){const H=V/t;A.x=-e*Math.cos(i+H*s)*Math.sin(o+R*l),A.y=e*Math.cos(o+R*l),A.z=e*Math.sin(i+H*s)*Math.sin(o+R*l),y.push(A.x,A.y,A.z),f.copy(A).normalize(),G.push(f.x,f.y,f.z),B.push(H+w,1-R),N.push(u++)}h.push(N)}for(let S=0;S<n;S++)for(let N=0;N<t;N++){const R=h[S][N+1],w=h[S][N],V=h[S+1][N],H=h[S+1][N+1];(S!==0||o>0)&&p.push(R,w,H),(S!==n-1||c<Math.PI)&&p.push(w,V,H)}this.setIndex(p),this.setAttribute("position",new an(y,3)),this.setAttribute("normal",new an(G,3)),this.setAttribute("uv",new an(B,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fm(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class cv extends Tu{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new cv(e.radius,e.detail)}}class gv extends Mn{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const o=[],l=[],c=[],u=[],h=new ue,A=new ue,f=new ue;for(let p=0;p<=n;p++)for(let y=0;y<=i;y++){const G=y/i*s,B=p/n*Math.PI*2;A.x=(e+t*Math.cos(B))*Math.cos(G),A.y=(e+t*Math.cos(B))*Math.sin(G),A.z=t*Math.sin(B),l.push(A.x,A.y,A.z),h.x=e*Math.cos(G),h.y=e*Math.sin(G),f.subVectors(A,h).normalize(),c.push(f.x,f.y,f.z),u.push(y/i),u.push(p/n)}for(let p=1;p<=n;p++)for(let y=1;y<=i;y++){const G=(i+1)*p+y-1,B=(i+1)*(p-1)+y-1,S=(i+1)*(p-1)+y,N=(i+1)*p+y;o.push(G,B,N),o.push(B,S,N)}this.setIndex(o),this.setAttribute("position",new an(l,3)),this.setAttribute("normal",new an(c,3)),this.setAttribute("uv",new an(u,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new gv(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class uv extends Mn{constructor(e=1,t=.4,n=64,i=8,s=2,o=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:s,q:o},n=Math.floor(n),i=Math.floor(i);const l=[],c=[],u=[],h=[],A=new ue,f=new ue,p=new ue,y=new ue,G=new ue,B=new ue,S=new ue;for(let R=0;R<=n;++R){const w=R/n*s*Math.PI*2;N(w,s,o,e,p),N(w+.01,s,o,e,y),B.subVectors(y,p),S.addVectors(y,p),G.crossVectors(B,S),S.crossVectors(G,B),G.normalize(),S.normalize();for(let V=0;V<=i;++V){const H=V/i*Math.PI*2,X=-t*Math.cos(H),Y=t*Math.sin(H);A.x=p.x+(X*S.x+Y*G.x),A.y=p.y+(X*S.y+Y*G.y),A.z=p.z+(X*S.z+Y*G.z),c.push(A.x,A.y,A.z),f.subVectors(A,p).normalize(),u.push(f.x,f.y,f.z),h.push(R/n),h.push(V/i)}}for(let R=1;R<=n;R++)for(let w=1;w<=i;w++){const V=(i+1)*(R-1)+(w-1),H=(i+1)*R+(w-1),X=(i+1)*R+w,Y=(i+1)*(R-1)+w;l.push(V,H,Y),l.push(H,X,Y)}this.setIndex(l),this.setAttribute("position",new an(c,3)),this.setAttribute("normal",new an(u,3)),this.setAttribute("uv",new an(h,2));function N(R,w,V,H,X){const Y=Math.cos(R),M=Math.sin(R),E=V/w*R,O=Math.cos(E);X.x=H*(2+O)*.5*Y,X.y=H*(2+O)*M*.5,X.z=H*Math.sin(E)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new uv(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class dv extends Mn{constructor(e=new YS(new ue(-1,-1,0),new ue(-1,1,0),new ue(1,1,0)),t=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:s};const o=e.computeFrenetFrames(t,s);this.tangents=o.tangents,this.normals=o.normals,this.binormals=o.binormals;const l=new ue,c=new ue,u=new yt;let h=new ue;const A=[],f=[],p=[],y=[];G(),this.setIndex(y),this.setAttribute("position",new an(A,3)),this.setAttribute("normal",new an(f,3)),this.setAttribute("uv",new an(p,2));function G(){for(let R=0;R<t;R++)B(R);B(s===!1?t:0),N(),S()}function B(R){h=e.getPointAt(R/t,h);const w=o.normals[R],V=o.binormals[R];for(let H=0;H<=i;H++){const X=H/i*Math.PI*2,Y=Math.sin(X),M=-Math.cos(X);c.x=M*w.x+Y*V.x,c.y=M*w.y+Y*V.y,c.z=M*w.z+Y*V.z,c.normalize(),f.push(c.x,c.y,c.z),l.x=h.x+n*c.x,l.y=h.y+n*c.y,l.z=h.z+n*c.z,A.push(l.x,l.y,l.z)}}function S(){for(let R=1;R<=t;R++)for(let w=1;w<=i;w++){const V=(i+1)*(R-1)+(w-1),H=(i+1)*R+(w-1),X=(i+1)*R+w,Y=(i+1)*(R-1)+w;y.push(V,H,Y),y.push(H,X,Y)}}function N(){for(let R=0;R<=t;R++)for(let w=0;w<=i;w++)u.x=R/t,u.y=w/i,p.push(u.x,u.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new dv(new my[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class ES extends Mn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new ue,s=new ue;if(e.index!==null){const o=e.attributes.position,l=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:l.count,materialIndex:0}]);for(let u=0,h=c.length;u<h;++u){const A=c[u],f=A.start,p=A.count;for(let y=f,G=f+p;y<G;y+=3)for(let B=0;B<3;B++){const S=l.getX(y+B),N=l.getX(y+(B+1)%3);i.fromBufferAttribute(o,S),s.fromBufferAttribute(o,N),hR(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const o=e.attributes.position;for(let l=0,c=o.count/3;l<c;l++)for(let u=0;u<3;u++){const h=3*l+u,A=3*l+(u+1)%3;i.fromBufferAttribute(o,h),s.fromBufferAttribute(o,A),hR(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new an(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function hR(a,e,t){const n=`${a.x},${a.y},${a.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${a.x},${a.y},${a.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var CR=Object.freeze({__proto__:null,BoxGeometry:bI,CapsuleGeometry:tv,CircleGeometry:nv,ConeGeometry:Ym,CylinderGeometry:Xm,DodecahedronGeometry:iv,EdgesGeometry:WS,ExtrudeGeometry:sv,IcosahedronGeometry:Hm,LatheGeometry:ov,OctahedronGeometry:Em,PlaneGeometry:Xl,PolyhedronGeometry:Tu,RingGeometry:rv,ShapeGeometry:lv,SphereGeometry:Fm,TetrahedronGeometry:cv,TorusGeometry:gv,TorusKnotGeometry:uv,TubeGeometry:dv,WireframeGeometry:ES});class VV extends Os{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new tn(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class FS extends Ds{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class KS extends Os{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new tn(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ku,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vo,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class MV extends KS{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new yt(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Zn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new tn(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new tn(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new tn(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class _V extends Os{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new tn(16777215),this.specular=new tn(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ku,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vo,this.combine=Rm,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class XV extends Os{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new tn(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ku,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class YV extends Os{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ku,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class HV extends Os{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new tn(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new tn(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ku,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new vo,this.combine=Rm,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Iv extends Os{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=PW,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class hv extends Os{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class EV extends Os{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new tn(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Ku,this.normalScale=new yt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this.fog=e.fog,this}}class FV extends Go{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function oI(a,e){return!a||a.constructor===e?a:typeof e.BYTES_PER_ELEMENT=="number"?new e(a):Array.prototype.slice.call(a)}function KV(a){function e(i,s){return a[i]-a[s]}const t=a.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function R2(a,e,t){const n=a.length,i=new a.constructor(n);for(let s=0,o=0;o!==n;++s){const l=t[s]*e;for(let c=0;c!==e;++c)i[o++]=a[l+c]}return i}function TS(a,e,t,n){let i=1,s=a[0];for(;s!==void 0&&s[n]===void 0;)s=a[i++];if(s===void 0)return;let o=s[n];if(o!==void 0)if(Array.isArray(o))do o=s[n],o!==void 0&&(e.push(s.time),t.push(...o)),s=a[i++];while(s!==void 0);else if(o.toArray!==void 0)do o=s[n],o!==void 0&&(e.push(s.time),o.toArray(t,t.length)),s=a[i++];while(s!==void 0);else do o=s[n],o!==void 0&&(e.push(s.time),t.push(o)),s=a[i++];while(s!==void 0)}function XK(a,e,t,n,i=30){const s=a.clone();s.name=e;const o=[];for(let c=0;c<s.tracks.length;++c){const u=s.tracks[c],h=u.getValueSize(),A=[],f=[];for(let p=0;p<u.times.length;++p){const y=u.times[p]*i;if(!(y<t||y>=n)){A.push(u.times[p]);for(let G=0;G<h;++G)f.push(u.values[p*h+G])}}A.length!==0&&(u.times=oI(A,u.times.constructor),u.values=oI(f,u.values.constructor),o.push(u))}s.tracks=o;let l=1/0;for(let c=0;c<s.tracks.length;++c)l>s.tracks[c].times[0]&&(l=s.tracks[c].times[0]);for(let c=0;c<s.tracks.length;++c)s.tracks[c].shift(-1*l);return s.resetDuration(),s}function YK(a,e=0,t=a,n=30){n<=0&&(n=30);const i=t.tracks.length,s=e/n;for(let o=0;o<i;++o){const l=t.tracks[o],c=l.ValueTypeName;if(c==="bool"||c==="string")continue;const u=a.tracks.find(function(S){return S.name===l.name&&S.ValueTypeName===c});if(u===void 0)continue;let h=0;const A=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(h=A/3);let f=0;const p=u.getValueSize();u.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(f=p/3);const y=l.times.length-1;let G;if(s<=l.times[0]){const S=h,N=A-h;G=l.values.slice(S,N)}else if(s>=l.times[y]){const S=y*A+h,N=S+A-h;G=l.values.slice(S,N)}else{const S=l.createInterpolant(),N=h,R=A-h;S.evaluate(s),G=S.resultBuffer.slice(N,R)}c==="quaternion"&&new xa().fromArray(G).normalize().conjugate().toArray(G);const B=u.times.length;for(let S=0;S<B;++S){const N=S*p+f;if(c==="quaternion")xa.multiplyQuaternionsFlat(u.values,N,G,0,u.values,N);else{const R=p-f*2;for(let w=0;w<R;++w)u.values[N+w]-=G[w]}}}return a.blendMode=vS,a}class HK{static convertArray(e,t){return oI(e,t)}static isTypedArray(e){return rV(e)}static getKeyframeOrder(e){return KV(e)}static sortedArray(e,t,n){return R2(e,t,n)}static flattenJSON(e,t,n,i){TS(e,t,n,i)}static subclip(e,t,n,i,s=30){return XK(e,t,n,i,s)}static makeClipAdditive(e,t=0,n=e,i=30){return YK(e,t,n,i)}}class Km{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let o;n:{i:if(!(e<i)){for(let l=n+2;;){if(i===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===l)break;if(s=i,i=t[++n],e<i)break t}o=t.length;break n}if(!(e>=s)){const l=t[1];e<l&&(n=2,s=l);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(i=s,s=t[--n-1],e>=s)break t}o=n,n=0;break n}break e}for(;n<o;){const l=n+o>>>1;e<t[l]?o=l:n=l+1}if(i=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let o=0;o!==i;++o)t[o]=n[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class TV extends Km{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:iI,endingEnd:iI}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,o=e+1,l=i[s],c=i[o];if(l===void 0)switch(this.getSettings_().endingStart){case aI:s=e,l=2*t-n;break;case lm:s=i.length-2,l=t+i[s]-i[s+1];break;default:s=e,l=n}if(c===void 0)switch(this.getSettings_().endingEnd){case aI:o=e,c=2*n-t;break;case lm:o=1,c=n+i[1]-i[0];break;default:o=e-1,c=t}const u=(n-t)*.5,h=this.valueSize;this._weightPrev=u/(t-l),this._weightNext=u/(c-n),this._offsetPrev=s*h,this._offsetNext=o*h}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=e*l,u=c-l,h=this._offsetPrev,A=this._offsetNext,f=this._weightPrev,p=this._weightNext,y=(n-t)/(i-t),G=y*y,B=G*y,S=-f*B+2*f*G-f*y,N=(1+f)*B+(-1.5-2*f)*G+(-.5+f)*y+1,R=(-1-p)*B+(1.5+p)*G+.5*y,w=p*B-p*G;for(let V=0;V!==l;++V)s[V]=S*o[h+V]+N*o[u+V]+R*o[c+V]+w*o[A+V];return s}}class zS extends Km{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=e*l,u=c-l,h=(n-t)/(i-t),A=1-h;for(let f=0;f!==l;++f)s[f]=o[u+f]*A+o[c+f]*h;return s}}class zV extends Km{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class Dr{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=oI(t,this.TimeBufferType),this.values=oI(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:oI(e.times,Array),values:oI(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new zV(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new zS(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new TV(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case rm:t=this.InterpolantFactoryMethodDiscrete;break;case Cy:t=this.InterpolantFactoryMethodLinear;break;case f0:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return Qt("KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return rm;case this.InterpolantFactoryMethodLinear:return Cy;case this.InterpolantFactoryMethodSmooth:return f0}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,o=i-1;for(;s!==i&&n[s]<e;)++s;for(;o!==-1&&n[o]>t;)--o;if(++o,s!==0||o!==i){s>=o&&(o=Math.max(o,1),s=o-1);const l=this.getValueSize();this.times=n.slice(s,o),this.values=this.values.slice(s*l,o*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(Cn("KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;s===0&&(Cn("KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let l=0;l!==s;l++){const c=n[l];if(typeof c=="number"&&isNaN(c)){Cn("KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(o!==null&&o>c){Cn("KeyframeTrack: Out of order keys.",this,l,c,o),e=!1;break}o=c}if(i!==void 0&&rV(i))for(let l=0,c=i.length;l!==c;++l){const u=i[l];if(isNaN(u)){Cn("KeyframeTrack: Value is not a valid number.",this,l,u),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===f0,s=e.length-1;let o=1;for(let l=1;l<s;++l){let c=!1;const u=e[l],h=e[l+1];if(u!==h&&(l!==1||u!==e[0]))if(i)c=!0;else{const A=l*n,f=A-n,p=A+n;for(let y=0;y!==n;++y){const G=t[A+y];if(G!==t[f+y]||G!==t[p+y]){c=!0;break}}}if(c){if(l!==o){e[o]=e[l];const A=l*n,f=o*n;for(let p=0;p!==n;++p)t[f+p]=t[A+p]}++o}}if(s>0){e[o]=e[s];for(let l=s*n,c=o*n,u=0;u!==n;++u)t[c+u]=t[l+u];++o}return o!==e.length?(this.times=e.slice(0,o),this.values=t.slice(0,o*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}Dr.prototype.ValueTypeName="";Dr.prototype.TimeBufferType=Float32Array;Dr.prototype.ValueBufferType=Float32Array;Dr.prototype.DefaultInterpolation=Cy;class yI extends Dr{constructor(e,t,n){super(e,t,n)}}yI.prototype.ValueTypeName="bool";yI.prototype.ValueBufferType=Array;yI.prototype.DefaultInterpolation=rm;yI.prototype.InterpolantFactoryMethodLinear=void 0;yI.prototype.InterpolantFactoryMethodSmooth=void 0;class LS extends Dr{constructor(e,t,n,i){super(e,t,n,i)}}LS.prototype.ValueTypeName="color";class fm extends Dr{constructor(e,t,n,i){super(e,t,n,i)}}fm.prototype.ValueTypeName="number";class LV extends Km{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,o=this.sampleValues,l=this.valueSize,c=(n-t)/(i-t);let u=e*l;for(let h=u+l;u!==h;u+=4)xa.slerpFlat(s,0,o,u-l,o,u,c);return s}}class Tm extends Dr{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new LV(this.times,this.values,this.getValueSize(),e)}}Tm.prototype.ValueTypeName="quaternion";Tm.prototype.InterpolantFactoryMethodSmooth=void 0;class vI extends Dr{constructor(e,t,n){super(e,t,n)}}vI.prototype.ValueTypeName="string";vI.prototype.ValueBufferType=Array;vI.prototype.DefaultInterpolation=rm;vI.prototype.InterpolantFactoryMethodLinear=void 0;vI.prototype.InterpolantFactoryMethodSmooth=void 0;class mm extends Dr{constructor(e,t,n,i){super(e,t,n,i)}}mm.prototype.ValueTypeName="vector";class pm{constructor(e="",t=-1,n=[],i=zy){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=Cr(),this.userData={},this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let o=0,l=n.length;o!==l;++o)t.push(FK(n[o]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s.userData=JSON.parse(e.userData||"{}"),s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode,userData:JSON.stringify(e.userData)};for(let s=0,o=n.length;s!==o;++s)t.push(Dr.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,o=[];for(let l=0;l<s;l++){let c=[],u=[];c.push((l+s-1)%s,l,(l+1)%s),u.push(0,1,0);const h=KV(c);c=R2(c,1,h),u=R2(u,1,h),!i&&c[0]===0&&(c.push(s),u.push(u[0])),o.push(new fm(".morphTargetInfluences["+t[l].name+"]",c,u).scale(1/n))}return new this(e,-1,o)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const u=e[l],h=u.name.match(s);if(h&&h.length>1){const A=h[1];let f=i[A];f||(i[A]=f=[]),f.push(u)}}const o=[];for(const l in i)o.push(this.CreateFromMorphTargetSequence(l,i[l],t,n));return o}static parseAnimation(e,t){if(Qt("AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return Cn("AnimationClip: No animation in JSONLoader data."),null;const n=function(A,f,p,y,G){if(p.length!==0){const B=[],S=[];TS(p,B,S,y),B.length!==0&&G.push(new A(f,B,S))}},i=[],s=e.name||"default",o=e.fps||30,l=e.blendMode;let c=e.length||-1;const u=e.hierarchy||[];for(let A=0;A<u.length;A++){const f=u[A].keys;if(!(!f||f.length===0))if(f[0].morphTargets){const p={};let y;for(y=0;y<f.length;y++)if(f[y].morphTargets)for(let G=0;G<f[y].morphTargets.length;G++)p[f[y].morphTargets[G]]=-1;for(const G in p){const B=[],S=[];for(let N=0;N!==f[y].morphTargets.length;++N){const R=f[y];B.push(R.time),S.push(R.morphTarget===G?1:0)}i.push(new fm(".morphTargetInfluence["+G+"]",B,S))}c=p.length*o}else{const p=".bones["+t[A].name+"]";n(mm,p+".position",f,"pos",i),n(Tm,p+".quaternion",f,"rot",i),n(mm,p+".scale",f,"scl",i)}}return i.length===0?null:new this(s,c,i,l)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let n=0;n<this.tracks.length;n++)e.push(this.tracks[n].clone());const t=new this.constructor(this.name,this.duration,e,this.blendMode);return t.userData=JSON.parse(JSON.stringify(this.userData)),t}toJSON(){return this.constructor.toJSON(this)}}function EK(a){switch(a.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return fm;case"vector":case"vector2":case"vector3":case"vector4":return mm;case"color":return LS;case"quaternion":return Tm;case"bool":case"boolean":return yI;case"string":return vI}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+a)}function FK(a){if(a.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=EK(a.type);if(a.times===void 0){const t=[],n=[];TS(a.keys,t,n,"value"),a.times=t,a.values=n}return e.parse!==void 0?e.parse(a):new e(a.name,a.times,a.values,a.interpolation)}const Bc={enabled:!1,files:{},add:function(a,e){this.enabled!==!1&&(this.files[a]=e)},get:function(a){if(this.enabled!==!1)return this.files[a]},remove:function(a){delete this.files[a]},clear:function(){this.files={}}};class Cv{constructor(e,t,n){const i=this;let s=!1,o=0,l=0,c;const u=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this._abortController=null,this.itemStart=function(h){l++,s===!1&&i.onStart!==void 0&&i.onStart(h,o,l),s=!0},this.itemEnd=function(h){o++,i.onProgress!==void 0&&i.onProgress(h,o,l),o===l&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(h){i.onError!==void 0&&i.onError(h)},this.resolveURL=function(h){return c?c(h):h},this.setURLModifier=function(h){return c=h,this},this.addHandler=function(h,A){return u.push(h,A),this},this.removeHandler=function(h){const A=u.indexOf(h);return A!==-1&&u.splice(A,2),this},this.getHandler=function(h){for(let A=0,f=u.length;A<f;A+=2){const p=u[A],y=u[A+1];if(p.global&&(p.lastIndex=0),p.test(h))return y}return null},this.abort=function(){return this.abortController.abort(),this._abortController=null,this}}get abortController(){return this._abortController||(this._abortController=new AbortController),this._abortController}}const kV=new Cv;class Bo{constructor(e){this.manager=e!==void 0?e:kV,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,s){n.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}abort(){return this}}Bo.DEFAULT_MATERIAL_NAME="__DEFAULT";const mg={};class KK extends Error{constructor(e,t){super(e),this.response=t}}class Ar extends Bo{constructor(e){super(e),this.mimeType="",this.responseType="",this._abortController=new AbortController}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Bc.get(`file:${e}`);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(mg[e]!==void 0){mg[e].push({onLoad:t,onProgress:n,onError:i});return}mg[e]=[],mg[e].push({onLoad:t,onProgress:n,onError:i});const o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin",signal:typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal}),l=this.mimeType,c=this.responseType;fetch(o).then(u=>{if(u.status===200||u.status===0){if(u.status===0&&Qt("FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||u.body===void 0||u.body.getReader===void 0)return u;const h=mg[e],A=u.body.getReader(),f=u.headers.get("X-File-Size")||u.headers.get("Content-Length"),p=f?parseInt(f):0,y=p!==0;let G=0;const B=new ReadableStream({start(S){N();function N(){A.read().then(({done:R,value:w})=>{if(R)S.close();else{G+=w.byteLength;const V=new ProgressEvent("progress",{lengthComputable:y,loaded:G,total:p});for(let H=0,X=h.length;H<X;H++){const Y=h[H];Y.onProgress&&Y.onProgress(V)}S.enqueue(w),N()}},R=>{S.error(R)})}}});return new Response(B)}else throw new KK(`fetch for "${u.url}" responded with ${u.status}: ${u.statusText}`,u)}).then(u=>{switch(c){case"arraybuffer":return u.arrayBuffer();case"blob":return u.blob();case"document":return u.text().then(h=>new DOMParser().parseFromString(h,l));case"json":return u.json();default:if(l==="")return u.text();{const A=/charset="?([^;"\s]*)"?/i.exec(l),f=A&&A[1]?A[1].toLowerCase():void 0,p=new TextDecoder(f);return u.arrayBuffer().then(y=>p.decode(y))}}}).then(u=>{Bc.add(`file:${e}`,u);const h=mg[e];delete mg[e];for(let A=0,f=h.length;A<f;A++){const p=h[A];p.onLoad&&p.onLoad(u)}}).catch(u=>{const h=mg[e];if(h===void 0)throw this.manager.itemError(e),u;delete mg[e];for(let A=0,f=h.length;A<f;A++){const p=h[A];p.onError&&p.onError(u)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}class TK extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Ar(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(c){i?i(c):Cn(c),s.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=pm.parse(e[n]);t.push(i)}return t}}class zK extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=this,o=[],l=new ev,c=new Ar(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(s.withCredentials);let u=0;function h(A){c.load(e[A],function(f){const p=s.parse(f,!0);o[A]={width:p.width,height:p.height,format:p.format,mipmaps:p.mipmaps},u+=1,u===6&&(p.mipmapCount===1&&(l.minFilter=Pn),l.image=o,l.format=p.format,l.needsUpdate=!0,t&&t(l))},n,i)}if(Array.isArray(e))for(let A=0,f=e.length;A<f;++A)h(A);else c.load(e,function(A){const f=s.parse(A,!0);if(f.isCubemap){const p=f.mipmaps.length/f.mipmapCount;for(let y=0;y<p;y++){o[y]={mipmaps:[]};for(let G=0;G<f.mipmapCount;G++)o[y].mipmaps.push(f.mipmaps[y*f.mipmapCount+G]),o[y].format=f.format,o[y].width=f.width,o[y].height=f.height}l.image=o}else l.image.width=f.width,l.image.height=f.height,l.mipmaps=f.mipmaps;f.mipmapCount===1&&(l.minFilter=Pn),l.format=f.format,l.needsUpdate=!0,t&&t(l)},n,i);return l}}const Uh=new WeakMap;class bm extends Bo{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Bc.get(`image:${e}`);if(o!==void 0){if(o.complete===!0)s.manager.itemStart(e),setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0);else{let A=Uh.get(o);A===void 0&&(A=[],Uh.set(o,A)),A.push({onLoad:t,onError:i})}return o}const l=um("img");function c(){h(),t&&t(this);const A=Uh.get(this)||[];for(let f=0;f<A.length;f++){const p=A[f];p.onLoad&&p.onLoad(this)}Uh.delete(this),s.manager.itemEnd(e)}function u(A){h(),i&&i(A),Bc.remove(`image:${e}`);const f=Uh.get(this)||[];for(let p=0;p<f.length;p++){const y=f[p];y.onError&&y.onError(A)}Uh.delete(this),s.manager.itemError(e),s.manager.itemEnd(e)}function h(){l.removeEventListener("load",c,!1),l.removeEventListener("error",u,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",u,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),Bc.add(`image:${e}`,l),s.manager.itemStart(e),l.src=e,l}}class UV extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=new Mm;s.colorSpace=Bs;const o=new bm(this.manager);o.setCrossOrigin(this.crossOrigin),o.setPath(this.path);let l=0;function c(u){o.load(e[u],function(h){s.images[u]=h,l++,l===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let u=0;u<e.length;++u)c(u);return s}}class kS extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Lr,l=new Ar(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(s.withCredentials),l.load(e,function(c){let u;try{u=s.parse(c)}catch(h){if(i!==void 0)i(h);else{h(h);return}}u.image!==void 0?o.image=u.image:u.data!==void 0&&(o.image.width=u.width,o.image.height=u.height,o.image.data=u.data),o.wrapS=u.wrapS!==void 0?u.wrapS:Ca,o.wrapT=u.wrapT!==void 0?u.wrapT:Ca,o.magFilter=u.magFilter!==void 0?u.magFilter:Pn,o.minFilter=u.minFilter!==void 0?u.minFilter:Pn,o.anisotropy=u.anisotropy!==void 0?u.anisotropy:1,u.colorSpace!==void 0&&(o.colorSpace=u.colorSpace),u.flipY!==void 0&&(o.flipY=u.flipY),u.format!==void 0&&(o.format=u.format),u.type!==void 0&&(o.type=u.type),u.mipmaps!==void 0&&(o.mipmaps=u.mipmaps,o.minFilter=Gc),u.mipmapCount===1&&(o.minFilter=Pn),u.generateMipmaps!==void 0&&(o.generateMipmaps=u.generateMipmaps),o.needsUpdate=!0,t&&t(o,u)},n,i),o}}class Av extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=new fi,o=new bm(this.manager);return o.setCrossOrigin(this.crossOrigin),o.setPath(this.path),o.load(e,function(l){s.image=l,s.needsUpdate=!0,t!==void 0&&t(s)},n,i),s}}class zu extends ti{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new tn(e),this.intensity=t}dispose(){this.dispatchEvent({type:"dispose"})}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,t}}class DV extends zu{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(ti.DEFAULT_UP),this.updateMatrix(),this.groundColor=new tn(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}toJSON(e){const t=super.toJSON(e);return t.object.groundColor=this.groundColor.getHex(),t}}const lB=new pn,AR=new ue,fR=new ue;class US{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yt(512,512),this.mapType=os,this.map=null,this.mapPass=null,this.matrix=new pn,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new RC,this._frameExtents=new yt(1,1),this._viewportCount=1,this._viewports=[new ri(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;AR.setFromMatrixPosition(e.matrixWorld),t.position.copy(AR),fR.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(fR),t.updateMatrixWorld(),lB.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(lB,t.coordinateSystem,t.reversedDepth),t.reversedDepth?n.set(.5,0,0,.5,0,.5,0,.5,0,0,1,0,0,0,0,1):n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(lB)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.autoUpdate=e.autoUpdate,this.needsUpdate=e.needsUpdate,this.normalBias=e.normalBias,this.blurSamples=e.blurSamples,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class LK extends US{constructor(){super(new Ga(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1,this.aspect=1}updateMatrices(e){const t=this.camera,n=bC*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height*this.aspect,s=e.distance||t.far;(n!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class OV extends zu{constructor(e,t,n=0,i=Math.PI/3,s=0,o=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(ti.DEFAULT_UP),this.updateMatrix(),this.target=new ti,this.distance=n,this.angle=i,this.penumbra=s,this.decay=o,this.map=null,this.shadow=new LK}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.map=e.map,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.angle=this.angle,t.object.decay=this.decay,t.object.penumbra=this.penumbra,t.object.target=this.target.uuid,this.map&&this.map.isTexture&&(t.object.map=this.map.toJSON(e).uuid),t.object.shadow=this.shadow.toJSON(),t}}class kK extends US{constructor(){super(new Ga(90,1,.5,500)),this.isPointLightShadow=!0}}class jV extends zu{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new kK}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){super.dispose(),this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.distance=this.distance,t.object.decay=this.decay,t.object.shadow=this.shadow.toJSON(),t}}class xc extends Oy{constructor(e=-1,t=1,n=1,i=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,o){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,o=n+e,l=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const u=(this.right-this.left)/this.view.fullWidth/this.zoom,h=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=u*this.view.offsetX,o=s+u*this.view.width,l-=h*this.view.offsetY,c=l-h*this.view.height}this.projectionMatrix.makeOrthographic(s,o,l,c,this.near,this.far,this.coordinateSystem,this.reversedDepth),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class UK extends US{constructor(){super(new xc(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class JV extends zu{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(ti.DEFAULT_UP),this.updateMatrix(),this.target=new ti,this.shadow=new UK}dispose(){super.dispose(),this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}toJSON(e){const t=super.toJSON(e);return t.object.shadow=this.shadow.toJSON(),t.object.target=this.target.uuid,t}}class PV extends zu{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class QV extends zu{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class DS{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new ue)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.282095),t.addScaledVector(o[1],.488603*i),t.addScaledVector(o[2],.488603*s),t.addScaledVector(o[3],.488603*n),t.addScaledVector(o[4],1.092548*(n*i)),t.addScaledVector(o[5],1.092548*(i*s)),t.addScaledVector(o[6],.315392*(3*s*s-1)),t.addScaledVector(o[7],1.092548*(n*s)),t.addScaledVector(o[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,s=e.z,o=this.coefficients;return t.copy(o[0]).multiplyScalar(.886227),t.addScaledVector(o[1],2*.511664*i),t.addScaledVector(o[2],2*.511664*s),t.addScaledVector(o[3],2*.511664*n),t.addScaledVector(o[4],2*.429043*n*i),t.addScaledVector(o[5],2*.429043*i*s),t.addScaledVector(o[6],.743125*s*s-.247708),t.addScaledVector(o[7],2*.429043*n*s),t.addScaledVector(o[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-i*i)}}class qV extends zu{constructor(e=new DS,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class fv extends Bo{constructor(e){super(e),this.textures={}}load(e,t,n,i){const s=this,o=new Ar(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(c){i?i(c):Cn(c),s.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&Qt("MaterialLoader: Undefined texture",s),t[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new tn().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.allowOverride!==void 0&&(i.allowOverride=e.allowOverride),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const o=e.uniforms[s];switch(i.uniforms[s]={},o.type){case"t":i.uniforms[s].value=n(o.value);break;case"c":i.uniforms[s].value=new tn().setHex(o.value);break;case"v2":i.uniforms[s].value=new yt().fromArray(o.value);break;case"v3":i.uniforms[s].value=new ue().fromArray(o.value);break;case"v4":i.uniforms[s].value=new ri().fromArray(o.value);break;case"m3":i.uniforms[s].value=new Vn().fromArray(o.value);break;case"m4":i.uniforms[s].value=new pn().fromArray(o.value);break;default:i.uniforms[s].value=o.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new yt().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new yt().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return fv.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:VV,SpriteMaterial:ZS,RawShaderMaterial:FS,ShaderMaterial:Ds,PointsMaterial:RS,MeshPhysicalMaterial:MV,MeshStandardMaterial:KS,MeshPhongMaterial:_V,MeshToonMaterial:XV,MeshNormalMaterial:YV,MeshLambertMaterial:HV,MeshDepthMaterial:Iv,MeshDistanceMaterial:hv,MeshBasicMaterial:Wc,MeshMatcapMaterial:EV,LineDashedMaterial:FV,LineBasicMaterial:Go,Material:Os};return new t[e]}}class N2{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class mv extends Mn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class $V extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Ar(s.manager);o.setPath(s.path),o.setRequestHeader(s.requestHeader),o.setWithCredentials(s.withCredentials),o.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(c){i?i(c):Cn(c),s.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(p,y){if(t[y]!==void 0)return t[y];const B=p.interleavedBuffers[y],S=s(p,B.buffer),N=oC(B.type,S),R=new Qy(N,B.stride);return R.uuid=B.uuid,t[y]=R,R}function s(p,y){if(n[y]!==void 0)return n[y];const B=p.arrayBuffers[y],S=new Uint32Array(B).buffer;return n[y]=S,S}const o=e.isInstancedBufferGeometry?new mv:new Mn,l=e.data.index;if(l!==void 0){const p=oC(l.type,l.array);o.setIndex(new Zi(p,1))}const c=e.data.attributes;for(const p in c){const y=c[p];let G;if(y.isInterleavedBufferAttribute){const B=i(e.data,y.data);G=new hr(B,y.itemSize,y.offset,y.normalized)}else{const B=oC(y.type,y.array),S=y.isInstancedBufferAttribute?CI:Zi;G=new S(B,y.itemSize,y.normalized)}y.name!==void 0&&(G.name=y.name),y.usage!==void 0&&G.setUsage(y.usage),o.setAttribute(p,G)}const u=e.data.morphAttributes;if(u)for(const p in u){const y=u[p],G=[];for(let B=0,S=y.length;B<S;B++){const N=y[B];let R;if(N.isInterleavedBufferAttribute){const w=i(e.data,N.data);R=new hr(w,N.itemSize,N.offset,N.normalized)}else{const w=oC(N.type,N.array);R=new Zi(w,N.itemSize,N.normalized)}N.name!==void 0&&(R.name=N.name),G.push(R)}o.morphAttributes[p]=G}e.data.morphTargetsRelative&&(o.morphTargetsRelative=!0);const A=e.data.groups||e.data.drawcalls||e.data.offsets;if(A!==void 0)for(let p=0,y=A.length;p!==y;++p){const G=A[p];o.addGroup(G.start,G.count,G.materialIndex)}const f=e.data.boundingSphere;return f!==void 0&&(o.boundingSphere=new Ha().fromJSON(f)),e.name&&(o.name=e.name),e.userData&&(o.userData=e.userData),o}}class DK extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=this,o=this.path===""?N2.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||o;const l=new Ar(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){let u=null;try{u=JSON.parse(c)}catch(A){i!==void 0&&i(A),A("ObjectLoader: Can't parse "+e+".",A.message);return}const h=u.metadata;if(h===void 0||h.type===void 0||h.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),Cn("ObjectLoader: Can't load "+e);return}s.parse(u,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?N2.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new Ar(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const o=await s.loadAsync(e,t),l=JSON.parse(o),c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(l)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),o=this.parseImages(e.images,function(){t!==void 0&&t(u)}),l=this.parseTextures(e.textures,o),c=this.parseMaterials(e.materials,l),u=this.parseObject(e.object,s,c,l,n),h=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,h),this.bindLightTargets(u),t!==void 0){let A=!1;for(const f in o)if(o[f].data instanceof HTMLImageElement){A=!0;break}A===!1&&t(u)}return u}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),o=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,o),c=this.parseObject(e.object,i,l,o,t),u=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,u),this.bindLightTargets(c),c}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const s=new gI().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,o=e.length;s<o;s++){const l=new qy().fromJSON(e[s],i);n[l.uuid]=l}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new $V;for(let s=0,o=e.length;s<o;s++){let l;const c=e[s];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":l=i.parse(c);break;default:c.type in CR?l=CR[c.type].fromJSON(c,t):Qt(`ObjectLoader: Unsupported geometry type "${c.type}"`)}l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),c.userData!==void 0&&(l.userData=c.userData),n[c.uuid]=l}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const s=new fv;s.setTextures(t);for(let o=0,l=e.length;o<l;o++){const c=e[o];n[c.uuid]===void 0&&(n[c.uuid]=s.parse(c)),i[c.uuid]=n[c.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],s=pm.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const n=this,i={};let s;function o(c){return n.manager.itemStart(c),s.load(c,function(){n.manager.itemEnd(c)},void 0,function(){n.manager.itemError(c),n.manager.itemEnd(c)})}function l(c){if(typeof c=="string"){const u=c,h=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(u)?u:n.resourcePath+u;return o(h)}else return c.data?{data:oC(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new Cv(t);s=new bm(c),s.setCrossOrigin(this.crossOrigin);for(let u=0,h=e.length;u<h;u++){const A=e[u],f=A.url;if(Array.isArray(f)){const p=[];for(let y=0,G=f.length;y<G;y++){const B=f[y],S=l(B);S!==null&&(S instanceof HTMLImageElement?p.push(S):p.push(new Lr(S.data,S.width,S.height)))}i[A.uuid]=new Wu(p)}else{const p=l(A.url);i[A.uuid]=new Wu(p)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function s(o){if(typeof o=="string"){const l=o,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:t.resourcePath+l;return await i.loadAsync(c)}else return o.data?{data:oC(o.type,o.data),width:o.width,height:o.height}:null}if(e!==void 0&&e.length>0){i=new bm(this.manager),i.setCrossOrigin(this.crossOrigin);for(let o=0,l=e.length;o<l;o++){const c=e[o],u=c.url;if(Array.isArray(u)){const h=[];for(let A=0,f=u.length;A<f;A++){const p=u[A],y=await s(p);y!==null&&(y instanceof HTMLImageElement?h.push(y):h.push(new Lr(y.data,y.width,y.height)))}n[c.uuid]=new Wu(h)}else{const h=await s(c.url);n[c.uuid]=new Wu(h)}}}return n}parseTextures(e,t){function n(s,o){return typeof s=="number"?s:(Qt("ObjectLoader.parseTexture: Constant should be in numeric form.",s),o[s])}const i={};if(e!==void 0)for(let s=0,o=e.length;s<o;s++){const l=e[s];l.image===void 0&&Qt('ObjectLoader: No "image" specified for',l.uuid),t[l.image]===void 0&&Qt("ObjectLoader: Undefined image",l.image);const c=t[l.image],u=c.data;let h;Array.isArray(u)?(h=new Mm,u.length===6&&(h.needsUpdate=!0)):(u&&u.data?h=new Lr:h=new fi,u&&(h.needsUpdate=!0)),h.source=c,h.uuid=l.uuid,l.name!==void 0&&(h.name=l.name),l.mapping!==void 0&&(h.mapping=n(l.mapping,OK)),l.channel!==void 0&&(h.channel=l.channel),l.offset!==void 0&&h.offset.fromArray(l.offset),l.repeat!==void 0&&h.repeat.fromArray(l.repeat),l.center!==void 0&&h.center.fromArray(l.center),l.rotation!==void 0&&(h.rotation=l.rotation),l.wrap!==void 0&&(h.wrapS=n(l.wrap[0],mR),h.wrapT=n(l.wrap[1],mR)),l.format!==void 0&&(h.format=l.format),l.internalFormat!==void 0&&(h.internalFormat=l.internalFormat),l.type!==void 0&&(h.type=l.type),l.colorSpace!==void 0&&(h.colorSpace=l.colorSpace),l.minFilter!==void 0&&(h.minFilter=n(l.minFilter,pR)),l.magFilter!==void 0&&(h.magFilter=n(l.magFilter,pR)),l.anisotropy!==void 0&&(h.anisotropy=l.anisotropy),l.flipY!==void 0&&(h.flipY=l.flipY),l.generateMipmaps!==void 0&&(h.generateMipmaps=l.generateMipmaps),l.premultiplyAlpha!==void 0&&(h.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(h.unpackAlignment=l.unpackAlignment),l.compareFunction!==void 0&&(h.compareFunction=l.compareFunction),l.userData!==void 0&&(h.userData=l.userData),i[l.uuid]=h}return i}parseObject(e,t,n,i,s){let o;function l(f){return t[f]===void 0&&Qt("ObjectLoader: Undefined geometry",f),t[f]}function c(f){if(f!==void 0){if(Array.isArray(f)){const p=[];for(let y=0,G=f.length;y<G;y++){const B=f[y];n[B]===void 0&&Qt("ObjectLoader: Undefined material",B),p.push(n[B])}return p}return n[f]===void 0&&Qt("ObjectLoader: Undefined material",f),n[f]}}function u(f){return i[f]===void 0&&Qt("ObjectLoader: Undefined texture",f),i[f]}let h,A;switch(e.type){case"Scene":o=new _m,e.background!==void 0&&(Number.isInteger(e.background)?o.background=new tn(e.background):o.background=u(e.background)),e.environment!==void 0&&(o.environment=u(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?o.fog=new Py(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(o.fog=new Jy(e.fog.color,e.fog.density)),e.fog.name!==""&&(o.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(o.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(o.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&o.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(o.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&o.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":o=new Ga(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(o.focus=e.focus),e.zoom!==void 0&&(o.zoom=e.zoom),e.filmGauge!==void 0&&(o.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(o.filmOffset=e.filmOffset),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"OrthographicCamera":o=new xc(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(o.zoom=e.zoom),e.view!==void 0&&(o.view=Object.assign({},e.view));break;case"AmbientLight":o=new PV(e.color,e.intensity);break;case"DirectionalLight":o=new JV(e.color,e.intensity),o.target=e.target||"";break;case"PointLight":o=new jV(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":o=new QV(e.color,e.intensity,e.width,e.height);break;case"SpotLight":o=new OV(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),o.target=e.target||"";break;case"HemisphereLight":o=new DV(e.color,e.groundColor,e.intensity);break;case"LightProbe":const f=new DS().fromArray(e.sh);o=new qV(f,e.intensity);break;case"SkinnedMesh":h=l(e.geometry),A=c(e.material),o=new fV(h,A),e.bindMode!==void 0&&(o.bindMode=e.bindMode),e.bindMatrix!==void 0&&o.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(o.skeleton=e.skeleton);break;case"Mesh":h=l(e.geometry),A=c(e.material),o=new _i(h,A);break;case"InstancedMesh":h=l(e.geometry),A=c(e.material);const p=e.count,y=e.instanceMatrix,G=e.instanceColor;o=new dC(h,A,p),o.instanceMatrix=new CI(new Float32Array(y.array),16),G!==void 0&&(o.instanceColor=new CI(new Float32Array(G.array),G.itemSize));break;case"BatchedMesh":h=l(e.geometry),A=c(e.material),o=new mV(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,A),o.geometry=h,o.perObjectFrustumCulled=e.perObjectFrustumCulled,o.sortObjects=e.sortObjects,o._drawRanges=e.drawRanges,o._reservedRanges=e.reservedRanges,o._geometryInfo=e.geometryInfo.map(B=>{let S=null,N=null;return B.boundingBox!==void 0&&(S=new Za().fromJSON(B.boundingBox)),B.boundingSphere!==void 0&&(N=new Ha().fromJSON(B.boundingSphere)),{...B,boundingBox:S,boundingSphere:N}}),o._instanceInfo=e.instanceInfo,o._availableInstanceIds=e._availableInstanceIds,o._availableGeometryIds=e._availableGeometryIds,o._nextIndexStart=e.nextIndexStart,o._nextVertexStart=e.nextVertexStart,o._geometryCount=e.geometryCount,o._maxInstanceCount=e.maxInstanceCount,o._maxVertexCount=e.maxVertexCount,o._maxIndexCount=e.maxIndexCount,o._geometryInitialized=e.geometryInitialized,o._matricesTexture=u(e.matricesTexture.uuid),o._indirectTexture=u(e.indirectTexture.uuid),e.colorsTexture!==void 0&&(o._colorsTexture=u(e.colorsTexture.uuid)),e.boundingSphere!==void 0&&(o.boundingSphere=new Ha().fromJSON(e.boundingSphere)),e.boundingBox!==void 0&&(o.boundingBox=new Za().fromJSON(e.boundingBox));break;case"LOD":o=new AV;break;case"Line":o=new Hu(l(e.geometry),c(e.material));break;case"LineLoop":o=new pV(l(e.geometry),c(e.material));break;case"LineSegments":o=new Vc(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":o=new bV(l(e.geometry),c(e.material));break;case"Sprite":o=new CV(c(e.material));break;case"Group":o=new rC;break;case"Bone":o=new wS;break;default:o=new ti}if(o.uuid=e.uuid,e.name!==void 0&&(o.name=e.name),e.matrix!==void 0?(o.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(o.matrixAutoUpdate=e.matrixAutoUpdate),o.matrixAutoUpdate&&o.matrix.decompose(o.position,o.quaternion,o.scale)):(e.position!==void 0&&o.position.fromArray(e.position),e.rotation!==void 0&&o.rotation.fromArray(e.rotation),e.quaternion!==void 0&&o.quaternion.fromArray(e.quaternion),e.scale!==void 0&&o.scale.fromArray(e.scale)),e.up!==void 0&&o.up.fromArray(e.up),e.castShadow!==void 0&&(o.castShadow=e.castShadow),e.receiveShadow!==void 0&&(o.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(o.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(o.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(o.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(o.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&o.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(o.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(o.visible=e.visible),e.frustumCulled!==void 0&&(o.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(o.renderOrder=e.renderOrder),e.userData!==void 0&&(o.userData=e.userData),e.layers!==void 0&&(o.layers.mask=e.layers),e.children!==void 0){const f=e.children;for(let p=0;p<f.length;p++)o.add(this.parseObject(f[p],t,n,i,s))}if(e.animations!==void 0){const f=e.animations;for(let p=0;p<f.length;p++){const y=f[p];o.animations.push(s[y])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(o.autoUpdate=e.autoUpdate);const f=e.levels;for(let p=0;p<f.length;p++){const y=f[p],G=o.getObjectByProperty("uuid",y.object);G!==void 0&&o.addLevel(G,y.distance,y.hysteresis)}}return o}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?Qt("ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);i!==void 0?t.target=i:t.target=new ti}})}}const OK={UVMapping:_u,CubeReflectionMapping:Vl,CubeRefractionMapping:Xu,EquirectangularReflectionMapping:CC,EquirectangularRefractionMapping:am,CubeUVReflectionMapping:wC},mR={RepeatWrapping:sm,ClampToEdgeWrapping:Ca,MirroredRepeatWrapping:om},pR={NearestFilter:Ba,NearestMipmapNearestFilter:fS,NearestMipmapLinearFilter:sC,LinearFilter:Pn,LinearMipmapNearestFilter:Hf,LinearMipmapLinearFilter:Gc},cB=new WeakMap;class jK extends Bo{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&Qt("ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&Qt("ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"},this._abortController=new AbortController}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,o=Bc.get(`image-bitmap:${e}`);if(o!==void 0){if(s.manager.itemStart(e),o.then){o.then(u=>{if(cB.has(o)===!0)i&&i(cB.get(o)),s.manager.itemError(e),s.manager.itemEnd(e);else return t&&t(u),s.manager.itemEnd(e),u});return}return setTimeout(function(){t&&t(o),s.manager.itemEnd(e)},0),o}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader,l.signal=typeof AbortSignal.any=="function"?AbortSignal.any([this._abortController.signal,this.manager.abortController.signal]):this._abortController.signal;const c=fetch(e,l).then(function(u){return u.blob()}).then(function(u){return createImageBitmap(u,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(u){return Bc.add(`image-bitmap:${e}`,u),t&&t(u),s.manager.itemEnd(e),u}).catch(function(u){i&&i(u),cB.set(c,u),Bc.remove(`image-bitmap:${e}`),s.manager.itemError(e),s.manager.itemEnd(e)});Bc.add(`image-bitmap:${e}`,c),s.manager.itemStart(e)}abort(){return this._abortController.abort(),this._abortController=new AbortController,this}}let Lb;class OS{static getContext(){return Lb===void 0&&(Lb=new(window.AudioContext||window.webkitAudioContext)),Lb}static setContext(e){Lb=e}}class JK extends Bo{constructor(e){super(e)}load(e,t,n,i){const s=this,o=new Ar(this.manager);o.setResponseType("arraybuffer"),o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,function(c){try{const u=c.slice(0);OS.getContext().decodeAudioData(u,function(A){t(A)}).catch(l)}catch(u){l(u)}},n,i);function l(c){i?i(c):Cn(c),s.manager.itemError(e)}}}const bR=new pn,yR=new pn,Xd=new pn;class PK{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ga,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ga,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,Xd.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,o=t.near*Math.tan(cI*t.fov*.5)/t.zoom;let l,c;yR.elements[12]=-i,bR.elements[12]=i,l=-o*t.aspect+s,c=o*t.aspect+s,Xd.elements[0]=2*t.near/(c-l),Xd.elements[8]=(c+l)/(c-l),this.cameraL.projectionMatrix.copy(Xd),l=-o*t.aspect-s,c=o*t.aspect-s,Xd.elements[0]=2*t.near/(c-l),Xd.elements[8]=(c+l)/(c-l),this.cameraR.projectionMatrix.copy(Xd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(yR),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(bR)}}class e3 extends Ga{constructor(e=[]){super(),this.isArrayCamera=!0,this.isMultiViewCamera=!1,this.cameras=e}}class jS{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=performance.now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=performance.now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}const Yd=new ue,gB=new xa,QK=new ue,Hd=new ue,Ed=new ue;class qK extends ti{constructor(){super(),this.type="AudioListener",this.context=OS.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new jS}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(Yd,gB,QK),Hd.set(0,0,-1).applyQuaternion(gB),Ed.set(0,1,0).applyQuaternion(gB),t.positionX){const n=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(Yd.x,n),t.positionY.linearRampToValueAtTime(Yd.y,n),t.positionZ.linearRampToValueAtTime(Yd.z,n),t.forwardX.linearRampToValueAtTime(Hd.x,n),t.forwardY.linearRampToValueAtTime(Hd.y,n),t.forwardZ.linearRampToValueAtTime(Hd.z,n),t.upX.linearRampToValueAtTime(Ed.x,n),t.upY.linearRampToValueAtTime(Ed.y,n),t.upZ.linearRampToValueAtTime(Ed.z,n)}else t.setPosition(Yd.x,Yd.y,Yd.z),t.setOrientation(Hd.x,Hd.y,Hd.z,Ed.x,Ed.y,Ed.z)}}class t3 extends ti{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){Qt("Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){Qt("Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){Qt("Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){Qt("Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){Qt("Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(Qt("Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){Qt("Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(Qt("Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const Fd=new ue,vR=new xa,$K=new ue,Kd=new ue;class eT extends t3{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(Fd,vR,$K),Kd.set(0,0,1).applyQuaternion(vR);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Fd.x,n),t.positionY.linearRampToValueAtTime(Fd.y,n),t.positionZ.linearRampToValueAtTime(Fd.z,n),t.orientationX.linearRampToValueAtTime(Kd.x,n),t.orientationY.linearRampToValueAtTime(Kd.y,n),t.orientationZ.linearRampToValueAtTime(Kd.z,n)}else t.setPosition(Fd.x,Fd.y,Fd.z),t.setOrientation(Kd.x,Kd.y,Kd.z)}}class tT{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class n3{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,s,o;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,s=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,s=e*i+i;let o=this.cumulativeWeight;if(o===0){for(let l=0;l!==i;++l)n[s+l]=n[l];o=t}else{o+=t;const l=t/o;this._mixBufferRegion(n,s,0,l,i)}this.cumulativeWeight=o}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,s=this.cumulativeWeight,o=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=t*this._origIndex;this._mixBufferRegion(n,i,c,1-s,t)}o>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let c=t,u=t+t;c!==u;++c)if(n[c]!==n[c+t]){l.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let s=n,o=i;s!==o;++s)t[s]=t[i+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,s){if(i>=.5)for(let o=0;o!==s;++o)e[t+o]=e[n+o]}_slerp(e,t,n,i){xa.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,s){const o=this._workIndex*s;xa.multiplyQuaternionsFlat(e,o,e,t,e,n),xa.slerpFlat(e,t,e,t,e,o,i)}_lerp(e,t,n,i,s){const o=1-i;for(let l=0;l!==s;++l){const c=t+l;e[c]=e[c]*o+e[n+l]*i}}_lerpAdditive(e,t,n,i,s){for(let o=0;o!==s;++o){const l=t+o;e[l]=e[l]+e[n+o]*i}}}const JS="\\[\\]\\.:\\/",nT=new RegExp("["+JS+"]","g"),PS="[^"+JS+"]",iT="[^"+JS.replace("\\.","")+"]",aT=/((?:WC+[\/:])*)/.source.replace("WC",PS),sT=/(WCOD+)?/.source.replace("WCOD",iT),oT=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",PS),rT=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",PS),lT=new RegExp("^"+aT+sT+oT+rT+"$"),cT=["material","materials","bones","map"];class gT{constructor(e,t,n){const i=n||ci.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class ci{constructor(e,t,n){this.path=t,this.parsedPath=n||ci.parseTrackName(t),this.node=ci.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new ci.Composite(e,t,n):new ci(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(nT,"")}static parseTrackName(e){const t=lT.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);cT.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let o=0;o<s.length;o++){const l=s[o];if(l.name===t||l.uuid===t)return l;const c=n(l.children);if(c)return c}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=ci.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){Qt("PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let u=t.objectIndex;switch(n){case"materials":if(!e.material){Cn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){Cn("PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){Cn("PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let h=0;h<e.length;h++)if(e[h].name===u){u=h;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){Cn("PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){Cn("PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){Cn("PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(u!==void 0){if(e[u]===void 0){Cn("PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[u]}}const o=e[i];if(o===void 0){const u=t.nodeName;Cn("PropertyBinding: Trying to update property for track: "+u+"."+i+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?l=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){Cn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){Cn("PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=o,this.propertyIndex=s}else o.fromArray!==void 0&&o.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=o):Array.isArray(o)?(c=this.BindingType.EntireArray,this.resolvedProperty=o):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}ci.Composite=gT;ci.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};ci.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};ci.prototype.GetterByBindingType=[ci.prototype._getValue_direct,ci.prototype._getValue_array,ci.prototype._getValue_arrayElement,ci.prototype._getValue_toArray];ci.prototype.SetterByBindingTypeAndVersioning=[[ci.prototype._setValue_direct,ci.prototype._setValue_direct_setNeedsUpdate,ci.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[ci.prototype._setValue_array,ci.prototype._setValue_array_setNeedsUpdate,ci.prototype._setValue_array_setMatrixWorldNeedsUpdate],[ci.prototype._setValue_arrayElement,ci.prototype._setValue_arrayElement_setNeedsUpdate,ci.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[ci.prototype._setValue_fromArray,ci.prototype._setValue_fromArray_setNeedsUpdate,ci.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class uT{constructor(){this.isAnimationObjectGroup=!0,this.uuid=Cr(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,s=this._bindings,o=s.length;let l,c=e.length,u=this.nCachedObjects_;for(let h=0,A=arguments.length;h!==A;++h){const f=arguments[h],p=f.uuid;let y=t[p];if(y===void 0){y=c++,t[p]=y,e.push(f);for(let G=0,B=o;G!==B;++G)s[G].push(new ci(f,n[G],i[G]))}else if(y<u){l=e[y];const G=--u,B=e[G];t[B.uuid]=y,e[y]=B,t[p]=G,e[G]=f;for(let S=0,N=o;S!==N;++S){const R=s[S],w=R[G];let V=R[y];R[y]=w,V===void 0&&(V=new ci(f,n[S],i[S])),R[G]=V}}else e[y]!==l&&Cn("AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_;for(let o=0,l=arguments.length;o!==l;++o){const c=arguments[o],u=c.uuid,h=t[u];if(h!==void 0&&h>=s){const A=s++,f=e[A];t[f.uuid]=h,e[h]=f,t[u]=A,e[A]=c;for(let p=0,y=i;p!==y;++p){const G=n[p],B=G[A],S=G[h];G[h]=B,G[A]=S}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_,o=e.length;for(let l=0,c=arguments.length;l!==c;++l){const u=arguments[l],h=u.uuid,A=t[h];if(A!==void 0)if(delete t[h],A<s){const f=--s,p=e[f],y=--o,G=e[y];t[p.uuid]=A,e[A]=p,t[G.uuid]=f,e[f]=G,e.pop();for(let B=0,S=i;B!==S;++B){const N=n[B],R=N[f],w=N[y];N[A]=R,N[f]=w,N.pop()}}else{const f=--o,p=e[f];f>0&&(t[p.uuid]=A),e[A]=p,e.pop();for(let y=0,G=i;y!==G;++y){const B=n[y];B[A]=B[f],B.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const s=this._bindings;if(i!==void 0)return s[i];const o=this._paths,l=this._parsedPaths,c=this._objects,u=c.length,h=this.nCachedObjects_,A=new Array(u);i=s.length,n[e]=i,o.push(e),l.push(t),s.push(A);for(let f=h,p=c.length;f!==p;++f){const y=c[f];A[f]=new ci(y,e,t)}return A}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,s=this._parsedPaths,o=this._bindings,l=o.length-1,c=o[l],u=e[l];t[u]=n,o[n]=c,o.pop(),s[n]=s[l],s.pop(),i[n]=i[l],i.pop()}}}class i3{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const s=t.tracks,o=s.length,l=new Array(o),c={endingStart:iI,endingEnd:iI};for(let u=0;u!==o;++u){const h=s[u].createInterpolant(null);l[u]=h,h.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=jW,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const i=this._clip.duration,s=e._clip.duration,o=s/i,l=i/s;e.warp(1,o,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,s=i.time,o=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=i._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,u=l.sampleValues;return c[0]=s,c[1]=s+n,u[0]=e/o,u[1]=t/o,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const c=(e-s)*n;c<0||n===0?t=0:(this._startTime=null,t=n*c)}t*=this._updateTimeScale(e);const o=this._updateTime(t),l=this._updateWeight(e);if(l>0){const c=this._interpolants,u=this._propertyBindings;switch(this.blendMode){case vS:for(let h=0,A=c.length;h!==A;++h)c[h].evaluate(o),u[h].accumulateAdditive(l);break;case zy:default:for(let h=0,A=c.length;h!==A;++h)c[h].evaluate(o),u[h].accumulate(i,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,s=this._loopCount;const o=n===JW;if(e===0)return s===-1?i:o&&(s&1)===1?t-i:i;if(n===OW){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,o)):this._setEndings(this.repetitions===0,!0,o)),i>=t||i<0){const l=Math.floor(i/t);i-=t*l,s+=Math.abs(l);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const u=e<0;this._setEndings(u,!u,o)}else this._setEndings(!1,!1,o);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=i;if(o&&(s&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=aI,i.endingEnd=aI):(e?i.endingStart=this.zeroSlopeAtStart?aI:iI:i.endingStart=lm,t?i.endingEnd=this.zeroSlopeAtEnd?aI:iI:i.endingEnd=lm)}_scheduleFading(e,t,n){const i=this._mixer,s=i.time;let o=this._weightInterpolant;o===null&&(o=i._lendControlInterpolant(),this._weightInterpolant=o);const l=o.parameterPositions,c=o.sampleValues;return l[0]=s,c[0]=t,l[1]=s+e,c[1]=n,this}}const dT=new Float32Array(1);class IT extends Nc{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,s=i.length,o=e._propertyBindings,l=e._interpolants,c=n.uuid,u=this._bindingsByRootAndName;let h=u[c];h===void 0&&(h={},u[c]=h);for(let A=0;A!==s;++A){const f=i[A],p=f.name;let y=h[p];if(y!==void 0)++y.referenceCount,o[A]=y;else{if(y=o[A],y!==void 0){y._cacheIndex===null&&(++y.referenceCount,this._addInactiveBinding(y,c,p));continue}const G=t&&t._propertyBindings[A].binding.parsedPath;y=new n3(ci.create(n,p,G),f.ValueTypeName,f.getValueSize()),++y.referenceCount,this._addInactiveBinding(y,c,p),o[A]=y}l[A].resultBuffer=y.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,s=this._actionsByClip;let o=s[t];if(o===void 0)o={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=o;else{const l=o.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=i.length,i.push(e),o.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,o=this._actionsByClip,l=o[s],c=l.knownActions,u=c[c.length-1],h=e._byClipCacheIndex;u._byClipCacheIndex=h,c[h]=u,c.pop(),e._byClipCacheIndex=null;const A=l.actionByRoot,f=(e._localRoot||this._root).uuid;delete A[f],c.length===0&&delete o[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,s=this._bindings;let o=i[t];o===void 0&&(o={},i[t]=o),o[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,s=n.path,o=this._bindingsByRootAndName,l=o[i],c=t[t.length-1],u=e._cacheIndex;c._cacheIndex=u,t[u]=c,t.pop(),delete l[s],Object.keys(l).length===0&&delete o[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new zS(new Float32Array(2),new Float32Array(2),1,dT),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const i=t||this._root,s=i.uuid;let o=typeof e=="string"?pm.findByName(i,e):e;const l=o!==null?o.uuid:e,c=this._actionsByClip[l];let u=null;if(n===void 0&&(o!==null?n=o.blendMode:n=zy),c!==void 0){const A=c.actionByRoot[s];if(A!==void 0&&A.blendMode===n)return A;u=c.knownActions[0],o===null&&(o=u._clip)}if(o===null)return null;const h=new i3(this,o,t,n);return this._bindAction(h,u),this._addInactiveAction(h,l,s),h}existingAction(e,t){const n=t||this._root,i=n.uuid,s=typeof e=="string"?pm.findByName(n,e):e,o=s?s.uuid:e,l=this._actionsByClip[o];return l!==void 0&&l.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,s=Math.sign(e),o=this._accuIndex^=1;for(let u=0;u!==n;++u)t[u]._update(i,e,s,o);const l=this._bindings,c=this._nActiveBindings;for(let u=0;u!==c;++u)l[u].apply(o);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,s=i[n];if(s!==void 0){const o=s.knownActions;for(let l=0,c=o.length;l!==c;++l){const u=o[l];this._deactivateAction(u);const h=u._cacheIndex,A=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,A._cacheIndex=h,t[h]=A,t.pop(),this._removeInactiveBindingsForAction(u)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const o in n){const l=n[o].actionByRoot,c=l[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const o in s){const l=s[o];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class hT extends BS{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new Dy(null,e,t,n),this._setTextureOptions(i),this.texture.isRenderTargetTexture=!0}}class QS{constructor(e){this.value=e}clone(){return new QS(this.value.clone===void 0?this.value:this.value.clone())}}let CT=0;class AT extends Nc{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:CT++}),this.name="",this.usage=gm,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let o=0;o<s.length;o++)this.uniforms.push(s[o].clone())}return this}clone(){return new this.constructor().copy(this)}}class by extends Qy{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class fT{constructor(e,t,n,i,s,o=!1){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=s,this.normalized=o,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const GR=new pn;class qS{constructor(e,t,n=0,i=1/0){this.ray=new pI(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new yC,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):Cn("Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return GR.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(GR),this}intersectObject(e,t=!0,n=[]){return W2(e,this,n,t),n.sort(BR),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)W2(e[i],this,n,t);return n.sort(BR),n}}function BR(a,e){return a.distance-e.distance}function W2(a,e,t,n){let i=!0;if(a.layers.test(e.layers)&&a.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const s=a.children;for(let o=0,l=s.length;o<l;o++)W2(s[o],e,t,!0)}}class mT{constructor(){this._previousTime=0,this._currentTime=0,this._startTime=performance.now(),this._delta=0,this._elapsed=0,this._timescale=1,this._document=null,this._pageVisibilityHandler=null}connect(e){this._document=e,e.hidden!==void 0&&(this._pageVisibilityHandler=pT.bind(this),e.addEventListener("visibilitychange",this._pageVisibilityHandler,!1))}disconnect(){this._pageVisibilityHandler!==null&&(this._document.removeEventListener("visibilitychange",this._pageVisibilityHandler),this._pageVisibilityHandler=null),this._document=null}getDelta(){return this._delta/1e3}getElapsed(){return this._elapsed/1e3}getTimescale(){return this._timescale}setTimescale(e){return this._timescale=e,this}reset(){return this._currentTime=performance.now()-this._startTime,this}dispose(){this.disconnect()}update(e){return this._pageVisibilityHandler!==null&&this._document.hidden===!0?this._delta=0:(this._previousTime=this._currentTime,this._currentTime=(e!==void 0?e:performance.now())-this._startTime,this._delta=(this._currentTime-this._previousTime)*this._timescale,this._elapsed+=this._delta),this}}function pT(){this._document.hidden===!1&&this.reset()}class V2{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Zn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(Zn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class bT{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class $S{constructor(e,t,n,i){$S.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=i,this}}const SR=new yt;class yT{constructor(e=new yt(1/0,1/0),t=new yt(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=SR.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,SR).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const xR=new ue,kb=new ue,Dh=new ue,Oh=new ue,uB=new ue,vT=new ue,GT=new ue;class a3{constructor(e=new ue,t=new ue){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){xR.subVectors(e,this.start),kb.subVectors(this.end,this.start);const n=kb.dot(kb);let s=kb.dot(xR)/n;return t&&(s=Zn(s,0,1)),s}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}distanceSqToLine3(e,t=vT,n=GT){const i=10000000000000001e-32;let s,o;const l=this.start,c=e.start,u=this.end,h=e.end;Dh.subVectors(u,l),Oh.subVectors(h,c),uB.subVectors(l,c);const A=Dh.dot(Dh),f=Oh.dot(Oh),p=Oh.dot(uB);if(A<=i&&f<=i)return t.copy(l),n.copy(c),t.sub(n),t.dot(t);if(A<=i)s=0,o=p/f,o=Zn(o,0,1);else{const y=Dh.dot(uB);if(f<=i)o=0,s=Zn(-y/A,0,1);else{const G=Dh.dot(Oh),B=A*f-G*G;B!==0?s=Zn((G*p-y*f)/B,0,1):s=0,o=(G*s+p)/f,o<0?(o=0,s=Zn(-y/A,0,1)):o>1&&(o=1,s=Zn((G-y)/A,0,1))}}return t.copy(l).add(Dh.multiplyScalar(s)),n.copy(c).add(Oh.multiplyScalar(o)),t.sub(n),t.dot(t)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const ZR=new ue;class BT extends ti{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new Mn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let o=0,l=1,c=32;o<c;o++,l++){const u=o/c*Math.PI*2,h=l/c*Math.PI*2;i.push(Math.cos(u),Math.sin(u),1,Math.cos(h),Math.sin(h),1)}n.setAttribute("position",new an(i,3));const s=new Go({fog:!1,toneMapped:!1});this.cone=new Vc(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),ZR.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(ZR),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const vu=new ue,Ub=new pn,dB=new pn;class ST extends Vc{constructor(e){const t=s3(e),n=new Mn,i=[],s=[];for(let u=0;u<t.length;u++){const h=t[u];h.parent&&h.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(0,0,0),s.push(0,0,0))}n.setAttribute("position",new an(i,3)),n.setAttribute("color",new an(s,3));const o=new Go({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,o),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1;const l=new tn(255),c=new tn(65280);this.setColors(l,c)}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");dB.copy(this.root.matrixWorld).invert();for(let s=0,o=0;s<t.length;s++){const l=t[s];l.parent&&l.parent.isBone&&(Ub.multiplyMatrices(dB,l.matrixWorld),vu.setFromMatrixPosition(Ub),i.setXYZ(o,vu.x,vu.y,vu.z),Ub.multiplyMatrices(dB,l.parent.matrixWorld),vu.setFromMatrixPosition(Ub),i.setXYZ(o+1,vu.x,vu.y,vu.z),o+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}setColors(e,t){const i=this.geometry.getAttribute("color");for(let s=0;s<i.count;s+=2)i.setXYZ(s,e.r,e.g,e.b),i.setXYZ(s+1,t.r,t.g,t.b);return i.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}function s3(a){const e=[];a.isBone===!0&&e.push(a);for(let t=0;t<a.children.length;t++)e.push(...s3(a.children[t]));return e}class xT extends _i{constructor(e,t,n){const i=new Fm(t,4,2),s=new Wc({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const ZT=new ue,wR=new tn,RR=new tn;class wT extends ti{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Em(t);i.rotateY(Math.PI*.5),this.material=new Wc({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),o=new Float32Array(s.count*3);i.setAttribute("color",new Zi(o,3)),this.add(new _i(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");wR.copy(this.light.color),RR.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const s=n<i/2?wR:RR;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(ZT.setFromMatrixPosition(this.light.matrixWorld).negate())}}class RT extends Vc{constructor(e=10,t=10,n=4473924,i=8947848){n=new tn(n),i=new tn(i);const s=t/2,o=e/t,l=e/2,c=[],u=[];for(let f=0,p=0,y=-l;f<=t;f++,y+=o){c.push(-l,0,y,l,0,y),c.push(y,0,-l,y,0,l);const G=f===s?n:i;G.toArray(u,p),p+=3,G.toArray(u,p),p+=3,G.toArray(u,p),p+=3,G.toArray(u,p),p+=3}const h=new Mn;h.setAttribute("position",new an(c,3)),h.setAttribute("color",new an(u,3));const A=new Go({vertexColors:!0,toneMapped:!1});super(h,A),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class NT extends Vc{constructor(e=10,t=16,n=8,i=64,s=4473924,o=8947848){s=new tn(s),o=new tn(o);const l=[],c=[];if(t>1)for(let A=0;A<t;A++){const f=A/t*(Math.PI*2),p=Math.sin(f)*e,y=Math.cos(f)*e;l.push(0,0,0),l.push(p,0,y);const G=A&1?s:o;c.push(G.r,G.g,G.b),c.push(G.r,G.g,G.b)}for(let A=0;A<n;A++){const f=A&1?s:o,p=e-e/n*A;for(let y=0;y<i;y++){let G=y/i*(Math.PI*2),B=Math.sin(G)*p,S=Math.cos(G)*p;l.push(B,0,S),c.push(f.r,f.g,f.b),G=(y+1)/i*(Math.PI*2),B=Math.sin(G)*p,S=Math.cos(G)*p,l.push(B,0,S),c.push(f.r,f.g,f.b)}}const u=new Mn;u.setAttribute("position",new an(l,3)),u.setAttribute("color",new an(c,3));const h=new Go({vertexColors:!0,toneMapped:!1});super(u,h),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const NR=new ue,Db=new ue,WR=new ue;class WT extends ti{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new Mn;i.setAttribute("position",new an([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new Go({fog:!1,toneMapped:!1});this.lightPlane=new Hu(i,s),this.add(this.lightPlane),i=new Mn,i.setAttribute("position",new an([0,0,0,0,0,1],3)),this.targetLine=new Hu(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),NR.setFromMatrixPosition(this.light.matrixWorld),Db.setFromMatrixPosition(this.light.target.matrixWorld),WR.subVectors(Db,NR),this.lightPlane.lookAt(Db),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(Db),this.targetLine.scale.z=WR.length()}}const Ob=new ue,da=new Oy;class VT extends Vc{constructor(e){const t=new Mn,n=new Go({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],o={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(y,G){c(y),c(G)}function c(y){i.push(0,0,0),s.push(0,0,0),o[y]===void 0&&(o[y]=[]),o[y].push(i.length/3-1)}t.setAttribute("position",new an(i,3)),t.setAttribute("color",new an(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update();const u=new tn(16755200),h=new tn(16711680),A=new tn(43775),f=new tn(16777215),p=new tn(3355443);this.setColors(u,h,A,f,p)}setColors(e,t,n,i,s){const l=this.geometry.getAttribute("color");return l.setXYZ(0,e.r,e.g,e.b),l.setXYZ(1,e.r,e.g,e.b),l.setXYZ(2,e.r,e.g,e.b),l.setXYZ(3,e.r,e.g,e.b),l.setXYZ(4,e.r,e.g,e.b),l.setXYZ(5,e.r,e.g,e.b),l.setXYZ(6,e.r,e.g,e.b),l.setXYZ(7,e.r,e.g,e.b),l.setXYZ(8,e.r,e.g,e.b),l.setXYZ(9,e.r,e.g,e.b),l.setXYZ(10,e.r,e.g,e.b),l.setXYZ(11,e.r,e.g,e.b),l.setXYZ(12,e.r,e.g,e.b),l.setXYZ(13,e.r,e.g,e.b),l.setXYZ(14,e.r,e.g,e.b),l.setXYZ(15,e.r,e.g,e.b),l.setXYZ(16,e.r,e.g,e.b),l.setXYZ(17,e.r,e.g,e.b),l.setXYZ(18,e.r,e.g,e.b),l.setXYZ(19,e.r,e.g,e.b),l.setXYZ(20,e.r,e.g,e.b),l.setXYZ(21,e.r,e.g,e.b),l.setXYZ(22,e.r,e.g,e.b),l.setXYZ(23,e.r,e.g,e.b),l.setXYZ(24,t.r,t.g,t.b),l.setXYZ(25,t.r,t.g,t.b),l.setXYZ(26,t.r,t.g,t.b),l.setXYZ(27,t.r,t.g,t.b),l.setXYZ(28,t.r,t.g,t.b),l.setXYZ(29,t.r,t.g,t.b),l.setXYZ(30,t.r,t.g,t.b),l.setXYZ(31,t.r,t.g,t.b),l.setXYZ(32,n.r,n.g,n.b),l.setXYZ(33,n.r,n.g,n.b),l.setXYZ(34,n.r,n.g,n.b),l.setXYZ(35,n.r,n.g,n.b),l.setXYZ(36,n.r,n.g,n.b),l.setXYZ(37,n.r,n.g,n.b),l.setXYZ(38,i.r,i.g,i.b),l.setXYZ(39,i.r,i.g,i.b),l.setXYZ(40,s.r,s.g,s.b),l.setXYZ(41,s.r,s.g,s.b),l.setXYZ(42,s.r,s.g,s.b),l.setXYZ(43,s.r,s.g,s.b),l.setXYZ(44,s.r,s.g,s.b),l.setXYZ(45,s.r,s.g,s.b),l.setXYZ(46,s.r,s.g,s.b),l.setXYZ(47,s.r,s.g,s.b),l.setXYZ(48,s.r,s.g,s.b),l.setXYZ(49,s.r,s.g,s.b),l.needsUpdate=!0,this}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;let s,o;if(da.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),this.camera.reversedDepth===!0)s=1,o=0;else if(this.camera.coordinateSystem===Ir)s=-1,o=1;else if(this.camera.coordinateSystem===mC)s=0,o=1;else throw new Error("THREE.CameraHelper.update(): Invalid coordinate system: "+this.camera.coordinateSystem);va("c",t,e,da,0,0,s),va("t",t,e,da,0,0,o),va("n1",t,e,da,-n,-i,s),va("n2",t,e,da,n,-i,s),va("n3",t,e,da,-n,i,s),va("n4",t,e,da,n,i,s),va("f1",t,e,da,-n,-i,o),va("f2",t,e,da,n,-i,o),va("f3",t,e,da,-n,i,o),va("f4",t,e,da,n,i,o),va("u1",t,e,da,n*.7,i*1.1,s),va("u2",t,e,da,-n*.7,i*1.1,s),va("u3",t,e,da,0,i*2,s),va("cf1",t,e,da,-n,0,o),va("cf2",t,e,da,n,0,o),va("cf3",t,e,da,0,-i,o),va("cf4",t,e,da,0,i,o),va("cn1",t,e,da,-n,0,s),va("cn2",t,e,da,n,0,s),va("cn3",t,e,da,0,-i,s),va("cn4",t,e,da,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function va(a,e,t,n,i,s,o){Ob.set(i,s,o).unproject(n);const l=e[a];if(l!==void 0){const c=t.getAttribute("position");for(let u=0,h=l.length;u<h;u++)c.setXYZ(l[u],Ob.x,Ob.y,Ob.z)}}const jb=new Za;class MT extends Vc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),s=new Mn;s.setIndex(new Zi(n,1)),s.setAttribute("position",new Zi(i,3)),super(s,new Go({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&jb.setFromObject(this.object),jb.isEmpty())return;const e=jb.min,t=jb.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class _T extends Vc{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new Mn;s.setIndex(new Zi(n,1)),s.setAttribute("position",new an(i,3)),super(s,new Go({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class XT extends Hu{constructor(e,t=1,n=16776960){const i=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],o=new Mn;o.setAttribute("position",new an(s,3)),o.computeBoundingSphere(),super(o,new Go({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new Mn;c.setAttribute("position",new an(l,3)),c.computeBoundingSphere(),this.add(new _i(c,new Wc({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const VR=new ue;let Jb,IB;class YT extends ti{constructor(e=new ue(0,0,1),t=new ue(0,0,0),n=1,i=16776960,s=n*.2,o=s*.2){super(),this.type="ArrowHelper",Jb===void 0&&(Jb=new Mn,Jb.setAttribute("position",new an([0,0,0,0,1,0],3)),IB=new Ym(.5,1,5,1),IB.translate(0,-.5,0)),this.position.copy(t),this.line=new Hu(Jb,new Go({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new _i(IB,new Wc({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,o)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{VR.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(VR,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class HT extends Vc{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new Mn;i.setAttribute("position",new an(t,3)),i.setAttribute("color",new an(n,3));const s=new Go({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,n){const i=new tn,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ET{constructor(){this.type="ShapePath",this.color=new tn,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new py,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,s,o){return this.currentPath.bezierCurveTo(e,t,n,i,s,o),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(S){const N=[];for(let R=0,w=S.length;R<w;R++){const V=S[R],H=new gI;H.curves=V.curves,N.push(H)}return N}function n(S,N){const R=N.length;let w=!1;for(let V=R-1,H=0;H<R;V=H++){let X=N[V],Y=N[H],M=Y.x-X.x,E=Y.y-X.y;if(Math.abs(E)>Number.EPSILON){if(E<0&&(X=N[H],M=-M,Y=N[V],E=-E),S.y<X.y||S.y>Y.y)continue;if(S.y===X.y){if(S.x===X.x)return!0}else{const O=E*(S.x-X.x)-M*(S.y-X.y);if(O===0)return!0;if(O<0)continue;w=!w}}else{if(S.y!==X.y)continue;if(Y.x<=S.x&&S.x<=X.x||X.x<=S.x&&S.x<=Y.x)return!0}}return w}const i=Nl.isClockWise,s=this.subPaths;if(s.length===0)return[];let o,l,c;const u=[];if(s.length===1)return l=s[0],c=new gI,c.curves=l.curves,u.push(c),u;let h=!i(s[0].getPoints());h=e?!h:h;const A=[],f=[];let p=[],y=0,G;f[y]=void 0,p[y]=[];for(let S=0,N=s.length;S<N;S++)l=s[S],G=l.getPoints(),o=i(G),o=e?!o:o,o?(!h&&f[y]&&y++,f[y]={s:new gI,p:G},f[y].s.curves=l.curves,h&&y++,p[y]=[]):p[y].push({h:l,p:G[0]});if(!f[0])return t(s);if(f.length>1){let S=!1,N=0;for(let R=0,w=f.length;R<w;R++)A[R]=[];for(let R=0,w=f.length;R<w;R++){const V=p[R];for(let H=0;H<V.length;H++){const X=V[H];let Y=!0;for(let M=0;M<f.length;M++)n(X.p,f[M].p)&&(R!==M&&N++,Y?(Y=!1,A[M].push(X)):S=!0);Y&&A[R].push(X)}}N>0&&S===!1&&(p=A)}let B;for(let S=0,N=f.length;S<N;S++){c=f[S].s,u.push(c),B=p[S];for(let R=0,w=B.length;R<w;R++)c.holes.push(B[R].h)}return u}}class FT extends Nc{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){Qt("Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function KT(a,e){const t=a.image&&a.image.width?a.image.width/a.image.height:1;return t>e?(a.repeat.x=1,a.repeat.y=t/e,a.offset.x=0,a.offset.y=(1-a.repeat.y)/2):(a.repeat.x=e/t,a.repeat.y=1,a.offset.x=(1-a.repeat.x)/2,a.offset.y=0),a}function TT(a,e){const t=a.image&&a.image.width?a.image.width/a.image.height:1;return t>e?(a.repeat.x=e/t,a.repeat.y=1,a.offset.x=(1-a.repeat.x)/2,a.offset.y=0):(a.repeat.x=1,a.repeat.y=t/e,a.offset.x=0,a.offset.y=(1-a.repeat.y)/2),a}function zT(a){return a.repeat.x=1,a.repeat.y=1,a.offset.x=0,a.offset.y=0,a}function M2(a,e,t,n){const i=LT(n);switch(t){case bS:return a*e;case Wm:return a*e/i.components*i.byteLength;case Vm:return a*e/i.components*i.byteLength;case hI:return a*e*2/i.components*i.byteLength;case Ky:return a*e*2/i.components*i.byteLength;case yS:return a*e*3/i.components*i.byteLength;case Sa:return a*e*4/i.components*i.byteLength;case Ty:return a*e*4/i.components*i.byteLength;case Ef:case Ff:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*8;case Kf:case Tf:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*16;case E0:case K0:return Math.max(a,16)*Math.max(e,8)/4;case H0:case F0:return Math.max(a,8)*Math.max(e,8)/2;case T0:case z0:case k0:case U0:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*8;case L0:case D0:case O0:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*16;case j0:return Math.floor((a+3)/4)*Math.floor((e+3)/4)*16;case J0:return Math.floor((a+4)/5)*Math.floor((e+3)/4)*16;case P0:return Math.floor((a+4)/5)*Math.floor((e+4)/5)*16;case Q0:return Math.floor((a+5)/6)*Math.floor((e+4)/5)*16;case q0:return Math.floor((a+5)/6)*Math.floor((e+5)/6)*16;case $0:return Math.floor((a+7)/8)*Math.floor((e+4)/5)*16;case ey:return Math.floor((a+7)/8)*Math.floor((e+5)/6)*16;case ty:return Math.floor((a+7)/8)*Math.floor((e+7)/8)*16;case ny:return Math.floor((a+9)/10)*Math.floor((e+4)/5)*16;case iy:return Math.floor((a+9)/10)*Math.floor((e+5)/6)*16;case ay:return Math.floor((a+9)/10)*Math.floor((e+7)/8)*16;case sy:return Math.floor((a+9)/10)*Math.floor((e+9)/10)*16;case oy:return Math.floor((a+11)/12)*Math.floor((e+9)/10)*16;case ry:return Math.floor((a+11)/12)*Math.floor((e+11)/12)*16;case ly:case cy:case gy:return Math.ceil(a/4)*Math.ceil(e/4)*16;case uy:case dy:return Math.ceil(a/4)*Math.ceil(e/4)*8;case Iy:case hy:return Math.ceil(a/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function LT(a){switch(a){case os:case Yy:return{byteLength:1,components:1};case AC:case Hy:case Aa:return{byteLength:2,components:1};case Ey:case Fy:return{byteLength:2,components:4};case fr:case Nm:case $i:return{byteLength:4,components:1};case mS:case pS:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${a}.`)}class kT{static contain(e,t){return KT(e,t)}static cover(e,t){return TT(e,t)}static fill(e){return zT(e)}static getByteLength(e,t,n,i){return M2(e,t,n,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:wm}}));typeof window<"u"&&(window.__THREE__?Qt("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=wm);function o3(){let a=null,e=!1,t=null,n=null;function i(s,o){t(s,o),n=a.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=a.requestAnimationFrame(i),e=!0)},stop:function(){a.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){a=s}}}function UT(a){const e=new WeakMap;function t(l,c){const u=l.array,h=l.usage,A=u.byteLength,f=a.createBuffer();a.bindBuffer(c,f),a.bufferData(c,u,h),l.onUploadCallback();let p;if(u instanceof Float32Array)p=a.FLOAT;else if(typeof Float16Array<"u"&&u instanceof Float16Array)p=a.HALF_FLOAT;else if(u instanceof Uint16Array)l.isFloat16BufferAttribute?p=a.HALF_FLOAT:p=a.UNSIGNED_SHORT;else if(u instanceof Int16Array)p=a.SHORT;else if(u instanceof Uint32Array)p=a.UNSIGNED_INT;else if(u instanceof Int32Array)p=a.INT;else if(u instanceof Int8Array)p=a.BYTE;else if(u instanceof Uint8Array)p=a.UNSIGNED_BYTE;else if(u instanceof Uint8ClampedArray)p=a.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+u);return{buffer:f,type:p,bytesPerElement:u.BYTES_PER_ELEMENT,version:l.version,size:A}}function n(l,c,u){const h=c.array,A=c.updateRanges;if(a.bindBuffer(u,l),A.length===0)a.bufferSubData(u,0,h);else{A.sort((p,y)=>p.start-y.start);let f=0;for(let p=1;p<A.length;p++){const y=A[f],G=A[p];G.start<=y.start+y.count+1?y.count=Math.max(y.count,G.start+G.count-y.start):(++f,A[f]=G)}A.length=f+1;for(let p=0,y=A.length;p<y;p++){const G=A[p];a.bufferSubData(u,G.start*h.BYTES_PER_ELEMENT,h,G.start,G.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function s(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=e.get(l);c&&(a.deleteBuffer(c.buffer),e.delete(l))}function o(l,c){if(l.isInterleavedBufferAttribute&&(l=l.data),l.isGLBufferAttribute){const h=e.get(l);(!h||h.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}const u=e.get(l);if(u===void 0)e.set(l,t(l,c));else if(u.version<l.version){if(u.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(u.buffer,l,c),u.version=l.version}}return{get:i,remove:s,update:o}}var DT=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,OT=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,jT=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,JT=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,PT=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,QT=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,qT=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,$T=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,ez=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,tz=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,nz=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,iz=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,az=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,sz=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,oz=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,rz=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,lz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,cz=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,gz=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,uz=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,dz=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Iz=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,hz=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,Cz=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Az=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,fz=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,mz=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,pz=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,bz=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,yz=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,vz="gl_FragColor = linearToOutputTexel( gl_FragColor );",Gz=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,Bz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Sz=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
#endif`,xz=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,Zz=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,wz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,Rz=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Nz=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,Wz=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Vz=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Mz=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,_z=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Xz=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,Yz=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,Hz=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,Ez=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, pow4( roughness ) ) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,Fz=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,Kz=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,Tz=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,zz=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,Lz=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.diffuseContribution = diffuseColor.rgb * ( 1.0 - metalnessFactor );
material.metalness = metalnessFactor;
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor;
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = vec3( 0.04 );
	material.specularColorBlended = mix( material.specularColor, diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.0001, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,kz=`uniform sampler2D dfgLUT;
struct PhysicalMaterial {
	vec3 diffuseColor;
	vec3 diffuseContribution;
	vec3 specularColor;
	vec3 specularColorBlended;
	float roughness;
	float metalness;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
		vec3 iridescenceFresnelDielectric;
		vec3 iridescenceFresnelMetallic;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return v;
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColorBlended;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transpose( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float rInv = 1.0 / ( roughness + 0.1 );
	float a = -1.9362 + 1.0678 * roughness + 0.4573 * r2 - 0.8469 * rInv;
	float b = -0.6014 + 0.5538 * roughness - 0.4670 * r2 - 0.1255 * rInv;
	float DG = exp( a * dotNV + b );
	return saturate( DG );
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 fab = texture2D( dfgLUT, vec2( roughness, dotNV ) ).rg;
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
vec3 BRDF_GGX_Multiscatter( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 singleScatter = BRDF_GGX( lightDir, viewDir, normal, material );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 dfgV = texture2D( dfgLUT, vec2( material.roughness, dotNV ) ).rg;
	vec2 dfgL = texture2D( dfgLUT, vec2( material.roughness, dotNL ) ).rg;
	vec3 FssEss_V = material.specularColorBlended * dfgV.x + material.specularF90 * dfgV.y;
	vec3 FssEss_L = material.specularColorBlended * dfgL.x + material.specularF90 * dfgL.y;
	float Ess_V = dfgV.x + dfgV.y;
	float Ess_L = dfgL.x + dfgL.y;
	float Ems_V = 1.0 - Ess_V;
	float Ems_L = 1.0 - Ess_L;
	vec3 Favg = material.specularColorBlended + ( 1.0 - material.specularColorBlended ) * 0.047619;
	vec3 Fms = FssEss_V * FssEss_L * Favg / ( 1.0 - Ems_V * Ems_L * Favg + EPSILON );
	float compensationFactor = Ems_V * Ems_L;
	vec3 multiScatter = Fms * compensationFactor;
	return singleScatter + multiScatter;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColorBlended * t2.x + ( vec3( 1.0 ) - material.specularColorBlended ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseContribution * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
 
 		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
 
 		float sheenAlbedoV = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
 		float sheenAlbedoL = IBLSheenBRDF( geometryNormal, directLight.direction, material.sheenRoughness );
 
 		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * max( sheenAlbedoV, sheenAlbedoL );
 
 		irradiance *= sheenEnergyComp;
 
 	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX_Multiscatter( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseContribution );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 diffuse = irradiance * BRDF_Lambert( material.diffuseContribution );
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		diffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectDiffuse += diffuse;
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness ) * RECIPROCAL_PI;
 	#endif
	vec3 singleScatteringDielectric = vec3( 0.0 );
	vec3 multiScatteringDielectric = vec3( 0.0 );
	vec3 singleScatteringMetallic = vec3( 0.0 );
	vec3 multiScatteringMetallic = vec3( 0.0 );
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnelDielectric, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.iridescence, material.iridescenceFresnelMetallic, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScatteringDielectric, multiScatteringDielectric );
		computeMultiscattering( geometryNormal, geometryViewDir, material.diffuseColor, material.specularF90, material.roughness, singleScatteringMetallic, multiScatteringMetallic );
	#endif
	vec3 singleScattering = mix( singleScatteringDielectric, singleScatteringMetallic, material.metalness );
	vec3 multiScattering = mix( multiScatteringDielectric, multiScatteringMetallic, material.metalness );
	vec3 totalScatteringDielectric = singleScatteringDielectric + multiScatteringDielectric;
	vec3 diffuse = material.diffuseContribution * ( 1.0 - totalScatteringDielectric );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	vec3 indirectSpecular = radiance * singleScattering;
	indirectSpecular += multiScattering * cosineWeightedIrradiance;
	vec3 indirectDiffuse = diffuse * cosineWeightedIrradiance;
	#ifdef USE_SHEEN
		float sheenAlbedo = IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
		float sheenEnergyComp = 1.0 - max3( material.sheenColor ) * sheenAlbedo;
		indirectSpecular *= sheenEnergyComp;
		indirectDiffuse *= sheenEnergyComp;
	#endif
	reflectedLight.indirectSpecular += indirectSpecular;
	reflectedLight.indirectDiffuse += indirectDiffuse;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Uz=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnelDielectric = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceFresnelMetallic = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.diffuseColor );
		material.iridescenceFresnel = mix( material.iridescenceFresnelDielectric, material.iridescenceFresnelMetallic, material.metalness );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS ) && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Dz=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Oz=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,jz=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Jz=`#if defined( USE_LOGARITHMIC_DEPTH_BUFFER )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Pz=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Qz=`#ifdef USE_LOGARITHMIC_DEPTH_BUFFER
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,qz=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,$z=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,eL=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,tL=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,nL=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,iL=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,aL=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,sL=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,oL=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,rL=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,lL=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,cL=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,gL=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,uL=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dL=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,IL=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,hL=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,CL=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,AL=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,fL=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,mL=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,pL=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,bL=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,yL=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,vL=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,GL=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,BL=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,SL=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,xL=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,ZL=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#else
			uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		#endif
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform sampler2DShadow spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#else
			uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		#endif
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#if defined( SHADOWMAP_TYPE_PCF )
			uniform samplerCubeShadow pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#elif defined( SHADOWMAP_TYPE_BASIC )
			uniform samplerCube pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		#endif
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float interleavedGradientNoise( vec2 position ) {
			return fract( 52.9829189 * fract( dot( position, vec2( 0.06711056, 0.00583715 ) ) ) );
		}
		vec2 vogelDiskSample( int sampleIndex, int samplesCount, float phi ) {
			const float goldenAngle = 2.399963229728653;
			float r = sqrt( ( float( sampleIndex ) + 0.5 ) / float( samplesCount ) );
			float theta = float( sampleIndex ) * goldenAngle + phi;
			return vec2( cos( theta ), sin( theta ) ) * r;
		}
	#endif
	#if defined( SHADOWMAP_TYPE_PCF )
		float getShadow( sampler2DShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
				float radius = shadowRadius * texelSize.x;
				float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
				shadow = (
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 0, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 1, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 2, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 3, 5, phi ) * radius, shadowCoord.z ) ) +
					texture( shadowMap, vec3( shadowCoord.xy + vogelDiskSample( 4, 5, phi ) * radius, shadowCoord.z ) )
				) * 0.2;
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#elif defined( SHADOWMAP_TYPE_VSM )
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				vec2 distribution = texture2D( shadowMap, shadowCoord.xy ).rg;
				float mean = distribution.x;
				float variance = distribution.y * distribution.y;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					float hard_shadow = step( mean, shadowCoord.z );
				#else
					float hard_shadow = step( shadowCoord.z, mean );
				#endif
				if ( hard_shadow == 1.0 ) {
					shadow = 1.0;
				} else {
					variance = max( variance, 0.0000001 );
					float d = shadowCoord.z - mean;
					float p_max = variance / ( variance + d * d );
					p_max = clamp( ( p_max - 0.3 ) / 0.65, 0.0, 1.0 );
					shadow = max( hard_shadow, p_max );
				}
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#else
		float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
			float shadow = 1.0;
			shadowCoord.xyz /= shadowCoord.w;
			shadowCoord.z += shadowBias;
			bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
			bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
			if ( frustumTest ) {
				float depth = texture2D( shadowMap, shadowCoord.xy ).r;
				#ifdef USE_REVERSED_DEPTH_BUFFER
					shadow = step( depth, shadowCoord.z );
				#else
					shadow = step( shadowCoord.z, depth );
				#endif
			}
			return mix( 1.0, shadow, shadowIntensity );
		}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#if defined( SHADOWMAP_TYPE_PCF )
	float getPointShadow( samplerCubeShadow shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float texelSize = shadowRadius / shadowMapSize.x;
			vec3 absDir = abs( bd3D );
			vec3 tangent = absDir.x > absDir.z ? vec3( 0.0, 1.0, 0.0 ) : vec3( 1.0, 0.0, 0.0 );
			tangent = normalize( cross( bd3D, tangent ) );
			vec3 bitangent = cross( bd3D, tangent );
			float phi = interleavedGradientNoise( gl_FragCoord.xy ) * 6.28318530718;
			shadow = (
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 0, 5, phi ).x + bitangent * vogelDiskSample( 0, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 1, 5, phi ).x + bitangent * vogelDiskSample( 1, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 2, 5, phi ).x + bitangent * vogelDiskSample( 2, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 3, 5, phi ).x + bitangent * vogelDiskSample( 3, 5, phi ).y ) * texelSize, dp ) ) +
				texture( shadowMap, vec4( bd3D + ( tangent * vogelDiskSample( 4, 5, phi ).x + bitangent * vogelDiskSample( 4, 5, phi ).y ) * texelSize, dp ) )
			) * 0.2;
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#elif defined( SHADOWMAP_TYPE_BASIC )
	float getPointShadow( samplerCube shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		vec3 bd3D = normalize( lightToPosition );
		vec3 absVec = abs( lightToPosition );
		float viewSpaceZ = max( max( absVec.x, absVec.y ), absVec.z );
		if ( viewSpaceZ - shadowCameraFar <= 0.0 && viewSpaceZ - shadowCameraNear >= 0.0 ) {
			float dp = ( shadowCameraFar * ( viewSpaceZ - shadowCameraNear ) ) / ( viewSpaceZ * ( shadowCameraFar - shadowCameraNear ) );
			dp += shadowBias;
			float depth = textureCube( shadowMap, bd3D ).r;
			#ifdef USE_REVERSED_DEPTH_BUFFER
				shadow = step( depth, dp );
			#else
				shadow = step( dp, depth );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	#endif
	#endif
#endif`,wL=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,RL=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,NL=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0 && ( defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_BASIC ) )
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,WL=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,VL=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,ML=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,_L=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,XL=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,YL=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,HL=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,EL=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,FL=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseContribution, material.specularColorBlended, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,KL=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,TL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,zL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,LL=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,kL=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const UL=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,DL=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,OL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,jL=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,JL=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,PL=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,QL=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,qL=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	#ifdef USE_REVERSED_DEPTH_BUFFER
		float fragCoordZ = vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ];
	#else
		float fragCoordZ = 0.5 * vHighPrecisionZW[ 0 ] / vHighPrecisionZW[ 1 ] + 0.5;
	#endif
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,$L=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,ek=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = vec4( dist, 0.0, 0.0, 1.0 );
}`,tk=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,nk=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ik=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,ak=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,sk=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,ok=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,rk=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lk=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ck=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,gk=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,uk=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dk=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( normalize( normal ) * 0.5 + 0.5, diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,Ik=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,hk=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,Ck=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,Ak=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
 
		outgoingLight = outgoingLight + sheenSpecularDirect + sheenSpecularIndirect;
 
 	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fk=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,mk=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,pk=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,bk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,yk=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vk=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Gk=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,Bk=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Yn={alphahash_fragment:DT,alphahash_pars_fragment:OT,alphamap_fragment:jT,alphamap_pars_fragment:JT,alphatest_fragment:PT,alphatest_pars_fragment:QT,aomap_fragment:qT,aomap_pars_fragment:$T,batching_pars_vertex:ez,batching_vertex:tz,begin_vertex:nz,beginnormal_vertex:iz,bsdfs:az,iridescence_fragment:sz,bumpmap_pars_fragment:oz,clipping_planes_fragment:rz,clipping_planes_pars_fragment:lz,clipping_planes_pars_vertex:cz,clipping_planes_vertex:gz,color_fragment:uz,color_pars_fragment:dz,color_pars_vertex:Iz,color_vertex:hz,common:Cz,cube_uv_reflection_fragment:Az,defaultnormal_vertex:fz,displacementmap_pars_vertex:mz,displacementmap_vertex:pz,emissivemap_fragment:bz,emissivemap_pars_fragment:yz,colorspace_fragment:vz,colorspace_pars_fragment:Gz,envmap_fragment:Bz,envmap_common_pars_fragment:Sz,envmap_pars_fragment:xz,envmap_pars_vertex:Zz,envmap_physical_pars_fragment:Ez,envmap_vertex:wz,fog_vertex:Rz,fog_pars_vertex:Nz,fog_fragment:Wz,fog_pars_fragment:Vz,gradientmap_pars_fragment:Mz,lightmap_pars_fragment:_z,lights_lambert_fragment:Xz,lights_lambert_pars_fragment:Yz,lights_pars_begin:Hz,lights_toon_fragment:Fz,lights_toon_pars_fragment:Kz,lights_phong_fragment:Tz,lights_phong_pars_fragment:zz,lights_physical_fragment:Lz,lights_physical_pars_fragment:kz,lights_fragment_begin:Uz,lights_fragment_maps:Dz,lights_fragment_end:Oz,logdepthbuf_fragment:jz,logdepthbuf_pars_fragment:Jz,logdepthbuf_pars_vertex:Pz,logdepthbuf_vertex:Qz,map_fragment:qz,map_pars_fragment:$z,map_particle_fragment:eL,map_particle_pars_fragment:tL,metalnessmap_fragment:nL,metalnessmap_pars_fragment:iL,morphinstance_vertex:aL,morphcolor_vertex:sL,morphnormal_vertex:oL,morphtarget_pars_vertex:rL,morphtarget_vertex:lL,normal_fragment_begin:cL,normal_fragment_maps:gL,normal_pars_fragment:uL,normal_pars_vertex:dL,normal_vertex:IL,normalmap_pars_fragment:hL,clearcoat_normal_fragment_begin:CL,clearcoat_normal_fragment_maps:AL,clearcoat_pars_fragment:fL,iridescence_pars_fragment:mL,opaque_fragment:pL,packing:bL,premultiplied_alpha_fragment:yL,project_vertex:vL,dithering_fragment:GL,dithering_pars_fragment:BL,roughnessmap_fragment:SL,roughnessmap_pars_fragment:xL,shadowmap_pars_fragment:ZL,shadowmap_pars_vertex:wL,shadowmap_vertex:RL,shadowmask_pars_fragment:NL,skinbase_vertex:WL,skinning_pars_vertex:VL,skinning_vertex:ML,skinnormal_vertex:_L,specularmap_fragment:XL,specularmap_pars_fragment:YL,tonemapping_fragment:HL,tonemapping_pars_fragment:EL,transmission_fragment:FL,transmission_pars_fragment:KL,uv_pars_fragment:TL,uv_pars_vertex:zL,uv_vertex:LL,worldpos_vertex:kL,background_vert:UL,background_frag:DL,backgroundCube_vert:OL,backgroundCube_frag:jL,cube_vert:JL,cube_frag:PL,depth_vert:QL,depth_frag:qL,distance_vert:$L,distance_frag:ek,equirect_vert:tk,equirect_frag:nk,linedashed_vert:ik,linedashed_frag:ak,meshbasic_vert:sk,meshbasic_frag:ok,meshlambert_vert:rk,meshlambert_frag:lk,meshmatcap_vert:ck,meshmatcap_frag:gk,meshnormal_vert:uk,meshnormal_frag:dk,meshphong_vert:Ik,meshphong_frag:hk,meshphysical_vert:Ck,meshphysical_frag:Ak,meshtoon_vert:fk,meshtoon_frag:mk,points_vert:pk,points_frag:bk,shadow_vert:yk,shadow_frag:vk,sprite_vert:Gk,sprite_frag:Bk},Pt={common:{diffuse:{value:new tn(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Vn},alphaMap:{value:null},alphaMapTransform:{value:new Vn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Vn}},envmap:{envMap:{value:null},envMapRotation:{value:new Vn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},dfgLUT:{value:null}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Vn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Vn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Vn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Vn},normalScale:{value:new yt(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Vn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Vn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Vn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Vn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new tn(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new tn(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Vn},alphaTest:{value:0},uvTransform:{value:new Vn}},sprite:{diffuse:{value:new tn(16777215)},opacity:{value:1},center:{value:new yt(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Vn},alphaMap:{value:null},alphaMapTransform:{value:new Vn},alphaTest:{value:0}}},Rl={basic:{uniforms:Co([Pt.common,Pt.specularmap,Pt.envmap,Pt.aomap,Pt.lightmap,Pt.fog]),vertexShader:Yn.meshbasic_vert,fragmentShader:Yn.meshbasic_frag},lambert:{uniforms:Co([Pt.common,Pt.specularmap,Pt.envmap,Pt.aomap,Pt.lightmap,Pt.emissivemap,Pt.bumpmap,Pt.normalmap,Pt.displacementmap,Pt.fog,Pt.lights,{emissive:{value:new tn(0)}}]),vertexShader:Yn.meshlambert_vert,fragmentShader:Yn.meshlambert_frag},phong:{uniforms:Co([Pt.common,Pt.specularmap,Pt.envmap,Pt.aomap,Pt.lightmap,Pt.emissivemap,Pt.bumpmap,Pt.normalmap,Pt.displacementmap,Pt.fog,Pt.lights,{emissive:{value:new tn(0)},specular:{value:new tn(1118481)},shininess:{value:30}}]),vertexShader:Yn.meshphong_vert,fragmentShader:Yn.meshphong_frag},standard:{uniforms:Co([Pt.common,Pt.envmap,Pt.aomap,Pt.lightmap,Pt.emissivemap,Pt.bumpmap,Pt.normalmap,Pt.displacementmap,Pt.roughnessmap,Pt.metalnessmap,Pt.fog,Pt.lights,{emissive:{value:new tn(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Yn.meshphysical_vert,fragmentShader:Yn.meshphysical_frag},toon:{uniforms:Co([Pt.common,Pt.aomap,Pt.lightmap,Pt.emissivemap,Pt.bumpmap,Pt.normalmap,Pt.displacementmap,Pt.gradientmap,Pt.fog,Pt.lights,{emissive:{value:new tn(0)}}]),vertexShader:Yn.meshtoon_vert,fragmentShader:Yn.meshtoon_frag},matcap:{uniforms:Co([Pt.common,Pt.bumpmap,Pt.normalmap,Pt.displacementmap,Pt.fog,{matcap:{value:null}}]),vertexShader:Yn.meshmatcap_vert,fragmentShader:Yn.meshmatcap_frag},points:{uniforms:Co([Pt.points,Pt.fog]),vertexShader:Yn.points_vert,fragmentShader:Yn.points_frag},dashed:{uniforms:Co([Pt.common,Pt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Yn.linedashed_vert,fragmentShader:Yn.linedashed_frag},depth:{uniforms:Co([Pt.common,Pt.displacementmap]),vertexShader:Yn.depth_vert,fragmentShader:Yn.depth_frag},normal:{uniforms:Co([Pt.common,Pt.bumpmap,Pt.normalmap,Pt.displacementmap,{opacity:{value:1}}]),vertexShader:Yn.meshnormal_vert,fragmentShader:Yn.meshnormal_frag},sprite:{uniforms:Co([Pt.sprite,Pt.fog]),vertexShader:Yn.sprite_vert,fragmentShader:Yn.sprite_frag},background:{uniforms:{uvTransform:{value:new Vn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Yn.background_vert,fragmentShader:Yn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Vn}},vertexShader:Yn.backgroundCube_vert,fragmentShader:Yn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Yn.cube_vert,fragmentShader:Yn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Yn.equirect_vert,fragmentShader:Yn.equirect_frag},distance:{uniforms:Co([Pt.common,Pt.displacementmap,{referencePosition:{value:new ue},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Yn.distance_vert,fragmentShader:Yn.distance_frag},shadow:{uniforms:Co([Pt.lights,Pt.fog,{color:{value:new tn(0)},opacity:{value:1}}]),vertexShader:Yn.shadow_vert,fragmentShader:Yn.shadow_frag}};Rl.physical={uniforms:Co([Rl.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Vn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Vn},clearcoatNormalScale:{value:new yt(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Vn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Vn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Vn},sheen:{value:0},sheenColor:{value:new tn(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Vn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Vn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Vn},transmissionSamplerSize:{value:new yt},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Vn},attenuationDistance:{value:0},attenuationColor:{value:new tn(0)},specularColor:{value:new tn(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Vn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Vn},anisotropyVector:{value:new yt},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Vn}}]),vertexShader:Yn.meshphysical_vert,fragmentShader:Yn.meshphysical_frag};const Pb={r:0,b:0,g:0},Td=new vo,Sk=new pn;function xk(a,e,t,n,i,s,o){const l=new tn(0);let c=s===!0?0:1,u,h,A=null,f=0,p=null;function y(R){let w=R.isScene===!0?R.background:null;return w&&w.isTexture&&(w=(R.backgroundBlurriness>0?t:e).get(w)),w}function G(R){let w=!1;const V=y(R);V===null?S(l,c):V&&V.isColor&&(S(V,1),w=!0);const H=a.xr.getEnvironmentBlendMode();H==="additive"?n.buffers.color.setClear(0,0,0,1,o):H==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,o),(a.autoClear||w)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),a.clear(a.autoClearColor,a.autoClearDepth,a.autoClearStencil))}function B(R,w){const V=y(w);V&&(V.isCubeTexture||V.mapping===wC)?(h===void 0&&(h=new _i(new bI(1,1,1),new Ds({name:"BackgroundCubeMaterial",uniforms:vC(Rl.backgroundCube.uniforms),vertexShader:Rl.backgroundCube.vertexShader,fragmentShader:Rl.backgroundCube.fragmentShader,side:Ss,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),h.geometry.deleteAttribute("normal"),h.geometry.deleteAttribute("uv"),h.onBeforeRender=function(H,X,Y){this.matrixWorld.copyPosition(Y.matrixWorld)},Object.defineProperty(h.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(h)),Td.copy(w.backgroundRotation),Td.x*=-1,Td.y*=-1,Td.z*=-1,V.isCubeTexture&&V.isRenderTargetTexture===!1&&(Td.y*=-1,Td.z*=-1),h.material.uniforms.envMap.value=V,h.material.uniforms.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,h.material.uniforms.backgroundBlurriness.value=w.backgroundBlurriness,h.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,h.material.uniforms.backgroundRotation.value.setFromMatrix4(Sk.makeRotationFromEuler(Td)),h.material.toneMapped=ei.getTransfer(V.colorSpace)!==bi,(A!==V||f!==V.version||p!==a.toneMapping)&&(h.material.needsUpdate=!0,A=V,f=V.version,p=a.toneMapping),h.layers.enableAll(),R.unshift(h,h.geometry,h.material,0,0,null)):V&&V.isTexture&&(u===void 0&&(u=new _i(new Xl(2,2),new Ds({name:"BackgroundMaterial",uniforms:vC(Rl.background.uniforms),vertexShader:Rl.background.vertexShader,fragmentShader:Rl.background.fragmentShader,side:wc,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),u.geometry.deleteAttribute("normal"),Object.defineProperty(u.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(u)),u.material.uniforms.t2D.value=V,u.material.uniforms.backgroundIntensity.value=w.backgroundIntensity,u.material.toneMapped=ei.getTransfer(V.colorSpace)!==bi,V.matrixAutoUpdate===!0&&V.updateMatrix(),u.material.uniforms.uvTransform.value.copy(V.matrix),(A!==V||f!==V.version||p!==a.toneMapping)&&(u.material.needsUpdate=!0,A=V,f=V.version,p=a.toneMapping),u.layers.enableAll(),R.unshift(u,u.geometry,u.material,0,0,null))}function S(R,w){R.getRGB(Pb,dV(a)),n.buffers.color.setClear(Pb.r,Pb.g,Pb.b,w,o)}function N(){h!==void 0&&(h.geometry.dispose(),h.material.dispose(),h=void 0),u!==void 0&&(u.geometry.dispose(),u.material.dispose(),u=void 0)}return{getClearColor:function(){return l},setClearColor:function(R,w=1){l.set(R),c=w,S(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(R){c=R,S(l,c)},render:G,addToRenderList:B,dispose:N}}function Zk(a,e){const t=a.getParameter(a.MAX_VERTEX_ATTRIBS),n={},i=f(null);let s=i,o=!1;function l(E,O,P,q,k){let le=!1;const F=A(q,P,O);s!==F&&(s=F,u(s.object)),le=p(E,q,P,k),le&&y(E,q,P,k),k!==null&&e.update(k,a.ELEMENT_ARRAY_BUFFER),(le||o)&&(o=!1,w(E,O,P,q),k!==null&&a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,e.get(k).buffer))}function c(){return a.createVertexArray()}function u(E){return a.bindVertexArray(E)}function h(E){return a.deleteVertexArray(E)}function A(E,O,P){const q=P.wireframe===!0;let k=n[E.id];k===void 0&&(k={},n[E.id]=k);let le=k[O.id];le===void 0&&(le={},k[O.id]=le);let F=le[q];return F===void 0&&(F=f(c()),le[q]=F),F}function f(E){const O=[],P=[],q=[];for(let k=0;k<t;k++)O[k]=0,P[k]=0,q[k]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:O,enabledAttributes:P,attributeDivisors:q,object:E,attributes:{},index:null}}function p(E,O,P,q){const k=s.attributes,le=O.attributes;let F=0;const j=P.getAttributes();for(const Q in j)if(j[Q].location>=0){const oe=k[Q];let T=le[Q];if(T===void 0&&(Q==="instanceMatrix"&&E.instanceMatrix&&(T=E.instanceMatrix),Q==="instanceColor"&&E.instanceColor&&(T=E.instanceColor)),oe===void 0||oe.attribute!==T||T&&oe.data!==T.data)return!0;F++}return s.attributesNum!==F||s.index!==q}function y(E,O,P,q){const k={},le=O.attributes;let F=0;const j=P.getAttributes();for(const Q in j)if(j[Q].location>=0){let oe=le[Q];oe===void 0&&(Q==="instanceMatrix"&&E.instanceMatrix&&(oe=E.instanceMatrix),Q==="instanceColor"&&E.instanceColor&&(oe=E.instanceColor));const T={};T.attribute=oe,oe&&oe.data&&(T.data=oe.data),k[Q]=T,F++}s.attributes=k,s.attributesNum=F,s.index=q}function G(){const E=s.newAttributes;for(let O=0,P=E.length;O<P;O++)E[O]=0}function B(E){S(E,0)}function S(E,O){const P=s.newAttributes,q=s.enabledAttributes,k=s.attributeDivisors;P[E]=1,q[E]===0&&(a.enableVertexAttribArray(E),q[E]=1),k[E]!==O&&(a.vertexAttribDivisor(E,O),k[E]=O)}function N(){const E=s.newAttributes,O=s.enabledAttributes;for(let P=0,q=O.length;P<q;P++)O[P]!==E[P]&&(a.disableVertexAttribArray(P),O[P]=0)}function R(E,O,P,q,k,le,F){F===!0?a.vertexAttribIPointer(E,O,P,k,le):a.vertexAttribPointer(E,O,P,q,k,le)}function w(E,O,P,q){G();const k=q.attributes,le=P.getAttributes(),F=O.defaultAttributeValues;for(const j in le){const Q=le[j];if(Q.location>=0){let ce=k[j];if(ce===void 0&&(j==="instanceMatrix"&&E.instanceMatrix&&(ce=E.instanceMatrix),j==="instanceColor"&&E.instanceColor&&(ce=E.instanceColor)),ce!==void 0){const oe=ce.normalized,T=ce.itemSize,$=e.get(ce);if($===void 0)continue;const ae=$.buffer,Ie=$.type,be=$.bytesPerElement,D=Ie===a.INT||Ie===a.UNSIGNED_INT||ce.gpuType===Nm;if(ce.isInterleavedBufferAttribute){const de=ce.data,ee=de.stride,Ce=ce.offset;if(de.isInstancedInterleavedBuffer){for(let we=0;we<Q.locationSize;we++)S(Q.location+we,de.meshPerAttribute);E.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let we=0;we<Q.locationSize;we++)B(Q.location+we);a.bindBuffer(a.ARRAY_BUFFER,ae);for(let we=0;we<Q.locationSize;we++)R(Q.location+we,T/Q.locationSize,Ie,oe,ee*be,(Ce+T/Q.locationSize*we)*be,D)}else{if(ce.isInstancedBufferAttribute){for(let de=0;de<Q.locationSize;de++)S(Q.location+de,ce.meshPerAttribute);E.isInstancedMesh!==!0&&q._maxInstanceCount===void 0&&(q._maxInstanceCount=ce.meshPerAttribute*ce.count)}else for(let de=0;de<Q.locationSize;de++)B(Q.location+de);a.bindBuffer(a.ARRAY_BUFFER,ae);for(let de=0;de<Q.locationSize;de++)R(Q.location+de,T/Q.locationSize,Ie,oe,T*be,T/Q.locationSize*de*be,D)}}else if(F!==void 0){const oe=F[j];if(oe!==void 0)switch(oe.length){case 2:a.vertexAttrib2fv(Q.location,oe);break;case 3:a.vertexAttrib3fv(Q.location,oe);break;case 4:a.vertexAttrib4fv(Q.location,oe);break;default:a.vertexAttrib1fv(Q.location,oe)}}}}N()}function V(){Y();for(const E in n){const O=n[E];for(const P in O){const q=O[P];for(const k in q)h(q[k].object),delete q[k];delete O[P]}delete n[E]}}function H(E){if(n[E.id]===void 0)return;const O=n[E.id];for(const P in O){const q=O[P];for(const k in q)h(q[k].object),delete q[k];delete O[P]}delete n[E.id]}function X(E){for(const O in n){const P=n[O];if(P[E.id]===void 0)continue;const q=P[E.id];for(const k in q)h(q[k].object),delete q[k];delete P[E.id]}}function Y(){M(),o=!0,s!==i&&(s=i,u(s.object))}function M(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:l,reset:Y,resetDefaultState:M,dispose:V,releaseStatesOfGeometry:H,releaseStatesOfProgram:X,initAttributes:G,enableAttribute:B,disableUnusedAttributes:N}}function wk(a,e,t){let n;function i(u){n=u}function s(u,h){a.drawArrays(n,u,h),t.update(h,n,1)}function o(u,h,A){A!==0&&(a.drawArraysInstanced(n,u,h,A),t.update(h,n,A))}function l(u,h,A){if(A===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,u,0,h,0,A);let p=0;for(let y=0;y<A;y++)p+=h[y];t.update(p,n,1)}function c(u,h,A,f){if(A===0)return;const p=e.get("WEBGL_multi_draw");if(p===null)for(let y=0;y<u.length;y++)o(u[y],h[y],f[y]);else{p.multiDrawArraysInstancedWEBGL(n,u,0,h,0,f,0,A);let y=0;for(let G=0;G<A;G++)y+=h[G]*f[G];t.update(y,n,1)}}this.setMode=i,this.render=s,this.renderInstances=o,this.renderMultiDraw=l,this.renderMultiDrawInstances=c}function Rk(a,e,t,n){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const X=e.get("EXT_texture_filter_anisotropic");i=a.getParameter(X.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function o(X){return!(X!==Sa&&n.convert(X)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(X){const Y=X===Aa&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(X!==os&&n.convert(X)!==a.getParameter(a.IMPLEMENTATION_COLOR_READ_TYPE)&&X!==$i&&!Y)}function c(X){if(X==="highp"){if(a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.HIGH_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.HIGH_FLOAT).precision>0)return"highp";X="mediump"}return X==="mediump"&&a.getShaderPrecisionFormat(a.VERTEX_SHADER,a.MEDIUM_FLOAT).precision>0&&a.getShaderPrecisionFormat(a.FRAGMENT_SHADER,a.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const h=c(u);h!==u&&(Qt("WebGLRenderer:",u,"not supported, using",h,"instead."),u=h);const A=t.logarithmicDepthBuffer===!0,f=t.reversedDepthBuffer===!0&&e.has("EXT_clip_control"),p=a.getParameter(a.MAX_TEXTURE_IMAGE_UNITS),y=a.getParameter(a.MAX_VERTEX_TEXTURE_IMAGE_UNITS),G=a.getParameter(a.MAX_TEXTURE_SIZE),B=a.getParameter(a.MAX_CUBE_MAP_TEXTURE_SIZE),S=a.getParameter(a.MAX_VERTEX_ATTRIBS),N=a.getParameter(a.MAX_VERTEX_UNIFORM_VECTORS),R=a.getParameter(a.MAX_VARYING_VECTORS),w=a.getParameter(a.MAX_FRAGMENT_UNIFORM_VECTORS),V=a.getParameter(a.MAX_SAMPLES),H=a.getParameter(a.SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:o,textureTypeReadable:l,precision:u,logarithmicDepthBuffer:A,reversedDepthBuffer:f,maxTextures:p,maxVertexTextures:y,maxTextureSize:G,maxCubemapSize:B,maxAttributes:S,maxVertexUniforms:N,maxVaryings:R,maxFragmentUniforms:w,maxSamples:V,samples:H}}function Nk(a){const e=this;let t=null,n=0,i=!1,s=!1;const o=new yg,l=new Vn,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(A,f){const p=A.length!==0||f||n!==0||i;return i=f,n=A.length,p},this.beginShadows=function(){s=!0,h(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(A,f){t=h(A,f,0)},this.setState=function(A,f,p){const y=A.clippingPlanes,G=A.clipIntersection,B=A.clipShadows,S=a.get(A);if(!i||y===null||y.length===0||s&&!B)s?h(null):u();else{const N=s?0:n,R=N*4;let w=S.clippingState||null;c.value=w,w=h(y,f,R,p);for(let V=0;V!==R;++V)w[V]=t[V];S.clippingState=w,this.numIntersection=G?this.numPlanes:0,this.numPlanes+=N}};function u(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function h(A,f,p,y){const G=A!==null?A.length:0;let B=null;if(G!==0){if(B=c.value,y!==!0||B===null){const S=p+G*4,N=f.matrixWorldInverse;l.getNormalMatrix(N),(B===null||B.length<S)&&(B=new Float32Array(S));for(let R=0,w=p;R!==G;++R,w+=4)o.copy(A[R]).applyMatrix4(N,l),o.normal.toArray(B,w),B[w+3]=o.constant}c.value=B,c.needsUpdate=!0}return e.numPlanes=G,e.numIntersection=0,B}}function Wk(a){let e=new WeakMap;function t(o,l){return l===CC?o.mapping=Vl:l===am&&(o.mapping=Xu),o}function n(o){if(o&&o.isTexture){const l=o.mapping;if(l===CC||l===am)if(e.has(o)){const c=e.get(o).texture;return t(c,o.mapping)}else{const c=o.image;if(c&&c.height>0){const u=new jy(c.height);return u.fromEquirectangularTexture(a,o),e.set(o,u),o.addEventListener("dispose",i),t(u.texture,o.mapping)}else return null}}return o}function i(o){const l=o.target;l.removeEventListener("dispose",i);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const Vu=4,MR=[.125,.215,.35,.446,.526,.582],Qd=20,Vk=256,Af=new xc,_R=new tn;let hB=null,CB=0,AB=0,fB=!1;const Mk=new ue;class _2{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._backgroundBox=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._blurMaterial=null,this._ggxMaterial=null}fromScene(e,t=0,n=.1,i=100,s={}){const{size:o=256,position:l=Mk}=s;hB=this._renderer.getRenderTarget(),CB=this._renderer.getActiveCubeFace(),AB=this._renderer.getActiveMipmapLevel(),fB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(o);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,i,c,l),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=HR(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=YR(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._ggxMaterial!==null&&this._ggxMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodMeshes.length;e++)this._lodMeshes[e].geometry.dispose()}_cleanup(e){this._renderer.setRenderTarget(hB,CB,AB),this._renderer.xr.enabled=fB,e.scissorTest=!1,jh(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Vl||e.mapping===Xu?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),hB=this._renderer.getRenderTarget(),CB=this._renderer.getActiveCubeFace(),AB=this._renderer.getActiveMipmapLevel(),fB=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Pn,minFilter:Pn,generateMipmaps:!1,type:Aa,format:Sa,colorSpace:Ml,depthBuffer:!1},i=XR(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=XR(e,t,n);const{_lodMax:s}=this;({lodMeshes:this._lodMeshes,sizeLods:this._sizeLods,sigmas:this._sigmas}=_k(s)),this._blurMaterial=Yk(s,e,t),this._ggxMaterial=Xk(s,e,t)}return i}_compileMaterial(e){const t=new _i(new Mn,e);this._renderer.compile(t,Af)}_sceneToCubeUV(e,t,n,i,s){const c=new Ga(90,1,t,n),u=[1,-1,1,1,1,1],h=[1,1,1,-1,-1,-1],A=this._renderer,f=A.autoClear,p=A.toneMapping;A.getClearColor(_R),A.toneMapping=zr,A.autoClear=!1,A.state.buffers.depth.getReversed()&&(A.setRenderTarget(i),A.clearDepth(),A.setRenderTarget(null)),this._backgroundBox===null&&(this._backgroundBox=new _i(new bI,new Wc({name:"PMREM.Background",side:Ss,depthWrite:!1,depthTest:!1})));const G=this._backgroundBox,B=G.material;let S=!1;const N=e.background;N?N.isColor&&(B.color.copy(N),e.background=null,S=!0):(B.color.copy(_R),S=!0);for(let R=0;R<6;R++){const w=R%3;w===0?(c.up.set(0,u[R],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+h[R],s.y,s.z)):w===1?(c.up.set(0,0,u[R]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+h[R],s.z)):(c.up.set(0,u[R],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+h[R]));const V=this._cubeSize;jh(i,w*V,R>2?V:0,V,V),A.setRenderTarget(i),S&&A.render(G,c),A.render(e,c)}A.toneMapping=p,A.autoClear=f,e.background=N}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===Vl||e.mapping===Xu;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=HR()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=YR());const s=i?this._cubemapMaterial:this._equirectMaterial,o=this._lodMeshes[0];o.material=s;const l=s.uniforms;l.envMap.value=e;const c=this._cubeSize;jh(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(o,Af)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodMeshes.length;for(let s=1;s<i;s++)this._applyGGXFilter(e,s-1,s);t.autoClear=n}_applyGGXFilter(e,t,n){const i=this._renderer,s=this._pingPongRenderTarget,o=this._ggxMaterial,l=this._lodMeshes[n];l.material=o;const c=o.uniforms,u=n/(this._lodMeshes.length-1),h=t/(this._lodMeshes.length-1),A=Math.sqrt(u*u-h*h),f=0+u*1.25,p=A*f,{_lodMax:y}=this,G=this._sizeLods[n],B=3*G*(n>y-Vu?n-y+Vu:0),S=4*(this._cubeSize-G);c.envMap.value=e.texture,c.roughness.value=p,c.mipInt.value=y-t,jh(s,B,S,3*G,2*G),i.setRenderTarget(s),i.render(l,Af),c.envMap.value=s.texture,c.roughness.value=0,c.mipInt.value=y-n,jh(e,B,S,3*G,2*G),i.setRenderTarget(e),i.render(l,Af)}_blur(e,t,n,i,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,n,i,"latitudinal",s),this._halfBlur(o,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,o,l){const c=this._renderer,u=this._blurMaterial;o!=="latitudinal"&&o!=="longitudinal"&&Cn("blur direction must be either latitudinal or longitudinal!");const h=3,A=this._lodMeshes[i];A.material=u;const f=u.uniforms,p=this._sizeLods[n]-1,y=isFinite(s)?Math.PI/(2*p):2*Math.PI/(2*Qd-1),G=s/y,B=isFinite(s)?1+Math.floor(h*G):Qd;B>Qd&&Qt(`sigmaRadians, ${s}, is too large and will clip, as it requested ${B} samples when the maximum is set to ${Qd}`);const S=[];let N=0;for(let X=0;X<Qd;++X){const Y=X/G,M=Math.exp(-Y*Y/2);S.push(M),X===0?N+=M:X<B&&(N+=2*M)}for(let X=0;X<S.length;X++)S[X]=S[X]/N;f.envMap.value=e.texture,f.samples.value=B,f.weights.value=S,f.latitudinal.value=o==="latitudinal",l&&(f.poleAxis.value=l);const{_lodMax:R}=this;f.dTheta.value=y,f.mipInt.value=R-n;const w=this._sizeLods[i],V=3*w*(i>R-Vu?i-R+Vu:0),H=4*(this._cubeSize-w);jh(t,V,H,3*w,2*w),c.setRenderTarget(t),c.render(A,Af)}}function _k(a){const e=[],t=[],n=[];let i=a;const s=a-Vu+1+MR.length;for(let o=0;o<s;o++){const l=Math.pow(2,i);e.push(l);let c=1/l;o>a-Vu?c=MR[o-a+Vu-1]:o===0&&(c=0),t.push(c);const u=1/(l-2),h=-u,A=1+u,f=[h,h,A,h,A,A,h,h,A,A,h,A],p=6,y=6,G=3,B=2,S=1,N=new Float32Array(G*y*p),R=new Float32Array(B*y*p),w=new Float32Array(S*y*p);for(let H=0;H<p;H++){const X=H%3*2/3-1,Y=H>2?0:-1,M=[X,Y,0,X+2/3,Y,0,X+2/3,Y+1,0,X,Y,0,X+2/3,Y+1,0,X,Y+1,0];N.set(M,G*y*H),R.set(f,B*y*H);const E=[H,H,H,H,H,H];w.set(E,S*y*H)}const V=new Mn;V.setAttribute("position",new Zi(N,G)),V.setAttribute("uv",new Zi(R,B)),V.setAttribute("faceIndex",new Zi(w,S)),n.push(new _i(V,null)),i>Vu&&i--}return{lodMeshes:n,sizeLods:e,sigmas:t}}function XR(a,e,t){const n=new yo(a,e,t);return n.texture.mapping=wC,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function jh(a,e,t,n,i){a.viewport.set(e,t,n,i),a.scissor.set(e,t,n,i)}function Xk(a,e,t){return new Ds({name:"PMREMGGXConvolution",defines:{GGX_SAMPLES:Vk,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},roughness:{value:0},mipInt:{value:0}},vertexShader:pv(),fragmentShader:`

			precision highp float;
			precision highp int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform float roughness;
			uniform float mipInt;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			#define PI 3.14159265359

			// Van der Corput radical inverse
			float radicalInverse_VdC(uint bits) {
				bits = (bits << 16u) | (bits >> 16u);
				bits = ((bits & 0x55555555u) << 1u) | ((bits & 0xAAAAAAAAu) >> 1u);
				bits = ((bits & 0x33333333u) << 2u) | ((bits & 0xCCCCCCCCu) >> 2u);
				bits = ((bits & 0x0F0F0F0Fu) << 4u) | ((bits & 0xF0F0F0F0u) >> 4u);
				bits = ((bits & 0x00FF00FFu) << 8u) | ((bits & 0xFF00FF00u) >> 8u);
				return float(bits) * 2.3283064365386963e-10; // / 0x100000000
			}

			// Hammersley sequence
			vec2 hammersley(uint i, uint N) {
				return vec2(float(i) / float(N), radicalInverse_VdC(i));
			}

			// GGX VNDF importance sampling (Eric Heitz 2018)
			// "Sampling the GGX Distribution of Visible Normals"
			// https://jcgt.org/published/0007/04/01/
			vec3 importanceSampleGGX_VNDF(vec2 Xi, vec3 V, float roughness) {
				float alpha = roughness * roughness;

				// Section 3.2: Transform view direction to hemisphere configuration
				vec3 Vh = normalize(vec3(alpha * V.x, alpha * V.y, V.z));

				// Section 4.1: Orthonormal basis
				float lensq = Vh.x * Vh.x + Vh.y * Vh.y;
				vec3 T1 = lensq > 0.0 ? vec3(-Vh.y, Vh.x, 0.0) / sqrt(lensq) : vec3(1.0, 0.0, 0.0);
				vec3 T2 = cross(Vh, T1);

				// Section 4.2: Parameterization of projected area
				float r = sqrt(Xi.x);
				float phi = 2.0 * PI * Xi.y;
				float t1 = r * cos(phi);
				float t2 = r * sin(phi);
				float s = 0.5 * (1.0 + Vh.z);
				t2 = (1.0 - s) * sqrt(1.0 - t1 * t1) + s * t2;

				// Section 4.3: Reprojection onto hemisphere
				vec3 Nh = t1 * T1 + t2 * T2 + sqrt(max(0.0, 1.0 - t1 * t1 - t2 * t2)) * Vh;

				// Section 3.4: Transform back to ellipsoid configuration
				return normalize(vec3(alpha * Nh.x, alpha * Nh.y, max(0.0, Nh.z)));
			}

			void main() {
				vec3 N = normalize(vOutputDirection);
				vec3 V = N; // Assume view direction equals normal for pre-filtering

				vec3 prefilteredColor = vec3(0.0);
				float totalWeight = 0.0;

				// For very low roughness, just sample the environment directly
				if (roughness < 0.001) {
					gl_FragColor = vec4(bilinearCubeUV(envMap, N, mipInt), 1.0);
					return;
				}

				// Tangent space basis for VNDF sampling
				vec3 up = abs(N.z) < 0.999 ? vec3(0.0, 0.0, 1.0) : vec3(1.0, 0.0, 0.0);
				vec3 tangent = normalize(cross(up, N));
				vec3 bitangent = cross(N, tangent);

				for(uint i = 0u; i < uint(GGX_SAMPLES); i++) {
					vec2 Xi = hammersley(i, uint(GGX_SAMPLES));

					// For PMREM, V = N, so in tangent space V is always (0, 0, 1)
					vec3 H_tangent = importanceSampleGGX_VNDF(Xi, vec3(0.0, 0.0, 1.0), roughness);

					// Transform H back to world space
					vec3 H = normalize(tangent * H_tangent.x + bitangent * H_tangent.y + N * H_tangent.z);
					vec3 L = normalize(2.0 * dot(V, H) * H - V);

					float NdotL = max(dot(N, L), 0.0);

					if(NdotL > 0.0) {
						// Sample environment at fixed mip level
						// VNDF importance sampling handles the distribution filtering
						vec3 sampleColor = bilinearCubeUV(envMap, L, mipInt);

						// Weight by NdotL for the split-sum approximation
						// VNDF PDF naturally accounts for the visible microfacet distribution
						prefilteredColor += sampleColor * NdotL;
						totalWeight += NdotL;
					}
				}

				if (totalWeight > 0.0) {
					prefilteredColor = prefilteredColor / totalWeight;
				}

				gl_FragColor = vec4(prefilteredColor, 1.0);
			}
		`,blending:Wl,depthTest:!1,depthWrite:!1})}function Yk(a,e,t){const n=new Float32Array(Qd),i=new ue(0,1,0);return new Ds({name:"SphericalGaussianBlur",defines:{n:Qd,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${a}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:pv(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Wl,depthTest:!1,depthWrite:!1})}function YR(){return new Ds({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:pv(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Wl,depthTest:!1,depthWrite:!1})}function HR(){return new Ds({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:pv(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Wl,depthTest:!1,depthWrite:!1})}function pv(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function Hk(a){let e=new WeakMap,t=null;function n(l){if(l&&l.isTexture){const c=l.mapping,u=c===CC||c===am,h=c===Vl||c===Xu;if(u||h){let A=e.get(l);const f=A!==void 0?A.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==f)return t===null&&(t=new _2(a)),A=u?t.fromEquirectangular(l,A):t.fromCubemap(l,A),A.texture.pmremVersion=l.pmremVersion,e.set(l,A),A.texture;if(A!==void 0)return A.texture;{const p=l.image;return u&&p&&p.height>0||h&&p&&i(p)?(t===null&&(t=new _2(a)),A=u?t.fromEquirectangular(l):t.fromCubemap(l),A.texture.pmremVersion=l.pmremVersion,e.set(l,A),l.addEventListener("dispose",s),A.texture):null}}}return l}function i(l){let c=0;const u=6;for(let h=0;h<u;h++)l[h]!==void 0&&c++;return c===u}function s(l){const c=l.target;c.removeEventListener("dispose",s);const u=e.get(c);u!==void 0&&(e.delete(c),u.dispose())}function o(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:o}}function Ek(a){const e={};function t(n){if(e[n]!==void 0)return e[n];const i=a.getExtension(n);return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&pC("WebGLRenderer: "+n+" extension not supported."),i}}}function Fk(a,e,t,n){const i={},s=new WeakMap;function o(A){const f=A.target;f.index!==null&&e.remove(f.index);for(const y in f.attributes)e.remove(f.attributes[y]);f.removeEventListener("dispose",o),delete i[f.id];const p=s.get(f);p&&(e.remove(p),s.delete(f)),n.releaseStatesOfGeometry(f),f.isInstancedBufferGeometry===!0&&delete f._maxInstanceCount,t.memory.geometries--}function l(A,f){return i[f.id]===!0||(f.addEventListener("dispose",o),i[f.id]=!0,t.memory.geometries++),f}function c(A){const f=A.attributes;for(const p in f)e.update(f[p],a.ARRAY_BUFFER)}function u(A){const f=[],p=A.index,y=A.attributes.position;let G=0;if(p!==null){const N=p.array;G=p.version;for(let R=0,w=N.length;R<w;R+=3){const V=N[R+0],H=N[R+1],X=N[R+2];f.push(V,H,H,X,X,V)}}else if(y!==void 0){const N=y.array;G=y.version;for(let R=0,w=N.length/3-1;R<w;R+=3){const V=R+0,H=R+1,X=R+2;f.push(V,H,H,X,X,V)}}else return;const B=new(oV(f)?xS:SS)(f,1);B.version=G;const S=s.get(A);S&&e.remove(S),s.set(A,B)}function h(A){const f=s.get(A);if(f){const p=A.index;p!==null&&f.version<p.version&&u(A)}else u(A);return s.get(A)}return{get:l,update:c,getWireframeAttribute:h}}function Kk(a,e,t){let n;function i(f){n=f}let s,o;function l(f){s=f.type,o=f.bytesPerElement}function c(f,p){a.drawElements(n,p,s,f*o),t.update(p,n,1)}function u(f,p,y){y!==0&&(a.drawElementsInstanced(n,p,s,f*o,y),t.update(p,n,y))}function h(f,p,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,p,0,s,f,0,y);let B=0;for(let S=0;S<y;S++)B+=p[S];t.update(B,n,1)}function A(f,p,y,G){if(y===0)return;const B=e.get("WEBGL_multi_draw");if(B===null)for(let S=0;S<f.length;S++)u(f[S]/o,p[S],G[S]);else{B.multiDrawElementsInstancedWEBGL(n,p,0,s,f,0,G,0,y);let S=0;for(let N=0;N<y;N++)S+=p[N]*G[N];t.update(S,n,1)}}this.setMode=i,this.setIndex=l,this.render=c,this.renderInstances=u,this.renderMultiDraw=h,this.renderMultiDrawInstances=A}function Tk(a){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,o,l){switch(t.calls++,o){case a.TRIANGLES:t.triangles+=l*(s/3);break;case a.LINES:t.lines+=l*(s/2);break;case a.LINE_STRIP:t.lines+=l*(s-1);break;case a.LINE_LOOP:t.lines+=l*s;break;case a.POINTS:t.points+=l*s;break;default:Cn("WebGLInfo: Unknown draw mode:",o);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function zk(a,e,t){const n=new WeakMap,i=new ri;function s(o,l,c){const u=o.morphTargetInfluences,h=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,A=h!==void 0?h.length:0;let f=n.get(l);if(f===void 0||f.count!==A){let E=function(){Y.dispose(),n.delete(l),l.removeEventListener("dispose",E)};var p=E;f!==void 0&&f.texture.dispose();const y=l.morphAttributes.position!==void 0,G=l.morphAttributes.normal!==void 0,B=l.morphAttributes.color!==void 0,S=l.morphAttributes.position||[],N=l.morphAttributes.normal||[],R=l.morphAttributes.color||[];let w=0;y===!0&&(w=1),G===!0&&(w=2),B===!0&&(w=3);let V=l.attributes.position.count*w,H=1;V>e.maxTextureSize&&(H=Math.ceil(V/e.maxTextureSize),V=e.maxTextureSize);const X=new Float32Array(V*H*4*A),Y=new Uy(X,V,H,A);Y.type=$i,Y.needsUpdate=!0;const M=w*4;for(let O=0;O<A;O++){const P=S[O],q=N[O],k=R[O],le=V*H*4*O;for(let F=0;F<P.count;F++){const j=F*M;y===!0&&(i.fromBufferAttribute(P,F),X[le+j+0]=i.x,X[le+j+1]=i.y,X[le+j+2]=i.z,X[le+j+3]=0),G===!0&&(i.fromBufferAttribute(q,F),X[le+j+4]=i.x,X[le+j+5]=i.y,X[le+j+6]=i.z,X[le+j+7]=0),B===!0&&(i.fromBufferAttribute(k,F),X[le+j+8]=i.x,X[le+j+9]=i.y,X[le+j+10]=i.z,X[le+j+11]=k.itemSize===4?i.w:1)}}f={count:A,texture:Y,size:new yt(V,H)},n.set(l,f),l.addEventListener("dispose",E)}if(o.isInstancedMesh===!0&&o.morphTexture!==null)c.getUniforms().setValue(a,"morphTexture",o.morphTexture,t);else{let y=0;for(let B=0;B<u.length;B++)y+=u[B];const G=l.morphTargetsRelative?1:1-y;c.getUniforms().setValue(a,"morphTargetBaseInfluence",G),c.getUniforms().setValue(a,"morphTargetInfluences",u)}c.getUniforms().setValue(a,"morphTargetsTexture",f.texture,t),c.getUniforms().setValue(a,"morphTargetsTextureSize",f.size)}return{update:s}}function Lk(a,e,t,n){let i=new WeakMap;function s(c){const u=n.render.frame,h=c.geometry,A=e.get(c,h);if(i.get(A)!==u&&(e.update(A),i.set(A,u)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),i.get(c)!==u&&(t.update(c.instanceMatrix,a.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,a.ARRAY_BUFFER),i.set(c,u))),c.isSkinnedMesh){const f=c.skeleton;i.get(f)!==u&&(f.update(),i.set(f,u))}return A}function o(){i=new WeakMap}function l(c){const u=c.target;u.removeEventListener("dispose",l),t.remove(u.instanceMatrix),u.instanceColor!==null&&t.remove(u.instanceColor)}return{update:s,dispose:o}}const kk={[uS]:"LINEAR_TONE_MAPPING",[dS]:"REINHARD_TONE_MAPPING",[IS]:"CINEON_TONE_MAPPING",[Xy]:"ACES_FILMIC_TONE_MAPPING",[CS]:"AGX_TONE_MAPPING",[AS]:"NEUTRAL_TONE_MAPPING",[hS]:"CUSTOM_TONE_MAPPING"};function Uk(a,e,t,n,i){const s=new yo(e,t,{type:a,depthBuffer:n,stencilBuffer:i}),o=new yo(e,t,{type:Aa,depthBuffer:!1,stencilBuffer:!1}),l=new Mn;l.setAttribute("position",new an([-1,3,0,-1,-1,0,3,-1,0],3)),l.setAttribute("uv",new an([0,2,0,0,2,0],2));const c=new FS({uniforms:{tDiffuse:{value:null}},vertexShader:`
			precision highp float;

			uniform mat4 modelViewMatrix;
			uniform mat4 projectionMatrix;

			attribute vec3 position;
			attribute vec2 uv;

			varying vec2 vUv;

			void main() {
				vUv = uv;
				gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
			}`,fragmentShader:`
			precision highp float;

			uniform sampler2D tDiffuse;

			varying vec2 vUv;

			#include <tonemapping_pars_fragment>
			#include <colorspace_pars_fragment>

			void main() {
				gl_FragColor = texture2D( tDiffuse, vUv );

				#ifdef LINEAR_TONE_MAPPING
					gl_FragColor.rgb = LinearToneMapping( gl_FragColor.rgb );
				#elif defined( REINHARD_TONE_MAPPING )
					gl_FragColor.rgb = ReinhardToneMapping( gl_FragColor.rgb );
				#elif defined( CINEON_TONE_MAPPING )
					gl_FragColor.rgb = CineonToneMapping( gl_FragColor.rgb );
				#elif defined( ACES_FILMIC_TONE_MAPPING )
					gl_FragColor.rgb = ACESFilmicToneMapping( gl_FragColor.rgb );
				#elif defined( AGX_TONE_MAPPING )
					gl_FragColor.rgb = AgXToneMapping( gl_FragColor.rgb );
				#elif defined( NEUTRAL_TONE_MAPPING )
					gl_FragColor.rgb = NeutralToneMapping( gl_FragColor.rgb );
				#elif defined( CUSTOM_TONE_MAPPING )
					gl_FragColor.rgb = CustomToneMapping( gl_FragColor.rgb );
				#endif

				#ifdef SRGB_TRANSFER
					gl_FragColor = sRGBTransferOETF( gl_FragColor );
				#endif
			}`,depthTest:!1,depthWrite:!1}),u=new _i(l,c),h=new xc(-1,1,1,-1,0,1);let A=null,f=null,p=!1,y,G=null,B=[],S=!1;this.setSize=function(N,R){s.setSize(N,R),o.setSize(N,R);for(let w=0;w<B.length;w++){const V=B[w];V.setSize&&V.setSize(N,R)}},this.setEffects=function(N){B=N,S=B.length>0&&B[0].isRenderPass===!0;const R=s.width,w=s.height;for(let V=0;V<B.length;V++){const H=B[V];H.setSize&&H.setSize(R,w)}},this.begin=function(N,R){if(p||N.toneMapping===zr&&B.length===0)return!1;if(G=R,R!==null){const w=R.width,V=R.height;(s.width!==w||s.height!==V)&&this.setSize(w,V)}return S===!1&&N.setRenderTarget(s),y=N.toneMapping,N.toneMapping=zr,!0},this.hasRenderPass=function(){return S},this.end=function(N,R){N.toneMapping=y,p=!0;let w=s,V=o;for(let H=0;H<B.length;H++){const X=B[H];if(X.enabled!==!1&&(X.render(N,V,w,R),X.needsSwap!==!1)){const Y=w;w=V,V=Y}}if(A!==N.outputColorSpace||f!==N.toneMapping){A=N.outputColorSpace,f=N.toneMapping,c.defines={},ei.getTransfer(A)===bi&&(c.defines.SRGB_TRANSFER="");const H=kk[f];H&&(c.defines[H]=""),c.needsUpdate=!0}c.uniforms.tDiffuse.value=w.texture,N.setRenderTarget(G),N.render(u,h),G=null,p=!1},this.isCompositing=function(){return p},this.dispose=function(){s.dispose(),o.dispose(),l.dispose(),c.dispose()}}const r3=new fi,X2=new GC(1,1),l3=new Uy,c3=new Dy,g3=new Mm,ER=[],FR=[],KR=new Float32Array(16),TR=new Float32Array(9),zR=new Float32Array(4);function NC(a,e,t){const n=a[0];if(n<=0||n>0)return a;const i=e*t;let s=ER[i];if(s===void 0&&(s=new Float32Array(i),ER[i]=s),e!==0){n.toArray(s,0);for(let o=1,l=0;o!==e;++o)l+=t,a[o].toArray(s,l)}return s}function ja(a,e){if(a.length!==e.length)return!1;for(let t=0,n=a.length;t<n;t++)if(a[t]!==e[t])return!1;return!0}function Ja(a,e){for(let t=0,n=e.length;t<n;t++)a[t]=e[t]}function bv(a,e){let t=FR[e];t===void 0&&(t=new Int32Array(e),FR[e]=t);for(let n=0;n!==e;++n)t[n]=a.allocateTextureUnit();return t}function Dk(a,e){const t=this.cache;t[0]!==e&&(a.uniform1f(this.addr,e),t[0]=e)}function Ok(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ja(t,e))return;a.uniform2fv(this.addr,e),Ja(t,e)}}function jk(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(a.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(ja(t,e))return;a.uniform3fv(this.addr,e),Ja(t,e)}}function Jk(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ja(t,e))return;a.uniform4fv(this.addr,e),Ja(t,e)}}function Pk(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(ja(t,e))return;a.uniformMatrix2fv(this.addr,!1,e),Ja(t,e)}else{if(ja(t,n))return;zR.set(n),a.uniformMatrix2fv(this.addr,!1,zR),Ja(t,n)}}function Qk(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(ja(t,e))return;a.uniformMatrix3fv(this.addr,!1,e),Ja(t,e)}else{if(ja(t,n))return;TR.set(n),a.uniformMatrix3fv(this.addr,!1,TR),Ja(t,n)}}function qk(a,e){const t=this.cache,n=e.elements;if(n===void 0){if(ja(t,e))return;a.uniformMatrix4fv(this.addr,!1,e),Ja(t,e)}else{if(ja(t,n))return;KR.set(n),a.uniformMatrix4fv(this.addr,!1,KR),Ja(t,n)}}function $k(a,e){const t=this.cache;t[0]!==e&&(a.uniform1i(this.addr,e),t[0]=e)}function eU(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ja(t,e))return;a.uniform2iv(this.addr,e),Ja(t,e)}}function tU(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ja(t,e))return;a.uniform3iv(this.addr,e),Ja(t,e)}}function nU(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ja(t,e))return;a.uniform4iv(this.addr,e),Ja(t,e)}}function iU(a,e){const t=this.cache;t[0]!==e&&(a.uniform1ui(this.addr,e),t[0]=e)}function aU(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(a.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(ja(t,e))return;a.uniform2uiv(this.addr,e),Ja(t,e)}}function sU(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(a.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(ja(t,e))return;a.uniform3uiv(this.addr,e),Ja(t,e)}}function oU(a,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(a.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(ja(t,e))return;a.uniform4uiv(this.addr,e),Ja(t,e)}}function rU(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i);let s;this.type===a.SAMPLER_2D_SHADOW?(X2.compareFunction=t.isReversedDepthBuffer()?ky:Ly,s=X2):s=r3,t.setTexture2D(e||s,i)}function lU(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||c3,i)}function cU(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||g3,i)}function gU(a,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(a.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||l3,i)}function uU(a){switch(a){case 5126:return Dk;case 35664:return Ok;case 35665:return jk;case 35666:return Jk;case 35674:return Pk;case 35675:return Qk;case 35676:return qk;case 5124:case 35670:return $k;case 35667:case 35671:return eU;case 35668:case 35672:return tU;case 35669:case 35673:return nU;case 5125:return iU;case 36294:return aU;case 36295:return sU;case 36296:return oU;case 35678:case 36198:case 36298:case 36306:case 35682:return rU;case 35679:case 36299:case 36307:return lU;case 35680:case 36300:case 36308:case 36293:return cU;case 36289:case 36303:case 36311:case 36292:return gU}}function dU(a,e){a.uniform1fv(this.addr,e)}function IU(a,e){const t=NC(e,this.size,2);a.uniform2fv(this.addr,t)}function hU(a,e){const t=NC(e,this.size,3);a.uniform3fv(this.addr,t)}function CU(a,e){const t=NC(e,this.size,4);a.uniform4fv(this.addr,t)}function AU(a,e){const t=NC(e,this.size,4);a.uniformMatrix2fv(this.addr,!1,t)}function fU(a,e){const t=NC(e,this.size,9);a.uniformMatrix3fv(this.addr,!1,t)}function mU(a,e){const t=NC(e,this.size,16);a.uniformMatrix4fv(this.addr,!1,t)}function pU(a,e){a.uniform1iv(this.addr,e)}function bU(a,e){a.uniform2iv(this.addr,e)}function yU(a,e){a.uniform3iv(this.addr,e)}function vU(a,e){a.uniform4iv(this.addr,e)}function GU(a,e){a.uniform1uiv(this.addr,e)}function BU(a,e){a.uniform2uiv(this.addr,e)}function SU(a,e){a.uniform3uiv(this.addr,e)}function xU(a,e){a.uniform4uiv(this.addr,e)}function ZU(a,e,t){const n=this.cache,i=e.length,s=bv(t,i);ja(n,s)||(a.uniform1iv(this.addr,s),Ja(n,s));let o;this.type===a.SAMPLER_2D_SHADOW?o=X2:o=r3;for(let l=0;l!==i;++l)t.setTexture2D(e[l]||o,s[l])}function wU(a,e,t){const n=this.cache,i=e.length,s=bv(t,i);ja(n,s)||(a.uniform1iv(this.addr,s),Ja(n,s));for(let o=0;o!==i;++o)t.setTexture3D(e[o]||c3,s[o])}function RU(a,e,t){const n=this.cache,i=e.length,s=bv(t,i);ja(n,s)||(a.uniform1iv(this.addr,s),Ja(n,s));for(let o=0;o!==i;++o)t.setTextureCube(e[o]||g3,s[o])}function NU(a,e,t){const n=this.cache,i=e.length,s=bv(t,i);ja(n,s)||(a.uniform1iv(this.addr,s),Ja(n,s));for(let o=0;o!==i;++o)t.setTexture2DArray(e[o]||l3,s[o])}function WU(a){switch(a){case 5126:return dU;case 35664:return IU;case 35665:return hU;case 35666:return CU;case 35674:return AU;case 35675:return fU;case 35676:return mU;case 5124:case 35670:return pU;case 35667:case 35671:return bU;case 35668:case 35672:return yU;case 35669:case 35673:return vU;case 5125:return GU;case 36294:return BU;case 36295:return SU;case 36296:return xU;case 35678:case 36198:case 36298:case 36306:case 35682:return ZU;case 35679:case 36299:case 36307:return wU;case 35680:case 36300:case 36308:case 36293:return RU;case 36289:case 36303:case 36311:case 36292:return NU}}class VU{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=uU(t.type)}}class MU{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=WU(t.type)}}class _U{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,o=i.length;s!==o;++s){const l=i[s];l.setValue(e,t[l.id],n)}}}const mB=/(\w+)(\])?(\[|\.)?/g;function LR(a,e){a.seq.push(e),a.map[e.id]=e}function XU(a,e,t){const n=a.name,i=n.length;for(mB.lastIndex=0;;){const s=mB.exec(n),o=mB.lastIndex;let l=s[1];const c=s[2]==="]",u=s[3];if(c&&(l=l|0),u===void 0||u==="["&&o+2===i){LR(t,u===void 0?new VU(l,a,e):new MU(l,a,e));break}else{let A=t.map[l];A===void 0&&(A=new _U(l),LR(t,A)),t=A}}}class p0{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<n;++o){const l=e.getActiveUniform(t,o),c=e.getUniformLocation(t,l.name);XU(l,c,this)}const i=[],s=[];for(const o of this.seq)o.type===e.SAMPLER_2D_SHADOW||o.type===e.SAMPLER_CUBE_SHADOW||o.type===e.SAMPLER_2D_ARRAY_SHADOW?i.push(o):s.push(o);i.length>0&&(this.seq=i.concat(s))}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,o=t.length;s!==o;++s){const l=t[s],c=n[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const o=e[i];o.id in t&&n.push(o)}return n}}function kR(a,e,t){const n=a.createShader(e);return a.shaderSource(n,t),a.compileShader(n),n}const YU=37297;let HU=0;function EU(a,e){const t=a.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=i;o<s;o++){const l=o+1;n.push(`${l===e?">":" "} ${l}: ${t[o]}`)}return n.join(`
`)}const UR=new Vn;function FU(a){ei._getMatrix(UR,ei.workingColorSpace,a);const e=`mat3( ${UR.elements.map(t=>t.toFixed(4))} )`;switch(ei.getTransfer(a)){case cm:return[e,"LinearTransferOETF"];case bi:return[e,"sRGBTransferOETF"];default:return Qt("WebGLProgram: Unsupported color space: ",a),[e,"LinearTransferOETF"]}}function DR(a,e,t){const n=a.getShaderParameter(e,a.COMPILE_STATUS),s=(a.getShaderInfoLog(e)||"").trim();if(n&&s==="")return"";const o=/ERROR: 0:(\d+)/.exec(s);if(o){const l=parseInt(o[1]);return t.toUpperCase()+`

`+s+`

`+EU(a.getShaderSource(e),l)}else return s}function KU(a,e){const t=FU(e);return[`vec4 ${a}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}const TU={[uS]:"Linear",[dS]:"Reinhard",[IS]:"Cineon",[Xy]:"ACESFilmic",[CS]:"AgX",[AS]:"Neutral",[hS]:"Custom"};function zU(a,e){const t=TU[e];return t===void 0?(Qt("WebGLProgram: Unsupported toneMapping:",e),"vec3 "+a+"( vec3 color ) { return LinearToneMapping( color ); }"):"vec3 "+a+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const Qb=new ue;function LU(){ei.getLuminanceCoefficients(Qb);const a=Qb.x.toFixed(4),e=Qb.y.toFixed(4),t=Qb.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${a}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function kU(a){return[a.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",a.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(Nf).join(`
`)}function UU(a){const e=[];for(const t in a){const n=a[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function DU(a,e){const t={},n=a.getProgramParameter(e,a.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=a.getActiveAttrib(e,i),o=s.name;let l=1;s.type===a.FLOAT_MAT2&&(l=2),s.type===a.FLOAT_MAT3&&(l=3),s.type===a.FLOAT_MAT4&&(l=4),t[o]={type:s.type,location:a.getAttribLocation(e,o),locationSize:l}}return t}function Nf(a){return a!==""}function OR(a,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return a.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function jR(a,e){return a.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const OU=/^[ \t]*#include +<([\w\d./]+)>/gm;function Y2(a){return a.replace(OU,JU)}const jU=new Map;function JU(a,e){let t=Yn[e];if(t===void 0){const n=jU.get(e);if(n!==void 0)t=Yn[n],Qt('WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return Y2(t)}const PU=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function JR(a){return a.replace(PU,QU)}function QU(a,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function PR(a){let e=`precision ${a.precision} float;
	precision ${a.precision} int;
	precision ${a.precision} sampler2D;
	precision ${a.precision} samplerCube;
	precision ${a.precision} sampler3D;
	precision ${a.precision} sampler2DArray;
	precision ${a.precision} sampler2DShadow;
	precision ${a.precision} samplerCubeShadow;
	precision ${a.precision} sampler2DArrayShadow;
	precision ${a.precision} isampler2D;
	precision ${a.precision} isampler3D;
	precision ${a.precision} isamplerCube;
	precision ${a.precision} isampler2DArray;
	precision ${a.precision} usampler2D;
	precision ${a.precision} usampler3D;
	precision ${a.precision} usamplerCube;
	precision ${a.precision} usampler2DArray;
	`;return a.precision==="highp"?e+=`
#define HIGH_PRECISION`:a.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:a.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}const qU={[gC]:"SHADOWMAP_TYPE_PCF",[nI]:"SHADOWMAP_TYPE_VSM"};function $U(a){return qU[a.shadowMapType]||"SHADOWMAP_TYPE_BASIC"}const eD={[Vl]:"ENVMAP_TYPE_CUBE",[Xu]:"ENVMAP_TYPE_CUBE",[wC]:"ENVMAP_TYPE_CUBE_UV"};function tD(a){return a.envMap===!1?"ENVMAP_TYPE_CUBE":eD[a.envMapMode]||"ENVMAP_TYPE_CUBE"}const nD={[Xu]:"ENVMAP_MODE_REFRACTION"};function iD(a){return a.envMap===!1?"ENVMAP_MODE_REFLECTION":nD[a.envMapMode]||"ENVMAP_MODE_REFLECTION"}const aD={[Rm]:"ENVMAP_BLENDING_MULTIPLY",[kW]:"ENVMAP_BLENDING_MIX",[UW]:"ENVMAP_BLENDING_ADD"};function sD(a){return a.envMap===!1?"ENVMAP_BLENDING_NONE":aD[a.combine]||"ENVMAP_BLENDING_NONE"}function oD(a){const e=a.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:n,maxMip:t}}function rD(a,e,t,n){const i=a.getContext(),s=t.defines;let o=t.vertexShader,l=t.fragmentShader;const c=$U(t),u=tD(t),h=iD(t),A=sD(t),f=oD(t),p=kU(t),y=UU(s),G=i.createProgram();let B,S,N=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(B=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Nf).join(`
`),B.length>0&&(B+=`
`),S=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y].filter(Nf).join(`
`),S.length>0&&(S+=`
`)):(B=[PR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+h:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(Nf).join(`
`),S=[PR(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,y,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.envMap?"#define "+h:"",t.envMap?"#define "+A:"",f?"#define CUBEUV_TEXEL_WIDTH "+f.texelWidth:"",f?"#define CUBEUV_TEXEL_HEIGHT "+f.texelHeight:"",f?"#define CUBEUV_MAX_MIP "+f.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGARITHMIC_DEPTH_BUFFER":"",t.reversedDepthBuffer?"#define USE_REVERSED_DEPTH_BUFFER":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==zr?"#define TONE_MAPPING":"",t.toneMapping!==zr?Yn.tonemapping_pars_fragment:"",t.toneMapping!==zr?zU("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Yn.colorspace_pars_fragment,KU("linearToOutputTexel",t.outputColorSpace),LU(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(Nf).join(`
`)),o=Y2(o),o=OR(o,t),o=jR(o,t),l=Y2(l),l=OR(l,t),l=jR(l,t),o=JR(o),l=JR(l),t.isRawShaderMaterial!==!0&&(N=`#version 300 es
`,B=[p,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+B,S=["#define varying in",t.glslVersion===S2?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===S2?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+S);const R=N+B+o,w=N+S+l,V=kR(i,i.VERTEX_SHADER,R),H=kR(i,i.FRAGMENT_SHADER,w);i.attachShader(G,V),i.attachShader(G,H),t.index0AttributeName!==void 0?i.bindAttribLocation(G,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(G,0,"position"),i.linkProgram(G);function X(O){if(a.debug.checkShaderErrors){const P=i.getProgramInfoLog(G)||"",q=i.getShaderInfoLog(V)||"",k=i.getShaderInfoLog(H)||"",le=P.trim(),F=q.trim(),j=k.trim();let Q=!0,ce=!0;if(i.getProgramParameter(G,i.LINK_STATUS)===!1)if(Q=!1,typeof a.debug.onShaderError=="function")a.debug.onShaderError(i,G,V,H);else{const oe=DR(i,V,"vertex"),T=DR(i,H,"fragment");Cn("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(G,i.VALIDATE_STATUS)+`

Material Name: `+O.name+`
Material Type: `+O.type+`

Program Info Log: `+le+`
`+oe+`
`+T)}else le!==""?Qt("WebGLProgram: Program Info Log:",le):(F===""||j==="")&&(ce=!1);ce&&(O.diagnostics={runnable:Q,programLog:le,vertexShader:{log:F,prefix:B},fragmentShader:{log:j,prefix:S}})}i.deleteShader(V),i.deleteShader(H),Y=new p0(i,G),M=DU(i,G)}let Y;this.getUniforms=function(){return Y===void 0&&X(this),Y};let M;this.getAttributes=function(){return M===void 0&&X(this),M};let E=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return E===!1&&(E=i.getProgramParameter(G,YU)),E},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(G),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=HU++,this.cacheKey=e,this.usedTimes=1,this.program=G,this.vertexShader=V,this.fragmentShader=H,this}let lD=0;class cD{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),o=this._getShaderCacheForMaterial(e);return o.has(i)===!1&&(o.add(i),i.usedTimes++),o.has(s)===!1&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new gD(e),t.set(e,n)),n}}class gD{constructor(e){this.id=lD++,this.code=e,this.usedTimes=0}}function uD(a,e,t,n,i,s,o){const l=new yC,c=new cD,u=new Set,h=[],A=new Map,f=i.logarithmicDepthBuffer;let p=i.precision;const y={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distance",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function G(M){return u.add(M),M===0?"uv":`uv${M}`}function B(M,E,O,P,q){const k=P.fog,le=q.geometry,F=M.isMeshStandardMaterial?P.environment:null,j=(M.isMeshStandardMaterial?t:e).get(M.envMap||F),Q=j&&j.mapping===wC?j.image.height:null,ce=y[M.type];M.precision!==null&&(p=i.getMaxPrecision(M.precision),p!==M.precision&&Qt("WebGLProgram.getParameters:",M.precision,"not supported, using",p,"instead."));const oe=le.morphAttributes.position||le.morphAttributes.normal||le.morphAttributes.color,T=oe!==void 0?oe.length:0;let $=0;le.morphAttributes.position!==void 0&&($=1),le.morphAttributes.normal!==void 0&&($=2),le.morphAttributes.color!==void 0&&($=3);let ae,Ie,be,D;if(ce){const $t=Rl[ce];ae=$t.vertexShader,Ie=$t.fragmentShader}else ae=M.vertexShader,Ie=M.fragmentShader,c.update(M),be=c.getVertexShaderID(M),D=c.getFragmentShaderID(M);const de=a.getRenderTarget(),ee=a.state.buffers.depth.getReversed(),Ce=q.isInstancedMesh===!0,we=q.isBatchedMesh===!0,Ye=!!M.map,Ee=!!M.matcap,pt=!!j,Ke=!!M.aoMap,Qe=!!M.lightMap,Le=!!M.bumpMap,dt=!!M.normalMap,se=!!M.displacementMap,ht=!!M.emissiveMap,it=!!M.metalnessMap,Fe=!!M.roughnessMap,st=M.anisotropy>0,ie=M.clearcoat>0,z=M.dispersion>0,Ae=M.iridescence>0,Oe=M.sheen>0,He=M.transmission>0,Me=st&&!!M.anisotropyMap,It=ie&&!!M.clearcoatMap,ft=ie&&!!M.clearcoatNormalMap,Ht=ie&&!!M.clearcoatRoughnessMap,kt=Ae&&!!M.iridescenceMap,Pe=Ae&&!!M.iridescenceThicknessMap,je=Oe&&!!M.sheenColorMap,ot=Oe&&!!M.sheenRoughnessMap,he=!!M.specularMap,Ve=!!M.specularColorMap,Ct=!!M.specularIntensityMap,ye=He&&!!M.transmissionMap,Re=He&&!!M.thicknessMap,lt=!!M.gradientMap,Kt=!!M.alphaMap,gt=M.alphaTest>0,qe=!!M.alphaHash,vt=!!M.extensions;let Ut=zr;M.toneMapped&&(de===null||de.isXRRenderTarget===!0)&&(Ut=a.toneMapping);const Ot={shaderID:ce,shaderType:M.type,shaderName:M.name,vertexShader:ae,fragmentShader:Ie,defines:M.defines,customVertexShaderID:be,customFragmentShaderID:D,isRawShaderMaterial:M.isRawShaderMaterial===!0,glslVersion:M.glslVersion,precision:p,batching:we,batchingColor:we&&q._colorsTexture!==null,instancing:Ce,instancingColor:Ce&&q.instanceColor!==null,instancingMorph:Ce&&q.morphTexture!==null,outputColorSpace:de===null?a.outputColorSpace:de.isXRRenderTarget===!0?de.texture.colorSpace:Ml,alphaToCoverage:!!M.alphaToCoverage,map:Ye,matcap:Ee,envMap:pt,envMapMode:pt&&j.mapping,envMapCubeUVHeight:Q,aoMap:Ke,lightMap:Qe,bumpMap:Le,normalMap:dt,displacementMap:se,emissiveMap:ht,normalMapObjectSpace:dt&&M.normalMapType===qW,normalMapTangentSpace:dt&&M.normalMapType===Ku,metalnessMap:it,roughnessMap:Fe,anisotropy:st,anisotropyMap:Me,clearcoat:ie,clearcoatMap:It,clearcoatNormalMap:ft,clearcoatRoughnessMap:Ht,dispersion:z,iridescence:Ae,iridescenceMap:kt,iridescenceThicknessMap:Pe,sheen:Oe,sheenColorMap:je,sheenRoughnessMap:ot,specularMap:he,specularColorMap:Ve,specularIntensityMap:Ct,transmission:He,transmissionMap:ye,thicknessMap:Re,gradientMap:lt,opaque:M.transparent===!1&&M.blending===lI&&M.alphaToCoverage===!1,alphaMap:Kt,alphaTest:gt,alphaHash:qe,combine:M.combine,mapUv:Ye&&G(M.map.channel),aoMapUv:Ke&&G(M.aoMap.channel),lightMapUv:Qe&&G(M.lightMap.channel),bumpMapUv:Le&&G(M.bumpMap.channel),normalMapUv:dt&&G(M.normalMap.channel),displacementMapUv:se&&G(M.displacementMap.channel),emissiveMapUv:ht&&G(M.emissiveMap.channel),metalnessMapUv:it&&G(M.metalnessMap.channel),roughnessMapUv:Fe&&G(M.roughnessMap.channel),anisotropyMapUv:Me&&G(M.anisotropyMap.channel),clearcoatMapUv:It&&G(M.clearcoatMap.channel),clearcoatNormalMapUv:ft&&G(M.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:Ht&&G(M.clearcoatRoughnessMap.channel),iridescenceMapUv:kt&&G(M.iridescenceMap.channel),iridescenceThicknessMapUv:Pe&&G(M.iridescenceThicknessMap.channel),sheenColorMapUv:je&&G(M.sheenColorMap.channel),sheenRoughnessMapUv:ot&&G(M.sheenRoughnessMap.channel),specularMapUv:he&&G(M.specularMap.channel),specularColorMapUv:Ve&&G(M.specularColorMap.channel),specularIntensityMapUv:Ct&&G(M.specularIntensityMap.channel),transmissionMapUv:ye&&G(M.transmissionMap.channel),thicknessMapUv:Re&&G(M.thicknessMap.channel),alphaMapUv:Kt&&G(M.alphaMap.channel),vertexTangents:!!le.attributes.tangent&&(dt||st),vertexColors:M.vertexColors,vertexAlphas:M.vertexColors===!0&&!!le.attributes.color&&le.attributes.color.itemSize===4,pointsUvs:q.isPoints===!0&&!!le.attributes.uv&&(Ye||Kt),fog:!!k,useFog:M.fog===!0,fogExp2:!!k&&k.isFogExp2,flatShading:M.flatShading===!0&&M.wireframe===!1,sizeAttenuation:M.sizeAttenuation===!0,logarithmicDepthBuffer:f,reversedDepthBuffer:ee,skinning:q.isSkinnedMesh===!0,morphTargets:le.morphAttributes.position!==void 0,morphNormals:le.morphAttributes.normal!==void 0,morphColors:le.morphAttributes.color!==void 0,morphTargetsCount:T,morphTextureStride:$,numDirLights:E.directional.length,numPointLights:E.point.length,numSpotLights:E.spot.length,numSpotLightMaps:E.spotLightMap.length,numRectAreaLights:E.rectArea.length,numHemiLights:E.hemi.length,numDirLightShadows:E.directionalShadowMap.length,numPointLightShadows:E.pointShadowMap.length,numSpotLightShadows:E.spotShadowMap.length,numSpotLightShadowsWithMaps:E.numSpotLightShadowsWithMaps,numLightProbes:E.numLightProbes,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:M.dithering,shadowMapEnabled:a.shadowMap.enabled&&O.length>0,shadowMapType:a.shadowMap.type,toneMapping:Ut,decodeVideoTexture:Ye&&M.map.isVideoTexture===!0&&ei.getTransfer(M.map.colorSpace)===bi,decodeVideoTextureEmissive:ht&&M.emissiveMap.isVideoTexture===!0&&ei.getTransfer(M.emissiveMap.colorSpace)===bi,premultipliedAlpha:M.premultipliedAlpha,doubleSided:M.side===po,flipSided:M.side===Ss,useDepthPacking:M.depthPacking>=0,depthPacking:M.depthPacking||0,index0AttributeName:M.index0AttributeName,extensionClipCullDistance:vt&&M.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(vt&&M.extensions.multiDraw===!0||we)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:M.customProgramCacheKey()};return Ot.vertexUv1s=u.has(1),Ot.vertexUv2s=u.has(2),Ot.vertexUv3s=u.has(3),u.clear(),Ot}function S(M){const E=[];if(M.shaderID?E.push(M.shaderID):(E.push(M.customVertexShaderID),E.push(M.customFragmentShaderID)),M.defines!==void 0)for(const O in M.defines)E.push(O),E.push(M.defines[O]);return M.isRawShaderMaterial===!1&&(N(E,M),R(E,M),E.push(a.outputColorSpace)),E.push(M.customProgramCacheKey),E.join()}function N(M,E){M.push(E.precision),M.push(E.outputColorSpace),M.push(E.envMapMode),M.push(E.envMapCubeUVHeight),M.push(E.mapUv),M.push(E.alphaMapUv),M.push(E.lightMapUv),M.push(E.aoMapUv),M.push(E.bumpMapUv),M.push(E.normalMapUv),M.push(E.displacementMapUv),M.push(E.emissiveMapUv),M.push(E.metalnessMapUv),M.push(E.roughnessMapUv),M.push(E.anisotropyMapUv),M.push(E.clearcoatMapUv),M.push(E.clearcoatNormalMapUv),M.push(E.clearcoatRoughnessMapUv),M.push(E.iridescenceMapUv),M.push(E.iridescenceThicknessMapUv),M.push(E.sheenColorMapUv),M.push(E.sheenRoughnessMapUv),M.push(E.specularMapUv),M.push(E.specularColorMapUv),M.push(E.specularIntensityMapUv),M.push(E.transmissionMapUv),M.push(E.thicknessMapUv),M.push(E.combine),M.push(E.fogExp2),M.push(E.sizeAttenuation),M.push(E.morphTargetsCount),M.push(E.morphAttributeCount),M.push(E.numDirLights),M.push(E.numPointLights),M.push(E.numSpotLights),M.push(E.numSpotLightMaps),M.push(E.numHemiLights),M.push(E.numRectAreaLights),M.push(E.numDirLightShadows),M.push(E.numPointLightShadows),M.push(E.numSpotLightShadows),M.push(E.numSpotLightShadowsWithMaps),M.push(E.numLightProbes),M.push(E.shadowMapType),M.push(E.toneMapping),M.push(E.numClippingPlanes),M.push(E.numClipIntersection),M.push(E.depthPacking)}function R(M,E){l.disableAll(),E.instancing&&l.enable(0),E.instancingColor&&l.enable(1),E.instancingMorph&&l.enable(2),E.matcap&&l.enable(3),E.envMap&&l.enable(4),E.normalMapObjectSpace&&l.enable(5),E.normalMapTangentSpace&&l.enable(6),E.clearcoat&&l.enable(7),E.iridescence&&l.enable(8),E.alphaTest&&l.enable(9),E.vertexColors&&l.enable(10),E.vertexAlphas&&l.enable(11),E.vertexUv1s&&l.enable(12),E.vertexUv2s&&l.enable(13),E.vertexUv3s&&l.enable(14),E.vertexTangents&&l.enable(15),E.anisotropy&&l.enable(16),E.alphaHash&&l.enable(17),E.batching&&l.enable(18),E.dispersion&&l.enable(19),E.batchingColor&&l.enable(20),E.gradientMap&&l.enable(21),M.push(l.mask),l.disableAll(),E.fog&&l.enable(0),E.useFog&&l.enable(1),E.flatShading&&l.enable(2),E.logarithmicDepthBuffer&&l.enable(3),E.reversedDepthBuffer&&l.enable(4),E.skinning&&l.enable(5),E.morphTargets&&l.enable(6),E.morphNormals&&l.enable(7),E.morphColors&&l.enable(8),E.premultipliedAlpha&&l.enable(9),E.shadowMapEnabled&&l.enable(10),E.doubleSided&&l.enable(11),E.flipSided&&l.enable(12),E.useDepthPacking&&l.enable(13),E.dithering&&l.enable(14),E.transmission&&l.enable(15),E.sheen&&l.enable(16),E.opaque&&l.enable(17),E.pointsUvs&&l.enable(18),E.decodeVideoTexture&&l.enable(19),E.decodeVideoTextureEmissive&&l.enable(20),E.alphaToCoverage&&l.enable(21),M.push(l.mask)}function w(M){const E=y[M.type];let O;if(E){const P=Rl[E];O=Im.clone(P.uniforms)}else O=M.uniforms;return O}function V(M,E){let O=A.get(E);return O!==void 0?++O.usedTimes:(O=new rD(a,E,M,s),h.push(O),A.set(E,O)),O}function H(M){if(--M.usedTimes===0){const E=h.indexOf(M);h[E]=h[h.length-1],h.pop(),A.delete(M.cacheKey),M.destroy()}}function X(M){c.remove(M)}function Y(){c.dispose()}return{getParameters:B,getProgramCacheKey:S,getUniforms:w,acquireProgram:V,releaseProgram:H,releaseShaderCache:X,programs:h,dispose:Y}}function dD(){let a=new WeakMap;function e(o){return a.has(o)}function t(o){let l=a.get(o);return l===void 0&&(l={},a.set(o,l)),l}function n(o){a.delete(o)}function i(o,l,c){a.get(o)[l]=c}function s(){a=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:s}}function ID(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.material.id!==e.material.id?a.material.id-e.material.id:a.z!==e.z?a.z-e.z:a.id-e.id}function QR(a,e){return a.groupOrder!==e.groupOrder?a.groupOrder-e.groupOrder:a.renderOrder!==e.renderOrder?a.renderOrder-e.renderOrder:a.z!==e.z?e.z-a.z:a.id-e.id}function qR(){const a=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function o(A,f,p,y,G,B){let S=a[e];return S===void 0?(S={id:A.id,object:A,geometry:f,material:p,groupOrder:y,renderOrder:A.renderOrder,z:G,group:B},a[e]=S):(S.id=A.id,S.object=A,S.geometry=f,S.material=p,S.groupOrder=y,S.renderOrder=A.renderOrder,S.z=G,S.group=B),e++,S}function l(A,f,p,y,G,B){const S=o(A,f,p,y,G,B);p.transmission>0?n.push(S):p.transparent===!0?i.push(S):t.push(S)}function c(A,f,p,y,G,B){const S=o(A,f,p,y,G,B);p.transmission>0?n.unshift(S):p.transparent===!0?i.unshift(S):t.unshift(S)}function u(A,f){t.length>1&&t.sort(A||ID),n.length>1&&n.sort(f||QR),i.length>1&&i.sort(f||QR)}function h(){for(let A=e,f=a.length;A<f;A++){const p=a[A];if(p.id===null)break;p.id=null,p.object=null,p.geometry=null,p.material=null,p.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:l,unshift:c,finish:h,sort:u}}function hD(){let a=new WeakMap;function e(n,i){const s=a.get(n);let o;return s===void 0?(o=new qR,a.set(n,[o])):i>=s.length?(o=new qR,s.push(o)):o=s[i],o}function t(){a=new WeakMap}return{get:e,dispose:t}}function CD(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new ue,color:new tn};break;case"SpotLight":t={position:new ue,direction:new ue,color:new tn,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new ue,color:new tn,distance:0,decay:0};break;case"HemisphereLight":t={direction:new ue,skyColor:new tn,groundColor:new tn};break;case"RectAreaLight":t={color:new tn,position:new ue,halfWidth:new ue,halfHeight:new ue};break}return a[e.id]=t,t}}}function AD(){const a={};return{get:function(e){if(a[e.id]!==void 0)return a[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yt,shadowCameraNear:1,shadowCameraFar:1e3};break}return a[e.id]=t,t}}}let fD=0;function mD(a,e){return(e.castShadow?2:0)-(a.castShadow?2:0)+(e.map?1:0)-(a.map?1:0)}function pD(a){const e=new CD,t=AD(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let u=0;u<9;u++)n.probe.push(new ue);const i=new ue,s=new pn,o=new pn;function l(u){let h=0,A=0,f=0;for(let M=0;M<9;M++)n.probe[M].set(0,0,0);let p=0,y=0,G=0,B=0,S=0,N=0,R=0,w=0,V=0,H=0,X=0;u.sort(mD);for(let M=0,E=u.length;M<E;M++){const O=u[M],P=O.color,q=O.intensity,k=O.distance;let le=null;if(O.shadow&&O.shadow.map&&(O.shadow.map.texture.format===hI?le=O.shadow.map.texture:le=O.shadow.map.depthTexture||O.shadow.map.texture),O.isAmbientLight)h+=P.r*q,A+=P.g*q,f+=P.b*q;else if(O.isLightProbe){for(let F=0;F<9;F++)n.probe[F].addScaledVector(O.sh.coefficients[F],q);X++}else if(O.isDirectionalLight){const F=e.get(O);if(F.color.copy(O.color).multiplyScalar(O.intensity),O.castShadow){const j=O.shadow,Q=t.get(O);Q.shadowIntensity=j.intensity,Q.shadowBias=j.bias,Q.shadowNormalBias=j.normalBias,Q.shadowRadius=j.radius,Q.shadowMapSize=j.mapSize,n.directionalShadow[p]=Q,n.directionalShadowMap[p]=le,n.directionalShadowMatrix[p]=O.shadow.matrix,N++}n.directional[p]=F,p++}else if(O.isSpotLight){const F=e.get(O);F.position.setFromMatrixPosition(O.matrixWorld),F.color.copy(P).multiplyScalar(q),F.distance=k,F.coneCos=Math.cos(O.angle),F.penumbraCos=Math.cos(O.angle*(1-O.penumbra)),F.decay=O.decay,n.spot[G]=F;const j=O.shadow;if(O.map&&(n.spotLightMap[V]=O.map,V++,j.updateMatrices(O),O.castShadow&&H++),n.spotLightMatrix[G]=j.matrix,O.castShadow){const Q=t.get(O);Q.shadowIntensity=j.intensity,Q.shadowBias=j.bias,Q.shadowNormalBias=j.normalBias,Q.shadowRadius=j.radius,Q.shadowMapSize=j.mapSize,n.spotShadow[G]=Q,n.spotShadowMap[G]=le,w++}G++}else if(O.isRectAreaLight){const F=e.get(O);F.color.copy(P).multiplyScalar(q),F.halfWidth.set(O.width*.5,0,0),F.halfHeight.set(0,O.height*.5,0),n.rectArea[B]=F,B++}else if(O.isPointLight){const F=e.get(O);if(F.color.copy(O.color).multiplyScalar(O.intensity),F.distance=O.distance,F.decay=O.decay,O.castShadow){const j=O.shadow,Q=t.get(O);Q.shadowIntensity=j.intensity,Q.shadowBias=j.bias,Q.shadowNormalBias=j.normalBias,Q.shadowRadius=j.radius,Q.shadowMapSize=j.mapSize,Q.shadowCameraNear=j.camera.near,Q.shadowCameraFar=j.camera.far,n.pointShadow[y]=Q,n.pointShadowMap[y]=le,n.pointShadowMatrix[y]=O.shadow.matrix,R++}n.point[y]=F,y++}else if(O.isHemisphereLight){const F=e.get(O);F.skyColor.copy(O.color).multiplyScalar(q),F.groundColor.copy(O.groundColor).multiplyScalar(q),n.hemi[S]=F,S++}}B>0&&(a.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=Pt.LTC_FLOAT_1,n.rectAreaLTC2=Pt.LTC_FLOAT_2):(n.rectAreaLTC1=Pt.LTC_HALF_1,n.rectAreaLTC2=Pt.LTC_HALF_2)),n.ambient[0]=h,n.ambient[1]=A,n.ambient[2]=f;const Y=n.hash;(Y.directionalLength!==p||Y.pointLength!==y||Y.spotLength!==G||Y.rectAreaLength!==B||Y.hemiLength!==S||Y.numDirectionalShadows!==N||Y.numPointShadows!==R||Y.numSpotShadows!==w||Y.numSpotMaps!==V||Y.numLightProbes!==X)&&(n.directional.length=p,n.spot.length=G,n.rectArea.length=B,n.point.length=y,n.hemi.length=S,n.directionalShadow.length=N,n.directionalShadowMap.length=N,n.pointShadow.length=R,n.pointShadowMap.length=R,n.spotShadow.length=w,n.spotShadowMap.length=w,n.directionalShadowMatrix.length=N,n.pointShadowMatrix.length=R,n.spotLightMatrix.length=w+V-H,n.spotLightMap.length=V,n.numSpotLightShadowsWithMaps=H,n.numLightProbes=X,Y.directionalLength=p,Y.pointLength=y,Y.spotLength=G,Y.rectAreaLength=B,Y.hemiLength=S,Y.numDirectionalShadows=N,Y.numPointShadows=R,Y.numSpotShadows=w,Y.numSpotMaps=V,Y.numLightProbes=X,n.version=fD++)}function c(u,h){let A=0,f=0,p=0,y=0,G=0;const B=h.matrixWorldInverse;for(let S=0,N=u.length;S<N;S++){const R=u[S];if(R.isDirectionalLight){const w=n.directional[A];w.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),w.direction.sub(i),w.direction.transformDirection(B),A++}else if(R.isSpotLight){const w=n.spot[p];w.position.setFromMatrixPosition(R.matrixWorld),w.position.applyMatrix4(B),w.direction.setFromMatrixPosition(R.matrixWorld),i.setFromMatrixPosition(R.target.matrixWorld),w.direction.sub(i),w.direction.transformDirection(B),p++}else if(R.isRectAreaLight){const w=n.rectArea[y];w.position.setFromMatrixPosition(R.matrixWorld),w.position.applyMatrix4(B),o.identity(),s.copy(R.matrixWorld),s.premultiply(B),o.extractRotation(s),w.halfWidth.set(R.width*.5,0,0),w.halfHeight.set(0,R.height*.5,0),w.halfWidth.applyMatrix4(o),w.halfHeight.applyMatrix4(o),y++}else if(R.isPointLight){const w=n.point[f];w.position.setFromMatrixPosition(R.matrixWorld),w.position.applyMatrix4(B),f++}else if(R.isHemisphereLight){const w=n.hemi[G];w.direction.setFromMatrixPosition(R.matrixWorld),w.direction.transformDirection(B),G++}}}return{setup:l,setupView:c,state:n}}function $R(a){const e=new pD(a),t=[],n=[];function i(h){u.camera=h,t.length=0,n.length=0}function s(h){t.push(h)}function o(h){n.push(h)}function l(){e.setup(t)}function c(h){e.setupView(t,h)}const u={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:u,setupLights:l,setupLightsView:c,pushLight:s,pushShadow:o}}function bD(a){let e=new WeakMap;function t(i,s=0){const o=e.get(i);let l;return o===void 0?(l=new $R(a),e.set(i,[l])):s>=o.length?(l=new $R(a),o.push(l)):l=o[s],l}function n(){e=new WeakMap}return{get:t,dispose:n}}const yD=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,vD=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ).rg;
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ).r;
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( max( 0.0, squared_mean - mean * mean ) );
	gl_FragColor = vec4( mean, std_dev, 0.0, 1.0 );
}`,GD=[new ue(1,0,0),new ue(-1,0,0),new ue(0,1,0),new ue(0,-1,0),new ue(0,0,1),new ue(0,0,-1)],BD=[new ue(0,-1,0),new ue(0,-1,0),new ue(0,0,1),new ue(0,0,-1),new ue(0,-1,0),new ue(0,-1,0)],e1=new pn,ff=new ue,pB=new ue;function SD(a,e,t){let n=new RC;const i=new yt,s=new yt,o=new ri,l=new Iv,c=new hv,u={},h=t.maxTextureSize,A={[wc]:Ss,[Ss]:wc,[po]:po},f=new Ds({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yt},radius:{value:4}},vertexShader:yD,fragmentShader:vD}),p=f.clone();p.defines.HORIZONTAL_PASS=1;const y=new Mn;y.setAttribute("position",new Zi(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const G=new _i(y,f),B=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=gC;let S=this.type;this.render=function(H,X,Y){if(B.enabled===!1||B.autoUpdate===!1&&B.needsUpdate===!1||H.length===0)return;H.type===Yf&&(Qt("WebGLShadowMap: PCFSoftShadowMap has been deprecated. Using PCFShadowMap instead."),H.type=gC);const M=a.getRenderTarget(),E=a.getActiveCubeFace(),O=a.getActiveMipmapLevel(),P=a.state;P.setBlending(Wl),P.buffers.depth.getReversed()===!0?P.buffers.color.setClear(0,0,0,0):P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);const q=S!==this.type;q&&X.traverse(function(k){k.material&&(Array.isArray(k.material)?k.material.forEach(le=>le.needsUpdate=!0):k.material.needsUpdate=!0)});for(let k=0,le=H.length;k<le;k++){const F=H[k],j=F.shadow;if(j===void 0){Qt("WebGLShadowMap:",F,"has no shadow.");continue}if(j.autoUpdate===!1&&j.needsUpdate===!1)continue;i.copy(j.mapSize);const Q=j.getFrameExtents();if(i.multiply(Q),s.copy(j.mapSize),(i.x>h||i.y>h)&&(i.x>h&&(s.x=Math.floor(h/Q.x),i.x=s.x*Q.x,j.mapSize.x=s.x),i.y>h&&(s.y=Math.floor(h/Q.y),i.y=s.y*Q.y,j.mapSize.y=s.y)),j.map===null||q===!0){if(j.map!==null&&(j.map.depthTexture!==null&&(j.map.depthTexture.dispose(),j.map.depthTexture=null),j.map.dispose()),this.type===nI){if(F.isPointLight){Qt("WebGLShadowMap: VSM shadow maps are not supported for PointLights. Use PCF or BasicShadowMap instead.");continue}j.map=new yo(i.x,i.y,{format:hI,type:Aa,minFilter:Pn,magFilter:Pn,generateMipmaps:!1}),j.map.texture.name=F.name+".shadowMap",j.map.depthTexture=new GC(i.x,i.y,$i),j.map.depthTexture.name=F.name+".shadowMapDepth",j.map.depthTexture.format=Rc,j.map.depthTexture.compareFunction=null,j.map.depthTexture.minFilter=Ba,j.map.depthTexture.magFilter=Ba}else{F.isPointLight?(j.map=new jy(i.x),j.map.depthTexture=new vV(i.x,fr)):(j.map=new yo(i.x,i.y),j.map.depthTexture=new GC(i.x,i.y,fr)),j.map.depthTexture.name=F.name+".shadowMap",j.map.depthTexture.format=Rc;const oe=a.state.buffers.depth.getReversed();this.type===gC?(j.map.depthTexture.compareFunction=oe?ky:Ly,j.map.depthTexture.minFilter=Pn,j.map.depthTexture.magFilter=Pn):(j.map.depthTexture.compareFunction=null,j.map.depthTexture.minFilter=Ba,j.map.depthTexture.magFilter=Ba)}j.camera.updateProjectionMatrix()}const ce=j.map.isWebGLCubeRenderTarget?6:1;for(let oe=0;oe<ce;oe++){if(j.map.isWebGLCubeRenderTarget)a.setRenderTarget(j.map,oe),a.clear();else{oe===0&&(a.setRenderTarget(j.map),a.clear());const T=j.getViewport(oe);o.set(s.x*T.x,s.y*T.y,s.x*T.z,s.y*T.w),P.viewport(o)}if(F.isPointLight){const T=j.camera,$=j.matrix,ae=F.distance||T.far;ae!==T.far&&(T.far=ae,T.updateProjectionMatrix()),ff.setFromMatrixPosition(F.matrixWorld),T.position.copy(ff),pB.copy(T.position),pB.add(GD[oe]),T.up.copy(BD[oe]),T.lookAt(pB),T.updateMatrixWorld(),$.makeTranslation(-ff.x,-ff.y,-ff.z),e1.multiplyMatrices(T.projectionMatrix,T.matrixWorldInverse),j._frustum.setFromProjectionMatrix(e1,T.coordinateSystem,T.reversedDepth)}else j.updateMatrices(F);n=j.getFrustum(),w(X,Y,j.camera,F,this.type)}j.isPointLightShadow!==!0&&this.type===nI&&N(j,Y),j.needsUpdate=!1}S=this.type,B.needsUpdate=!1,a.setRenderTarget(M,E,O)};function N(H,X){const Y=e.update(G);f.defines.VSM_SAMPLES!==H.blurSamples&&(f.defines.VSM_SAMPLES=H.blurSamples,p.defines.VSM_SAMPLES=H.blurSamples,f.needsUpdate=!0,p.needsUpdate=!0),H.mapPass===null&&(H.mapPass=new yo(i.x,i.y,{format:hI,type:Aa})),f.uniforms.shadow_pass.value=H.map.depthTexture,f.uniforms.resolution.value=H.mapSize,f.uniforms.radius.value=H.radius,a.setRenderTarget(H.mapPass),a.clear(),a.renderBufferDirect(X,null,Y,f,G,null),p.uniforms.shadow_pass.value=H.mapPass.texture,p.uniforms.resolution.value=H.mapSize,p.uniforms.radius.value=H.radius,a.setRenderTarget(H.map),a.clear(),a.renderBufferDirect(X,null,Y,p,G,null)}function R(H,X,Y,M){let E=null;const O=Y.isPointLight===!0?H.customDistanceMaterial:H.customDepthMaterial;if(O!==void 0)E=O;else if(E=Y.isPointLight===!0?c:l,a.localClippingEnabled&&X.clipShadows===!0&&Array.isArray(X.clippingPlanes)&&X.clippingPlanes.length!==0||X.displacementMap&&X.displacementScale!==0||X.alphaMap&&X.alphaTest>0||X.map&&X.alphaTest>0||X.alphaToCoverage===!0){const P=E.uuid,q=X.uuid;let k=u[P];k===void 0&&(k={},u[P]=k);let le=k[q];le===void 0&&(le=E.clone(),k[q]=le,X.addEventListener("dispose",V)),E=le}if(E.visible=X.visible,E.wireframe=X.wireframe,M===nI?E.side=X.shadowSide!==null?X.shadowSide:X.side:E.side=X.shadowSide!==null?X.shadowSide:A[X.side],E.alphaMap=X.alphaMap,E.alphaTest=X.alphaToCoverage===!0?.5:X.alphaTest,E.map=X.map,E.clipShadows=X.clipShadows,E.clippingPlanes=X.clippingPlanes,E.clipIntersection=X.clipIntersection,E.displacementMap=X.displacementMap,E.displacementScale=X.displacementScale,E.displacementBias=X.displacementBias,E.wireframeLinewidth=X.wireframeLinewidth,E.linewidth=X.linewidth,Y.isPointLight===!0&&E.isMeshDistanceMaterial===!0){const P=a.properties.get(E);P.light=Y}return E}function w(H,X,Y,M,E){if(H.visible===!1)return;if(H.layers.test(X.layers)&&(H.isMesh||H.isLine||H.isPoints)&&(H.castShadow||H.receiveShadow&&E===nI)&&(!H.frustumCulled||n.intersectsObject(H))){H.modelViewMatrix.multiplyMatrices(Y.matrixWorldInverse,H.matrixWorld);const q=e.update(H),k=H.material;if(Array.isArray(k)){const le=q.groups;for(let F=0,j=le.length;F<j;F++){const Q=le[F],ce=k[Q.materialIndex];if(ce&&ce.visible){const oe=R(H,ce,M,E);H.onBeforeShadow(a,H,X,Y,q,oe,Q),a.renderBufferDirect(Y,null,q,oe,H,Q),H.onAfterShadow(a,H,X,Y,q,oe,Q)}}}else if(k.visible){const le=R(H,k,M,E);H.onBeforeShadow(a,H,X,Y,q,le,null),a.renderBufferDirect(Y,null,q,le,H,null),H.onAfterShadow(a,H,X,Y,q,le,null)}}const P=H.children;for(let q=0,k=P.length;q<k;q++)w(P[q],X,Y,M,E)}function V(H){H.target.removeEventListener("dispose",V);for(const Y in u){const M=u[Y],E=H.target.uuid;E in M&&(M[E].dispose(),delete M[E])}}}const xD={[N0]:W0,[V0]:X0,[M0]:Y0,[II]:_0,[W0]:N0,[X0]:V0,[Y0]:M0,[_0]:II};function ZD(a,e){function t(){let ye=!1;const Re=new ri;let lt=null;const Kt=new ri(0,0,0,0);return{setMask:function(gt){lt!==gt&&!ye&&(a.colorMask(gt,gt,gt,gt),lt=gt)},setLocked:function(gt){ye=gt},setClear:function(gt,qe,vt,Ut,Ot){Ot===!0&&(gt*=Ut,qe*=Ut,vt*=Ut),Re.set(gt,qe,vt,Ut),Kt.equals(Re)===!1&&(a.clearColor(gt,qe,vt,Ut),Kt.copy(Re))},reset:function(){ye=!1,lt=null,Kt.set(-1,0,0,0)}}}function n(){let ye=!1,Re=!1,lt=null,Kt=null,gt=null;return{setReversed:function(qe){if(Re!==qe){const vt=e.get("EXT_clip_control");qe?vt.clipControlEXT(vt.LOWER_LEFT_EXT,vt.ZERO_TO_ONE_EXT):vt.clipControlEXT(vt.LOWER_LEFT_EXT,vt.NEGATIVE_ONE_TO_ONE_EXT),Re=qe;const Ut=gt;gt=null,this.setClear(Ut)}},getReversed:function(){return Re},setTest:function(qe){qe?de(a.DEPTH_TEST):ee(a.DEPTH_TEST)},setMask:function(qe){lt!==qe&&!ye&&(a.depthMask(qe),lt=qe)},setFunc:function(qe){if(Re&&(qe=xD[qe]),Kt!==qe){switch(qe){case N0:a.depthFunc(a.NEVER);break;case W0:a.depthFunc(a.ALWAYS);break;case V0:a.depthFunc(a.LESS);break;case II:a.depthFunc(a.LEQUAL);break;case M0:a.depthFunc(a.EQUAL);break;case _0:a.depthFunc(a.GEQUAL);break;case X0:a.depthFunc(a.GREATER);break;case Y0:a.depthFunc(a.NOTEQUAL);break;default:a.depthFunc(a.LEQUAL)}Kt=qe}},setLocked:function(qe){ye=qe},setClear:function(qe){gt!==qe&&(Re&&(qe=1-qe),a.clearDepth(qe),gt=qe)},reset:function(){ye=!1,lt=null,Kt=null,gt=null,Re=!1}}}function i(){let ye=!1,Re=null,lt=null,Kt=null,gt=null,qe=null,vt=null,Ut=null,Ot=null;return{setTest:function($t){ye||($t?de(a.STENCIL_TEST):ee(a.STENCIL_TEST))},setMask:function($t){Re!==$t&&!ye&&(a.stencilMask($t),Re=$t)},setFunc:function($t,Rn,Kn){(lt!==$t||Kt!==Rn||gt!==Kn)&&(a.stencilFunc($t,Rn,Kn),lt=$t,Kt=Rn,gt=Kn)},setOp:function($t,Rn,Kn){(qe!==$t||vt!==Rn||Ut!==Kn)&&(a.stencilOp($t,Rn,Kn),qe=$t,vt=Rn,Ut=Kn)},setLocked:function($t){ye=$t},setClear:function($t){Ot!==$t&&(a.clearStencil($t),Ot=$t)},reset:function(){ye=!1,Re=null,lt=null,Kt=null,gt=null,qe=null,vt=null,Ut=null,Ot=null}}}const s=new t,o=new n,l=new i,c=new WeakMap,u=new WeakMap;let h={},A={},f=new WeakMap,p=[],y=null,G=!1,B=null,S=null,N=null,R=null,w=null,V=null,H=null,X=new tn(0,0,0),Y=0,M=!1,E=null,O=null,P=null,q=null,k=null;const le=a.getParameter(a.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let F=!1,j=0;const Q=a.getParameter(a.VERSION);Q.indexOf("WebGL")!==-1?(j=parseFloat(/^WebGL (\d)/.exec(Q)[1]),F=j>=1):Q.indexOf("OpenGL ES")!==-1&&(j=parseFloat(/^OpenGL ES (\d)/.exec(Q)[1]),F=j>=2);let ce=null,oe={};const T=a.getParameter(a.SCISSOR_BOX),$=a.getParameter(a.VIEWPORT),ae=new ri().fromArray(T),Ie=new ri().fromArray($);function be(ye,Re,lt,Kt){const gt=new Uint8Array(4),qe=a.createTexture();a.bindTexture(ye,qe),a.texParameteri(ye,a.TEXTURE_MIN_FILTER,a.NEAREST),a.texParameteri(ye,a.TEXTURE_MAG_FILTER,a.NEAREST);for(let vt=0;vt<lt;vt++)ye===a.TEXTURE_3D||ye===a.TEXTURE_2D_ARRAY?a.texImage3D(Re,0,a.RGBA,1,1,Kt,0,a.RGBA,a.UNSIGNED_BYTE,gt):a.texImage2D(Re+vt,0,a.RGBA,1,1,0,a.RGBA,a.UNSIGNED_BYTE,gt);return qe}const D={};D[a.TEXTURE_2D]=be(a.TEXTURE_2D,a.TEXTURE_2D,1),D[a.TEXTURE_CUBE_MAP]=be(a.TEXTURE_CUBE_MAP,a.TEXTURE_CUBE_MAP_POSITIVE_X,6),D[a.TEXTURE_2D_ARRAY]=be(a.TEXTURE_2D_ARRAY,a.TEXTURE_2D_ARRAY,1,1),D[a.TEXTURE_3D]=be(a.TEXTURE_3D,a.TEXTURE_3D,1,1),s.setClear(0,0,0,1),o.setClear(1),l.setClear(0),de(a.DEPTH_TEST),o.setFunc(II),Le(!1),dt(m2),de(a.CULL_FACE),Ke(Wl);function de(ye){h[ye]!==!0&&(a.enable(ye),h[ye]=!0)}function ee(ye){h[ye]!==!1&&(a.disable(ye),h[ye]=!1)}function Ce(ye,Re){return A[ye]!==Re?(a.bindFramebuffer(ye,Re),A[ye]=Re,ye===a.DRAW_FRAMEBUFFER&&(A[a.FRAMEBUFFER]=Re),ye===a.FRAMEBUFFER&&(A[a.DRAW_FRAMEBUFFER]=Re),!0):!1}function we(ye,Re){let lt=p,Kt=!1;if(ye){lt=f.get(Re),lt===void 0&&(lt=[],f.set(Re,lt));const gt=ye.textures;if(lt.length!==gt.length||lt[0]!==a.COLOR_ATTACHMENT0){for(let qe=0,vt=gt.length;qe<vt;qe++)lt[qe]=a.COLOR_ATTACHMENT0+qe;lt.length=gt.length,Kt=!0}}else lt[0]!==a.BACK&&(lt[0]=a.BACK,Kt=!0);Kt&&a.drawBuffers(lt)}function Ye(ye){return y!==ye?(a.useProgram(ye),y=ye,!0):!1}const Ee={[wu]:a.FUNC_ADD,[ZW]:a.FUNC_SUBTRACT,[wW]:a.FUNC_REVERSE_SUBTRACT};Ee[RW]=a.MIN,Ee[NW]=a.MAX;const pt={[WW]:a.ZERO,[VW]:a.ONE,[MW]:a.SRC_COLOR,[w0]:a.SRC_ALPHA,[FW]:a.SRC_ALPHA_SATURATE,[HW]:a.DST_COLOR,[XW]:a.DST_ALPHA,[_W]:a.ONE_MINUS_SRC_COLOR,[R0]:a.ONE_MINUS_SRC_ALPHA,[EW]:a.ONE_MINUS_DST_COLOR,[YW]:a.ONE_MINUS_DST_ALPHA,[KW]:a.CONSTANT_COLOR,[TW]:a.ONE_MINUS_CONSTANT_COLOR,[zW]:a.CONSTANT_ALPHA,[LW]:a.ONE_MINUS_CONSTANT_ALPHA};function Ke(ye,Re,lt,Kt,gt,qe,vt,Ut,Ot,$t){if(ye===Wl){G===!0&&(ee(a.BLEND),G=!1);return}if(G===!1&&(de(a.BLEND),G=!0),ye!==xW){if(ye!==B||$t!==M){if((S!==wu||w!==wu)&&(a.blendEquation(a.FUNC_ADD),S=wu,w=wu),$t)switch(ye){case lI:a.blendFuncSeparate(a.ONE,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case p2:a.blendFunc(a.ONE,a.ONE);break;case b2:a.blendFuncSeparate(a.ZERO,a.ONE_MINUS_SRC_COLOR,a.ZERO,a.ONE);break;case y2:a.blendFuncSeparate(a.DST_COLOR,a.ONE_MINUS_SRC_ALPHA,a.ZERO,a.ONE);break;default:Cn("WebGLState: Invalid blending: ",ye);break}else switch(ye){case lI:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA,a.ONE,a.ONE_MINUS_SRC_ALPHA);break;case p2:a.blendFuncSeparate(a.SRC_ALPHA,a.ONE,a.ONE,a.ONE);break;case b2:Cn("WebGLState: SubtractiveBlending requires material.premultipliedAlpha = true");break;case y2:Cn("WebGLState: MultiplyBlending requires material.premultipliedAlpha = true");break;default:Cn("WebGLState: Invalid blending: ",ye);break}N=null,R=null,V=null,H=null,X.set(0,0,0),Y=0,B=ye,M=$t}return}gt=gt||Re,qe=qe||lt,vt=vt||Kt,(Re!==S||gt!==w)&&(a.blendEquationSeparate(Ee[Re],Ee[gt]),S=Re,w=gt),(lt!==N||Kt!==R||qe!==V||vt!==H)&&(a.blendFuncSeparate(pt[lt],pt[Kt],pt[qe],pt[vt]),N=lt,R=Kt,V=qe,H=vt),(Ut.equals(X)===!1||Ot!==Y)&&(a.blendColor(Ut.r,Ut.g,Ut.b,Ot),X.copy(Ut),Y=Ot),B=ye,M=!1}function Qe(ye,Re){ye.side===po?ee(a.CULL_FACE):de(a.CULL_FACE);let lt=ye.side===Ss;Re&&(lt=!lt),Le(lt),ye.blending===lI&&ye.transparent===!1?Ke(Wl):Ke(ye.blending,ye.blendEquation,ye.blendSrc,ye.blendDst,ye.blendEquationAlpha,ye.blendSrcAlpha,ye.blendDstAlpha,ye.blendColor,ye.blendAlpha,ye.premultipliedAlpha),o.setFunc(ye.depthFunc),o.setTest(ye.depthTest),o.setMask(ye.depthWrite),s.setMask(ye.colorWrite);const Kt=ye.stencilWrite;l.setTest(Kt),Kt&&(l.setMask(ye.stencilWriteMask),l.setFunc(ye.stencilFunc,ye.stencilRef,ye.stencilFuncMask),l.setOp(ye.stencilFail,ye.stencilZFail,ye.stencilZPass)),ht(ye.polygonOffset,ye.polygonOffsetFactor,ye.polygonOffsetUnits),ye.alphaToCoverage===!0?de(a.SAMPLE_ALPHA_TO_COVERAGE):ee(a.SAMPLE_ALPHA_TO_COVERAGE)}function Le(ye){E!==ye&&(ye?a.frontFace(a.CW):a.frontFace(a.CCW),E=ye)}function dt(ye){ye!==GW?(de(a.CULL_FACE),ye!==O&&(ye===m2?a.cullFace(a.BACK):ye===BW?a.cullFace(a.FRONT):a.cullFace(a.FRONT_AND_BACK))):ee(a.CULL_FACE),O=ye}function se(ye){ye!==P&&(F&&a.lineWidth(ye),P=ye)}function ht(ye,Re,lt){ye?(de(a.POLYGON_OFFSET_FILL),(q!==Re||k!==lt)&&(a.polygonOffset(Re,lt),q=Re,k=lt)):ee(a.POLYGON_OFFSET_FILL)}function it(ye){ye?de(a.SCISSOR_TEST):ee(a.SCISSOR_TEST)}function Fe(ye){ye===void 0&&(ye=a.TEXTURE0+le-1),ce!==ye&&(a.activeTexture(ye),ce=ye)}function st(ye,Re,lt){lt===void 0&&(ce===null?lt=a.TEXTURE0+le-1:lt=ce);let Kt=oe[lt];Kt===void 0&&(Kt={type:void 0,texture:void 0},oe[lt]=Kt),(Kt.type!==ye||Kt.texture!==Re)&&(ce!==lt&&(a.activeTexture(lt),ce=lt),a.bindTexture(ye,Re||D[ye]),Kt.type=ye,Kt.texture=Re)}function ie(){const ye=oe[ce];ye!==void 0&&ye.type!==void 0&&(a.bindTexture(ye.type,null),ye.type=void 0,ye.texture=void 0)}function z(){try{a.compressedTexImage2D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function Ae(){try{a.compressedTexImage3D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function Oe(){try{a.texSubImage2D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function He(){try{a.texSubImage3D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function Me(){try{a.compressedTexSubImage2D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function It(){try{a.compressedTexSubImage3D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function ft(){try{a.texStorage2D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function Ht(){try{a.texStorage3D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function kt(){try{a.texImage2D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function Pe(){try{a.texImage3D(...arguments)}catch(ye){Cn("WebGLState:",ye)}}function je(ye){ae.equals(ye)===!1&&(a.scissor(ye.x,ye.y,ye.z,ye.w),ae.copy(ye))}function ot(ye){Ie.equals(ye)===!1&&(a.viewport(ye.x,ye.y,ye.z,ye.w),Ie.copy(ye))}function he(ye,Re){let lt=u.get(Re);lt===void 0&&(lt=new WeakMap,u.set(Re,lt));let Kt=lt.get(ye);Kt===void 0&&(Kt=a.getUniformBlockIndex(Re,ye.name),lt.set(ye,Kt))}function Ve(ye,Re){const Kt=u.get(Re).get(ye);c.get(Re)!==Kt&&(a.uniformBlockBinding(Re,Kt,ye.__bindingPointIndex),c.set(Re,Kt))}function Ct(){a.disable(a.BLEND),a.disable(a.CULL_FACE),a.disable(a.DEPTH_TEST),a.disable(a.POLYGON_OFFSET_FILL),a.disable(a.SCISSOR_TEST),a.disable(a.STENCIL_TEST),a.disable(a.SAMPLE_ALPHA_TO_COVERAGE),a.blendEquation(a.FUNC_ADD),a.blendFunc(a.ONE,a.ZERO),a.blendFuncSeparate(a.ONE,a.ZERO,a.ONE,a.ZERO),a.blendColor(0,0,0,0),a.colorMask(!0,!0,!0,!0),a.clearColor(0,0,0,0),a.depthMask(!0),a.depthFunc(a.LESS),o.setReversed(!1),a.clearDepth(1),a.stencilMask(4294967295),a.stencilFunc(a.ALWAYS,0,4294967295),a.stencilOp(a.KEEP,a.KEEP,a.KEEP),a.clearStencil(0),a.cullFace(a.BACK),a.frontFace(a.CCW),a.polygonOffset(0,0),a.activeTexture(a.TEXTURE0),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),a.bindFramebuffer(a.READ_FRAMEBUFFER,null),a.useProgram(null),a.lineWidth(1),a.scissor(0,0,a.canvas.width,a.canvas.height),a.viewport(0,0,a.canvas.width,a.canvas.height),h={},ce=null,oe={},A={},f=new WeakMap,p=[],y=null,G=!1,B=null,S=null,N=null,R=null,w=null,V=null,H=null,X=new tn(0,0,0),Y=0,M=!1,E=null,O=null,P=null,q=null,k=null,ae.set(0,0,a.canvas.width,a.canvas.height),Ie.set(0,0,a.canvas.width,a.canvas.height),s.reset(),o.reset(),l.reset()}return{buffers:{color:s,depth:o,stencil:l},enable:de,disable:ee,bindFramebuffer:Ce,drawBuffers:we,useProgram:Ye,setBlending:Ke,setMaterial:Qe,setFlipSided:Le,setCullFace:dt,setLineWidth:se,setPolygonOffset:ht,setScissorTest:it,activeTexture:Fe,bindTexture:st,unbindTexture:ie,compressedTexImage2D:z,compressedTexImage3D:Ae,texImage2D:kt,texImage3D:Pe,updateUBOMapping:he,uniformBlockBinding:Ve,texStorage2D:ft,texStorage3D:Ht,texSubImage2D:Oe,texSubImage3D:He,compressedTexSubImage2D:Me,compressedTexSubImage3D:It,scissor:je,viewport:ot,reset:Ct}}function wD(a,e,t,n,i,s,o){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),u=new yt,h=new WeakMap;let A;const f=new WeakMap;let p=!1;try{p=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function y(ie,z){return p?new OffscreenCanvas(ie,z):um("canvas")}function G(ie,z,Ae){let Oe=1;const He=st(ie);if((He.width>Ae||He.height>Ae)&&(Oe=Ae/Math.max(He.width,He.height)),Oe<1)if(typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ie instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ie instanceof ImageBitmap||typeof VideoFrame<"u"&&ie instanceof VideoFrame){const Me=Math.floor(Oe*He.width),It=Math.floor(Oe*He.height);A===void 0&&(A=y(Me,It));const ft=z?y(Me,It):A;return ft.width=Me,ft.height=It,ft.getContext("2d").drawImage(ie,0,0,Me,It),Qt("WebGLRenderer: Texture has been resized from ("+He.width+"x"+He.height+") to ("+Me+"x"+It+")."),ft}else return"data"in ie&&Qt("WebGLRenderer: Image in DataTexture is too big ("+He.width+"x"+He.height+")."),ie;return ie}function B(ie){return ie.generateMipmaps}function S(ie){a.generateMipmap(ie)}function N(ie){return ie.isWebGLCubeRenderTarget?a.TEXTURE_CUBE_MAP:ie.isWebGL3DRenderTarget?a.TEXTURE_3D:ie.isWebGLArrayRenderTarget||ie.isCompressedArrayTexture?a.TEXTURE_2D_ARRAY:a.TEXTURE_2D}function R(ie,z,Ae,Oe,He=!1){if(ie!==null){if(a[ie]!==void 0)return a[ie];Qt("WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ie+"'")}let Me=z;if(z===a.RED&&(Ae===a.FLOAT&&(Me=a.R32F),Ae===a.HALF_FLOAT&&(Me=a.R16F),Ae===a.UNSIGNED_BYTE&&(Me=a.R8)),z===a.RED_INTEGER&&(Ae===a.UNSIGNED_BYTE&&(Me=a.R8UI),Ae===a.UNSIGNED_SHORT&&(Me=a.R16UI),Ae===a.UNSIGNED_INT&&(Me=a.R32UI),Ae===a.BYTE&&(Me=a.R8I),Ae===a.SHORT&&(Me=a.R16I),Ae===a.INT&&(Me=a.R32I)),z===a.RG&&(Ae===a.FLOAT&&(Me=a.RG32F),Ae===a.HALF_FLOAT&&(Me=a.RG16F),Ae===a.UNSIGNED_BYTE&&(Me=a.RG8)),z===a.RG_INTEGER&&(Ae===a.UNSIGNED_BYTE&&(Me=a.RG8UI),Ae===a.UNSIGNED_SHORT&&(Me=a.RG16UI),Ae===a.UNSIGNED_INT&&(Me=a.RG32UI),Ae===a.BYTE&&(Me=a.RG8I),Ae===a.SHORT&&(Me=a.RG16I),Ae===a.INT&&(Me=a.RG32I)),z===a.RGB_INTEGER&&(Ae===a.UNSIGNED_BYTE&&(Me=a.RGB8UI),Ae===a.UNSIGNED_SHORT&&(Me=a.RGB16UI),Ae===a.UNSIGNED_INT&&(Me=a.RGB32UI),Ae===a.BYTE&&(Me=a.RGB8I),Ae===a.SHORT&&(Me=a.RGB16I),Ae===a.INT&&(Me=a.RGB32I)),z===a.RGBA_INTEGER&&(Ae===a.UNSIGNED_BYTE&&(Me=a.RGBA8UI),Ae===a.UNSIGNED_SHORT&&(Me=a.RGBA16UI),Ae===a.UNSIGNED_INT&&(Me=a.RGBA32UI),Ae===a.BYTE&&(Me=a.RGBA8I),Ae===a.SHORT&&(Me=a.RGBA16I),Ae===a.INT&&(Me=a.RGBA32I)),z===a.RGB&&(Ae===a.UNSIGNED_INT_5_9_9_9_REV&&(Me=a.RGB9_E5),Ae===a.UNSIGNED_INT_10F_11F_11F_REV&&(Me=a.R11F_G11F_B10F)),z===a.RGBA){const It=He?cm:ei.getTransfer(Oe);Ae===a.FLOAT&&(Me=a.RGBA32F),Ae===a.HALF_FLOAT&&(Me=a.RGBA16F),Ae===a.UNSIGNED_BYTE&&(Me=It===bi?a.SRGB8_ALPHA8:a.RGBA8),Ae===a.UNSIGNED_SHORT_4_4_4_4&&(Me=a.RGBA4),Ae===a.UNSIGNED_SHORT_5_5_5_1&&(Me=a.RGB5_A1)}return(Me===a.R16F||Me===a.R32F||Me===a.RG16F||Me===a.RG32F||Me===a.RGBA16F||Me===a.RGBA32F)&&e.get("EXT_color_buffer_float"),Me}function w(ie,z){let Ae;return ie?z===null||z===fr||z===fC?Ae=a.DEPTH24_STENCIL8:z===$i?Ae=a.DEPTH32F_STENCIL8:z===AC&&(Ae=a.DEPTH24_STENCIL8,Qt("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):z===null||z===fr||z===fC?Ae=a.DEPTH_COMPONENT24:z===$i?Ae=a.DEPTH_COMPONENT32F:z===AC&&(Ae=a.DEPTH_COMPONENT16),Ae}function V(ie,z){return B(ie)===!0||ie.isFramebufferTexture&&ie.minFilter!==Ba&&ie.minFilter!==Pn?Math.log2(Math.max(z.width,z.height))+1:ie.mipmaps!==void 0&&ie.mipmaps.length>0?ie.mipmaps.length:ie.isCompressedTexture&&Array.isArray(ie.image)?z.mipmaps.length:1}function H(ie){const z=ie.target;z.removeEventListener("dispose",H),Y(z),z.isVideoTexture&&h.delete(z)}function X(ie){const z=ie.target;z.removeEventListener("dispose",X),E(z)}function Y(ie){const z=n.get(ie);if(z.__webglInit===void 0)return;const Ae=ie.source,Oe=f.get(Ae);if(Oe){const He=Oe[z.__cacheKey];He.usedTimes--,He.usedTimes===0&&M(ie),Object.keys(Oe).length===0&&f.delete(Ae)}n.remove(ie)}function M(ie){const z=n.get(ie);a.deleteTexture(z.__webglTexture);const Ae=ie.source,Oe=f.get(Ae);delete Oe[z.__cacheKey],o.memory.textures--}function E(ie){const z=n.get(ie);if(ie.depthTexture&&(ie.depthTexture.dispose(),n.remove(ie.depthTexture)),ie.isWebGLCubeRenderTarget)for(let Oe=0;Oe<6;Oe++){if(Array.isArray(z.__webglFramebuffer[Oe]))for(let He=0;He<z.__webglFramebuffer[Oe].length;He++)a.deleteFramebuffer(z.__webglFramebuffer[Oe][He]);else a.deleteFramebuffer(z.__webglFramebuffer[Oe]);z.__webglDepthbuffer&&a.deleteRenderbuffer(z.__webglDepthbuffer[Oe])}else{if(Array.isArray(z.__webglFramebuffer))for(let Oe=0;Oe<z.__webglFramebuffer.length;Oe++)a.deleteFramebuffer(z.__webglFramebuffer[Oe]);else a.deleteFramebuffer(z.__webglFramebuffer);if(z.__webglDepthbuffer&&a.deleteRenderbuffer(z.__webglDepthbuffer),z.__webglMultisampledFramebuffer&&a.deleteFramebuffer(z.__webglMultisampledFramebuffer),z.__webglColorRenderbuffer)for(let Oe=0;Oe<z.__webglColorRenderbuffer.length;Oe++)z.__webglColorRenderbuffer[Oe]&&a.deleteRenderbuffer(z.__webglColorRenderbuffer[Oe]);z.__webglDepthRenderbuffer&&a.deleteRenderbuffer(z.__webglDepthRenderbuffer)}const Ae=ie.textures;for(let Oe=0,He=Ae.length;Oe<He;Oe++){const Me=n.get(Ae[Oe]);Me.__webglTexture&&(a.deleteTexture(Me.__webglTexture),o.memory.textures--),n.remove(Ae[Oe])}n.remove(ie)}let O=0;function P(){O=0}function q(){const ie=O;return ie>=i.maxTextures&&Qt("WebGLTextures: Trying to use "+ie+" texture units while this GPU supports only "+i.maxTextures),O+=1,ie}function k(ie){const z=[];return z.push(ie.wrapS),z.push(ie.wrapT),z.push(ie.wrapR||0),z.push(ie.magFilter),z.push(ie.minFilter),z.push(ie.anisotropy),z.push(ie.internalFormat),z.push(ie.format),z.push(ie.type),z.push(ie.generateMipmaps),z.push(ie.premultiplyAlpha),z.push(ie.flipY),z.push(ie.unpackAlignment),z.push(ie.colorSpace),z.join()}function le(ie,z){const Ae=n.get(ie);if(ie.isVideoTexture&&it(ie),ie.isRenderTargetTexture===!1&&ie.isExternalTexture!==!0&&ie.version>0&&Ae.__version!==ie.version){const Oe=ie.image;if(Oe===null)Qt("WebGLRenderer: Texture marked for update but no image data found.");else if(Oe.complete===!1)Qt("WebGLRenderer: Texture marked for update but image is incomplete");else{D(Ae,ie,z);return}}else ie.isExternalTexture&&(Ae.__webglTexture=ie.sourceTexture?ie.sourceTexture:null);t.bindTexture(a.TEXTURE_2D,Ae.__webglTexture,a.TEXTURE0+z)}function F(ie,z){const Ae=n.get(ie);if(ie.isRenderTargetTexture===!1&&ie.version>0&&Ae.__version!==ie.version){D(Ae,ie,z);return}else ie.isExternalTexture&&(Ae.__webglTexture=ie.sourceTexture?ie.sourceTexture:null);t.bindTexture(a.TEXTURE_2D_ARRAY,Ae.__webglTexture,a.TEXTURE0+z)}function j(ie,z){const Ae=n.get(ie);if(ie.isRenderTargetTexture===!1&&ie.version>0&&Ae.__version!==ie.version){D(Ae,ie,z);return}t.bindTexture(a.TEXTURE_3D,Ae.__webglTexture,a.TEXTURE0+z)}function Q(ie,z){const Ae=n.get(ie);if(ie.isCubeDepthTexture!==!0&&ie.version>0&&Ae.__version!==ie.version){de(Ae,ie,z);return}t.bindTexture(a.TEXTURE_CUBE_MAP,Ae.__webglTexture,a.TEXTURE0+z)}const ce={[sm]:a.REPEAT,[Ca]:a.CLAMP_TO_EDGE,[om]:a.MIRRORED_REPEAT},oe={[Ba]:a.NEAREST,[fS]:a.NEAREST_MIPMAP_NEAREST,[sC]:a.NEAREST_MIPMAP_LINEAR,[Pn]:a.LINEAR,[Hf]:a.LINEAR_MIPMAP_NEAREST,[Gc]:a.LINEAR_MIPMAP_LINEAR},T={[$W]:a.NEVER,[aV]:a.ALWAYS,[eV]:a.LESS,[Ly]:a.LEQUAL,[tV]:a.EQUAL,[ky]:a.GEQUAL,[nV]:a.GREATER,[iV]:a.NOTEQUAL};function $(ie,z){if(z.type===$i&&e.has("OES_texture_float_linear")===!1&&(z.magFilter===Pn||z.magFilter===Hf||z.magFilter===sC||z.magFilter===Gc||z.minFilter===Pn||z.minFilter===Hf||z.minFilter===sC||z.minFilter===Gc)&&Qt("WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),a.texParameteri(ie,a.TEXTURE_WRAP_S,ce[z.wrapS]),a.texParameteri(ie,a.TEXTURE_WRAP_T,ce[z.wrapT]),(ie===a.TEXTURE_3D||ie===a.TEXTURE_2D_ARRAY)&&a.texParameteri(ie,a.TEXTURE_WRAP_R,ce[z.wrapR]),a.texParameteri(ie,a.TEXTURE_MAG_FILTER,oe[z.magFilter]),a.texParameteri(ie,a.TEXTURE_MIN_FILTER,oe[z.minFilter]),z.compareFunction&&(a.texParameteri(ie,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(ie,a.TEXTURE_COMPARE_FUNC,T[z.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(z.magFilter===Ba||z.minFilter!==sC&&z.minFilter!==Gc||z.type===$i&&e.has("OES_texture_float_linear")===!1)return;if(z.anisotropy>1||n.get(z).__currentAnisotropy){const Ae=e.get("EXT_texture_filter_anisotropic");a.texParameterf(ie,Ae.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(z.anisotropy,i.getMaxAnisotropy())),n.get(z).__currentAnisotropy=z.anisotropy}}}function ae(ie,z){let Ae=!1;ie.__webglInit===void 0&&(ie.__webglInit=!0,z.addEventListener("dispose",H));const Oe=z.source;let He=f.get(Oe);He===void 0&&(He={},f.set(Oe,He));const Me=k(z);if(Me!==ie.__cacheKey){He[Me]===void 0&&(He[Me]={texture:a.createTexture(),usedTimes:0},o.memory.textures++,Ae=!0),He[Me].usedTimes++;const It=He[ie.__cacheKey];It!==void 0&&(He[ie.__cacheKey].usedTimes--,It.usedTimes===0&&M(z)),ie.__cacheKey=Me,ie.__webglTexture=He[Me].texture}return Ae}function Ie(ie,z,Ae){return Math.floor(Math.floor(ie/Ae)/z)}function be(ie,z,Ae,Oe){const Me=ie.updateRanges;if(Me.length===0)t.texSubImage2D(a.TEXTURE_2D,0,0,0,z.width,z.height,Ae,Oe,z.data);else{Me.sort((Pe,je)=>Pe.start-je.start);let It=0;for(let Pe=1;Pe<Me.length;Pe++){const je=Me[It],ot=Me[Pe],he=je.start+je.count,Ve=Ie(ot.start,z.width,4),Ct=Ie(je.start,z.width,4);ot.start<=he+1&&Ve===Ct&&Ie(ot.start+ot.count-1,z.width,4)===Ve?je.count=Math.max(je.count,ot.start+ot.count-je.start):(++It,Me[It]=ot)}Me.length=It+1;const ft=a.getParameter(a.UNPACK_ROW_LENGTH),Ht=a.getParameter(a.UNPACK_SKIP_PIXELS),kt=a.getParameter(a.UNPACK_SKIP_ROWS);a.pixelStorei(a.UNPACK_ROW_LENGTH,z.width);for(let Pe=0,je=Me.length;Pe<je;Pe++){const ot=Me[Pe],he=Math.floor(ot.start/4),Ve=Math.ceil(ot.count/4),Ct=he%z.width,ye=Math.floor(he/z.width),Re=Ve,lt=1;a.pixelStorei(a.UNPACK_SKIP_PIXELS,Ct),a.pixelStorei(a.UNPACK_SKIP_ROWS,ye),t.texSubImage2D(a.TEXTURE_2D,0,Ct,ye,Re,lt,Ae,Oe,z.data)}ie.clearUpdateRanges(),a.pixelStorei(a.UNPACK_ROW_LENGTH,ft),a.pixelStorei(a.UNPACK_SKIP_PIXELS,Ht),a.pixelStorei(a.UNPACK_SKIP_ROWS,kt)}}function D(ie,z,Ae){let Oe=a.TEXTURE_2D;(z.isDataArrayTexture||z.isCompressedArrayTexture)&&(Oe=a.TEXTURE_2D_ARRAY),z.isData3DTexture&&(Oe=a.TEXTURE_3D);const He=ae(ie,z),Me=z.source;t.bindTexture(Oe,ie.__webglTexture,a.TEXTURE0+Ae);const It=n.get(Me);if(Me.version!==It.__version||He===!0){t.activeTexture(a.TEXTURE0+Ae);const ft=ei.getPrimaries(ei.workingColorSpace),Ht=z.colorSpace===vg?null:ei.getPrimaries(z.colorSpace),kt=z.colorSpace===vg||ft===Ht?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,z.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,z.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,kt);let Pe=G(z.image,!1,i.maxTextureSize);Pe=Fe(z,Pe);const je=s.convert(z.format,z.colorSpace),ot=s.convert(z.type);let he=R(z.internalFormat,je,ot,z.colorSpace,z.isVideoTexture);$(Oe,z);let Ve;const Ct=z.mipmaps,ye=z.isVideoTexture!==!0,Re=It.__version===void 0||He===!0,lt=Me.dataReady,Kt=V(z,Pe);if(z.isDepthTexture)he=w(z.format===Nu,z.type),Re&&(ye?t.texStorage2D(a.TEXTURE_2D,1,he,Pe.width,Pe.height):t.texImage2D(a.TEXTURE_2D,0,he,Pe.width,Pe.height,0,je,ot,null));else if(z.isDataTexture)if(Ct.length>0){ye&&Re&&t.texStorage2D(a.TEXTURE_2D,Kt,he,Ct[0].width,Ct[0].height);for(let gt=0,qe=Ct.length;gt<qe;gt++)Ve=Ct[gt],ye?lt&&t.texSubImage2D(a.TEXTURE_2D,gt,0,0,Ve.width,Ve.height,je,ot,Ve.data):t.texImage2D(a.TEXTURE_2D,gt,he,Ve.width,Ve.height,0,je,ot,Ve.data);z.generateMipmaps=!1}else ye?(Re&&t.texStorage2D(a.TEXTURE_2D,Kt,he,Pe.width,Pe.height),lt&&be(z,Pe,je,ot)):t.texImage2D(a.TEXTURE_2D,0,he,Pe.width,Pe.height,0,je,ot,Pe.data);else if(z.isCompressedTexture)if(z.isCompressedArrayTexture){ye&&Re&&t.texStorage3D(a.TEXTURE_2D_ARRAY,Kt,he,Ct[0].width,Ct[0].height,Pe.depth);for(let gt=0,qe=Ct.length;gt<qe;gt++)if(Ve=Ct[gt],z.format!==Sa)if(je!==null)if(ye){if(lt)if(z.layerUpdates.size>0){const vt=M2(Ve.width,Ve.height,z.format,z.type);for(const Ut of z.layerUpdates){const Ot=Ve.data.subarray(Ut*vt/Ve.data.BYTES_PER_ELEMENT,(Ut+1)*vt/Ve.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,gt,0,0,Ut,Ve.width,Ve.height,1,je,Ot)}z.clearLayerUpdates()}else t.compressedTexSubImage3D(a.TEXTURE_2D_ARRAY,gt,0,0,0,Ve.width,Ve.height,Pe.depth,je,Ve.data)}else t.compressedTexImage3D(a.TEXTURE_2D_ARRAY,gt,he,Ve.width,Ve.height,Pe.depth,0,Ve.data,0,0);else Qt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else ye?lt&&t.texSubImage3D(a.TEXTURE_2D_ARRAY,gt,0,0,0,Ve.width,Ve.height,Pe.depth,je,ot,Ve.data):t.texImage3D(a.TEXTURE_2D_ARRAY,gt,he,Ve.width,Ve.height,Pe.depth,0,je,ot,Ve.data)}else{ye&&Re&&t.texStorage2D(a.TEXTURE_2D,Kt,he,Ct[0].width,Ct[0].height);for(let gt=0,qe=Ct.length;gt<qe;gt++)Ve=Ct[gt],z.format!==Sa?je!==null?ye?lt&&t.compressedTexSubImage2D(a.TEXTURE_2D,gt,0,0,Ve.width,Ve.height,je,Ve.data):t.compressedTexImage2D(a.TEXTURE_2D,gt,he,Ve.width,Ve.height,0,Ve.data):Qt("WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ye?lt&&t.texSubImage2D(a.TEXTURE_2D,gt,0,0,Ve.width,Ve.height,je,ot,Ve.data):t.texImage2D(a.TEXTURE_2D,gt,he,Ve.width,Ve.height,0,je,ot,Ve.data)}else if(z.isDataArrayTexture)if(ye){if(Re&&t.texStorage3D(a.TEXTURE_2D_ARRAY,Kt,he,Pe.width,Pe.height,Pe.depth),lt)if(z.layerUpdates.size>0){const gt=M2(Pe.width,Pe.height,z.format,z.type);for(const qe of z.layerUpdates){const vt=Pe.data.subarray(qe*gt/Pe.data.BYTES_PER_ELEMENT,(qe+1)*gt/Pe.data.BYTES_PER_ELEMENT);t.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,qe,Pe.width,Pe.height,1,je,ot,vt)}z.clearLayerUpdates()}else t.texSubImage3D(a.TEXTURE_2D_ARRAY,0,0,0,0,Pe.width,Pe.height,Pe.depth,je,ot,Pe.data)}else t.texImage3D(a.TEXTURE_2D_ARRAY,0,he,Pe.width,Pe.height,Pe.depth,0,je,ot,Pe.data);else if(z.isData3DTexture)ye?(Re&&t.texStorage3D(a.TEXTURE_3D,Kt,he,Pe.width,Pe.height,Pe.depth),lt&&t.texSubImage3D(a.TEXTURE_3D,0,0,0,0,Pe.width,Pe.height,Pe.depth,je,ot,Pe.data)):t.texImage3D(a.TEXTURE_3D,0,he,Pe.width,Pe.height,Pe.depth,0,je,ot,Pe.data);else if(z.isFramebufferTexture){if(Re)if(ye)t.texStorage2D(a.TEXTURE_2D,Kt,he,Pe.width,Pe.height);else{let gt=Pe.width,qe=Pe.height;for(let vt=0;vt<Kt;vt++)t.texImage2D(a.TEXTURE_2D,vt,he,gt,qe,0,je,ot,null),gt>>=1,qe>>=1}}else if(Ct.length>0){if(ye&&Re){const gt=st(Ct[0]);t.texStorage2D(a.TEXTURE_2D,Kt,he,gt.width,gt.height)}for(let gt=0,qe=Ct.length;gt<qe;gt++)Ve=Ct[gt],ye?lt&&t.texSubImage2D(a.TEXTURE_2D,gt,0,0,je,ot,Ve):t.texImage2D(a.TEXTURE_2D,gt,he,je,ot,Ve);z.generateMipmaps=!1}else if(ye){if(Re){const gt=st(Pe);t.texStorage2D(a.TEXTURE_2D,Kt,he,gt.width,gt.height)}lt&&t.texSubImage2D(a.TEXTURE_2D,0,0,0,je,ot,Pe)}else t.texImage2D(a.TEXTURE_2D,0,he,je,ot,Pe);B(z)&&S(Oe),It.__version=Me.version,z.onUpdate&&z.onUpdate(z)}ie.__version=z.version}function de(ie,z,Ae){if(z.image.length!==6)return;const Oe=ae(ie,z),He=z.source;t.bindTexture(a.TEXTURE_CUBE_MAP,ie.__webglTexture,a.TEXTURE0+Ae);const Me=n.get(He);if(He.version!==Me.__version||Oe===!0){t.activeTexture(a.TEXTURE0+Ae);const It=ei.getPrimaries(ei.workingColorSpace),ft=z.colorSpace===vg?null:ei.getPrimaries(z.colorSpace),Ht=z.colorSpace===vg||It===ft?a.NONE:a.BROWSER_DEFAULT_WEBGL;a.pixelStorei(a.UNPACK_FLIP_Y_WEBGL,z.flipY),a.pixelStorei(a.UNPACK_PREMULTIPLY_ALPHA_WEBGL,z.premultiplyAlpha),a.pixelStorei(a.UNPACK_ALIGNMENT,z.unpackAlignment),a.pixelStorei(a.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ht);const kt=z.isCompressedTexture||z.image[0].isCompressedTexture,Pe=z.image[0]&&z.image[0].isDataTexture,je=[];for(let qe=0;qe<6;qe++)!kt&&!Pe?je[qe]=G(z.image[qe],!0,i.maxCubemapSize):je[qe]=Pe?z.image[qe].image:z.image[qe],je[qe]=Fe(z,je[qe]);const ot=je[0],he=s.convert(z.format,z.colorSpace),Ve=s.convert(z.type),Ct=R(z.internalFormat,he,Ve,z.colorSpace),ye=z.isVideoTexture!==!0,Re=Me.__version===void 0||Oe===!0,lt=He.dataReady;let Kt=V(z,ot);$(a.TEXTURE_CUBE_MAP,z);let gt;if(kt){ye&&Re&&t.texStorage2D(a.TEXTURE_CUBE_MAP,Kt,Ct,ot.width,ot.height);for(let qe=0;qe<6;qe++){gt=je[qe].mipmaps;for(let vt=0;vt<gt.length;vt++){const Ut=gt[vt];z.format!==Sa?he!==null?ye?lt&&t.compressedTexSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt,0,0,Ut.width,Ut.height,he,Ut.data):t.compressedTexImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt,Ct,Ut.width,Ut.height,0,Ut.data):Qt("WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ye?lt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt,0,0,Ut.width,Ut.height,he,Ve,Ut.data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt,Ct,Ut.width,Ut.height,0,he,Ve,Ut.data)}}}else{if(gt=z.mipmaps,ye&&Re){gt.length>0&&Kt++;const qe=st(je[0]);t.texStorage2D(a.TEXTURE_CUBE_MAP,Kt,Ct,qe.width,qe.height)}for(let qe=0;qe<6;qe++)if(Pe){ye?lt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0,0,0,je[qe].width,je[qe].height,he,Ve,je[qe].data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0,Ct,je[qe].width,je[qe].height,0,he,Ve,je[qe].data);for(let vt=0;vt<gt.length;vt++){const Ot=gt[vt].image[qe].image;ye?lt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt+1,0,0,Ot.width,Ot.height,he,Ve,Ot.data):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt+1,Ct,Ot.width,Ot.height,0,he,Ve,Ot.data)}}else{ye?lt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0,0,0,he,Ve,je[qe]):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,0,Ct,he,Ve,je[qe]);for(let vt=0;vt<gt.length;vt++){const Ut=gt[vt];ye?lt&&t.texSubImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt+1,0,0,he,Ve,Ut.image[qe]):t.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+qe,vt+1,Ct,he,Ve,Ut.image[qe])}}}B(z)&&S(a.TEXTURE_CUBE_MAP),Me.__version=He.version,z.onUpdate&&z.onUpdate(z)}ie.__version=z.version}function ee(ie,z,Ae,Oe,He,Me){const It=s.convert(Ae.format,Ae.colorSpace),ft=s.convert(Ae.type),Ht=R(Ae.internalFormat,It,ft,Ae.colorSpace),kt=n.get(z),Pe=n.get(Ae);if(Pe.__renderTarget=z,!kt.__hasExternalTextures){const je=Math.max(1,z.width>>Me),ot=Math.max(1,z.height>>Me);He===a.TEXTURE_3D||He===a.TEXTURE_2D_ARRAY?t.texImage3D(He,Me,Ht,je,ot,z.depth,0,It,ft,null):t.texImage2D(He,Me,Ht,je,ot,0,It,ft,null)}t.bindFramebuffer(a.FRAMEBUFFER,ie),ht(z)?l.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,Oe,He,Pe.__webglTexture,0,se(z)):(He===a.TEXTURE_2D||He>=a.TEXTURE_CUBE_MAP_POSITIVE_X&&He<=a.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&a.framebufferTexture2D(a.FRAMEBUFFER,Oe,He,Pe.__webglTexture,Me),t.bindFramebuffer(a.FRAMEBUFFER,null)}function Ce(ie,z,Ae){if(a.bindRenderbuffer(a.RENDERBUFFER,ie),z.depthBuffer){const Oe=z.depthTexture,He=Oe&&Oe.isDepthTexture?Oe.type:null,Me=w(z.stencilBuffer,He),It=z.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;ht(z)?l.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,se(z),Me,z.width,z.height):Ae?a.renderbufferStorageMultisample(a.RENDERBUFFER,se(z),Me,z.width,z.height):a.renderbufferStorage(a.RENDERBUFFER,Me,z.width,z.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,It,a.RENDERBUFFER,ie)}else{const Oe=z.textures;for(let He=0;He<Oe.length;He++){const Me=Oe[He],It=s.convert(Me.format,Me.colorSpace),ft=s.convert(Me.type),Ht=R(Me.internalFormat,It,ft,Me.colorSpace);ht(z)?l.renderbufferStorageMultisampleEXT(a.RENDERBUFFER,se(z),Ht,z.width,z.height):Ae?a.renderbufferStorageMultisample(a.RENDERBUFFER,se(z),Ht,z.width,z.height):a.renderbufferStorage(a.RENDERBUFFER,Ht,z.width,z.height)}}a.bindRenderbuffer(a.RENDERBUFFER,null)}function we(ie,z,Ae){const Oe=z.isWebGLCubeRenderTarget===!0;if(t.bindFramebuffer(a.FRAMEBUFFER,ie),!(z.depthTexture&&z.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const He=n.get(z.depthTexture);if(He.__renderTarget=z,(!He.__webglTexture||z.depthTexture.image.width!==z.width||z.depthTexture.image.height!==z.height)&&(z.depthTexture.image.width=z.width,z.depthTexture.image.height=z.height,z.depthTexture.needsUpdate=!0),Oe){if(He.__webglInit===void 0&&(He.__webglInit=!0,z.depthTexture.addEventListener("dispose",H)),He.__webglTexture===void 0){He.__webglTexture=a.createTexture(),t.bindTexture(a.TEXTURE_CUBE_MAP,He.__webglTexture),$(a.TEXTURE_CUBE_MAP,z.depthTexture);const kt=s.convert(z.depthTexture.format),Pe=s.convert(z.depthTexture.type);let je;z.depthTexture.format===Rc?je=a.DEPTH_COMPONENT24:z.depthTexture.format===Nu&&(je=a.DEPTH24_STENCIL8);for(let ot=0;ot<6;ot++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+ot,0,je,z.width,z.height,0,kt,Pe,null)}}else le(z.depthTexture,0);const Me=He.__webglTexture,It=se(z),ft=Oe?a.TEXTURE_CUBE_MAP_POSITIVE_X+Ae:a.TEXTURE_2D,Ht=z.depthTexture.format===Nu?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;if(z.depthTexture.format===Rc)ht(z)?l.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,Ht,ft,Me,0,It):a.framebufferTexture2D(a.FRAMEBUFFER,Ht,ft,Me,0);else if(z.depthTexture.format===Nu)ht(z)?l.framebufferTexture2DMultisampleEXT(a.FRAMEBUFFER,Ht,ft,Me,0,It):a.framebufferTexture2D(a.FRAMEBUFFER,Ht,ft,Me,0);else throw new Error("Unknown depthTexture format")}function Ye(ie){const z=n.get(ie),Ae=ie.isWebGLCubeRenderTarget===!0;if(z.__boundDepthTexture!==ie.depthTexture){const Oe=ie.depthTexture;if(z.__depthDisposeCallback&&z.__depthDisposeCallback(),Oe){const He=()=>{delete z.__boundDepthTexture,delete z.__depthDisposeCallback,Oe.removeEventListener("dispose",He)};Oe.addEventListener("dispose",He),z.__depthDisposeCallback=He}z.__boundDepthTexture=Oe}if(ie.depthTexture&&!z.__autoAllocateDepthBuffer)if(Ae)for(let Oe=0;Oe<6;Oe++)we(z.__webglFramebuffer[Oe],ie,Oe);else{const Oe=ie.texture.mipmaps;Oe&&Oe.length>0?we(z.__webglFramebuffer[0],ie,0):we(z.__webglFramebuffer,ie,0)}else if(Ae){z.__webglDepthbuffer=[];for(let Oe=0;Oe<6;Oe++)if(t.bindFramebuffer(a.FRAMEBUFFER,z.__webglFramebuffer[Oe]),z.__webglDepthbuffer[Oe]===void 0)z.__webglDepthbuffer[Oe]=a.createRenderbuffer(),Ce(z.__webglDepthbuffer[Oe],ie,!1);else{const He=ie.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,Me=z.__webglDepthbuffer[Oe];a.bindRenderbuffer(a.RENDERBUFFER,Me),a.framebufferRenderbuffer(a.FRAMEBUFFER,He,a.RENDERBUFFER,Me)}}else{const Oe=ie.texture.mipmaps;if(Oe&&Oe.length>0?t.bindFramebuffer(a.FRAMEBUFFER,z.__webglFramebuffer[0]):t.bindFramebuffer(a.FRAMEBUFFER,z.__webglFramebuffer),z.__webglDepthbuffer===void 0)z.__webglDepthbuffer=a.createRenderbuffer(),Ce(z.__webglDepthbuffer,ie,!1);else{const He=ie.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,Me=z.__webglDepthbuffer;a.bindRenderbuffer(a.RENDERBUFFER,Me),a.framebufferRenderbuffer(a.FRAMEBUFFER,He,a.RENDERBUFFER,Me)}}t.bindFramebuffer(a.FRAMEBUFFER,null)}function Ee(ie,z,Ae){const Oe=n.get(ie);z!==void 0&&ee(Oe.__webglFramebuffer,ie,ie.texture,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,0),Ae!==void 0&&Ye(ie)}function pt(ie){const z=ie.texture,Ae=n.get(ie),Oe=n.get(z);ie.addEventListener("dispose",X);const He=ie.textures,Me=ie.isWebGLCubeRenderTarget===!0,It=He.length>1;if(It||(Oe.__webglTexture===void 0&&(Oe.__webglTexture=a.createTexture()),Oe.__version=z.version,o.memory.textures++),Me){Ae.__webglFramebuffer=[];for(let ft=0;ft<6;ft++)if(z.mipmaps&&z.mipmaps.length>0){Ae.__webglFramebuffer[ft]=[];for(let Ht=0;Ht<z.mipmaps.length;Ht++)Ae.__webglFramebuffer[ft][Ht]=a.createFramebuffer()}else Ae.__webglFramebuffer[ft]=a.createFramebuffer()}else{if(z.mipmaps&&z.mipmaps.length>0){Ae.__webglFramebuffer=[];for(let ft=0;ft<z.mipmaps.length;ft++)Ae.__webglFramebuffer[ft]=a.createFramebuffer()}else Ae.__webglFramebuffer=a.createFramebuffer();if(It)for(let ft=0,Ht=He.length;ft<Ht;ft++){const kt=n.get(He[ft]);kt.__webglTexture===void 0&&(kt.__webglTexture=a.createTexture(),o.memory.textures++)}if(ie.samples>0&&ht(ie)===!1){Ae.__webglMultisampledFramebuffer=a.createFramebuffer(),Ae.__webglColorRenderbuffer=[],t.bindFramebuffer(a.FRAMEBUFFER,Ae.__webglMultisampledFramebuffer);for(let ft=0;ft<He.length;ft++){const Ht=He[ft];Ae.__webglColorRenderbuffer[ft]=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,Ae.__webglColorRenderbuffer[ft]);const kt=s.convert(Ht.format,Ht.colorSpace),Pe=s.convert(Ht.type),je=R(Ht.internalFormat,kt,Pe,Ht.colorSpace,ie.isXRRenderTarget===!0),ot=se(ie);a.renderbufferStorageMultisample(a.RENDERBUFFER,ot,je,ie.width,ie.height),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+ft,a.RENDERBUFFER,Ae.__webglColorRenderbuffer[ft])}a.bindRenderbuffer(a.RENDERBUFFER,null),ie.depthBuffer&&(Ae.__webglDepthRenderbuffer=a.createRenderbuffer(),Ce(Ae.__webglDepthRenderbuffer,ie,!0)),t.bindFramebuffer(a.FRAMEBUFFER,null)}}if(Me){t.bindTexture(a.TEXTURE_CUBE_MAP,Oe.__webglTexture),$(a.TEXTURE_CUBE_MAP,z);for(let ft=0;ft<6;ft++)if(z.mipmaps&&z.mipmaps.length>0)for(let Ht=0;Ht<z.mipmaps.length;Ht++)ee(Ae.__webglFramebuffer[ft][Ht],ie,z,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+ft,Ht);else ee(Ae.__webglFramebuffer[ft],ie,z,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+ft,0);B(z)&&S(a.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(It){for(let ft=0,Ht=He.length;ft<Ht;ft++){const kt=He[ft],Pe=n.get(kt);let je=a.TEXTURE_2D;(ie.isWebGL3DRenderTarget||ie.isWebGLArrayRenderTarget)&&(je=ie.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY),t.bindTexture(je,Pe.__webglTexture),$(je,kt),ee(Ae.__webglFramebuffer,ie,kt,a.COLOR_ATTACHMENT0+ft,je,0),B(kt)&&S(je)}t.unbindTexture()}else{let ft=a.TEXTURE_2D;if((ie.isWebGL3DRenderTarget||ie.isWebGLArrayRenderTarget)&&(ft=ie.isWebGL3DRenderTarget?a.TEXTURE_3D:a.TEXTURE_2D_ARRAY),t.bindTexture(ft,Oe.__webglTexture),$(ft,z),z.mipmaps&&z.mipmaps.length>0)for(let Ht=0;Ht<z.mipmaps.length;Ht++)ee(Ae.__webglFramebuffer[Ht],ie,z,a.COLOR_ATTACHMENT0,ft,Ht);else ee(Ae.__webglFramebuffer,ie,z,a.COLOR_ATTACHMENT0,ft,0);B(z)&&S(ft),t.unbindTexture()}ie.depthBuffer&&Ye(ie)}function Ke(ie){const z=ie.textures;for(let Ae=0,Oe=z.length;Ae<Oe;Ae++){const He=z[Ae];if(B(He)){const Me=N(ie),It=n.get(He).__webglTexture;t.bindTexture(Me,It),S(Me),t.unbindTexture()}}}const Qe=[],Le=[];function dt(ie){if(ie.samples>0){if(ht(ie)===!1){const z=ie.textures,Ae=ie.width,Oe=ie.height;let He=a.COLOR_BUFFER_BIT;const Me=ie.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT,It=n.get(ie),ft=z.length>1;if(ft)for(let kt=0;kt<z.length;kt++)t.bindFramebuffer(a.FRAMEBUFFER,It.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+kt,a.RENDERBUFFER,null),t.bindFramebuffer(a.FRAMEBUFFER,It.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+kt,a.TEXTURE_2D,null,0);t.bindFramebuffer(a.READ_FRAMEBUFFER,It.__webglMultisampledFramebuffer);const Ht=ie.texture.mipmaps;Ht&&Ht.length>0?t.bindFramebuffer(a.DRAW_FRAMEBUFFER,It.__webglFramebuffer[0]):t.bindFramebuffer(a.DRAW_FRAMEBUFFER,It.__webglFramebuffer);for(let kt=0;kt<z.length;kt++){if(ie.resolveDepthBuffer&&(ie.depthBuffer&&(He|=a.DEPTH_BUFFER_BIT),ie.stencilBuffer&&ie.resolveStencilBuffer&&(He|=a.STENCIL_BUFFER_BIT)),ft){a.framebufferRenderbuffer(a.READ_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.RENDERBUFFER,It.__webglColorRenderbuffer[kt]);const Pe=n.get(z[kt]).__webglTexture;a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,Pe,0)}a.blitFramebuffer(0,0,Ae,Oe,0,0,Ae,Oe,He,a.NEAREST),c===!0&&(Qe.length=0,Le.length=0,Qe.push(a.COLOR_ATTACHMENT0+kt),ie.depthBuffer&&ie.resolveDepthBuffer===!1&&(Qe.push(Me),Le.push(Me),a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,Le)),a.invalidateFramebuffer(a.READ_FRAMEBUFFER,Qe))}if(t.bindFramebuffer(a.READ_FRAMEBUFFER,null),t.bindFramebuffer(a.DRAW_FRAMEBUFFER,null),ft)for(let kt=0;kt<z.length;kt++){t.bindFramebuffer(a.FRAMEBUFFER,It.__webglMultisampledFramebuffer),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+kt,a.RENDERBUFFER,It.__webglColorRenderbuffer[kt]);const Pe=n.get(z[kt]).__webglTexture;t.bindFramebuffer(a.FRAMEBUFFER,It.__webglFramebuffer),a.framebufferTexture2D(a.DRAW_FRAMEBUFFER,a.COLOR_ATTACHMENT0+kt,a.TEXTURE_2D,Pe,0)}t.bindFramebuffer(a.DRAW_FRAMEBUFFER,It.__webglMultisampledFramebuffer)}else if(ie.depthBuffer&&ie.resolveDepthBuffer===!1&&c){const z=ie.stencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT;a.invalidateFramebuffer(a.DRAW_FRAMEBUFFER,[z])}}}function se(ie){return Math.min(i.maxSamples,ie.samples)}function ht(ie){const z=n.get(ie);return ie.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&z.__useRenderToTexture!==!1}function it(ie){const z=o.render.frame;h.get(ie)!==z&&(h.set(ie,z),ie.update())}function Fe(ie,z){const Ae=ie.colorSpace,Oe=ie.format,He=ie.type;return ie.isCompressedTexture===!0||ie.isVideoTexture===!0||Ae!==Ml&&Ae!==vg&&(ei.getTransfer(Ae)===bi?(Oe!==Sa||He!==os)&&Qt("WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):Cn("WebGLTextures: Unsupported texture color space:",Ae)),z}function st(ie){return typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement?(u.width=ie.naturalWidth||ie.width,u.height=ie.naturalHeight||ie.height):typeof VideoFrame<"u"&&ie instanceof VideoFrame?(u.width=ie.displayWidth,u.height=ie.displayHeight):(u.width=ie.width,u.height=ie.height),u}this.allocateTextureUnit=q,this.resetTextureUnits=P,this.setTexture2D=le,this.setTexture2DArray=F,this.setTexture3D=j,this.setTextureCube=Q,this.rebindTextures=Ee,this.setupRenderTarget=pt,this.updateRenderTargetMipmap=Ke,this.updateMultisampleRenderTarget=dt,this.setupDepthRenderbuffer=Ye,this.setupFrameBufferTexture=ee,this.useMultisampledRTT=ht,this.isReversedDepthBuffer=function(){return t.buffers.depth.getReversed()}}function u3(a,e){function t(n,i=vg){let s;const o=ei.getTransfer(i);if(n===os)return a.UNSIGNED_BYTE;if(n===Ey)return a.UNSIGNED_SHORT_4_4_4_4;if(n===Fy)return a.UNSIGNED_SHORT_5_5_5_1;if(n===mS)return a.UNSIGNED_INT_5_9_9_9_REV;if(n===pS)return a.UNSIGNED_INT_10F_11F_11F_REV;if(n===Yy)return a.BYTE;if(n===Hy)return a.SHORT;if(n===AC)return a.UNSIGNED_SHORT;if(n===Nm)return a.INT;if(n===fr)return a.UNSIGNED_INT;if(n===$i)return a.FLOAT;if(n===Aa)return a.HALF_FLOAT;if(n===bS)return a.ALPHA;if(n===yS)return a.RGB;if(n===Sa)return a.RGBA;if(n===Rc)return a.DEPTH_COMPONENT;if(n===Nu)return a.DEPTH_STENCIL;if(n===Wm)return a.RED;if(n===Vm)return a.RED_INTEGER;if(n===hI)return a.RG;if(n===Ky)return a.RG_INTEGER;if(n===Ty)return a.RGBA_INTEGER;if(n===Ef||n===Ff||n===Kf||n===Tf)if(o===bi)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===Ef)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Ff)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Kf)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Tf)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===Ef)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Ff)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Kf)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Tf)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===H0||n===E0||n===F0||n===K0)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===H0)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===E0)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===F0)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===K0)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===T0||n===z0||n===L0||n===k0||n===U0||n===D0||n===O0)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===T0||n===z0)return o===bi?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===L0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC;if(n===k0)return s.COMPRESSED_R11_EAC;if(n===U0)return s.COMPRESSED_SIGNED_R11_EAC;if(n===D0)return s.COMPRESSED_RG11_EAC;if(n===O0)return s.COMPRESSED_SIGNED_RG11_EAC}else return null;if(n===j0||n===J0||n===P0||n===Q0||n===q0||n===$0||n===ey||n===ty||n===ny||n===iy||n===ay||n===sy||n===oy||n===ry)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===j0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===J0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===P0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Q0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===q0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===$0)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===ey)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===ty)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ny)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===iy)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===ay)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===sy)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===oy)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===ry)return o===bi?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===ly||n===cy||n===gy)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===ly)return o===bi?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===cy)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===gy)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===uy||n===dy||n===Iy||n===hy)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===uy)return s.COMPRESSED_RED_RGTC1_EXT;if(n===dy)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Iy)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===hy)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===fC?a.UNSIGNED_INT_24_8:a[n]!==void 0?a[n]:null}return{convert:t}}const RD=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,ND=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class WD{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t){if(this.texture===null){const n=new NS(e.texture);(e.depthNear!==t.depthNear||e.depthFar!==t.depthFar)&&(this.depthNear=e.depthNear,this.depthFar=e.depthFar),this.texture=n}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Ds({vertexShader:RD,fragmentShader:ND,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new _i(new Xl(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class VD extends Nc{constructor(e,t){super();const n=this;let i=null,s=1,o=null,l="local-floor",c=1,u=null,h=null,A=null,f=null,p=null,y=null;const G=typeof XRWebGLBinding<"u",B=new WD,S={},N=t.getContextAttributes();let R=null,w=null;const V=[],H=[],X=new yt;let Y=null;const M=new Ga;M.viewport=new ri;const E=new Ga;E.viewport=new ri;const O=[M,E],P=new e3;let q=null,k=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(D){let de=V[D];return de===void 0&&(de=new m0,V[D]=de),de.getTargetRaySpace()},this.getControllerGrip=function(D){let de=V[D];return de===void 0&&(de=new m0,V[D]=de),de.getGripSpace()},this.getHand=function(D){let de=V[D];return de===void 0&&(de=new m0,V[D]=de),de.getHandSpace()};function le(D){const de=H.indexOf(D.inputSource);if(de===-1)return;const ee=V[de];ee!==void 0&&(ee.update(D.inputSource,D.frame,u||o),ee.dispatchEvent({type:D.type,data:D.inputSource}))}function F(){i.removeEventListener("select",le),i.removeEventListener("selectstart",le),i.removeEventListener("selectend",le),i.removeEventListener("squeeze",le),i.removeEventListener("squeezestart",le),i.removeEventListener("squeezeend",le),i.removeEventListener("end",F),i.removeEventListener("inputsourceschange",j);for(let D=0;D<V.length;D++){const de=H[D];de!==null&&(H[D]=null,V[D].disconnect(de))}q=null,k=null,B.reset();for(const D in S)delete S[D];e.setRenderTarget(R),p=null,f=null,A=null,i=null,w=null,be.stop(),n.isPresenting=!1,e.setPixelRatio(Y),e.setSize(X.width,X.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(D){s=D,n.isPresenting===!0&&Qt("WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(D){l=D,n.isPresenting===!0&&Qt("WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return u||o},this.setReferenceSpace=function(D){u=D},this.getBaseLayer=function(){return f!==null?f:p},this.getBinding=function(){return A===null&&G&&(A=new XRWebGLBinding(i,t)),A},this.getFrame=function(){return y},this.getSession=function(){return i},this.setSession=async function(D){if(i=D,i!==null){if(R=e.getRenderTarget(),i.addEventListener("select",le),i.addEventListener("selectstart",le),i.addEventListener("selectend",le),i.addEventListener("squeeze",le),i.addEventListener("squeezestart",le),i.addEventListener("squeezeend",le),i.addEventListener("end",F),i.addEventListener("inputsourceschange",j),N.xrCompatible!==!0&&await t.makeXRCompatible(),Y=e.getPixelRatio(),e.getSize(X),G&&"createProjectionLayer"in XRWebGLBinding.prototype){let ee=null,Ce=null,we=null;N.depth&&(we=N.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,ee=N.stencil?Nu:Rc,Ce=N.stencil?fC:fr);const Ye={colorFormat:t.RGBA8,depthFormat:we,scaleFactor:s};A=this.getBinding(),f=A.createProjectionLayer(Ye),i.updateRenderState({layers:[f]}),e.setPixelRatio(1),e.setSize(f.textureWidth,f.textureHeight,!1),w=new yo(f.textureWidth,f.textureHeight,{format:Sa,type:os,depthTexture:new GC(f.textureWidth,f.textureHeight,Ce,void 0,void 0,void 0,void 0,void 0,void 0,ee),stencilBuffer:N.stencil,colorSpace:e.outputColorSpace,samples:N.antialias?4:0,resolveDepthBuffer:f.ignoreDepthValues===!1,resolveStencilBuffer:f.ignoreDepthValues===!1})}else{const ee={antialias:N.antialias,alpha:!0,depth:N.depth,stencil:N.stencil,framebufferScaleFactor:s};p=new XRWebGLLayer(i,t,ee),i.updateRenderState({baseLayer:p}),e.setPixelRatio(1),e.setSize(p.framebufferWidth,p.framebufferHeight,!1),w=new yo(p.framebufferWidth,p.framebufferHeight,{format:Sa,type:os,colorSpace:e.outputColorSpace,stencilBuffer:N.stencil,resolveDepthBuffer:p.ignoreDepthValues===!1,resolveStencilBuffer:p.ignoreDepthValues===!1})}w.isXRRenderTarget=!0,this.setFoveation(c),u=null,o=await i.requestReferenceSpace(l),be.setContext(i),be.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return B.getDepthTexture()};function j(D){for(let de=0;de<D.removed.length;de++){const ee=D.removed[de],Ce=H.indexOf(ee);Ce>=0&&(H[Ce]=null,V[Ce].disconnect(ee))}for(let de=0;de<D.added.length;de++){const ee=D.added[de];let Ce=H.indexOf(ee);if(Ce===-1){for(let Ye=0;Ye<V.length;Ye++)if(Ye>=H.length){H.push(ee),Ce=Ye;break}else if(H[Ye]===null){H[Ye]=ee,Ce=Ye;break}if(Ce===-1)break}const we=V[Ce];we&&we.connect(ee)}}const Q=new ue,ce=new ue;function oe(D,de,ee){Q.setFromMatrixPosition(de.matrixWorld),ce.setFromMatrixPosition(ee.matrixWorld);const Ce=Q.distanceTo(ce),we=de.projectionMatrix.elements,Ye=ee.projectionMatrix.elements,Ee=we[14]/(we[10]-1),pt=we[14]/(we[10]+1),Ke=(we[9]+1)/we[5],Qe=(we[9]-1)/we[5],Le=(we[8]-1)/we[0],dt=(Ye[8]+1)/Ye[0],se=Ee*Le,ht=Ee*dt,it=Ce/(-Le+dt),Fe=it*-Le;if(de.matrixWorld.decompose(D.position,D.quaternion,D.scale),D.translateX(Fe),D.translateZ(it),D.matrixWorld.compose(D.position,D.quaternion,D.scale),D.matrixWorldInverse.copy(D.matrixWorld).invert(),we[10]===-1)D.projectionMatrix.copy(de.projectionMatrix),D.projectionMatrixInverse.copy(de.projectionMatrixInverse);else{const st=Ee+it,ie=pt+it,z=se-Fe,Ae=ht+(Ce-Fe),Oe=Ke*pt/ie*st,He=Qe*pt/ie*st;D.projectionMatrix.makePerspective(z,Ae,Oe,He,st,ie),D.projectionMatrixInverse.copy(D.projectionMatrix).invert()}}function T(D,de){de===null?D.matrixWorld.copy(D.matrix):D.matrixWorld.multiplyMatrices(de.matrixWorld,D.matrix),D.matrixWorldInverse.copy(D.matrixWorld).invert()}this.updateCamera=function(D){if(i===null)return;let de=D.near,ee=D.far;B.texture!==null&&(B.depthNear>0&&(de=B.depthNear),B.depthFar>0&&(ee=B.depthFar)),P.near=E.near=M.near=de,P.far=E.far=M.far=ee,(q!==P.near||k!==P.far)&&(i.updateRenderState({depthNear:P.near,depthFar:P.far}),q=P.near,k=P.far),P.layers.mask=D.layers.mask|6,M.layers.mask=P.layers.mask&3,E.layers.mask=P.layers.mask&5;const Ce=D.parent,we=P.cameras;T(P,Ce);for(let Ye=0;Ye<we.length;Ye++)T(we[Ye],Ce);we.length===2?oe(P,M,E):P.projectionMatrix.copy(M.projectionMatrix),$(D,P,Ce)};function $(D,de,ee){ee===null?D.matrix.copy(de.matrixWorld):(D.matrix.copy(ee.matrixWorld),D.matrix.invert(),D.matrix.multiply(de.matrixWorld)),D.matrix.decompose(D.position,D.quaternion,D.scale),D.updateMatrixWorld(!0),D.projectionMatrix.copy(de.projectionMatrix),D.projectionMatrixInverse.copy(de.projectionMatrixInverse),D.isPerspectiveCamera&&(D.fov=bC*2*Math.atan(1/D.projectionMatrix.elements[5]),D.zoom=1)}this.getCamera=function(){return P},this.getFoveation=function(){if(!(f===null&&p===null))return c},this.setFoveation=function(D){c=D,f!==null&&(f.fixedFoveation=D),p!==null&&p.fixedFoveation!==void 0&&(p.fixedFoveation=D)},this.hasDepthSensing=function(){return B.texture!==null},this.getDepthSensingMesh=function(){return B.getMesh(P)},this.getCameraTexture=function(D){return S[D]};let ae=null;function Ie(D,de){if(h=de.getViewerPose(u||o),y=de,h!==null){const ee=h.views;p!==null&&(e.setRenderTargetFramebuffer(w,p.framebuffer),e.setRenderTarget(w));let Ce=!1;ee.length!==P.cameras.length&&(P.cameras.length=0,Ce=!0);for(let pt=0;pt<ee.length;pt++){const Ke=ee[pt];let Qe=null;if(p!==null)Qe=p.getViewport(Ke);else{const dt=A.getViewSubImage(f,Ke);Qe=dt.viewport,pt===0&&(e.setRenderTargetTextures(w,dt.colorTexture,dt.depthStencilTexture),e.setRenderTarget(w))}let Le=O[pt];Le===void 0&&(Le=new Ga,Le.layers.enable(pt),Le.viewport=new ri,O[pt]=Le),Le.matrix.fromArray(Ke.transform.matrix),Le.matrix.decompose(Le.position,Le.quaternion,Le.scale),Le.projectionMatrix.fromArray(Ke.projectionMatrix),Le.projectionMatrixInverse.copy(Le.projectionMatrix).invert(),Le.viewport.set(Qe.x,Qe.y,Qe.width,Qe.height),pt===0&&(P.matrix.copy(Le.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale)),Ce===!0&&P.cameras.push(Le)}const we=i.enabledFeatures;if(we&&we.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&G){A=n.getBinding();const pt=A.getDepthInformation(ee[0]);pt&&pt.isValid&&pt.texture&&B.init(pt,i.renderState)}if(we&&we.includes("camera-access")&&G){e.state.unbindTexture(),A=n.getBinding();for(let pt=0;pt<ee.length;pt++){const Ke=ee[pt].camera;if(Ke){let Qe=S[Ke];Qe||(Qe=new NS,S[Ke]=Qe);const Le=A.getCameraImage(Ke);Qe.sourceTexture=Le}}}}for(let ee=0;ee<V.length;ee++){const Ce=H[ee],we=V[ee];Ce!==null&&we!==void 0&&we.update(Ce,de,u||o)}ae&&ae(D,de),de.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:de}),y=null}const be=new o3;be.setAnimationLoop(Ie),this.setAnimationLoop=function(D){ae=D},this.dispose=function(){}}}const zd=new vo,MD=new pn;function _D(a,e){function t(B,S){B.matrixAutoUpdate===!0&&B.updateMatrix(),S.value.copy(B.matrix)}function n(B,S){S.color.getRGB(B.fogColor.value,dV(a)),S.isFog?(B.fogNear.value=S.near,B.fogFar.value=S.far):S.isFogExp2&&(B.fogDensity.value=S.density)}function i(B,S,N,R,w){S.isMeshBasicMaterial||S.isMeshLambertMaterial?s(B,S):S.isMeshToonMaterial?(s(B,S),A(B,S)):S.isMeshPhongMaterial?(s(B,S),h(B,S)):S.isMeshStandardMaterial?(s(B,S),f(B,S),S.isMeshPhysicalMaterial&&p(B,S,w)):S.isMeshMatcapMaterial?(s(B,S),y(B,S)):S.isMeshDepthMaterial?s(B,S):S.isMeshDistanceMaterial?(s(B,S),G(B,S)):S.isMeshNormalMaterial?s(B,S):S.isLineBasicMaterial?(o(B,S),S.isLineDashedMaterial&&l(B,S)):S.isPointsMaterial?c(B,S,N,R):S.isSpriteMaterial?u(B,S):S.isShadowMaterial?(B.color.value.copy(S.color),B.opacity.value=S.opacity):S.isShaderMaterial&&(S.uniformsNeedUpdate=!1)}function s(B,S){B.opacity.value=S.opacity,S.color&&B.diffuse.value.copy(S.color),S.emissive&&B.emissive.value.copy(S.emissive).multiplyScalar(S.emissiveIntensity),S.map&&(B.map.value=S.map,t(S.map,B.mapTransform)),S.alphaMap&&(B.alphaMap.value=S.alphaMap,t(S.alphaMap,B.alphaMapTransform)),S.bumpMap&&(B.bumpMap.value=S.bumpMap,t(S.bumpMap,B.bumpMapTransform),B.bumpScale.value=S.bumpScale,S.side===Ss&&(B.bumpScale.value*=-1)),S.normalMap&&(B.normalMap.value=S.normalMap,t(S.normalMap,B.normalMapTransform),B.normalScale.value.copy(S.normalScale),S.side===Ss&&B.normalScale.value.negate()),S.displacementMap&&(B.displacementMap.value=S.displacementMap,t(S.displacementMap,B.displacementMapTransform),B.displacementScale.value=S.displacementScale,B.displacementBias.value=S.displacementBias),S.emissiveMap&&(B.emissiveMap.value=S.emissiveMap,t(S.emissiveMap,B.emissiveMapTransform)),S.specularMap&&(B.specularMap.value=S.specularMap,t(S.specularMap,B.specularMapTransform)),S.alphaTest>0&&(B.alphaTest.value=S.alphaTest);const N=e.get(S),R=N.envMap,w=N.envMapRotation;R&&(B.envMap.value=R,zd.copy(w),zd.x*=-1,zd.y*=-1,zd.z*=-1,R.isCubeTexture&&R.isRenderTargetTexture===!1&&(zd.y*=-1,zd.z*=-1),B.envMapRotation.value.setFromMatrix4(MD.makeRotationFromEuler(zd)),B.flipEnvMap.value=R.isCubeTexture&&R.isRenderTargetTexture===!1?-1:1,B.reflectivity.value=S.reflectivity,B.ior.value=S.ior,B.refractionRatio.value=S.refractionRatio),S.lightMap&&(B.lightMap.value=S.lightMap,B.lightMapIntensity.value=S.lightMapIntensity,t(S.lightMap,B.lightMapTransform)),S.aoMap&&(B.aoMap.value=S.aoMap,B.aoMapIntensity.value=S.aoMapIntensity,t(S.aoMap,B.aoMapTransform))}function o(B,S){B.diffuse.value.copy(S.color),B.opacity.value=S.opacity,S.map&&(B.map.value=S.map,t(S.map,B.mapTransform))}function l(B,S){B.dashSize.value=S.dashSize,B.totalSize.value=S.dashSize+S.gapSize,B.scale.value=S.scale}function c(B,S,N,R){B.diffuse.value.copy(S.color),B.opacity.value=S.opacity,B.size.value=S.size*N,B.scale.value=R*.5,S.map&&(B.map.value=S.map,t(S.map,B.uvTransform)),S.alphaMap&&(B.alphaMap.value=S.alphaMap,t(S.alphaMap,B.alphaMapTransform)),S.alphaTest>0&&(B.alphaTest.value=S.alphaTest)}function u(B,S){B.diffuse.value.copy(S.color),B.opacity.value=S.opacity,B.rotation.value=S.rotation,S.map&&(B.map.value=S.map,t(S.map,B.mapTransform)),S.alphaMap&&(B.alphaMap.value=S.alphaMap,t(S.alphaMap,B.alphaMapTransform)),S.alphaTest>0&&(B.alphaTest.value=S.alphaTest)}function h(B,S){B.specular.value.copy(S.specular),B.shininess.value=Math.max(S.shininess,1e-4)}function A(B,S){S.gradientMap&&(B.gradientMap.value=S.gradientMap)}function f(B,S){B.metalness.value=S.metalness,S.metalnessMap&&(B.metalnessMap.value=S.metalnessMap,t(S.metalnessMap,B.metalnessMapTransform)),B.roughness.value=S.roughness,S.roughnessMap&&(B.roughnessMap.value=S.roughnessMap,t(S.roughnessMap,B.roughnessMapTransform)),S.envMap&&(B.envMapIntensity.value=S.envMapIntensity)}function p(B,S,N){B.ior.value=S.ior,S.sheen>0&&(B.sheenColor.value.copy(S.sheenColor).multiplyScalar(S.sheen),B.sheenRoughness.value=S.sheenRoughness,S.sheenColorMap&&(B.sheenColorMap.value=S.sheenColorMap,t(S.sheenColorMap,B.sheenColorMapTransform)),S.sheenRoughnessMap&&(B.sheenRoughnessMap.value=S.sheenRoughnessMap,t(S.sheenRoughnessMap,B.sheenRoughnessMapTransform))),S.clearcoat>0&&(B.clearcoat.value=S.clearcoat,B.clearcoatRoughness.value=S.clearcoatRoughness,S.clearcoatMap&&(B.clearcoatMap.value=S.clearcoatMap,t(S.clearcoatMap,B.clearcoatMapTransform)),S.clearcoatRoughnessMap&&(B.clearcoatRoughnessMap.value=S.clearcoatRoughnessMap,t(S.clearcoatRoughnessMap,B.clearcoatRoughnessMapTransform)),S.clearcoatNormalMap&&(B.clearcoatNormalMap.value=S.clearcoatNormalMap,t(S.clearcoatNormalMap,B.clearcoatNormalMapTransform),B.clearcoatNormalScale.value.copy(S.clearcoatNormalScale),S.side===Ss&&B.clearcoatNormalScale.value.negate())),S.dispersion>0&&(B.dispersion.value=S.dispersion),S.iridescence>0&&(B.iridescence.value=S.iridescence,B.iridescenceIOR.value=S.iridescenceIOR,B.iridescenceThicknessMinimum.value=S.iridescenceThicknessRange[0],B.iridescenceThicknessMaximum.value=S.iridescenceThicknessRange[1],S.iridescenceMap&&(B.iridescenceMap.value=S.iridescenceMap,t(S.iridescenceMap,B.iridescenceMapTransform)),S.iridescenceThicknessMap&&(B.iridescenceThicknessMap.value=S.iridescenceThicknessMap,t(S.iridescenceThicknessMap,B.iridescenceThicknessMapTransform))),S.transmission>0&&(B.transmission.value=S.transmission,B.transmissionSamplerMap.value=N.texture,B.transmissionSamplerSize.value.set(N.width,N.height),S.transmissionMap&&(B.transmissionMap.value=S.transmissionMap,t(S.transmissionMap,B.transmissionMapTransform)),B.thickness.value=S.thickness,S.thicknessMap&&(B.thicknessMap.value=S.thicknessMap,t(S.thicknessMap,B.thicknessMapTransform)),B.attenuationDistance.value=S.attenuationDistance,B.attenuationColor.value.copy(S.attenuationColor)),S.anisotropy>0&&(B.anisotropyVector.value.set(S.anisotropy*Math.cos(S.anisotropyRotation),S.anisotropy*Math.sin(S.anisotropyRotation)),S.anisotropyMap&&(B.anisotropyMap.value=S.anisotropyMap,t(S.anisotropyMap,B.anisotropyMapTransform))),B.specularIntensity.value=S.specularIntensity,B.specularColor.value.copy(S.specularColor),S.specularColorMap&&(B.specularColorMap.value=S.specularColorMap,t(S.specularColorMap,B.specularColorMapTransform)),S.specularIntensityMap&&(B.specularIntensityMap.value=S.specularIntensityMap,t(S.specularIntensityMap,B.specularIntensityMapTransform))}function y(B,S){S.matcap&&(B.matcap.value=S.matcap)}function G(B,S){const N=e.get(S).light;B.referencePosition.value.setFromMatrixPosition(N.matrixWorld),B.nearDistance.value=N.shadow.camera.near,B.farDistance.value=N.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function XD(a,e,t,n){let i={},s={},o=[];const l=a.getParameter(a.MAX_UNIFORM_BUFFER_BINDINGS);function c(N,R){const w=R.program;n.uniformBlockBinding(N,w)}function u(N,R){let w=i[N.id];w===void 0&&(y(N),w=h(N),i[N.id]=w,N.addEventListener("dispose",B));const V=R.program;n.updateUBOMapping(N,V);const H=e.render.frame;s[N.id]!==H&&(f(N),s[N.id]=H)}function h(N){const R=A();N.__bindingPointIndex=R;const w=a.createBuffer(),V=N.__size,H=N.usage;return a.bindBuffer(a.UNIFORM_BUFFER,w),a.bufferData(a.UNIFORM_BUFFER,V,H),a.bindBuffer(a.UNIFORM_BUFFER,null),a.bindBufferBase(a.UNIFORM_BUFFER,R,w),w}function A(){for(let N=0;N<l;N++)if(o.indexOf(N)===-1)return o.push(N),N;return Cn("WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function f(N){const R=i[N.id],w=N.uniforms,V=N.__cache;a.bindBuffer(a.UNIFORM_BUFFER,R);for(let H=0,X=w.length;H<X;H++){const Y=Array.isArray(w[H])?w[H]:[w[H]];for(let M=0,E=Y.length;M<E;M++){const O=Y[M];if(p(O,H,M,V)===!0){const P=O.__offset,q=Array.isArray(O.value)?O.value:[O.value];let k=0;for(let le=0;le<q.length;le++){const F=q[le],j=G(F);typeof F=="number"||typeof F=="boolean"?(O.__data[0]=F,a.bufferSubData(a.UNIFORM_BUFFER,P+k,O.__data)):F.isMatrix3?(O.__data[0]=F.elements[0],O.__data[1]=F.elements[1],O.__data[2]=F.elements[2],O.__data[3]=0,O.__data[4]=F.elements[3],O.__data[5]=F.elements[4],O.__data[6]=F.elements[5],O.__data[7]=0,O.__data[8]=F.elements[6],O.__data[9]=F.elements[7],O.__data[10]=F.elements[8],O.__data[11]=0):(F.toArray(O.__data,k),k+=j.storage/Float32Array.BYTES_PER_ELEMENT)}a.bufferSubData(a.UNIFORM_BUFFER,P,O.__data)}}}a.bindBuffer(a.UNIFORM_BUFFER,null)}function p(N,R,w,V){const H=N.value,X=R+"_"+w;if(V[X]===void 0)return typeof H=="number"||typeof H=="boolean"?V[X]=H:V[X]=H.clone(),!0;{const Y=V[X];if(typeof H=="number"||typeof H=="boolean"){if(Y!==H)return V[X]=H,!0}else if(Y.equals(H)===!1)return Y.copy(H),!0}return!1}function y(N){const R=N.uniforms;let w=0;const V=16;for(let X=0,Y=R.length;X<Y;X++){const M=Array.isArray(R[X])?R[X]:[R[X]];for(let E=0,O=M.length;E<O;E++){const P=M[E],q=Array.isArray(P.value)?P.value:[P.value];for(let k=0,le=q.length;k<le;k++){const F=q[k],j=G(F),Q=w%V,ce=Q%j.boundary,oe=Q+ce;w+=ce,oe!==0&&V-oe<j.storage&&(w+=V-oe),P.__data=new Float32Array(j.storage/Float32Array.BYTES_PER_ELEMENT),P.__offset=w,w+=j.storage}}}const H=w%V;return H>0&&(w+=V-H),N.__size=w,N.__cache={},this}function G(N){const R={boundary:0,storage:0};return typeof N=="number"||typeof N=="boolean"?(R.boundary=4,R.storage=4):N.isVector2?(R.boundary=8,R.storage=8):N.isVector3||N.isColor?(R.boundary=16,R.storage=12):N.isVector4?(R.boundary=16,R.storage=16):N.isMatrix3?(R.boundary=48,R.storage=48):N.isMatrix4?(R.boundary=64,R.storage=64):N.isTexture?Qt("WebGLRenderer: Texture samplers can not be part of an uniforms group."):Qt("WebGLRenderer: Unsupported uniform value type.",N),R}function B(N){const R=N.target;R.removeEventListener("dispose",B);const w=o.indexOf(R.__bindingPointIndex);o.splice(w,1),a.deleteBuffer(i[R.id]),delete i[R.id],delete s[R.id]}function S(){for(const N in i)a.deleteBuffer(i[N]);o=[],i={},s={}}return{bind:c,update:u,dispose:S}}const YD=new Uint16Array([12469,15057,12620,14925,13266,14620,13807,14376,14323,13990,14545,13625,14713,13328,14840,12882,14931,12528,14996,12233,15039,11829,15066,11525,15080,11295,15085,10976,15082,10705,15073,10495,13880,14564,13898,14542,13977,14430,14158,14124,14393,13732,14556,13410,14702,12996,14814,12596,14891,12291,14937,11834,14957,11489,14958,11194,14943,10803,14921,10506,14893,10278,14858,9960,14484,14039,14487,14025,14499,13941,14524,13740,14574,13468,14654,13106,14743,12678,14818,12344,14867,11893,14889,11509,14893,11180,14881,10751,14852,10428,14812,10128,14765,9754,14712,9466,14764,13480,14764,13475,14766,13440,14766,13347,14769,13070,14786,12713,14816,12387,14844,11957,14860,11549,14868,11215,14855,10751,14825,10403,14782,10044,14729,9651,14666,9352,14599,9029,14967,12835,14966,12831,14963,12804,14954,12723,14936,12564,14917,12347,14900,11958,14886,11569,14878,11247,14859,10765,14828,10401,14784,10011,14727,9600,14660,9289,14586,8893,14508,8533,15111,12234,15110,12234,15104,12216,15092,12156,15067,12010,15028,11776,14981,11500,14942,11205,14902,10752,14861,10393,14812,9991,14752,9570,14682,9252,14603,8808,14519,8445,14431,8145,15209,11449,15208,11451,15202,11451,15190,11438,15163,11384,15117,11274,15055,10979,14994,10648,14932,10343,14871,9936,14803,9532,14729,9218,14645,8742,14556,8381,14461,8020,14365,7603,15273,10603,15272,10607,15267,10619,15256,10631,15231,10614,15182,10535,15118,10389,15042,10167,14963,9787,14883,9447,14800,9115,14710,8665,14615,8318,14514,7911,14411,7507,14279,7198,15314,9675,15313,9683,15309,9712,15298,9759,15277,9797,15229,9773,15166,9668,15084,9487,14995,9274,14898,8910,14800,8539,14697,8234,14590,7790,14479,7409,14367,7067,14178,6621,15337,8619,15337,8631,15333,8677,15325,8769,15305,8871,15264,8940,15202,8909,15119,8775,15022,8565,14916,8328,14804,8009,14688,7614,14569,7287,14448,6888,14321,6483,14088,6171,15350,7402,15350,7419,15347,7480,15340,7613,15322,7804,15287,7973,15229,8057,15148,8012,15046,7846,14933,7611,14810,7357,14682,7069,14552,6656,14421,6316,14251,5948,14007,5528,15356,5942,15356,5977,15353,6119,15348,6294,15332,6551,15302,6824,15249,7044,15171,7122,15070,7050,14949,6861,14818,6611,14679,6349,14538,6067,14398,5651,14189,5311,13935,4958,15359,4123,15359,4153,15356,4296,15353,4646,15338,5160,15311,5508,15263,5829,15188,6042,15088,6094,14966,6001,14826,5796,14678,5543,14527,5287,14377,4985,14133,4586,13869,4257,15360,1563,15360,1642,15358,2076,15354,2636,15341,3350,15317,4019,15273,4429,15203,4732,15105,4911,14981,4932,14836,4818,14679,4621,14517,4386,14359,4156,14083,3795,13808,3437,15360,122,15360,137,15358,285,15355,636,15344,1274,15322,2177,15281,2765,15215,3223,15120,3451,14995,3569,14846,3567,14681,3466,14511,3305,14344,3121,14037,2800,13753,2467,15360,0,15360,1,15359,21,15355,89,15346,253,15325,479,15287,796,15225,1148,15133,1492,15008,1749,14856,1882,14685,1886,14506,1783,14324,1608,13996,1398,13702,1183]);let Ic=null;function HD(){return Ic===null&&(Ic=new Lr(YD,16,16,hI,Aa),Ic.name="DFG_LUT",Ic.minFilter=Pn,Ic.magFilter=Pn,Ic.wrapS=Ca,Ic.wrapT=Ca,Ic.generateMipmaps=!1,Ic.needsUpdate=!0),Ic}class ex{constructor(e={}){const{canvas:t=lV(),context:n=null,depth:i=!0,stencil:s=!1,alpha:o=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:u=!1,powerPreference:h="default",failIfMajorPerformanceCaveat:A=!1,reversedDepthBuffer:f=!1,outputBufferType:p=os}=e;this.isWebGLRenderer=!0;let y;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");y=n.getContextAttributes().alpha}else y=o;const G=p,B=new Set([Ty,Ky,Vm]),S=new Set([os,fr,AC,fC,Ey,Fy]),N=new Uint32Array(4),R=new Int32Array(4);let w=null,V=null;const H=[],X=[];let Y=null;this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=zr,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const M=this;let E=!1;this._outputColorSpace=Bs;let O=0,P=0,q=null,k=-1,le=null;const F=new ri,j=new ri;let Q=null;const ce=new tn(0);let oe=0,T=t.width,$=t.height,ae=1,Ie=null,be=null;const D=new ri(0,0,T,$),de=new ri(0,0,T,$);let ee=!1;const Ce=new RC;let we=!1,Ye=!1;const Ee=new pn,pt=new ue,Ke=new ri,Qe={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let Le=!1;function dt(){return q===null?ae:1}let se=n;function ht(ne,ve){return t.getContext(ne,ve)}try{const ne={alpha:!0,depth:i,stencil:s,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:u,powerPreference:h,failIfMajorPerformanceCaveat:A};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${wm}`),t.addEventListener("webglcontextlost",Ut,!1),t.addEventListener("webglcontextrestored",Ot,!1),t.addEventListener("webglcontextcreationerror",$t,!1),se===null){const ve="webgl2";if(se=ht(ve,ne),se===null)throw ht(ve)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ne){throw Cn("WebGLRenderer: "+ne.message),ne}let it,Fe,st,ie,z,Ae,Oe,He,Me,It,ft,Ht,kt,Pe,je,ot,he,Ve,Ct,ye,Re,lt,Kt,gt;function qe(){it=new Ek(se),it.init(),lt=new u3(se,it),Fe=new Rk(se,it,e,lt),st=new ZD(se,it),Fe.reversedDepthBuffer&&f&&st.buffers.depth.setReversed(!0),ie=new Tk(se),z=new dD,Ae=new wD(se,it,st,z,Fe,lt,ie),Oe=new Wk(M),He=new Hk(M),Me=new UT(se),Kt=new Zk(se,Me),It=new Fk(se,Me,ie,Kt),ft=new Lk(se,It,Me,ie),Ct=new zk(se,Fe,Ae),ot=new Nk(z),Ht=new uD(M,Oe,He,it,Fe,Kt,ot),kt=new _D(M,z),Pe=new hD,je=new bD(it),Ve=new xk(M,Oe,He,st,ft,y,c),he=new SD(M,ft,Fe),gt=new XD(se,ie,Fe,st),ye=new wk(se,it,ie),Re=new Kk(se,it,ie),ie.programs=Ht.programs,M.capabilities=Fe,M.extensions=it,M.properties=z,M.renderLists=Pe,M.shadowMap=he,M.state=st,M.info=ie}qe(),G!==os&&(Y=new Uk(G,t.width,t.height,i,s));const vt=new VD(M,se);this.xr=vt,this.getContext=function(){return se},this.getContextAttributes=function(){return se.getContextAttributes()},this.forceContextLoss=function(){const ne=it.get("WEBGL_lose_context");ne&&ne.loseContext()},this.forceContextRestore=function(){const ne=it.get("WEBGL_lose_context");ne&&ne.restoreContext()},this.getPixelRatio=function(){return ae},this.setPixelRatio=function(ne){ne!==void 0&&(ae=ne,this.setSize(T,$,!1))},this.getSize=function(ne){return ne.set(T,$)},this.setSize=function(ne,ve,xe=!0){if(vt.isPresenting){Qt("WebGLRenderer: Can't change size while VR device is presenting.");return}T=ne,$=ve,t.width=Math.floor(ne*ae),t.height=Math.floor(ve*ae),xe===!0&&(t.style.width=ne+"px",t.style.height=ve+"px"),Y!==null&&Y.setSize(t.width,t.height),this.setViewport(0,0,ne,ve)},this.getDrawingBufferSize=function(ne){return ne.set(T*ae,$*ae).floor()},this.setDrawingBufferSize=function(ne,ve,xe){T=ne,$=ve,ae=xe,t.width=Math.floor(ne*xe),t.height=Math.floor(ve*xe),this.setViewport(0,0,ne,ve)},this.setEffects=function(ne){if(G===os){console.error("THREE.WebGLRenderer: setEffects() requires outputBufferType set to HalfFloatType or FloatType.");return}if(ne){for(let ve=0;ve<ne.length;ve++)if(ne[ve].isOutputPass===!0){console.warn("THREE.WebGLRenderer: OutputPass is not needed in setEffects(). Tone mapping and color space conversion are applied automatically.");break}}Y.setEffects(ne||[])},this.getCurrentViewport=function(ne){return ne.copy(F)},this.getViewport=function(ne){return ne.copy(D)},this.setViewport=function(ne,ve,xe,We){ne.isVector4?D.set(ne.x,ne.y,ne.z,ne.w):D.set(ne,ve,xe,We),st.viewport(F.copy(D).multiplyScalar(ae).round())},this.getScissor=function(ne){return ne.copy(de)},this.setScissor=function(ne,ve,xe,We){ne.isVector4?de.set(ne.x,ne.y,ne.z,ne.w):de.set(ne,ve,xe,We),st.scissor(j.copy(de).multiplyScalar(ae).round())},this.getScissorTest=function(){return ee},this.setScissorTest=function(ne){st.setScissorTest(ee=ne)},this.setOpaqueSort=function(ne){Ie=ne},this.setTransparentSort=function(ne){be=ne},this.getClearColor=function(ne){return ne.copy(Ve.getClearColor())},this.setClearColor=function(){Ve.setClearColor(...arguments)},this.getClearAlpha=function(){return Ve.getClearAlpha()},this.setClearAlpha=function(){Ve.setClearAlpha(...arguments)},this.clear=function(ne=!0,ve=!0,xe=!0){let We=0;if(ne){let Ze=!1;if(q!==null){const St=q.texture.format;Ze=B.has(St)}if(Ze){const St=q.texture.type,Xt=S.has(St),Yt=Ve.getClearColor(),xt=Ve.getClearAlpha(),Wt=Yt.r,qt=Yt.g,Et=Yt.b;Xt?(N[0]=Wt,N[1]=qt,N[2]=Et,N[3]=xt,se.clearBufferuiv(se.COLOR,0,N)):(R[0]=Wt,R[1]=qt,R[2]=Et,R[3]=xt,se.clearBufferiv(se.COLOR,0,R))}else We|=se.COLOR_BUFFER_BIT}ve&&(We|=se.DEPTH_BUFFER_BIT),xe&&(We|=se.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),se.clear(We)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ut,!1),t.removeEventListener("webglcontextrestored",Ot,!1),t.removeEventListener("webglcontextcreationerror",$t,!1),Ve.dispose(),Pe.dispose(),je.dispose(),z.dispose(),Oe.dispose(),He.dispose(),ft.dispose(),Kt.dispose(),gt.dispose(),Ht.dispose(),vt.dispose(),vt.removeEventListener("sessionstart",Zt),vt.removeEventListener("sessionend",Mt),Gt.stop()};function Ut(ne){ne.preventDefault(),dm("WebGLRenderer: Context Lost."),E=!0}function Ot(){dm("WebGLRenderer: Context Restored."),E=!1;const ne=ie.autoReset,ve=he.enabled,xe=he.autoUpdate,We=he.needsUpdate,Ze=he.type;qe(),ie.autoReset=ne,he.enabled=ve,he.autoUpdate=xe,he.needsUpdate=We,he.type=Ze}function $t(ne){Cn("WebGLRenderer: A WebGL context could not be created. Reason: ",ne.statusMessage)}function Rn(ne){const ve=ne.target;ve.removeEventListener("dispose",Rn),Kn(ve)}function Kn(ne){Ci(ne),z.remove(ne)}function Ci(ne){const ve=z.get(ne).programs;ve!==void 0&&(ve.forEach(function(xe){Ht.releaseProgram(xe)}),ne.isShaderMaterial&&Ht.releaseShaderCache(ne))}this.renderBufferDirect=function(ne,ve,xe,We,Ze,St){ve===null&&(ve=Qe);const Xt=Ze.isMesh&&Ze.matrixWorld.determinant()<0,Yt=wt(ne,ve,xe,We,Ze);st.setMaterial(We,Xt);let xt=xe.index,Wt=1;if(We.wireframe===!0){if(xt=It.getWireframeAttribute(xe),xt===void 0)return;Wt=2}const qt=xe.drawRange,Et=xe.attributes.position;let Tt=qt.start*Wt,fn=(qt.start+qt.count)*Wt;St!==null&&(Tt=Math.max(Tt,St.start*Wt),fn=Math.min(fn,(St.start+St.count)*Wt)),xt!==null?(Tt=Math.max(Tt,0),fn=Math.min(fn,xt.count)):Et!=null&&(Tt=Math.max(Tt,0),fn=Math.min(fn,Et.count));const Tn=fn-Tt;if(Tn<0||Tn===1/0)return;Kt.setup(Ze,We,Yt,xe,xt);let yn,sn=ye;if(xt!==null&&(yn=Me.get(xt),sn=Re,sn.setIndex(yn)),Ze.isMesh)We.wireframe===!0?(st.setLineWidth(We.wireframeLinewidth*dt()),sn.setMode(se.LINES)):sn.setMode(se.TRIANGLES);else if(Ze.isLine){let Jt=We.linewidth;Jt===void 0&&(Jt=1),st.setLineWidth(Jt*dt()),Ze.isLineSegments?sn.setMode(se.LINES):Ze.isLineLoop?sn.setMode(se.LINE_LOOP):sn.setMode(se.LINE_STRIP)}else Ze.isPoints?sn.setMode(se.POINTS):Ze.isSprite&&sn.setMode(se.TRIANGLES);if(Ze.isBatchedMesh)if(Ze._multiDrawInstances!==null)pC("WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),sn.renderMultiDrawInstances(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount,Ze._multiDrawInstances);else if(it.get("WEBGL_multi_draw"))sn.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else{const Jt=Ze._multiDrawStarts,rn=Ze._multiDrawCounts,jt=Ze._multiDrawCount,ni=xt?Me.get(xt).bytesPerElement:1,Ei=z.get(We).currentProgram.getUniforms();for(let zn=0;zn<jt;zn++)Ei.setValue(se,"_gl_DrawID",zn),sn.render(Jt[zn]/ni,rn[zn])}else if(Ze.isInstancedMesh)sn.renderInstances(Tt,Tn,Ze.count);else if(xe.isInstancedBufferGeometry){const Jt=xe._maxInstanceCount!==void 0?xe._maxInstanceCount:1/0,rn=Math.min(xe.instanceCount,Jt);sn.renderInstances(Tt,Tn,rn)}else sn.render(Tt,Tn)};function Ge(ne,ve,xe){ne.transparent===!0&&ne.side===po&&ne.forceSinglePass===!1?(ne.side=Ss,ne.needsUpdate=!0,Ne(ne,ve,xe),ne.side=wc,ne.needsUpdate=!0,Ne(ne,ve,xe),ne.side=po):Ne(ne,ve,xe)}this.compile=function(ne,ve,xe=null){xe===null&&(xe=ne),V=je.get(xe),V.init(ve),X.push(V),xe.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(ve.layers)&&(V.pushLight(Ze),Ze.castShadow&&V.pushShadow(Ze))}),ne!==xe&&ne.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(ve.layers)&&(V.pushLight(Ze),Ze.castShadow&&V.pushShadow(Ze))}),V.setupLights();const We=new Set;return ne.traverse(function(Ze){if(!(Ze.isMesh||Ze.isPoints||Ze.isLine||Ze.isSprite))return;const St=Ze.material;if(St)if(Array.isArray(St))for(let Xt=0;Xt<St.length;Xt++){const Yt=St[Xt];Ge(Yt,xe,Ze),We.add(Yt)}else Ge(St,xe,Ze),We.add(St)}),V=X.pop(),We},this.compileAsync=function(ne,ve,xe=null){const We=this.compile(ne,ve,xe);return new Promise(Ze=>{function St(){if(We.forEach(function(Xt){z.get(Xt).currentProgram.isReady()&&We.delete(Xt)}),We.size===0){Ze(ne);return}setTimeout(St,10)}it.get("KHR_parallel_shader_compile")!==null?St():setTimeout(St,10)})};let Xe=null;function Je(ne){Xe&&Xe(ne)}function Zt(){Gt.stop()}function Mt(){Gt.start()}const Gt=new o3;Gt.setAnimationLoop(Je),typeof self<"u"&&Gt.setContext(self),this.setAnimationLoop=function(ne){Xe=ne,vt.setAnimationLoop(ne),ne===null?Gt.stop():Gt.start()},vt.addEventListener("sessionstart",Zt),vt.addEventListener("sessionend",Mt),this.render=function(ne,ve){if(ve!==void 0&&ve.isCamera!==!0){Cn("WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(E===!0)return;const xe=vt.enabled===!0&&vt.isPresenting===!0,We=Y!==null&&(q===null||xe)&&Y.begin(M,q);if(ne.matrixWorldAutoUpdate===!0&&ne.updateMatrixWorld(),ve.parent===null&&ve.matrixWorldAutoUpdate===!0&&ve.updateMatrixWorld(),vt.enabled===!0&&vt.isPresenting===!0&&(Y===null||Y.isCompositing()===!1)&&(vt.cameraAutoUpdate===!0&&vt.updateCamera(ve),ve=vt.getCamera()),ne.isScene===!0&&ne.onBeforeRender(M,ne,ve,q),V=je.get(ne,X.length),V.init(ve),X.push(V),Ee.multiplyMatrices(ve.projectionMatrix,ve.matrixWorldInverse),Ce.setFromProjectionMatrix(Ee,Ir,ve.reversedDepth),Ye=this.localClippingEnabled,we=ot.init(this.clippingPlanes,Ye),w=Pe.get(ne,H.length),w.init(),H.push(w),vt.enabled===!0&&vt.isPresenting===!0){const Xt=M.xr.getDepthSensingMesh();Xt!==null&&Ft(Xt,ve,-1/0,M.sortObjects)}Ft(ne,ve,0,M.sortObjects),w.finish(),M.sortObjects===!0&&w.sort(Ie,be),Le=vt.enabled===!1||vt.isPresenting===!1||vt.hasDepthSensing()===!1,Le&&Ve.addToRenderList(w,ne),this.info.render.frame++,we===!0&&ot.beginShadows();const Ze=V.state.shadowsArray;if(he.render(Ze,ne,ve),we===!0&&ot.endShadows(),this.info.autoReset===!0&&this.info.reset(),(We&&Y.hasRenderPass())===!1){const Xt=w.opaque,Yt=w.transmissive;if(V.setupLights(),ve.isArrayCamera){const xt=ve.cameras;if(Yt.length>0)for(let Wt=0,qt=xt.length;Wt<qt;Wt++){const Et=xt[Wt];U(Xt,Yt,ne,Et)}Le&&Ve.render(ne);for(let Wt=0,qt=xt.length;Wt<qt;Wt++){const Et=xt[Wt];Vt(w,ne,Et,Et.viewport)}}else Yt.length>0&&U(Xt,Yt,ne,ve),Le&&Ve.render(ne),Vt(w,ne,ve)}q!==null&&P===0&&(Ae.updateMultisampleRenderTarget(q),Ae.updateRenderTargetMipmap(q)),We&&Y.end(M),ne.isScene===!0&&ne.onAfterRender(M,ne,ve),Kt.resetDefaultState(),k=-1,le=null,X.pop(),X.length>0?(V=X[X.length-1],we===!0&&ot.setGlobalState(M.clippingPlanes,V.state.camera)):V=null,H.pop(),H.length>0?w=H[H.length-1]:w=null};function Ft(ne,ve,xe,We){if(ne.visible===!1)return;if(ne.layers.test(ve.layers)){if(ne.isGroup)xe=ne.renderOrder;else if(ne.isLOD)ne.autoUpdate===!0&&ne.update(ve);else if(ne.isLight)V.pushLight(ne),ne.castShadow&&V.pushShadow(ne);else if(ne.isSprite){if(!ne.frustumCulled||Ce.intersectsSprite(ne)){We&&Ke.setFromMatrixPosition(ne.matrixWorld).applyMatrix4(Ee);const Xt=ft.update(ne),Yt=ne.material;Yt.visible&&w.push(ne,Xt,Yt,xe,Ke.z,null)}}else if((ne.isMesh||ne.isLine||ne.isPoints)&&(!ne.frustumCulled||Ce.intersectsObject(ne))){const Xt=ft.update(ne),Yt=ne.material;if(We&&(ne.boundingSphere!==void 0?(ne.boundingSphere===null&&ne.computeBoundingSphere(),Ke.copy(ne.boundingSphere.center)):(Xt.boundingSphere===null&&Xt.computeBoundingSphere(),Ke.copy(Xt.boundingSphere.center)),Ke.applyMatrix4(ne.matrixWorld).applyMatrix4(Ee)),Array.isArray(Yt)){const xt=Xt.groups;for(let Wt=0,qt=xt.length;Wt<qt;Wt++){const Et=xt[Wt],Tt=Yt[Et.materialIndex];Tt&&Tt.visible&&w.push(ne,Xt,Tt,xe,Ke.z,Et)}}else Yt.visible&&w.push(ne,Xt,Yt,xe,Ke.z,null)}}const St=ne.children;for(let Xt=0,Yt=St.length;Xt<Yt;Xt++)Ft(St[Xt],ve,xe,We)}function Vt(ne,ve,xe,We){const{opaque:Ze,transmissive:St,transparent:Xt}=ne;V.setupLightsView(xe),we===!0&&ot.setGlobalState(M.clippingPlanes,xe),We&&st.viewport(F.copy(We)),Ze.length>0&&te(Ze,ve,xe),St.length>0&&te(St,ve,xe),Xt.length>0&&te(Xt,ve,xe),st.buffers.depth.setTest(!0),st.buffers.depth.setMask(!0),st.buffers.color.setMask(!0),st.setPolygonOffset(!1)}function U(ne,ve,xe,We){if((xe.isScene===!0?xe.overrideMaterial:null)!==null)return;if(V.state.transmissionRenderTarget[We.id]===void 0){const Tt=it.has("EXT_color_buffer_half_float")||it.has("EXT_color_buffer_float");V.state.transmissionRenderTarget[We.id]=new yo(1,1,{generateMipmaps:!0,type:Tt?Aa:os,minFilter:Gc,samples:Fe.samples,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:ei.workingColorSpace})}const St=V.state.transmissionRenderTarget[We.id],Xt=We.viewport||F;St.setSize(Xt.z*M.transmissionResolutionScale,Xt.w*M.transmissionResolutionScale);const Yt=M.getRenderTarget(),xt=M.getActiveCubeFace(),Wt=M.getActiveMipmapLevel();M.setRenderTarget(St),M.getClearColor(ce),oe=M.getClearAlpha(),oe<1&&M.setClearColor(16777215,.5),M.clear(),Le&&Ve.render(xe);const qt=M.toneMapping;M.toneMapping=zr;const Et=We.viewport;if(We.viewport!==void 0&&(We.viewport=void 0),V.setupLightsView(We),we===!0&&ot.setGlobalState(M.clippingPlanes,We),te(ne,xe,We),Ae.updateMultisampleRenderTarget(St),Ae.updateRenderTargetMipmap(St),it.has("WEBGL_multisampled_render_to_texture")===!1){let Tt=!1;for(let fn=0,Tn=ve.length;fn<Tn;fn++){const yn=ve[fn],{object:sn,geometry:Jt,material:rn,group:jt}=yn;if(rn.side===po&&sn.layers.test(We.layers)){const ni=rn.side;rn.side=Ss,rn.needsUpdate=!0,pe(sn,xe,We,Jt,rn,jt),rn.side=ni,rn.needsUpdate=!0,Tt=!0}}Tt===!0&&(Ae.updateMultisampleRenderTarget(St),Ae.updateRenderTargetMipmap(St))}M.setRenderTarget(Yt,xt,Wt),M.setClearColor(ce,oe),Et!==void 0&&(We.viewport=Et),M.toneMapping=qt}function te(ne,ve,xe){const We=ve.isScene===!0?ve.overrideMaterial:null;for(let Ze=0,St=ne.length;Ze<St;Ze++){const Xt=ne[Ze],{object:Yt,geometry:xt,group:Wt}=Xt;let qt=Xt.material;qt.allowOverride===!0&&We!==null&&(qt=We),Yt.layers.test(xe.layers)&&pe(Yt,ve,xe,xt,qt,Wt)}}function pe(ne,ve,xe,We,Ze,St){ne.onBeforeRender(M,ve,xe,We,Ze,St),ne.modelViewMatrix.multiplyMatrices(xe.matrixWorldInverse,ne.matrixWorld),ne.normalMatrix.getNormalMatrix(ne.modelViewMatrix),Ze.onBeforeRender(M,ve,xe,We,ne,St),Ze.transparent===!0&&Ze.side===po&&Ze.forceSinglePass===!1?(Ze.side=Ss,Ze.needsUpdate=!0,M.renderBufferDirect(xe,ve,We,Ze,ne,St),Ze.side=wc,Ze.needsUpdate=!0,M.renderBufferDirect(xe,ve,We,Ze,ne,St),Ze.side=po):M.renderBufferDirect(xe,ve,We,Ze,ne,St),ne.onAfterRender(M,ve,xe,We,Ze,St)}function Ne(ne,ve,xe){ve.isScene!==!0&&(ve=Qe);const We=z.get(ne),Ze=V.state.lights,St=V.state.shadowsArray,Xt=Ze.state.version,Yt=Ht.getParameters(ne,Ze.state,St,ve,xe),xt=Ht.getProgramCacheKey(Yt);let Wt=We.programs;We.environment=ne.isMeshStandardMaterial?ve.environment:null,We.fog=ve.fog,We.envMap=(ne.isMeshStandardMaterial?He:Oe).get(ne.envMap||We.environment),We.envMapRotation=We.environment!==null&&ne.envMap===null?ve.environmentRotation:ne.envMapRotation,Wt===void 0&&(ne.addEventListener("dispose",Rn),Wt=new Map,We.programs=Wt);let qt=Wt.get(xt);if(qt!==void 0){if(We.currentProgram===qt&&We.lightsStateVersion===Xt)return ke(ne,Yt),qt}else Yt.uniforms=Ht.getUniforms(ne),ne.onBeforeCompile(Yt,M),qt=Ht.acquireProgram(Yt,xt),Wt.set(xt,qt),We.uniforms=Yt.uniforms;const Et=We.uniforms;return(!ne.isShaderMaterial&&!ne.isRawShaderMaterial||ne.clipping===!0)&&(Et.clippingPlanes=ot.uniform),ke(ne,Yt),We.needsLights=bt(ne),We.lightsStateVersion=Xt,We.needsLights&&(Et.ambientLightColor.value=Ze.state.ambient,Et.lightProbe.value=Ze.state.probe,Et.directionalLights.value=Ze.state.directional,Et.directionalLightShadows.value=Ze.state.directionalShadow,Et.spotLights.value=Ze.state.spot,Et.spotLightShadows.value=Ze.state.spotShadow,Et.rectAreaLights.value=Ze.state.rectArea,Et.ltc_1.value=Ze.state.rectAreaLTC1,Et.ltc_2.value=Ze.state.rectAreaLTC2,Et.pointLights.value=Ze.state.point,Et.pointLightShadows.value=Ze.state.pointShadow,Et.hemisphereLights.value=Ze.state.hemi,Et.directionalShadowMap.value=Ze.state.directionalShadowMap,Et.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Et.spotShadowMap.value=Ze.state.spotShadowMap,Et.spotLightMatrix.value=Ze.state.spotLightMatrix,Et.spotLightMap.value=Ze.state.spotLightMap,Et.pointShadowMap.value=Ze.state.pointShadowMap,Et.pointShadowMatrix.value=Ze.state.pointShadowMatrix),We.currentProgram=qt,We.uniformsList=null,qt}function De(ne){if(ne.uniformsList===null){const ve=ne.currentProgram.getUniforms();ne.uniformsList=p0.seqWithValue(ve.seq,ne.uniforms)}return ne.uniformsList}function ke(ne,ve){const xe=z.get(ne);xe.outputColorSpace=ve.outputColorSpace,xe.batching=ve.batching,xe.batchingColor=ve.batchingColor,xe.instancing=ve.instancing,xe.instancingColor=ve.instancingColor,xe.instancingMorph=ve.instancingMorph,xe.skinning=ve.skinning,xe.morphTargets=ve.morphTargets,xe.morphNormals=ve.morphNormals,xe.morphColors=ve.morphColors,xe.morphTargetsCount=ve.morphTargetsCount,xe.numClippingPlanes=ve.numClippingPlanes,xe.numIntersection=ve.numClipIntersection,xe.vertexAlphas=ve.vertexAlphas,xe.vertexTangents=ve.vertexTangents,xe.toneMapping=ve.toneMapping}function wt(ne,ve,xe,We,Ze){ve.isScene!==!0&&(ve=Qe),Ae.resetTextureUnits();const St=ve.fog,Xt=We.isMeshStandardMaterial?ve.environment:null,Yt=q===null?M.outputColorSpace:q.isXRRenderTarget===!0?q.texture.colorSpace:Ml,xt=(We.isMeshStandardMaterial?He:Oe).get(We.envMap||Xt),Wt=We.vertexColors===!0&&!!xe.attributes.color&&xe.attributes.color.itemSize===4,qt=!!xe.attributes.tangent&&(!!We.normalMap||We.anisotropy>0),Et=!!xe.morphAttributes.position,Tt=!!xe.morphAttributes.normal,fn=!!xe.morphAttributes.color;let Tn=zr;We.toneMapped&&(q===null||q.isXRRenderTarget===!0)&&(Tn=M.toneMapping);const yn=xe.morphAttributes.position||xe.morphAttributes.normal||xe.morphAttributes.color,sn=yn!==void 0?yn.length:0,Jt=z.get(We),rn=V.state.lights;if(we===!0&&(Ye===!0||ne!==le)){const Fi=ne===le&&We.id===k;ot.setState(We,ne,Fi)}let jt=!1;We.version===Jt.__version?(Jt.needsLights&&Jt.lightsStateVersion!==rn.state.version||Jt.outputColorSpace!==Yt||Ze.isBatchedMesh&&Jt.batching===!1||!Ze.isBatchedMesh&&Jt.batching===!0||Ze.isBatchedMesh&&Jt.batchingColor===!0&&Ze.colorTexture===null||Ze.isBatchedMesh&&Jt.batchingColor===!1&&Ze.colorTexture!==null||Ze.isInstancedMesh&&Jt.instancing===!1||!Ze.isInstancedMesh&&Jt.instancing===!0||Ze.isSkinnedMesh&&Jt.skinning===!1||!Ze.isSkinnedMesh&&Jt.skinning===!0||Ze.isInstancedMesh&&Jt.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&Jt.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&Jt.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&Jt.instancingMorph===!1&&Ze.morphTexture!==null||Jt.envMap!==xt||We.fog===!0&&Jt.fog!==St||Jt.numClippingPlanes!==void 0&&(Jt.numClippingPlanes!==ot.numPlanes||Jt.numIntersection!==ot.numIntersection)||Jt.vertexAlphas!==Wt||Jt.vertexTangents!==qt||Jt.morphTargets!==Et||Jt.morphNormals!==Tt||Jt.morphColors!==fn||Jt.toneMapping!==Tn||Jt.morphTargetsCount!==sn)&&(jt=!0):(jt=!0,Jt.__version=We.version);let ni=Jt.currentProgram;jt===!0&&(ni=Ne(We,ve,Ze));let Ei=!1,zn=!1,Xi=!1;const On=ni.getUniforms(),yi=Jt.uniforms;if(st.useProgram(ni.program)&&(Ei=!0,zn=!0,Xi=!0),We.id!==k&&(k=We.id,zn=!0),Ei||le!==ne){st.buffers.depth.getReversed()&&ne.reversedDepth!==!0&&(ne._reversedDepth=!0,ne.updateProjectionMatrix()),On.setValue(se,"projectionMatrix",ne.projectionMatrix),On.setValue(se,"viewMatrix",ne.matrixWorldInverse);const Ki=On.map.cameraPosition;Ki!==void 0&&Ki.setValue(se,pt.setFromMatrixPosition(ne.matrixWorld)),Fe.logarithmicDepthBuffer&&On.setValue(se,"logDepthBufFC",2/(Math.log(ne.far+1)/Math.LN2)),(We.isMeshPhongMaterial||We.isMeshToonMaterial||We.isMeshLambertMaterial||We.isMeshBasicMaterial||We.isMeshStandardMaterial||We.isShaderMaterial)&&On.setValue(se,"isOrthographic",ne.isOrthographicCamera===!0),le!==ne&&(le=ne,zn=!0,Xi=!0)}if(Jt.needsLights&&(rn.state.directionalShadowMap.length>0&&On.setValue(se,"directionalShadowMap",rn.state.directionalShadowMap,Ae),rn.state.spotShadowMap.length>0&&On.setValue(se,"spotShadowMap",rn.state.spotShadowMap,Ae),rn.state.pointShadowMap.length>0&&On.setValue(se,"pointShadowMap",rn.state.pointShadowMap,Ae)),Ze.isSkinnedMesh){On.setOptional(se,Ze,"bindMatrix"),On.setOptional(se,Ze,"bindMatrixInverse");const Fi=Ze.skeleton;Fi&&(Fi.boneTexture===null&&Fi.computeBoneTexture(),On.setValue(se,"boneTexture",Fi.boneTexture,Ae))}Ze.isBatchedMesh&&(On.setOptional(se,Ze,"batchingTexture"),On.setValue(se,"batchingTexture",Ze._matricesTexture,Ae),On.setOptional(se,Ze,"batchingIdTexture"),On.setValue(se,"batchingIdTexture",Ze._indirectTexture,Ae),On.setOptional(se,Ze,"batchingColorTexture"),Ze._colorsTexture!==null&&On.setValue(se,"batchingColorTexture",Ze._colorsTexture,Ae));const Yi=xe.morphAttributes;if((Yi.position!==void 0||Yi.normal!==void 0||Yi.color!==void 0)&&Ct.update(Ze,xe,ni),(zn||Jt.receiveShadow!==Ze.receiveShadow)&&(Jt.receiveShadow=Ze.receiveShadow,On.setValue(se,"receiveShadow",Ze.receiveShadow)),We.isMeshGouraudMaterial&&We.envMap!==null&&(yi.envMap.value=xt,yi.flipEnvMap.value=xt.isCubeTexture&&xt.isRenderTargetTexture===!1?-1:1),We.isMeshStandardMaterial&&We.envMap===null&&ve.environment!==null&&(yi.envMapIntensity.value=ve.environmentIntensity),yi.dfgLUT!==void 0&&(yi.dfgLUT.value=HD()),zn&&(On.setValue(se,"toneMappingExposure",M.toneMappingExposure),Jt.needsLights&&At(yi,Xi),St&&We.fog===!0&&kt.refreshFogUniforms(yi,St),kt.refreshMaterialUniforms(yi,We,ae,$,V.state.transmissionRenderTarget[ne.id]),p0.upload(se,De(Jt),yi,Ae)),We.isShaderMaterial&&We.uniformsNeedUpdate===!0&&(p0.upload(se,De(Jt),yi,Ae),We.uniformsNeedUpdate=!1),We.isSpriteMaterial&&On.setValue(se,"center",Ze.center),On.setValue(se,"modelViewMatrix",Ze.modelViewMatrix),On.setValue(se,"normalMatrix",Ze.normalMatrix),On.setValue(se,"modelMatrix",Ze.matrixWorld),We.isShaderMaterial||We.isRawShaderMaterial){const Fi=We.uniformsGroups;for(let Ki=0,ko=Fi.length;Ki<ko;Ki++){const fa=Fi[Ki];gt.update(fa,ni),gt.bind(fa,ni)}}return ni}function At(ne,ve){ne.ambientLightColor.needsUpdate=ve,ne.lightProbe.needsUpdate=ve,ne.directionalLights.needsUpdate=ve,ne.directionalLightShadows.needsUpdate=ve,ne.pointLights.needsUpdate=ve,ne.pointLightShadows.needsUpdate=ve,ne.spotLights.needsUpdate=ve,ne.spotLightShadows.needsUpdate=ve,ne.rectAreaLights.needsUpdate=ve,ne.hemisphereLights.needsUpdate=ve}function bt(ne){return ne.isMeshLambertMaterial||ne.isMeshToonMaterial||ne.isMeshPhongMaterial||ne.isMeshStandardMaterial||ne.isShadowMaterial||ne.isShaderMaterial&&ne.lights===!0}this.getActiveCubeFace=function(){return O},this.getActiveMipmapLevel=function(){return P},this.getRenderTarget=function(){return q},this.setRenderTargetTextures=function(ne,ve,xe){const We=z.get(ne);We.__autoAllocateDepthBuffer=ne.resolveDepthBuffer===!1,We.__autoAllocateDepthBuffer===!1&&(We.__useRenderToTexture=!1),z.get(ne.texture).__webglTexture=ve,z.get(ne.depthTexture).__webglTexture=We.__autoAllocateDepthBuffer?void 0:xe,We.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(ne,ve){const xe=z.get(ne);xe.__webglFramebuffer=ve,xe.__useDefaultFramebuffer=ve===void 0};const ct=se.createFramebuffer();this.setRenderTarget=function(ne,ve=0,xe=0){q=ne,O=ve,P=xe;let We=null,Ze=!1,St=!1;if(ne){const Yt=z.get(ne);if(Yt.__useDefaultFramebuffer!==void 0){st.bindFramebuffer(se.FRAMEBUFFER,Yt.__webglFramebuffer),F.copy(ne.viewport),j.copy(ne.scissor),Q=ne.scissorTest,st.viewport(F),st.scissor(j),st.setScissorTest(Q),k=-1;return}else if(Yt.__webglFramebuffer===void 0)Ae.setupRenderTarget(ne);else if(Yt.__hasExternalTextures)Ae.rebindTextures(ne,z.get(ne.texture).__webglTexture,z.get(ne.depthTexture).__webglTexture);else if(ne.depthBuffer){const qt=ne.depthTexture;if(Yt.__boundDepthTexture!==qt){if(qt!==null&&z.has(qt)&&(ne.width!==qt.image.width||ne.height!==qt.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");Ae.setupDepthRenderbuffer(ne)}}const xt=ne.texture;(xt.isData3DTexture||xt.isDataArrayTexture||xt.isCompressedArrayTexture)&&(St=!0);const Wt=z.get(ne).__webglFramebuffer;ne.isWebGLCubeRenderTarget?(Array.isArray(Wt[ve])?We=Wt[ve][xe]:We=Wt[ve],Ze=!0):ne.samples>0&&Ae.useMultisampledRTT(ne)===!1?We=z.get(ne).__webglMultisampledFramebuffer:Array.isArray(Wt)?We=Wt[xe]:We=Wt,F.copy(ne.viewport),j.copy(ne.scissor),Q=ne.scissorTest}else F.copy(D).multiplyScalar(ae).floor(),j.copy(de).multiplyScalar(ae).floor(),Q=ee;if(xe!==0&&(We=ct),st.bindFramebuffer(se.FRAMEBUFFER,We)&&st.drawBuffers(ne,We),st.viewport(F),st.scissor(j),st.setScissorTest(Q),Ze){const Yt=z.get(ne.texture);se.framebufferTexture2D(se.FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_CUBE_MAP_POSITIVE_X+ve,Yt.__webglTexture,xe)}else if(St){const Yt=ve;for(let xt=0;xt<ne.textures.length;xt++){const Wt=z.get(ne.textures[xt]);se.framebufferTextureLayer(se.FRAMEBUFFER,se.COLOR_ATTACHMENT0+xt,Wt.__webglTexture,xe,Yt)}}else if(ne!==null&&xe!==0){const Yt=z.get(ne.texture);se.framebufferTexture2D(se.FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_2D,Yt.__webglTexture,xe)}k=-1},this.readRenderTargetPixels=function(ne,ve,xe,We,Ze,St,Xt,Yt=0){if(!(ne&&ne.isWebGLRenderTarget)){Cn("WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let xt=z.get(ne).__webglFramebuffer;if(ne.isWebGLCubeRenderTarget&&Xt!==void 0&&(xt=xt[Xt]),xt){st.bindFramebuffer(se.FRAMEBUFFER,xt);try{const Wt=ne.textures[Yt],qt=Wt.format,Et=Wt.type;if(!Fe.textureFormatReadable(qt)){Cn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Fe.textureTypeReadable(Et)){Cn("WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}ve>=0&&ve<=ne.width-We&&xe>=0&&xe<=ne.height-Ze&&(ne.textures.length>1&&se.readBuffer(se.COLOR_ATTACHMENT0+Yt),se.readPixels(ve,xe,We,Ze,lt.convert(qt),lt.convert(Et),St))}finally{const Wt=q!==null?z.get(q).__webglFramebuffer:null;st.bindFramebuffer(se.FRAMEBUFFER,Wt)}}},this.readRenderTargetPixelsAsync=async function(ne,ve,xe,We,Ze,St,Xt,Yt=0){if(!(ne&&ne.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let xt=z.get(ne).__webglFramebuffer;if(ne.isWebGLCubeRenderTarget&&Xt!==void 0&&(xt=xt[Xt]),xt)if(ve>=0&&ve<=ne.width-We&&xe>=0&&xe<=ne.height-Ze){st.bindFramebuffer(se.FRAMEBUFFER,xt);const Wt=ne.textures[Yt],qt=Wt.format,Et=Wt.type;if(!Fe.textureFormatReadable(qt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Fe.textureTypeReadable(Et))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Tt=se.createBuffer();se.bindBuffer(se.PIXEL_PACK_BUFFER,Tt),se.bufferData(se.PIXEL_PACK_BUFFER,St.byteLength,se.STREAM_READ),ne.textures.length>1&&se.readBuffer(se.COLOR_ATTACHMENT0+Yt),se.readPixels(ve,xe,We,Ze,lt.convert(qt),lt.convert(Et),0);const fn=q!==null?z.get(q).__webglFramebuffer:null;st.bindFramebuffer(se.FRAMEBUFFER,fn);const Tn=se.fenceSync(se.SYNC_GPU_COMMANDS_COMPLETE,0);return se.flush(),await $9(se,Tn,4),se.bindBuffer(se.PIXEL_PACK_BUFFER,Tt),se.getBufferSubData(se.PIXEL_PACK_BUFFER,0,St),se.deleteBuffer(Tt),se.deleteSync(Tn),St}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(ne,ve=null,xe=0){const We=Math.pow(2,-xe),Ze=Math.floor(ne.image.width*We),St=Math.floor(ne.image.height*We),Xt=ve!==null?ve.x:0,Yt=ve!==null?ve.y:0;Ae.setTexture2D(ne,0),se.copyTexSubImage2D(se.TEXTURE_2D,xe,0,0,Xt,Yt,Ze,St),st.unbindTexture()};const _t=se.createFramebuffer(),$e=se.createFramebuffer();this.copyTextureToTexture=function(ne,ve,xe=null,We=null,Ze=0,St=null){St===null&&(Ze!==0?(pC("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),St=Ze,Ze=0):St=0);let Xt,Yt,xt,Wt,qt,Et,Tt,fn,Tn;const yn=ne.isCompressedTexture?ne.mipmaps[St]:ne.image;if(xe!==null)Xt=xe.max.x-xe.min.x,Yt=xe.max.y-xe.min.y,xt=xe.isBox3?xe.max.z-xe.min.z:1,Wt=xe.min.x,qt=xe.min.y,Et=xe.isBox3?xe.min.z:0;else{const Yi=Math.pow(2,-Ze);Xt=Math.floor(yn.width*Yi),Yt=Math.floor(yn.height*Yi),ne.isDataArrayTexture?xt=yn.depth:ne.isData3DTexture?xt=Math.floor(yn.depth*Yi):xt=1,Wt=0,qt=0,Et=0}We!==null?(Tt=We.x,fn=We.y,Tn=We.z):(Tt=0,fn=0,Tn=0);const sn=lt.convert(ve.format),Jt=lt.convert(ve.type);let rn;ve.isData3DTexture?(Ae.setTexture3D(ve,0),rn=se.TEXTURE_3D):ve.isDataArrayTexture||ve.isCompressedArrayTexture?(Ae.setTexture2DArray(ve,0),rn=se.TEXTURE_2D_ARRAY):(Ae.setTexture2D(ve,0),rn=se.TEXTURE_2D),se.pixelStorei(se.UNPACK_FLIP_Y_WEBGL,ve.flipY),se.pixelStorei(se.UNPACK_PREMULTIPLY_ALPHA_WEBGL,ve.premultiplyAlpha),se.pixelStorei(se.UNPACK_ALIGNMENT,ve.unpackAlignment);const jt=se.getParameter(se.UNPACK_ROW_LENGTH),ni=se.getParameter(se.UNPACK_IMAGE_HEIGHT),Ei=se.getParameter(se.UNPACK_SKIP_PIXELS),zn=se.getParameter(se.UNPACK_SKIP_ROWS),Xi=se.getParameter(se.UNPACK_SKIP_IMAGES);se.pixelStorei(se.UNPACK_ROW_LENGTH,yn.width),se.pixelStorei(se.UNPACK_IMAGE_HEIGHT,yn.height),se.pixelStorei(se.UNPACK_SKIP_PIXELS,Wt),se.pixelStorei(se.UNPACK_SKIP_ROWS,qt),se.pixelStorei(se.UNPACK_SKIP_IMAGES,Et);const On=ne.isDataArrayTexture||ne.isData3DTexture,yi=ve.isDataArrayTexture||ve.isData3DTexture;if(ne.isDepthTexture){const Yi=z.get(ne),Fi=z.get(ve),Ki=z.get(Yi.__renderTarget),ko=z.get(Fi.__renderTarget);st.bindFramebuffer(se.READ_FRAMEBUFFER,Ki.__webglFramebuffer),st.bindFramebuffer(se.DRAW_FRAMEBUFFER,ko.__webglFramebuffer);for(let fa=0;fa<xt;fa++)On&&(se.framebufferTextureLayer(se.READ_FRAMEBUFFER,se.COLOR_ATTACHMENT0,z.get(ne).__webglTexture,Ze,Et+fa),se.framebufferTextureLayer(se.DRAW_FRAMEBUFFER,se.COLOR_ATTACHMENT0,z.get(ve).__webglTexture,St,Tn+fa)),se.blitFramebuffer(Wt,qt,Xt,Yt,Tt,fn,Xt,Yt,se.DEPTH_BUFFER_BIT,se.NEAREST);st.bindFramebuffer(se.READ_FRAMEBUFFER,null),st.bindFramebuffer(se.DRAW_FRAMEBUFFER,null)}else if(Ze!==0||ne.isRenderTargetTexture||z.has(ne)){const Yi=z.get(ne),Fi=z.get(ve);st.bindFramebuffer(se.READ_FRAMEBUFFER,_t),st.bindFramebuffer(se.DRAW_FRAMEBUFFER,$e);for(let Ki=0;Ki<xt;Ki++)On?se.framebufferTextureLayer(se.READ_FRAMEBUFFER,se.COLOR_ATTACHMENT0,Yi.__webglTexture,Ze,Et+Ki):se.framebufferTexture2D(se.READ_FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_2D,Yi.__webglTexture,Ze),yi?se.framebufferTextureLayer(se.DRAW_FRAMEBUFFER,se.COLOR_ATTACHMENT0,Fi.__webglTexture,St,Tn+Ki):se.framebufferTexture2D(se.DRAW_FRAMEBUFFER,se.COLOR_ATTACHMENT0,se.TEXTURE_2D,Fi.__webglTexture,St),Ze!==0?se.blitFramebuffer(Wt,qt,Xt,Yt,Tt,fn,Xt,Yt,se.COLOR_BUFFER_BIT,se.NEAREST):yi?se.copyTexSubImage3D(rn,St,Tt,fn,Tn+Ki,Wt,qt,Xt,Yt):se.copyTexSubImage2D(rn,St,Tt,fn,Wt,qt,Xt,Yt);st.bindFramebuffer(se.READ_FRAMEBUFFER,null),st.bindFramebuffer(se.DRAW_FRAMEBUFFER,null)}else yi?ne.isDataTexture||ne.isData3DTexture?se.texSubImage3D(rn,St,Tt,fn,Tn,Xt,Yt,xt,sn,Jt,yn.data):ve.isCompressedArrayTexture?se.compressedTexSubImage3D(rn,St,Tt,fn,Tn,Xt,Yt,xt,sn,yn.data):se.texSubImage3D(rn,St,Tt,fn,Tn,Xt,Yt,xt,sn,Jt,yn):ne.isDataTexture?se.texSubImage2D(se.TEXTURE_2D,St,Tt,fn,Xt,Yt,sn,Jt,yn.data):ne.isCompressedTexture?se.compressedTexSubImage2D(se.TEXTURE_2D,St,Tt,fn,yn.width,yn.height,sn,yn.data):se.texSubImage2D(se.TEXTURE_2D,St,Tt,fn,Xt,Yt,sn,Jt,yn);se.pixelStorei(se.UNPACK_ROW_LENGTH,jt),se.pixelStorei(se.UNPACK_IMAGE_HEIGHT,ni),se.pixelStorei(se.UNPACK_SKIP_PIXELS,Ei),se.pixelStorei(se.UNPACK_SKIP_ROWS,zn),se.pixelStorei(se.UNPACK_SKIP_IMAGES,Xi),St===0&&ve.generateMipmaps&&se.generateMipmap(rn),st.unbindTexture()},this.initRenderTarget=function(ne){z.get(ne).__webglFramebuffer===void 0&&Ae.setupRenderTarget(ne)},this.initTexture=function(ne){ne.isCubeTexture?Ae.setTextureCube(ne,0):ne.isData3DTexture?Ae.setTexture3D(ne,0):ne.isDataArrayTexture||ne.isCompressedArrayTexture?Ae.setTexture2DArray(ne,0):Ae.setTexture2D(ne,0),st.unbindTexture()},this.resetState=function(){O=0,P=0,q=null,st.reset(),Kt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return Ir}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=ei._getDrawingBufferColorSpace(e),t.unpackColorSpace=ei._getUnpackColorSpace()}}const ED=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:Xy,AddEquation:wu,AddOperation:UW,AdditiveAnimationBlendMode:vS,AdditiveBlending:p2,AgXToneMapping:CS,AlphaFormat:bS,AlwaysCompare:aV,AlwaysDepth:W0,AlwaysStencilFunc:B2,AmbientLight:PV,AnimationAction:i3,AnimationClip:pm,AnimationLoader:TK,AnimationMixer:IT,AnimationObjectGroup:uT,AnimationUtils:HK,ArcCurve:GV,ArrayCamera:e3,ArrowHelper:YT,AttachedBindMode:v2,Audio:t3,AudioAnalyser:tT,AudioContext:OS,AudioListener:qK,AudioLoader:JK,AxesHelper:HT,BackSide:Ss,BasicDepthPacking:PW,BasicShadowMap:SW,BatchedMesh:mV,Bone:wS,BooleanKeyframeTrack:yI,Box2:yT,Box3:Za,Box3Helper:_T,BoxGeometry:bI,BoxHelper:MT,BufferAttribute:Zi,BufferGeometry:Mn,BufferGeometryLoader:$V,ByteType:Yy,Cache:Bc,Camera:Oy,CameraHelper:VT,CanvasTexture:oK,CapsuleGeometry:tv,CatmullRomCurve3:BV,CineonToneMapping:IS,CircleGeometry:nv,ClampToEdgeWrapping:Ca,Clock:jS,Color:tn,ColorKeyframeTrack:LS,ColorManagement:ei,CompressedArrayTexture:aK,CompressedCubeTexture:sK,CompressedTexture:ev,CompressedTextureLoader:zK,ConeGeometry:Ym,ConstantAlphaFactor:zW,ConstantColorFactor:KW,Controls:FT,CubeCamera:IV,CubeDepthTexture:vV,CubeReflectionMapping:Vl,CubeRefractionMapping:Xu,CubeTexture:Mm,CubeTextureLoader:UV,CubeUVReflectionMapping:wC,CubicBezierCurve:MS,CubicBezierCurve3:SV,CubicInterpolant:TV,CullFaceBack:m2,CullFaceFront:BW,CullFaceFrontBack:d9,CullFaceNone:GW,Curve:_l,CurvePath:ZV,CustomBlending:xW,CustomToneMapping:hS,CylinderGeometry:Xm,Cylindrical:bT,Data3DTexture:Dy,DataArrayTexture:Uy,DataTexture:Lr,DataTextureLoader:kS,DataUtils:sI,DecrementStencilOp:w9,DecrementWrapStencilOp:N9,DefaultLoadingManager:kV,DepthFormat:Rc,DepthStencilFormat:Nu,DepthTexture:GC,DetachedBindMode:DW,DirectionalLight:JV,DirectionalLightHelper:WT,DiscreteInterpolant:zV,DodecahedronGeometry:iv,DoubleSide:po,DstAlphaFactor:XW,DstColorFactor:HW,DynamicCopyUsage:k9,DynamicDrawUsage:sV,DynamicReadUsage:T9,EdgesGeometry:WS,EllipseCurve:av,EqualCompare:tV,EqualDepth:M0,EqualStencilFunc:_9,EquirectangularReflectionMapping:CC,EquirectangularRefractionMapping:am,Euler:vo,EventDispatcher:Nc,ExternalTexture:NS,ExtrudeGeometry:sv,FileLoader:Ar,Float16BufferAttribute:YF,Float32BufferAttribute:an,FloatType:$i,Fog:Py,FogExp2:Jy,FramebufferTexture:iK,FrontSide:wc,Frustum:RC,FrustumArray:$y,GLBufferAttribute:fT,GLSL1:D9,GLSL3:S2,GreaterCompare:nV,GreaterDepth:X0,GreaterEqualCompare:ky,GreaterEqualDepth:_0,GreaterEqualStencilFunc:E9,GreaterStencilFunc:Y9,GridHelper:RT,Group:rC,HalfFloatType:Aa,HemisphereLight:DV,HemisphereLightHelper:wT,IcosahedronGeometry:Hm,ImageBitmapLoader:jK,ImageLoader:bm,ImageUtils:gV,IncrementStencilOp:Z9,IncrementWrapStencilOp:R9,InstancedBufferAttribute:CI,InstancedBufferGeometry:mv,InstancedInterleavedBuffer:by,InstancedMesh:dC,Int16BufferAttribute:_F,Int32BufferAttribute:XF,Int8BufferAttribute:WF,IntType:Nm,InterleavedBuffer:Qy,InterleavedBufferAttribute:hr,Interpolant:Km,InterpolateDiscrete:rm,InterpolateLinear:Cy,InterpolateSmooth:f0,InterpolationSamplingMode:J9,InterpolationSamplingType:j9,InvertStencilOp:W9,KeepStencilOp:jd,KeyframeTrack:Dr,LOD:AV,LatheGeometry:ov,Layers:yC,LessCompare:eV,LessDepth:V0,LessEqualCompare:Ly,LessEqualDepth:II,LessEqualStencilFunc:X9,LessStencilFunc:M9,Light:zu,LightProbe:qV,Line:Hu,Line3:a3,LineBasicMaterial:Go,LineCurve:_S,LineCurve3:xV,LineDashedMaterial:FV,LineLoop:pV,LineSegments:Vc,LinearFilter:Pn,LinearInterpolant:zS,LinearMipMapLinearFilter:G2,LinearMipMapNearestFilter:C9,LinearMipmapLinearFilter:Gc,LinearMipmapNearestFilter:Hf,LinearSRGBColorSpace:Ml,LinearToneMapping:uS,LinearTransfer:cm,Loader:Bo,LoaderUtils:N2,LoadingManager:Cv,LoopOnce:OW,LoopPingPong:JW,LoopRepeat:jW,MOUSE:Dd,Material:Os,MaterialLoader:fv,MathUtils:cV,Matrix2:$S,Matrix3:Vn,Matrix4:pn,MaxEquation:NW,Mesh:_i,MeshBasicMaterial:Wc,MeshDepthMaterial:Iv,MeshDistanceMaterial:hv,MeshLambertMaterial:HV,MeshMatcapMaterial:EV,MeshNormalMaterial:YV,MeshPhongMaterial:_V,MeshPhysicalMaterial:MV,MeshStandardMaterial:KS,MeshToonMaterial:XV,MinEquation:RW,MirroredRepeatWrapping:om,MixOperation:kW,MultiplyBlending:y2,MultiplyOperation:Rm,NearestFilter:Ba,NearestMipMapLinearFilter:h9,NearestMipMapNearestFilter:I9,NearestMipmapLinearFilter:sC,NearestMipmapNearestFilter:fS,NeutralToneMapping:AS,NeverCompare:$W,NeverDepth:N0,NeverStencilFunc:V9,NoBlending:Wl,NoColorSpace:vg,NoNormalPacking:v9,NoToneMapping:zr,NormalAnimationBlendMode:zy,NormalBlending:lI,NormalGAPacking:B9,NormalRGPacking:G9,NotEqualCompare:iV,NotEqualDepth:Y0,NotEqualStencilFunc:H9,NumberKeyframeTrack:fm,Object3D:ti,ObjectLoader:DK,ObjectSpaceNormalMap:qW,OctahedronGeometry:Em,OneFactor:VW,OneMinusConstantAlphaFactor:LW,OneMinusConstantColorFactor:TW,OneMinusDstAlphaFactor:YW,OneMinusDstColorFactor:EW,OneMinusSrcAlphaFactor:R0,OneMinusSrcColorFactor:_W,OrthographicCamera:xc,PCFShadowMap:gC,PCFSoftShadowMap:Yf,PMREMGenerator:_2,Path:py,PerspectiveCamera:Ga,Plane:yg,PlaneGeometry:Xl,PlaneHelper:XT,PointLight:jV,PointLightHelper:xT,Points:bV,PointsMaterial:RS,PolarGridHelper:NT,PolyhedronGeometry:Tu,PositionalAudio:eT,PropertyBinding:ci,PropertyMixer:n3,QuadraticBezierCurve:XS,QuadraticBezierCurve3:YS,Quaternion:xa,QuaternionKeyframeTrack:Tm,QuaternionLinearInterpolant:LV,R11_EAC_Format:k0,RED_GREEN_RGTC2_Format:Iy,RED_RGTC1_Format:uy,REVISION:wm,RG11_EAC_Format:D0,RGBADepthPacking:QW,RGBAFormat:Sa,RGBAIntegerFormat:Ty,RGBA_ASTC_10x10_Format:sy,RGBA_ASTC_10x5_Format:ny,RGBA_ASTC_10x6_Format:iy,RGBA_ASTC_10x8_Format:ay,RGBA_ASTC_12x10_Format:oy,RGBA_ASTC_12x12_Format:ry,RGBA_ASTC_4x4_Format:j0,RGBA_ASTC_5x4_Format:J0,RGBA_ASTC_5x5_Format:P0,RGBA_ASTC_6x5_Format:Q0,RGBA_ASTC_6x6_Format:q0,RGBA_ASTC_8x5_Format:$0,RGBA_ASTC_8x6_Format:ey,RGBA_ASTC_8x8_Format:ty,RGBA_BPTC_Format:ly,RGBA_ETC2_EAC_Format:L0,RGBA_PVRTC_2BPPV1_Format:K0,RGBA_PVRTC_4BPPV1_Format:F0,RGBA_S3TC_DXT1_Format:Ff,RGBA_S3TC_DXT3_Format:Kf,RGBA_S3TC_DXT5_Format:Tf,RGBDepthPacking:b9,RGBFormat:yS,RGBIntegerFormat:A9,RGB_BPTC_SIGNED_Format:cy,RGB_BPTC_UNSIGNED_Format:gy,RGB_ETC1_Format:T0,RGB_ETC2_Format:z0,RGB_PVRTC_2BPPV1_Format:E0,RGB_PVRTC_4BPPV1_Format:H0,RGB_S3TC_DXT1_Format:Ef,RGDepthPacking:y9,RGFormat:hI,RGIntegerFormat:Ky,RawShaderMaterial:FS,Ray:pI,Raycaster:qS,RectAreaLight:QV,RedFormat:Wm,RedIntegerFormat:Vm,ReinhardToneMapping:dS,RenderTarget:BS,RenderTarget3D:hT,RepeatWrapping:sm,ReplaceStencilOp:x9,ReverseSubtractEquation:wW,RingGeometry:rv,SIGNED_R11_EAC_Format:U0,SIGNED_RED_GREEN_RGTC2_Format:hy,SIGNED_RED_RGTC1_Format:dy,SIGNED_RG11_EAC_Format:O0,SRGBColorSpace:Bs,SRGBTransfer:bi,Scene:_m,ShaderChunk:Yn,ShaderLib:Rl,ShaderMaterial:Ds,ShadowMaterial:VV,Shape:gI,ShapeGeometry:lv,ShapePath:ET,ShapeUtils:Nl,ShortType:Hy,Skeleton:qy,SkeletonHelper:ST,SkinnedMesh:fV,Source:Wu,Sphere:Ha,SphereGeometry:Fm,Spherical:V2,SphericalHarmonics3:DS,SplineCurve:HS,SpotLight:OV,SpotLightHelper:BT,Sprite:CV,SpriteMaterial:ZS,SrcAlphaFactor:w0,SrcAlphaSaturateFactor:FW,SrcColorFactor:MW,StaticCopyUsage:L9,StaticDrawUsage:gm,StaticReadUsage:K9,StereoCamera:PK,StreamCopyUsage:U9,StreamDrawUsage:F9,StreamReadUsage:z9,StringKeyframeTrack:vI,SubtractEquation:ZW,SubtractiveBlending:b2,TOUCH:Od,TangentSpaceNormalMap:Ku,TetrahedronGeometry:cv,Texture:fi,TextureLoader:Av,TextureUtils:kT,Timer:mT,TimestampQuery:O9,TorusGeometry:gv,TorusKnotGeometry:uv,Triangle:Lo,TriangleFanDrawMode:p9,TriangleStripDrawMode:m9,TrianglesDrawMode:f9,TubeGeometry:dv,UVMapping:_u,Uint16BufferAttribute:SS,Uint32BufferAttribute:xS,Uint8BufferAttribute:VF,Uint8ClampedBufferAttribute:MF,Uniform:QS,UniformsGroup:AT,UniformsLib:Pt,UniformsUtils:Im,UnsignedByteType:os,UnsignedInt101111Type:pS,UnsignedInt248Type:fC,UnsignedInt5999Type:mS,UnsignedIntType:fr,UnsignedShort4444Type:Ey,UnsignedShort5551Type:Fy,UnsignedShortType:AC,VSMShadowMap:nI,Vector2:yt,Vector3:ue,Vector4:ri,VectorKeyframeTrack:mm,VideoFrameTexture:nK,VideoTexture:yV,WebGL3DRenderTarget:bF,WebGLArrayRenderTarget:pF,WebGLCoordinateSystem:Ir,WebGLCubeRenderTarget:jy,WebGLRenderTarget:yo,WebGLRenderer:ex,WebGLUtils:u3,WebGPUCoordinateSystem:mC,WebXRController:m0,WireframeGeometry:ES,WrapAroundEnding:lm,ZeroCurvatureEnding:iI,ZeroFactor:WW,ZeroSlopeEnding:aI,ZeroStencilOp:S9,createCanvasElement:lV,error:Cn,getConsoleFunction:q9,log:dm,setConsoleFunction:Q9,warn:Qt,warnOnce:pC},Symbol.toStringTag,{value:"Module"}));var bB={exports:{}},yB={},vB={exports:{}},GB={};var t1;function FD(){if(t1)return GB;t1=1;var a=xC();function e(A,f){return A===f&&(A!==0||1/A===1/f)||A!==A&&f!==f}var t=typeof Object.is=="function"?Object.is:e,n=a.useState,i=a.useEffect,s=a.useLayoutEffect,o=a.useDebugValue;function l(A,f){var p=f(),y=n({inst:{value:p,getSnapshot:f}}),G=y[0].inst,B=y[1];return s(function(){G.value=p,G.getSnapshot=f,c(G)&&B({inst:G})},[A,p,f]),i(function(){return c(G)&&B({inst:G}),A(function(){c(G)&&B({inst:G})})},[A]),o(p),p}function c(A){var f=A.getSnapshot;A=A.value;try{var p=f();return!t(A,p)}catch{return!0}}function u(A,f){return f()}var h=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?u:l;return GB.useSyncExternalStore=a.useSyncExternalStore!==void 0?a.useSyncExternalStore:h,GB}var n1;function KD(){return n1||(n1=1,vB.exports=FD()),vB.exports}var i1;function TD(){if(i1)return yB;i1=1;var a=xC(),e=KD();function t(u,h){return u===h&&(u!==0||1/u===1/h)||u!==u&&h!==h}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=a.useRef,o=a.useEffect,l=a.useMemo,c=a.useDebugValue;return yB.useSyncExternalStoreWithSelector=function(u,h,A,f,p){var y=s(null);if(y.current===null){var G={hasValue:!1,value:null};y.current=G}else G=y.current;y=l(function(){function S(H){if(!N){if(N=!0,R=H,H=f(H),p!==void 0&&G.hasValue){var X=G.value;if(p(X,H))return w=X}return w=H}if(X=w,n(R,H))return X;var Y=f(H);return p!==void 0&&p(X,Y)?(R=H,X):(R=H,w=Y)}var N=!1,R,w,V=A===void 0?null:A;return[function(){return S(h())},V===null?void 0:function(){return S(V())}]},[h,A,f,p]);var B=i(u,y[0],y[1]);return o(function(){G.hasValue=!0,G.value=B},[B]),c(B),B},yB}var a1;function zD(){return a1||(a1=1,bB.exports=TD()),bB.exports}var LD=zD();const kD=xy(LD),s1=a=>{let e;const t=new Set,n=(u,h)=>{const A=typeof u=="function"?u(e):u;if(!Object.is(A,e)){const f=e;e=h??(typeof A!="object"||A===null)?A:Object.assign({},e,A),t.forEach(p=>p(e,f))}},i=()=>e,l={setState:n,getState:i,getInitialState:()=>c,subscribe:u=>(t.add(u),()=>t.delete(u))},c=e=a(n,i,l);return l},UD=(a=>a?s1(a):s1),{useSyncExternalStoreWithSelector:DD}=kD,OD=a=>a;function jD(a,e=OD,t){const n=DD(a.subscribe,a.getState,a.getInitialState,e,t);return xg.useDebugValue(n),n}const o1=(a,e)=>{const t=UD(a),n=(i,s=e)=>jD(t,i,s);return Object.assign(n,t),n},d3=((a,e)=>a?o1(a,e):o1),JD=a=>typeof a=="object"&&typeof a.then=="function",rI=[];function I3(a,e,t=(n,i)=>n===i){if(a===e)return!0;if(!a||!e)return!1;const n=a.length;if(e.length!==n)return!1;for(let i=0;i<n;i++)if(!t(a[i],e[i]))return!1;return!0}function h3(a,e=null,t=!1,n={}){e===null&&(e=[a]);for(const s of rI)if(I3(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:n.equal,remove:()=>{const s=rI.indexOf(i);s!==-1&&rI.splice(s,1)},promise:(JD(a)?a:a(...e)).then(s=>{i.response=s,n.lifespan&&n.lifespan>0&&(i.timeout=setTimeout(i.remove,n.lifespan))}).catch(s=>i.error=s)};if(rI.push(i),!t)throw i.promise}const C3=(a,e,t)=>h3(a,e,!1,t),PD=(a,e,t)=>{h3(a,e,!0,t)},QD=a=>{if(a===void 0||a.length===0)rI.splice(0,rI.length);else{const e=rI.find(t=>I3(a,t.keys,t.equal));e&&e.remove()}};var BB={exports:{}},SB={exports:{}},xB={exports:{}},ZB={};var r1;function qD(){return r1||(r1=1,(function(a){function e(F,j){var Q=F.length;F.push(j);e:for(;0<Q;){var ce=Q-1>>>1,oe=F[ce];if(0<i(oe,j))F[ce]=j,F[Q]=oe,Q=ce;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var j=F[0],Q=F.pop();if(Q!==j){F[0]=Q;e:for(var ce=0,oe=F.length,T=oe>>>1;ce<T;){var $=2*(ce+1)-1,ae=F[$],Ie=$+1,be=F[Ie];if(0>i(ae,Q))Ie<oe&&0>i(be,ae)?(F[ce]=be,F[Ie]=Q,ce=Ie):(F[ce]=ae,F[$]=Q,ce=$);else if(Ie<oe&&0>i(be,Q))F[ce]=be,F[Ie]=Q,ce=Ie;else break e}}return j}function i(F,j){var Q=F.sortIndex-j.sortIndex;return Q!==0?Q:F.id-j.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();a.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,A=null,f=3,p=!1,y=!1,G=!1,B=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function R(F){for(var j=t(u);j!==null;){if(j.callback===null)n(u);else if(j.startTime<=F)n(u),j.sortIndex=j.expirationTime,e(c,j);else break;j=t(u)}}function w(F){if(G=!1,R(F),!y)if(t(c)!==null)y=!0,k();else{var j=t(u);j!==null&&le(w,j.startTime-F)}}var V=!1,H=-1,X=5,Y=-1;function M(){return!(a.unstable_now()-Y<X)}function E(){if(V){var F=a.unstable_now();Y=F;var j=!0;try{e:{y=!1,G&&(G=!1,S(H),H=-1),p=!0;var Q=f;try{t:{for(R(F),A=t(c);A!==null&&!(A.expirationTime>F&&M());){var ce=A.callback;if(typeof ce=="function"){A.callback=null,f=A.priorityLevel;var oe=ce(A.expirationTime<=F);if(F=a.unstable_now(),typeof oe=="function"){A.callback=oe,R(F),j=!0;break t}A===t(c)&&n(c),R(F)}else n(c);A=t(c)}if(A!==null)j=!0;else{var T=t(u);T!==null&&le(w,T.startTime-F),j=!1}}break e}finally{A=null,f=Q,p=!1}j=void 0}}finally{j?O():V=!1}}}var O;if(typeof N=="function")O=function(){N(E)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,q=P.port2;P.port1.onmessage=E,O=function(){q.postMessage(null)}}else O=function(){B(E,0)};function k(){V||(V=!0,O())}function le(F,j){H=B(function(){F(a.unstable_now())},j)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(F){F.callback=null},a.unstable_continueExecution=function(){y||p||(y=!0,k())},a.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<F?Math.floor(1e3/F):5},a.unstable_getCurrentPriorityLevel=function(){return f},a.unstable_getFirstCallbackNode=function(){return t(c)},a.unstable_next=function(F){switch(f){case 1:case 2:case 3:var j=3;break;default:j=f}var Q=f;f=j;try{return F()}finally{f=Q}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(F,j){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Q=f;f=F;try{return j()}finally{f=Q}},a.unstable_scheduleCallback=function(F,j,Q){var ce=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ce+Q:ce):Q=ce,F){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=Q+oe,F={id:h++,callback:j,priorityLevel:F,startTime:Q,expirationTime:oe,sortIndex:-1},Q>ce?(F.sortIndex=Q,e(u,F),t(c)===null&&F===t(u)&&(G?(S(H),H=-1):G=!0,le(w,Q-ce))):(F.sortIndex=oe,e(c,F),y||p||(y=!0,k())),F},a.unstable_shouldYield=M,a.unstable_wrapCallback=function(F){var j=f;return function(){var Q=f;f=j;try{return F.apply(this,arguments)}finally{f=Q}}}})(ZB)),ZB}var l1;function $D(){return l1||(l1=1,xB.exports=qD()),xB.exports}var c1;function eO(){return c1||(c1=1,(function(a){a.exports=function(e){function t(d,I,v,Z){return new eA(d,I,v,Z)}function n(){}function i(d){var I="https://react.dev/errors/"+d;if(1<arguments.length){I+="?args[]="+encodeURIComponent(arguments[1]);for(var v=2;v<arguments.length;v++)I+="&args[]="+encodeURIComponent(arguments[v])}return"Minified React error #"+d+"; visit "+I+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(d){return d===null||typeof d!="object"?null:(d=rA&&d[rA]||d["@@iterator"],typeof d=="function"?d:null)}function o(d){if(d==null)return null;if(typeof d=="function")return d.$$typeof===Qc?null:d.displayName||d.name||null;if(typeof d=="string")return d;switch(d){case Og:return"Fragment";case $o:return"Portal";case oA:return"Profiler";case sA:return"StrictMode";case TI:return"Suspense";case Ql:return"SuspenseList"}if(typeof d=="object")switch(d.$$typeof){case Zr:return(d.displayName||"Context")+".Provider";case Pl:return(d._context.displayName||"Context")+".Consumer";case jg:var I=d.render;return d=d.displayName,d||(d=I.displayName||I.name||"",d=d!==""?"ForwardRef("+d+")":"ForwardRef"),d;case id:return I=d.displayName||null,I!==null?I:o(d.type)||"Memo";case er:I=d._payload,d=d._init;try{return o(d(I))}catch{}}return null}function l(d){if(zI===void 0)try{throw Error()}catch(v){var I=v.stack.trim().match(/\n( *(at )?)/);zI=I&&I[1]||"",lA=-1<v.stack.indexOf(`
    at`)?" (<anonymous>)":-1<v.stack.indexOf("@")?"@unknown:0:0":""}return`
`+zI+d+lA}function c(d,I){if(!d||ql)return"";ql=!0;var v=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var Z={DetermineComponentFrameRoot:function(){try{if(I){var en=function(){throw Error()};if(Object.defineProperty(en.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(en,[])}catch(wn){var nn=wn}Reflect.construct(d,[],en)}else{try{en.call()}catch(wn){nn=wn}d.call(en.prototype)}}else{try{throw Error()}catch(wn){nn=wn}(en=d())&&typeof en.catch=="function"&&en.catch(function(){})}}catch(wn){if(wn&&nn&&typeof wn.stack=="string")return[wn.stack,nn.stack]}return[null,null]}};Z.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(Z.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(Z.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var K=Z.DetermineComponentFrameRoot(),ge=K[0],Be=K[1];if(ge&&Be){var Ue=ge.split(`
`),Bt=Be.split(`
`);for(_=Z=0;Z<Ue.length&&!Ue[Z].includes("DetermineComponentFrameRoot");)Z++;for(;_<Bt.length&&!Bt[_].includes("DetermineComponentFrameRoot");)_++;if(Z===Ue.length||_===Bt.length)for(Z=Ue.length-1,_=Bt.length-1;1<=Z&&0<=_&&Ue[Z]!==Bt[_];)_--;for(;1<=Z&&0<=_;Z--,_--)if(Ue[Z]!==Bt[_]){if(Z!==1||_!==1)do if(Z--,_--,0>_||Ue[Z]!==Bt[_]){var Dt=`
`+Ue[Z].replace(" at new "," at ");return d.displayName&&Dt.includes("<anonymous>")&&(Dt=Dt.replace("<anonymous>",d.displayName)),Dt}while(1<=Z&&0<=_);break}}}finally{ql=!1,Error.prepareStackTrace=v}return(v=d?d.displayName||d.name:"")?l(v):""}function u(d){switch(d.tag){case 26:case 27:case 5:return l(d.type);case 16:return l("Lazy");case 13:return l("Suspense");case 19:return l("SuspenseList");case 0:case 15:return d=c(d.type,!1),d;case 11:return d=c(d.type.render,!1),d;case 1:return d=c(d.type,!0),d;default:return""}}function h(d){try{var I="";do I+=u(d),d=d.return;while(d);return I}catch(v){return`
Error generating stack: `+v.message+`
`+v.stack}}function A(d){var I=d,v=d;if(d.alternate)for(;I.return;)I=I.return;else{d=I;do I=d,(I.flags&4098)!==0&&(v=I.return),d=I.return;while(d)}return I.tag===3?v:null}function f(d){if(A(d)!==d)throw Error(i(188))}function p(d){var I=d.alternate;if(!I){if(I=A(d),I===null)throw Error(i(188));return I!==d?null:d}for(var v=d,Z=I;;){var _=v.return;if(_===null)break;var K=_.alternate;if(K===null){if(Z=_.return,Z!==null){v=Z;continue}break}if(_.child===K.child){for(K=_.child;K;){if(K===v)return f(_),d;if(K===Z)return f(_),I;K=K.sibling}throw Error(i(188))}if(v.return!==Z.return)v=_,Z=K;else{for(var ge=!1,Be=_.child;Be;){if(Be===v){ge=!0,v=_,Z=K;break}if(Be===Z){ge=!0,Z=_,v=K;break}Be=Be.sibling}if(!ge){for(Be=K.child;Be;){if(Be===v){ge=!0,v=K,Z=_;break}if(Be===Z){ge=!0,Z=K,v=_;break}Be=Be.sibling}if(!ge)throw Error(i(189))}}if(v.alternate!==Z)throw Error(i(190))}if(v.tag!==3)throw Error(i(188));return v.stateNode.current===v?d:I}function y(d){var I=d.tag;if(I===5||I===26||I===27||I===6)return d;for(d=d.child;d!==null;){if(I=y(d),I!==null)return I;d=d.sibling}return null}function G(d){var I=d.tag;if(I===5||I===26||I===27||I===6)return d;for(d=d.child;d!==null;){if(d.tag!==4&&(I=G(d),I!==null))return I;d=d.sibling}return null}function B(d){return{current:d}}function S(d){0>ul||(d.current=dd[ul],dd[ul]=null,ul--)}function N(d,I){ul++,dd[ul]=d.current,d.current=I}function R(d){return d>>>=0,d===0?32:31-(Id(d)/Rp|0)|0}function w(d){var I=d&42;if(I!==0)return I;switch(d&-d){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return d&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return d}}function V(d,I){var v=d.pendingLanes;if(v===0)return 0;var Z=0,_=d.suspendedLanes,K=d.pingedLanes,ge=d.warmLanes;d=d.finishedLanes!==0;var Be=v&134217727;return Be!==0?(v=Be&~_,v!==0?Z=w(v):(K&=Be,K!==0?Z=w(K):d||(ge=Be&~ge,ge!==0&&(Z=w(ge))))):(Be=v&~_,Be!==0?Z=w(Be):K!==0?Z=w(K):d||(ge=v&~ge,ge!==0&&(Z=w(ge)))),Z===0?0:I!==0&&I!==Z&&(I&_)===0&&(_=Z&-Z,ge=I&-I,_>=ge||_===32&&(ge&4194176)!==0)?I:Z}function H(d,I){return(d.pendingLanes&~(d.suspendedLanes&~d.pingedLanes)&I)===0}function X(d,I){switch(d){case 1:case 2:case 4:case 8:return I+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return I+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Y(){var d=qg;return qg<<=1,(qg&4194176)===0&&(qg=128),d}function M(){var d=hd;return hd<<=1,(hd&62914560)===0&&(hd=4194304),d}function E(d){for(var I=[],v=0;31>v;v++)I.push(d);return I}function O(d,I){d.pendingLanes|=I,I!==268435456&&(d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0)}function P(d,I,v,Z,_,K){var ge=d.pendingLanes;d.pendingLanes=v,d.suspendedLanes=0,d.pingedLanes=0,d.warmLanes=0,d.expiredLanes&=v,d.entangledLanes&=v,d.errorRecoveryDisabledLanes&=v,d.shellSuspendCounter=0;var Be=d.entanglements,Ue=d.expirationTimes,Bt=d.hiddenUpdates;for(v=ge&~v;0<v;){var Dt=31-Ws(v),en=1<<Dt;Be[Dt]=0,Ue[Dt]=-1;var nn=Bt[Dt];if(nn!==null)for(Bt[Dt]=null,Dt=0;Dt<nn.length;Dt++){var wn=nn[Dt];wn!==null&&(wn.lane&=-536870913)}v&=~en}Z!==0&&q(d,Z,0),K!==0&&_===0&&d.tag!==0&&(d.suspendedLanes|=K&~(ge&~I))}function q(d,I,v){d.pendingLanes|=I,d.suspendedLanes&=~I;var Z=31-Ws(I);d.entangledLanes|=I,d.entanglements[Z]=d.entanglements[Z]|1073741824|v&4194218}function k(d,I){var v=d.entangledLanes|=I;for(d=d.entanglements;v;){var Z=31-Ws(v),_=1<<Z;_&I|d[Z]&I&&(d[Z]|=I),v&=~_}}function le(d){return d&=-d,2<d?8<d?(d&134217727)!==0?32:268435456:8:2}function F(d){if(Vs&&typeof Vs.onCommitFiberRoot=="function")try{Vs.onCommitFiberRoot(eu,d,void 0,(d.current.flags&128)===128)}catch{}}function j(d){if(typeof Mp=="function"&&FA(d),Vs&&typeof Vs.setStrictMode=="function")try{Vs.setStrictMode(eu,d)}catch{}}function Q(d,I){return d===I&&(d!==0||1/d===1/I)||d!==d&&I!==I}function ce(d,I){if(typeof d=="object"&&d!==null){var v=sh.get(d);return v!==void 0?v:(I={value:d,source:I,stack:h(I)},sh.set(d,I),I)}return{value:d,source:I,stack:h(I)}}function oe(d,I){Vi[Oi++]=fd,Vi[Oi++]=Ad,Ad=d,fd=I}function T(d,I,v){io[ao++]=Vr,io[ao++]=Wo,io[ao++]=tr,tr=d;var Z=Vr;d=Wo;var _=32-Ws(Z)-1;Z&=~(1<<_),v+=1;var K=32-Ws(I)+_;if(30<K){var ge=_-_%5;K=(Z&(1<<ge)-1).toString(32),Z>>=ge,_-=ge,Vr=1<<32-Ws(I)+_|v<<_|Z,Wo=K+d}else Vr=1<<K|v<<_|Z,Wo=d}function $(d){d.return!==null&&(oe(d,1),T(d,1,0))}function ae(d){for(;d===Ad;)Ad=Vi[--Oi],Vi[Oi]=null,fd=Vi[--Oi],Vi[Oi]=null;for(;d===tr;)tr=io[--ao],io[ao]=null,Wo=io[--ao],io[ao]=null,Vr=io[--ao],io[ao]=null}function Ie(d,I){N(nr,I),N(md,d),N(Va,null),d=qc(I),S(Va),N(Va,d)}function be(){S(Va),S(md),S(nr)}function D(d){d.memoizedState!==null&&N(tu,d);var I=Va.current,v=lp(I,d.type);I!==v&&(N(md,d),N(Va,v))}function de(d){md.current===d&&(S(Va),S(md)),tu.current===d&&(S(tu),Rr?Gn._currentValue=Ns:Gn._currentValue2=Ns)}function ee(d){var I=Error(i(418,""));throw pt(ce(I,d)),pd}function Ce(d,I){if(!us)throw Error(i(175));Nv(d.stateNode,d.type,d.memoizedProps,I,d)||ee(d)}function we(d){for(ts=d.return;ts;)switch(ts.tag){case 3:case 27:Vo=!0;return;case 5:case 13:Vo=!1;return;default:ts=ts.return}}function Ye(d){if(!us||d!==ts)return!1;if(!ii)return we(d),ii=!0,!1;var I=!1;if(La?d.tag!==3&&d.tag!==27&&(d.tag!==5||Bp(d.type)&&!tc(d.type,d.memoizedProps))&&(I=!0):d.tag!==3&&(d.tag!==5||Bp(d.type)&&!tc(d.type,d.memoizedProps))&&(I=!0),I&&Ua&&ee(d),we(d),d.tag===13){if(!us)throw Error(i(316));if(d=d.memoizedState,d=d!==null?d.dehydrated:null,!d)throw Error(i(317));Ua=vp(d)}else Ua=ts?xA(d.stateNode):null;return!0}function Ee(){us&&(Ua=ts=null,ii=!1)}function pt(d){so===null?so=[d]:so.push(d)}function Ke(){for(var d=ic,I=nu=ic=0;I<d;){var v=oo[I];oo[I++]=null;var Z=oo[I];oo[I++]=null;var _=oo[I];oo[I++]=null;var K=oo[I];if(oo[I++]=null,Z!==null&&_!==null){var ge=Z.pending;ge===null?_.next=_:(_.next=ge.next,ge.next=_),Z.pending=_}K!==0&&se(v,_,K)}}function Qe(d,I,v,Z){oo[ic++]=d,oo[ic++]=I,oo[ic++]=v,oo[ic++]=Z,nu|=Z,d.lanes|=Z,d=d.alternate,d!==null&&(d.lanes|=Z)}function Le(d,I,v,Z){return Qe(d,I,v,Z),ht(d)}function dt(d,I){return Qe(d,null,null,I),ht(d)}function se(d,I,v){d.lanes|=v;var Z=d.alternate;Z!==null&&(Z.lanes|=v);for(var _=!1,K=d.return;K!==null;)K.childLanes|=v,Z=K.alternate,Z!==null&&(Z.childLanes|=v),K.tag===22&&(d=K.stateNode,d===null||d._visibility&1||(_=!0)),d=K,K=K.return;_&&I!==null&&d.tag===3&&(K=d.stateNode,_=31-Ws(v),K=K.hiddenUpdates,d=K[_],d===null?K[_]=[I]:d.push(I),I.lane=v|536870912)}function ht(d){if(50<cg)throw cg=0,hs=null,Error(i(185));for(var I=d.return;I!==null;)d=I,I=d.return;return d.tag===3?d.stateNode:null}function it(d){d!==ng&&d.next===null&&(ng===null?iu=ng=d:ng=ng.next=d),yd=!0,bd||(bd=!0,Oe(st))}function Fe(d,I){if(!ir&&yd){ir=!0;do for(var v=!1,Z=iu;Z!==null;){if(d!==0){var _=Z.pendingLanes;if(_===0)var K=0;else{var ge=Z.suspendedLanes,Be=Z.pingedLanes;K=(1<<31-Ws(42|d)+1)-1,K&=_&~(ge&~Be),K=K&201326677?K&201326677|1:K?K|2:0}K!==0&&(v=!0,Ae(Z,K))}else K=En,K=V(Z,Z===Ln?K:0),(K&3)===0||H(Z,K)||(v=!0,Ae(Z,K));Z=Z.next}while(v);ir=!1}}function st(){yd=bd=!1;var d=0;ac!==0&&(nc()&&(d=ac),ac=0);for(var I=ka(),v=null,Z=iu;Z!==null;){var _=Z.next,K=ie(Z,I);K===0?(Z.next=null,v===null?iu=_:v.next=_,_===null&&(ng=v)):(v=Z,(d!==0||(K&3)!==0)&&(yd=!0)),Z=_}Fe(d)}function ie(d,I){for(var v=d.suspendedLanes,Z=d.pingedLanes,_=d.expirationTimes,K=d.pendingLanes&-62914561;0<K;){var ge=31-Ws(K),Be=1<<ge,Ue=_[ge];Ue===-1?((Be&v)===0||(Be&Z)!==0)&&(_[ge]=X(Be,I)):Ue<=I&&(d.expiredLanes|=Be),K&=~Be}if(I=Ln,v=En,v=V(d,d===I?v:0),Z=d.callbackNode,v===0||d===I&&pi===2||d.cancelPendingCommit!==null)return Z!==null&&Z!==null&&Cd(Z),d.callbackNode=null,d.callbackPriority=0;if((v&3)===0||H(d,v)){if(I=v&-v,I===d.callbackPriority)return I;switch(Z!==null&&Cd(Z),le(v)){case 2:case 8:v=Vp;break;case 32:v=ih;break;case 268435456:v=ah;break;default:v=ih}return Z=z.bind(null,d),v=$g(v,Z),d.callbackPriority=I,d.callbackNode=v,I}return Z!==null&&Z!==null&&Cd(Z),d.callbackPriority=2,d.callbackNode=null,2}function z(d,I){var v=d.callbackNode;if(Na()&&d.callbackNode!==v)return null;var Z=En;return Z=V(d,d===Ln?Z:0),Z===0?null:(qu(d,Z,I),ie(d,ka()),d.callbackNode!=null&&d.callbackNode===v?z.bind(null,d):null)}function Ae(d,I){if(Na())return null;qu(d,I,!0)}function Oe(d){ca?DI(function(){(un&6)!==0?$g(EA,d):d()}):$g(EA,d)}function He(){return ac===0&&(ac=Y()),ac}function Me(d,I){if(vd===null){var v=vd=[];oh=0,Ms=He(),sc={status:"pending",value:void 0,then:function(Z){v.push(Z)}}}return oh++,I.then(It,It),I}function It(){if(--oh===0&&vd!==null){sc!==null&&(sc.status="fulfilled");var d=vd;vd=null,Ms=0,sc=null;for(var I=0;I<d.length;I++)(0,d[I])()}}function ft(d,I){var v=[],Z={status:"pending",value:null,reason:null,then:function(_){v.push(_)}};return d.then(function(){Z.status="fulfilled",Z.value=I;for(var _=0;_<v.length;_++)(0,v[_])(I)},function(_){for(Z.status="rejected",Z.reason=_,_=0;_<v.length;_++)(0,v[_])(void 0)}),Z}function Ht(d){d.updateQueue={baseState:d.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function kt(d,I){d=d.updateQueue,I.updateQueue===d&&(I.updateQueue={baseState:d.baseState,firstBaseUpdate:d.firstBaseUpdate,lastBaseUpdate:d.lastBaseUpdate,shared:d.shared,callbacks:null})}function Pe(d){return{lane:d,tag:0,payload:null,callback:null,next:null}}function je(d,I,v){var Z=d.updateQueue;if(Z===null)return null;if(Z=Z.shared,(un&2)!==0){var _=Z.pending;return _===null?I.next=I:(I.next=_.next,_.next=I),Z.pending=I,I=ht(d),se(d,null,v),I}return Qe(d,Z,I,v),ht(d)}function ot(d,I,v){if(I=I.updateQueue,I!==null&&(I=I.shared,(v&4194176)!==0)){var Z=I.lanes;Z&=d.pendingLanes,v|=Z,I.lanes=v,k(d,v)}}function he(d,I){var v=d.updateQueue,Z=d.alternate;if(Z!==null&&(Z=Z.updateQueue,v===Z)){var _=null,K=null;if(v=v.firstBaseUpdate,v!==null){do{var ge={lane:v.lane,tag:v.tag,payload:v.payload,callback:null,next:null};K===null?_=K=ge:K=K.next=ge,v=v.next}while(v!==null);K===null?_=K=I:K=K.next=I}else _=K=I;v={baseState:Z.baseState,firstBaseUpdate:_,lastBaseUpdate:K,shared:Z.shared,callbacks:Z.callbacks},d.updateQueue=v;return}d=v.lastBaseUpdate,d===null?v.firstBaseUpdate=I:d.next=I,v.lastBaseUpdate=I}function Ve(){if(au){var d=sc;if(d!==null)throw d}}function Ct(d,I,v,Z){au=!1;var _=d.updateQueue;dl=!1;var K=_.firstBaseUpdate,ge=_.lastBaseUpdate,Be=_.shared.pending;if(Be!==null){_.shared.pending=null;var Ue=Be,Bt=Ue.next;Ue.next=null,ge===null?K=Bt:ge.next=Bt,ge=Ue;var Dt=d.alternate;Dt!==null&&(Dt=Dt.updateQueue,Be=Dt.lastBaseUpdate,Be!==ge&&(Be===null?Dt.firstBaseUpdate=Bt:Be.next=Bt,Dt.lastBaseUpdate=Ue))}if(K!==null){var en=_.baseState;ge=0,Dt=Bt=Ue=null,Be=K;do{var nn=Be.lane&-536870913,wn=nn!==Be.lane;if(wn?(En&nn)===nn:(Z&nn)===nn){nn!==0&&nn===Ms&&(au=!0),Dt!==null&&(Dt=Dt.next={lane:0,tag:Be.tag,payload:Be.payload,callback:null,next:null});e:{var Hs=d,xd=Be;nn=I;var gg=v;switch(xd.tag){case 1:if(Hs=xd.payload,typeof Hs=="function"){en=Hs.call(gg,en,nn);break e}en=Hs;break e;case 3:Hs.flags=Hs.flags&-65537|128;case 0:if(Hs=xd.payload,nn=typeof Hs=="function"?Hs.call(gg,en,nn):Hs,nn==null)break e;en=Pc({},en,nn);break e;case 2:dl=!0}}nn=Be.callback,nn!==null&&(d.flags|=64,wn&&(d.flags|=8192),wn=_.callbacks,wn===null?_.callbacks=[nn]:wn.push(nn))}else wn={lane:nn,tag:Be.tag,payload:Be.payload,callback:Be.callback,next:null},Dt===null?(Bt=Dt=wn,Ue=en):Dt=Dt.next=wn,ge|=nn;if(Be=Be.next,Be===null){if(Be=_.shared.pending,Be===null)break;wn=Be,Be=wn.next,wn.next=null,_.lastBaseUpdate=wn,_.shared.pending=null}}while(!0);Dt===null&&(Ue=en),_.baseState=Ue,_.firstBaseUpdate=Bt,_.lastBaseUpdate=Dt,K===null&&(_.shared.lanes=0),go|=ge,d.lanes=ge,d.memoizedState=en}}function ye(d,I){if(typeof d!="function")throw Error(i(191,d));d.call(I)}function Re(d,I){var v=d.callbacks;if(v!==null)for(d.callbacks=null,d=0;d<v.length;d++)ye(v[d],I)}function lt(d,I){if(no(d,I))return!0;if(typeof d!="object"||d===null||typeof I!="object"||I===null)return!1;var v=Object.keys(d),Z=Object.keys(I);if(v.length!==Z.length)return!1;for(Z=0;Z<v.length;Z++){var _=v[Z];if(!Gd.call(I,_)||!no(d[_],I[_]))return!1}return!0}function Kt(d){return d=d.status,d==="fulfilled"||d==="rejected"}function gt(){}function qe(d,I,v){switch(v=d[v],v===void 0?d.push(I):v!==I&&(I.then(gt,gt),I=v),I.status){case"fulfilled":return I.value;case"rejected":throw d=I.reason,d===Ai?Error(i(483)):d;default:if(typeof I.status=="string")I.then(gt,gt);else{if(d=Ln,d!==null&&100<d.shellSuspendCounter)throw Error(i(482));d=I,d.status="pending",d.then(function(Z){if(I.status==="pending"){var _=I;_.status="fulfilled",_.value=Z}},function(Z){if(I.status==="pending"){var _=I;_.status="rejected",_.reason=Z}})}switch(I.status){case"fulfilled":return I.value;case"rejected":throw d=I.reason,d===Ai?Error(i(483)):d}throw ig=I,Ai}}function vt(){if(ig===null)throw Error(i(459));var d=ig;return ig=null,d}function Ut(d){var I=Mo;return Mo+=1,Mr===null&&(Mr=[]),qe(Mr,d,I)}function Ot(d,I){I=I.props.ref,d.ref=I!==void 0?I:null}function $t(d,I){throw I.$$typeof===aA?Error(i(525)):(d=Object.prototype.toString.call(I),Error(i(31,d==="[object Object]"?"object with keys {"+Object.keys(I).join(", ")+"}":d)))}function Rn(d){var I=d._init;return I(d._payload)}function Kn(d){function I(nt,Te){if(d){var rt=nt.deletions;rt===null?(nt.deletions=[Te],nt.flags|=16):rt.push(Te)}}function v(nt,Te){if(!d)return null;for(;Te!==null;)I(nt,Te),Te=Te.sibling;return null}function Z(nt){for(var Te=new Map;nt!==null;)nt.key!==null?Te.set(nt.key,nt):Te.set(nt.index,nt),nt=nt.sibling;return Te}function _(nt,Te){return nt=$a(nt,Te),nt.index=0,nt.sibling=null,nt}function K(nt,Te,rt){return nt.index=rt,d?(rt=nt.alternate,rt!==null?(rt=rt.index,rt<Te?(nt.flags|=33554434,Te):rt):(nt.flags|=33554434,Te)):(nt.flags|=1048576,Te)}function ge(nt){return d&&nt.alternate===null&&(nt.flags|=33554434),nt}function Be(nt,Te,rt,zt){return Te===null||Te.tag!==6?(Te=Jl(rt,nt.mode,zt),Te.return=nt,Te):(Te=_(Te,rt),Te.return=nt,Te)}function Ue(nt,Te,rt,zt){var cn=rt.type;return cn===Og?Dt(nt,Te,rt.props.children,zt,rt.key):Te!==null&&(Te.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===er&&Rn(cn)===Te.type)?(Te=_(Te,rt.props),Ot(Te,rt),Te.return=nt,Te):(Te=Ro(rt.type,rt.key,rt.props,null,nt.mode,zt),Ot(Te,rt),Te.return=nt,Te)}function Bt(nt,Te,rt,zt){return Te===null||Te.tag!==4||Te.stateNode.containerInfo!==rt.containerInfo||Te.stateNode.implementation!==rt.implementation?(Te=Dg(rt,nt.mode,zt),Te.return=nt,Te):(Te=_(Te,rt.children||[]),Te.return=nt,Te)}function Dt(nt,Te,rt,zt,cn){return Te===null||Te.tag!==7?(Te=ol(rt,nt.mode,zt,cn),Te.return=nt,Te):(Te=_(Te,rt),Te.return=nt,Te)}function en(nt,Te,rt){if(typeof Te=="string"&&Te!==""||typeof Te=="number"||typeof Te=="bigint")return Te=Jl(""+Te,nt.mode,rt),Te.return=nt,Te;if(typeof Te=="object"&&Te!==null){switch(Te.$$typeof){case rl:return rt=Ro(Te.type,Te.key,Te.props,null,nt.mode,rt),Ot(rt,Te),rt.return=nt,rt;case $o:return Te=Dg(Te,nt.mode,rt),Te.return=nt,Te;case er:var zt=Te._init;return Te=zt(Te._payload),en(nt,Te,rt)}if($l(Te)||s(Te))return Te=ol(Te,nt.mode,rt,null),Te.return=nt,Te;if(typeof Te.then=="function")return en(nt,Ut(Te),rt);if(Te.$$typeof===Zr)return en(nt,Ou(nt,Te),rt);$t(nt,Te)}return null}function nn(nt,Te,rt,zt){var cn=Te!==null?Te.key:null;if(typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint")return cn!==null?null:Be(nt,Te,""+rt,zt);if(typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case rl:return rt.key===cn?Ue(nt,Te,rt,zt):null;case $o:return rt.key===cn?Bt(nt,Te,rt,zt):null;case er:return cn=rt._init,rt=cn(rt._payload),nn(nt,Te,rt,zt)}if($l(rt)||s(rt))return cn!==null?null:Dt(nt,Te,rt,zt,null);if(typeof rt.then=="function")return nn(nt,Te,Ut(rt),zt);if(rt.$$typeof===Zr)return nn(nt,Te,Ou(nt,rt),zt);$t(nt,rt)}return null}function wn(nt,Te,rt,zt,cn){if(typeof zt=="string"&&zt!==""||typeof zt=="number"||typeof zt=="bigint")return nt=nt.get(rt)||null,Be(Te,nt,""+zt,cn);if(typeof zt=="object"&&zt!==null){switch(zt.$$typeof){case rl:return nt=nt.get(zt.key===null?rt:zt.key)||null,Ue(Te,nt,zt,cn);case $o:return nt=nt.get(zt.key===null?rt:zt.key)||null,Bt(Te,nt,zt,cn);case er:var Bi=zt._init;return zt=Bi(zt._payload),wn(nt,Te,rt,zt,cn)}if($l(zt)||s(zt))return nt=nt.get(rt)||null,Dt(Te,nt,zt,cn,null);if(typeof zt.then=="function")return wn(nt,Te,rt,Ut(zt),cn);if(zt.$$typeof===Zr)return wn(nt,Te,rt,Ou(Te,zt),cn);$t(Te,zt)}return null}function Hs(nt,Te,rt,zt){for(var cn=null,Bi=null,Bn=Te,si=Te=0,ya=null;Bn!==null&&si<rt.length;si++){Bn.index>si?(ya=Bn,Bn=null):ya=Bn.sibling;var oi=nn(nt,Bn,rt[si],zt);if(oi===null){Bn===null&&(Bn=ya);break}d&&Bn&&oi.alternate===null&&I(nt,Bn),Te=K(oi,Te,si),Bi===null?cn=oi:Bi.sibling=oi,Bi=oi,Bn=ya}if(si===rt.length)return v(nt,Bn),ii&&oe(nt,si),cn;if(Bn===null){for(;si<rt.length;si++)Bn=en(nt,rt[si],zt),Bn!==null&&(Te=K(Bn,Te,si),Bi===null?cn=Bn:Bi.sibling=Bn,Bi=Bn);return ii&&oe(nt,si),cn}for(Bn=Z(Bn);si<rt.length;si++)ya=wn(Bn,nt,si,rt[si],zt),ya!==null&&(d&&ya.alternate!==null&&Bn.delete(ya.key===null?si:ya.key),Te=K(ya,Te,si),Bi===null?cn=ya:Bi.sibling=ya,Bi=ya);return d&&Bn.forEach(function(pl){return I(nt,pl)}),ii&&oe(nt,si),cn}function xd(nt,Te,rt,zt){if(rt==null)throw Error(i(151));for(var cn=null,Bi=null,Bn=Te,si=Te=0,ya=null,oi=rt.next();Bn!==null&&!oi.done;si++,oi=rt.next()){Bn.index>si?(ya=Bn,Bn=null):ya=Bn.sibling;var pl=nn(nt,Bn,oi.value,zt);if(pl===null){Bn===null&&(Bn=ya);break}d&&Bn&&pl.alternate===null&&I(nt,Bn),Te=K(pl,Te,si),Bi===null?cn=pl:Bi.sibling=pl,Bi=pl,Bn=ya}if(oi.done)return v(nt,Bn),ii&&oe(nt,si),cn;if(Bn===null){for(;!oi.done;si++,oi=rt.next())oi=en(nt,oi.value,zt),oi!==null&&(Te=K(oi,Te,si),Bi===null?cn=oi:Bi.sibling=oi,Bi=oi);return ii&&oe(nt,si),cn}for(Bn=Z(Bn);!oi.done;si++,oi=rt.next())oi=wn(Bn,nt,si,oi.value,zt),oi!==null&&(d&&oi.alternate!==null&&Bn.delete(oi.key===null?si:oi.key),Te=K(oi,Te,si),Bi===null?cn=oi:Bi.sibling=oi,Bi=oi);return d&&Bn.forEach(function(Ch){return I(nt,Ch)}),ii&&oe(nt,si),cn}function gg(nt,Te,rt,zt){if(typeof rt=="object"&&rt!==null&&rt.type===Og&&rt.key===null&&(rt=rt.props.children),typeof rt=="object"&&rt!==null){switch(rt.$$typeof){case rl:e:{for(var cn=rt.key;Te!==null;){if(Te.key===cn){if(cn=rt.type,cn===Og){if(Te.tag===7){v(nt,Te.sibling),zt=_(Te,rt.props.children),zt.return=nt,nt=zt;break e}}else if(Te.elementType===cn||typeof cn=="object"&&cn!==null&&cn.$$typeof===er&&Rn(cn)===Te.type){v(nt,Te.sibling),zt=_(Te,rt.props),Ot(zt,rt),zt.return=nt,nt=zt;break e}v(nt,Te);break}else I(nt,Te);Te=Te.sibling}rt.type===Og?(zt=ol(rt.props.children,nt.mode,zt,rt.key),zt.return=nt,nt=zt):(zt=Ro(rt.type,rt.key,rt.props,null,nt.mode,zt),Ot(zt,rt),zt.return=nt,nt=zt)}return ge(nt);case $o:e:{for(cn=rt.key;Te!==null;){if(Te.key===cn)if(Te.tag===4&&Te.stateNode.containerInfo===rt.containerInfo&&Te.stateNode.implementation===rt.implementation){v(nt,Te.sibling),zt=_(Te,rt.children||[]),zt.return=nt,nt=zt;break e}else{v(nt,Te);break}else I(nt,Te);Te=Te.sibling}zt=Dg(rt,nt.mode,zt),zt.return=nt,nt=zt}return ge(nt);case er:return cn=rt._init,rt=cn(rt._payload),gg(nt,Te,rt,zt)}if($l(rt))return Hs(nt,Te,rt,zt);if(s(rt)){if(cn=s(rt),typeof cn!="function")throw Error(i(150));return rt=cn.call(rt),xd(nt,Te,rt,zt)}if(typeof rt.then=="function")return gg(nt,Te,Ut(rt),zt);if(rt.$$typeof===Zr)return gg(nt,Te,Ou(nt,rt),zt);$t(nt,rt)}return typeof rt=="string"&&rt!==""||typeof rt=="number"||typeof rt=="bigint"?(rt=""+rt,Te!==null&&Te.tag===6?(v(nt,Te.sibling),zt=_(Te,rt),zt.return=nt,nt=zt):(v(nt,Te),zt=Jl(rt,nt.mode,zt),zt.return=nt,nt=zt),ge(nt)):v(nt,Te)}return function(nt,Te,rt,zt){try{Mo=0;var cn=gg(nt,Te,rt,zt);return Mr=null,cn}catch(Bn){if(Bn===Ai)throw Bn;var Bi=t(29,Bn,null,nt.mode);return Bi.lanes=zt,Bi.return=nt,Bi}}}function Ci(d,I){d=ar,N(ro,d),N(_r,I),ar=d|I.baseLanes}function Ge(){N(ro,ar),N(_r,_r.current)}function Xe(){ar=ro.current,S(_r),S(ro)}function Je(d){var I=d.alternate;N(ga,ga.current&1),N(lo,d),_o===null&&(I===null||_r.current!==null||I.memoizedState!==null)&&(_o=d)}function Zt(d){if(d.tag===22){if(N(ga,ga.current),N(lo,d),_o===null){var I=d.alternate;I!==null&&I.memoizedState!==null&&(_o=d)}}else Mt()}function Mt(){N(ga,ga.current),N(lo,lo.current)}function Gt(d){S(lo),_o===d&&(_o=null),S(ga)}function Ft(d){for(var I=d;I!==null;){if(I.tag===13){var v=I.memoizedState;if(v!==null&&(v=v.dehydrated,v===null||QI(v)||ud(v)))return I}else if(I.tag===19&&I.memoizedProps.revealOrder!==void 0){if((I.flags&128)!==0)return I}else if(I.child!==null){I.child.return=I,I=I.child;continue}if(I===d)break;for(;I.sibling===null;){if(I.return===null||I.return===d)return null;I=I.return}I.sibling.return=I.return,I=I.sibling}return null}function Vt(){throw Error(i(321))}function U(d,I){if(I===null)return!1;for(var v=0;v<I.length&&v<d.length;v++)if(!no(d[v],I[v]))return!1;return!0}function te(d,I,v,Z,_,K){return Xr=K,_n=I,I.memoizedState=null,I.updateQueue=null,I.lanes=0,mn.H=d===null||d.memoizedState===null?ua:ns,Il=!1,K=v(Z,_),Il=!1,Mi&&(K=Ne(I,v,Z,_)),pe(d),K}function pe(d){mn.H=ai;var I=li!==null&&li.next!==null;if(Xr=0,ta=li=_n=null,Xo=!1,ji=0,su=null,I)throw Error(i(300));d===null||na||(d=d.dependencies,d!==null&&El(d)&&(na=!0))}function Ne(d,I,v,Z){_n=d;var _=0;do{if(Mi&&(su=null),ji=0,Mi=!1,25<=_)throw Error(i(301));if(_+=1,ta=li=null,d.updateQueue!=null){var K=d.updateQueue;K.lastEffect=null,K.events=null,K.stores=null,K.memoCache!=null&&(K.memoCache.index=0)}mn.H=rc,K=I(v,Z)}while(Mi);return K}function De(){var d=mn.H,I=d.useState()[0];return I=typeof I.then=="function"?_t(I):I,d=d.useState()[0],(li!==null?li.memoizedState:null)!==d&&(_n.flags|=1024),I}function ke(){var d=Bd!==0;return Bd=0,d}function wt(d,I,v){I.updateQueue=d.updateQueue,I.flags&=-2053,d.lanes&=~v}function At(d){if(Xo){for(d=d.memoizedState;d!==null;){var I=d.queue;I!==null&&(I.pending=null),d=d.next}Xo=!1}Xr=0,ta=li=_n=null,Mi=!1,ji=Bd=0,su=null}function bt(){var d={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ta===null?_n.memoizedState=ta=d:ta=ta.next=d,ta}function ct(){if(li===null){var d=_n.alternate;d=d!==null?d.memoizedState:null}else d=li.next;var I=ta===null?_n.memoizedState:ta.next;if(I!==null)ta=I,li=d;else{if(d===null)throw _n.alternate===null?Error(i(467)):Error(i(310));li=d,d={memoizedState:li.memoizedState,baseState:li.baseState,baseQueue:li.baseQueue,queue:li.queue,next:null},ta===null?_n.memoizedState=ta=d:ta=ta.next=d}return ta}function _t(d){var I=ji;return ji+=1,su===null&&(su=[]),d=qe(su,d,I),I=_n,(ta===null?I.memoizedState:ta.next)===null&&(I=I.alternate,mn.H=I===null||I.memoizedState===null?ua:ns),d}function $e(d){if(d!==null&&typeof d=="object"){if(typeof d.then=="function")return _t(d);if(d.$$typeof===Zr)return Ka(d)}throw Error(i(438,String(d)))}function ne(d){var I=null,v=_n.updateQueue;if(v!==null&&(I=v.memoCache),I==null){var Z=_n.alternate;Z!==null&&(Z=Z.updateQueue,Z!==null&&(Z=Z.memoCache,Z!=null&&(I={data:Z.data.map(function(_){return _.slice()}),index:0})))}if(I==null&&(I={data:[],index:0}),v===null&&(v=lh(),_n.updateQueue=v),v.memoCache=I,v=I.data[I.index],v===void 0)for(v=I.data[I.index]=Array(d),Z=0;Z<d;Z++)v[Z]=rp;return I.index++,v}function ve(d,I){return typeof I=="function"?I(d):I}function xe(d){var I=ct();return We(I,li,d)}function We(d,I,v){var Z=d.queue;if(Z===null)throw Error(i(311));Z.lastRenderedReducer=v;var _=d.baseQueue,K=Z.pending;if(K!==null){if(_!==null){var ge=_.next;_.next=K.next,K.next=ge}I.baseQueue=_=K,Z.pending=null}if(K=d.baseState,_===null)d.memoizedState=K;else{I=_.next;var Be=ge=null,Ue=null,Bt=I,Dt=!1;do{var en=Bt.lane&-536870913;if(en!==Bt.lane?(En&en)===en:(Xr&en)===en){var nn=Bt.revertLane;if(nn===0)Ue!==null&&(Ue=Ue.next={lane:0,revertLane:0,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null}),en===Ms&&(Dt=!0);else if((Xr&nn)===nn){Bt=Bt.next,nn===Ms&&(Dt=!0);continue}else en={lane:0,revertLane:Bt.revertLane,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null},Ue===null?(Be=Ue=en,ge=K):Ue=Ue.next=en,_n.lanes|=nn,go|=nn;en=Bt.action,Il&&v(K,en),K=Bt.hasEagerState?Bt.eagerState:v(K,en)}else nn={lane:en,revertLane:Bt.revertLane,action:Bt.action,hasEagerState:Bt.hasEagerState,eagerState:Bt.eagerState,next:null},Ue===null?(Be=Ue=nn,ge=K):Ue=Ue.next=nn,_n.lanes|=en,go|=en;Bt=Bt.next}while(Bt!==null&&Bt!==I);if(Ue===null?ge=K:Ue.next=Be,!no(K,d.memoizedState)&&(na=!0,Dt&&(v=sc,v!==null)))throw v;d.memoizedState=K,d.baseState=ge,d.baseQueue=Ue,Z.lastRenderedState=K}return _===null&&(Z.lanes=0),[d.memoizedState,Z.dispatch]}function Ze(d){var I=ct(),v=I.queue;if(v===null)throw Error(i(311));v.lastRenderedReducer=d;var Z=v.dispatch,_=v.pending,K=I.memoizedState;if(_!==null){v.pending=null;var ge=_=_.next;do K=d(K,ge.action),ge=ge.next;while(ge!==_);no(K,I.memoizedState)||(na=!0),I.memoizedState=K,I.baseQueue===null&&(I.baseState=K),v.lastRenderedState=K}return[K,Z]}function St(d,I,v){var Z=_n,_=ct(),K=ii;if(K){if(v===void 0)throw Error(i(407));v=v()}else v=I();var ge=!no((li||_).memoizedState,v);if(ge&&(_.memoizedState=v,na=!0),_=_.queue,fa(xt.bind(null,Z,_,d),[d]),_.getSnapshot!==I||ge||ta!==null&&ta.memoizedState.tag&1){if(Z.flags|=2048,yi(9,Yt.bind(null,Z,_,v,I),{destroy:void 0},null),Ln===null)throw Error(i(349));K||(Xr&60)!==0||Xt(Z,I,v)}return v}function Xt(d,I,v){d.flags|=16384,d={getSnapshot:I,value:v},I=_n.updateQueue,I===null?(I=lh(),_n.updateQueue=I,I.stores=[d]):(v=I.stores,v===null?I.stores=[d]:v.push(d))}function Yt(d,I,v,Z){I.value=v,I.getSnapshot=Z,Wt(I)&&qt(d)}function xt(d,I,v){return v(function(){Wt(I)&&qt(d)})}function Wt(d){var I=d.getSnapshot;d=d.value;try{var v=I();return!no(d,v)}catch{return!0}}function qt(d){var I=dt(d,2);I!==null&&qa(I,d,2)}function Et(d){var I=bt();if(typeof d=="function"){var v=d;if(d=v(),Il){j(!0);try{v()}finally{j(!1)}}}return I.memoizedState=I.baseState=d,I.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:ve,lastRenderedState:d},I}function Tt(d,I,v,Z){return d.baseState=v,We(d,li,typeof Z=="function"?Z:ve)}function fn(d,I,v,Z,_){if(pr(d))throw Error(i(485));if(d=I.action,d!==null){var K={payload:_,action:d,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ge){K.listeners.push(ge)}};mn.T!==null?v(!0):K.isTransition=!1,Z(K),v=I.pending,v===null?(K.next=I.pending=K,Tn(I,K)):(K.next=v.next,I.pending=v.next=K)}}function Tn(d,I){var v=I.action,Z=I.payload,_=d.state;if(I.isTransition){var K=mn.T,ge={};mn.T=ge;try{var Be=v(_,Z),Ue=mn.S;Ue!==null&&Ue(ge,Be),yn(d,I,Be)}catch(Bt){Jt(d,I,Bt)}finally{mn.T=K}}else try{K=v(_,Z),yn(d,I,K)}catch(Bt){Jt(d,I,Bt)}}function yn(d,I,v){v!==null&&typeof v=="object"&&typeof v.then=="function"?v.then(function(Z){sn(d,I,Z)},function(Z){return Jt(d,I,Z)}):sn(d,I,v)}function sn(d,I,v){I.status="fulfilled",I.value=v,rn(I),d.state=v,I=d.pending,I!==null&&(v=I.next,v===I?d.pending=null:(v=v.next,I.next=v,Tn(d,v)))}function Jt(d,I,v){var Z=d.pending;if(d.pending=null,Z!==null){Z=Z.next;do I.status="rejected",I.reason=v,rn(I),I=I.next;while(I!==Z)}d.action=null}function rn(d){d=d.listeners;for(var I=0;I<d.length;I++)(0,d[I])()}function jt(d,I){return I}function ni(d,I){if(ii){var v=Ln.formState;if(v!==null){e:{var Z=_n;if(ii){if(Ua){var _=hp(Ua,Vo);if(_){Ua=xA(_),Z=Cp(_);break e}}ee(Z)}Z=!1}Z&&(I=v[0])}}v=bt(),v.memoizedState=v.baseState=I,Z={pending:null,lanes:0,dispatch:null,lastRenderedReducer:jt,lastRenderedState:I},v.queue=Z,v=Hc.bind(null,_n,Z),Z.dispatch=v,Z=Et(!1);var K=Ec.bind(null,_n,!1,Z.queue);return Z=bt(),_={state:I,dispatch:null,action:d,pending:null},Z.queue=_,v=fn.bind(null,_n,_,K,v),_.dispatch=v,Z.memoizedState=d,[I,v,!1]}function Ei(d){var I=ct();return zn(I,li,d)}function zn(d,I,v){I=We(d,I,jt)[0],d=xe(ve)[0],I=typeof I=="object"&&I!==null&&typeof I.then=="function"?_t(I):I;var Z=ct(),_=Z.queue,K=_.dispatch;return v!==Z.memoizedState&&(_n.flags|=2048,yi(9,Xi.bind(null,_,v),{destroy:void 0},null)),[I,K,d]}function Xi(d,I){d.action=I}function On(d){var I=ct(),v=li;if(v!==null)return zn(I,v,d);ct(),I=I.memoizedState,v=ct();var Z=v.queue.dispatch;return v.memoizedState=d,[I,Z,!1]}function yi(d,I,v,Z){return d={tag:d,create:I,inst:v,deps:Z,next:null},I=_n.updateQueue,I===null&&(I=lh(),_n.updateQueue=I),v=I.lastEffect,v===null?I.lastEffect=d.next=d:(Z=v.next,v.next=d,d.next=Z,I.lastEffect=d),d}function Yi(){return ct().memoizedState}function Fi(d,I,v,Z){var _=bt();_n.flags|=d,_.memoizedState=yi(1|I,v,{destroy:void 0},Z===void 0?null:Z)}function Ki(d,I,v,Z){var _=ct();Z=Z===void 0?null:Z;var K=_.memoizedState.inst;li!==null&&Z!==null&&U(Z,li.memoizedState.deps)?_.memoizedState=yi(I,v,K,Z):(_n.flags|=d,_.memoizedState=yi(1|I,v,K,Z))}function ko(d,I){Fi(8390656,8,d,I)}function fa(d,I){Ki(2048,8,d,I)}function Lu(d,I){return Ki(4,2,d,I)}function Mc(d,I){return Ki(4,4,d,I)}function So(d,I){if(typeof I=="function"){d=d();var v=I(d);return function(){typeof v=="function"?v():I(null)}}if(I!=null)return d=d(),I.current=d,function(){I.current=null}}function Ea(d,I,v){v=v!=null?v.concat([d]):null,Ki(4,4,So.bind(null,I,d),v)}function Uo(){}function _c(d,I){var v=ct();I=I===void 0?null:I;var Z=v.memoizedState;return I!==null&&U(I,Z[1])?Z[0]:(v.memoizedState=[d,I],d)}function js(d,I){var v=ct();I=I===void 0?null:I;var Z=v.memoizedState;if(I!==null&&U(I,Z[1]))return Z[0];if(Z=d(),Il){j(!0);try{d()}finally{j(!1)}}return v.memoizedState=[Z,I],Z}function xo(d,I,v){return v===void 0||(Xr&1073741824)!==0?d.memoizedState=I:(d.memoizedState=v,d=Gr(),_n.lanes|=d,go|=d,v)}function Xc(d,I,v,Z){return no(v,I)?v:_r.current!==null?(d=xo(d,v,Z),no(d,I)||(na=!0),d):(Xr&42)===0?(na=!0,d.memoizedState=v):(d=Gr(),_n.lanes|=d,go|=d,I)}function Yc(d,I,v,Z,_){var K=pa();es(K!==0&&8>K?K:8);var ge=mn.T,Be={};mn.T=Be,Ec(d,!1,I,v);try{var Ue=_(),Bt=mn.S;if(Bt!==null&&Bt(Be,Ue),Ue!==null&&typeof Ue=="object"&&typeof Ue.then=="function"){var Dt=ft(Ue,Z);Zo(d,I,Dt,gs(d))}else Zo(d,I,Z,gs(d))}catch(en){Zo(d,I,{then:function(){},status:"rejected",reason:en},gs())}finally{es(K),mn.T=ge}}function Yl(d){var I=d.memoizedState;if(I!==null)return I;I={memoizedState:Ns,baseState:Ns,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ve,lastRenderedState:Ns},next:null};var v={};return I.next={memoizedState:v,baseState:v,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:ve,lastRenderedState:v},next:null},d.memoizedState=I,d=d.alternate,d!==null&&(d.memoizedState=I),I}function Do(){return Ka(Gn)}function Js(){return ct().memoizedState}function Pa(){return ct().memoizedState}function Jr(d){for(var I=d.return;I!==null;){switch(I.tag){case 24:case 3:var v=gs();d=Pe(v);var Z=je(I,d,v);Z!==null&&(qa(Z,I,v),ot(Z,I,v)),I={cache:SI()},d.payload=I;return}I=I.return}}function Oo(d,I,v){var Z=gs();v={lane:Z,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null},pr(d)?jo(I,v):(v=Le(d,I,v,Z),v!==null&&(qa(v,d,Z),Pr(v,I,Z)))}function Hc(d,I,v){var Z=gs();Zo(d,I,v,Z)}function Zo(d,I,v,Z){var _={lane:Z,revertLane:0,action:v,hasEagerState:!1,eagerState:null,next:null};if(pr(d))jo(I,_);else{var K=d.alternate;if(d.lanes===0&&(K===null||K.lanes===0)&&(K=I.lastRenderedReducer,K!==null))try{var ge=I.lastRenderedState,Be=K(ge,v);if(_.hasEagerState=!0,_.eagerState=Be,no(Be,ge))return Qe(d,I,_,0),Ln===null&&Ke(),!1}catch{}if(v=Le(d,I,_,Z),v!==null)return qa(v,d,Z),Pr(v,I,Z),!0}return!1}function Ec(d,I,v,Z){if(Z={lane:2,revertLane:He(),action:Z,hasEagerState:!1,eagerState:null,next:null},pr(d)){if(I)throw Error(i(479))}else I=Le(d,v,Z,2),I!==null&&qa(I,d,2)}function pr(d){var I=d.alternate;return d===_n||I!==null&&I===_n}function jo(d,I){Mi=Xo=!0;var v=d.pending;v===null?I.next=I:(I.next=v.next,v.next=I),d.pending=I}function Pr(d,I,v){if((v&4194176)!==0){var Z=I.lanes;Z&=d.pendingLanes,v|=Z,I.lanes=v,k(d,v)}}function Ri(d,I,v,Z){I=d.memoizedState,v=v(Z,I),v=v==null?I:Pc({},I,v),d.memoizedState=v,d.lanes===0&&(d.updateQueue.baseState=v)}function Jo(d,I,v,Z,_,K,ge){return d=d.stateNode,typeof d.shouldComponentUpdate=="function"?d.shouldComponentUpdate(Z,K,ge):I.prototype&&I.prototype.isPureReactComponent?!lt(v,Z)||!lt(_,K):!0}function Qr(d,I,v,Z){d=I.state,typeof I.componentWillReceiveProps=="function"&&I.componentWillReceiveProps(v,Z),typeof I.UNSAFE_componentWillReceiveProps=="function"&&I.UNSAFE_componentWillReceiveProps(v,Z),I.state!==d&&ch.enqueueReplaceState(I,I.state,null)}function rs(d,I){var v=I;if("ref"in I){v={};for(var Z in I)Z!=="ref"&&(v[Z]=I[Z])}if(d=d.defaultProps){v===I&&(v=Pc({},v));for(var _ in d)v[_]===void 0&&(v[_]=d[_])}return v}function br(d,I){try{var v=d.onUncaughtError;v(I.value,{componentStack:I.stack})}catch(Z){setTimeout(function(){throw Z})}}function Fc(d,I,v){try{var Z=d.onCaughtError;Z(v.value,{componentStack:v.stack,errorBoundary:I.tag===1?I.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function Po(d,I,v){return v=Pe(v),v.tag=3,v.payload={element:null},v.callback=function(){br(d,I)},v}function yr(d){return d=Pe(d),d.tag=3,d}function ma(d,I,v,Z){var _=v.type.getDerivedStateFromError;if(typeof _=="function"){var K=Z.value;d.payload=function(){return _(K)},d.callback=function(){Fc(I,v,Z)}}var ge=v.stateNode;ge!==null&&typeof ge.componentDidCatch=="function"&&(d.callback=function(){Fc(I,v,Z),typeof _!="function"&&(Io===null?Io=new Set([this]):Io.add(this));var Be=Z.stack;this.componentDidCatch(Z.value,{componentStack:Be!==null?Be:""})})}function GI(d,I,v,Z,_){if(v.flags|=32768,Z!==null&&typeof Z=="object"&&typeof Z.then=="function"){if(I=v.alternate,I!==null&&Tc(I,v,_,!0),v=lo.current,v!==null){switch(v.tag){case 13:return _o===null?Rs():v.alternate===null&&qn===0&&(qn=3),v.flags&=-257,v.flags|=65536,v.lanes=_,Z===rh?v.flags|=16384:(I=v.updateQueue,I===null?v.updateQueue=new Set([Z]):I.add(Z),FI(d,Z,_)),!1;case 22:return v.flags|=65536,Z===rh?v.flags|=16384:(I=v.updateQueue,I===null?(I={transitions:null,markerInstances:null,retryQueue:new Set([Z])},v.updateQueue=I):(v=I.retryQueue,v===null?I.retryQueue=new Set([Z]):v.add(Z)),FI(d,Z,_)),!1}throw Error(i(435,v.tag))}return FI(d,Z,_),Rs(),!1}if(ii)return I=lo.current,I!==null?((I.flags&65536)===0&&(I.flags|=256),I.flags|=65536,I.lanes=_,Z!==pd&&(d=Error(i(422),{cause:Z}),pt(ce(d,v)))):(Z!==pd&&(I=Error(i(423),{cause:Z}),pt(ce(I,v))),d=d.current.alternate,d.flags|=65536,_&=-_,d.lanes|=_,Z=ce(Z,v),_=Po(d.stateNode,Z,_),he(d,_),qn!==4&&(qn=2)),!1;var K=Error(i(520),{cause:Z});if(K=ce(K,v),ru===null?ru=[K]:ru.push(K),qn!==4&&(qn=2),I===null)return!0;Z=ce(Z,v),v=I;do{switch(v.tag){case 3:return v.flags|=65536,d=_&-_,v.lanes|=d,d=Po(v.stateNode,Z,d),he(v,d),!1;case 1:if(I=v.type,K=v.stateNode,(v.flags&128)===0&&(typeof I.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(Io===null||!Io.has(K))))return v.flags|=65536,_&=-_,v.lanes|=_,_=yr(_),ma(_,d,v,Z),he(v,_),!1}v=v.return}while(v!==null);return!1}function ki(d,I,v,Z){I.child=d===null?TA(I,null,v,Z):oc(I,d.child,v,Z)}function Kc(d,I,v,Z,_){v=v.render;var K=I.ref;if("ref"in Z){var ge={};for(var Be in Z)Be!=="ref"&&(ge[Be]=Z[Be])}else ge=Z;return zc(I),Z=te(d,I,v,ge,K,_),Be=ke(),d!==null&&!na?(wt(d,I,_),qr(d,I,_)):(ii&&Be&&$(I),I.flags|=1,ki(d,I,Z,_),I.child)}function ku(d,I,v,Z,_){if(d===null){var K=v.type;return typeof K=="function"&&!al(K)&&K.defaultProps===void 0&&v.compare===null?(I.tag=15,I.type=K,Vg(d,I,K,Z,_)):(d=Ro(v.type,null,Z,I,I.mode,_),d.ref=I.ref,d.return=I,I.child=d)}if(K=d.child,!FC(d,_)){var ge=K.memoizedProps;if(v=v.compare,v=v!==null?v:lt,v(ge,Z)&&d.ref===I.ref)return qr(d,I,_)}return I.flags|=1,d=$a(K,Z),d.ref=I.ref,d.return=I,I.child=d}function Vg(d,I,v,Z,_){if(d!==null){var K=d.memoizedProps;if(lt(K,Z)&&d.ref===I.ref)if(na=!1,I.pendingProps=Z=K,FC(d,_))(d.flags&131072)!==0&&(na=!0);else return I.lanes=d.lanes,qr(d,I,_)}return wo(d,I,v,Z,_)}function Fa(d,I,v){var Z=I.pendingProps,_=Z.children,K=(I.stateNode._pendingVisibility&2)!==0,ge=d!==null?d.memoizedState:null;if(la(d,I),Z.mode==="hidden"||K){if((I.flags&128)!==0){if(Z=ge!==null?ge.baseLanes|v:v,d!==null){for(_=I.child=d.child,K=0;_!==null;)K=K|_.lanes|_.childLanes,_=_.sibling;I.childLanes=K&~Z}else I.childLanes=0,I.child=null;return xs(d,I,Z,v)}if((v&536870912)!==0)I.memoizedState={baseLanes:0,cachePool:null},d!==null&&xI(I,ge!==null?ge.cachePool:null),ge!==null?Ci(I,ge):Ge(),Zt(I);else return I.lanes=I.childLanes=536870912,xs(d,I,ge!==null?ge.baseLanes|v:v,v)}else ge!==null?(xI(I,ge.cachePool),Ci(I,ge),Mt(),I.memoizedState=null):(d!==null&&xI(I,null),Ge(),Mt());return ki(d,I,_,v),I.child}function xs(d,I,v,Z){var _=Fl();return _=_===null?null:{parent:Rr?gi._currentValue:gi._currentValue2,pool:_},I.memoizedState={baseLanes:v,cachePool:_},d!==null&&xI(I,null),Ge(),Zt(I),d!==null&&Tc(d,I,Z,!0),null}function la(d,I){var v=I.ref;if(v===null)d!==null&&d.ref!==null&&(I.flags|=2097664);else{if(typeof v!="function"&&typeof v!="object")throw Error(i(284));(d===null||d.ref!==v)&&(I.flags|=2097664)}}function wo(d,I,v,Z,_){return zc(I),v=te(d,I,v,Z,void 0,_),Z=ke(),d!==null&&!na?(wt(d,I,_),qr(d,I,_)):(ii&&Z&&$(I),I.flags|=1,ki(d,I,v,_),I.child)}function Uu(d,I,v,Z,_,K){return zc(I),I.updateQueue=null,v=Ne(I,Z,v,_),pe(d),Z=ke(),d!==null&&!na?(wt(d,I,K),qr(d,I,K)):(ii&&Z&&$(I),I.flags|=1,ki(d,I,v,K),I.child)}function _C(d,I,v,Z,_){if(zc(I),I.stateNode===null){var K=tg,ge=v.contextType;typeof ge=="object"&&ge!==null&&(K=Ka(ge)),K=new v(Z,K),I.memoizedState=K.state!==null&&K.state!==void 0?K.state:null,K.updater=ch,I.stateNode=K,K._reactInternals=I,K=I.stateNode,K.props=Z,K.state=I.memoizedState,K.refs={},Ht(I),ge=v.contextType,K.context=typeof ge=="object"&&ge!==null?Ka(ge):tg,K.state=I.memoizedState,ge=v.getDerivedStateFromProps,typeof ge=="function"&&(Ri(I,v,ge,Z),K.state=I.memoizedState),typeof v.getDerivedStateFromProps=="function"||typeof K.getSnapshotBeforeUpdate=="function"||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(ge=K.state,typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount(),ge!==K.state&&ch.enqueueReplaceState(K,K.state,null),Ct(I,Z,K,_),Ve(),K.state=I.memoizedState),typeof K.componentDidMount=="function"&&(I.flags|=4194308),Z=!0}else if(d===null){K=I.stateNode;var Be=I.memoizedProps,Ue=rs(v,Be);K.props=Ue;var Bt=K.context,Dt=v.contextType;ge=tg,typeof Dt=="object"&&Dt!==null&&(ge=Ka(Dt));var en=v.getDerivedStateFromProps;Dt=typeof en=="function"||typeof K.getSnapshotBeforeUpdate=="function",Be=I.pendingProps!==Be,Dt||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(Be||Bt!==ge)&&Qr(I,K,Z,ge),dl=!1;var nn=I.memoizedState;K.state=nn,Ct(I,Z,K,_),Ve(),Bt=I.memoizedState,Be||nn!==Bt||dl?(typeof en=="function"&&(Ri(I,v,en,Z),Bt=I.memoizedState),(Ue=dl||Jo(I,v,Ue,Z,nn,Bt,ge))?(Dt||typeof K.UNSAFE_componentWillMount!="function"&&typeof K.componentWillMount!="function"||(typeof K.componentWillMount=="function"&&K.componentWillMount(),typeof K.UNSAFE_componentWillMount=="function"&&K.UNSAFE_componentWillMount()),typeof K.componentDidMount=="function"&&(I.flags|=4194308)):(typeof K.componentDidMount=="function"&&(I.flags|=4194308),I.memoizedProps=Z,I.memoizedState=Bt),K.props=Z,K.state=Bt,K.context=ge,Z=Ue):(typeof K.componentDidMount=="function"&&(I.flags|=4194308),Z=!1)}else{K=I.stateNode,kt(d,I),ge=I.memoizedProps,Dt=rs(v,ge),K.props=Dt,en=I.pendingProps,nn=K.context,Bt=v.contextType,Ue=tg,typeof Bt=="object"&&Bt!==null&&(Ue=Ka(Bt)),Be=v.getDerivedStateFromProps,(Bt=typeof Be=="function"||typeof K.getSnapshotBeforeUpdate=="function")||typeof K.UNSAFE_componentWillReceiveProps!="function"&&typeof K.componentWillReceiveProps!="function"||(ge!==en||nn!==Ue)&&Qr(I,K,Z,Ue),dl=!1,nn=I.memoizedState,K.state=nn,Ct(I,Z,K,_),Ve();var wn=I.memoizedState;ge!==en||nn!==wn||dl||d!==null&&d.dependencies!==null&&El(d.dependencies)?(typeof Be=="function"&&(Ri(I,v,Be,Z),wn=I.memoizedState),(Dt=dl||Jo(I,v,Dt,Z,nn,wn,Ue)||d!==null&&d.dependencies!==null&&El(d.dependencies))?(Bt||typeof K.UNSAFE_componentWillUpdate!="function"&&typeof K.componentWillUpdate!="function"||(typeof K.componentWillUpdate=="function"&&K.componentWillUpdate(Z,wn,Ue),typeof K.UNSAFE_componentWillUpdate=="function"&&K.UNSAFE_componentWillUpdate(Z,wn,Ue)),typeof K.componentDidUpdate=="function"&&(I.flags|=4),typeof K.getSnapshotBeforeUpdate=="function"&&(I.flags|=1024)):(typeof K.componentDidUpdate!="function"||ge===d.memoizedProps&&nn===d.memoizedState||(I.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||ge===d.memoizedProps&&nn===d.memoizedState||(I.flags|=1024),I.memoizedProps=Z,I.memoizedState=wn),K.props=Z,K.state=wn,K.context=Ue,Z=Dt):(typeof K.componentDidUpdate!="function"||ge===d.memoizedProps&&nn===d.memoizedState||(I.flags|=4),typeof K.getSnapshotBeforeUpdate!="function"||ge===d.memoizedProps&&nn===d.memoizedState||(I.flags|=1024),Z=!1)}return K=Z,la(d,I),Z=(I.flags&128)!==0,K||Z?(K=I.stateNode,v=Z&&typeof v.getDerivedStateFromError!="function"?null:K.render(),I.flags|=1,d!==null&&Z?(I.child=oc(I,d.child,null,_),I.child=oc(I,null,v,_)):ki(d,I,v,_),I.memoizedState=K.state,d=I.child):d=qr(d,I,_),d}function km(d,I,v,Z){return Ee(),I.flags|=256,ki(d,I,v,Z),I.child}function XC(d){return{baseLanes:d,cachePool:Jm()}}function YC(d,I,v){return d=d!==null?d.childLanes&~v:0,I&&(d|=Ys),d}function Um(d,I,v){var Z=I.pendingProps,_=!1,K=(I.flags&128)!==0,ge;if((ge=K)||(ge=d!==null&&d.memoizedState===null?!1:(ga.current&2)!==0),ge&&(_=!0,I.flags&=-129),ge=(I.flags&32)!==0,I.flags&=-33,d===null){if(ii){if(_?Je(I):Mt(),ii){var Be=Ua,Ue;(Ue=Be)&&(Be=bp(Be,Vo),Be!==null?(I.memoizedState={dehydrated:Be,treeContext:tr!==null?{id:Vr,overflow:Wo}:null,retryLane:536870912},Ue=t(18,null,null,0),Ue.stateNode=Be,Ue.return=I,I.child=Ue,ts=I,Ua=null,Ue=!0):Ue=!1),Ue||ee(I)}if(Be=I.memoizedState,Be!==null&&(Be=Be.dehydrated,Be!==null))return ud(Be)?I.lanes=16:I.lanes=536870912,null;Gt(I)}return Be=Z.children,Z=Z.fallback,_?(Mt(),_=I.mode,Be=HC({mode:"hidden",children:Be},_),Z=ol(Z,_,v,null),Be.return=I,Z.return=I,Be.sibling=Z,I.child=Be,_=I.child,_.memoizedState=XC(v),_.childLanes=YC(d,ge,v),I.memoizedState=is,Z):(Je(I),Du(I,Be))}if(Ue=d.memoizedState,Ue!==null&&(Be=Ue.dehydrated,Be!==null)){if(K)I.flags&256?(Je(I),I.flags&=-257,I=EC(d,I,v)):I.memoizedState!==null?(Mt(),I.child=d.child,I.flags|=128,I=null):(Mt(),_=Z.fallback,Be=I.mode,Z=HC({mode:"visible",children:Z.children},Be),_=ol(_,Be,v,null),_.flags|=2,Z.return=I,_.return=I,Z.sibling=_,I.child=Z,oc(I,d.child,null,v),Z=I.child,Z.memoizedState=XC(v),Z.childLanes=YC(d,ge,v),I.memoizedState=is,I=_);else if(Je(I),ud(Be))ge=Ip(Be).digest,Z=Error(i(419)),Z.stack="",Z.digest=ge,pt({value:Z,source:null,stack:null}),I=EC(d,I,v);else if(na||Tc(d,I,v,!1),ge=(v&d.childLanes)!==0,na||ge){if(ge=Ln,ge!==null){if(Z=v&-v,(Z&42)!==0)Z=1;else switch(Z){case 2:Z=1;break;case 8:Z=4;break;case 32:Z=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:Z=64;break;case 268435456:Z=134217728;break;default:Z=0}if(Z=(Z&(ge.suspendedLanes|v))!==0?0:Z,Z!==0&&Z!==Ue.retryLane)throw Ue.retryLane=Z,dt(d,Z),qa(ge,d,Z),Xp}QI(Be)||Rs(),I=EC(d,I,v)}else QI(Be)?(I.flags|=128,I.child=d.child,I=jc.bind(null,d),Rv(Be,I),I=null):(d=Ue.treeContext,us&&(Ua=fp(Be),ts=I,ii=!0,so=null,Vo=!1,d!==null&&(io[ao++]=Vr,io[ao++]=Wo,io[ao++]=tr,Vr=d.id,Wo=d.overflow,tr=I)),I=Du(I,Z.children),I.flags|=4096);return I}return _?(Mt(),_=Z.fallback,Be=I.mode,Ue=d.child,K=Ue.sibling,Z=$a(Ue,{mode:"hidden",children:Z.children}),Z.subtreeFlags=Ue.subtreeFlags&31457280,K!==null?_=$a(K,_):(_=ol(_,Be,v,null),_.flags|=2),_.return=I,Z.return=I,Z.sibling=_,I.child=Z,Z=_,_=I.child,Be=d.child.memoizedState,Be===null?Be=XC(v):(Ue=Be.cachePool,Ue!==null?(K=Rr?gi._currentValue:gi._currentValue2,Ue=Ue.parent!==K?{parent:K,pool:K}:Ue):Ue=Jm(),Be={baseLanes:Be.baseLanes|v,cachePool:Ue}),_.memoizedState=Be,_.childLanes=YC(d,ge,v),I.memoizedState=is,Z):(Je(I),v=d.child,d=v.sibling,v=$a(v,{mode:"visible",children:Z.children}),v.return=I,v.sibling=null,d!==null&&(ge=I.deletions,ge===null?(I.deletions=[d],I.flags|=16):ge.push(d)),I.child=v,I.memoizedState=null,v)}function Du(d,I){return I=HC({mode:"visible",children:I},d.mode),I.return=d,d.child=I}function HC(d,I){return KI(d,I,0,null)}function EC(d,I,v){return oc(I,d.child,null,v),d=Du(I,I.pendingProps.children),d.flags|=2,I.memoizedState=null,d}function Dm(d,I,v){d.lanes|=I;var Z=d.alternate;Z!==null&&(Z.lanes|=I),KC(d.return,I,v)}function BI(d,I,v,Z,_){var K=d.memoizedState;K===null?d.memoizedState={isBackwards:I,rendering:null,renderingStartTime:0,last:Z,tail:v,tailMode:_}:(K.isBackwards=I,K.rendering=null,K.renderingStartTime=0,K.last=Z,K.tail=v,K.tailMode=_)}function Om(d,I,v){var Z=I.pendingProps,_=Z.revealOrder,K=Z.tail;if(ki(d,I,Z.children,v),Z=ga.current,(Z&2)!==0)Z=Z&1|2,I.flags|=128;else{if(d!==null&&(d.flags&128)!==0)e:for(d=I.child;d!==null;){if(d.tag===13)d.memoizedState!==null&&Dm(d,v,I);else if(d.tag===19)Dm(d,v,I);else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===I)break e;for(;d.sibling===null;){if(d.return===null||d.return===I)break e;d=d.return}d.sibling.return=d.return,d=d.sibling}Z&=1}switch(N(ga,Z),_){case"forwards":for(v=I.child,_=null;v!==null;)d=v.alternate,d!==null&&Ft(d)===null&&(_=v),v=v.sibling;v=_,v===null?(_=I.child,I.child=null):(_=v.sibling,v.sibling=null),BI(I,!1,_,v,K);break;case"backwards":for(v=null,_=I.child,I.child=null;_!==null;){if(d=_.alternate,d!==null&&Ft(d)===null){I.child=_;break}d=_.sibling,_.sibling=v,v=_,_=d}BI(I,!0,v,null,K);break;case"together":BI(I,!1,null,null,void 0);break;default:I.memoizedState=null}return I.child}function qr(d,I,v){if(d!==null&&(I.dependencies=d.dependencies),go|=I.lanes,(v&I.childLanes)===0)if(d!==null){if(Tc(d,I,v,!1),(v&I.childLanes)===0)return null}else return null;if(d!==null&&I.child!==d.child)throw Error(i(153));if(I.child!==null){for(d=I.child,v=$a(d,d.pendingProps),I.child=v,v.return=I;d.sibling!==null;)d=d.sibling,v=v.sibling=$a(d,d.pendingProps),v.return=I;v.sibling=null}return I.child}function FC(d,I){return(d.lanes&I)!==0?!0:(d=d.dependencies,!!(d!==null&&El(d)))}function xv(d,I,v){switch(I.tag){case 3:Ie(I,I.stateNode.containerInfo),Hl(I,gi,d.memoizedState.cache),Ee();break;case 27:case 5:D(I);break;case 4:Ie(I,I.stateNode.containerInfo);break;case 10:Hl(I,I.type,I.memoizedProps.value);break;case 13:var Z=I.memoizedState;if(Z!==null)return Z.dehydrated!==null?(Je(I),I.flags|=128,null):(v&I.child.childLanes)!==0?Um(d,I,v):(Je(I),d=qr(d,I,v),d!==null?d.sibling:null);Je(I);break;case 19:var _=(d.flags&128)!==0;if(Z=(v&I.childLanes)!==0,Z||(Tc(d,I,v,!1),Z=(v&I.childLanes)!==0),_){if(Z)return Om(d,I,v);I.flags|=128}if(_=I.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),N(ga,ga.current),Z)break;return null;case 22:case 23:return I.lanes=0,Fa(d,I,v);case 24:Hl(I,gi,d.memoizedState.cache)}return qr(d,I,v)}function jm(d,I,v){if(d!==null)if(d.memoizedProps!==I.pendingProps)na=!0;else{if(!FC(d,v)&&(I.flags&128)===0)return na=!1,xv(d,I,v);na=(d.flags&131072)!==0}else na=!1,ii&&(I.flags&1048576)!==0&&T(I,fd,I.index);switch(I.lanes=0,I.tag){case 16:e:{d=I.pendingProps;var Z=I.elementType,_=Z._init;if(Z=_(Z._payload),I.type=Z,typeof Z=="function")al(Z)?(d=rs(Z,d),I.tag=1,I=_C(null,I,Z,d,v)):(I.tag=0,I=wo(null,I,Z,d,v));else{if(Z!=null){if(_=Z.$$typeof,_===jg){I.tag=11,I=Kc(null,I,Z,d,v);break e}else if(_===id){I.tag=14,I=ku(null,I,Z,d,v);break e}}throw I=o(Z)||Z,Error(i(306,I,""))}}return I;case 0:return wo(d,I,I.type,I.pendingProps,v);case 1:return Z=I.type,_=rs(Z,I.pendingProps),_C(d,I,Z,_,v);case 3:e:{if(Ie(I,I.stateNode.containerInfo),d===null)throw Error(i(387));var K=I.pendingProps;_=I.memoizedState,Z=_.element,kt(d,I),Ct(I,K,null,v);var ge=I.memoizedState;if(K=ge.cache,Hl(I,gi,K),K!==_.cache&&TC(I,[gi],v,!0),Ve(),K=ge.element,us&&_.isDehydrated)if(_={element:K,isDehydrated:!1,cache:ge.cache},I.updateQueue.baseState=_,I.memoizedState=_,I.flags&256){I=km(d,I,K,v);break e}else if(K!==Z){Z=ce(Error(i(424)),I),pt(Z),I=km(d,I,K,v);break e}else for(us&&(Ua=Ap(I.stateNode.containerInfo),ts=I,ii=!0,so=null,Vo=!0),v=TA(I,null,K,v),I.child=v;v;)v.flags=v.flags&-3|4096,v=v.sibling;else{if(Ee(),K===Z){I=qr(d,I,v);break e}ki(d,I,K,v)}I=I.child}return I;case 26:if(to)return la(d,I),d===null?(v=nh(I.type,null,I.pendingProps,null))?I.memoizedState=v:ii||(I.stateNode=Wv(I.type,I.pendingProps,nr.current,I)):I.memoizedState=nh(I.type,d.memoizedProps,I.pendingProps,d.memoizedState),null;case 27:if(La)return D(I),d===null&&La&&ii&&(Z=I.stateNode=HA(I.type,I.pendingProps,nr.current,Va.current,!1),ts=I,Vo=!0,Ua=qI(Z)),Z=I.pendingProps.children,d!==null||ii?ki(d,I,Z,v):I.child=oc(I,null,Z,v),la(d,I),I.child;case 5:return d===null&&ii&&(Sp(I.type,I.pendingProps,Va.current),(_=Z=Ua)&&(Z=mp(Z,I.type,I.pendingProps,Vo),Z!==null?(I.stateNode=Z,ts=I,Ua=qI(Z),Vo=!1,_=!0):_=!1),_||ee(I)),D(I),_=I.type,K=I.pendingProps,ge=d!==null?d.memoizedProps:null,Z=K.children,tc(_,K)?Z=null:ge!==null&&tc(_,ge)&&(I.flags|=32),I.memoizedState!==null&&(_=te(d,I,De,null,null,v),Rr?Gn._currentValue=_:Gn._currentValue2=_),la(d,I),ki(d,I,Z,v),I.child;case 6:return d===null&&ii&&(xp(I.pendingProps,Va.current),(d=v=Ua)&&(v=pp(v,I.pendingProps,Vo),v!==null?(I.stateNode=v,ts=I,Ua=null,d=!0):d=!1),d||ee(I)),null;case 13:return Um(d,I,v);case 4:return Ie(I,I.stateNode.containerInfo),Z=I.pendingProps,d===null?I.child=oc(I,null,Z,v):ki(d,I,Z,v),I.child;case 11:return Kc(d,I,I.type,I.pendingProps,v);case 7:return ki(d,I,I.pendingProps,v),I.child;case 8:return ki(d,I,I.pendingProps.children,v),I.child;case 12:return ki(d,I,I.pendingProps.children,v),I.child;case 10:return Z=I.pendingProps,Hl(I,I.type,Z.value),ki(d,I,Z.children,v),I.child;case 9:return _=I.type._context,Z=I.pendingProps.children,zc(I),_=Ka(_),Z=Z(_),I.flags|=1,ki(d,I,Z,v),I.child;case 14:return ku(d,I,I.type,I.pendingProps,v);case 15:return Vg(d,I,I.type,I.pendingProps,v);case 19:return Om(d,I,v);case 22:return Fa(d,I,v);case 24:return zc(I),Z=Ka(gi),d===null?(_=Fl(),_===null&&(_=Ln,K=SI(),_.pooledCache=K,K.refCount++,K!==null&&(_.pooledCacheLanes|=v),_=K),I.memoizedState={parent:Z,cache:_},Ht(I),Hl(I,gi,_)):((d.lanes&v)!==0&&(kt(d,I),Ct(I,null,null,v),Ve()),_=d.memoizedState,K=I.memoizedState,_.parent!==Z?(_={parent:Z,cache:Z},I.memoizedState=_,I.lanes===0&&(I.memoizedState=I.updateQueue.baseState=_),Hl(I,gi,Z)):(Z=K.cache,Hl(I,gi,Z),Z!==_.cache&&TC(I,[gi],v,!0))),ki(d,I,I.pendingProps.children,v),I.child;case 29:throw I.pendingProps}throw Error(i(156,I.tag))}function Hl(d,I,v){Rr?(N(_s,I._currentValue),I._currentValue=v):(N(_s,I._currentValue2),I._currentValue2=v)}function $r(d){var I=_s.current;Rr?d._currentValue=I:d._currentValue2=I,S(_s)}function KC(d,I,v){for(;d!==null;){var Z=d.alternate;if((d.childLanes&I)!==I?(d.childLanes|=I,Z!==null&&(Z.childLanes|=I)):Z!==null&&(Z.childLanes&I)!==I&&(Z.childLanes|=I),d===v)break;d=d.return}}function TC(d,I,v,Z){var _=d.child;for(_!==null&&(_.return=d);_!==null;){var K=_.dependencies;if(K!==null){var ge=_.child;K=K.firstContext;e:for(;K!==null;){var Be=K;K=_;for(var Ue=0;Ue<I.length;Ue++)if(Be.context===I[Ue]){K.lanes|=v,Be=K.alternate,Be!==null&&(Be.lanes|=v),KC(K.return,v,d),Z||(ge=null);break e}K=Be.next}}else if(_.tag===18){if(ge=_.return,ge===null)throw Error(i(341));ge.lanes|=v,K=ge.alternate,K!==null&&(K.lanes|=v),KC(ge,v,d),ge=null}else ge=_.child;if(ge!==null)ge.return=_;else for(ge=_;ge!==null;){if(ge===d){ge=null;break}if(_=ge.sibling,_!==null){_.return=ge.return,ge=_;break}ge=ge.return}_=ge}}function Tc(d,I,v,Z){d=null;for(var _=I,K=!1;_!==null;){if(!K){if((_.flags&524288)!==0)K=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var ge=_.alternate;if(ge===null)throw Error(i(387));if(ge=ge.memoizedProps,ge!==null){var Be=_.type;no(_.pendingProps.value,ge.value)||(d!==null?d.push(Be):d=[Be])}}else if(_===tu.current){if(ge=_.alternate,ge===null)throw Error(i(387));ge.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(d!==null?d.push(Gn):d=[Gn])}_=_.return}d!==null&&TC(I,d,v,Z),I.flags|=262144}function El(d){for(d=d.firstContext;d!==null;){var I=d.context;if(!no(Rr?I._currentValue:I._currentValue2,d.memoizedValue))return!0;d=d.next}return!1}function zc(d){lc=d,Ji=null,d=d.dependencies,d!==null&&(d.firstContext=null)}function Ka(d){return zC(lc,d)}function Ou(d,I){return lc===null&&zc(d),zC(d,I)}function zC(d,I){var v=Rr?I._currentValue:I._currentValue2;if(I={context:I,memoizedValue:v,next:null},Ji===null){if(d===null)throw Error(i(308));Ji=I,d.dependencies={lanes:0,firstContext:I},d.flags|=524288}else Ji=Ji.next=I;return v}function SI(){return{controller:new Yp,data:new Map,refCount:0}}function Mg(d){d.refCount--,d.refCount===0&&hl(ag,function(){d.controller.abort()})}function Fl(){var d=Cl.current;return d!==null?d:Ln.pooledCache}function xI(d,I){I===null?N(Cl,Cl.current):N(Cl,I.pool)}function Jm(){var d=Fl();return d===null?null:{parent:Rr?gi._currentValue:gi._currentValue2,pool:d}}function Ps(d){d.flags|=4}function LC(d,I){if(d!==null&&d.child===I.child)return!1;if((I.flags&16)!==0)return!0;for(d=I.child;d!==null;){if((d.flags&13878)!==0||(d.subtreeFlags&13878)!==0)return!0;d=d.sibling}return!1}function ZI(d,I,v,Z){if(za)for(v=I.child;v!==null;){if(v.tag===5||v.tag===6)wr(d,v.stateNode);else if(!(v.tag===4||La&&v.tag===27)&&v.child!==null){v.child.return=v,v=v.child;continue}if(v===I)break;for(;v.sibling===null;){if(v.return===null||v.return===I)return;v=v.return}v.sibling.return=v.return,v=v.sibling}else if($s)for(var _=I.child;_!==null;){if(_.tag===5){var K=_.stateNode;v&&Z&&(K=BA(K,_.type,_.memoizedProps)),wr(d,K)}else if(_.tag===6)K=_.stateNode,v&&Z&&(K=SA(K,_.memoizedProps)),wr(d,K);else if(_.tag!==4){if(_.tag===22&&_.memoizedState!==null)K=_.child,K!==null&&(K.return=_),ZI(d,_,!0,!0);else if(_.child!==null){_.child.return=_,_=_.child;continue}}if(_===I)break;for(;_.sibling===null;){if(_.return===null||_.return===I)return;_=_.return}_.sibling.return=_.return,_=_.sibling}}function _g(d,I,v,Z){if($s)for(var _=I.child;_!==null;){if(_.tag===5){var K=_.stateNode;v&&Z&&(K=BA(K,_.type,_.memoizedProps)),vA(d,K)}else if(_.tag===6)K=_.stateNode,v&&Z&&(K=SA(K,_.memoizedProps)),vA(d,K);else if(_.tag!==4){if(_.tag===22&&_.memoizedState!==null)K=_.child,K!==null&&(K.return=_),_g(d,_,!(_.memoizedProps!==null&&_.memoizedProps.mode==="manual"),!0);else if(_.child!==null){_.child.return=_,_=_.child;continue}}if(_===I)break;for(;_.sibling===null;){if(_.return===null||_.return===I)return;_=_.return}_.sibling.return=_.return,_=_.sibling}}function Xg(d,I){if($s&&LC(d,I)){d=I.stateNode;var v=d.containerInfo,Z=PI();_g(Z,I,!1,!1),d.pendingChildren=Z,Ps(I),dp(v,Z)}}function kC(d,I,v,Z){if(za)d.memoizedProps!==Z&&Ps(I);else if($s){var _=d.stateNode,K=d.memoizedProps;if((d=LC(d,I))||K!==Z){var ge=Va.current;K=yA(_,v,K,Z,!d,null),K===_?I.stateNode=_:(ll(K,v,Z,ge)&&Ps(I),I.stateNode=K,d?ZI(K,I,!1,!1):Ps(I))}else I.stateNode=_}}function Yg(d,I,v){if(cp(I,v)){if(d.flags|=16777216,!cl(I,v))if($u())d.flags|=8192;else throw ig=rh,KA}else d.flags&=-16777217}function UC(d,I){if(Zp(I)){if(d.flags|=16777216,!XA(I))if($u())d.flags|=8192;else throw ig=rh,KA}else d.flags&=-16777217}function ju(d,I){I!==null&&(d.flags|=4),d.flags&16384&&(I=d.tag!==22?M():536870912,d.lanes|=I,fl|=I)}function Lc(d,I){if(!ii)switch(d.tailMode){case"hidden":I=d.tail;for(var v=null;I!==null;)I.alternate!==null&&(v=I),I=I.sibling;v===null?d.tail=null:v.sibling=null;break;case"collapsed":v=d.tail;for(var Z=null;v!==null;)v.alternate!==null&&(Z=v),v=v.sibling;Z===null?I||d.tail===null?d.tail=null:d.tail.sibling=null:Z.sibling=null}}function Ni(d){var I=d.alternate!==null&&d.alternate.child===d.child,v=0,Z=0;if(I)for(var _=d.child;_!==null;)v|=_.lanes|_.childLanes,Z|=_.subtreeFlags&31457280,Z|=_.flags&31457280,_.return=d,_=_.sibling;else for(_=d.child;_!==null;)v|=_.lanes|_.childLanes,Z|=_.subtreeFlags,Z|=_.flags,_.return=d,_=_.sibling;return d.subtreeFlags|=Z,d.childLanes=v,I}function Pm(d,I,v){var Z=I.pendingProps;switch(ae(I),I.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Ni(I),null;case 1:return Ni(I),null;case 3:return v=I.stateNode,Z=null,d!==null&&(Z=d.memoizedState.cache),I.memoizedState.cache!==Z&&(I.flags|=2048),$r(gi),be(),v.pendingContext&&(v.context=v.pendingContext,v.pendingContext=null),(d===null||d.child===null)&&(Ye(I)?Ps(I):d===null||d.memoizedState.isDehydrated&&(I.flags&256)===0||(I.flags|=1024,so!==null&&(tl(so),so=null))),Xg(d,I),Ni(I),null;case 26:if(to){v=I.type;var _=I.memoizedState;return d===null?(Ps(I),_!==null?(Ni(I),UC(I,_)):(Ni(I),Yg(I,v,Z))):_?_!==d.memoizedState?(Ps(I),Ni(I),UC(I,_)):(Ni(I),I.flags&=-16777217):(za?d.memoizedProps!==Z&&Ps(I):kC(d,I,v,Z),Ni(I),Yg(I,v,Z)),null}case 27:if(La){if(de(I),v=nr.current,_=I.type,d!==null&&I.stateNode!=null)za?d.memoizedProps!==Z&&Ps(I):kC(d,I,_,Z);else{if(!Z){if(I.stateNode===null)throw Error(i(166));return Ni(I),null}d=Va.current,Ye(I)?Ce(I,d):(d=HA(_,Z,v,d,!0),I.stateNode=d,Ps(I))}return Ni(I),null}case 5:if(de(I),v=I.type,d!==null&&I.stateNode!=null)kC(d,I,v,Z);else{if(!Z){if(I.stateNode===null)throw Error(i(166));return Ni(I),null}d=Va.current,Ye(I)?Ce(I,d):(_=gA(v,Z,nr.current,d,I),ZI(_,I,!1,!1),I.stateNode=_,ll(_,v,Z,d)&&Ps(I))}return Ni(I),Yg(I,I.type,I.pendingProps),null;case 6:if(d&&I.stateNode!=null)v=d.memoizedProps,za?v!==Z&&Ps(I):$s&&(v!==Z?(I.stateNode=kI(Z,nr.current,Va.current,I),Ps(I)):I.stateNode=d.stateNode);else{if(typeof Z!="string"&&I.stateNode===null)throw Error(i(166));if(d=nr.current,v=Va.current,Ye(I)){if(!us)throw Error(i(176));if(d=I.stateNode,v=I.memoizedProps,Z=null,_=ts,_!==null)switch(_.tag){case 27:case 5:Z=_.memoizedProps}yp(d,v,I,Z)||ee(I)}else I.stateNode=kI(Z,d,v,I)}return Ni(I),null;case 13:if(Z=I.memoizedState,d===null||d.memoizedState!==null&&d.memoizedState.dehydrated!==null){if(_=Ye(I),Z!==null&&Z.dehydrated!==null){if(d===null){if(!_)throw Error(i(318));if(!us)throw Error(i(344));if(_=I.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(i(317));Pg(_,I)}else Ee(),(I.flags&128)===0&&(I.memoizedState=null),I.flags|=4;Ni(I),_=!1}else so!==null&&(tl(so),so=null),_=!0;if(!_)return I.flags&256?(Gt(I),I):(Gt(I),null)}if(Gt(I),(I.flags&128)!==0)return I.lanes=v,I;if(v=Z!==null,d=d!==null&&d.memoizedState!==null,v){Z=I.child,_=null,Z.alternate!==null&&Z.alternate.memoizedState!==null&&Z.alternate.memoizedState.cachePool!==null&&(_=Z.alternate.memoizedState.cachePool.pool);var K=null;Z.memoizedState!==null&&Z.memoizedState.cachePool!==null&&(K=Z.memoizedState.cachePool.pool),K!==_&&(Z.flags|=2048)}return v!==d&&v&&(I.child.flags|=8192),ju(I,I.updateQueue),Ni(I),null;case 4:return be(),Xg(d,I),d===null&&IA(I.stateNode.containerInfo),Ni(I),null;case 10:return $r(I.type),Ni(I),null;case 19:if(S(ga),_=I.memoizedState,_===null)return Ni(I),null;if(Z=(I.flags&128)!==0,K=_.rendering,K===null)if(Z)Lc(_,!1);else{if(qn!==0||d!==null&&(d.flags&128)!==0)for(d=I.child;d!==null;){if(K=Ft(d),K!==null){for(I.flags|=128,Lc(_,!1),d=K.updateQueue,I.updateQueue=d,ju(I,d),I.subtreeFlags=0,d=v,v=I.child;v!==null;)sl(v,d),v=v.sibling;return N(ga,ga.current&1|2),I.child}d=d.sibling}_.tail!==null&&ka()>zi&&(I.flags|=128,Z=!0,Lc(_,!1),I.lanes=4194304)}else{if(!Z)if(d=Ft(K),d!==null){if(I.flags|=128,Z=!0,d=d.updateQueue,I.updateQueue=d,ju(I,d),Lc(_,!0),_.tail===null&&_.tailMode==="hidden"&&!K.alternate&&!ii)return Ni(I),null}else 2*ka()-_.renderingStartTime>zi&&v!==536870912&&(I.flags|=128,Z=!0,Lc(_,!1),I.lanes=4194304);_.isBackwards?(K.sibling=I.child,I.child=K):(d=_.last,d!==null?d.sibling=K:I.child=K,_.last=K)}return _.tail!==null?(I=_.tail,_.rendering=I,_.tail=I.sibling,_.renderingStartTime=ka(),I.sibling=null,d=ga.current,N(ga,Z?d&1|2:d&1),I):(Ni(I),null);case 22:case 23:return Gt(I),Xe(),Z=I.memoizedState!==null,d!==null?d.memoizedState!==null!==Z&&(I.flags|=8192):Z&&(I.flags|=8192),Z?(v&536870912)!==0&&(I.flags&128)===0&&(Ni(I),I.subtreeFlags&6&&(I.flags|=8192)):Ni(I),v=I.updateQueue,v!==null&&ju(I,v.retryQueue),v=null,d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),Z=null,I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(Z=I.memoizedState.cachePool.pool),Z!==v&&(I.flags|=2048),d!==null&&S(Cl),null;case 24:return v=null,d!==null&&(v=d.memoizedState.cache),I.memoizedState.cache!==v&&(I.flags|=2048),$r(gi),Ni(I),null;case 25:return null}throw Error(i(156,I.tag))}function Qm(d,I){switch(ae(I),I.tag){case 1:return d=I.flags,d&65536?(I.flags=d&-65537|128,I):null;case 3:return $r(gi),be(),d=I.flags,(d&65536)!==0&&(d&128)===0?(I.flags=d&-65537|128,I):null;case 26:case 27:case 5:return de(I),null;case 13:if(Gt(I),d=I.memoizedState,d!==null&&d.dehydrated!==null){if(I.alternate===null)throw Error(i(340));Ee()}return d=I.flags,d&65536?(I.flags=d&-65537|128,I):null;case 19:return S(ga),null;case 4:return be(),null;case 10:return $r(I.type),null;case 22:case 23:return Gt(I),Xe(),d!==null&&S(Cl),d=I.flags,d&65536?(I.flags=d&-65537|128,I):null;case 24:return $r(gi),null;case 25:return null;default:return null}}function DC(d,I){switch(ae(I),I.tag){case 3:$r(gi),be();break;case 26:case 27:case 5:de(I);break;case 4:be();break;case 13:Gt(I);break;case 19:S(ga);break;case 10:$r(I.type);break;case 22:case 23:Gt(I),Xe(),d!==null&&S(Cl);break;case 24:$r(gi)}}function Ju(d,I){try{var v=I.updateQueue,Z=v!==null?v.lastEffect:null;if(Z!==null){var _=Z.next;v=_;do{if((v.tag&d)===d){Z=void 0;var K=v.create,ge=v.inst;Z=K(),ge.destroy=Z}v=v.next}while(v!==_)}}catch(Be){Un(I,I.return,Be)}}function Kl(d,I,v){try{var Z=I.updateQueue,_=Z!==null?Z.lastEffect:null;if(_!==null){var K=_.next;Z=K;do{if((Z.tag&d)===d){var ge=Z.inst,Be=ge.destroy;if(Be!==void 0){ge.destroy=void 0,_=I;var Ue=v;try{Be()}catch(Bt){Un(_,Ue,Bt)}}}Z=Z.next}while(Z!==K)}}catch(Bt){Un(I,I.return,Bt)}}function qm(d){var I=d.updateQueue;if(I!==null){var v=d.stateNode;try{Re(I,v)}catch(Z){Un(d,d.return,Z)}}}function $m(d,I,v){v.props=rs(d.type,d.memoizedProps),v.state=d.memoizedState;try{v.componentWillUnmount()}catch(Z){Un(d,I,Z)}}function kc(d,I){try{var v=d.ref;if(v!==null){var Z=d.stateNode;switch(d.tag){case 26:case 27:case 5:var _=Jg(Z);break;default:_=Z}typeof v=="function"?d.refCleanup=v(_):v.current=_}}catch(K){Un(d,I,K)}}function Wi(d,I){var v=d.ref,Z=d.refCleanup;if(v!==null)if(typeof Z=="function")try{Z()}catch(_){Un(d,I,_)}finally{d.refCleanup=null,d=d.alternate,d!=null&&(d.refCleanup=null)}else if(typeof v=="function")try{v(null)}catch(_){Un(d,I,_)}else v.current=null}function Hg(d){var I=d.type,v=d.memoizedProps,Z=d.stateNode;try{wv(Z,I,v,d)}catch(_){Un(d,d.return,_)}}function OC(d,I,v){try{fA(d.stateNode,d.type,v,I,d)}catch(Z){Un(d,d.return,Z)}}function jC(d){return d.tag===5||d.tag===3||(to?d.tag===26:!1)||(La?d.tag===27:!1)||d.tag===4}function wI(d){e:for(;;){for(;d.sibling===null;){if(d.return===null||jC(d.return))return null;d=d.return}for(d.sibling.return=d.return,d=d.sibling;d.tag!==5&&d.tag!==6&&(!La||d.tag!==27)&&d.tag!==18;){if(d.flags&2||d.child===null||d.tag===4)continue e;d.child.return=d,d=d.child}if(!(d.flags&2))return d.stateNode}}function RI(d,I,v){var Z=d.tag;if(Z===5||Z===6)d=d.stateNode,I?pA(v,d,I):gp(v,d);else if(!(Z===4||La&&Z===27)&&(d=d.child,d!==null))for(RI(d,I,v),d=d.sibling;d!==null;)RI(d,I,v),d=d.sibling}function Eg(d,I,v){var Z=d.tag;if(Z===5||Z===6)d=d.stateNode,I?mA(v,d,I):AA(v,d);else if(!(Z===4||La&&Z===27)&&(d=d.child,d!==null))for(Eg(d,I,v),d=d.sibling;d!==null;)Eg(d,I,v),d=d.sibling}function ep(d,I,v){d=d.containerInfo;try{GA(d,v)}catch(Z){Un(I,I.return,Z)}}function Fg(d,I){for(ec(d.containerInfo),Pi=I;Pi!==null;)if(d=Pi,I=d.child,(d.subtreeFlags&1028)!==0&&I!==null)I.return=d,Pi=I;else for(;Pi!==null;){d=Pi;var v=d.alternate;switch(I=d.flags,d.tag){case 0:break;case 11:case 15:break;case 1:if((I&1024)!==0&&v!==null){I=void 0;var Z=d,_=v.memoizedProps;v=v.memoizedState;var K=Z.stateNode;try{var ge=rs(Z.type,_,Z.elementType===Z.type);I=K.getSnapshotBeforeUpdate(ge,v),K.__reactInternalSnapshotBeforeUpdate=I}catch(Be){Un(Z,Z.return,Be)}}break;case 3:(I&1024)!==0&&za&&JI(d.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((I&1024)!==0)throw Error(i(163))}if(I=d.sibling,I!==null){I.return=d.return,Pi=I;break}Pi=d.return}return ge=sg,sg=!1,ge}function NI(d,I,v){var Z=v.flags;switch(v.tag){case 0:case 11:case 15:vr(d,v),Z&4&&Ju(5,v);break;case 1:if(vr(d,v),Z&4)if(d=v.stateNode,I===null)try{d.componentDidMount()}catch(Be){Un(v,v.return,Be)}else{var _=rs(v.type,I.memoizedProps);I=I.memoizedState;try{d.componentDidUpdate(_,I,d.__reactInternalSnapshotBeforeUpdate)}catch(Be){Un(v,v.return,Be)}}Z&64&&qm(v),Z&512&&kc(v,v.return);break;case 3:if(vr(d,v),Z&64&&(Z=v.updateQueue,Z!==null)){if(d=null,v.child!==null)switch(v.child.tag){case 27:case 5:d=Jg(v.child.stateNode);break;case 1:d=v.child.stateNode}try{Re(Z,d)}catch(Be){Un(v,v.return,Be)}}break;case 26:if(to){vr(d,v),Z&512&&kc(v,v.return);break}case 27:case 5:vr(d,v),I===null&&Z&4&&Hg(v),Z&512&&kc(v,v.return);break;case 12:vr(d,v);break;case 13:vr(d,v),Z&4&&Tl(d,v);break;case 22:if(_=v.memoizedState!==null||ba,!_){I=I!==null&&I.memoizedState!==null||Ti;var K=ba,ge=Ti;ba=_,(Ti=I)&&!ge?Ll(d,v,(v.subtreeFlags&8772)!==0):vr(d,v),ba=K,Ti=ge}Z&512&&(v.memoizedProps.mode==="manual"?kc(v,v.return):Wi(v,v.return));break;default:vr(d,v)}}function Kg(d){var I=d.alternate;I!==null&&(d.alternate=null,Kg(I)),d.child=null,d.deletions=null,d.sibling=null,d.tag===5&&(I=d.stateNode,I!==null&&hA(I)),d.stateNode=null,d.return=null,d.dependencies=null,d.memoizedProps=null,d.memoizedState=null,d.pendingProps=null,d.stateNode=null,d.updateQueue=null}function Qs(d,I,v){for(v=v.child;v!==null;)WI(d,I,v),v=v.sibling}function WI(d,I,v){if(Vs&&typeof Vs.onCommitFiberUnmount=="function")try{Vs.onCommitFiberUnmount(eu,v)}catch{}switch(v.tag){case 26:if(to){Ti||Wi(v,I),Qs(d,I,v),v.memoizedState?NA(v.memoizedState):v.stateNode&&MA(v.stateNode);break}case 27:if(La){Ti||Wi(v,I);var Z=ia,_=Xs;ia=v.stateNode,Qs(d,I,v),wp(v.stateNode),ia=Z,Xs=_;break}case 5:Ti||Wi(v,I);case 6:if(za){if(Z=ia,_=Xs,ia=null,Qs(d,I,v),ia=Z,Xs=_,ia!==null)if(Xs)try{ea(ia,v.stateNode)}catch(K){Un(v,I,K)}else try{ds(ia,v.stateNode)}catch(K){Un(v,I,K)}}else Qs(d,I,v);break;case 18:za&&ia!==null&&(Xs?ZA(ia,v.stateNode):Gp(ia,v.stateNode));break;case 4:za?(Z=ia,_=Xs,ia=v.stateNode.containerInfo,Xs=!0,Qs(d,I,v),ia=Z,Xs=_):($s&&ep(v.stateNode,v,PI()),Qs(d,I,v));break;case 0:case 11:case 14:case 15:Ti||Kl(2,v,I),Ti||Kl(4,v,I),Qs(d,I,v);break;case 1:Ti||(Wi(v,I),Z=v.stateNode,typeof Z.componentWillUnmount=="function"&&$m(v,I,Z)),Qs(d,I,v);break;case 21:Qs(d,I,v);break;case 22:Ti||Wi(v,I),Ti=(Z=Ti)||v.memoizedState!==null,Qs(d,I,v),Ti=Z;break;default:Qs(d,I,v)}}function Tl(d,I){if(us&&I.memoizedState===null&&(d=I.alternate,d!==null&&(d=d.memoizedState,d!==null&&(d=d.dehydrated,d!==null))))try{eh(d)}catch(v){Un(I,I.return,v)}}function Tg(d){switch(d.tag){case 13:case 19:var I=d.stateNode;return I===null&&(I=d.stateNode=new ou),I;case 22:return d=d.stateNode,I=d._retryCache,I===null&&(I=d._retryCache=new ou),I;default:throw Error(i(435,d.tag))}}function Pu(d,I){var v=Tg(d);I.forEach(function(Z){var _=$C.bind(null,d,Z);v.has(Z)||(v.add(Z),Z.then(_,_))})}function ls(d,I){var v=I.deletions;if(v!==null)for(var Z=0;Z<v.length;Z++){var _=v[Z],K=d,ge=I;if(za){var Be=ge;e:for(;Be!==null;){switch(Be.tag){case 27:case 5:ia=Be.stateNode,Xs=!1;break e;case 3:ia=Be.stateNode.containerInfo,Xs=!0;break e;case 4:ia=Be.stateNode.containerInfo,Xs=!0;break e}Be=Be.return}if(ia===null)throw Error(i(160));WI(K,ge,_),ia=null,Xs=!1}else WI(K,ge,_);K=_.alternate,K!==null&&(K.return=null),_.return=null}if(I.subtreeFlags&13878)for(I=I.child;I!==null;)zl(I,d),I=I.sibling}function zl(d,I){var v=d.alternate,Z=d.flags;switch(d.tag){case 0:case 11:case 14:case 15:ls(I,d),Zs(d),Z&4&&(Kl(3,d,d.return),Ju(3,d),Kl(5,d,d.return));break;case 1:ls(I,d),Zs(d),Z&512&&(Ti||v===null||Wi(v,v.return)),Z&64&&ba&&(d=d.updateQueue,d!==null&&(Z=d.callbacks,Z!==null&&(v=d.shared.hiddenCallbacks,d.shared.hiddenCallbacks=v===null?Z:v.concat(Z))));break;case 26:if(to){var _=Is;ls(I,d),Zs(d),Z&512&&(Ti||v===null||Wi(v,v.return)),Z&4&&(Z=v!==null?v.memoizedState:null,I=d.memoizedState,v===null?I===null?d.stateNode===null?d.stateNode=WA(_,d.type,d.memoizedProps,d):VA(_,d.type,d.stateNode):d.stateNode=RA(_,I,d.memoizedProps):Z!==I?(Z===null?v.stateNode!==null&&MA(v.stateNode):NA(Z),I===null?VA(_,d.type,d.stateNode):RA(_,I,d.memoizedProps)):I===null&&d.stateNode!==null&&OC(d,d.memoizedProps,v.memoizedProps));break}case 27:if(La&&Z&4&&d.alternate===null){_=d.stateNode;var K=d.memoizedProps;try{Vv(_),Mv(d.type,K,_,d)}catch(Dt){Un(d,d.return,Dt)}}case 5:if(ls(I,d),Zs(d),Z&512&&(Ti||v===null||Wi(v,v.return)),za){if(d.flags&32){I=d.stateNode;try{cd(I)}catch(Dt){Un(d,d.return,Dt)}}Z&4&&d.stateNode!=null&&(I=d.memoizedProps,OC(d,I,v!==null?v.memoizedProps:I)),Z&1024&&(cc=!0)}break;case 6:if(ls(I,d),Zs(d),Z&4&&za){if(d.stateNode===null)throw Error(i(162));Z=d.memoizedProps,v=v!==null?v.memoizedProps:Z,I=d.stateNode;try{up(I,v,Z)}catch(Dt){Un(d,d.return,Dt)}}break;case 3:if(to?(_A(),_=Is,Is=th(I.containerInfo),ls(I,d),Is=_):ls(I,d),Zs(d),Z&4){if(za&&us&&v!==null&&v.memoizedState.isDehydrated)try{$I(I.containerInfo)}catch(Dt){Un(d,d.return,Dt)}if($s){Z=I.containerInfo,v=I.pendingChildren;try{GA(Z,v)}catch(Dt){Un(d,d.return,Dt)}}}cc&&(cc=!1,JC(d));break;case 4:to?(v=Is,Is=th(d.stateNode.containerInfo),ls(I,d),Zs(d),Is=v):(ls(I,d),Zs(d)),Z&4&&$s&&ep(d.stateNode,d,d.stateNode.pendingChildren);break;case 12:ls(I,d),Zs(d);break;case 13:ls(I,d),Zs(d),d.child.flags&8192&&d.memoizedState!==null!=(v!==null&&v.memoizedState!==null)&&(Yr=ka()),Z&4&&(Z=d.updateQueue,Z!==null&&(d.updateQueue=null,Pu(d,Z)));break;case 22:Z&512&&(Ti||v===null||Wi(v,v.return)),_=d.memoizedState!==null;var ge=v!==null&&v.memoizedState!==null,Be=ba,Ue=Ti;if(ba=Be||_,Ti=Ue||ge,ls(I,d),Ti=Ue,ba=Be,Zs(d),I=d.stateNode,I._current=d,I._visibility&=-3,I._visibility|=I._pendingVisibility&2,Z&8192&&(I._visibility=_?I._visibility&-2:I._visibility|1,_&&(I=ba||Ti,v===null||ge||I||zg(d)),za&&(d.memoizedProps===null||d.memoizedProps.mode!=="manual"))){e:if(v=null,za)for(I=d;;){if(I.tag===5||to&&I.tag===26||La&&I.tag===27){if(v===null){ge=v=I;try{K=ge.stateNode,_?gd(K):bA(ge.stateNode,ge.memoizedProps)}catch(Dt){Un(ge,ge.return,Dt)}}}else if(I.tag===6){if(v===null){ge=I;try{var Bt=ge.stateNode;_?jI(Bt):gl(Bt,ge.memoizedProps)}catch(Dt){Un(ge,ge.return,Dt)}}}else if((I.tag!==22&&I.tag!==23||I.memoizedState===null||I===d)&&I.child!==null){I.child.return=I,I=I.child;continue}if(I===d)break e;for(;I.sibling===null;){if(I.return===null||I.return===d)break e;v===I&&(v=null),I=I.return}v===I&&(v=null),I.sibling.return=I.return,I=I.sibling}}Z&4&&(Z=d.updateQueue,Z!==null&&(v=Z.retryQueue,v!==null&&(Z.retryQueue=null,Pu(d,v))));break;case 19:ls(I,d),Zs(d),Z&4&&(Z=d.updateQueue,Z!==null&&(d.updateQueue=null,Pu(d,Z)));break;case 21:break;default:ls(I,d),Zs(d)}}function Zs(d){var I=d.flags;if(I&2){try{if(za&&(!La||d.tag!==27)){e:{for(var v=d.return;v!==null;){if(jC(v)){var Z=v;break e}v=v.return}throw Error(i(160))}switch(Z.tag){case 27:if(La){var _=Z.stateNode,K=wI(d);Eg(d,K,_);break}case 5:var ge=Z.stateNode;Z.flags&32&&(cd(ge),Z.flags&=-33);var Be=wI(d);Eg(d,Be,ge);break;case 3:case 4:var Ue=Z.stateNode.containerInfo,Bt=wI(d);RI(d,Bt,Ue);break;default:throw Error(i(161))}}}catch(Dt){Un(d,d.return,Dt)}d.flags&=-3}I&4096&&(d.flags&=-4097)}function JC(d){if(d.subtreeFlags&1024)for(d=d.child;d!==null;){var I=d;JC(I),I.tag===5&&I.flags&1024&&mi(I.stateNode),d=d.sibling}}function vr(d,I){if(I.subtreeFlags&8772)for(I=I.child;I!==null;)NI(d,I.alternate,I),I=I.sibling}function zg(d){for(d=d.child;d!==null;){var I=d;switch(I.tag){case 0:case 11:case 14:case 15:Kl(4,I,I.return),zg(I);break;case 1:Wi(I,I.return);var v=I.stateNode;typeof v.componentWillUnmount=="function"&&$m(I,I.return,v),zg(I);break;case 26:case 27:case 5:Wi(I,I.return),zg(I);break;case 22:Wi(I,I.return),I.memoizedState===null&&zg(I);break;default:zg(I)}d=d.sibling}}function Ll(d,I,v){for(v=v&&(I.subtreeFlags&8772)!==0,I=I.child;I!==null;){var Z=I.alternate,_=d,K=I,ge=K.flags;switch(K.tag){case 0:case 11:case 15:Ll(_,K,v),Ju(4,K);break;case 1:if(Ll(_,K,v),Z=K,_=Z.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(Bt){Un(Z,Z.return,Bt)}if(Z=K,_=Z.updateQueue,_!==null){var Be=Z.stateNode;try{var Ue=_.shared.hiddenCallbacks;if(Ue!==null)for(_.shared.hiddenCallbacks=null,_=0;_<Ue.length;_++)ye(Ue[_],Be)}catch(Bt){Un(Z,Z.return,Bt)}}v&&ge&64&&qm(K),kc(K,K.return);break;case 26:case 27:case 5:Ll(_,K,v),v&&Z===null&&ge&4&&Hg(K),kc(K,K.return);break;case 12:Ll(_,K,v);break;case 13:Ll(_,K,v),v&&ge&4&&Tl(_,K);break;case 22:K.memoizedState===null&&Ll(_,K,v),kc(K,K.return);break;default:Ll(_,K,v)}I=I.sibling}}function PC(d,I){var v=null;d!==null&&d.memoizedState!==null&&d.memoizedState.cachePool!==null&&(v=d.memoizedState.cachePool.pool),d=null,I.memoizedState!==null&&I.memoizedState.cachePool!==null&&(d=I.memoizedState.cachePool.pool),d!==v&&(d!=null&&d.refCount++,v!=null&&Mg(v))}function VI(d,I){d=null,I.alternate!==null&&(d=I.alternate.memoizedState.cache),I=I.memoizedState.cache,I!==d&&(I.refCount++,d!=null&&Mg(d))}function el(d,I,v,Z){if(I.subtreeFlags&10256)for(I=I.child;I!==null;)MI(d,I,v,Z),I=I.sibling}function MI(d,I,v,Z){var _=I.flags;switch(I.tag){case 0:case 11:case 15:el(d,I,v,Z),_&2048&&Ju(9,I);break;case 3:el(d,I,v,Z),_&2048&&(d=null,I.alternate!==null&&(d=I.alternate.memoizedState.cache),I=I.memoizedState.cache,I!==d&&(I.refCount++,d!=null&&Mg(d)));break;case 12:if(_&2048){el(d,I,v,Z),d=I.stateNode;try{var K=I.memoizedProps,ge=K.id,Be=K.onPostCommit;typeof Be=="function"&&Be(ge,I.alternate===null?"mount":"update",d.passiveEffectDuration,-0)}catch(Ue){Un(I,I.return,Ue)}}else el(d,I,v,Z);break;case 23:break;case 22:K=I.stateNode,I.memoizedState!==null?K._visibility&4?el(d,I,v,Z):kl(d,I):K._visibility&4?el(d,I,v,Z):(K._visibility|=4,Qa(d,I,v,Z,(I.subtreeFlags&10256)!==0)),_&2048&&PC(I.alternate,I);break;case 24:el(d,I,v,Z),_&2048&&VI(I.alternate,I);break;default:el(d,I,v,Z)}}function Qa(d,I,v,Z,_){for(_=_&&(I.subtreeFlags&10256)!==0,I=I.child;I!==null;){var K=d,ge=I,Be=v,Ue=Z,Bt=ge.flags;switch(ge.tag){case 0:case 11:case 15:Qa(K,ge,Be,Ue,_),Ju(8,ge);break;case 23:break;case 22:var Dt=ge.stateNode;ge.memoizedState!==null?Dt._visibility&4?Qa(K,ge,Be,Ue,_):kl(K,ge):(Dt._visibility|=4,Qa(K,ge,Be,Ue,_)),_&&Bt&2048&&PC(ge.alternate,ge);break;case 24:Qa(K,ge,Be,Ue,_),_&&Bt&2048&&VI(ge.alternate,ge);break;default:Qa(K,ge,Be,Ue,_)}I=I.sibling}}function kl(d,I){if(I.subtreeFlags&10256)for(I=I.child;I!==null;){var v=d,Z=I,_=Z.flags;switch(Z.tag){case 22:kl(v,Z),_&2048&&PC(Z.alternate,Z);break;case 24:kl(v,Z),_&2048&&VI(Z.alternate,Z);break;default:kl(v,Z)}I=I.sibling}}function wa(d){if(d.subtreeFlags&og)for(d=d.child;d!==null;)Uc(d),d=d.sibling}function Uc(d){switch(d.tag){case 26:wa(d),d.flags&og&&(d.memoizedState!==null?YA(Is,d.memoizedState,d.memoizedProps):Ui(d.type,d.memoizedProps));break;case 5:wa(d),d.flags&og&&Ui(d.type,d.memoizedProps);break;case 3:case 4:if(to){var I=Is;Is=th(d.stateNode.containerInfo),wa(d),Is=I}else wa(d);break;case 22:d.memoizedState===null&&(I=d.alternate,I!==null&&I.memoizedState!==null?(I=og,og=16777216,wa(d),og=I):wa(d));break;default:wa(d)}}function _I(d){var I=d.alternate;if(I!==null&&(d=I.child,d!==null)){I.child=null;do I=d.sibling,d.sibling=null,d=I;while(d!==null)}}function Ul(d){var I=d.deletions;if((d.flags&16)!==0){if(I!==null)for(var v=0;v<I.length;v++){var Z=I[v];Pi=Z,Dl(Z,d)}_I(d)}if(d.subtreeFlags&10256)for(d=d.child;d!==null;)Qu(d),d=d.sibling}function Qu(d){switch(d.tag){case 0:case 11:case 15:Ul(d),d.flags&2048&&Kl(9,d,d.return);break;case 3:Ul(d);break;case 12:Ul(d);break;case 22:var I=d.stateNode;d.memoizedState!==null&&I._visibility&4&&(d.return===null||d.return.tag!==13)?(I._visibility&=-5,Lg(d)):Ul(d);break;default:Ul(d)}}function Lg(d){var I=d.deletions;if((d.flags&16)!==0){if(I!==null)for(var v=0;v<I.length;v++){var Z=I[v];Pi=Z,Dl(Z,d)}_I(d)}for(d=d.child;d!==null;){switch(I=d,I.tag){case 0:case 11:case 15:Kl(8,I,I.return),Lg(I);break;case 22:v=I.stateNode,v._visibility&4&&(v._visibility&=-5,Lg(I));break;default:Lg(I)}d=d.sibling}}function Dl(d,I){for(;Pi!==null;){var v=Pi;switch(v.tag){case 0:case 11:case 15:Kl(8,v,I);break;case 23:case 22:if(v.memoizedState!==null&&v.memoizedState.cachePool!==null){var Z=v.memoizedState.cachePool.pool;Z!=null&&Z.refCount++}break;case 24:Mg(v.memoizedState.cache)}if(Z=v.child,Z!==null)Z.return=v,Pi=Z;else e:for(v=d;Pi!==null;){Z=Pi;var _=Z.sibling,K=Z.return;if(Kg(Z),Z===v){Pi=null;break e}if(_!==null){_.return=K,Pi=_;break e}Pi=K}}}function XI(d){var I=dA(d);if(I!=null){if(typeof I.memoizedProps["data-testname"]!="string")throw Error(i(364));return I}if(d=eg(d),d===null)throw Error(i(362));return d.stateNode.current}function kg(d,I){var v=d.tag;switch(I.$$typeof){case Sd:if(d.type===I.value)return!0;break;case dh:e:{for(I=I.value,d=[d,0],v=0;v<d.length;){var Z=d[v++],_=Z.tag,K=d[v++],ge=I[K];if(_!==5&&_!==26&&_!==27||!Wr(Z)){for(;ge!=null&&kg(Z,ge);)K++,ge=I[K];if(K===I.length){I=!0;break e}else for(Z=Z.child;Z!==null;)d.push(Z,K),Z=Z.sibling}}I=!1}return I;case Ih:if((v===5||v===26||v===27)&&Zv(d.stateNode,I.value))return!0;break;case ui:if((v===5||v===6||v===26||v===27)&&(d=ld(d),d!==null&&0<=d.indexOf(I.value)))return!0;break;case Qn:if((v===5||v===26||v===27)&&(d=d.memoizedProps["data-testname"],typeof d=="string"&&d.toLowerCase()===I.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Ol(d){switch(d.$$typeof){case Sd:return"<"+(o(d.value)||"Unknown")+">";case dh:return":has("+(Ol(d)||"")+")";case Ih:return'[role="'+d.value+'"]';case ui:return'"'+d.value+'"';case Qn:return'[data-testname="'+d.value+'"]';default:throw Error(i(365))}}function tp(d,I){var v=[];d=[d,0];for(var Z=0;Z<d.length;){var _=d[Z++],K=_.tag,ge=d[Z++],Be=I[ge];if(K!==5&&K!==26&&K!==27||!Wr(_)){for(;Be!=null&&kg(_,Be);)ge++,Be=I[ge];if(ge===I.length)v.push(_);else for(_=_.child;_!==null;)d.push(_,ge),_=_.sibling}}return v}function cs(d,I){if(!Nr)throw Error(i(363));d=XI(d),d=tp(d,I),I=[],d=Array.from(d);for(var v=0;v<d.length;){var Z=d[v++],_=Z.tag;if(_===5||_===26||_===27)Wr(Z)||I.push(Z.stateNode);else for(Z=Z.child;Z!==null;)d.push(Z),Z=Z.sibling}return I}function gs(){if((un&2)!==0&&En!==0)return En&-En;if(mn.T!==null){var d=Ms;return d!==0?d:He()}return No()}function Gr(){Ys===0&&(Ys=(En&536870912)===0||ii?Y():536870912);var d=lo.current;return d!==null&&(d.flags|=32),Ys}function qa(d,I,v){(d===Ln&&pi===2||d.cancelPendingCommit!==null)&&(qo(d,0),Qo(d,En,Ys,!1)),O(d,v),((un&2)===0||d!==Ln)&&(d===Ln&&((un&2)===0&&(sr|=v),qn===4&&Qo(d,En,Ys,!1)),it(d))}function qu(d,I,v){if((un&6)!==0)throw Error(i(327));var Z=!v&&(I&60)===0&&(I&d.expiredLanes)===0||H(d,I),_=Z?xr(d,I):Br(d,I,!0),K=Z;do{if(_===0){co&&!Z&&Qo(d,I,0,!1);break}else if(_===6)Qo(d,I,0,!di);else{if(v=d.current.alternate,K&&!np(v)){_=Br(d,I,!1),K=!1;continue}if(_===2){if(K=I,d.errorRecoveryDisabledLanes&K)var ge=0;else ge=d.pendingLanes&-536870913,ge=ge!==0?ge:ge&536870912?536870912:0;if(ge!==0){I=ge;e:{var Be=d;_=ru;var Ue=us&&Be.current.memoizedState.isDehydrated;if(Ue&&(qo(Be,ge).flags|=256),ge=Br(Be,ge,!1),ge!==2){if(Al&&!Ue){Be.errorRecoveryDisabledLanes|=K,sr|=K,_=4;break e}K=uo,uo=_,K!==null&&tl(K)}_=ge}if(K=!1,_!==2)continue}}if(_===1){qo(d,0),Qo(d,I,0,!0);break}e:{switch(Z=d,_){case 0:case 1:throw Error(i(345));case 4:if((I&4194176)===I){Qo(Z,I,Ys,!di);break e}break;case 2:uo=null;break;case 3:case 5:break;default:throw Error(i(329))}if(Z.finishedWork=v,Z.finishedLanes=I,(I&62914560)===I&&(K=Yr+300-ka(),10<K)){if(Qo(Z,I,Ys,!di),V(Z,0)!==0)break e;Z.timeoutHandle=uA(YI.bind(null,Z,v,uo,or,lu,I,Ys,sr,fl,di,2,-0,0),K);break e}YI(Z,v,uo,or,lu,I,Ys,sr,fl,di,0,-0,0)}}break}while(!0);it(d)}function tl(d){uo===null?uo=d:uo.push.apply(uo,d)}function YI(d,I,v,Z,_,K,ge,Be,Ue,Bt,Dt,en,nn){var wn=I.subtreeFlags;if((wn&8192||(wn&16785408)===16785408)&&(eo(),Uc(I),I=UI(),I!==null)){d.cancelPendingCommit=I(Gi.bind(null,d,v,Z,_,ge,Be,Ue,1,en,nn)),Qo(d,K,ge,!Bt);return}Gi(d,v,Z,_,ge,Be,Ue,Dt,en,nn)}function np(d){for(var I=d;;){var v=I.tag;if((v===0||v===11||v===15)&&I.flags&16384&&(v=I.updateQueue,v!==null&&(v=v.stores,v!==null)))for(var Z=0;Z<v.length;Z++){var _=v[Z],K=_.getSnapshot;_=_.value;try{if(!no(K(),_))return!1}catch{return!1}}if(v=I.child,I.subtreeFlags&16384&&v!==null)v.return=I,I=v;else{if(I===d)break;for(;I.sibling===null;){if(I.return===null||I.return===d)return!0;I=I.return}I.sibling.return=I.return,I=I.sibling}}return!0}function Qo(d,I,v,Z){I&=~as,I&=~sr,d.suspendedLanes|=I,d.pingedLanes&=~I,Z&&(d.warmLanes|=I),Z=d.expirationTimes;for(var _=I;0<_;){var K=31-Ws(_),ge=1<<K;Z[K]=-1,_&=~ge}v!==0&&q(d,v,I)}function QC(){return(un&6)===0?(Fe(0),!1):!0}function ws(){if(Nn!==null){if(pi===0)var d=Nn.return;else d=Nn,Ji=lc=null,At(d),Mr=null,Mo=0,d=Nn;for(;d!==null;)DC(d.alternate,d),d=d.return;Nn=null}}function qo(d,I){d.finishedWork=null,d.finishedLanes=0;var v=d.timeoutHandle;v!==$c&&(d.timeoutHandle=$c,rd(v)),v=d.cancelPendingCommit,v!==null&&(d.cancelPendingCommit=null,v()),ws(),Ln=d,Nn=v=$a(d.current,null),En=I,pi=0,aa=null,di=!1,co=H(d,I),Al=!1,fl=Ys=as=sr=go=qn=0,uo=ru=null,lu=!1,(I&8)!==0&&(I|=I&32);var Z=d.entangledLanes;if(Z!==0)for(d=d.entanglements,Z&=I;0<Z;){var _=31-Ws(Z),K=1<<_;I|=d[_],Z&=~K}return ar=I,Ke(),v}function Dc(d,I){_n=null,mn.H=ai,I===Ai?(I=vt(),pi=3):I===KA?(I=vt(),pi=4):pi=I===Xp?8:I!==null&&typeof I=="object"&&typeof I.then=="function"?6:1,aa=I,Nn===null&&(qn=1,br(d,ce(I,d.current)))}function $u(){var d=lo.current;return d===null?!0:(En&4194176)===En?_o===null:(En&62914560)===En||(En&536870912)!==0?d===_o:!1}function Ug(){var d=mn.H;return mn.H=ai,d===null?ai:d}function qs(){var d=mn.A;return mn.A=uh,d}function Rs(){qn=4,di||(En&4194176)!==En&&lo.current!==null||(co=!0),(go&134217727)===0&&(sr&134217727)===0||Ln===null||Qo(Ln,En,Ys,!1)}function Br(d,I,v){var Z=un;un|=2;var _=Ug(),K=qs();(Ln!==d||En!==I)&&(or=null,qo(d,I)),I=!1;var ge=qn;e:do try{if(pi!==0&&Nn!==null){var Be=Nn,Ue=aa;switch(pi){case 8:ws(),ge=6;break e;case 3:case 2:case 6:lo.current===null&&(I=!0);var Bt=pi;if(pi=0,aa=null,jl(d,Be,Ue,Bt),v&&co){ge=0;break e}break;default:Bt=pi,pi=0,aa=null,jl(d,Be,Ue,Bt)}}Sr(),ge=qn;break}catch(Dt){Dc(d,Dt)}while(!0);return I&&d.shellSuspendCounter++,Ji=lc=null,un=Z,mn.H=_,mn.A=K,Nn===null&&(Ln=null,En=0,Ke()),ge}function Sr(){for(;Nn!==null;)qC(Nn)}function xr(d,I){var v=un;un|=2;var Z=Ug(),_=qs();Ln!==d||En!==I?(or=null,zi=ka()+500,qo(d,I)):co=H(d,I);e:do try{if(pi!==0&&Nn!==null){I=Nn;var K=aa;t:switch(pi){case 1:pi=0,aa=null,jl(d,I,K,1);break;case 2:if(Kt(K)){pi=0,aa=null,HI(I);break}I=function(){pi===2&&Ln===d&&(pi=7),it(d)},K.then(I,I);break e;case 3:pi=7;break e;case 4:pi=5;break e;case 7:Kt(K)?(pi=0,aa=null,HI(I)):(pi=0,aa=null,jl(d,I,K,7));break;case 5:var ge=null;switch(Nn.tag){case 26:ge=Nn.memoizedState;case 5:case 27:var Be=Nn,Ue=Be.type,Bt=Be.pendingProps;if(ge?XA(ge):cl(Ue,Bt)){pi=0,aa=null;var Dt=Be.sibling;if(Dt!==null)Nn=Dt;else{var en=Be.return;en!==null?(Nn=en,ed(en)):Nn=null}break t}}pi=0,aa=null,jl(d,I,K,5);break;case 6:pi=0,aa=null,jl(d,I,K,6);break;case 8:ws(),qn=6;break e;default:throw Error(i(462))}}nl();break}catch(nn){Dc(d,nn)}while(!0);return Ji=lc=null,mn.H=Z,mn.A=_,un=v,Nn!==null?0:(Ln=null,En=0,Ke(),qn)}function nl(){for(;Nn!==null&&!Np();)qC(Nn)}function qC(d){var I=jm(d.alternate,d,ar);d.memoizedProps=d.pendingProps,I===null?ed(d):Nn=I}function HI(d){var I=d,v=I.alternate;switch(I.tag){case 15:case 0:I=Uu(v,I,I.pendingProps,I.type,void 0,En);break;case 11:I=Uu(v,I,I.pendingProps,I.type.render,I.ref,En);break;case 5:At(I);default:DC(v,I),I=Nn=sl(I,ar),I=jm(v,I,ar)}d.memoizedProps=d.pendingProps,I===null?ed(d):Nn=I}function jl(d,I,v,Z){Ji=lc=null,At(I),Mr=null,Mo=0;var _=I.return;try{if(GI(d,_,I,v,En)){qn=1,br(d,ce(v,d.current)),Nn=null;return}}catch(K){if(_!==null)throw Nn=_,K;qn=1,br(d,ce(v,d.current)),Nn=null;return}I.flags&32768?(ii||Z===1?d=!0:co||(En&536870912)!==0?d=!1:(di=d=!0,(Z===2||Z===3||Z===6)&&(Z=lo.current,Z!==null&&Z.tag===13&&(Z.flags|=16384))),Ra(I,d)):ed(I)}function ed(d){var I=d;do{if((I.flags&32768)!==0){Ra(I,di);return}d=I.return;var v=Pm(I.alternate,I,ar);if(v!==null){Nn=v;return}if(I=I.sibling,I!==null){Nn=I;return}Nn=I=d}while(I!==null);qn===0&&(qn=5)}function Ra(d,I){do{var v=Qm(d.alternate,d);if(v!==null){v.flags&=32767,Nn=v;return}if(v=d.return,v!==null&&(v.flags|=32768,v.subtreeFlags=0,v.deletions=null),!I&&(d=d.sibling,d!==null)){Nn=d;return}Nn=d=v}while(d!==null);qn=6,Nn=null}function Gi(d,I,v,Z,_,K,ge,Be,Ue,Bt){var Dt=mn.T,en=pa();try{es(2),mn.T=null,jn(d,I,v,Z,en,_,K,ge,Be,Ue,Bt)}finally{mn.T=Dt,es(en)}}function jn(d,I,v,Z,_,K,ge,Be){do Na();while(ml!==null);if((un&6)!==0)throw Error(i(327));var Ue=d.finishedWork;if(Z=d.finishedLanes,Ue===null)return null;if(d.finishedWork=null,d.finishedLanes=0,Ue===d.current)throw Error(i(177));d.callbackNode=null,d.callbackPriority=0,d.cancelPendingCommit=null;var Bt=Ue.lanes|Ue.childLanes;if(Bt|=nu,P(d,Z,Bt,K,ge,Be),d===Ln&&(Nn=Ln=null,En=0),(Ue.subtreeFlags&10256)===0&&(Ue.flags&10256)===0||Yo||(Yo=!0,hh=Bt,lg=v,td(ih,function(){return Na(),null})),v=(Ue.flags&15990)!==0,(Ue.subtreeFlags&15990)!==0||v?(v=mn.T,mn.T=null,K=pa(),es(2),ge=un,un|=4,Fg(d,Ue),zl(Ue,d),cA(d.containerInfo),d.current=Ue,NI(d,Ue.alternate,Ue),Wp(),un=ge,es(K),mn.T=v):d.current=Ue,Yo?(Yo=!1,ml=d,rg=Z):il(d,Bt),Bt=d.pendingLanes,Bt===0&&(Io=null),F(Ue.stateNode),it(d),I!==null)for(_=d.onRecoverableError,Ue=0;Ue<I.length;Ue++)Bt=I[Ue],_(Bt.value,{componentStack:Bt.stack});return(rg&3)!==0&&Na(),Bt=d.pendingLanes,(Z&4194218)!==0&&(Bt&42)!==0?d===hs?cg++:(cg=0,hs=d):cg=0,Fe(0),null}function il(d,I){(d.pooledCacheLanes&=I)===0&&(I=d.pooledCache,I!=null&&(d.pooledCache=null,Mg(I)))}function Na(){if(ml!==null){var d=ml,I=hh;hh=0;var v=le(rg),Z=32>v?32:v;v=mn.T;var _=pa();try{if(es(Z),mn.T=null,ml===null)var K=!1;else{Z=lg,lg=null;var ge=ml,Be=rg;if(ml=null,rg=0,(un&6)!==0)throw Error(i(331));var Ue=un;if(un|=4,Qu(ge.current),MI(ge,ge.current,Be,Z),un=Ue,Fe(0,!1),Vs&&typeof Vs.onPostCommitFiberRoot=="function")try{Vs.onPostCommitFiberRoot(eu,ge)}catch{}K=!0}return K}finally{es(_),mn.T=v,il(d,I)}}return!1}function EI(d,I,v){I=ce(v,I),I=Po(d.stateNode,I,2),d=je(d,I,2),d!==null&&(O(d,2),it(d))}function Un(d,I,v){if(d.tag===3)EI(d,d,v);else for(;I!==null;){if(I.tag===3){EI(I,d,v);break}else if(I.tag===1){var Z=I.stateNode;if(typeof I.type.getDerivedStateFromError=="function"||typeof Z.componentDidCatch=="function"&&(Io===null||!Io.has(Z))){d=ce(v,d),v=yr(2),Z=je(I,v,2),Z!==null&&(ma(v,Z,I,d),O(Z,2),it(Z));break}}I=I.return}}function FI(d,I,v){var Z=d.pingCache;if(Z===null){Z=d.pingCache=new Dn;var _=new Set;Z.set(I,_)}else _=Z.get(I),_===void 0&&(_=new Set,Z.set(I,_));_.has(v)||(Al=!0,_.add(v),d=ip.bind(null,d,I,v),I.then(d,d))}function ip(d,I,v){var Z=d.pingCache;Z!==null&&Z.delete(I),d.pingedLanes|=d.suspendedLanes&v,d.warmLanes&=~v,Ln===d&&(En&v)===v&&(qn===4||qn===3&&(En&62914560)===En&&300>ka()-Yr?(un&2)===0&&qo(d,0):as|=v,fl===En&&(fl=0)),it(d)}function Oc(d,I){I===0&&(I=M()),d=dt(d,I),d!==null&&(O(d,I),it(d))}function jc(d){var I=d.memoizedState,v=0;I!==null&&(v=I.retryLane),Oc(d,v)}function $C(d,I){var v=0;switch(d.tag){case 13:var Z=d.stateNode,_=d.memoizedState;_!==null&&(v=_.retryLane);break;case 19:Z=d.stateNode;break;case 22:Z=d.stateNode._retryCache;break;default:throw Error(i(314))}Z!==null&&Z.delete(I),Oc(d,v)}function td(d,I){return $g(d,I)}function eA(d,I,v,Z){this.tag=d,this.key=v,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=I,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=Z,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function al(d){return d=d.prototype,!(!d||!d.isReactComponent)}function $a(d,I){var v=d.alternate;return v===null?(v=t(d.tag,I,d.key,d.mode),v.elementType=d.elementType,v.type=d.type,v.stateNode=d.stateNode,v.alternate=d,d.alternate=v):(v.pendingProps=I,v.type=d.type,v.flags=0,v.subtreeFlags=0,v.deletions=null),v.flags=d.flags&31457280,v.childLanes=d.childLanes,v.lanes=d.lanes,v.child=d.child,v.memoizedProps=d.memoizedProps,v.memoizedState=d.memoizedState,v.updateQueue=d.updateQueue,I=d.dependencies,v.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext},v.sibling=d.sibling,v.index=d.index,v.ref=d.ref,v.refCleanup=d.refCleanup,v}function sl(d,I){d.flags&=31457282;var v=d.alternate;return v===null?(d.childLanes=0,d.lanes=I,d.child=null,d.subtreeFlags=0,d.memoizedProps=null,d.memoizedState=null,d.updateQueue=null,d.dependencies=null,d.stateNode=null):(d.childLanes=v.childLanes,d.lanes=v.lanes,d.child=v.child,d.subtreeFlags=0,d.deletions=null,d.memoizedProps=v.memoizedProps,d.memoizedState=v.memoizedState,d.updateQueue=v.updateQueue,d.type=v.type,I=v.dependencies,d.dependencies=I===null?null:{lanes:I.lanes,firstContext:I.firstContext}),d}function Ro(d,I,v,Z,_,K){var ge=0;if(Z=d,typeof d=="function")al(d)&&(ge=1);else if(typeof d=="string")ge=to&&La?wA(d,v,Va.current)?26:Qg(d)?27:5:to?wA(d,v,Va.current)?26:5:La&&Qg(d)?27:5;else e:switch(d){case Og:return ol(v.children,_,K,I);case sA:ge=8,_|=24;break;case oA:return d=t(12,v,I,_|2),d.elementType=oA,d.lanes=K,d;case TI:return d=t(13,v,I,_),d.elementType=TI,d.lanes=K,d;case Ql:return d=t(19,v,I,_),d.elementType=Ql,d.lanes=K,d;case ad:return KI(v,_,K,I);default:if(typeof d=="object"&&d!==null)switch(d.$$typeof){case op:case Zr:ge=10;break e;case Pl:ge=9;break e;case jg:ge=11;break e;case id:ge=14;break e;case er:ge=16,Z=null;break e}ge=29,v=Error(i(130,d===null?"null":typeof d,"")),Z=null}return I=t(ge,v,I,_),I.elementType=d,I.type=Z,I.lanes=K,I}function ol(d,I,v,Z){return d=t(7,d,Z,I),d.lanes=v,d}function KI(d,I,v,Z){d=t(22,d,Z,I),d.elementType=ad,d.lanes=v;var _={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var K=_._current;if(K===null)throw Error(i(456));if((_._pendingVisibility&2)===0){var ge=dt(K,2);ge!==null&&(_._pendingVisibility|=2,qa(ge,K,2))}},attach:function(){var K=_._current;if(K===null)throw Error(i(456));if((_._pendingVisibility&2)!==0){var ge=dt(K,2);ge!==null&&(_._pendingVisibility&=-3,qa(ge,K,2))}}};return d.stateNode=_,d}function Jl(d,I,v){return d=t(6,d,null,I),d.lanes=v,d}function Dg(d,I,v){return I=t(4,d.children!==null?d.children:[],d.key,I),I.lanes=v,I.stateNode={containerInfo:d.containerInfo,pendingChildren:null,implementation:d.implementation},I}function Jc(d,I,v,Z,_,K,ge,Be){this.tag=1,this.containerInfo=d,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=$c,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=E(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=E(0),this.hiddenUpdates=E(null),this.identifierPrefix=Z,this.onUncaughtError=_,this.onCaughtError=K,this.onRecoverableError=ge,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Be,this.incompleteTransitions=new Map}function Wa(d,I,v,Z,_,K,ge,Be,Ue,Bt,Dt,en){return d=new Jc(d,I,v,ge,Be,Ue,Bt,en),I=1,K===!0&&(I|=24),K=t(3,null,null,I),d.current=K,K.stateNode=d,I=SI(),I.refCount++,d.pooledCache=I,I.refCount++,K.memoizedState={element:Z,isDehydrated:v,cache:I},Ht(K),d}function nd(d){return d?(d=tg,d):tg}function tA(d){var I=d._reactInternals;if(I===void 0)throw typeof d.render=="function"?Error(i(188)):(d=Object.keys(d).join(","),Error(i(268,d)));return d=p(I),d=d!==null?y(d):null,d===null?null:Jg(d.stateNode)}function ap(d,I,v,Z,_,K){_=nd(_),Z.context===null?Z.context=_:Z.pendingContext=_,Z=Pe(I),Z.payload={element:v},K=K===void 0?null:K,K!==null&&(Z.callback=K),v=je(d,Z,I),v!==null&&(qa(v,d,I),ot(v,d,I))}function sp(d,I){if(d=d.memoizedState,d!==null&&d.dehydrated!==null){var v=d.retryLane;d.retryLane=v!==0&&v<I?v:I}}function nA(d,I){sp(d,I),(d=d.alternate)&&sp(d,I)}var gn={},iA=xC(),Ta=$D(),Pc=Object.assign,aA=Symbol.for("react.element"),rl=Symbol.for("react.transitional.element"),$o=Symbol.for("react.portal"),Og=Symbol.for("react.fragment"),sA=Symbol.for("react.strict_mode"),oA=Symbol.for("react.profiler"),op=Symbol.for("react.provider"),Pl=Symbol.for("react.consumer"),Zr=Symbol.for("react.context"),jg=Symbol.for("react.forward_ref"),TI=Symbol.for("react.suspense"),Ql=Symbol.for("react.suspense_list"),id=Symbol.for("react.memo"),er=Symbol.for("react.lazy"),ad=Symbol.for("react.offscreen"),rp=Symbol.for("react.memo_cache_sentinel"),rA=Symbol.iterator,Qc=Symbol.for("react.client.reference"),mn=iA.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,zI,lA,ql=!1,$l=Array.isArray,LI=e.rendererVersion,sd=e.rendererPackageName,od=e.extraDevToolsConfig,Jg=e.getPublicInstance,qc=e.getRootHostContext,lp=e.getChildHostContext,ec=e.prepareForCommit,cA=e.resetAfterCommit,gA=e.createInstance,wr=e.appendInitialChild,ll=e.finalizeInitialChildren,tc=e.shouldSetTextContent,kI=e.createTextInstance,uA=e.scheduleTimeout,rd=e.cancelTimeout,$c=e.noTimeout,Rr=e.isPrimaryRenderer;e.warnsIfNotActing;var za=e.supportsMutation,$s=e.supportsPersistence,us=e.supportsHydration,dA=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var IA=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var es=e.setCurrentUpdatePriority,pa=e.getCurrentUpdatePriority,No=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var nc=e.shouldAttemptEagerTransition,hA=e.detachDeletedInstance;e.requestPostPaintCallback;var cp=e.maySuspendCommit,cl=e.preloadInstance,eo=e.startSuspendingCommit,Ui=e.suspendInstance,UI=e.waitForCommitToBeReady,Ns=e.NotPendingTransition,Gn=e.HostTransitionContext,mi=e.resetFormInstance;e.bindToConsole;var ca=e.supportsMicrotasks,DI=e.scheduleMicrotask,Nr=e.supportsTestSelectors,eg=e.findFiberRoot,OI=e.getBoundingRect,ld=e.getTextContent,Wr=e.isHiddenSubtree,Zv=e.matchAccessibilityRole,Di=e.setFocusIfFocusable,CA=e.setupIntersectionObserver,AA=e.appendChild,gp=e.appendChildToContainer,up=e.commitTextUpdate,wv=e.commitMount,fA=e.commitUpdate,mA=e.insertBefore,pA=e.insertInContainerBefore,ds=e.removeChild,ea=e.removeChildFromContainer,cd=e.resetTextContent,gd=e.hideInstance,jI=e.hideTextInstance,bA=e.unhideInstance,gl=e.unhideTextInstance,JI=e.clearContainer,yA=e.cloneInstance,PI=e.createContainerChildSet,vA=e.appendChildToContainerChildSet,dp=e.finalizeContainerChildren,GA=e.replaceContainerChildren,BA=e.cloneHiddenInstance,SA=e.cloneHiddenTextInstance,QI=e.isSuspenseInstancePending,ud=e.isSuspenseInstanceFallback,Ip=e.getSuspenseInstanceFallbackErrorDetails,Rv=e.registerSuspenseInstanceRetry,hp=e.canHydrateFormStateMarker,Cp=e.isFormStateMarkerMatching,xA=e.getNextHydratableSibling,qI=e.getFirstHydratableChild,Ap=e.getFirstHydratableChildWithinContainer,fp=e.getFirstHydratableChildWithinSuspenseInstance,mp=e.canHydrateInstance,pp=e.canHydrateTextInstance,bp=e.canHydrateSuspenseInstance,Nv=e.hydrateInstance,yp=e.hydrateTextInstance,Pg=e.hydrateSuspenseInstance,vp=e.getNextHydratableInstanceAfterSuspenseInstance,$I=e.commitHydratedContainer,eh=e.commitHydratedSuspenseInstance,Gp=e.clearSuspenseBoundary,ZA=e.clearSuspenseBoundaryFromContainer,Bp=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var Sp=e.validateHydratableInstance,xp=e.validateHydratableTextInstance,to=e.supportsResources,wA=e.isHostHoistableType,th=e.getHoistableRoot,nh=e.getResource,RA=e.acquireResource,NA=e.releaseResource,WA=e.hydrateHoistable,VA=e.mountHoistable,MA=e.unmountHoistable,Wv=e.createHoistableInstance,_A=e.prepareToCommitHoistables,Zp=e.mayResourceSuspendCommit,XA=e.preloadResource,YA=e.suspendResource,La=e.supportsSingletons,HA=e.resolveSingletonInstance,Vv=e.clearSingleton,Mv=e.acquireSingletonInstance,wp=e.releaseSingletonInstance,Qg=e.isHostSingletonType,dd=[],ul=-1,tg={},Ws=Math.clz32?Math.clz32:R,Id=Math.log,Rp=Math.LN2,qg=128,hd=4194304,$g=Ta.unstable_scheduleCallback,Cd=Ta.unstable_cancelCallback,Np=Ta.unstable_shouldYield,Wp=Ta.unstable_requestPaint,ka=Ta.unstable_now,EA=Ta.unstable_ImmediatePriority,Vp=Ta.unstable_UserBlockingPriority,ih=Ta.unstable_NormalPriority,ah=Ta.unstable_IdlePriority,Mp=Ta.log,FA=Ta.unstable_setDisableYieldValue,eu=null,Vs=null,no=typeof Object.is=="function"?Object.is:Q,sh=new WeakMap,Vi=[],Oi=0,Ad=null,fd=0,io=[],ao=0,tr=null,Vr=1,Wo="",Va=B(null),md=B(null),nr=B(null),tu=B(null),ts=null,Ua=null,ii=!1,so=null,Vo=!1,pd=Error(i(519)),oo=[],ic=0,nu=0,iu=null,ng=null,bd=!1,yd=!1,ir=!1,ac=0,vd=null,oh=0,Ms=0,sc=null,dl=!1,au=!1,Gd=Object.prototype.hasOwnProperty,Ai=Error(i(460)),KA=Error(i(474)),rh={then:function(){}},ig=null,Mr=null,Mo=0,oc=Kn(!0),TA=Kn(!1),_r=B(null),ro=B(0),lo=B(null),_o=null,ga=B(0),Xr=0,_n=null,li=null,ta=null,Xo=!1,Mi=!1,Il=!1,Bd=0,ji=0,su=null,_p=0,lh=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},ai={readContext:Ka,use:$e,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useLayoutEffect:Vt,useInsertionEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useSyncExternalStore:Vt,useId:Vt};ai.useCacheRefresh=Vt,ai.useMemoCache=Vt,ai.useHostTransitionStatus=Vt,ai.useFormState=Vt,ai.useActionState=Vt,ai.useOptimistic=Vt;var ua={readContext:Ka,use:$e,useCallback:function(d,I){return bt().memoizedState=[d,I===void 0?null:I],d},useContext:Ka,useEffect:ko,useImperativeHandle:function(d,I,v){v=v!=null?v.concat([d]):null,Fi(4194308,4,So.bind(null,I,d),v)},useLayoutEffect:function(d,I){return Fi(4194308,4,d,I)},useInsertionEffect:function(d,I){Fi(4,2,d,I)},useMemo:function(d,I){var v=bt();I=I===void 0?null:I;var Z=d();if(Il){j(!0);try{d()}finally{j(!1)}}return v.memoizedState=[Z,I],Z},useReducer:function(d,I,v){var Z=bt();if(v!==void 0){var _=v(I);if(Il){j(!0);try{v(I)}finally{j(!1)}}}else _=I;return Z.memoizedState=Z.baseState=_,d={pending:null,lanes:0,dispatch:null,lastRenderedReducer:d,lastRenderedState:_},Z.queue=d,d=d.dispatch=Oo.bind(null,_n,d),[Z.memoizedState,d]},useRef:function(d){var I=bt();return d={current:d},I.memoizedState=d},useState:function(d){d=Et(d);var I=d.queue,v=Hc.bind(null,_n,I);return I.dispatch=v,[d.memoizedState,v]},useDebugValue:Uo,useDeferredValue:function(d,I){var v=bt();return xo(v,d,I)},useTransition:function(){var d=Et(!1);return d=Yc.bind(null,_n,d.queue,!0,!1),bt().memoizedState=d,[!1,d]},useSyncExternalStore:function(d,I,v){var Z=_n,_=bt();if(ii){if(v===void 0)throw Error(i(407));v=v()}else{if(v=I(),Ln===null)throw Error(i(349));(En&60)!==0||Xt(Z,I,v)}_.memoizedState=v;var K={value:v,getSnapshot:I};return _.queue=K,ko(xt.bind(null,Z,K,d),[d]),Z.flags|=2048,yi(9,Yt.bind(null,Z,K,v,I),{destroy:void 0},null),v},useId:function(){var d=bt(),I=Ln.identifierPrefix;if(ii){var v=Wo,Z=Vr;v=(Z&~(1<<32-Ws(Z)-1)).toString(32)+v,I=":"+I+"R"+v,v=Bd++,0<v&&(I+="H"+v.toString(32)),I+=":"}else v=_p++,I=":"+I+"r"+v.toString(32)+":";return d.memoizedState=I},useCacheRefresh:function(){return bt().memoizedState=Jr.bind(null,_n)}};ua.useMemoCache=ne,ua.useHostTransitionStatus=Do,ua.useFormState=ni,ua.useActionState=ni,ua.useOptimistic=function(d){var I=bt();I.memoizedState=I.baseState=d;var v={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return I.queue=v,I=Ec.bind(null,_n,!0,v),v.dispatch=I,[d,I]};var ns={readContext:Ka,use:$e,useCallback:_c,useContext:Ka,useEffect:fa,useImperativeHandle:Ea,useInsertionEffect:Lu,useLayoutEffect:Mc,useMemo:js,useReducer:xe,useRef:Yi,useState:function(){return xe(ve)},useDebugValue:Uo,useDeferredValue:function(d,I){var v=ct();return Xc(v,li.memoizedState,d,I)},useTransition:function(){var d=xe(ve)[0],I=ct().memoizedState;return[typeof d=="boolean"?d:_t(d),I]},useSyncExternalStore:St,useId:Js};ns.useCacheRefresh=Pa,ns.useMemoCache=ne,ns.useHostTransitionStatus=Do,ns.useFormState=Ei,ns.useActionState=Ei,ns.useOptimistic=function(d,I){var v=ct();return Tt(v,li,d,I)};var rc={readContext:Ka,use:$e,useCallback:_c,useContext:Ka,useEffect:fa,useImperativeHandle:Ea,useInsertionEffect:Lu,useLayoutEffect:Mc,useMemo:js,useReducer:Ze,useRef:Yi,useState:function(){return Ze(ve)},useDebugValue:Uo,useDeferredValue:function(d,I){var v=ct();return li===null?xo(v,d,I):Xc(v,li.memoizedState,d,I)},useTransition:function(){var d=Ze(ve)[0],I=ct().memoizedState;return[typeof d=="boolean"?d:_t(d),I]},useSyncExternalStore:St,useId:Js};rc.useCacheRefresh=Pa,rc.useMemoCache=ne,rc.useHostTransitionStatus=Do,rc.useFormState=On,rc.useActionState=On,rc.useOptimistic=function(d,I){var v=ct();return li!==null?Tt(v,li,d,I):(v.baseState=d,[d,v.queue.dispatch])};var ch={isMounted:function(d){return(d=d._reactInternals)?A(d)===d:!1},enqueueSetState:function(d,I,v){d=d._reactInternals;var Z=gs(),_=Pe(Z);_.payload=I,v!=null&&(_.callback=v),I=je(d,_,Z),I!==null&&(qa(I,d,Z),ot(I,d,Z))},enqueueReplaceState:function(d,I,v){d=d._reactInternals;var Z=gs(),_=Pe(Z);_.tag=1,_.payload=I,v!=null&&(_.callback=v),I=je(d,_,Z),I!==null&&(qa(I,d,Z),ot(I,d,Z))},enqueueForceUpdate:function(d,I){d=d._reactInternals;var v=gs(),Z=Pe(v);Z.tag=2,I!=null&&(Z.callback=I),I=je(d,Z,v),I!==null&&(qa(I,d,v),ot(I,d,v))}},zA=typeof reportError=="function"?reportError:function(d){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var I=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof d=="object"&&d!==null&&typeof d.message=="string"?String(d.message):String(d),error:d});if(!window.dispatchEvent(I))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",d);return}console.error(d)},Xp=Error(i(461)),na=!1,is={dehydrated:null,treeContext:null,retryLane:0},_s=B(null),lc=null,Ji=null,Yp=typeof AbortController<"u"?AbortController:function(){var d=[],I=this.signal={aborted:!1,addEventListener:function(v,Z){d.push(Z)}};this.abort=function(){I.aborted=!0,d.forEach(function(v){return v()})}},hl=Ta.unstable_scheduleCallback,ag=Ta.unstable_NormalPriority,gi={$$typeof:Zr,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},gh=mn.S;mn.S=function(d,I){typeof I=="object"&&I!==null&&typeof I.then=="function"&&Me(d,I),gh!==null&&gh(d,I)};var Cl=B(null),ba=!1,Ti=!1,cc=!1,ou=typeof WeakSet=="function"?WeakSet:Set,Pi=null,sg=!1,ia=null,Xs=!1,Is=null,og=8192,uh={getCacheForType:function(d){var I=Ka(gi),v=I.data.get(d);return v===void 0&&(v=d(),I.data.set(d,v)),v}},Sd=0,dh=1,Ih=2,Qn=3,ui=4;if(typeof Symbol=="function"&&Symbol.for){var Xn=Symbol.for;Sd=Xn("selector.component"),dh=Xn("selector.has_pseudo_class"),Ih=Xn("selector.role"),Qn=Xn("selector.test_id"),ui=Xn("selector.text")}var Dn=typeof WeakMap=="function"?WeakMap:Map,un=0,Ln=null,Nn=null,En=0,pi=0,aa=null,di=!1,co=!1,Al=!1,ar=0,qn=0,go=0,sr=0,as=0,Ys=0,fl=0,ru=null,uo=null,lu=!1,Yr=0,zi=1/0,or=null,Io=null,Yo=!1,ml=null,rg=0,hh=0,lg=null,cg=0,hs=null;return gn.attemptContinuousHydration=function(d){if(d.tag===13){var I=dt(d,67108864);I!==null&&qa(I,d,67108864),nA(d,67108864)}},gn.attemptHydrationAtCurrentPriority=function(d){if(d.tag===13){var I=gs(),v=dt(d,I);v!==null&&qa(v,d,I),nA(d,I)}},gn.attemptSynchronousHydration=function(d){switch(d.tag){case 3:if(d=d.stateNode,d.current.memoizedState.isDehydrated){var I=w(d.pendingLanes);if(I!==0){for(d.pendingLanes|=2,d.entangledLanes|=2;I;){var v=1<<31-Ws(I);d.entanglements[1]|=v,I&=~v}it(d),(un&6)===0&&(zi=ka()+500,Fe(0))}}break;case 13:I=dt(d,2),I!==null&&qa(I,d,2),QC(),nA(d,2)}},gn.batchedUpdates=function(d,I){return d(I)},gn.createComponentSelector=function(d){return{$$typeof:Sd,value:d}},gn.createContainer=function(d,I,v,Z,_,K,ge,Be,Ue,Bt){return Wa(d,I,!1,null,v,Z,K,ge,Be,Ue,Bt,null)},gn.createHasPseudoClassSelector=function(d){return{$$typeof:dh,value:d}},gn.createHydrationContainer=function(d,I,v,Z,_,K,ge,Be,Ue,Bt,Dt,en,nn){return d=Wa(v,Z,!0,d,_,K,Be,Ue,Bt,Dt,en,nn),d.context=nd(null),v=d.current,Z=gs(),_=Pe(Z),_.callback=I??null,je(v,_,Z),d.current.lanes=Z,O(d,Z),it(d),d},gn.createPortal=function(d,I,v){var Z=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:$o,key:Z==null?null:""+Z,children:d,containerInfo:I,implementation:v}},gn.createRoleSelector=function(d){return{$$typeof:Ih,value:d}},gn.createTestNameSelector=function(d){return{$$typeof:Qn,value:d}},gn.createTextSelector=function(d){return{$$typeof:ui,value:d}},gn.defaultOnCaughtError=function(d){console.error(d)},gn.defaultOnRecoverableError=function(d){zA(d)},gn.defaultOnUncaughtError=function(d){zA(d)},gn.deferredUpdates=function(d){var I=mn.T,v=pa();try{return es(32),mn.T=null,d()}finally{es(v),mn.T=I}},gn.discreteUpdates=function(d,I,v,Z,_){var K=mn.T,ge=pa();try{return es(2),mn.T=null,d(I,v,Z,_)}finally{es(ge),mn.T=K,un===0&&(zi=ka()+500)}},gn.findAllNodes=cs,gn.findBoundingRects=function(d,I){if(!Nr)throw Error(i(363));I=cs(d,I),d=[];for(var v=0;v<I.length;v++)d.push(OI(I[v]));for(I=d.length-1;0<I;I--){v=d[I];for(var Z=v.x,_=Z+v.width,K=v.y,ge=K+v.height,Be=I-1;0<=Be;Be--)if(I!==Be){var Ue=d[Be],Bt=Ue.x,Dt=Bt+Ue.width,en=Ue.y,nn=en+Ue.height;if(Z>=Bt&&K>=en&&_<=Dt&&ge<=nn){d.splice(I,1);break}else if(Z!==Bt||v.width!==Ue.width||nn<K||en>ge){if(!(K!==en||v.height!==Ue.height||Dt<Z||Bt>_)){Bt>Z&&(Ue.width+=Bt-Z,Ue.x=Z),Dt<_&&(Ue.width=_-Bt),d.splice(I,1);break}}else{en>K&&(Ue.height+=en-K,Ue.y=K),nn<ge&&(Ue.height=ge-en),d.splice(I,1);break}}}return d},gn.findHostInstance=tA,gn.findHostInstanceWithNoPortals=function(d){return d=p(d),d=d!==null?G(d):null,d===null?null:Jg(d.stateNode)},gn.findHostInstanceWithWarning=function(d){return tA(d)},gn.flushPassiveEffects=Na,gn.flushSyncFromReconciler=function(d){var I=un;un|=1;var v=mn.T,Z=pa();try{if(es(2),mn.T=null,d)return d()}finally{es(Z),mn.T=v,un=I,(un&6)===0&&Fe(0)}},gn.flushSyncWork=QC,gn.focusWithin=function(d,I){if(!Nr)throw Error(i(363));for(d=XI(d),I=tp(d,I),I=Array.from(I),d=0;d<I.length;){var v=I[d++],Z=v.tag;if(!Wr(v)){if((Z===5||Z===26||Z===27)&&Di(v.stateNode))return!0;for(v=v.child;v!==null;)I.push(v),v=v.sibling}}return!1},gn.getFindAllNodesFailureDescription=function(d,I){if(!Nr)throw Error(i(363));var v=0,Z=[];d=[XI(d),0];for(var _=0;_<d.length;){var K=d[_++],ge=K.tag,Be=d[_++],Ue=I[Be];if((ge!==5&&ge!==26&&ge!==27||!Wr(K))&&(kg(K,Ue)&&(Z.push(Ol(Ue)),Be++,Be>v&&(v=Be)),Be<I.length))for(K=K.child;K!==null;)d.push(K,Be),K=K.sibling}if(v<I.length){for(d=[];v<I.length;v++)d.push(Ol(I[v]));return`findAllNodes was able to match part of the selector:
  `+(Z.join(" > ")+`

No matching component was found for:
  `)+d.join(" > ")}return null},gn.getPublicRootInstance=function(d){if(d=d.current,!d.child)return null;switch(d.child.tag){case 27:case 5:return Jg(d.child.stateNode);default:return d.child.stateNode}},gn.injectIntoDevTools=function(){var d={bundleType:0,version:LI,rendererPackageName:sd,currentDispatcherRef:mn,findFiberByHostInstance:dA,reconcilerVersion:"19.0.0"};if(od!==null&&(d.rendererConfig=od),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")d=!1;else{var I=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(I.isDisabled||!I.supportsFiber)d=!0;else{try{eu=I.inject(d),Vs=I}catch{}d=!!I.checkDCE}}return d},gn.isAlreadyRendering=function(){return!1},gn.observeVisibleRects=function(d,I,v,Z){if(!Nr)throw Error(i(363));d=cs(d,I);var _=CA(d,v,Z).disconnect;return{disconnect:function(){_()}}},gn.shouldError=function(){return null},gn.shouldSuspend=function(){return!1},gn.startHostTransition=function(d,I,v,Z){if(d.tag!==5)throw Error(i(476));var _=Yl(d).queue;Yc(d,_,I,Ns,v===null?n:function(){var K=Yl(d).next.queue;return Zo(d,K,{},gs()),v(Z)})},gn.updateContainer=function(d,I,v,Z){var _=I.current,K=gs();return ap(_,K,d,I,v,Z),K},gn.updateContainerSync=function(d,I,v,Z){return I.tag===0&&Na(),ap(I.current,2,d,I,v,Z),2},gn},a.exports.default=a.exports,Object.defineProperty(a.exports,"__esModule",{value:!0})})(SB)),SB.exports}var g1;function tO(){return g1||(g1=1,BB.exports=eO()),BB.exports}var nO=tO();const iO=xy(nO);var wB={exports:{}},RB={};var u1;function aO(){return u1||(u1=1,(function(a){function e(F,j){var Q=F.length;F.push(j);e:for(;0<Q;){var ce=Q-1>>>1,oe=F[ce];if(0<i(oe,j))F[ce]=j,F[Q]=oe,Q=ce;else break e}}function t(F){return F.length===0?null:F[0]}function n(F){if(F.length===0)return null;var j=F[0],Q=F.pop();if(Q!==j){F[0]=Q;e:for(var ce=0,oe=F.length,T=oe>>>1;ce<T;){var $=2*(ce+1)-1,ae=F[$],Ie=$+1,be=F[Ie];if(0>i(ae,Q))Ie<oe&&0>i(be,ae)?(F[ce]=be,F[Ie]=Q,ce=Ie):(F[ce]=ae,F[$]=Q,ce=$);else if(Ie<oe&&0>i(be,Q))F[ce]=be,F[Ie]=Q,ce=Ie;else break e}}return j}function i(F,j){var Q=F.sortIndex-j.sortIndex;return Q!==0?Q:F.id-j.id}if(a.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;a.unstable_now=function(){return s.now()}}else{var o=Date,l=o.now();a.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,A=null,f=3,p=!1,y=!1,G=!1,B=typeof setTimeout=="function"?setTimeout:null,S=typeof clearTimeout=="function"?clearTimeout:null,N=typeof setImmediate<"u"?setImmediate:null;function R(F){for(var j=t(u);j!==null;){if(j.callback===null)n(u);else if(j.startTime<=F)n(u),j.sortIndex=j.expirationTime,e(c,j);else break;j=t(u)}}function w(F){if(G=!1,R(F),!y)if(t(c)!==null)y=!0,k();else{var j=t(u);j!==null&&le(w,j.startTime-F)}}var V=!1,H=-1,X=5,Y=-1;function M(){return!(a.unstable_now()-Y<X)}function E(){if(V){var F=a.unstable_now();Y=F;var j=!0;try{e:{y=!1,G&&(G=!1,S(H),H=-1),p=!0;var Q=f;try{t:{for(R(F),A=t(c);A!==null&&!(A.expirationTime>F&&M());){var ce=A.callback;if(typeof ce=="function"){A.callback=null,f=A.priorityLevel;var oe=ce(A.expirationTime<=F);if(F=a.unstable_now(),typeof oe=="function"){A.callback=oe,R(F),j=!0;break t}A===t(c)&&n(c),R(F)}else n(c);A=t(c)}if(A!==null)j=!0;else{var T=t(u);T!==null&&le(w,T.startTime-F),j=!1}}break e}finally{A=null,f=Q,p=!1}j=void 0}}finally{j?O():V=!1}}}var O;if(typeof N=="function")O=function(){N(E)};else if(typeof MessageChannel<"u"){var P=new MessageChannel,q=P.port2;P.port1.onmessage=E,O=function(){q.postMessage(null)}}else O=function(){B(E,0)};function k(){V||(V=!0,O())}function le(F,j){H=B(function(){F(a.unstable_now())},j)}a.unstable_IdlePriority=5,a.unstable_ImmediatePriority=1,a.unstable_LowPriority=4,a.unstable_NormalPriority=3,a.unstable_Profiling=null,a.unstable_UserBlockingPriority=2,a.unstable_cancelCallback=function(F){F.callback=null},a.unstable_continueExecution=function(){y||p||(y=!0,k())},a.unstable_forceFrameRate=function(F){0>F||125<F?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):X=0<F?Math.floor(1e3/F):5},a.unstable_getCurrentPriorityLevel=function(){return f},a.unstable_getFirstCallbackNode=function(){return t(c)},a.unstable_next=function(F){switch(f){case 1:case 2:case 3:var j=3;break;default:j=f}var Q=f;f=j;try{return F()}finally{f=Q}},a.unstable_pauseExecution=function(){},a.unstable_requestPaint=function(){},a.unstable_runWithPriority=function(F,j){switch(F){case 1:case 2:case 3:case 4:case 5:break;default:F=3}var Q=f;f=F;try{return j()}finally{f=Q}},a.unstable_scheduleCallback=function(F,j,Q){var ce=a.unstable_now();switch(typeof Q=="object"&&Q!==null?(Q=Q.delay,Q=typeof Q=="number"&&0<Q?ce+Q:ce):Q=ce,F){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=Q+oe,F={id:h++,callback:j,priorityLevel:F,startTime:Q,expirationTime:oe,sortIndex:-1},Q>ce?(F.sortIndex=Q,e(u,F),t(c)===null&&F===t(u)&&(G?(S(H),H=-1):G=!0,le(w,Q-ce))):(F.sortIndex=oe,e(c,F),y||p||(y=!0,k())),F},a.unstable_shouldYield=M,a.unstable_wrapCallback=function(F){var j=f;return function(){var Q=f;f=j;try{return F.apply(this,arguments)}finally{f=Q}}}})(RB)),RB}var d1;function sO(){return d1||(d1=1,wB.exports=aO()),wB.exports}var I1=sO();function tx(a,e,t){if(!a)return;if(t(a)===!0)return a;let n=e?a.return:a.child;for(;n;){const i=tx(n,e,t);if(i)return i;n=e?null:n.sibling}}function A3(a){try{return Object.defineProperties(a,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return a}}const nx=A3(J.createContext(null));let f3=class extends J.Component{render(){return J.createElement(nx.Provider,{value:this._reactInternals},this.props.children)}};function m3(){const a=J.useContext(nx);if(a===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=J.useId();return J.useMemo(()=>{for(const t of[a,a?.alternate]){if(!t)continue;const n=tx(t,!1,i=>{let s=i.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(n)return n}},[a,e])}const oO=Symbol.for("react.context"),rO=a=>a!==null&&typeof a=="object"&&"$$typeof"in a&&a.$$typeof===oO;function lO(){const a=m3(),[e]=J.useState(()=>new Map);e.clear();let t=a;for(;t;){const n=t.type;rO(n)&&n!==nx&&!e.has(n)&&e.set(n,J.use(A3(n))),t=t.return}return e}function cO(){const a=lO();return J.useMemo(()=>Array.from(a.keys()).reduce((e,t)=>n=>J.createElement(e,null,J.createElement(t.Provider,{...n,value:a.get(t)})),e=>J.createElement(f3,{...e})),[a])}function p3(a){let e=a.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const b3=a=>a&&a.isOrthographicCamera,gO=a=>a&&a.hasOwnProperty("current"),uO=a=>a!=null&&(typeof a=="string"||typeof a=="number"||a.isColor),zm=((a,e)=>typeof window<"u"&&(((a=window.document)==null?void 0:a.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?J.useLayoutEffect:J.useEffect;function ix(a){const e=J.useRef(a);return zm(()=>{e.current=a},[a]),e}function dO(){const a=m3(),e=cO();return J.useMemo(()=>({children:t})=>{const i=!!tx(a,!0,s=>s.type===J.StrictMode)?J.StrictMode:J.Fragment;return m.jsx(i,{children:m.jsx(e,{children:t})})},[a,e])}function IO({set:a}){return zm(()=>(a(new Promise(()=>null)),()=>a(!1)),[a]),null}const hO=(a=>(a=class extends J.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},a.getDerivedStateFromError=()=>({error:!0}),a))();function y3(a){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(a)?Math.min(Math.max(a[0],t),a[1]):a}function Jh(a){var e;return(e=a.__r3f)==null?void 0:e.root.getState()}const Qi={obj:a=>a===Object(a)&&!Qi.arr(a)&&typeof a!="function",fun:a=>typeof a=="function",str:a=>typeof a=="string",num:a=>typeof a=="number",boo:a=>typeof a=="boolean",und:a=>a===void 0,nul:a=>a===null,arr:a=>Array.isArray(a),equ(a,e,{arrays:t="shallow",objects:n="reference",strict:i=!0}={}){if(typeof a!=typeof e||!!a!=!!e)return!1;if(Qi.str(a)||Qi.num(a)||Qi.boo(a))return a===e;const s=Qi.obj(a);if(s&&n==="reference")return a===e;const o=Qi.arr(a);if(o&&t==="reference")return a===e;if((o||s)&&a===e)return!0;let l;for(l in a)if(!(l in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(l in i?e:a)if(!Qi.equ(a[l],e[l],{strict:i,objects:"reference"}))return!1}else for(l in i?e:a)if(a[l]!==e[l])return!1;if(Qi.und(l)){if(o&&a.length===0&&e.length===0||s&&Object.keys(a).length===0&&Object.keys(e).length===0)return!0;if(a!==e)return!1}return!0}};function CO(a){const e={nodes:{},materials:{},meshes:{}};return a&&a.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function AO(a){a.type!=="Scene"&&(a.dispose==null||a.dispose());for(const e in a){const t=a[e];t?.type!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const v3=["children","key","ref"];function fO(a){const e={};for(const t in a)v3.includes(t)||(e[t]=a[t]);return e}function yy(a,e,t,n){const i=a;let s=i?.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:fO(n),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function ym(a,e){if(!e.includes("-"))return{root:a,key:e,target:a[e]};if(e in a)return{root:a,key:e,target:a[e]};let t=a;const n=e.split("-");for(const i of n){if(typeof t!="object"||t===null){if(t!==void 0){const s=n.slice(n.indexOf(i)).join("-");return{root:t,key:s,target:void 0}}return{root:a,key:e,target:void 0}}e=i,a=t,t=t[e]}return{root:a,key:e,target:t}}const h1=/-\d+$/;function vy(a,e){if(Qi.str(e.props.attach)){if(h1.test(e.props.attach)){const i=e.props.attach.replace(h1,""),{root:s,key:o}=ym(a.object,i);Array.isArray(s[o])||(s[o]=[])}const{root:t,key:n}=ym(a.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else Qi.fun(e.props.attach)&&(e.previousAttach=e.props.attach(a.object,e.object))}function Gy(a,e){if(Qi.str(e.props.attach)){const{root:t,key:n}=ym(a.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[n]:t[n]=i}else e.previousAttach==null||e.previousAttach(a.object,e.object);delete e.previousAttach}const H2=[...v3,"args","dispose","attach","object","onUpdate","dispose"],C1=new Map;function mO(a){let e=C1.get(a.constructor);try{e||(e=new a.constructor,C1.set(a.constructor,e))}catch{}return e}function pO(a,e){const t={};for(const n in e)if(!H2.includes(n)&&!Qi.equ(e[n],a.props[n])){t[n]=e[n];for(const i in e)i.startsWith(`${n}-`)&&(t[i]=e[i])}for(const n in a.props){if(H2.includes(n)||e.hasOwnProperty(n))continue;const{root:i,key:s}=ym(a.object,n);if(i.constructor&&i.constructor.length===0){const o=mO(i);Qi.und(o)||(t[s]=o[s])}else t[s]=0}return t}const bO=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],yO=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function yc(a,e){var t;const n=a.__r3f,i=n&&p3(n).getState(),s=n?.eventCount;for(const l in e){let c=e[l];if(H2.includes(l))continue;if(n&&yO.test(l)){typeof c=="function"?n.handlers[l]=c:delete n.handlers[l],n.eventCount=Object.keys(n.handlers).length;continue}if(c===void 0)continue;let{root:u,key:h,target:A}=ym(a,l);if(A===void 0&&(typeof u!="object"||u===null))throw Error(`R3F: Cannot set "${l}". Ensure it is an object before setting "${h}".`);if(A instanceof yC&&c instanceof yC)A.mask=c.mask;else if(A instanceof tn&&uO(c))A.set(c);else if(A!==null&&typeof A=="object"&&typeof A.set=="function"&&typeof A.copy=="function"&&c!=null&&c.constructor&&A.constructor===c.constructor)A.copy(c);else if(A!==null&&typeof A=="object"&&typeof A.set=="function"&&Array.isArray(c))typeof A.fromArray=="function"?A.fromArray(c):A.set(...c);else if(A!==null&&typeof A=="object"&&typeof A.set=="function"&&typeof c=="number")typeof A.setScalar=="function"?A.setScalar(c):A.set(c);else{var o;u[h]=c,i&&!i.linear&&bO.includes(h)&&(o=u[h])!=null&&o.isTexture&&u[h].format===Sa&&u[h].type===os&&(u[h].colorSpace=Bs)}}if(n!=null&&n.parent&&i!=null&&i.internal&&(t=n.object)!=null&&t.isObject3D&&s!==n.eventCount){const l=n.object,c=i.internal.interaction.indexOf(l);c>-1&&i.internal.interaction.splice(c,1),n.eventCount&&l.raycast!==null&&i.internal.interaction.push(l)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&WC(n),a}function WC(a){var e;if(!a.parent)return;a.props.onUpdate==null||a.props.onUpdate(a.object);const t=(e=a.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function G3(a,e){a.manual||(b3(a)?(a.left=e.width/-2,a.right=e.width/2,a.top=e.height/2,a.bottom=e.height/-2):a.aspect=e.width/e.height,a.updateProjectionMatrix())}const Ao=a=>a?.isObject3D;function qb(a){return(a.eventObject||a.object).uuid+"/"+a.index+a.instanceId}function B3(a,e,t,n){const i=t.get(e);i&&(t.delete(e),t.size===0&&(a.delete(n),i.target.releasePointerCapture(n)))}function vO(a,e){const{internal:t}=a.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,i)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((n,i)=>{B3(t.capturedMap,e,n,i)})}function GO(a){function e(c){const{internal:u}=a.getState(),h=c.offsetX-u.initialClick[0],A=c.offsetY-u.initialClick[1];return Math.round(Math.sqrt(h*h+A*A))}function t(c){return c.filter(u=>["Move","Over","Enter","Out","Leave"].some(h=>{var A;return(A=u.__r3f)==null?void 0:A.handlers["onPointer"+h]}))}function n(c,u){const h=a.getState(),A=new Set,f=[],p=u?u(h.internal.interaction):h.internal.interaction;for(let S=0;S<p.length;S++){const N=Jh(p[S]);N&&(N.raycaster.camera=void 0)}h.previousRoot||h.events.compute==null||h.events.compute(c,h);function y(S){const N=Jh(S);if(!N||!N.events.enabled||N.raycaster.camera===null)return[];if(N.raycaster.camera===void 0){var R;N.events.compute==null||N.events.compute(c,N,(R=N.previousRoot)==null?void 0:R.getState()),N.raycaster.camera===void 0&&(N.raycaster.camera=null)}return N.raycaster.camera?N.raycaster.intersectObject(S,!0):[]}let G=p.flatMap(y).sort((S,N)=>{const R=Jh(S.object),w=Jh(N.object);return!R||!w?S.distance-N.distance:w.events.priority-R.events.priority||S.distance-N.distance}).filter(S=>{const N=qb(S);return A.has(N)?!1:(A.add(N),!0)});h.events.filter&&(G=h.events.filter(G,h));for(const S of G){let N=S.object;for(;N;){var B;(B=N.__r3f)!=null&&B.eventCount&&f.push({...S,eventObject:N}),N=N.parent}}if("pointerId"in c&&h.internal.capturedMap.has(c.pointerId))for(let S of h.internal.capturedMap.get(c.pointerId).values())A.has(qb(S.intersection))||f.push(S.intersection);return f}function i(c,u,h,A){if(c.length){const f={stopped:!1};for(const p of c){let y=Jh(p.object);if(y||p.object.traverseAncestors(G=>{const B=Jh(G);if(B)return y=B,!1}),y){const{raycaster:G,pointer:B,camera:S,internal:N}=y,R=new ue(B.x,B.y,0).unproject(S),w=M=>{var E,O;return(E=(O=N.capturedMap.get(M))==null?void 0:O.has(p.eventObject))!=null?E:!1},V=M=>{const E={intersection:p,target:u.target};N.capturedMap.has(M)?N.capturedMap.get(M).set(p.eventObject,E):N.capturedMap.set(M,new Map([[p.eventObject,E]])),u.target.setPointerCapture(M)},H=M=>{const E=N.capturedMap.get(M);E&&B3(N.capturedMap,p.eventObject,E,M)};let X={};for(let M in u){let E=u[M];typeof E!="function"&&(X[M]=E)}let Y={...p,...X,pointer:B,intersections:c,stopped:f.stopped,delta:h,unprojectedPoint:R,ray:G.ray,camera:S,stopPropagation(){const M="pointerId"in u&&N.capturedMap.get(u.pointerId);if((!M||M.has(p.eventObject))&&(Y.stopped=f.stopped=!0,N.hovered.size&&Array.from(N.hovered.values()).find(E=>E.eventObject===p.eventObject))){const E=c.slice(0,c.indexOf(p));s([...E,p])}},target:{hasPointerCapture:w,setPointerCapture:V,releasePointerCapture:H},currentTarget:{hasPointerCapture:w,setPointerCapture:V,releasePointerCapture:H},nativeEvent:u};if(A(Y),f.stopped===!0)break}}}return c}function s(c){const{internal:u}=a.getState();for(const h of u.hovered.values())if(!c.length||!c.find(A=>A.object===h.object&&A.index===h.index&&A.instanceId===h.instanceId)){const f=h.eventObject.__r3f;if(u.hovered.delete(qb(h)),f!=null&&f.eventCount){const p=f.handlers,y={...h,intersections:c};p.onPointerOut==null||p.onPointerOut(y),p.onPointerLeave==null||p.onPointerLeave(y)}}}function o(c,u){for(let h=0;h<u.length;h++){const A=u[h].__r3f;A==null||A.handlers.onPointerMissed==null||A.handlers.onPointerMissed(c)}}function l(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return u=>{const{internal:h}=a.getState();"pointerId"in u&&h.capturedMap.has(u.pointerId)&&requestAnimationFrame(()=>{h.capturedMap.has(u.pointerId)&&(h.capturedMap.delete(u.pointerId),s([]))})}}return function(h){const{onPointerMissed:A,internal:f}=a.getState();f.lastEvent.current=h;const p=c==="onPointerMove",y=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",B=n(h,p?t:void 0),S=y?e(h):0;c==="onPointerDown"&&(f.initialClick=[h.offsetX,h.offsetY],f.initialHits=B.map(R=>R.eventObject)),y&&!B.length&&S<=2&&(o(h,f.interaction),A&&A(h)),p&&s(B);function N(R){const w=R.eventObject,V=w.__r3f;if(!(V!=null&&V.eventCount))return;const H=V.handlers;if(p){if(H.onPointerOver||H.onPointerEnter||H.onPointerOut||H.onPointerLeave){const X=qb(R),Y=f.hovered.get(X);Y?Y.stopped&&R.stopPropagation():(f.hovered.set(X,R),H.onPointerOver==null||H.onPointerOver(R),H.onPointerEnter==null||H.onPointerEnter(R))}H.onPointerMove==null||H.onPointerMove(R)}else{const X=H[c];X?(!y||f.initialHits.includes(w))&&(o(h,f.interaction.filter(Y=>!f.initialHits.includes(Y))),X(R)):y&&f.initialHits.includes(w)&&o(h,f.interaction.filter(Y=>!f.initialHits.includes(Y)))}}i(B,h,S,N)}}return{handlePointer:l}}const A1=a=>!!(a!=null&&a.render),ax=J.createContext(null),BO=(a,e)=>{const t=d3((l,c)=>{const u=new ue,h=new ue,A=new ue;function f(S=c().camera,N=h,R=c().size){const{width:w,height:V,top:H,left:X}=R,Y=w/V;N.isVector3?A.copy(N):A.set(...N);const M=S.getWorldPosition(u).distanceTo(A);if(b3(S))return{width:w/S.zoom,height:V/S.zoom,top:H,left:X,factor:1,distance:M,aspect:Y};{const E=S.fov*Math.PI/180,O=2*Math.tan(E/2)*M,P=O*(w/V);return{width:P,height:O,top:H,left:X,factor:w/P,distance:M,aspect:Y}}}let p;const y=S=>l(N=>({performance:{...N.performance,current:S}})),G=new yt;return{set:l,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(S=1)=>a(c(),S),advance:(S,N)=>e(S,N,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new jS,pointer:G,mouse:G,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const S=c();p&&clearTimeout(p),S.performance.current!==S.performance.min&&y(S.performance.min),p=setTimeout(()=>y(c().performance.max),S.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:f},setEvents:S=>l(N=>({...N,events:{...N.events,...S}})),setSize:(S,N,R=0,w=0)=>{const V=c().camera,H={width:S,height:N,top:R,left:w};l(X=>({size:H,viewport:{...X.viewport,...f(V,h,H)}}))},setDpr:S=>l(N=>{const R=y3(S);return{viewport:{...N.viewport,dpr:R,initialDpr:N.viewport.initialDpr||R}}}),setFrameloop:(S="always")=>{const N=c().clock;N.stop(),N.elapsedTime=0,S!=="never"&&(N.start(),N.elapsedTime=0),l(()=>({frameloop:S}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:J.createRef(),active:!1,frames:0,priority:0,subscribe:(S,N,R)=>{const w=c().internal;return w.priority=w.priority+(N>0?1:0),w.subscribers.push({ref:S,priority:N,store:R}),w.subscribers=w.subscribers.sort((V,H)=>V.priority-H.priority),()=>{const V=c().internal;V!=null&&V.subscribers&&(V.priority=V.priority-(N>0?1:0),V.subscribers=V.subscribers.filter(H=>H.ref!==S))}}}}}),n=t.getState();let i=n.size,s=n.viewport.dpr,o=n.camera;return t.subscribe(()=>{const{camera:l,size:c,viewport:u,gl:h,set:A}=t.getState();if(c.width!==i.width||c.height!==i.height||u.dpr!==s){i=c,s=u.dpr,G3(l,c),u.dpr>0&&h.setPixelRatio(u.dpr);const f=typeof HTMLCanvasElement<"u"&&h.domElement instanceof HTMLCanvasElement;h.setSize(c.width,c.height,f)}l!==o&&(o=l,A(f=>({viewport:{...f.viewport,...f.viewport.getCurrentViewport(l)}})))}),t.subscribe(l=>a(l)),t};function sx(){const a=J.useContext(ax);if(!a)throw new Error("R3F: Hooks can only be used within the Canvas component!");return a}function Gs(a=t=>t,e){return sx()(a,e)}function ox(a,e=0){const t=sx(),n=t.getState().internal.subscribe,i=ix(a);return zm(()=>n(i,e,t),[e,n,t]),null}const f1=new WeakMap,SO=a=>{var e;return typeof a=="function"&&(a==null||(e=a.prototype)==null?void 0:e.constructor)===a};function S3(a,e){return function(t,...n){let i;return SO(t)?(i=f1.get(t),i||(i=new t,f1.set(t,i))):i=t,a&&a(i),Promise.all(n.map(s=>new Promise((o,l)=>i.load(s,c=>{Ao(c?.scene)&&Object.assign(c,CO(c.scene)),o(c)},e,c=>l(new Error(`Could not load ${s}: ${c?.message}`))))))}}function wg(a,e,t,n){const i=Array.isArray(e)?e:[e],s=C3(S3(t,n),[a,...i],{equal:Qi.equ});return Array.isArray(e)?s:s[0]}wg.preload=function(a,e,t){const n=Array.isArray(e)?e:[e];return PD(S3(t),[a,...n])};wg.clear=function(a,e){const t=Array.isArray(e)?e:[e];return QD([a,...t])};var xO={version:"9.4.2"};function ZO(a){const e=iO(a);return e.injectIntoDevTools(),e}const x3=0,SC={},wO=/^three(?=[A-Z])/,yv=a=>`${a[0].toUpperCase()}${a.slice(1)}`;let RO=0;const NO=a=>typeof a=="function";function Z3(a){if(NO(a)){const e=`${RO++}`;return SC[e]=a,e}else Object.assign(SC,a)}function w3(a,e){const t=yv(a),n=SC[t];if(a!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(a==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function WO(a,e,t){var n;return a=yv(a)in SC?a:a.replace(wO,""),w3(a,e),a==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,yy(e.object,t,a,e)}function VO(a){if(!a.isHidden){var e;a.props.attach&&(e=a.parent)!=null&&e.object?Gy(a.parent,a):Ao(a.object)&&(a.object.visible=!1),a.isHidden=!0,WC(a)}}function R3(a){if(a.isHidden){var e;a.props.attach&&(e=a.parent)!=null&&e.object?vy(a.parent,a):Ao(a.object)&&a.props.visible!==!1&&(a.object.visible=!0),a.isHidden=!1,WC(a)}}function rx(a,e,t){const n=e.root.getState();if(!(!a.parent&&a.object!==n.scene)){if(!e.object){var i,s;const o=SC[yv(e.type)];e.object=(i=e.props.object)!=null?i:new o(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(yc(e.object,e.props),e.props.attach)vy(a,e);else if(Ao(e.object)&&Ao(a.object)){const o=a.object.children.indexOf(t?.object);if(t&&o!==-1){const l=a.object.children.indexOf(e.object);if(l!==-1){a.object.children.splice(l,1);const c=l<o?o-1:o;a.object.children.splice(c,0,e.object)}else e.object.parent=a.object,a.object.children.splice(o,0,e.object),e.object.dispatchEvent({type:"added"}),a.object.dispatchEvent({type:"childadded",child:e.object})}else a.object.add(e.object)}for(const o of e.children)rx(e,o);WC(e)}}function NB(a,e){e&&(e.parent=a,a.children.push(e),rx(a,e))}function m1(a,e,t){if(!e||!t)return;e.parent=a;const n=a.children.indexOf(t);n!==-1?a.children.splice(n,0,e):a.children.push(e),rx(a,e,t)}function N3(a){if(typeof a.dispose=="function"){const e=()=>{try{a.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():I1.unstable_scheduleCallback(I1.unstable_IdlePriority,e)}}function E2(a,e,t){if(!e)return;e.parent=null;const n=a.children.indexOf(e);n!==-1&&a.children.splice(n,1),e.props.attach?Gy(a,e):Ao(e.object)&&Ao(a.object)&&(a.object.remove(e.object),vO(p3(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const o=e.children[s];E2(e,o,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&N3(e.object),t===void 0&&WC(e)}function MO(a,e){for(const t of[a,a.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const b0=[];function _O(){for(const[t]of b0){const n=t.parent;if(n){t.props.attach?Gy(n,t):Ao(t.object)&&Ao(n.object)&&n.object.remove(t.object);for(const i of t.children)i.props.attach?Gy(t,i):Ao(i.object)&&Ao(t.object)&&t.object.remove(i.object)}t.isHidden&&R3(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&N3(t.object)}for(const[t,n,i]of b0){t.props=n;const s=t.parent;if(s){var a,e;const o=SC[yv(t.type)];t.object=(a=t.props.object)!=null?a:new o(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,MO(i,t.object),yc(t.object,t.props),t.props.attach?vy(s,t):Ao(t.object)&&Ao(s.object)&&s.object.add(t.object);for(const l of t.children)l.props.attach?vy(t,l):Ao(l.object)&&Ao(t.object)&&t.object.add(l.object);WC(t)}}b0.length=0}const WB=()=>{},p1={};let $b=x3;const XO=0,YO=4,By=ZO({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:WO,removeChild:E2,appendChild:NB,appendInitialChild:NB,insertBefore:m1,appendChildToContainer(a,e){const t=a.getState().scene.__r3f;!e||!t||NB(t,e)},removeChildFromContainer(a,e){const t=a.getState().scene.__r3f;!e||!t||E2(t,e)},insertInContainerBefore(a,e,t){const n=a.getState().scene.__r3f;!e||!t||!n||m1(n,e,t)},getRootHostContext:()=>p1,getChildHostContext:()=>p1,commitUpdate(a,e,t,n,i){var s,o,l;w3(e,n);let c=!1;if((a.type==="primitive"&&t.object!==n.object||((s=n.args)==null?void 0:s.length)!==((o=t.args)==null?void 0:o.length)||(l=n.args)!=null&&l.some((h,A)=>{var f;return h!==((f=t.args)==null?void 0:f[A])}))&&(c=!0),c)b0.push([a,{...n},i]);else{const h=pO(a,n);Object.keys(h).length&&(Object.assign(a.props,h),yc(a.object,h))}(i.sibling===null||(i.flags&YO)===XO)&&_O()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:a=>a?.object,prepareForCommit:()=>null,preparePortalMount:a=>yy(a.getState().scene,a,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:VO,unhideInstance:R3,createTextInstance:WB,hideTextInstance:WB,unhideTextInstance:WB,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:J.createContext(null),setCurrentUpdatePriority(a){$b=a},getCurrentUpdatePriority(){return $b},resolveUpdatePriority(){var a;if($b!==x3)return $b;switch(typeof window<"u"&&((a=window.event)==null?void 0:a.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return A0.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return A0.ContinuousEventPriority;default:return A0.DefaultEventPriority}},resetFormInstance(){},rendererPackageName:"@react-three/fiber",rendererVersion:xO.version}),fI=new Map,Ph={objects:"shallow",strict:!1};function HO(a,e){if(!e&&typeof HTMLCanvasElement<"u"&&a instanceof HTMLCanvasElement&&a.parentElement){const{width:t,height:n,top:i,left:s}=a.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&a instanceof OffscreenCanvas)return{width:a.width,height:a.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function EO(a){const e=fI.get(a),t=e?.fiber,n=e?.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=n||BO(T2,y1),o=t||By.createContainer(s,A0.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||fI.set(a,{fiber:o,store:s});let l,c,u=!1,h=null;return{async configure(A={}){let f;h=new Promise(T=>f=T);let{gl:p,size:y,scene:G,events:B,onCreated:S,shadows:N=!1,linear:R=!1,flat:w=!1,legacy:V=!1,orthographic:H=!1,frameloop:X="always",dpr:Y=[1,2],performance:M,raycaster:E,camera:O,onPointerMissed:P}=A,q=s.getState(),k=q.gl;if(!q.gl){const T={canvas:a,powerPreference:"high-performance",antialias:!0,alpha:!0},$=typeof p=="function"?await p(T):p;A1($)?k=$:k=new ex({...T,...p}),q.set({gl:k})}let le=q.raycaster;le||q.set({raycaster:le=new qS});const{params:F,...j}=E||{};if(Qi.equ(j,le,Ph)||yc(le,{...j}),Qi.equ(F,le.params,Ph)||yc(le,{params:{...le.params,...F}}),!q.camera||q.camera===c&&!Qi.equ(c,O,Ph)){c=O;const T=O?.isCamera,$=T?O:H?new xc(0,0,0,0,.1,1e3):new Ga(75,0,.1,1e3);T||($.position.z=5,O&&(yc($,O),$.manual||("aspect"in O||"left"in O||"right"in O||"bottom"in O||"top"in O)&&($.manual=!0,$.updateProjectionMatrix())),!q.camera&&!(O!=null&&O.rotation)&&$.lookAt(0,0,0)),q.set({camera:$}),le.camera=$}if(!q.scene){let T;G!=null&&G.isScene?(T=G,yy(T,s,"",{})):(T=new _m,yy(T,s,"",{}),G&&yc(T,G)),q.set({scene:T})}B&&!q.events.handlers&&q.set({events:B(s)});const Q=HO(a,y);if(Qi.equ(Q,q.size,Ph)||q.setSize(Q.width,Q.height,Q.top,Q.left),Y&&q.viewport.dpr!==y3(Y)&&q.setDpr(Y),q.frameloop!==X&&q.setFrameloop(X),q.onPointerMissed||q.set({onPointerMissed:P}),M&&!Qi.equ(M,q.performance,Ph)&&q.set(T=>({performance:{...T.performance,...M}})),!q.xr){var ce;const T=(Ie,be)=>{const D=s.getState();D.frameloop!=="never"&&y1(Ie,!0,D,be)},$=()=>{const Ie=s.getState();Ie.gl.xr.enabled=Ie.gl.xr.isPresenting,Ie.gl.xr.setAnimationLoop(Ie.gl.xr.isPresenting?T:null),Ie.gl.xr.isPresenting||T2(Ie)},ae={connect(){const Ie=s.getState().gl;Ie.xr.addEventListener("sessionstart",$),Ie.xr.addEventListener("sessionend",$)},disconnect(){const Ie=s.getState().gl;Ie.xr.removeEventListener("sessionstart",$),Ie.xr.removeEventListener("sessionend",$)}};typeof((ce=k.xr)==null?void 0:ce.addEventListener)=="function"&&ae.connect(),q.set({xr:ae})}if(k.shadowMap){const T=k.shadowMap.enabled,$=k.shadowMap.type;if(k.shadowMap.enabled=!!N,Qi.boo(N))k.shadowMap.type=Yf;else if(Qi.str(N)){var oe;const ae={basic:SW,percentage:gC,soft:Yf,variance:nI};k.shadowMap.type=(oe=ae[N])!=null?oe:Yf}else Qi.obj(N)&&Object.assign(k.shadowMap,N);(T!==k.shadowMap.enabled||$!==k.shadowMap.type)&&(k.shadowMap.needsUpdate=!0)}return ei.enabled=!V,u||(k.outputColorSpace=R?Ml:Bs,k.toneMapping=w?zr:Xy),q.legacy!==V&&q.set(()=>({legacy:V})),q.linear!==R&&q.set(()=>({linear:R})),q.flat!==w&&q.set(()=>({flat:w})),p&&!Qi.fun(p)&&!A1(p)&&!Qi.equ(p,k,Ph)&&yc(k,p),l=S,u=!0,f(),this},render(A){return!u&&!h&&this.configure(),h.then(()=>{By.updateContainer(m.jsx(FO,{store:s,children:A,onCreated:l,rootElement:a}),o,null,()=>{})}),s},unmount(){W3(a)}}}function FO({store:a,children:e,onCreated:t,rootElement:n}){return zm(()=>{const i=a.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),a.getState().events.connected||i.events.connect==null||i.events.connect(n)},[]),m.jsx(ax.Provider,{value:a,children:e})}function W3(a,e){const t=fI.get(a),n=t?.fiber;if(n){const i=t?.store.getState();i&&(i.internal.active=!1),By.updateContainer(null,n,null,()=>{i&&setTimeout(()=>{try{var s,o,l,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(o=s.renderLists)==null||o.dispose==null||o.dispose(),(l=i.gl)==null||l.forceContextLoss==null||l.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),AO(i.scene),fI.delete(a)}catch{}},500)})}}function KO(a,e,t){return m.jsx(TO,{children:a,container:e,state:t})}function TO({state:a={},children:e,container:t}){const{events:n,size:i,...s}=a,o=sx(),[l]=J.useState(()=>new qS),[c]=J.useState(()=>new yt),u=ix((A,f)=>{let p;if(f.camera&&i){const y=f.camera;p=A.viewport.getCurrentViewport(y,new ue,i),y!==A.camera&&G3(y,i)}return{...A,...f,scene:t,raycaster:l,pointer:c,mouse:c,previousRoot:o,events:{...A.events,...f.events,...n},size:{...A.size,...i},viewport:{...A.viewport,...p},setEvents:y=>f.set(G=>({...G,events:{...G.events,...y}}))}}),h=J.useMemo(()=>{const A=d3((p,y)=>({...s,set:p,get:y})),f=p=>A.setState(y=>u.current(p,y));return f(o.getState()),o.subscribe(f),A},[o,t]);return m.jsx(m.Fragment,{children:By.createPortal(m.jsx(ax.Provider,{value:h,children:e}),h,null)})}const zO=new Set,LO=new Set,kO=new Set;function VB(a,e){if(a.size)for(const{callback:t}of a.values())t(e)}function Uf(a,e){switch(a){case"before":return VB(zO,e);case"after":return VB(LO,e);case"tail":return VB(kO,e)}}let MB,_B;function F2(a,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof a=="number"&&(n=a-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=a),MB=e.internal.subscribers;for(let i=0;i<MB.length;i++)_B=MB[i],_B.ref.current(_B.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let Sy=!1,K2=!1,XB,b1,Qh;function V3(a){b1=requestAnimationFrame(V3),Sy=!0,XB=0,Uf("before",a),K2=!0;for(const t of fI.values()){var e;Qh=t.store.getState(),Qh.internal.active&&(Qh.frameloop==="always"||Qh.internal.frames>0)&&!((e=Qh.gl.xr)!=null&&e.isPresenting)&&(XB+=F2(a,Qh))}if(K2=!1,Uf("after",a),XB===0)return Uf("tail",a),Sy=!1,cancelAnimationFrame(b1)}function T2(a,e=1){var t;if(!a)return fI.forEach(n=>T2(n.store.getState(),e));(t=a.gl.xr)!=null&&t.isPresenting||!a.internal.active||a.frameloop==="never"||(e>1?a.internal.frames=Math.min(60,a.internal.frames+e):K2?a.internal.frames=2:a.internal.frames=1,Sy||(Sy=!0,requestAnimationFrame(V3)))}function y1(a,e=!0,t,n){if(e&&Uf("before",a),t)F2(a,t,n);else for(const i of fI.values())F2(a,i.store.getState());e&&Uf("after",a)}const YB={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function UO(a){const{handlePointer:e}=GO(a);return{priority:1,enabled:!0,compute(t,n,i){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(YB).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:i}=a.getState();(t=i.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=a.getState();if(i.disconnect==null||i.disconnect(),n(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const o=i.handlers[s],[l,c]=YB[s];t.addEventListener(l,o,{passive:c})}},disconnect:()=>{const{set:t,events:n}=a.getState();if(n.connected){if(n.handlers)for(const i in n.handlers){const s=n.handlers[i],[o]=YB[i];n.connected.removeEventListener(o,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}function v1(a,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>a(...n),e)}}function DO({debounce:a,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,o]=J.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=J.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=a?typeof a=="number"?a:a.scroll:null,u=a?typeof a=="number"?a:a.resize:null,h=J.useRef(!1);J.useEffect(()=>(h.current=!0,()=>{h.current=!1}));const[A,f,p]=J.useMemo(()=>{const S=()=>{if(!l.current.element)return;const{left:N,top:R,width:w,height:V,bottom:H,right:X,x:Y,y:M}=l.current.element.getBoundingClientRect(),E={left:N,top:R,width:w,height:V,bottom:H,right:X,x:Y,y:M};l.current.element instanceof HTMLElement&&n&&(E.height=l.current.element.offsetHeight,E.width=l.current.element.offsetWidth),Object.freeze(E),h.current&&!PO(l.current.lastBounds,E)&&o(l.current.lastBounds=E)};return[S,u?v1(S,u):S,c?v1(S,c):S]},[o,n,c,u]);function y(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(S=>S.removeEventListener("scroll",p,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null),l.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",l.current.orientationHandler))}function G(){l.current.element&&(l.current.resizeObserver=new i(p),l.current.resizeObserver.observe(l.current.element),e&&l.current.scrollContainers&&l.current.scrollContainers.forEach(S=>S.addEventListener("scroll",p,{capture:!0,passive:!0})),l.current.orientationHandler=()=>{p()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",l.current.orientationHandler))}const B=S=>{!S||S===l.current.element||(y(),l.current.element=S,l.current.scrollContainers=M3(S),G())};return jO(p,!!e),OO(f),J.useEffect(()=>{y(),G()},[e,p,f]),J.useEffect(()=>y,[]),[B,s,A]}function OO(a){J.useEffect(()=>{const e=a;return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e)}},[a])}function jO(a,e){J.useEffect(()=>{if(e){const t=a;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>{window.removeEventListener("scroll",t,!0)}}},[a,e])}function M3(a){const e=[];if(!a||a===document.body)return e;const{overflow:t,overflowX:n,overflowY:i}=window.getComputedStyle(a);return[t,n,i].some(s=>s==="auto"||s==="scroll")&&e.push(a),[...e,...M3(a.parentElement)]}const JO=["x","y","top","bottom","left","right","width","height"],PO=(a,e)=>JO.every(t=>a[t]===e[t]);function QO({ref:a,children:e,fallback:t,resize:n,style:i,gl:s,events:o=UO,eventSource:l,eventPrefix:c,shadows:u,linear:h,flat:A,legacy:f,orthographic:p,frameloop:y,dpr:G,performance:B,raycaster:S,camera:N,scene:R,onPointerMissed:w,onCreated:V,...H}){J.useMemo(()=>Z3(ED),[]);const X=dO(),[Y,M]=DO({scroll:!0,debounce:{scroll:50,resize:0},...n}),E=J.useRef(null),O=J.useRef(null);J.useImperativeHandle(a,()=>E.current);const P=ix(w),[q,k]=J.useState(!1),[le,F]=J.useState(!1);if(q)throw q;if(le)throw le;const j=J.useRef(null);zm(()=>{const ce=E.current;if(M.width>0&&M.height>0&&ce){j.current||(j.current=EO(ce));async function oe(){await j.current.configure({gl:s,scene:R,events:o,shadows:u,linear:h,flat:A,legacy:f,orthographic:p,frameloop:y,dpr:G,performance:B,raycaster:S,camera:N,size:M,onPointerMissed:(...T)=>P.current==null?void 0:P.current(...T),onCreated:T=>{T.events.connect==null||T.events.connect(l?gO(l)?l.current:l:O.current),c&&T.setEvents({compute:($,ae)=>{const Ie=$[c+"X"],be=$[c+"Y"];ae.pointer.set(Ie/ae.size.width*2-1,-(be/ae.size.height)*2+1),ae.raycaster.setFromCamera(ae.pointer,ae.camera)}}),V?.(T)}}),j.current.render(m.jsx(X,{children:m.jsx(hO,{set:F,children:m.jsx(J.Suspense,{fallback:m.jsx(IO,{set:k}),children:e??null})})}))}oe()}}),J.useEffect(()=>{const ce=E.current;if(ce)return()=>W3(ce)},[]);const Q=l?"none":"auto";return m.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:Q,...i},...H,children:m.jsx("div",{ref:Y,style:{width:"100%",height:"100%"},children:m.jsx("canvas",{ref:E,style:{display:"block"},children:t})})})}function qO(a){return m.jsx(f3,{children:m.jsx(QO,{...a})})}var lx={exports:{}},IC=typeof Reflect=="object"?Reflect:null,G1=IC&&typeof IC.apply=="function"?IC.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)},y0;IC&&typeof IC.ownKeys=="function"?y0=IC.ownKeys:Object.getOwnPropertySymbols?y0=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:y0=function(e){return Object.getOwnPropertyNames(e)};function $O(a){console&&console.warn&&console.warn(a)}var _3=Number.isNaN||function(e){return e!==e};function wi(){wi.init.call(this)}lx.exports=wi;lx.exports.once=ij;wi.EventEmitter=wi;wi.prototype._events=void 0;wi.prototype._eventsCount=0;wi.prototype._maxListeners=void 0;var B1=10;function vv(a){if(typeof a!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof a)}Object.defineProperty(wi,"defaultMaxListeners",{enumerable:!0,get:function(){return B1},set:function(a){if(typeof a!="number"||a<0||_3(a))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+a+".");B1=a}});wi.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};wi.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||_3(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function X3(a){return a._maxListeners===void 0?wi.defaultMaxListeners:a._maxListeners}wi.prototype.getMaxListeners=function(){return X3(this)};wi.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var i=e==="error",s=this._events;if(s!==void 0)i=i&&s.error===void 0;else if(!i)return!1;if(i){var o;if(t.length>0&&(o=t[0]),o instanceof Error)throw o;var l=new Error("Unhandled error."+(o?" ("+o.message+")":""));throw l.context=o,l}var c=s[e];if(c===void 0)return!1;if(typeof c=="function")G1(c,this,t);else for(var u=c.length,h=K3(c,u),n=0;n<u;++n)G1(h[n],this,t);return!0};function Y3(a,e,t,n){var i,s,o;if(vv(t),s=a._events,s===void 0?(s=a._events=Object.create(null),a._eventsCount=0):(s.newListener!==void 0&&(a.emit("newListener",e,t.listener?t.listener:t),s=a._events),o=s[e]),o===void 0)o=s[e]=t,++a._eventsCount;else if(typeof o=="function"?o=s[e]=n?[t,o]:[o,t]:n?o.unshift(t):o.push(t),i=X3(a),i>0&&o.length>i&&!o.warned){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=a,l.type=e,l.count=o.length,$O(l)}return a}wi.prototype.addListener=function(e,t){return Y3(this,e,t,!1)};wi.prototype.on=wi.prototype.addListener;wi.prototype.prependListener=function(e,t){return Y3(this,e,t,!0)};function ej(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function H3(a,e,t){var n={fired:!1,wrapFn:void 0,target:a,type:e,listener:t},i=ej.bind(n);return i.listener=t,n.wrapFn=i,i}wi.prototype.once=function(e,t){return vv(t),this.on(e,H3(this,e,t)),this};wi.prototype.prependOnceListener=function(e,t){return vv(t),this.prependListener(e,H3(this,e,t)),this};wi.prototype.removeListener=function(e,t){var n,i,s,o,l;if(vv(t),i=this._events,i===void 0)return this;if(n=i[e],n===void 0)return this;if(n===t||n.listener===t)--this._eventsCount===0?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,n.listener||t));else if(typeof n!="function"){for(s=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){l=n[o].listener,s=o;break}if(s<0)return this;s===0?n.shift():tj(n,s),n.length===1&&(i[e]=n[0]),i.removeListener!==void 0&&this.emit("removeListener",e,l||t)}return this};wi.prototype.off=wi.prototype.removeListener;wi.prototype.removeAllListeners=function(e){var t,n,i;if(n=this._events,n===void 0)return this;if(n.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):n[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete n[e]),this;if(arguments.length===0){var s=Object.keys(n),o;for(i=0;i<s.length;++i)o=s[i],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(t=n[e],typeof t=="function")this.removeListener(e,t);else if(t!==void 0)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this};function E3(a,e,t){var n=a._events;if(n===void 0)return[];var i=n[e];return i===void 0?[]:typeof i=="function"?t?[i.listener||i]:[i]:t?nj(i):K3(i,i.length)}wi.prototype.listeners=function(e){return E3(this,e,!0)};wi.prototype.rawListeners=function(e){return E3(this,e,!1)};wi.listenerCount=function(a,e){return typeof a.listenerCount=="function"?a.listenerCount(e):F3.call(a,e)};wi.prototype.listenerCount=F3;function F3(a){var e=this._events;if(e!==void 0){var t=e[a];if(typeof t=="function")return 1;if(t!==void 0)return t.length}return 0}wi.prototype.eventNames=function(){return this._eventsCount>0?y0(this._events):[]};function K3(a,e){for(var t=new Array(e),n=0;n<e;++n)t[n]=a[n];return t}function tj(a,e){for(;e+1<a.length;e++)a[e]=a[e+1];a.pop()}function nj(a){for(var e=new Array(a.length),t=0;t<e.length;++t)e[t]=a[t].listener||a[t];return e}function ij(a,e){return new Promise(function(t,n){function i(o){a.removeListener(e,s),n(o)}function s(){typeof a.removeListener=="function"&&a.removeListener("error",i),t([].slice.call(arguments))}T3(a,e,s,{once:!0}),e!=="error"&&aj(a,i,{once:!0})})}function aj(a,e,t){typeof a.on=="function"&&T3(a,"error",e,t)}function T3(a,e,t,n){if(typeof a.on=="function")n.once?a.once(e,t):a.on(e,t);else if(typeof a.addEventListener=="function")a.addEventListener(e,function i(s){n.once&&a.removeEventListener(e,i),t(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof a)}var sj=lx.exports;function oj(a,e){var t=atob(a);return t}function rj(a,e,t){var n=oj(a),i=n.indexOf(`
`,10)+1,s=n.substring(i)+"",o=new Blob([s],{type:"application/javascript"});return URL.createObjectURL(o)}function lj(a,e,t){var n;return function(s){return n=n||rj(a),new Worker(n,s)}}var cj=lj("Lyogcm9sbHVwLXBsdWdpbi13ZWItd29ya2VyLWxvYWRlciAqLwooZnVuY3Rpb24gKCkgewogICd1c2Ugc3RyaWN0JzsKCiAgLyoqCiAgICogUmVjb3JkcyB3aGF0IG9iamVjdHMgYXJlIGNvbGxpZGluZyB3aXRoIGVhY2ggb3RoZXIKICAgKi8KCiAgLyoqCiAgICogQSAzeDMgbWF0cml4LgogICAqIEF1dGhvcmVkIGJ5IHtAbGluayBodHRwOi8vZ2l0aHViLmNvbS9zY2h0ZXBwZS8gc2NodGVwcGV9CiAgICovCiAgY2xhc3MgTWF0MyB7CiAgICAvKioKICAgICAqIEEgdmVjdG9yIG9mIGxlbmd0aCA5LCBjb250YWluaW5nIGFsbCBtYXRyaXggZWxlbWVudHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBwYXJhbSBlbGVtZW50cyBBIHZlY3RvciBvZiBsZW5ndGggOSwgY29udGFpbmluZyBhbGwgbWF0cml4IGVsZW1lbnRzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihlbGVtZW50cykgewogICAgICBpZiAoZWxlbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIGVsZW1lbnRzID0gWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdOwogICAgICB9CgogICAgICB0aGlzLmVsZW1lbnRzID0gZWxlbWVudHM7CiAgICB9CiAgICAvKioKICAgICAqIFNldHMgdGhlIG1hdHJpeCB0byBpZGVudGl0eQogICAgICogQHRvZG8gU2hvdWxkIHBlcmhhcHMgYmUgcmVuYW1lZCB0byBgc2V0SWRlbnRpdHkoKWAgdG8gYmUgbW9yZSBjbGVhci4KICAgICAqIEB0b2RvIENyZWF0ZSBhbm90aGVyIGZ1bmN0aW9uIHRoYXQgaW1tZWRpYXRlbHkgY3JlYXRlcyBhbiBpZGVudGl0eSBtYXRyaXggZWcuIGBleWUoKWAKICAgICAqLwoKCiAgICBpZGVudGl0eSgpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSAxOwogICAgICBlWzFdID0gMDsKICAgICAgZVsyXSA9IDA7CiAgICAgIGVbM10gPSAwOwogICAgICBlWzRdID0gMTsKICAgICAgZVs1XSA9IDA7CiAgICAgIGVbNl0gPSAwOwogICAgICBlWzddID0gMDsKICAgICAgZVs4XSA9IDE7CiAgICB9CiAgICAvKioKICAgICAqIFNldCBhbGwgZWxlbWVudHMgdG8gemVybwogICAgICovCgoKICAgIHNldFplcm8oKSB7CiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBlWzBdID0gMDsKICAgICAgZVsxXSA9IDA7CiAgICAgIGVbMl0gPSAwOwogICAgICBlWzNdID0gMDsKICAgICAgZVs0XSA9IDA7CiAgICAgIGVbNV0gPSAwOwogICAgICBlWzZdID0gMDsKICAgICAgZVs3XSA9IDA7CiAgICAgIGVbOF0gPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBtYXRyaXggZGlhZ29uYWwgZWxlbWVudHMgZnJvbSBhIFZlYzMKICAgICAqLwoKCiAgICBzZXRUcmFjZSh2ZWN0b3IpIHsKICAgICAgY29uc3QgZSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGVbMF0gPSB2ZWN0b3IueDsKICAgICAgZVs0XSA9IHZlY3Rvci55OwogICAgICBlWzhdID0gdmVjdG9yLno7CiAgICB9CiAgICAvKioKICAgICAqIEdldHMgdGhlIG1hdHJpeCBkaWFnb25hbCBlbGVtZW50cwogICAgICovCgoKICAgIGdldFRyYWNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgdGFyZ2V0LnggPSBlWzBdOwogICAgICB0YXJnZXQueSA9IGVbNF07CiAgICAgIHRhcmdldC56ID0gZVs4XTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LVZlY3RvciBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIHYgVGhlIHZlY3RvciB0byBtdWx0aXBseSB3aXRoCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLCB0YXJnZXQgdG8gc2F2ZSB0aGUgcmVzdWx0IGluLgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgeCA9IHYueDsKICAgICAgY29uc3QgeSA9IHYueTsKICAgICAgY29uc3QgeiA9IHYuejsKICAgICAgdGFyZ2V0LnggPSBlWzBdICogeCArIGVbMV0gKiB5ICsgZVsyXSAqIHo7CiAgICAgIHRhcmdldC55ID0gZVszXSAqIHggKyBlWzRdICogeSArIGVbNV0gKiB6OwogICAgICB0YXJnZXQueiA9IGVbNl0gKiB4ICsgZVs3XSAqIHkgKyBlWzhdICogejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTWF0cml4LXNjYWxhciBtdWx0aXBsaWNhdGlvbgogICAgICovCgoKICAgIHNtdWx0KHMpIHsKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSAqPSBzOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIE1hdHJpeCBtdWx0aXBsaWNhdGlvbgogICAgICogQHBhcmFtIG1hdHJpeCBNYXRyaXggdG8gbXVsdGlwbHkgd2l0aCBmcm9tIGxlZnQgc2lkZS4KICAgICAqLwoKCiAgICBtbXVsdChtYXRyaXgsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgTWF0MygpOwogICAgICB9CgogICAgICBjb25zdCBBID0gdGhpcy5lbGVtZW50czsKICAgICAgY29uc3QgQiA9IG1hdHJpeC5lbGVtZW50czsKICAgICAgY29uc3QgVCA9IHRhcmdldC5lbGVtZW50czsKICAgICAgY29uc3QgYTExID0gQVswXSwKICAgICAgICAgICAgYTEyID0gQVsxXSwKICAgICAgICAgICAgYTEzID0gQVsyXSwKICAgICAgICAgICAgYTIxID0gQVszXSwKICAgICAgICAgICAgYTIyID0gQVs0XSwKICAgICAgICAgICAgYTIzID0gQVs1XSwKICAgICAgICAgICAgYTMxID0gQVs2XSwKICAgICAgICAgICAgYTMyID0gQVs3XSwKICAgICAgICAgICAgYTMzID0gQVs4XTsKICAgICAgY29uc3QgYjExID0gQlswXSwKICAgICAgICAgICAgYjEyID0gQlsxXSwKICAgICAgICAgICAgYjEzID0gQlsyXSwKICAgICAgICAgICAgYjIxID0gQlszXSwKICAgICAgICAgICAgYjIyID0gQls0XSwKICAgICAgICAgICAgYjIzID0gQls1XSwKICAgICAgICAgICAgYjMxID0gQls2XSwKICAgICAgICAgICAgYjMyID0gQls3XSwKICAgICAgICAgICAgYjMzID0gQls4XTsKICAgICAgVFswXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKICAgICAgVFsxXSA9IGExMSAqIGIxMiArIGExMiAqIGIyMiArIGExMyAqIGIzMjsKICAgICAgVFsyXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMzsKICAgICAgVFszXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMTsKICAgICAgVFs0XSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKICAgICAgVFs1XSA9IGEyMSAqIGIxMyArIGEyMiAqIGIyMyArIGEyMyAqIGIzMzsKICAgICAgVFs2XSA9IGEzMSAqIGIxMSArIGEzMiAqIGIyMSArIGEzMyAqIGIzMTsKICAgICAgVFs3XSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMjsKICAgICAgVFs4XSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2NhbGUgZWFjaCBjb2x1bW4gb2YgdGhlIG1hdHJpeAogICAgICovCgoKICAgIHNjYWxlKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGUgPSB0aGlzLmVsZW1lbnRzOwogICAgICBjb25zdCB0ID0gdGFyZ2V0LmVsZW1lbnRzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDM7IGkrKykgewogICAgICAgIHRbMyAqIGkgKyAwXSA9IHZlY3Rvci54ICogZVszICogaSArIDBdOwogICAgICAgIHRbMyAqIGkgKyAxXSA9IHZlY3Rvci55ICogZVszICogaSArIDFdOwogICAgICAgIHRbMyAqIGkgKyAyXSA9IHZlY3Rvci56ICogZVszICogaSArIDJdOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTb2x2ZSBBeD1iCiAgICAgKiBAcGFyYW0gYiBUaGUgcmlnaHQgaGFuZCBzaWRlCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBUYXJnZXQgdmVjdG9yIHRvIHNhdmUgaW4uCiAgICAgKiBAcmV0dXJuIFRoZSBzb2x1dGlvbiB4CiAgICAgKiBAdG9kbyBzaG91bGQgcmV1c2UgYXJyYXlzCiAgICAgKi8KCgogICAgc29sdmUoYiwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA0OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IFtdOwogICAgICBsZXQgaTsKICAgICAgbGV0IGo7CgogICAgICBmb3IgKGkgPSAwOyBpIDwgbnIgKiBuYzsgaSsrKSB7CiAgICAgICAgZXFucy5wdXNoKDApOwogICAgICB9CgogICAgICBmb3IgKGkgPSAwOyBpIDwgMzsgaSsrKSB7CiAgICAgICAgZm9yIChqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgZXFuc1tpICsgbmMgKiBqXSA9IHRoaXMuZWxlbWVudHNbaSArIDMgKiBqXTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGVxbnNbMyArIDQgKiAwXSA9IGIueDsKICAgICAgZXFuc1szICsgNCAqIDFdID0gYi55OwogICAgICBlcW5zWzMgKyA0ICogMl0gPSBiLno7IC8vIENvbXB1dGUgcmlnaHQgdXBwZXIgdHJpYW5ndWxhciB2ZXJzaW9uIG9mIHRoZSBtYXRyaXggLSBHYXVzcyBlbGltaW5hdGlvbgoKICAgICAgbGV0IG4gPSAzOwogICAgICBjb25zdCBrID0gbjsKICAgICAgbGV0IG5wOwogICAgICBjb25zdCBrcCA9IDQ7IC8vIG51bSByb3dzCgogICAgICBsZXQgcDsKCiAgICAgIGRvIHsKICAgICAgICBpID0gayAtIG47CgogICAgICAgIGlmIChlcW5zW2kgKyBuYyAqIGldID09PSAwKSB7CiAgICAgICAgICAvLyB0aGUgcGl2b3QgaXMgbnVsbCwgc3dhcCBsaW5lcwogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgaWYgKGVxbnNbaSArIG5jICogal0gIT09IDApIHsKICAgICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgICBkbyB7CiAgICAgICAgICAgICAgICAvLyBkbyBsaWduZSggaSApID0gbGlnbmUoIGkgKSArIGxpZ25lKCBrICkKICAgICAgICAgICAgICAgIHAgPSBrcCAtIG5wOwogICAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBpXSArPSBlcW5zW3AgKyBuYyAqIGpdOwogICAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwoKICAgICAgICAgICAgICBicmVhazsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gIT09IDApIHsKICAgICAgICAgIGZvciAoaiA9IGkgKyAxOyBqIDwgazsgaisrKSB7CiAgICAgICAgICAgIGNvbnN0IG11bHRpcGxpZXIgPSBlcW5zW2kgKyBuYyAqIGpdIC8gZXFuc1tpICsgbmMgKiBpXTsKICAgICAgICAgICAgbnAgPSBrcDsKCiAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAvLyBkbyBsaWduZSggayApID0gbGlnbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaWduZSggaSApCiAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgZXFuc1twICsgbmMgKiBqXSA9IHAgPD0gaSA/IDAgOiBlcW5zW3AgKyBuYyAqIGpdIC0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgICAgIH0gd2hpbGUgKC0tbnApOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSB3aGlsZSAoLS1uKTsgLy8gR2V0IHRoZSBzb2x1dGlvbgoKCiAgICAgIHRhcmdldC56ID0gZXFuc1syICogbmMgKyAzXSAvIGVxbnNbMiAqIG5jICsgMl07CiAgICAgIHRhcmdldC55ID0gKGVxbnNbMSAqIG5jICsgM10gLSBlcW5zWzEgKiBuYyArIDJdICogdGFyZ2V0LnopIC8gZXFuc1sxICogbmMgKyAxXTsKICAgICAgdGFyZ2V0LnggPSAoZXFuc1swICogbmMgKyAzXSAtIGVxbnNbMCAqIG5jICsgMl0gKiB0YXJnZXQueiAtIGVxbnNbMCAqIG5jICsgMV0gKiB0YXJnZXQueSkgLyBlcW5zWzAgKiBuYyArIDBdOwoKICAgICAgaWYgKGlzTmFOKHRhcmdldC54KSB8fCBpc05hTih0YXJnZXQueSkgfHwgaXNOYU4odGFyZ2V0LnopIHx8IHRhcmdldC54ID09PSBJbmZpbml0eSB8fCB0YXJnZXQueSA9PT0gSW5maW5pdHkgfHwgdGFyZ2V0LnogPT09IEluZmluaXR5KSB7CiAgICAgICAgdGhyb3cgYENvdWxkIG5vdCBzb2x2ZSBlcXVhdGlvbiEgR290IHg9WyR7dGFyZ2V0LnRvU3RyaW5nKCl9XSwgYj1bJHtiLnRvU3RyaW5nKCl9XSwgQT1bJHt0aGlzLnRvU3RyaW5nKCl9XWA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlbGVtZW50IGluIHRoZSBtYXRyaXggYnkgaW5kZXguIEluZGV4IHN0YXJ0cyBhdCAwLCBub3QgMSEhIQogICAgICogQHBhcmFtIHZhbHVlIElmIHByb3ZpZGVkLCB0aGUgbWF0cml4IGVsZW1lbnQgd2lsbCBiZSBzZXQgdG8gdGhpcyB2YWx1ZS4KICAgICAqLwoKCiAgICBlKHJvdywgY29sdW1uLCB2YWx1ZSkgewogICAgICBpZiAodmFsdWUgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnRzW2NvbHVtbiArIDMgKiByb3ddOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFNldCB2YWx1ZQogICAgICAgIHRoaXMuZWxlbWVudHNbY29sdW1uICsgMyAqIHJvd10gPSB2YWx1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGFub3RoZXIgbWF0cml4IGludG8gdGhpcyBtYXRyaXggb2JqZWN0LgogICAgICovCgoKICAgIGNvcHkobWF0cml4KSB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbWF0cml4LmVsZW1lbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGhpcy5lbGVtZW50c1tpXSA9IG1hdHJpeC5lbGVtZW50c1tpXTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgYSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIG1hdHJpeC4KICAgICAqLwoKCiAgICB0b1N0cmluZygpIHsKICAgICAgbGV0IHIgPSAnJzsKICAgICAgY29uc3Qgc2VwID0gJywnOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA5OyBpKyspIHsKICAgICAgICByICs9IHRoaXMuZWxlbWVudHNbaV0gKyBzZXA7CiAgICAgIH0KCiAgICAgIHJldHVybiByOwogICAgfQogICAgLyoqCiAgICAgKiByZXZlcnNlIHRoZSBtYXRyaXgKICAgICAqIEBwYXJhbSB0YXJnZXQgVGFyZ2V0IG1hdHJpeCB0byBzYXZlIGluLgogICAgICogQHJldHVybiBUaGUgc29sdXRpb24geAogICAgICovCgoKICAgIHJldmVyc2UodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBNYXQzKCk7CiAgICAgIH0KCiAgICAgIC8vIENvbnN0cnVjdCBlcXVhdGlvbnMKICAgICAgY29uc3QgbnIgPSAzOyAvLyBudW0gcm93cwoKICAgICAgY29uc3QgbmMgPSA2OyAvLyBudW0gY29scwoKICAgICAgY29uc3QgZXFucyA9IHJldmVyc2VfZXFuczsKICAgICAgbGV0IGk7CiAgICAgIGxldCBqOwoKICAgICAgZm9yIChpID0gMDsgaSA8IDM7IGkrKykgewogICAgICAgIGZvciAoaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIGVxbnNbaSArIG5jICogal0gPSB0aGlzLmVsZW1lbnRzW2kgKyAzICogal07CiAgICAgICAgfQogICAgICB9CgogICAgICBlcW5zWzMgKyA2ICogMF0gPSAxOwogICAgICBlcW5zWzMgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzMgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzQgKyA2ICogMV0gPSAxOwogICAgICBlcW5zWzQgKyA2ICogMl0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMF0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMV0gPSAwOwogICAgICBlcW5zWzUgKyA2ICogMl0gPSAxOyAvLyBDb21wdXRlIHJpZ2h0IHVwcGVyIHRyaWFuZ3VsYXIgdmVyc2lvbiBvZiB0aGUgbWF0cml4IC0gR2F1c3MgZWxpbWluYXRpb24KCiAgICAgIGxldCBuID0gMzsKICAgICAgY29uc3QgayA9IG47CiAgICAgIGxldCBucDsKICAgICAgY29uc3Qga3AgPSBuYzsgLy8gbnVtIHJvd3MKCiAgICAgIGxldCBwOwoKICAgICAgZG8gewogICAgICAgIGkgPSBrIC0gbjsKCiAgICAgICAgaWYgKGVxbnNbaSArIG5jICogaV0gPT09IDApIHsKICAgICAgICAgIC8vIHRoZSBwaXZvdCBpcyBudWxsLCBzd2FwIGxpbmVzCiAgICAgICAgICBmb3IgKGogPSBpICsgMTsgaiA8IGs7IGorKykgewogICAgICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBqXSAhPT0gMCkgewogICAgICAgICAgICAgIG5wID0ga3A7CgogICAgICAgICAgICAgIGRvIHsKICAgICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGkgKSA9IGxpbmUoIGkgKSArIGxpbmUoIGsgKQogICAgICAgICAgICAgICAgcCA9IGtwIC0gbnA7CiAgICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldICs9IGVxbnNbcCArIG5jICogal07CiAgICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CgogICAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoZXFuc1tpICsgbmMgKiBpXSAhPT0gMCkgewogICAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBrOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgICBucCA9IGtwOwoKICAgICAgICAgICAgZG8gewogICAgICAgICAgICAgIC8vIGRvIGxpbmUoIGsgKSA9IGxpbmUoIGsgKSAtIG11bHRpcGxpZXIgKiBsaW5lKCBpICkKICAgICAgICAgICAgICBwID0ga3AgLSBucDsKICAgICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gcCA8PSBpID8gMCA6IGVxbnNbcCArIG5jICogal0gLSBlcW5zW3AgKyBuYyAqIGldICogbXVsdGlwbGllcjsKICAgICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IHdoaWxlICgtLW4pOyAvLyBlbGltaW5hdGUgdGhlIHVwcGVyIGxlZnQgdHJpYW5nbGUgb2YgdGhlIG1hdHJpeAoKCiAgICAgIGkgPSAyOwoKICAgICAgZG8gewogICAgICAgIGogPSBpIC0gMTsKCiAgICAgICAgZG8gewogICAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IGVxbnNbaSArIG5jICogal0gLyBlcW5zW2kgKyBuYyAqIGldOwogICAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgICBkbyB7CiAgICAgICAgICAgIHAgPSBuYyAtIG5wOwogICAgICAgICAgICBlcW5zW3AgKyBuYyAqIGpdID0gZXFuc1twICsgbmMgKiBqXSAtIGVxbnNbcCArIG5jICogaV0gKiBtdWx0aXBsaWVyOwogICAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgICAgfSB3aGlsZSAoai0tKTsKICAgICAgfSB3aGlsZSAoLS1pKTsgLy8gb3BlcmF0aW9ucyBvbiB0aGUgZGlhZ29uYWwKCgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBjb25zdCBtdWx0aXBsaWVyID0gMSAvIGVxbnNbaSArIG5jICogaV07CiAgICAgICAgbnAgPSBuYzsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IG5jIC0gbnA7CiAgICAgICAgICBlcW5zW3AgKyBuYyAqIGldID0gZXFuc1twICsgbmMgKiBpXSAqIG11bHRpcGxpZXI7CiAgICAgICAgfSB3aGlsZSAoLS1ucCk7CiAgICAgIH0gd2hpbGUgKGktLSk7CgogICAgICBpID0gMjsKCiAgICAgIGRvIHsKICAgICAgICBqID0gMjsKCiAgICAgICAgZG8gewogICAgICAgICAgcCA9IGVxbnNbbnIgKyBqICsgbmMgKiBpXTsKCiAgICAgICAgICBpZiAoaXNOYU4ocCkgfHwgcCA9PT0gSW5maW5pdHkpIHsKICAgICAgICAgICAgdGhyb3cgYENvdWxkIG5vdCByZXZlcnNlISBBPVske3RoaXMudG9TdHJpbmcoKX1dYDsKICAgICAgICAgIH0KCiAgICAgICAgICB0YXJnZXQuZShpLCBqLCBwKTsKICAgICAgICB9IHdoaWxlIChqLS0pOwogICAgICB9IHdoaWxlIChpLS0pOwoKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBtYXRyaXggZnJvbSBhIHF1YXRlcmlvbgogICAgICovCgoKICAgIHNldFJvdGF0aW9uRnJvbVF1YXRlcm5pb24ocSkgewogICAgICBjb25zdCB4ID0gcS54OwogICAgICBjb25zdCB5ID0gcS55OwogICAgICBjb25zdCB6ID0gcS56OwogICAgICBjb25zdCB3ID0gcS53OwogICAgICBjb25zdCB4MiA9IHggKyB4OwogICAgICBjb25zdCB5MiA9IHkgKyB5OwogICAgICBjb25zdCB6MiA9IHogKyB6OwogICAgICBjb25zdCB4eCA9IHggKiB4MjsKICAgICAgY29uc3QgeHkgPSB4ICogeTI7CiAgICAgIGNvbnN0IHh6ID0geCAqIHoyOwogICAgICBjb25zdCB5eSA9IHkgKiB5MjsKICAgICAgY29uc3QgeXogPSB5ICogejI7CiAgICAgIGNvbnN0IHp6ID0geiAqIHoyOwogICAgICBjb25zdCB3eCA9IHcgKiB4MjsKICAgICAgY29uc3Qgd3kgPSB3ICogeTI7CiAgICAgIGNvbnN0IHd6ID0gdyAqIHoyOwogICAgICBjb25zdCBlID0gdGhpcy5lbGVtZW50czsKICAgICAgZVszICogMCArIDBdID0gMSAtICh5eSArIHp6KTsKICAgICAgZVszICogMCArIDFdID0geHkgLSB3ejsKICAgICAgZVszICogMCArIDJdID0geHogKyB3eTsKICAgICAgZVszICogMSArIDBdID0geHkgKyB3ejsKICAgICAgZVszICogMSArIDFdID0gMSAtICh4eCArIHp6KTsKICAgICAgZVszICogMSArIDJdID0geXogLSB3eDsKICAgICAgZVszICogMiArIDBdID0geHogLSB3eTsKICAgICAgZVszICogMiArIDFdID0geXogKyB3eDsKICAgICAgZVszICogMiArIDJdID0gMSAtICh4eCArIHl5KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zcG9zZSB0aGUgbWF0cml4CiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsLiBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0LgogICAgICogQHJldHVybiBUaGUgdGFyZ2V0IE1hdDMsIG9yIGEgbmV3IE1hdDMgaWYgdGFyZ2V0IHdhcyBvbWl0dGVkLgogICAgICovCgoKICAgIHRyYW5zcG9zZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IE1hdDMoKTsKICAgICAgfQoKICAgICAgY29uc3QgTSA9IHRoaXMuZWxlbWVudHM7CiAgICAgIGNvbnN0IFQgPSB0YXJnZXQuZWxlbWVudHM7CiAgICAgIGxldCB0bXA7IC8vU2V0IGRpYWdvbmFscwoKICAgICAgVFswXSA9IE1bMF07CiAgICAgIFRbNF0gPSBNWzRdOwogICAgICBUWzhdID0gTVs4XTsKICAgICAgdG1wID0gTVsxXTsKICAgICAgVFsxXSA9IE1bM107CiAgICAgIFRbM10gPSB0bXA7CiAgICAgIHRtcCA9IE1bMl07CiAgICAgIFRbMl0gPSBNWzZdOwogICAgICBUWzZdID0gdG1wOwogICAgICB0bXAgPSBNWzVdOwogICAgICBUWzVdID0gTVs3XTsKICAgICAgVFs3XSA9IHRtcDsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgfQogIGNvbnN0IHJldmVyc2VfZXFucyA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwLCAwXTsKCiAgLyoqCiAgICogMy1kaW1lbnNpb25hbCB2ZWN0b3IKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCB2ID0gbmV3IFZlYzMoMSwgMiwgMykKICAgKiAgICAgY29uc29sZS5sb2coJ3g9JyArIHYueCkgLy8geD0xCiAgICovCgogIGNsYXNzIFZlYzMgewogICAgY29uc3RydWN0b3IoeCwgeSwgeikgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDAuMDsKICAgICAgfQoKICAgICAgaWYgKHkgPT09IHZvaWQgMCkgewogICAgICAgIHkgPSAwLjA7CiAgICAgIH0KCiAgICAgIGlmICh6ID09PSB2b2lkIDApIHsKICAgICAgICB6ID0gMC4wOwogICAgICB9CgogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgY3Jvc3MgcHJvZHVjdAogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbi4KICAgICAqLwoKCiAgICBjcm9zcyh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB2eCA9IHZlY3Rvci54OwogICAgICBjb25zdCB2eSA9IHZlY3Rvci55OwogICAgICBjb25zdCB2eiA9IHZlY3Rvci56OwogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHkgKiB2eiAtIHogKiB2eTsKICAgICAgdGFyZ2V0LnkgPSB6ICogdnggLSB4ICogdno7CiAgICAgIHRhcmdldC56ID0geCAqIHZ5IC0geSAqIHZ4OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHZlY3RvcnMnIDMgZWxlbWVudHMKICAgICAqLwoKCiAgICBzZXQoeCwgeSwgeikgewogICAgICB0aGlzLnggPSB4OwogICAgICB0aGlzLnkgPSB5OwogICAgICB0aGlzLnogPSB6OwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogU2V0IGFsbCBjb21wb25lbnRzIG9mIHRoZSB2ZWN0b3IgdG8gemVyby4KICAgICAqLwoKCiAgICBzZXRaZXJvKCkgewogICAgICB0aGlzLnggPSB0aGlzLnkgPSB0aGlzLnogPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBWZWN0b3IgYWRkaXRpb24KICAgICAqLwoKCiAgICB2YWRkKHZlY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQpIHsKICAgICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICsgdGhpcy54OwogICAgICAgIHRhcmdldC55ID0gdmVjdG9yLnkgKyB0aGlzLnk7CiAgICAgICAgdGFyZ2V0LnogPSB2ZWN0b3IueiArIHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54ICsgdmVjdG9yLngsIHRoaXMueSArIHZlY3Rvci55LCB0aGlzLnogKyB2ZWN0b3Iueik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVmVjdG9yIHN1YnRyYWN0aW9uCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluLgogICAgICovCgoKICAgIHZzdWIodmVjdG9yLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCkgewogICAgICAgIHRhcmdldC54ID0gdGhpcy54IC0gdmVjdG9yLng7CiAgICAgICAgdGFyZ2V0LnkgPSB0aGlzLnkgLSB2ZWN0b3IueTsKICAgICAgICB0YXJnZXQueiA9IHRoaXMueiAtIHZlY3Rvci56OwogICAgICB9IGVsc2UgewogICAgICAgIHJldHVybiBuZXcgVmVjMyh0aGlzLnggLSB2ZWN0b3IueCwgdGhpcy55IC0gdmVjdG9yLnksIHRoaXMueiAtIHZlY3Rvci56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGNyb3NzIHByb2R1Y3QgbWF0cml4IGFfY3Jvc3MgZnJvbSBhIHZlY3Rvciwgc3VjaCB0aGF0IGEgeCBiID0gYV9jcm9zcyAqIGIgPSBjCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dzguY3MudW11LnNlL2t1cnNlci9UREJEMjQvVlQwNi9sZWN0dXJlcy9MZWN0dXJlNi5wZGYgVW1lw6UgVW5pdmVyc2l0eSBMZWN0dXJlfQogICAgICovCgoKICAgIGNyb3NzbWF0KCkgewogICAgICByZXR1cm4gbmV3IE1hdDMoWzAsIC10aGlzLnosIHRoaXMueSwgdGhpcy56LCAwLCAtdGhpcy54LCAtdGhpcy55LCB0aGlzLngsIDBdKTsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSB2ZWN0b3IuIE5vdGUgdGhhdCB0aGlzIGNoYW5nZXMgdGhlIHZhbHVlcyBpbiB0aGUgdmVjdG9yLgogICAgICAqIEByZXR1cm4gUmV0dXJucyB0aGUgbm9ybSBvZiB0aGUgdmVjdG9yCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBuID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkgKyB6ICogeik7CgogICAgICBpZiAobiA+IDAuMCkgewogICAgICAgIGNvbnN0IGludk4gPSAxIC8gbjsKICAgICAgICB0aGlzLnggKj0gaW52TjsKICAgICAgICB0aGlzLnkgKj0gaW52TjsKICAgICAgICB0aGlzLnogKj0gaW52TjsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBNYWtlIHNvbWV0aGluZyB1cAogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICB9CgogICAgICByZXR1cm4gbjsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB2ZXJzaW9uIG9mIHRoaXMgdmVjdG9yIHRoYXQgaXMgb2YgbGVuZ3RoIDEuCiAgICAgKiBAcGFyYW0gdGFyZ2V0IE9wdGlvbmFsIHRhcmdldCB0byBzYXZlIGluCiAgICAgKiBAcmV0dXJuIFJldHVybnMgdGhlIHVuaXQgdmVjdG9yCiAgICAgKi8KCgogICAgdW5pdCh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgbGV0IG5pbnYgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKCiAgICAgIGlmIChuaW52ID4gMC4wKSB7CiAgICAgICAgbmludiA9IDEuMCAvIG5pbnY7CiAgICAgICAgdGFyZ2V0LnggPSB4ICogbmludjsKICAgICAgICB0YXJnZXQueSA9IHkgKiBuaW52OwogICAgICAgIHRhcmdldC56ID0geiAqIG5pbnY7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGFyZ2V0LnggPSAxOwogICAgICAgIHRhcmdldC55ID0gMDsKICAgICAgICB0YXJnZXQueiA9IDA7CiAgICAgIH0KCiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgbGVuZ3RoIG9mIHRoZSB2ZWN0b3IKICAgICAqLwoKCiAgICBsZW5ndGgoKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSArIHogKiB6KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBzcXVhcmVkIGxlbmd0aCBvZiB0aGUgdmVjdG9yLgogICAgICovCgoKICAgIGxlbmd0aFNxdWFyZWQoKSB7CiAgICAgIHJldHVybiB0aGlzLmRvdCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGRpc3RhbmNlIGZyb20gdGhpcyBwb2ludCB0byBhbm90aGVyIHBvaW50CiAgICAgKi8KCgogICAgZGlzdGFuY2VUbyhwKSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIGNvbnN0IHB4ID0gcC54OwogICAgICBjb25zdCBweSA9IHAueTsKICAgICAgY29uc3QgcHogPSBwLno7CiAgICAgIHJldHVybiBNYXRoLnNxcnQoKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHNxdWFyZWQgZGlzdGFuY2UgZnJvbSB0aGlzIHBvaW50IHRvIGFub3RoZXIgcG9pbnQKICAgICAqLwoKCiAgICBkaXN0YW5jZVNxdWFyZWQocCkgewogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCBweCA9IHAueDsKICAgICAgY29uc3QgcHkgPSBwLnk7CiAgICAgIGNvbnN0IHB6ID0gcC56OwogICAgICByZXR1cm4gKHB4IC0geCkgKiAocHggLSB4KSArIChweSAtIHkpICogKHB5IC0geSkgKyAocHogLSB6KSAqIChweiAtIHopOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSBhbGwgdGhlIGNvbXBvbmVudHMgb2YgdGhlIHZlY3RvciB3aXRoIGEgc2NhbGFyLgogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBzY2FsZShzY2FsYXIsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICB0YXJnZXQueCA9IHNjYWxhciAqIHg7CiAgICAgIHRhcmdldC55ID0gc2NhbGFyICogeTsKICAgICAgdGFyZ2V0LnogPSBzY2FsYXIgKiB6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgdmVjdG9yIHdpdGggYW4gb3RoZXIgdmVjdG9yLCBjb21wb25lbnQtd2lzZS4KICAgICAqIEBwYXJhbSB0YXJnZXQgVGhlIHZlY3RvciB0byBzYXZlIHRoZSByZXN1bHQgaW4uCiAgICAgKi8KCgogICAgdm11bCh2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHZlY3Rvci54ICogdGhpcy54OwogICAgICB0YXJnZXQueSA9IHZlY3Rvci55ICogdGhpcy55OwogICAgICB0YXJnZXQueiA9IHZlY3Rvci56ICogdGhpcy56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBTY2FsZSBhIHZlY3RvciBhbmQgYWRkIGl0IHRvIHRoaXMgdmVjdG9yLiBTYXZlIHRoZSByZXN1bHQgaW4gInRhcmdldCIuICh0YXJnZXQgPSB0aGlzICsgdmVjdG9yICogc2NhbGFyKQogICAgICogQHBhcmFtIHRhcmdldCBUaGUgdmVjdG9yIHRvIHNhdmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBhZGRTY2FsZWRWZWN0b3Ioc2NhbGFyLCB2ZWN0b3IsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IHRoaXMueCArIHNjYWxhciAqIHZlY3Rvci54OwogICAgICB0YXJnZXQueSA9IHRoaXMueSArIHNjYWxhciAqIHZlY3Rvci55OwogICAgICB0YXJnZXQueiA9IHRoaXMueiArIHNjYWxhciAqIHZlY3Rvci56OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBDYWxjdWxhdGUgZG90IHByb2R1Y3QKICAgICAqIEBwYXJhbSB2ZWN0b3IKICAgICAqLwoKCiAgICBkb3QodmVjdG9yKSB7CiAgICAgIHJldHVybiB0aGlzLnggKiB2ZWN0b3IueCArIHRoaXMueSAqIHZlY3Rvci55ICsgdGhpcy56ICogdmVjdG9yLno7CiAgICB9CgogICAgaXNaZXJvKCkgewogICAgICByZXR1cm4gdGhpcy54ID09PSAwICYmIHRoaXMueSA9PT0gMCAmJiB0aGlzLnogPT09IDA7CiAgICB9CiAgICAvKioKICAgICAqIE1ha2UgdGhlIHZlY3RvciBwb2ludCBpbiB0aGUgb3Bwb3NpdGUgZGlyZWN0aW9uLgogICAgICogQHBhcmFtIHRhcmdldCBPcHRpb25hbCB0YXJnZXQgdG8gc2F2ZSBpbgogICAgICovCgoKICAgIG5lZ2F0ZSh0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnggPSAtdGhpcy54OwogICAgICB0YXJnZXQueSA9IC10aGlzLnk7CiAgICAgIHRhcmdldC56ID0gLXRoaXMuejsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0d28gYXJ0aWZpY2lhbCB0YW5nZW50cyB0byB0aGUgdmVjdG9yCiAgICAgKiBAcGFyYW0gdDEgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBmaXJzdCB0YW5nZW50IGluCiAgICAgKiBAcGFyYW0gdDIgVmVjdG9yIG9iamVjdCB0byBzYXZlIHRoZSBzZWNvbmQgdGFuZ2VudCBpbgogICAgICovCgoKICAgIHRhbmdlbnRzKHQxLCB0MikgewogICAgICBjb25zdCBub3JtID0gdGhpcy5sZW5ndGgoKTsKCiAgICAgIGlmIChub3JtID4gMC4wKSB7CiAgICAgICAgY29uc3QgbiA9IFZlYzNfdGFuZ2VudHNfbjsKICAgICAgICBjb25zdCBpbm9ybSA9IDEgLyBub3JtOwogICAgICAgIG4uc2V0KHRoaXMueCAqIGlub3JtLCB0aGlzLnkgKiBpbm9ybSwgdGhpcy56ICogaW5vcm0pOwogICAgICAgIGNvbnN0IHJhbmRWZWMgPSBWZWMzX3RhbmdlbnRzX3JhbmRWZWM7CgogICAgICAgIGlmIChNYXRoLmFicyhuLngpIDwgMC45KSB7CiAgICAgICAgICByYW5kVmVjLnNldCgxLCAwLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICByYW5kVmVjLnNldCgwLCAxLCAwKTsKICAgICAgICAgIG4uY3Jvc3MocmFuZFZlYywgdDEpOwogICAgICAgIH0KCiAgICAgICAgbi5jcm9zcyh0MSwgdDIpOwogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRoZSBub3JtYWwgbGVuZ3RoIGlzIHplcm8sIG1ha2Ugc29tZXRoaW5nIHVwCiAgICAgICAgdDEuc2V0KDEsIDAsIDApOwogICAgICAgIHQyLnNldCgwLCAxLCAwKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhIG1vcmUgcmVhZGFibGUgZm9ybWF0CiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen1gOwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0cyB0byBhbiBhcnJheQogICAgICovCgoKICAgIHRvQXJyYXkoKSB7CiAgICAgIHJldHVybiBbdGhpcy54LCB0aGlzLnksIHRoaXMuel07CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyB2ZWN0b3IuCiAgICAgKi8KCgogICAgY29weSh2ZWN0b3IpIHsKICAgICAgdGhpcy54ID0gdmVjdG9yLng7CiAgICAgIHRoaXMueSA9IHZlY3Rvci55OwogICAgICB0aGlzLnogPSB2ZWN0b3IuejsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIERvIGEgbGluZWFyIGludGVycG9sYXRpb24gYmV0d2VlbiB0d28gdmVjdG9ycwogICAgICogQHBhcmFtIHQgQSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxLiAwIHdpbGwgbWFrZSB0aGlzIGZ1bmN0aW9uIHJldHVybiB1LCBhbmQgMSB3aWxsIG1ha2UgaXQgcmV0dXJuIHYuIE51bWJlcnMgaW4gYmV0d2VlbiB3aWxsIGdlbmVyYXRlIGEgdmVjdG9yIGluIGJldHdlZW4gdGhlbS4KICAgICAqLwoKCiAgICBsZXJwKHZlY3RvciwgdCwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IHggPSB0aGlzLng7CiAgICAgIGNvbnN0IHkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHogPSB0aGlzLno7CiAgICAgIHRhcmdldC54ID0geCArICh2ZWN0b3IueCAtIHgpICogdDsKICAgICAgdGFyZ2V0LnkgPSB5ICsgKHZlY3Rvci55IC0geSkgKiB0OwogICAgICB0YXJnZXQueiA9IHogKyAodmVjdG9yLnogLSB6KSAqIHQ7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGVxdWFscyBpcyBhbG1vc3QgZXF1YWwgdG8gYW5vdGhlciBvbmUuCiAgICAgKi8KCgogICAgYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIGlmIChwcmVjaXNpb24gPT09IHZvaWQgMCkgewogICAgICAgIHByZWNpc2lvbiA9IDFlLTY7CiAgICAgIH0KCiAgICAgIGlmIChNYXRoLmFicyh0aGlzLnggLSB2ZWN0b3IueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55IC0gdmVjdG9yLnkpID4gcHJlY2lzaW9uIHx8IE1hdGguYWJzKHRoaXMueiAtIHZlY3Rvci56KSA+IHByZWNpc2lvbikgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGEgdmVjdG9yIGlzIGFsbW9zdCB6ZXJvCiAgICAgKi8KCgogICAgYWxtb3N0WmVybyhwcmVjaXNpb24pIHsKICAgICAgaWYgKHByZWNpc2lvbiA9PT0gdm9pZCAwKSB7CiAgICAgICAgcHJlY2lzaW9uID0gMWUtNjsKICAgICAgfQoKICAgICAgaWYgKE1hdGguYWJzKHRoaXMueCkgPiBwcmVjaXNpb24gfHwgTWF0aC5hYnModGhpcy55KSA+IHByZWNpc2lvbiB8fCBNYXRoLmFicyh0aGlzLnopID4gcHJlY2lzaW9uKSB7CiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIHZlY3RvciBpcyBhbnRpLXBhcmFsbGVsIHRvIGFub3RoZXIgdmVjdG9yLgogICAgICogQHBhcmFtIHByZWNpc2lvbiBTZXQgdG8gemVybyBmb3IgZXhhY3QgY29tcGFyaXNvbnMKICAgICAqLwoKCiAgICBpc0FudGlwYXJhbGxlbFRvKHZlY3RvciwgcHJlY2lzaW9uKSB7CiAgICAgIHRoaXMubmVnYXRlKGFudGlwX25lZyk7CiAgICAgIHJldHVybiBhbnRpcF9uZWcuYWxtb3N0RXF1YWxzKHZlY3RvciwgcHJlY2lzaW9uKTsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgdGhlIHZlY3RvcgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IFZlYzModGhpcy54LCB0aGlzLnksIHRoaXMueik7CiAgICB9CgogIH0KICBWZWMzLlpFUk8gPSBuZXcgVmVjMygwLCAwLCAwKTsKICBWZWMzLlVOSVRfWCA9IG5ldyBWZWMzKDEsIDAsIDApOwogIFZlYzMuVU5JVF9ZID0gbmV3IFZlYzMoMCwgMSwgMCk7CiAgVmVjMy5VTklUX1ogPSBuZXcgVmVjMygwLCAwLCAxKTsKICBjb25zdCBWZWMzX3RhbmdlbnRzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IFZlYzNfdGFuZ2VudHNfcmFuZFZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYW50aXBfbmVnID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQXhpcyBhbGlnbmVkIGJvdW5kaW5nIGJveCBjbGFzcy4KICAgKi8KICBjbGFzcyBBQUJCIHsKICAgIC8qKgogICAgICogVGhlIGxvd2VyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHVwcGVyIGJvdW5kIG9mIHRoZSBib3VuZGluZyBib3gKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLmxvd2VyQm91bmQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnVwcGVyQm91bmQgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG93ZXJCb3VuZCkgewogICAgICAgIHRoaXMubG93ZXJCb3VuZC5jb3B5KG9wdGlvbnMubG93ZXJCb3VuZCk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnVwcGVyQm91bmQpIHsKICAgICAgICB0aGlzLnVwcGVyQm91bmQuY29weShvcHRpb25zLnVwcGVyQm91bmQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgQUFCQiBib3VuZHMgZnJvbSBhIHNldCBvZiBwb2ludHMuCiAgICAgKiBAcGFyYW0gcG9pbnRzIEFuIGFycmF5IG9mIFZlYzMncy4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0CiAgICAgKi8KCgogICAgc2V0RnJvbVBvaW50cyhwb2ludHMsIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBza2luU2l6ZSkgewogICAgICBjb25zdCBsID0gdGhpcy5sb3dlckJvdW5kOwogICAgICBjb25zdCB1ID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBxID0gcXVhdGVybmlvbjsgLy8gU2V0IHRvIHRoZSBmaXJzdCBwb2ludAoKICAgICAgbC5jb3B5KHBvaW50c1swXSk7CgogICAgICBpZiAocSkgewogICAgICAgIHEudm11bHQobCwgbCk7CiAgICAgIH0KCiAgICAgIHUuY29weShsKTsKCiAgICAgIGZvciAobGV0IGkgPSAxOyBpIDwgcG9pbnRzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgbGV0IHAgPSBwb2ludHNbaV07CgogICAgICAgIGlmIChxKSB7CiAgICAgICAgICBxLnZtdWx0KHAsIHRtcCQxKTsKICAgICAgICAgIHAgPSB0bXAkMTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPiB1LngpIHsKICAgICAgICAgIHUueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnggPCBsLngpIHsKICAgICAgICAgIGwueCA9IHAueDsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnkgPCBsLnkpIHsKICAgICAgICAgIGwueSA9IHAueTsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPiB1LnopIHsKICAgICAgICAgIHUueiA9IHAuejsKICAgICAgICB9CgogICAgICAgIGlmIChwLnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHAuejsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIG9mZnNldAoKCiAgICAgIGlmIChwb3NpdGlvbikgewogICAgICAgIHBvc2l0aW9uLnZhZGQobCwgbCk7CiAgICAgICAgcG9zaXRpb24udmFkZCh1LCB1KTsKICAgICAgfQoKICAgICAgaWYgKHNraW5TaXplKSB7CiAgICAgICAgbC54IC09IHNraW5TaXplOwogICAgICAgIGwueSAtPSBza2luU2l6ZTsKICAgICAgICBsLnogLT0gc2tpblNpemU7CiAgICAgICAgdS54ICs9IHNraW5TaXplOwogICAgICAgIHUueSArPSBza2luU2l6ZTsKICAgICAgICB1LnogKz0gc2tpblNpemU7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBDb3B5IGJvdW5kcyBmcm9tIGFuIEFBQkIgdG8gdGhpcyBBQUJCCiAgICAgKiBAcGFyYW0gYWFiYiBTb3VyY2UgdG8gY29weSBmcm9tCiAgICAgKiBAcmV0dXJuIFRoZSB0aGlzIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eQogICAgICovCgoKICAgIGNvcHkoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQuY29weShhYWJiLmxvd2VyQm91bmQpOwogICAgICB0aGlzLnVwcGVyQm91bmQuY29weShhYWJiLnVwcGVyQm91bmQpOwogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogQ2xvbmUgYW4gQUFCQgogICAgICovCgoKICAgIGNsb25lKCkgewogICAgICByZXR1cm4gbmV3IEFBQkIoKS5jb3B5KHRoaXMpOwogICAgfQogICAgLyoqCiAgICAgKiBFeHRlbmQgdGhpcyBBQUJCIHNvIHRoYXQgaXQgY292ZXJzIHRoZSBnaXZlbiBBQUJCIHRvby4KICAgICAqLwoKCiAgICBleHRlbmQoYWFiYikgewogICAgICB0aGlzLmxvd2VyQm91bmQueCA9IE1hdGgubWluKHRoaXMubG93ZXJCb3VuZC54LCBhYWJiLmxvd2VyQm91bmQueCk7CiAgICAgIHRoaXMudXBwZXJCb3VuZC54ID0gTWF0aC5tYXgodGhpcy51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC54KTsKICAgICAgdGhpcy5sb3dlckJvdW5kLnkgPSBNYXRoLm1pbih0aGlzLmxvd2VyQm91bmQueSwgYWFiYi5sb3dlckJvdW5kLnkpOwogICAgICB0aGlzLnVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRoaXMudXBwZXJCb3VuZC55LCBhYWJiLnVwcGVyQm91bmQueSk7CiAgICAgIHRoaXMubG93ZXJCb3VuZC56ID0gTWF0aC5taW4odGhpcy5sb3dlckJvdW5kLnosIGFhYmIubG93ZXJCb3VuZC56KTsKICAgICAgdGhpcy51cHBlckJvdW5kLnogPSBNYXRoLm1heCh0aGlzLnVwcGVyQm91bmQueiwgYWFiYi51cHBlckJvdW5kLnopOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRydWUgaWYgdGhlIGdpdmVuIEFBQkIgb3ZlcmxhcHMgdGhpcyBBQUJCLgogICAgICovCgoKICAgIG92ZXJsYXBzKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tfAogICAgICAvLyBsMSAgICAgICB1MQoKICAgICAgY29uc3Qgb3ZlcmxhcHNYID0gbDIueCA8PSB1MS54ICYmIHUxLnggPD0gdTIueCB8fCBsMS54IDw9IHUyLnggJiYgdTIueCA8PSB1MS54OwogICAgICBjb25zdCBvdmVybGFwc1kgPSBsMi55IDw9IHUxLnkgJiYgdTEueSA8PSB1Mi55IHx8IGwxLnkgPD0gdTIueSAmJiB1Mi55IDw9IHUxLnk7CiAgICAgIGNvbnN0IG92ZXJsYXBzWiA9IGwyLnogPD0gdTEueiAmJiB1MS56IDw9IHUyLnogfHwgbDEueiA8PSB1Mi56ICYmIHUyLnogPD0gdTEuejsKICAgICAgcmV0dXJuIG92ZXJsYXBzWCAmJiBvdmVybGFwc1kgJiYgb3ZlcmxhcHNaOwogICAgfSAvLyBNb3N0bHkgZm9yIGRlYnVnZ2luZwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIHJldHVybiAodS54IC0gbC54KSAqICh1LnkgLSBsLnkpICogKHUueiAtIGwueik7CiAgICB9CiAgICAvKioKICAgICAqIFJldHVybnMgdHJ1ZSBpZiB0aGUgZ2l2ZW4gQUFCQiBpcyBmdWxseSBjb250YWluZWQgaW4gdGhpcyBBQUJCLgogICAgICovCgoKICAgIGNvbnRhaW5zKGFhYmIpIHsKICAgICAgY29uc3QgbDEgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUxID0gdGhpcy51cHBlckJvdW5kOwogICAgICBjb25zdCBsMiA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdTIgPSBhYWJiLnVwcGVyQm91bmQ7IC8vICAgICAgbDIgICAgICAgIHUyCiAgICAgIC8vICAgICAgfC0tLS0tLS0tLXwKICAgICAgLy8gfC0tLS0tLS0tLS0tLS0tLXwKICAgICAgLy8gbDEgICAgICAgICAgICAgIHUxCgogICAgICByZXR1cm4gbDEueCA8PSBsMi54ICYmIHUxLnggPj0gdTIueCAmJiBsMS55IDw9IGwyLnkgJiYgdTEueSA+PSB1Mi55ICYmIGwxLnogPD0gbDIueiAmJiB1MS56ID49IHUyLno7CiAgICB9CgogICAgZ2V0Q29ybmVycyhhLCBiLCBjLCBkLCBlLCBmLCBnLCBoKSB7CiAgICAgIGNvbnN0IGwgPSB0aGlzLmxvd2VyQm91bmQ7CiAgICAgIGNvbnN0IHUgPSB0aGlzLnVwcGVyQm91bmQ7CiAgICAgIGEuY29weShsKTsKICAgICAgYi5zZXQodS54LCBsLnksIGwueik7CiAgICAgIGMuc2V0KHUueCwgdS55LCBsLnopOwogICAgICBkLnNldChsLngsIHUueSwgdS56KTsKICAgICAgZS5zZXQodS54LCBsLnksIHUueik7CiAgICAgIGYuc2V0KGwueCwgdS55LCBsLnopOwogICAgICBnLnNldChsLngsIGwueSwgdS56KTsKICAgICAgaC5jb3B5KHUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gYW5vdGhlciBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvTG9jYWxGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb0xvY2FsKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHJlcHJlc2VudGF0aW9uIG9mIGFuIEFBQkIgaW4gdGhlIGdsb2JhbCBmcmFtZS4KICAgICAqIEByZXR1cm4gVGhlICJ0YXJnZXQiIEFBQkIgb2JqZWN0LgogICAgICovCgoKICAgIHRvV29ybGRGcmFtZShmcmFtZSwgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNvcm5lcnMgPSB0cmFuc2Zvcm1JbnRvRnJhbWVfY29ybmVyczsKICAgICAgY29uc3QgYSA9IGNvcm5lcnNbMF07CiAgICAgIGNvbnN0IGIgPSBjb3JuZXJzWzFdOwogICAgICBjb25zdCBjID0gY29ybmVyc1syXTsKICAgICAgY29uc3QgZCA9IGNvcm5lcnNbM107CiAgICAgIGNvbnN0IGUgPSBjb3JuZXJzWzRdOwogICAgICBjb25zdCBmID0gY29ybmVyc1s1XTsKICAgICAgY29uc3QgZyA9IGNvcm5lcnNbNl07CiAgICAgIGNvbnN0IGggPSBjb3JuZXJzWzddOyAvLyBHZXQgY29ybmVycyBpbiBjdXJyZW50IGZyYW1lCgogICAgICB0aGlzLmdldENvcm5lcnMoYSwgYiwgYywgZCwgZSwgZiwgZywgaCk7IC8vIFRyYW5zZm9ybSB0aGVtIHRvIG5ldyBsb2NhbCBmcmFtZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgIGNvbnN0IGNvcm5lciA9IGNvcm5lcnNbaV07CiAgICAgICAgZnJhbWUucG9pbnRUb1dvcmxkKGNvcm5lciwgY29ybmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRhcmdldC5zZXRGcm9tUG9pbnRzKGNvcm5lcnMpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgQUFCQiBpcyBoaXQgYnkgYSByYXkuCiAgICAgKi8KCgogICAgb3ZlcmxhcHNSYXkocmF5KSB7CiAgICAgIGNvbnN0IHsKICAgICAgICBkaXJlY3Rpb24sCiAgICAgICAgZnJvbQogICAgICB9ID0gcmF5OyAvLyBjb25zdCB0ID0gMAogICAgICAvLyByYXkuZGlyZWN0aW9uIGlzIHVuaXQgZGlyZWN0aW9uIHZlY3RvciBvZiByYXkKCiAgICAgIGNvbnN0IGRpckZyYWNYID0gMSAvIGRpcmVjdGlvbi54OwogICAgICBjb25zdCBkaXJGcmFjWSA9IDEgLyBkaXJlY3Rpb24ueTsKICAgICAgY29uc3QgZGlyRnJhY1ogPSAxIC8gZGlyZWN0aW9uLno7IC8vIHRoaXMubG93ZXJCb3VuZCBpcyB0aGUgY29ybmVyIG9mIEFBQkIgd2l0aCBtaW5pbWFsIGNvb3JkaW5hdGVzIC0gbGVmdCBib3R0b20sIHJ0IGlzIG1heGltYWwgY29ybmVyCgogICAgICBjb25zdCB0MSA9ICh0aGlzLmxvd2VyQm91bmQueCAtIGZyb20ueCkgKiBkaXJGcmFjWDsKICAgICAgY29uc3QgdDIgPSAodGhpcy51cHBlckJvdW5kLnggLSBmcm9tLngpICogZGlyRnJhY1g7CiAgICAgIGNvbnN0IHQzID0gKHRoaXMubG93ZXJCb3VuZC55IC0gZnJvbS55KSAqIGRpckZyYWNZOwogICAgICBjb25zdCB0NCA9ICh0aGlzLnVwcGVyQm91bmQueSAtIGZyb20ueSkgKiBkaXJGcmFjWTsKICAgICAgY29uc3QgdDUgPSAodGhpcy5sb3dlckJvdW5kLnogLSBmcm9tLnopICogZGlyRnJhY1o7CiAgICAgIGNvbnN0IHQ2ID0gKHRoaXMudXBwZXJCb3VuZC56IC0gZnJvbS56KSAqIGRpckZyYWNaOyAvLyBjb25zdCB0bWluID0gTWF0aC5tYXgoTWF0aC5tYXgoTWF0aC5taW4odDEsIHQyKSwgTWF0aC5taW4odDMsIHQ0KSkpOwogICAgICAvLyBjb25zdCB0bWF4ID0gTWF0aC5taW4oTWF0aC5taW4oTWF0aC5tYXgodDEsIHQyKSwgTWF0aC5tYXgodDMsIHQ0KSkpOwoKICAgICAgY29uc3QgdG1pbiA9IE1hdGgubWF4KE1hdGgubWF4KE1hdGgubWluKHQxLCB0MiksIE1hdGgubWluKHQzLCB0NCkpLCBNYXRoLm1pbih0NSwgdDYpKTsKICAgICAgY29uc3QgdG1heCA9IE1hdGgubWluKE1hdGgubWluKE1hdGgubWF4KHQxLCB0MiksIE1hdGgubWF4KHQzLCB0NCkpLCBNYXRoLm1heCh0NSwgdDYpKTsgLy8gaWYgdG1heCA8IDAsIHJheSAobGluZSkgaXMgaW50ZXJzZWN0aW5nIEFBQkIsIGJ1dCB3aG9sZSBBQUJCIGlzIGJlaGluZyB1cwoKICAgICAgaWYgKHRtYXggPCAwKSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gaWYgdG1pbiA+IHRtYXgsIHJheSBkb2Vzbid0IGludGVyc2VjdCBBQUJCCgoKICAgICAgaWYgKHRtaW4gPiB0bWF4KSB7CiAgICAgICAgLy90ID0gdG1heDsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICB9CiAgY29uc3QgdG1wJDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRyYW5zZm9ybUludG9GcmFtZV9jb3JuZXJzID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBDb2xsaXNpb24gIm1hdHJpeCIuCiAgICogSXQncyBhY3R1YWxseSBhIHRyaWFuZ3VsYXItc2hhcGVkIGFycmF5IG9mIHdoZXRoZXIgdHdvIGJvZGllcyBhcmUgdG91Y2hpbmcgdGhpcyBzdGVwLCBmb3IgcmVmZXJlbmNlIG5leHQgc3RlcAogICAqLwogIGNsYXNzIEFycmF5Q29sbGlzaW9uTWF0cml4IHsKICAgIC8qKgogICAgICogVGhlIG1hdHJpeCBzdG9yYWdlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5tYXRyaXggPSBbXTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIGVsZW1lbnQKICAgICAqLwoKCiAgICBnZXQoYmksIGJqKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gdGhpcy5tYXRyaXhbKGkgKiAoaSArIDEpID4+IDEpICsgaiAtIDFdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgYW4gZWxlbWVudAogICAgICovCgoKICAgIHNldChiaSwgYmosIHZhbHVlKSB7CiAgICAgIGxldCB7CiAgICAgICAgaW5kZXg6IGkKICAgICAgfSA9IGJpOwogICAgICBsZXQgewogICAgICAgIGluZGV4OiBqCiAgICAgIH0gPSBiajsKCiAgICAgIGlmIChqID4gaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICB0aGlzLm1hdHJpeFsoaSAqIChpICsgMSkgPj4gMSkgKyBqIC0gMV0gPSB2YWx1ZSA/IDEgOiAwOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBlbGVtZW50cyB0byB6ZXJvCiAgICAgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGZvciAobGV0IGkgPSAwLCBsID0gdGhpcy5tYXRyaXgubGVuZ3RoOyBpICE9PSBsOyBpKyspIHsKICAgICAgICB0aGlzLm1hdHJpeFtpXSA9IDA7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogU2V0cyB0aGUgbWF4IG51bWJlciBvZiBvYmplY3RzCiAgICAgKi8KCgogICAgc2V0TnVtT2JqZWN0cyhuKSB7CiAgICAgIHRoaXMubWF0cml4Lmxlbmd0aCA9IG4gKiAobiAtIDEpID4+IDE7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQmFzZSBjbGFzcyBmb3Igb2JqZWN0cyB0aGF0IGRpc3BhdGNoZXMgZXZlbnRzLgogICAqLwogIGNsYXNzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQWRkIGFuIGV2ZW50IGxpc3RlbmVyCiAgICAgKiBAcmV0dXJuIFRoZSBzZWxmIG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwogICAgYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICB0aGlzLl9saXN0ZW5lcnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgbGlzdGVuZXJzW3R5cGVdID0gW107CiAgICAgIH0KCiAgICAgIGlmICghbGlzdGVuZXJzW3R5cGVdLmluY2x1ZGVzKGxpc3RlbmVyKSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5wdXNoKGxpc3RlbmVyKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENoZWNrIGlmIGFuIGV2ZW50IGxpc3RlbmVyIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCiAgICAgIGlmIChsaXN0ZW5lcnNbdHlwZV0gIT09IHVuZGVmaW5lZCAmJiBsaXN0ZW5lcnNbdHlwZV0uaW5jbHVkZXMobGlzdGVuZXIpKSB7CiAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgIH0KCiAgICAgIHJldHVybiBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgYW55IGV2ZW50IGxpc3RlbmVyIG9mIHRoZSBnaXZlbiB0eXBlIGlzIGFkZGVkCiAgICAgKi8KCgogICAgaGFzQW55RXZlbnRMaXN0ZW5lcih0eXBlKSB7CiAgICAgIGlmICh0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwogICAgICByZXR1cm4gbGlzdGVuZXJzW3R5cGVdICE9PSB1bmRlZmluZWQ7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhbiBldmVudCBsaXN0ZW5lcgogICAgICogQHJldHVybiBUaGUgc2VsZiBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgcmVtb3ZlRXZlbnRMaXN0ZW5lcih0eXBlLCBsaXN0ZW5lcikgewogICAgICBpZiAodGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQpIHsKICAgICAgICByZXR1cm4gdGhpczsKICAgICAgfQoKICAgICAgY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoKICAgICAgaWYgKGxpc3RlbmVyc1t0eXBlXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZGV4ID0gbGlzdGVuZXJzW3R5cGVdLmluZGV4T2YobGlzdGVuZXIpOwoKICAgICAgaWYgKGluZGV4ICE9PSAtMSkgewogICAgICAgIGxpc3RlbmVyc1t0eXBlXS5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogRW1pdCBhbiBldmVudC4KICAgICAqIEByZXR1cm4gVGhlIHNlbGYgb2JqZWN0LCBmb3IgY2hhaW5hYmlsaXR5LgogICAgICovCgoKICAgIGRpc3BhdGNoRXZlbnQoZXZlbnQpIHsKICAgICAgaWYgKHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIGNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKICAgICAgY29uc3QgbGlzdGVuZXJBcnJheSA9IGxpc3RlbmVyc1tldmVudC50eXBlXTsKCiAgICAgIGlmIChsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQpIHsKICAgICAgICBldmVudC50YXJnZXQgPSB0aGlzOwoKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGxpc3RlbmVyQXJyYXkubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgICBsaXN0ZW5lckFycmF5W2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBRdWF0ZXJuaW9uIGRlc2NyaWJlcyBhIHJvdGF0aW9uIGluIDNEIHNwYWNlLiBUaGUgUXVhdGVybmlvbiBpcyBtYXRoZW1hdGljYWxseSBkZWZpbmVkIGFzIFEgPSB4KmkgKyB5KmogKyB6KmsgKyB3LCB3aGVyZSAoaSxqLGspIGFyZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9ycy4gKHgseSx6KSBjYW4gYmUgc2VlbiBhcyBhIHZlY3RvciByZWxhdGVkIHRvIHRoZSBheGlzIG9mIHJvdGF0aW9uLCB3aGlsZSB0aGUgcmVhbCBtdWx0aXBsaWVyLCB3LCBpcyByZWxhdGVkIHRvIHRoZSBhbW91bnQgb2Ygcm90YXRpb24uCiAgICogQHBhcmFtIHggTXVsdGlwbGllciBvZiB0aGUgaW1hZ2luYXJ5IGJhc2lzIHZlY3RvciBpLgogICAqIEBwYXJhbSB5IE11bHRpcGxpZXIgb2YgdGhlIGltYWdpbmFyeSBiYXNpcyB2ZWN0b3Igai4KICAgKiBAcGFyYW0geiBNdWx0aXBsaWVyIG9mIHRoZSBpbWFnaW5hcnkgYmFzaXMgdmVjdG9yIGsuCiAgICogQHBhcmFtIHcgTXVsdGlwbGllciBvZiB0aGUgcmVhbCBwYXJ0LgogICAqIEBzZWUgaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9RdWF0ZXJuaW9uCiAgICovCgogIGNsYXNzIFF1YXRlcm5pb24gewogICAgY29uc3RydWN0b3IoeCwgeSwgeiwgdykgewogICAgICBpZiAoeCA9PT0gdm9pZCAwKSB7CiAgICAgICAgeCA9IDA7CiAgICAgIH0KCiAgICAgIGlmICh5ID09PSB2b2lkIDApIHsKICAgICAgICB5ID0gMDsKICAgICAgfQoKICAgICAgaWYgKHogPT09IHZvaWQgMCkgewogICAgICAgIHogPSAwOwogICAgICB9CgogICAgICBpZiAodyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdyA9IDE7CiAgICAgIH0KCiAgICAgIHRoaXMueCA9IHg7CiAgICAgIHRoaXMueSA9IHk7CiAgICAgIHRoaXMueiA9IHo7CiAgICAgIHRoaXMudyA9IHc7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgdmFsdWUgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgc2V0KHgsIHksIHosIHcpIHsKICAgICAgdGhpcy54ID0geDsKICAgICAgdGhpcy55ID0geTsKICAgICAgdGhpcy56ID0gejsKICAgICAgdGhpcy53ID0gdzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdG8gYSByZWFkYWJsZSBmb3JtYXQKICAgICAqIEByZXR1cm4gIngseSx6LHciCiAgICAgKi8KCgogICAgdG9TdHJpbmcoKSB7CiAgICAgIHJldHVybiBgJHt0aGlzLnh9LCR7dGhpcy55fSwke3RoaXMuen0sJHt0aGlzLnd9YDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCB0byBhbiBBcnJheQogICAgICogQHJldHVybiBbeCwgeSwgeiwgd10KICAgICAqLwoKCiAgICB0b0FycmF5KCkgewogICAgICByZXR1cm4gW3RoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMud107CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIGFuIGF4aXMgYW5kIGFuIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgc2V0RnJvbUF4aXNBbmdsZSh2ZWN0b3IsIGFuZ2xlKSB7CiAgICAgIGNvbnN0IHMgPSBNYXRoLnNpbihhbmdsZSAqIDAuNSk7CiAgICAgIHRoaXMueCA9IHZlY3Rvci54ICogczsKICAgICAgdGhpcy55ID0gdmVjdG9yLnkgKiBzOwogICAgICB0aGlzLnogPSB2ZWN0b3IueiAqIHM7CiAgICAgIHRoaXMudyA9IE1hdGguY29zKGFuZ2xlICogMC41KTsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnRzIHRoZSBxdWF0ZXJuaW9uIHRvIFsgYXhpcywgYW5nbGUgXSByZXByZXNlbnRhdGlvbi4KICAgICAqIEBwYXJhbSB0YXJnZXRBeGlzIEEgdmVjdG9yIG9iamVjdCB0byByZXVzZSBmb3Igc3RvcmluZyB0aGUgYXhpcy4KICAgICAqIEByZXR1cm4gQW4gYXJyYXksIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGF4aXMgYW5kIHRoZSBzZWNvbmQgaXMgdGhlIGFuZ2xlIGluIHJhZGlhbnMuCiAgICAgKi8KCgogICAgdG9BeGlzQW5nbGUodGFyZ2V0QXhpcykgewogICAgICBpZiAodGFyZ2V0QXhpcyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0QXhpcyA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMubm9ybWFsaXplKCk7IC8vIGlmIHc+MSBhY29zIGFuZCBzcXJ0IHdpbGwgcHJvZHVjZSBlcnJvcnMsIHRoaXMgY2FudCBoYXBwZW4gaWYgcXVhdGVybmlvbiBpcyBub3JtYWxpc2VkCgogICAgICBjb25zdCBhbmdsZSA9IDIgKiBNYXRoLmFjb3ModGhpcy53KTsKICAgICAgY29uc3QgcyA9IE1hdGguc3FydCgxIC0gdGhpcy53ICogdGhpcy53KTsgLy8gYXNzdW1pbmcgcXVhdGVybmlvbiBub3JtYWxpc2VkIHRoZW4gdyBpcyBsZXNzIHRoYW4gMSwgc28gdGVybSBhbHdheXMgcG9zaXRpdmUuCgogICAgICBpZiAocyA8IDAuMDAxKSB7CiAgICAgICAgLy8gdGVzdCB0byBhdm9pZCBkaXZpZGUgYnkgemVybywgcyBpcyBhbHdheXMgcG9zaXRpdmUgZHVlIHRvIHNxcnQKICAgICAgICAvLyBpZiBzIGNsb3NlIHRvIHplcm8gdGhlbiBkaXJlY3Rpb24gb2YgYXhpcyBub3QgaW1wb3J0YW50CiAgICAgICAgdGFyZ2V0QXhpcy54ID0gdGhpcy54OyAvLyBpZiBpdCBpcyBpbXBvcnRhbnQgdGhhdCBheGlzIGlzIG5vcm1hbGlzZWQgdGhlbiByZXBsYWNlIHdpdGggeD0xOyB5PXo9MDsKCiAgICAgICAgdGFyZ2V0QXhpcy55ID0gdGhpcy55OwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMuejsKICAgICAgfSBlbHNlIHsKICAgICAgICB0YXJnZXRBeGlzLnggPSB0aGlzLnggLyBzOyAvLyBub3JtYWxpc2UgYXhpcwoKICAgICAgICB0YXJnZXRBeGlzLnkgPSB0aGlzLnkgLyBzOwogICAgICAgIHRhcmdldEF4aXMueiA9IHRoaXMueiAvIHM7CiAgICAgIH0KCiAgICAgIHJldHVybiBbdGFyZ2V0QXhpcywgYW5nbGVdOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHF1YXRlcm5pb24gdmFsdWUgZ2l2ZW4gdHdvIHZlY3RvcnMuIFRoZSByZXN1bHRpbmcgcm90YXRpb24gd2lsbCBiZSB0aGUgbmVlZGVkIHJvdGF0aW9uIHRvIHJvdGF0ZSB1IHRvIHYuCiAgICAgKi8KCgogICAgc2V0RnJvbVZlY3RvcnModSwgdikgewogICAgICBpZiAodS5pc0FudGlwYXJhbGxlbFRvKHYpKSB7CiAgICAgICAgY29uc3QgdDEgPSBzZnZfdDE7CiAgICAgICAgY29uc3QgdDIgPSBzZnZfdDI7CiAgICAgICAgdS50YW5nZW50cyh0MSwgdDIpOwogICAgICAgIHRoaXMuc2V0RnJvbUF4aXNBbmdsZSh0MSwgTWF0aC5QSSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgYSA9IHUuY3Jvc3Modik7CiAgICAgICAgdGhpcy54ID0gYS54OwogICAgICAgIHRoaXMueSA9IGEueTsKICAgICAgICB0aGlzLnogPSBhLno7CiAgICAgICAgdGhpcy53ID0gTWF0aC5zcXJ0KHUubGVuZ3RoKCkgKiogMiAqIHYubGVuZ3RoKCkgKiogMikgKyB1LmRvdCh2KTsKICAgICAgICB0aGlzLm5vcm1hbGl6ZSgpOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogTXVsdGlwbHkgdGhlIHF1YXRlcm5pb24gd2l0aCBhbiBvdGhlciBxdWF0ZXJuaW9uLgogICAgICovCgoKICAgIG11bHQocXVhdCwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gdGhpcy54OwogICAgICBjb25zdCBheSA9IHRoaXMueTsKICAgICAgY29uc3QgYXogPSB0aGlzLno7CiAgICAgIGNvbnN0IGF3ID0gdGhpcy53OwogICAgICBjb25zdCBieCA9IHF1YXQueDsKICAgICAgY29uc3QgYnkgPSBxdWF0Lnk7CiAgICAgIGNvbnN0IGJ6ID0gcXVhdC56OwogICAgICBjb25zdCBidyA9IHF1YXQudzsKICAgICAgdGFyZ2V0LnggPSBheCAqIGJ3ICsgYXcgKiBieCArIGF5ICogYnogLSBheiAqIGJ5OwogICAgICB0YXJnZXQueSA9IGF5ICogYncgKyBhdyAqIGJ5ICsgYXogKiBieCAtIGF4ICogYno7CiAgICAgIHRhcmdldC56ID0gYXogKiBidyArIGF3ICogYnogKyBheCAqIGJ5IC0gYXkgKiBieDsKICAgICAgdGFyZ2V0LncgPSBhdyAqIGJ3IC0gYXggKiBieCAtIGF5ICogYnkgLSBheiAqIGJ6OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGludmVyc2UgcXVhdGVybmlvbiByb3RhdGlvbi4KICAgICAqLwoKCiAgICBpbnZlcnNlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdGhpcy54OwogICAgICBjb25zdCB5ID0gdGhpcy55OwogICAgICBjb25zdCB6ID0gdGhpcy56OwogICAgICBjb25zdCB3ID0gdGhpcy53OwogICAgICB0aGlzLmNvbmp1Z2F0ZSh0YXJnZXQpOwogICAgICBjb25zdCBpbm9ybTIgPSAxIC8gKHggKiB4ICsgeSAqIHkgKyB6ICogeiArIHcgKiB3KTsKICAgICAgdGFyZ2V0LnggKj0gaW5vcm0yOwogICAgICB0YXJnZXQueSAqPSBpbm9ybTI7CiAgICAgIHRhcmdldC56ICo9IGlub3JtMjsKICAgICAgdGFyZ2V0LncgKj0gaW5vcm0yOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHF1YXRlcm5pb24gY29uanVnYXRlCiAgICAgKi8KCgogICAgY29uanVnYXRlKHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgUXVhdGVybmlvbigpOwogICAgICB9CgogICAgICB0YXJnZXQueCA9IC10aGlzLng7CiAgICAgIHRhcmdldC55ID0gLXRoaXMueTsKICAgICAgdGFyZ2V0LnogPSAtdGhpcy56OwogICAgICB0YXJnZXQudyA9IHRoaXMudzsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KICAgIC8qKgogICAgICogTm9ybWFsaXplIHRoZSBxdWF0ZXJuaW9uLiBOb3RlIHRoYXQgdGhpcyBjaGFuZ2VzIHRoZSB2YWx1ZXMgb2YgdGhlIHF1YXRlcm5pb24uCiAgICAgKi8KCgogICAgbm9ybWFsaXplKCkgewogICAgICBsZXQgbCA9IE1hdGguc3FydCh0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLncpOwoKICAgICAgaWYgKGwgPT09IDApIHsKICAgICAgICB0aGlzLnggPSAwOwogICAgICAgIHRoaXMueSA9IDA7CiAgICAgICAgdGhpcy56ID0gMDsKICAgICAgICB0aGlzLncgPSAwOwogICAgICB9IGVsc2UgewogICAgICAgIGwgPSAxIC8gbDsKICAgICAgICB0aGlzLnggKj0gbDsKICAgICAgICB0aGlzLnkgKj0gbDsKICAgICAgICB0aGlzLnogKj0gbDsKICAgICAgICB0aGlzLncgKj0gbDsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIEFwcHJveGltYXRpb24gb2YgcXVhdGVybmlvbiBub3JtYWxpemF0aW9uLiBXb3JrcyBiZXN0IHdoZW4gcXVhdCBpcyBhbHJlYWR5IGFsbW9zdC1ub3JtYWxpemVkLgogICAgICogQGF1dGhvciB1bnBoYXNlZCwgaHR0cHM6Ly9naXRodWIuY29tL3VucGhhc2VkCiAgICAgKi8KCgogICAgbm9ybWFsaXplRmFzdCgpIHsKICAgICAgY29uc3QgZiA9ICgzLjAgLSAodGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53KSkgLyAyLjA7CgogICAgICBpZiAoZiA9PT0gMCkgewogICAgICAgIHRoaXMueCA9IDA7CiAgICAgICAgdGhpcy55ID0gMDsKICAgICAgICB0aGlzLnogPSAwOwogICAgICAgIHRoaXMudyA9IDA7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdGhpcy54ICo9IGY7CiAgICAgICAgdGhpcy55ICo9IGY7CiAgICAgICAgdGhpcy56ICo9IGY7CiAgICAgICAgdGhpcy53ICo9IGY7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB0aGUgcXVhdGVybmlvbiBieSBhIHZlY3RvcgogICAgICovCgoKICAgIHZtdWx0KHYsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBjb25zdCB4ID0gdi54OwogICAgICBjb25zdCB5ID0gdi55OwogICAgICBjb25zdCB6ID0gdi56OwogICAgICBjb25zdCBxeCA9IHRoaXMueDsKICAgICAgY29uc3QgcXkgPSB0aGlzLnk7CiAgICAgIGNvbnN0IHF6ID0gdGhpcy56OwogICAgICBjb25zdCBxdyA9IHRoaXMudzsgLy8gcSp2CgogICAgICBjb25zdCBpeCA9IHF3ICogeCArIHF5ICogeiAtIHF6ICogeTsKICAgICAgY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CiAgICAgIGNvbnN0IGl6ID0gcXcgKiB6ICsgcXggKiB5IC0gcXkgKiB4OwogICAgICBjb25zdCBpdyA9IC1xeCAqIHggLSBxeSAqIHkgLSBxeiAqIHo7CiAgICAgIHRhcmdldC54ID0gaXggKiBxdyArIGl3ICogLXF4ICsgaXkgKiAtcXogLSBpeiAqIC1xeTsKICAgICAgdGFyZ2V0LnkgPSBpeSAqIHF3ICsgaXcgKiAtcXkgKyBpeiAqIC1xeCAtIGl4ICogLXF6OwogICAgICB0YXJnZXQueiA9IGl6ICogcXcgKyBpdyAqIC1xeiArIGl4ICogLXF5IC0gaXkgKiAtcXg7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIENvcGllcyB2YWx1ZSBvZiBzb3VyY2UgdG8gdGhpcyBxdWF0ZXJuaW9uLgogICAgICogQHJldHVybiB0aGlzCiAgICAgKi8KCgogICAgY29weShxdWF0KSB7CiAgICAgIHRoaXMueCA9IHF1YXQueDsKICAgICAgdGhpcy55ID0gcXVhdC55OwogICAgICB0aGlzLnogPSBxdWF0Lno7CiAgICAgIHRoaXMudyA9IHF1YXQudzsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgdGhlIHF1YXRlcm5pb24gdG8gZXVsZXIgYW5nbGUgcmVwcmVzZW50YXRpb24uIE9yZGVyOiBZWlgsIGFzIHRoaXMgcGFnZSBkZXNjcmliZXM6IGh0dHBzOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9zdGFuZGFyZHMvaW5kZXguaHRtCiAgICAgKiBAcGFyYW0gb3JkZXIgVGhyZWUtY2hhcmFjdGVyIHN0cmluZywgZGVmYXVsdHMgdG8gIllaWCIKICAgICAqLwoKCiAgICB0b0V1bGVyKHRhcmdldCwgb3JkZXIpIHsKICAgICAgaWYgKG9yZGVyID09PSB2b2lkIDApIHsKICAgICAgICBvcmRlciA9ICdZWlgnOwogICAgICB9CgogICAgICBsZXQgaGVhZGluZzsKICAgICAgbGV0IGF0dGl0dWRlOwogICAgICBsZXQgYmFuazsKICAgICAgY29uc3QgeCA9IHRoaXMueDsKICAgICAgY29uc3QgeSA9IHRoaXMueTsKICAgICAgY29uc3QgeiA9IHRoaXMuejsKICAgICAgY29uc3QgdyA9IHRoaXMudzsKCiAgICAgIHN3aXRjaCAob3JkZXIpIHsKICAgICAgICBjYXNlICdZWlgnOgogICAgICAgICAgY29uc3QgdGVzdCA9IHggKiB5ICsgeiAqIHc7CgogICAgICAgICAgaWYgKHRlc3QgPiAwLjQ5OSkgewogICAgICAgICAgICAvLyBzaW5ndWxhcml0eSBhdCBub3J0aCBwb2xlCiAgICAgICAgICAgIGhlYWRpbmcgPSAyICogTWF0aC5hdGFuMih4LCB3KTsKICAgICAgICAgICAgYXR0aXR1ZGUgPSBNYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHRlc3QgPCAtMC40OTkpIHsKICAgICAgICAgICAgLy8gc2luZ3VsYXJpdHkgYXQgc291dGggcG9sZQogICAgICAgICAgICBoZWFkaW5nID0gLTIgKiBNYXRoLmF0YW4yKHgsIHcpOwogICAgICAgICAgICBhdHRpdHVkZSA9IC1NYXRoLlBJIC8gMjsKICAgICAgICAgICAgYmFuayA9IDA7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGhlYWRpbmcgPT09IHVuZGVmaW5lZCkgewogICAgICAgICAgICBjb25zdCBzcXggPSB4ICogeDsKICAgICAgICAgICAgY29uc3Qgc3F5ID0geSAqIHk7CiAgICAgICAgICAgIGNvbnN0IHNxeiA9IHogKiB6OwogICAgICAgICAgICBoZWFkaW5nID0gTWF0aC5hdGFuMigyICogeSAqIHcgLSAyICogeCAqIHosIDEgLSAyICogc3F5IC0gMiAqIHNxeik7IC8vIEhlYWRpbmcKCiAgICAgICAgICAgIGF0dGl0dWRlID0gTWF0aC5hc2luKDIgKiB0ZXN0KTsgLy8gYXR0aXR1ZGUKCiAgICAgICAgICAgIGJhbmsgPSBNYXRoLmF0YW4yKDIgKiB4ICogdyAtIDIgKiB5ICogeiwgMSAtIDIgKiBzcXggLSAyICogc3F6KTsgLy8gYmFuawogICAgICAgICAgfQoKICAgICAgICAgIGJyZWFrOwoKICAgICAgICBkZWZhdWx0OgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBFdWxlciBvcmRlciAke29yZGVyfSBub3Qgc3VwcG9ydGVkIHlldC5gKTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnkgPSBoZWFkaW5nOwogICAgICB0YXJnZXQueiA9IGF0dGl0dWRlOwogICAgICB0YXJnZXQueCA9IGJhbms7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgcXVhdGVybmlvbiBjb21wb25lbnRzIGdpdmVuIEV1bGVyIGFuZ2xlIHJlcHJlc2VudGF0aW9uLgogICAgICoKICAgICAqIEBwYXJhbSBvcmRlciBUaGUgb3JkZXIgdG8gYXBwbHkgYW5nbGVzOiAnWFlaJyBvciAnWVhaJyBvciBhbnkgb3RoZXIgY29tYmluYXRpb24uCiAgICAgKgogICAgICogU2VlIHtAbGluayBodHRwczovL3d3dy5tYXRod29ya3MuY29tL21hdGxhYmNlbnRyYWwvZmlsZWV4Y2hhbmdlLzIwNjk2LWZ1bmN0aW9uLXRvLWNvbnZlcnQtYmV0d2Vlbi1kY20tZXVsZXItYW5nbGVzLXF1YXRlcm5pb25zLWFuZC1ldWxlci12ZWN0b3JzIE1hdGhXb3Jrc30gcmVmZXJlbmNlCiAgICAgKi8KCgogICAgc2V0RnJvbUV1bGVyKHgsIHksIHosIG9yZGVyKSB7CiAgICAgIGlmIChvcmRlciA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3JkZXIgPSAnWFlaJzsKICAgICAgfQoKICAgICAgY29uc3QgYzEgPSBNYXRoLmNvcyh4IC8gMik7CiAgICAgIGNvbnN0IGMyID0gTWF0aC5jb3MoeSAvIDIpOwogICAgICBjb25zdCBjMyA9IE1hdGguY29zKHogLyAyKTsKICAgICAgY29uc3QgczEgPSBNYXRoLnNpbih4IC8gMik7CiAgICAgIGNvbnN0IHMyID0gTWF0aC5zaW4oeSAvIDIpOwogICAgICBjb25zdCBzMyA9IE1hdGguc2luKHogLyAyKTsKCiAgICAgIGlmIChvcmRlciA9PT0gJ1hZWicpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWFonKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWlhZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKICAgICAgfSBlbHNlIGlmIChvcmRlciA9PT0gJ1pZWCcpIHsKICAgICAgICB0aGlzLnggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CiAgICAgICAgdGhpcy55ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwogICAgICAgIHRoaXMueiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKICAgICAgICB0aGlzLncgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CiAgICAgIH0gZWxzZSBpZiAob3JkZXIgPT09ICdZWlgnKSB7CiAgICAgICAgdGhpcy54ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwogICAgICAgIHRoaXMueSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKICAgICAgICB0aGlzLnogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CiAgICAgICAgdGhpcy53ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwogICAgICB9IGVsc2UgaWYgKG9yZGVyID09PSAnWFpZJykgewogICAgICAgIHRoaXMueCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKICAgICAgICB0aGlzLnkgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CiAgICAgICAgdGhpcy56ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwogICAgICAgIHRoaXMudyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKICAgICAgfQoKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CgogICAgY2xvbmUoKSB7CiAgICAgIHJldHVybiBuZXcgUXVhdGVybmlvbih0aGlzLngsIHRoaXMueSwgdGhpcy56LCB0aGlzLncpOwogICAgfQogICAgLyoqCiAgICAgKiBQZXJmb3JtcyBhIHNwaGVyaWNhbCBsaW5lYXIgaW50ZXJwb2xhdGlvbiBiZXR3ZWVuIHR3byBxdWF0CiAgICAgKgogICAgICogQHBhcmFtIHRvUXVhdCBzZWNvbmQgb3BlcmFuZAogICAgICogQHBhcmFtIHQgaW50ZXJwb2xhdGlvbiBhbW91bnQgYmV0d2VlbiB0aGUgc2VsZiBxdWF0ZXJuaW9uIGFuZCB0b1F1YXQKICAgICAqIEBwYXJhbSB0YXJnZXQgQSBxdWF0ZXJuaW9uIHRvIHN0b3JlIHRoZSByZXN1bHQgaW4uIElmIG5vdCBwcm92aWRlZCwgYSBuZXcgb25lIHdpbGwgYmUgY3JlYXRlZC4KICAgICAqIEByZXR1cm5zIHtRdWF0ZXJuaW9ufSBUaGUgInRhcmdldCIgb2JqZWN0CiAgICAgKi8KCgogICAgc2xlcnAodG9RdWF0LCB0LCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgYXggPSB0aGlzLng7CiAgICAgIGNvbnN0IGF5ID0gdGhpcy55OwogICAgICBjb25zdCBheiA9IHRoaXMuejsKICAgICAgY29uc3QgYXcgPSB0aGlzLnc7CiAgICAgIGxldCBieCA9IHRvUXVhdC54OwogICAgICBsZXQgYnkgPSB0b1F1YXQueTsKICAgICAgbGV0IGJ6ID0gdG9RdWF0Lno7CiAgICAgIGxldCBidyA9IHRvUXVhdC53OwogICAgICBsZXQgb21lZ2E7CiAgICAgIGxldCBjb3NvbTsKICAgICAgbGV0IHNpbm9tOwogICAgICBsZXQgc2NhbGUwOwogICAgICBsZXQgc2NhbGUxOyAvLyBjYWxjIGNvc2luZQoKICAgICAgY29zb20gPSBheCAqIGJ4ICsgYXkgKiBieSArIGF6ICogYnogKyBhdyAqIGJ3OyAvLyBhZGp1c3Qgc2lnbnMgKGlmIG5lY2Vzc2FyeSkKCiAgICAgIGlmIChjb3NvbSA8IDAuMCkgewogICAgICAgIGNvc29tID0gLWNvc29tOwogICAgICAgIGJ4ID0gLWJ4OwogICAgICAgIGJ5ID0gLWJ5OwogICAgICAgIGJ6ID0gLWJ6OwogICAgICAgIGJ3ID0gLWJ3OwogICAgICB9IC8vIGNhbGN1bGF0ZSBjb2VmZmljaWVudHMKCgogICAgICBpZiAoMS4wIC0gY29zb20gPiAwLjAwMDAwMSkgewogICAgICAgIC8vIHN0YW5kYXJkIGNhc2UgKHNsZXJwKQogICAgICAgIG9tZWdhID0gTWF0aC5hY29zKGNvc29tKTsKICAgICAgICBzaW5vbSA9IE1hdGguc2luKG9tZWdhKTsKICAgICAgICBzY2FsZTAgPSBNYXRoLnNpbigoMS4wIC0gdCkgKiBvbWVnYSkgLyBzaW5vbTsKICAgICAgICBzY2FsZTEgPSBNYXRoLnNpbih0ICogb21lZ2EpIC8gc2lub207CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIHF1YXRlcm5pb25zIGFyZSB2ZXJ5IGNsb3NlCiAgICAgICAgLy8gIC4uLiBzbyB3ZSBjYW4gZG8gYSBsaW5lYXIgaW50ZXJwb2xhdGlvbgogICAgICAgIHNjYWxlMCA9IDEuMCAtIHQ7CiAgICAgICAgc2NhbGUxID0gdDsKICAgICAgfSAvLyBjYWxjdWxhdGUgZmluYWwgdmFsdWVzCgoKICAgICAgdGFyZ2V0LnggPSBzY2FsZTAgKiBheCArIHNjYWxlMSAqIGJ4OwogICAgICB0YXJnZXQueSA9IHNjYWxlMCAqIGF5ICsgc2NhbGUxICogYnk7CiAgICAgIHRhcmdldC56ID0gc2NhbGUwICogYXogKyBzY2FsZTEgKiBiejsKICAgICAgdGFyZ2V0LncgPSBzY2FsZTAgKiBhdyArIHNjYWxlMSAqIGJ3OwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqCiAgICAgKiBSb3RhdGUgYW4gYWJzb2x1dGUgb3JpZW50YXRpb24gcXVhdGVybmlvbiBnaXZlbiBhbiBhbmd1bGFyIHZlbG9jaXR5IGFuZCBhIHRpbWUgc3RlcC4KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoYW5ndWxhclZlbG9jaXR5LCBkdCwgYW5ndWxhckZhY3RvciwgdGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4ID0gYW5ndWxhclZlbG9jaXR5LnggKiBhbmd1bGFyRmFjdG9yLngsCiAgICAgICAgICAgIGF5ID0gYW5ndWxhclZlbG9jaXR5LnkgKiBhbmd1bGFyRmFjdG9yLnksCiAgICAgICAgICAgIGF6ID0gYW5ndWxhclZlbG9jaXR5LnogKiBhbmd1bGFyRmFjdG9yLnosCiAgICAgICAgICAgIGJ4ID0gdGhpcy54LAogICAgICAgICAgICBieSA9IHRoaXMueSwKICAgICAgICAgICAgYnogPSB0aGlzLnosCiAgICAgICAgICAgIGJ3ID0gdGhpcy53OwogICAgICBjb25zdCBoYWxmX2R0ID0gZHQgKiAwLjU7CiAgICAgIHRhcmdldC54ICs9IGhhbGZfZHQgKiAoYXggKiBidyArIGF5ICogYnogLSBheiAqIGJ5KTsKICAgICAgdGFyZ2V0LnkgKz0gaGFsZl9kdCAqIChheSAqIGJ3ICsgYXogKiBieCAtIGF4ICogYnopOwogICAgICB0YXJnZXQueiArPSBoYWxmX2R0ICogKGF6ICogYncgKyBheCAqIGJ5IC0gYXkgKiBieCk7CiAgICAgIHRhcmdldC53ICs9IGhhbGZfZHQgKiAoLWF4ICogYnggLSBheSAqIGJ5IC0gYXogKiBieik7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CgogIH0KICBjb25zdCBzZnZfdDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNmdl90MiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIFRoZSBhdmFpbGFibGUgc2hhcGUgdHlwZXMuCiAgICovCiAgY29uc3QgU0hBUEVfVFlQRVMgPSB7CiAgICAvKiogU1BIRVJFICovCiAgICBTUEhFUkU6IDEsCgogICAgLyoqIFBMQU5FICovCiAgICBQTEFORTogMiwKCiAgICAvKiogQk9YICovCiAgICBCT1g6IDQsCgogICAgLyoqIENPTVBPVU5EICovCiAgICBDT01QT1VORDogOCwKCiAgICAvKiogQ09OVkVYUE9MWUhFRFJPTiAqLwogICAgQ09OVkVYUE9MWUhFRFJPTjogMTYsCgogICAgLyoqIEhFSUdIVEZJRUxEICovCiAgICBIRUlHSFRGSUVMRDogMzIsCgogICAgLyoqIFBBUlRJQ0xFICovCiAgICBQQVJUSUNMRTogNjQsCgogICAgLyoqIENZTElOREVSICovCiAgICBDWUxJTkRFUjogMTI4LAoKICAgIC8qKiBUUklNRVNIICovCiAgICBUUklNRVNIOiAyNTYKICB9OwogIC8qKgogICAqIFNoYXBlVHlwZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBzaGFwZXMKICAgKi8KICBjbGFzcyBTaGFwZSB7CiAgICAvKioKICAgICAqIElkZW50aWZpZXIgb2YgdGhlIFNoYXBlLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHlwZSBvZiB0aGlzIHNoYXBlLiBNdXN0IGJlIHNldCB0byBhbiBpbnQgPiAwIGJ5IHN1YmNsYXNzZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBib3VuZGluZyBzcGhlcmUgcmFkaXVzIG9mIHRoaXMgc2hhcGUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZXRoZXIgdG8gcHJvZHVjZSBjb250YWN0IGZvcmNlcyB3aGVuIGluIGNvbnRhY3Qgd2l0aCBvdGhlciBib2RpZXMuIE5vdGUgdGhhdCBjb250YWN0cyB3aWxsIGJlIGdlbmVyYXRlZCwgYnV0IHRoZXkgd2lsbCBiZSBkaXNhYmxlZC4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBPcHRpb25hbCBtYXRlcmlhbCBvZiB0aGUgc2hhcGUgdGhhdCByZWd1bGF0ZXMgY29udGFjdCBwcm9wZXJ0aWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgYm9keSB0byB3aGljaCB0aGUgc2hhcGUgaXMgYWRkZWQgdG8uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFsbCB0aGUgU2hhcGUgdHlwZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgdGhpcy5pZCA9IFNoYXBlLmlkQ291bnRlcisrOwogICAgICB0aGlzLnR5cGUgPSBvcHRpb25zLnR5cGUgfHwgMDsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IDA7CiAgICAgIHRoaXMuY29sbGlzaW9uUmVzcG9uc2UgPSBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID8gb3B0aW9ucy5jb2xsaXNpb25SZXNwb25zZSA6IHRydWU7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgPyBvcHRpb25zLm1hdGVyaWFsIDogbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgdGhlIGJvdW5kaW5nIHNwaGVyZSByYWRpdXMuCiAgICAgKiBUaGUgcmVzdWx0IGlzIHN0b3JlZCBpbiB0aGUgcHJvcGVydHkgYC5ib3VuZGluZ1NwaGVyZVJhZGl1c2AKICAgICAqLwoKCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgdGhyb3cgYGNvbXB1dGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIHZvbHVtZSBvZiB0aGlzIHNoYXBlCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICB0aHJvdyBgdm9sdW1lKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZXMgdGhlIGluZXJ0aWEgaW4gdGhlIGxvY2FsIGZyYW1lIGZvciB0aGlzIHNoYXBlLgogICAgICogQHNlZSBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpc3Rfb2ZfbW9tZW50c19vZl9pbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICB0aHJvdyBgY2FsY3VsYXRlTG9jYWxJbmVydGlhKCkgbm90IGltcGxlbWVudGVkIGZvciBzaGFwZSB0eXBlICR7dGhpcy50eXBlfWA7CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIHVzZSBhYnN0cmFjdCBmb3IgdGhlc2Uga2luZCBvZiBtZXRob2RzCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgdGhyb3cgYGNhbGN1bGF0ZVdvcmxkQUFCQigpIG5vdCBpbXBsZW1lbnRlZCBmb3Igc2hhcGUgdHlwZSAke3RoaXMudHlwZX1gOwogICAgfQoKICB9CiAgU2hhcGUuaWRDb3VudGVyID0gMDsKICBTaGFwZS50eXBlcyA9IFNIQVBFX1RZUEVTOwoKICAvKioKICAgKiBUcmFuc2Zvcm1hdGlvbiB1dGlsaXRpZXMuCiAgICovCiAgY2xhc3MgVHJhbnNmb3JtIHsKICAgIC8qKgogICAgICogcG9zaXRpb24KICAgICAqLwoKICAgIC8qKgogICAgICogcXVhdGVybmlvbgogICAgICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMucG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnF1YXRlcm5pb24gPSBuZXcgUXVhdGVybmlvbigpOwoKICAgICAgaWYgKG9wdGlvbnMucG9zaXRpb24pIHsKICAgICAgICB0aGlzLnBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIGdsb2JhbCBwb2ludCBpbiBsb2NhbCB0cmFuc2Zvcm0gY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgcG9pbnRUb0xvY2FsKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICByZXR1cm4gVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHRoaXMucG9zaXRpb24sIHRoaXMucXVhdGVybmlvbiwgd29ybGRQb2ludCwgcmVzdWx0KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGEgbG9jYWwgcG9pbnQgaW4gZ2xvYmFsIHRyYW5zZm9ybSBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBwb2ludFRvV29ybGQobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIHJldHVybiBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCBsb2NhbFBvaW50LCByZXN1bHQpOwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb1dvcmxkRnJhbWUKICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHBvaW50VG9Mb2NhbEZyYW1lCiAgICAgKi8KCgogICAgc3RhdGljIHBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgaWYgKHJlc3VsdCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgd29ybGRQb2ludC52c3ViKHBvc2l0aW9uLCByZXN1bHQpOwogICAgICBxdWF0ZXJuaW9uLmNvbmp1Z2F0ZSh0bXBRdWF0JDEpOwogICAgICB0bXBRdWF0JDEudm11bHQocmVzdWx0LCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBwb2ludFRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyBwb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdGVybmlvbiwgbG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udm11bHQobG9jYWxQb2ludCwgcmVzdWx0KTsKICAgICAgcmVzdWx0LnZhZGQocG9zaXRpb24sIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHZlY3RvclRvV29ybGRGcmFtZQogICAgICovCgoKICAgIHN0YXRpYyB2ZWN0b3JUb1dvcmxkRnJhbWUocXVhdGVybmlvbiwgbG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBxdWF0ZXJuaW9uLnZtdWx0KGxvY2FsVmVjdG9yLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiB2ZWN0b3JUb0xvY2FsRnJhbWUKICAgICAqLwoKCiAgICBzdGF0aWMgdmVjdG9yVG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCB3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHF1YXRlcm5pb24udyAqPSAtMTsKICAgICAgcXVhdGVybmlvbi52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcXVhdGVybmlvbi53ICo9IC0xOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQoKICB9CiAgY29uc3QgdG1wUXVhdCQxID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgLyoqCiAgICogQSBzZXQgb2YgcG9seWdvbnMgZGVzY3JpYmluZyBhIGNvbnZleCBzaGFwZS4KICAgKgogICAqIFRoZSBzaGFwZSBNVVNUIGJlIGNvbnZleCBmb3IgdGhlIGNvZGUgdG8gd29yayBwcm9wZXJseS4gTm8gcG9seWdvbnMgbWF5IGJlIGNvcGxhbmFyIChjb250YWluZWQKICAgKiBpbiB0aGUgc2FtZSAzRCBwbGFuZSksIGluc3RlYWQgdGhlc2Ugc2hvdWxkIGJlIG1lcmdlZCBpbnRvIG9uZSBwb2x5Z29uLgogICAqCiAgICogQGF1dGhvciBxaWFvIC8gaHR0cHM6Ly9naXRodWIuY29tL3FpYW8gKG9yaWdpbmFsIGF1dGhvciwgc2VlIGh0dHBzOi8vZ2l0aHViLmNvbS9xaWFvL3RocmVlLmpzL2NvbW1pdC84NTAyNmYwYzc2OWU0MDAwMTQ4YTY3ZDQ1YTllOWI5YzUxMDg4MzZmKQogICAqIEBhdXRob3Igc2NodGVwcGUgLyBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUKICAgKiBAc2VlIGh0dHBzOi8vd3d3LmFsdGRldmJsb2dhZGF5LmNvbS8yMDExLzA1LzEzL2NvbnRhY3QtZ2VuZXJhdGlvbi1iZXR3ZWVuLTNkLWNvbnZleC1tZXNoZXMvCiAgICoKICAgKiBAdG9kbyBNb3ZlIHRoZSBjbGlwcGluZyBmdW5jdGlvbnMgdG8gQ29udGFjdEdlbmVyYXRvcj8KICAgKiBAdG9kbyBBdXRvbWF0aWNhbGx5IG1lcmdlIGNvcGxhbmFyIHBvbHlnb25zIGluIGNvbnN0cnVjdG9yLgogICAqIEBleGFtcGxlCiAgICogICAgIGNvbnN0IGNvbnZleFNoYXBlID0gbmV3IENBTk5PTi5Db252ZXhQb2x5aGVkcm9uKHsgdmVydGljZXMsIGZhY2VzIH0pCiAgICogICAgIGNvbnN0IGNvbnZleEJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoeyBtYXNzOiAxLCBzaGFwZTogY29udmV4U2hhcGUgfSkKICAgKiAgICAgd29ybGQuYWRkQm9keShjb252ZXhCb2R5KQogICAqLwogIGNsYXNzIENvbnZleFBvbHloZWRyb24gZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogdmVydGljZXMgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggZmFjZSBjb25zaXN0cyBvZgogICAgICovCgogICAgLyoqIGZhY2VOb3JtYWxzICovCgogICAgLyoqIHdvcmxkVmVydGljZXMgKi8KCiAgICAvKiogd29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlICovCgogICAgLyoqIHdvcmxkRmFjZU5vcm1hbHMgKi8KCiAgICAvKiogd29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlICovCgogICAgLyoqCiAgICAgKiBJZiBnaXZlbiwgdGhlc2UgbG9jYWxseSBkZWZpbmVkLCBub3JtYWxpemVkIGF4ZXMgYXJlIHRoZSBvbmx5IG9uZXMgYmVpbmcgY2hlY2tlZCB3aGVuIGRvaW5nIHNlcGFyYXRpbmcgYXhpcyBjaGVjay4KICAgICAqLwoKICAgIC8qKiB1bmlxdWVFZGdlcyAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIHZlcnRpY2VzIEFuIGFycmF5IG9mIFZlYzMncwogICAgICogQHBhcmFtIGZhY2VzIEFycmF5IG9mIGludGVnZXIgYXJyYXlzLCBkZXNjcmliaW5nIHdoaWNoIHZlcnRpY2VzIHRoYXQgaXMgaW5jbHVkZWQgaW4gZWFjaCBmYWNlLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihwcm9wcykgewogICAgICBpZiAocHJvcHMgPT09IHZvaWQgMCkgewogICAgICAgIHByb3BzID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IHsKICAgICAgICB2ZXJ0aWNlcyA9IFtdLAogICAgICAgIGZhY2VzID0gW10sCiAgICAgICAgbm9ybWFscyA9IFtdLAogICAgICAgIGF4ZXMsCiAgICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMKICAgICAgfSA9IHByb3BzOwogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTgogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IHZlcnRpY2VzOwogICAgICB0aGlzLmZhY2VzID0gZmFjZXM7CiAgICAgIHRoaXMuZmFjZU5vcm1hbHMgPSBub3JtYWxzOwoKICAgICAgaWYgKHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgdGhpcy5jb21wdXRlTm9ybWFscygpOwogICAgICB9CgogICAgICBpZiAoIWJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSBib3VuZGluZ1NwaGVyZVJhZGl1czsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzID0gW107IC8vIFdvcmxkIHRyYW5zZm9ybWVkIHZlcnNpb24gb2YgLnZlcnRpY2VzCgogICAgICB0aGlzLndvcmxkVmVydGljZXNOZWVkc1VwZGF0ZSA9IHRydWU7CiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFscyA9IFtdOyAvLyBXb3JsZCB0cmFuc2Zvcm1lZCB2ZXJzaW9uIG9mIC5mYWNlTm9ybWFscwoKICAgICAgdGhpcy53b3JsZEZhY2VOb3JtYWxzTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICB0aGlzLnVuaXF1ZUF4ZXMgPSBheGVzID8gYXhlcy5zbGljZSgpIDogbnVsbDsKICAgICAgdGhpcy51bmlxdWVFZGdlcyA9IFtdOwogICAgICB0aGlzLmNvbXB1dGVFZGdlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB1bmlxdWVFZGdlcwogICAgICovCgoKICAgIGNvbXB1dGVFZGdlcygpIHsKICAgICAgY29uc3QgZmFjZXMgPSB0aGlzLmZhY2VzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IGVkZ2VzID0gdGhpcy51bmlxdWVFZGdlczsKICAgICAgZWRnZXMubGVuZ3RoID0gMDsKICAgICAgY29uc3QgZWRnZSA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07CiAgICAgICAgY29uc3QgbnVtVmVydGljZXMgPSBmYWNlLmxlbmd0aDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IG51bVZlcnRpY2VzOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGsgPSAoaiArIDEpICUgbnVtVmVydGljZXM7CiAgICAgICAgICB2ZXJ0aWNlc1tmYWNlW2pdXS52c3ViKHZlcnRpY2VzW2ZhY2Vba11dLCBlZGdlKTsKICAgICAgICAgIGVkZ2Uubm9ybWFsaXplKCk7CiAgICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKCiAgICAgICAgICBmb3IgKGxldCBwID0gMDsgcCAhPT0gZWRnZXMubGVuZ3RoOyBwKyspIHsKICAgICAgICAgICAgaWYgKGVkZ2VzW3BdLmFsbW9zdEVxdWFscyhlZGdlKSB8fCBlZGdlc1twXS5hbG1vc3RFcXVhbHMoZWRnZSkpIHsKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoIWZvdW5kKSB7CiAgICAgICAgICAgIGVkZ2VzLnB1c2goZWRnZS5jbG9uZSgpKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFscyBvZiB0aGUgZmFjZXMuCiAgICAgKiBXaWxsIHJldXNlIGV4aXN0aW5nIFZlYzMgb2JqZWN0cyBpbiB0aGUgYGZhY2VOb3JtYWxzYCBhcnJheSBpZiB0aGV5IGV4aXN0LgogICAgICovCgoKICAgIGNvbXB1dGVOb3JtYWxzKCkgewogICAgICB0aGlzLmZhY2VOb3JtYWxzLmxlbmd0aCA9IHRoaXMuZmFjZXMubGVuZ3RoOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBDaGVjayBzbyBhbGwgdmVydGljZXMgZXhpc3RzIGZvciB0aGlzIGZhY2UKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IHRoaXMuZmFjZXNbaV0ubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGlmICghdGhpcy52ZXJ0aWNlc1t0aGlzLmZhY2VzW2ldW2pdXSkgewogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYFZlcnRleCAke3RoaXMuZmFjZXNbaV1bal19IG5vdCBmb3VuZCFgKTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ldIHx8IG5ldyBWZWMzKCk7CiAgICAgICAgdGhpcy5nZXRGYWNlTm9ybWFsKGksIG4pOwogICAgICAgIG4ubmVnYXRlKG4pOwogICAgICAgIHRoaXMuZmFjZU5vcm1hbHNbaV0gPSBuOwogICAgICAgIGNvbnN0IHZlcnRleCA9IHRoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVswXV07CgogICAgICAgIGlmIChuLmRvdCh2ZXJ0ZXgpIDwgMCkgewogICAgICAgICAgY29uc29sZS5lcnJvcihgLmZhY2VOb3JtYWxzWyR7aX1dID0gVmVjMygke24udG9TdHJpbmcoKX0pIGxvb2tzIGxpa2UgaXQgcG9pbnRzIGludG8gdGhlIHNoYXBlPyBUaGUgdmVydGljZXMgZm9sbG93LiBNYWtlIHN1cmUgdGhleSBhcmUgb3JkZXJlZCBDQ1cgYXJvdW5kIHRoZSBub3JtYWwsIHVzaW5nIHRoZSByaWdodCBoYW5kIHJ1bGUuYCk7CgogICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCB0aGlzLmZhY2VzW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgIGNvbnNvbGUud2FybihgLnZlcnRpY2VzWyR7dGhpcy5mYWNlc1tpXVtqXX1dID0gVmVjMygke3RoaXMudmVydGljZXNbdGhpcy5mYWNlc1tpXVtqXV0udG9TdHJpbmcoKX0pYCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIG5vcm1hbCBvZiBhIGZhY2UgZnJvbSBpdHMgdmVydGljZXMKICAgICAqLwoKCiAgICBnZXRGYWNlTm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBmID0gdGhpcy5mYWNlc1tpXTsKICAgICAgY29uc3QgdmEgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCB2YiA9IHRoaXMudmVydGljZXNbZlsxXV07CiAgICAgIGNvbnN0IHZjID0gdGhpcy52ZXJ0aWNlc1tmWzJdXTsKICAgICAgQ29udmV4UG9seWhlZHJvbi5jb21wdXRlTm9ybWFsKHZhLCB2YiwgdmMsIHRhcmdldCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGNiID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWIgPSBuZXcgVmVjMygpOwogICAgICB2Yi52c3ViKHZhLCBhYik7CiAgICAgIHZjLnZzdWIodmIsIGNiKTsKICAgICAgY2IuY3Jvc3MoYWIsIHRhcmdldCk7CgogICAgICBpZiAoIXRhcmdldC5pc1plcm8oKSkgewogICAgICAgIHRhcmdldC5ub3JtYWxpemUoKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBAcGFyYW0gbWluRGlzdCBDbGFtcCBkaXN0YW5jZQogICAgICogQHBhcmFtIHJlc3VsdCBUaGUgYW4gYXJyYXkgb2YgY29udGFjdCBwb2ludCBvYmplY3RzLCBzZWUgY2xpcEZhY2VBZ2FpbnN0SHVsbAogICAgICovCgoKICAgIGNsaXBBZ2FpbnN0SHVsbChwb3NBLCBxdWF0QSwgaHVsbEIsIHBvc0IsIHF1YXRCLCBzZXBhcmF0aW5nTm9ybWFsLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgV29ybGROb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBsZXQgY2xvc2VzdEZhY2VCID0gLTE7CiAgICAgIGxldCBkbWF4ID0gLU51bWJlci5NQVhfVkFMVUU7CgogICAgICBmb3IgKGxldCBmYWNlID0gMDsgZmFjZSA8IGh1bGxCLmZhY2VzLmxlbmd0aDsgZmFjZSsrKSB7CiAgICAgICAgV29ybGROb3JtYWwuY29weShodWxsQi5mYWNlTm9ybWFsc1tmYWNlXSk7CiAgICAgICAgcXVhdEIudm11bHQoV29ybGROb3JtYWwsIFdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCBkID0gV29ybGROb3JtYWwuZG90KHNlcGFyYXRpbmdOb3JtYWwpOwoKICAgICAgICBpZiAoZCA+IGRtYXgpIHsKICAgICAgICAgIGRtYXggPSBkOwogICAgICAgICAgY2xvc2VzdEZhY2VCID0gZmFjZTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkVmVydHNCMSA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBodWxsQi5mYWNlc1tjbG9zZXN0RmFjZUJdLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGh1bGxCLnZlcnRpY2VzW2h1bGxCLmZhY2VzW2Nsb3Nlc3RGYWNlQl1baV1dOwogICAgICAgIGNvbnN0IHdvcmxkYiA9IG5ldyBWZWMzKCk7CiAgICAgICAgd29ybGRiLmNvcHkoYik7CiAgICAgICAgcXVhdEIudm11bHQod29ybGRiLCB3b3JsZGIpOwogICAgICAgIHBvc0IudmFkZCh3b3JsZGIsIHdvcmxkYik7CiAgICAgICAgd29ybGRWZXJ0c0IxLnB1c2god29ybGRiKTsKICAgICAgfQoKICAgICAgaWYgKGNsb3Nlc3RGYWNlQiA+PSAwKSB7CiAgICAgICAgdGhpcy5jbGlwRmFjZUFnYWluc3RIdWxsKHNlcGFyYXRpbmdOb3JtYWwsIHBvc0EsIHF1YXRBLCB3b3JsZFZlcnRzQjEsIG1pbkRpc3QsIG1heERpc3QsIHJlc3VsdCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogRmluZCB0aGUgc2VwYXJhdGluZyBheGlzIGJldHdlZW4gdGhpcyBodWxsIGFuZCBhbm90aGVyCiAgICAgKiBAcGFyYW0gdGFyZ2V0IFRoZSB0YXJnZXQgdmVjdG9yIHRvIHNhdmUgdGhlIGF4aXMgaW4KICAgICAqIEByZXR1cm4gUmV0dXJucyBmYWxzZSBpZiBhIHNlcGFyYXRpb24gaXMgZm91bmQsIGVsc2UgdHJ1ZQogICAgICovCgoKICAgIGZpbmRTZXBhcmF0aW5nQXhpcyhodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCLCB0YXJnZXQsIGZhY2VMaXN0QSwgZmFjZUxpc3RCKSB7CiAgICAgIGNvbnN0IGZhY2VBTm9ybWFsV1MzID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRub3JtYWwxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGVsdGFDID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkRWRnZTEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBDcm9zcyA9IG5ldyBWZWMzKCk7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwoKICAgICAgaWYgKCFodWxsQS51bmlxdWVBeGVzKSB7CiAgICAgICAgY29uc3QgbnVtRmFjZXNBID0gZmFjZUxpc3RBID8gZmFjZUxpc3RBLmxlbmd0aCA6IGh1bGxBLmZhY2VzLmxlbmd0aDsgLy8gVGVzdCBmYWNlIG5vcm1hbHMgZnJvbSBodWxsQQoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQTsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QSA/IGZhY2VMaXN0QVtpXSA6IGk7IC8vIEdldCB3b3JsZCBmYWNlIG5vcm1hbAoKICAgICAgICAgIGZhY2VBTm9ybWFsV1MzLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmldKTsKICAgICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MzLCBmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICBjb25zdCBkID0gaHVsbEEudGVzdFNlcEF4aXMoZmFjZUFOb3JtYWxXUzMsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgIGlmIChkID09PSBmYWxzZSkgewogICAgICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICAgIGRtaW4gPSBkOwogICAgICAgICAgICB0YXJnZXQuY29weShmYWNlQU5vcm1hbFdTMyk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gaHVsbEEudW5pcXVlQXhlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGF4aXMKICAgICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUF4ZXNbaV0sIGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIGNvbnN0IGQgPSBodWxsQS50ZXN0U2VwQXhpcyhmYWNlQU5vcm1hbFdTMywgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KGZhY2VBTm9ybWFsV1MzKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICghaHVsbEIudW5pcXVlQXhlcykgewogICAgICAgIC8vIFRlc3QgZmFjZSBub3JtYWxzIGZyb20gaHVsbEIKICAgICAgICBjb25zdCBudW1GYWNlc0IgPSBmYWNlTGlzdEIgPyBmYWNlTGlzdEIubGVuZ3RoIDogaHVsbEIuZmFjZXMubGVuZ3RoOwoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bUZhY2VzQjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBmaSA9IGZhY2VMaXN0QiA/IGZhY2VMaXN0QltpXSA6IGk7CiAgICAgICAgICBXb3JsZG5vcm1hbDEuY29weShodWxsQi5mYWNlTm9ybWFsc1tmaV0pOwogICAgICAgICAgcXVhdEIudm11bHQoV29ybGRub3JtYWwxLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIFRlc3QgdW5pcXVlIGF4ZXMgaW4gQgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBodWxsQi51bmlxdWVBeGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBxdWF0Qi52bXVsdChodWxsQi51bmlxdWVBeGVzW2ldLCBXb3JsZG5vcm1hbDEpOwogICAgICAgICAgY29uc3QgZCA9IGh1bGxBLnRlc3RTZXBBeGlzKFdvcmxkbm9ybWFsMSwgaHVsbEIsIHBvc0EsIHF1YXRBLCBwb3NCLCBxdWF0Qik7CgogICAgICAgICAgaWYgKGQgPT09IGZhbHNlKSB7CiAgICAgICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoZCA8IGRtaW4pIHsKICAgICAgICAgICAgZG1pbiA9IGQ7CiAgICAgICAgICAgIHRhcmdldC5jb3B5KFdvcmxkbm9ybWFsMSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRlc3QgZWRnZXMKCgogICAgICBmb3IgKGxldCBlMCA9IDA7IGUwICE9PSBodWxsQS51bmlxdWVFZGdlcy5sZW5ndGg7IGUwKyspIHsKICAgICAgICAvLyBHZXQgd29ybGQgZWRnZQogICAgICAgIHF1YXRBLnZtdWx0KGh1bGxBLnVuaXF1ZUVkZ2VzW2UwXSwgd29ybGRFZGdlMCk7CgogICAgICAgIGZvciAobGV0IGUxID0gMDsgZTEgIT09IGh1bGxCLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgZTErKykgewogICAgICAgICAgLy8gR2V0IHdvcmxkIGVkZ2UgMgogICAgICAgICAgcXVhdEIudm11bHQoaHVsbEIudW5pcXVlRWRnZXNbZTFdLCB3b3JsZEVkZ2UxKTsKICAgICAgICAgIHdvcmxkRWRnZTAuY3Jvc3Mod29ybGRFZGdlMSwgQ3Jvc3MpOwoKICAgICAgICAgIGlmICghQ3Jvc3MuYWxtb3N0WmVybygpKSB7CiAgICAgICAgICAgIENyb3NzLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBjb25zdCBkaXN0ID0gaHVsbEEudGVzdFNlcEF4aXMoQ3Jvc3MsIGh1bGxCLCBwb3NBLCBxdWF0QSwgcG9zQiwgcXVhdEIpOwoKICAgICAgICAgICAgaWYgKGRpc3QgPT09IGZhbHNlKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoZGlzdCA8IGRtaW4pIHsKICAgICAgICAgICAgICBkbWluID0gZGlzdDsKICAgICAgICAgICAgICB0YXJnZXQuY29weShDcm9zcyk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHBvc0IudnN1Yihwb3NBLCBkZWx0YUMpOwoKICAgICAgaWYgKGRlbHRhQy5kb3QodGFyZ2V0KSA+IDAuMCkgewogICAgICAgIHRhcmdldC5uZWdhdGUodGFyZ2V0KTsKICAgICAgfQoKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIFRlc3Qgc2VwYXJhdGluZyBheGlzIGFnYWluc3QgdHdvIGh1bGxzLiBCb3RoIGh1bGxzIGFyZSBwcm9qZWN0ZWQgb250byB0aGUgYXhpcyBhbmQgdGhlIG92ZXJsYXAgc2l6ZSBpcyByZXR1cm5lZCBpZiB0aGVyZSBpcyBvbmUuCiAgICAgKiBAcmV0dXJuIFRoZSBvdmVybGFwIGRlcHRoLCBvciBGQUxTRSBpZiBubyBwZW5ldHJhdGlvbi4KICAgICAqLwoKCiAgICB0ZXN0U2VwQXhpcyhheGlzLCBodWxsQiwgcG9zQSwgcXVhdEEsIHBvc0IsIHF1YXRCKSB7CiAgICAgIGNvbnN0IGh1bGxBID0gdGhpczsKICAgICAgQ29udmV4UG9seWhlZHJvbi5wcm9qZWN0KGh1bGxBLCBheGlzLCBwb3NBLCBxdWF0QSwgbWF4bWluQSk7CiAgICAgIENvbnZleFBvbHloZWRyb24ucHJvamVjdChodWxsQiwgYXhpcywgcG9zQiwgcXVhdEIsIG1heG1pbkIpOwogICAgICBjb25zdCBtYXhBID0gbWF4bWluQVswXTsKICAgICAgY29uc3QgbWluQSA9IG1heG1pbkFbMV07CiAgICAgIGNvbnN0IG1heEIgPSBtYXhtaW5CWzBdOwogICAgICBjb25zdCBtaW5CID0gbWF4bWluQlsxXTsKCiAgICAgIGlmIChtYXhBIDwgbWluQiB8fCBtYXhCIDwgbWluQSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gU2VwYXJhdGVkCiAgICAgIH0KCiAgICAgIGNvbnN0IGQwID0gbWF4QSAtIG1pbkI7CiAgICAgIGNvbnN0IGQxID0gbWF4QiAtIG1pbkE7CiAgICAgIGNvbnN0IGRlcHRoID0gZDAgPCBkMSA/IGQwIDogZDE7CiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICBjb25zdCBhYWJibWF4ID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgYWFiYm1pbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29tcHV0ZUxvY2FsQUFCQihhYWJibWluLCBhYWJibWF4KTsKICAgICAgY29uc3QgeCA9IGFhYmJtYXgueCAtIGFhYmJtaW4ueDsKICAgICAgY29uc3QgeSA9IGFhYmJtYXgueSAtIGFhYmJtaW4ueTsKICAgICAgY29uc3QgeiA9IGFhYmJtYXgueiAtIGFhYmJtaW4uejsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeik7CiAgICAgIHRhcmdldC55ID0gMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHggKiAyICogeCArIDIgKiB6ICogMiAqIHopOwogICAgICB0YXJnZXQueiA9IDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB5ICogMiAqIHkgKyAyICogeCAqIDIgKiB4KTsKICAgIH0KICAgIC8qKgogICAgICogQHBhcmFtIGZhY2VfaSBJbmRleCBvZiB0aGUgZmFjZQogICAgICovCgoKICAgIGdldFBsYW5lQ29uc3RhbnRPZkZhY2UoZmFjZV9pKSB7CiAgICAgIGNvbnN0IGYgPSB0aGlzLmZhY2VzW2ZhY2VfaV07CiAgICAgIGNvbnN0IG4gPSB0aGlzLmZhY2VOb3JtYWxzW2ZhY2VfaV07CiAgICAgIGNvbnN0IHYgPSB0aGlzLnZlcnRpY2VzW2ZbMF1dOwogICAgICBjb25zdCBjID0gLW4uZG90KHYpOwogICAgICByZXR1cm4gYzsKICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgYWdhaW5zdCBhIGh1bGwuCiAgICAgKiBAcGFyYW0gd29ybGRWZXJ0c0IxIEFuIGFycmF5IG9mIFZlYzMgd2l0aCB2ZXJ0aWNlcyBpbiB0aGUgd29ybGQgZnJhbWUuCiAgICAgKiBAcGFyYW0gbWluRGlzdCBEaXN0YW5jZSBjbGFtcGluZwogICAgICogQHBhcmFtIEFycmF5IHJlc3VsdCBBcnJheSB0byBzdG9yZSByZXN1bHRpbmcgY29udGFjdCBwb2ludHMgaW4uIFdpbGwgYmUgb2JqZWN0cyB3aXRoIHByb3BlcnRpZXM6IHBvaW50LCBkZXB0aCwgbm9ybWFsLiBUaGVzZSBhcmUgcmVwcmVzZW50ZWQgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0SHVsbChzZXBhcmF0aW5nTm9ybWFsLCBwb3NBLCBxdWF0QSwgd29ybGRWZXJ0c0IxLCBtaW5EaXN0LCBtYXhEaXN0LCByZXN1bHQpIHsKICAgICAgY29uc3QgZmFjZUFOb3JtYWxXUyA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGVkZ2UwID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgV29ybGRFZGdlMCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHdvcmxkUGxhbmVBbm9ybWFsMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHBsYW5lTm9ybWFsV1MxID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3Qgd29ybGRBMSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGxvY2FsUGxhbmVOb3JtYWwgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwbGFuZU5vcm1hbFdTID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgaHVsbEEgPSB0aGlzOwogICAgICBjb25zdCB3b3JsZFZlcnRzQjIgPSBbXTsKICAgICAgY29uc3QgcFZ0eEluID0gd29ybGRWZXJ0c0IxOwogICAgICBjb25zdCBwVnR4T3V0ID0gd29ybGRWZXJ0c0IyOwogICAgICBsZXQgY2xvc2VzdEZhY2VBID0gLTE7CiAgICAgIGxldCBkbWluID0gTnVtYmVyLk1BWF9WQUxVRTsgLy8gRmluZCB0aGUgZmFjZSB3aXRoIG5vcm1hbCBjbG9zZXN0IHRvIHRoZSBzZXBhcmF0aW5nIGF4aXMKCiAgICAgIGZvciAobGV0IGZhY2UgPSAwOyBmYWNlIDwgaHVsbEEuZmFjZXMubGVuZ3RoOyBmYWNlKyspIHsKICAgICAgICBmYWNlQU5vcm1hbFdTLmNvcHkoaHVsbEEuZmFjZU5vcm1hbHNbZmFjZV0pOwogICAgICAgIHF1YXRBLnZtdWx0KGZhY2VBTm9ybWFsV1MsIGZhY2VBTm9ybWFsV1MpOwogICAgICAgIGNvbnN0IGQgPSBmYWNlQU5vcm1hbFdTLmRvdChzZXBhcmF0aW5nTm9ybWFsKTsKCiAgICAgICAgaWYgKGQgPCBkbWluKSB7CiAgICAgICAgICBkbWluID0gZDsKICAgICAgICAgIGNsb3Nlc3RGYWNlQSA9IGZhY2U7CiAgICAgICAgfQogICAgICB9CgogICAgICBpZiAoY2xvc2VzdEZhY2VBIDwgMCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBHZXQgdGhlIGZhY2UgYW5kIGNvbnN0cnVjdCBjb25uZWN0ZWQgZmFjZXMKCgogICAgICBjb25zdCBwb2x5QSA9IGh1bGxBLmZhY2VzW2Nsb3Nlc3RGYWNlQV07CiAgICAgIHBvbHlBLmNvbm5lY3RlZEZhY2VzID0gW107CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGh1bGxBLmZhY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBodWxsQS5mYWNlc1tpXS5sZW5ndGg7IGorKykgewogICAgICAgICAgaWYgKAogICAgICAgICAgLyogU2hhcmluZyBhIHZlcnRleCovCiAgICAgICAgICBwb2x5QS5pbmRleE9mKGh1bGxBLmZhY2VzW2ldW2pdKSAhPT0gLTEgJiYKICAgICAgICAgIC8qIE5vdCB0aGUgb25lIHdlIGFyZSBsb29raW5nIGZvciBjb25uZWN0aW9ucyBmcm9tICovCiAgICAgICAgICBpICE9PSBjbG9zZXN0RmFjZUEgJiYKICAgICAgICAgIC8qIE5vdCBhbHJlYWR5IGFkZGVkICovCiAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5pbmRleE9mKGkpID09PSAtMSkgewogICAgICAgICAgICBwb2x5QS5jb25uZWN0ZWRGYWNlcy5wdXNoKGkpOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSAvLyBDbGlwIHRoZSBwb2x5Z29uIHRvIHRoZSBiYWNrIG9mIHRoZSBwbGFuZXMgb2YgYWxsIGZhY2VzIG9mIGh1bGwgQSwKICAgICAgLy8gdGhhdCBhcmUgYWRqYWNlbnQgdG8gdGhlIHdpdG5lc3MgZmFjZQoKCiAgICAgIGNvbnN0IG51bVZlcnRpY2VzQSA9IHBvbHlBLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtVmVydGljZXNBOyBpKyspIHsKICAgICAgICBjb25zdCBhID0gaHVsbEEudmVydGljZXNbcG9seUFbaV1dOwogICAgICAgIGNvbnN0IGIgPSBodWxsQS52ZXJ0aWNlc1twb2x5QVsoaSArIDEpICUgbnVtVmVydGljZXNBXV07CiAgICAgICAgYS52c3ViKGIsIGVkZ2UwKTsKICAgICAgICBXb3JsZEVkZ2UwLmNvcHkoZWRnZTApOwogICAgICAgIHF1YXRBLnZtdWx0KFdvcmxkRWRnZTAsIFdvcmxkRWRnZTApOwogICAgICAgIHBvc0EudmFkZChXb3JsZEVkZ2UwLCBXb3JsZEVkZ2UwKTsKICAgICAgICB3b3JsZFBsYW5lQW5vcm1hbDEuY29weSh0aGlzLmZhY2VOb3JtYWxzW2Nsb3Nlc3RGYWNlQV0pOwogICAgICAgIHF1YXRBLnZtdWx0KHdvcmxkUGxhbmVBbm9ybWFsMSwgd29ybGRQbGFuZUFub3JtYWwxKTsKICAgICAgICBwb3NBLnZhZGQod29ybGRQbGFuZUFub3JtYWwxLCB3b3JsZFBsYW5lQW5vcm1hbDEpOwogICAgICAgIFdvcmxkRWRnZTAuY3Jvc3Mod29ybGRQbGFuZUFub3JtYWwxLCBwbGFuZU5vcm1hbFdTMSk7CiAgICAgICAgcGxhbmVOb3JtYWxXUzEubmVnYXRlKHBsYW5lTm9ybWFsV1MxKTsKICAgICAgICB3b3JsZEExLmNvcHkoYSk7CiAgICAgICAgcXVhdEEudm11bHQod29ybGRBMSwgd29ybGRBMSk7CiAgICAgICAgcG9zQS52YWRkKHdvcmxkQTEsIHdvcmxkQTEpOwogICAgICAgIGNvbnN0IG90aGVyRmFjZSA9IHBvbHlBLmNvbm5lY3RlZEZhY2VzW2ldOwogICAgICAgIGxvY2FsUGxhbmVOb3JtYWwuY29weSh0aGlzLmZhY2VOb3JtYWxzW290aGVyRmFjZV0pOwogICAgICAgIGNvbnN0IGxvY2FsUGxhbmVFcSA9IHRoaXMuZ2V0UGxhbmVDb25zdGFudE9mRmFjZShvdGhlckZhY2UpOwogICAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgICBxdWF0QS52bXVsdChwbGFuZU5vcm1hbFdTLCBwbGFuZU5vcm1hbFdTKTsKICAgICAgICBjb25zdCBwbGFuZUVxV1MgPSBsb2NhbFBsYW5lRXEgLSBwbGFuZU5vcm1hbFdTLmRvdChwb3NBKTsgLy8gQ2xpcCBmYWNlIGFnYWluc3Qgb3VyIGNvbnN0cnVjdGVkIHBsYW5lCgogICAgICAgIHRoaXMuY2xpcEZhY2VBZ2FpbnN0UGxhbmUocFZ0eEluLCBwVnR4T3V0LCBwbGFuZU5vcm1hbFdTLCBwbGFuZUVxV1MpOyAvLyBUaHJvdyBhd2F5IGFsbCBjbGlwcGVkIHBvaW50cywgYnV0IHNhdmUgdGhlIHJlbWFpbmluZyB1bnRpbCBuZXh0IGNsaXAKCiAgICAgICAgd2hpbGUgKHBWdHhJbi5sZW5ndGgpIHsKICAgICAgICAgIHBWdHhJbi5zaGlmdCgpOwogICAgICAgIH0KCiAgICAgICAgd2hpbGUgKHBWdHhPdXQubGVuZ3RoKSB7CiAgICAgICAgICBwVnR4SW4ucHVzaChwVnR4T3V0LnNoaWZ0KCkpOwogICAgICAgIH0KICAgICAgfSAvLyBvbmx5IGtlZXAgY29udGFjdCBwb2ludHMgdGhhdCBhcmUgYmVoaW5kIHRoZSB3aXRuZXNzIGZhY2UKCgogICAgICBsb2NhbFBsYW5lTm9ybWFsLmNvcHkodGhpcy5mYWNlTm9ybWFsc1tjbG9zZXN0RmFjZUFdKTsKICAgICAgY29uc3QgbG9jYWxQbGFuZUVxID0gdGhpcy5nZXRQbGFuZUNvbnN0YW50T2ZGYWNlKGNsb3Nlc3RGYWNlQSk7CiAgICAgIHBsYW5lTm9ybWFsV1MuY29weShsb2NhbFBsYW5lTm9ybWFsKTsKICAgICAgcXVhdEEudm11bHQocGxhbmVOb3JtYWxXUywgcGxhbmVOb3JtYWxXUyk7CiAgICAgIGNvbnN0IHBsYW5lRXFXUyA9IGxvY2FsUGxhbmVFcSAtIHBsYW5lTm9ybWFsV1MuZG90KHBvc0EpOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwVnR4SW4ubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgZGVwdGggPSBwbGFuZU5vcm1hbFdTLmRvdChwVnR4SW5baV0pICsgcGxhbmVFcVdTOyAvLyA/Pz8KCiAgICAgICAgaWYgKGRlcHRoIDw9IG1pbkRpc3QpIHsKICAgICAgICAgIGNvbnNvbGUubG9nKGBjbGFtcGVkOiBkZXB0aD0ke2RlcHRofSB0byBtaW5EaXN0PSR7bWluRGlzdH1gKTsKICAgICAgICAgIGRlcHRoID0gbWluRGlzdDsKICAgICAgICB9CgogICAgICAgIGlmIChkZXB0aCA8PSBtYXhEaXN0KSB7CiAgICAgICAgICBjb25zdCBwb2ludCA9IHBWdHhJbltpXTsKCiAgICAgICAgICBpZiAoZGVwdGggPD0gMWUtNikgewogICAgICAgICAgICBjb25zdCBwID0gewogICAgICAgICAgICAgIHBvaW50LAogICAgICAgICAgICAgIG5vcm1hbDogcGxhbmVOb3JtYWxXUywKICAgICAgICAgICAgICBkZXB0aAogICAgICAgICAgICB9OwogICAgICAgICAgICByZXN1bHQucHVzaChwKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2xpcCBhIGZhY2UgaW4gYSBodWxsIGFnYWluc3QgdGhlIGJhY2sgb2YgYSBwbGFuZS4KICAgICAqIEBwYXJhbSBwbGFuZUNvbnN0YW50IFRoZSBjb25zdGFudCBpbiB0aGUgbWF0aGVtYXRpY2FsIHBsYW5lIGVxdWF0aW9uCiAgICAgKi8KCgogICAgY2xpcEZhY2VBZ2FpbnN0UGxhbmUoaW5WZXJ0aWNlcywgb3V0VmVydGljZXMsIHBsYW5lTm9ybWFsLCBwbGFuZUNvbnN0YW50KSB7CiAgICAgIGxldCBuX2RvdF9maXJzdDsKICAgICAgbGV0IG5fZG90X2xhc3Q7CiAgICAgIGNvbnN0IG51bVZlcnRzID0gaW5WZXJ0aWNlcy5sZW5ndGg7CgogICAgICBpZiAobnVtVmVydHMgPCAyKSB7CiAgICAgICAgcmV0dXJuIG91dFZlcnRpY2VzOwogICAgICB9CgogICAgICBsZXQgZmlyc3RWZXJ0ZXggPSBpblZlcnRpY2VzW2luVmVydGljZXMubGVuZ3RoIC0gMV07CiAgICAgIGxldCBsYXN0VmVydGV4ID0gaW5WZXJ0aWNlc1swXTsKICAgICAgbl9kb3RfZmlyc3QgPSBwbGFuZU5vcm1hbC5kb3QoZmlyc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgIGZvciAobGV0IHZpID0gMDsgdmkgPCBudW1WZXJ0czsgdmkrKykgewogICAgICAgIGxhc3RWZXJ0ZXggPSBpblZlcnRpY2VzW3ZpXTsKICAgICAgICBuX2RvdF9sYXN0ID0gcGxhbmVOb3JtYWwuZG90KGxhc3RWZXJ0ZXgpICsgcGxhbmVDb25zdGFudDsKCiAgICAgICAgaWYgKG5fZG90X2ZpcnN0IDwgMCkgewogICAgICAgICAgaWYgKG5fZG90X2xhc3QgPCAwKSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kIDwgMCwgc28gb3V0cHV0IGxhc3RWZXJ0ZXgKICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIG5ld3YuY29weShsYXN0VmVydGV4KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIFN0YXJ0IDwgMCwgZW5kID49IDAsIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24KICAgICAgICAgICAgY29uc3QgbmV3diA9IG5ldyBWZWMzKCk7CiAgICAgICAgICAgIGZpcnN0VmVydGV4LmxlcnAobGFzdFZlcnRleCwgbl9kb3RfZmlyc3QgLyAobl9kb3RfZmlyc3QgLSBuX2RvdF9sYXN0KSwgbmV3dik7CiAgICAgICAgICAgIG91dFZlcnRpY2VzLnB1c2gobmV3dik7CiAgICAgICAgICB9CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGlmIChuX2RvdF9sYXN0IDwgMCkgewogICAgICAgICAgICAvLyBTdGFydCA+PSAwLCBlbmQgPCAwIHNvIG91dHB1dCBpbnRlcnNlY3Rpb24gYW5kIGVuZAogICAgICAgICAgICBjb25zdCBuZXd2ID0gbmV3IFZlYzMoKTsKICAgICAgICAgICAgZmlyc3RWZXJ0ZXgubGVycChsYXN0VmVydGV4LCBuX2RvdF9maXJzdCAvIChuX2RvdF9maXJzdCAtIG5fZG90X2xhc3QpLCBuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChuZXd2KTsKICAgICAgICAgICAgb3V0VmVydGljZXMucHVzaChsYXN0VmVydGV4KTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGZpcnN0VmVydGV4ID0gbGFzdFZlcnRleDsKICAgICAgICBuX2RvdF9maXJzdCA9IG5fZG90X2xhc3Q7CiAgICAgIH0KCiAgICAgIHJldHVybiBvdXRWZXJ0aWNlczsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgLndvcmxkVmVydGljZXNgIGFuZCBzZXRzIGAud29ybGRWZXJ0aWNlc05lZWRzVXBkYXRlYCB0byBmYWxzZS4KICAgICAqLwoKCiAgICBjb21wdXRlV29ybGRWZXJ0aWNlcyhwb3NpdGlvbiwgcXVhdCkgewogICAgICB3aGlsZSAodGhpcy53b3JsZFZlcnRpY2VzLmxlbmd0aCA8IHRoaXMudmVydGljZXMubGVuZ3RoKSB7CiAgICAgICAgdGhpcy53b3JsZFZlcnRpY2VzLnB1c2gobmV3IFZlYzMoKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKICAgICAgY29uc3Qgd29ybGRWZXJ0cyA9IHRoaXMud29ybGRWZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSB0aGlzLnZlcnRpY2VzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgcXVhdC52bXVsdCh2ZXJ0c1tpXSwgd29ybGRWZXJ0c1tpXSk7CiAgICAgICAgcG9zaXRpb24udmFkZCh3b3JsZFZlcnRzW2ldLCB3b3JsZFZlcnRzW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUgPSBmYWxzZTsKICAgIH0KCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmJtaW4sIGFhYmJtYXgpIHsKICAgICAgY29uc3QgdmVydGljZXMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBhYWJibWluLnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgYWFiYm1heC5zZXQoLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFLCAtTnVtYmVyLk1BWF9WQUxVRSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMudmVydGljZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydGljZXNbaV07CgogICAgICAgIGlmICh2LnggPCBhYWJibWluLngpIHsKICAgICAgICAgIGFhYmJtaW4ueCA9IHYueDsKICAgICAgICB9IGVsc2UgaWYgKHYueCA+IGFhYmJtYXgueCkgewogICAgICAgICAgYWFiYm1heC54ID0gdi54OwogICAgICAgIH0KCiAgICAgICAgaWYgKHYueSA8IGFhYmJtaW4ueSkgewogICAgICAgICAgYWFiYm1pbi55ID0gdi55OwogICAgICAgIH0gZWxzZSBpZiAodi55ID4gYWFiYm1heC55KSB7CiAgICAgICAgICBhYWJibWF4LnkgPSB2Lnk7CiAgICAgICAgfQoKICAgICAgICBpZiAodi56IDwgYWFiYm1pbi56KSB7CiAgICAgICAgICBhYWJibWluLnogPSB2Lno7CiAgICAgICAgfSBlbHNlIGlmICh2LnogPiBhYWJibWF4LnopIHsKICAgICAgICAgIGFhYmJtYXgueiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyBgd29ybGRWZXJ0aWNlc2AgYW5kIHNldHMgYHdvcmxkVmVydGljZXNOZWVkc1VwZGF0ZWAgdG8gZmFsc2UuCiAgICAgKi8KCgogICAgY29tcHV0ZVdvcmxkRmFjZU5vcm1hbHMocXVhdCkgewogICAgICBjb25zdCBOID0gdGhpcy5mYWNlTm9ybWFscy5sZW5ndGg7CgogICAgICB3aGlsZSAodGhpcy53b3JsZEZhY2VOb3JtYWxzLmxlbmd0aCA8IE4pIHsKICAgICAgICB0aGlzLndvcmxkRmFjZU5vcm1hbHMucHVzaChuZXcgVmVjMygpKTsKICAgICAgfQoKICAgICAgY29uc3Qgbm9ybWFscyA9IHRoaXMuZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFscyA9IHRoaXMud29ybGRGYWNlTm9ybWFsczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBxdWF0LnZtdWx0KG5vcm1hbHNbaV0sIHdvcmxkTm9ybWFsc1tpXSk7CiAgICAgIH0KCiAgICAgIHRoaXMud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBub3JtMiA9IHZlcnRzW2ldLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgICAgaWYgKG5vcm0yID4gbWF4MikgewogICAgICAgICAgbWF4MiA9IG5vcm0yOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE1hdGguc3FydChtYXgyKTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlV29ybGRBQUJCCiAgICAgKi8KCgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBsZXQgbWlueDsKICAgICAgbGV0IG1pbnk7CiAgICAgIGxldCBtaW56OwogICAgICBsZXQgbWF4eDsKICAgICAgbGV0IG1heHk7CiAgICAgIGxldCBtYXh6OwogICAgICBsZXQgdGVtcFdvcmxkVmVydGV4ID0gbmV3IFZlYzMoKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0ZW1wV29ybGRWZXJ0ZXguY29weSh2ZXJ0c1tpXSk7CiAgICAgICAgcXVhdC52bXVsdCh0ZW1wV29ybGRWZXJ0ZXgsIHRlbXBXb3JsZFZlcnRleCk7CiAgICAgICAgcG9zLnZhZGQodGVtcFdvcmxkVmVydGV4LCB0ZW1wV29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnN0IHYgPSB0ZW1wV29ybGRWZXJ0ZXg7CgogICAgICAgIGlmIChtaW54ID09PSB1bmRlZmluZWQgfHwgdi54IDwgbWlueCkgewogICAgICAgICAgbWlueCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh4ID09PSB1bmRlZmluZWQgfHwgdi54ID4gbWF4eCkgewogICAgICAgICAgbWF4eCA9IHYueDsKICAgICAgICB9CgogICAgICAgIGlmIChtaW55ID09PSB1bmRlZmluZWQgfHwgdi55IDwgbWlueSkgewogICAgICAgICAgbWlueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh5ID09PSB1bmRlZmluZWQgfHwgdi55ID4gbWF4eSkgewogICAgICAgICAgbWF4eSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmIChtaW56ID09PSB1bmRlZmluZWQgfHwgdi56IDwgbWlueikgewogICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICB9CgogICAgICAgIGlmIChtYXh6ID09PSB1bmRlZmluZWQgfHwgdi56ID4gbWF4eikgewogICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIG1pbi5zZXQobWlueCwgbWlueSwgbWlueik7CiAgICAgIG1heC5zZXQobWF4eCwgbWF4eSwgbWF4eik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSBjb252ZXggdm9sdW1lCiAgICAgKi8KCgogICAgdm9sdW1lKCkgewogICAgICByZXR1cm4gNC4wICogTWF0aC5QSSAqIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgLyAzLjA7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBhdmVyYWdlIG9mIGFsbCB0aGUgdmVydGljZXMgcG9zaXRpb25zCiAgICAgKi8KCgogICAgZ2V0QXZlcmFnZVBvaW50TG9jYWwodGFyZ2V0KSB7CiAgICAgIGlmICh0YXJnZXQgPT09IHZvaWQgMCkgewogICAgICAgIHRhcmdldCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICB0YXJnZXQudmFkZCh2ZXJ0c1tpXSwgdGFyZ2V0KTsKICAgICAgfQoKICAgICAgdGFyZ2V0LnNjYWxlKDEgLyB2ZXJ0cy5sZW5ndGgsIHRhcmdldCk7CiAgICAgIHJldHVybiB0YXJnZXQ7CiAgICB9CiAgICAvKioKICAgICAqIFRyYW5zZm9ybSBhbGwgbG9jYWwgcG9pbnRzLiBXaWxsIGNoYW5nZSB0aGUgLnZlcnRpY2VzCiAgICAgKi8KCgogICAgdHJhbnNmb3JtQWxsUG9pbnRzKG9mZnNldCwgcXVhdCkgewogICAgICBjb25zdCBuID0gdGhpcy52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IHZlcnRzID0gdGhpcy52ZXJ0aWNlczsgLy8gQXBwbHkgcm90YXRpb24KCiAgICAgIGlmIChxdWF0KSB7CiAgICAgICAgLy8gUm90YXRlIHZlcnRpY2VzCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBuOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsKICAgICAgICAgIHF1YXQudm11bHQodiwgdik7CiAgICAgICAgfSAvLyBSb3RhdGUgZmFjZSBub3JtYWxzCgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZU5vcm1hbHMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHYgPSB0aGlzLmZhY2VOb3JtYWxzW2ldOwogICAgICAgICAgcXVhdC52bXVsdCh2LCB2KTsKICAgICAgICB9CiAgICAgICAgLyoKICAgICAgICAgICAgICAvLyBSb3RhdGUgZWRnZXMKICAgICAgICAgICAgICBmb3IobGV0IGk9MDsgaTx0aGlzLnVuaXF1ZUVkZ2VzLmxlbmd0aDsgaSsrKXsKICAgICAgICAgICAgICAgICAgY29uc3QgdiA9IHRoaXMudW5pcXVlRWRnZXNbaV07CiAgICAgICAgICAgICAgICAgIHF1YXQudm11bHQodix2KTsKICAgICAgICAgICAgICB9Ki8KCiAgICAgIH0gLy8gQXBwbHkgb2Zmc2V0CgoKICAgICAgaWYgKG9mZnNldCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbjsgaSsrKSB7CiAgICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07CiAgICAgICAgICB2LnZhZGQob2Zmc2V0LCB2KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2tzIHdoZXRoZXIgcCBpcyBpbnNpZGUgdGhlIHBvbHloZWRyYS4gTXVzdCBiZSBpbiBsb2NhbCBjb29yZHMuCiAgICAgKiBUaGUgcG9pbnQgbGllcyBvdXRzaWRlIG9mIHRoZSBjb252ZXggaHVsbCBvZiB0aGUgb3RoZXIgcG9pbnRzIGlmIGFuZCBvbmx5IGlmIHRoZSBkaXJlY3Rpb24KICAgICAqIG9mIGFsbCB0aGUgdmVjdG9ycyBmcm9tIGl0IHRvIHRob3NlIG90aGVyIHBvaW50cyBhcmUgb24gbGVzcyB0aGFuIG9uZSBoYWxmIG9mIGEgc3BoZXJlIGFyb3VuZCBpdC4KICAgICAqIEBwYXJhbSBwIEEgcG9pbnQgZ2l2ZW4gaW4gbG9jYWwgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBwb2ludElzSW5zaWRlKHApIHsKICAgICAgY29uc3QgdmVydHMgPSB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCBmYWNlcyA9IHRoaXMuZmFjZXM7CiAgICAgIGNvbnN0IG5vcm1hbHMgPSB0aGlzLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBwb3NpdGl2ZVJlc3VsdCA9IG51bGw7CiAgICAgIGNvbnN0IHBvaW50SW5zaWRlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5nZXRBdmVyYWdlUG9pbnRMb2NhbChwb2ludEluc2lkZSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZmFjZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgbiA9IG5vcm1hbHNbaV07CiAgICAgICAgY29uc3QgdiA9IHZlcnRzW2ZhY2VzW2ldWzBdXTsgLy8gV2Ugb25seSBuZWVkIG9uZSBwb2ludCBpbiB0aGUgZmFjZQogICAgICAgIC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgICBjb25zdCB2VG9QID0gbmV3IFZlYzMoKTsKICAgICAgICBwLnZzdWIodiwgdlRvUCk7CiAgICAgICAgY29uc3QgcjEgPSBuLmRvdCh2VG9QKTsKICAgICAgICBjb25zdCB2VG9Qb2ludEluc2lkZSA9IG5ldyBWZWMzKCk7CiAgICAgICAgcG9pbnRJbnNpZGUudnN1Yih2LCB2VG9Qb2ludEluc2lkZSk7CiAgICAgICAgY29uc3QgcjIgPSBuLmRvdCh2VG9Qb2ludEluc2lkZSk7CgogICAgICAgIGlmIChyMSA8IDAgJiYgcjIgPiAwIHx8IHIxID4gMCAmJiByMiA8IDApIHsKICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gRW5jb3VudGVyZWQgc29tZSBvdGhlciBzaWduLiBFeGl0LgogICAgICAgIH0KICAgICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgICAgcmV0dXJuIHBvc2l0aXZlUmVzdWx0ID8gMSA6IC0xOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgbWF4IGFuZCBtaW4gZG90IHByb2R1Y3Qgb2YgYSBjb252ZXggaHVsbCBhdCBwb3NpdGlvbiAocG9zLHF1YXQpIHByb2plY3RlZCBvbnRvIGFuIGF4aXMuCiAgICAgKiBSZXN1bHRzIGFyZSBzYXZlZCBpbiB0aGUgYXJyYXkgbWF4bWluLgogICAgICogQHBhcmFtIHJlc3VsdCByZXN1bHRbMF0gYW5kIHJlc3VsdFsxXSB3aWxsIGJlIHNldCB0byBtYXhpbXVtIGFuZCBtaW5pbXVtLCByZXNwZWN0aXZlbHkuCiAgICAgKi8KCgogICAgc3RhdGljIHByb2plY3Qoc2hhcGUsIGF4aXMsIHBvcywgcXVhdCwgcmVzdWx0KSB7CiAgICAgIGNvbnN0IG4gPSBzaGFwZS52ZXJ0aWNlcy5sZW5ndGg7CiAgICAgIGNvbnN0IGxvY2FsQXhpcyA9IHByb2plY3RfbG9jYWxBeGlzOwogICAgICBsZXQgbWF4ID0gMDsKICAgICAgbGV0IG1pbiA9IDA7CiAgICAgIGNvbnN0IGxvY2FsT3JpZ2luID0gcHJvamVjdF9sb2NhbE9yaWdpbjsKICAgICAgY29uc3QgdnMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgbG9jYWxPcmlnaW4uc2V0WmVybygpOyAvLyBUcmFuc2Zvcm0gdGhlIGF4aXMgdG8gbG9jYWwKCiAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBheGlzLCBsb2NhbEF4aXMpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zLCBxdWF0LCBsb2NhbE9yaWdpbiwgbG9jYWxPcmlnaW4pOwogICAgICBjb25zdCBhZGQgPSBsb2NhbE9yaWdpbi5kb3QobG9jYWxBeGlzKTsKICAgICAgbWluID0gbWF4ID0gdnNbMF0uZG90KGxvY2FsQXhpcyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IG47IGkrKykgewogICAgICAgIGNvbnN0IHZhbCA9IHZzW2ldLmRvdChsb2NhbEF4aXMpOwoKICAgICAgICBpZiAodmFsID4gbWF4KSB7CiAgICAgICAgICBtYXggPSB2YWw7CiAgICAgICAgfQoKICAgICAgICBpZiAodmFsIDwgbWluKSB7CiAgICAgICAgICBtaW4gPSB2YWw7CiAgICAgICAgfQogICAgICB9CgogICAgICBtaW4gLT0gYWRkOwogICAgICBtYXggLT0gYWRkOwoKICAgICAgaWYgKG1pbiA+IG1heCkgewogICAgICAgIC8vIEluY29uc2lzdGVudCAtIHN3YXAKICAgICAgICBjb25zdCB0ZW1wID0gbWluOwogICAgICAgIG1pbiA9IG1heDsKICAgICAgICBtYXggPSB0ZW1wOwogICAgICB9IC8vIE91dHB1dAoKCiAgICAgIHJlc3VsdFswXSA9IG1heDsKICAgICAgcmVzdWx0WzFdID0gbWluOwogICAgfQoKICB9CiAgY29uc3QgbWF4bWluQSA9IFtdOwogIGNvbnN0IG1heG1pbkIgPSBbXTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHByb2plY3RfbG9jYWxBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBwcm9qZWN0X2xvY2FsT3JpZ2luID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSAzZCBib3ggc2hhcGUuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc2l6ZSA9IDEKICAgKiAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBuZXcgQ0FOTk9OLlZlYzMoc2l6ZSwgc2l6ZSwgc2l6ZSkKICAgKiAgICAgY29uc3QgYm94U2hhcGUgPSBuZXcgQ0FOTk9OLkJveChoYWxmRXh0ZW50cykKICAgKiAgICAgY29uc3QgYm94Qm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBib3hTaGFwZSB9KQogICAqICAgICB3b3JsZC5hZGRCb2R5KGJveEJvZHkpCiAgICovCiAgY2xhc3MgQm94IGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBUaGUgaGFsZiBleHRlbnRzIG9mIHRoZSBib3guCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgYnkgdGhlIGNvbnRhY3QgZ2VuZXJhdG9yIHRvIG1ha2UgY29udGFjdHMgd2l0aCBvdGhlciBjb252ZXggcG9seWhlZHJhIGZvciBleGFtcGxlLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihoYWxmRXh0ZW50cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuQk9YCiAgICAgIH0pOwogICAgICB0aGlzLmhhbGZFeHRlbnRzID0gaGFsZkV4dGVudHM7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gbnVsbDsKICAgICAgdGhpcy51cGRhdGVDb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24oKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSBsb2NhbCBjb252ZXggcG9seWhlZHJvbiByZXByZXNlbnRhdGlvbiB1c2VkIGZvciBzb21lIGNvbGxpc2lvbnMuCiAgICAgKi8KCgogICAgdXBkYXRlQ29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uKCkgewogICAgICBjb25zdCBzeCA9IHRoaXMuaGFsZkV4dGVudHMueDsKICAgICAgY29uc3Qgc3kgPSB0aGlzLmhhbGZFeHRlbnRzLnk7CiAgICAgIGNvbnN0IHN6ID0gdGhpcy5oYWxmRXh0ZW50cy56OwogICAgICBjb25zdCBWID0gVmVjMzsKICAgICAgY29uc3QgdmVydGljZXMgPSBbbmV3IFYoLXN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCAtc3ksIC1zeiksIG5ldyBWKHN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCBzeSwgLXN6KSwgbmV3IFYoLXN4LCAtc3ksIHN6KSwgbmV3IFYoc3gsIC1zeSwgc3opLCBuZXcgVihzeCwgc3ksIHN6KSwgbmV3IFYoLXN4LCBzeSwgc3opXTsKICAgICAgY29uc3QgZmFjZXMgPSBbWzMsIDIsIDEsIDBdLCAvLyAtegogICAgICBbNCwgNSwgNiwgN10sIC8vICt6CiAgICAgIFs1LCA0LCAwLCAxXSwgLy8gLXkKICAgICAgWzIsIDMsIDcsIDZdLCAvLyAreQogICAgICBbMCwgNCwgNywgM10sIC8vIC14CiAgICAgIFsxLCAyLCA2LCA1XSAvLyAreAogICAgICBdOwogICAgICBjb25zdCBheGVzID0gW25ldyBWKDAsIDAsIDEpLCBuZXcgVigwLCAxLCAwKSwgbmV3IFYoMSwgMCwgMCldOwogICAgICBjb25zdCBoID0gbmV3IENvbnZleFBvbHloZWRyb24oewogICAgICAgIHZlcnRpY2VzLAogICAgICAgIGZhY2VzLAogICAgICAgIGF4ZXMKICAgICAgfSk7CiAgICAgIHRoaXMuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uID0gaDsKICAgICAgaC5tYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CiAgICB9CiAgICAvKioKICAgICAqIENhbGN1bGF0ZSB0aGUgaW5lcnRpYSBvZiB0aGUgYm94LgogICAgICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgQm94LmNhbGN1bGF0ZUluZXJ0aWEodGhpcy5oYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KTsKICAgICAgcmV0dXJuIHRhcmdldDsKICAgIH0KCiAgICBzdGF0aWMgY2FsY3VsYXRlSW5lcnRpYShoYWxmRXh0ZW50cywgbWFzcywgdGFyZ2V0KSB7CiAgICAgIGNvbnN0IGUgPSBoYWxmRXh0ZW50czsKICAgICAgdGFyZ2V0LnggPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnkgPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS54ICogMiAqIGUueCArIDIgKiBlLnogKiAyICogZS56KTsKICAgICAgdGFyZ2V0LnogPSAxLjAgLyAxMi4wICogbWFzcyAqICgyICogZS55ICogMiAqIGUueSArIDIgKiBlLnggKiAyICogZS54KTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBib3ggNiBzaWRlIG5vcm1hbHMKICAgICAqIEBwYXJhbSBzaXhUYXJnZXRWZWN0b3JzIEFuIGFycmF5IG9mIDYgdmVjdG9ycywgdG8gc3RvcmUgdGhlIHJlc3VsdGluZyBzaWRlIG5vcm1hbHMgaW4uCiAgICAgKiBAcGFyYW0gcXVhdCBPcmllbnRhdGlvbiB0byBhcHBseSB0byB0aGUgbm9ybWFsIHZlY3RvcnMuIElmIG5vdCBwcm92aWRlZCwgdGhlIHZlY3RvcnMgd2lsbCBiZSBpbiByZXNwZWN0IHRvIHRoZSBsb2NhbCBmcmFtZS4KICAgICAqLwoKCiAgICBnZXRTaWRlTm9ybWFscyhzaXhUYXJnZXRWZWN0b3JzLCBxdWF0KSB7CiAgICAgIGNvbnN0IHNpZGVzID0gc2l4VGFyZ2V0VmVjdG9yczsKICAgICAgY29uc3QgZXggPSB0aGlzLmhhbGZFeHRlbnRzOwogICAgICBzaWRlc1swXS5zZXQoZXgueCwgMCwgMCk7CiAgICAgIHNpZGVzWzFdLnNldCgwLCBleC55LCAwKTsKICAgICAgc2lkZXNbMl0uc2V0KDAsIDAsIGV4LnopOwogICAgICBzaWRlc1szXS5zZXQoLWV4LngsIDAsIDApOwogICAgICBzaWRlc1s0XS5zZXQoMCwgLWV4LnksIDApOwogICAgICBzaWRlc1s1XS5zZXQoMCwgMCwgLWV4LnopOwoKICAgICAgaWYgKHF1YXQgIT09IHVuZGVmaW5lZCkgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBzaWRlcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgcXVhdC52bXVsdChzaWRlc1tpXSwgc2lkZXNbaV0pOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHNpZGVzOwogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIHRoZSB2b2x1bWUgb2YgdGhlIGJveC4KICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA4LjAgKiB0aGlzLmhhbGZFeHRlbnRzLnggKiB0aGlzLmhhbGZFeHRlbnRzLnkgKiB0aGlzLmhhbGZFeHRlbnRzLno7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSB0aGlzLmhhbGZFeHRlbnRzLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBmb3JFYWNoV29ybGRDb3JuZXIKICAgICAqLwoKCiAgICBmb3JFYWNoV29ybGRDb3JuZXIocG9zLCBxdWF0LCBjYWxsYmFjaykgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgY29uc3QgY29ybmVycyA9IFtbZS54LCBlLnksIGUuel0sIFstZS54LCBlLnksIGUuel0sIFstZS54LCAtZS55LCBlLnpdLCBbLWUueCwgLWUueSwgLWUuel0sIFtlLngsIC1lLnksIC1lLnpdLCBbZS54LCBlLnksIC1lLnpdLCBbLWUueCwgZS55LCAtZS56XSwgW2UueCwgLWUueSwgZS56XV07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvcm5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICB3b3JsZENvcm5lclRlbXBQb3Muc2V0KGNvcm5lcnNbaV1bMF0sIGNvcm5lcnNbaV1bMV0sIGNvcm5lcnNbaV1bMl0pOwogICAgICAgIHF1YXQudm11bHQod29ybGRDb3JuZXJUZW1wUG9zLCB3b3JsZENvcm5lclRlbXBQb3MpOwogICAgICAgIHBvcy52YWRkKHdvcmxkQ29ybmVyVGVtcFBvcywgd29ybGRDb3JuZXJUZW1wUG9zKTsKICAgICAgICBjYWxsYmFjayh3b3JsZENvcm5lclRlbXBQb3MueCwgd29ybGRDb3JuZXJUZW1wUG9zLnksIHdvcmxkQ29ybmVyVGVtcFBvcy56KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICBjb25zdCBlID0gdGhpcy5oYWxmRXh0ZW50czsKICAgICAgd29ybGRDb3JuZXJzVGVtcFswXS5zZXQoZS54LCBlLnksIGUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbMV0uc2V0KC1lLngsIGUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFsyXS5zZXQoLWUueCwgLWUueSwgZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFszXS5zZXQoLWUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNF0uc2V0KGUueCwgLWUueSwgLWUueik7CiAgICAgIHdvcmxkQ29ybmVyc1RlbXBbNV0uc2V0KGUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs2XS5zZXQoLWUueCwgZS55LCAtZS56KTsKICAgICAgd29ybGRDb3JuZXJzVGVtcFs3XS5zZXQoZS54LCAtZS55LCBlLnopOwogICAgICBjb25zdCB3YyA9IHdvcmxkQ29ybmVyc1RlbXBbMF07CiAgICAgIHF1YXQudm11bHQod2MsIHdjKTsKICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgbWF4LmNvcHkod2MpOwogICAgICBtaW4uY29weSh3Yyk7CgogICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDg7IGkrKykgewogICAgICAgIGNvbnN0IHdjID0gd29ybGRDb3JuZXJzVGVtcFtpXTsKICAgICAgICBxdWF0LnZtdWx0KHdjLCB3Yyk7CiAgICAgICAgcG9zLnZhZGQod2MsIHdjKTsKICAgICAgICBjb25zdCB4ID0gd2MueDsKICAgICAgICBjb25zdCB5ID0gd2MueTsKICAgICAgICBjb25zdCB6ID0gd2MuejsKCiAgICAgICAgaWYgKHggPiBtYXgueCkgewogICAgICAgICAgbWF4LnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPiBtYXgueSkgewogICAgICAgICAgbWF4LnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPiBtYXgueikgewogICAgICAgICAgbWF4LnogPSB6OwogICAgICAgIH0KCiAgICAgICAgaWYgKHggPCBtaW4ueCkgewogICAgICAgICAgbWluLnggPSB4OwogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCBtaW4ueSkgewogICAgICAgICAgbWluLnkgPSB5OwogICAgICAgIH0KCiAgICAgICAgaWYgKHogPCBtaW4ueikgewogICAgICAgICAgbWluLnogPSB6OwogICAgICAgIH0KICAgICAgfSAvLyBHZXQgZWFjaCBheGlzIG1heAogICAgICAvLyBtaW4uc2V0KEluZmluaXR5LEluZmluaXR5LEluZmluaXR5KTsKICAgICAgLy8gbWF4LnNldCgtSW5maW5pdHksLUluZmluaXR5LC1JbmZpbml0eSk7CiAgICAgIC8vIHRoaXMuZm9yRWFjaFdvcmxkQ29ybmVyKHBvcyxxdWF0LGZ1bmN0aW9uKHgseSx6KXsKICAgICAgLy8gICAgIGlmKHggPiBtYXgueCl7CiAgICAgIC8vICAgICAgICAgbWF4LnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA+IG1heC55KXsKICAgICAgLy8gICAgICAgICBtYXgueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6ID4gbWF4LnopewogICAgICAvLyAgICAgICAgIG1heC56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gICAgIGlmKHggPCBtaW4ueCl7CiAgICAgIC8vICAgICAgICAgbWluLnggPSB4OwogICAgICAvLyAgICAgfQogICAgICAvLyAgICAgaWYoeSA8IG1pbi55KXsKICAgICAgLy8gICAgICAgICBtaW4ueSA9IHk7CiAgICAgIC8vICAgICB9CiAgICAgIC8vICAgICBpZih6IDwgbWluLnopewogICAgICAvLyAgICAgICAgIG1pbi56ID0gejsKICAgICAgLy8gICAgIH0KICAgICAgLy8gfSk7CgogICAgfQoKICB9CiAgY29uc3Qgd29ybGRDb3JuZXJUZW1wUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCB3b3JsZENvcm5lcnNUZW1wID0gW25ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCksIG5ldyBWZWMzKCldOwoKICAvKioKICAgKiBCT0RZX1RZUEVTCiAgICovCiAgY29uc3QgQk9EWV9UWVBFUyA9IHsKICAgIC8qKiBEWU5BTUlDICovCiAgICBEWU5BTUlDOiAxLAoKICAgIC8qKiBTVEFUSUMgKi8KICAgIFNUQVRJQzogMiwKCiAgICAvKiogS0lORU1BVElDICovCiAgICBLSU5FTUFUSUM6IDQKICB9OwogIC8qKgogICAqIEJvZHlUeXBlCiAgICovCgogIC8qKgogICAqIEJPRFlfU0xFRVBfU1RBVEVTCiAgICovCiAgY29uc3QgQk9EWV9TTEVFUF9TVEFURVMgPSB7CiAgICAvKiogQVdBS0UgKi8KICAgIEFXQUtFOiAwLAoKICAgIC8qKiBTTEVFUFkgKi8KICAgIFNMRUVQWTogMSwKCiAgICAvKiogU0xFRVBJTkcgKi8KICAgIFNMRUVQSU5HOiAyCiAgfTsKICAvKioKICAgKiBCb2R5U2xlZXBTdGF0ZQogICAqLwoKICAvKioKICAgKiBCYXNlIGNsYXNzIGZvciBhbGwgYm9keSB0eXBlcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBzaGFwZSA9IG5ldyBDQU5OT04uU3BoZXJlKDEpCiAgICogICAgIGNvbnN0IGJvZHkgPSBuZXcgQ0FOTk9OLkJvZHkoewogICAqICAgICAgIG1hc3M6IDEsCiAgICogICAgICAgc2hhcGUsCiAgICogICAgIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keSkKICAgKi8KICBjbGFzcyBCb2R5IGV4dGVuZHMgRXZlbnRUYXJnZXQgewogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIHR3byBib2RpZXMgY29sbGlkZS4gVGhpcyBldmVudCBpcyBkaXNwYXRjaGVkIG9uIGVhY2gKICAgICAqIG9mIHRoZSB0d28gYm9kaWVzIGludm9sdmVkIGluIHRoZSBjb2xsaXNpb24uCiAgICAgKiBAZXZlbnQgY29sbGlkZQogICAgICogQHBhcmFtIGJvZHkgVGhlIGJvZHkgdGhhdCB3YXMgaW52b2x2ZWQgaW4gdGhlIGNvbGxpc2lvbi4KICAgICAqIEBwYXJhbSBjb250YWN0IFRoZSBkZXRhaWxzIG9mIHRoZSBjb2xsaXNpb24uCiAgICAgKi8KCiAgICAvKioKICAgICAqIEEgZHluYW1pYyBib2R5IGlzIGZ1bGx5IHNpbXVsYXRlZC4gQ2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHRoZSB1c2VyLCBidXQgbm9ybWFsbHkgdGhleSBtb3ZlIGFjY29yZGluZyB0byBmb3JjZXMuIEEgZHluYW1pYyBib2R5IGNhbiBjb2xsaWRlIHdpdGggYWxsIGJvZHkgdHlwZXMuIEEgZHluYW1pYyBib2R5IGFsd2F5cyBoYXMgZmluaXRlLCBub24temVybyBtYXNzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIHN0YXRpYyBib2R5IGRvZXMgbm90IG1vdmUgZHVyaW5nIHNpbXVsYXRpb24gYW5kIGJlaGF2ZXMgYXMgaWYgaXQgaGFzIGluZmluaXRlIG1hc3MuIFN0YXRpYyBib2RpZXMgY2FuIGJlIG1vdmVkIG1hbnVhbGx5IGJ5IHNldHRpbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSBib2R5LiBUaGUgdmVsb2NpdHkgb2YgYSBzdGF0aWMgYm9keSBpcyBhbHdheXMgemVyby4gU3RhdGljIGJvZGllcyBkbyBub3QgY29sbGlkZSB3aXRoIG90aGVyIHN0YXRpYyBvciBraW5lbWF0aWMgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBBIGtpbmVtYXRpYyBib2R5IG1vdmVzIHVuZGVyIHNpbXVsYXRpb24gYWNjb3JkaW5nIHRvIGl0cyB2ZWxvY2l0eS4gVGhleSBkbyBub3QgcmVzcG9uZCB0byBmb3JjZXMuIFRoZXkgY2FuIGJlIG1vdmVkIG1hbnVhbGx5LCBidXQgbm9ybWFsbHkgYSBraW5lbWF0aWMgYm9keSBpcyBtb3ZlZCBieSBzZXR0aW5nIGl0cyB2ZWxvY2l0eS4gQSBraW5lbWF0aWMgYm9keSBiZWhhdmVzIGFzIGlmIGl0IGhhcyBpbmZpbml0ZSBtYXNzLiBLaW5lbWF0aWMgYm9kaWVzIGRvIG5vdCBjb2xsaWRlIHdpdGggb3RoZXIgc3RhdGljIG9yIGtpbmVtYXRpYyBib2RpZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFXQUtFCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNMRUVQWQogICAgICovCgogICAgLyoqCiAgICAgKiBTTEVFUElORwogICAgICovCgogICAgLyoqCiAgICAgKiBEaXNwYXRjaGVkIGFmdGVyIGEgc2xlZXBpbmcgYm9keSBoYXMgd29rZW4gdXAuCiAgICAgKiBAZXZlbnQgd2FrZXVwCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBnb25lIGluIHRvIHRoZSBzbGVlcHkgc3RhdGUuCiAgICAgKiBAZXZlbnQgc2xlZXB5CiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBmYWxsZW4gYXNsZWVwLgogICAgICogQGV2ZW50IHNsZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pZCA9IEJvZHkuaWRDb3VudGVyKys7CiAgICAgIHRoaXMuaW5kZXggPSAtMTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudmxhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrID0gdHlwZW9mIG9wdGlvbnMuY29sbGlzaW9uRmlsdGVyTWFzayA9PT0gJ251bWJlcicgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgOiAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlID09PSAnYm9vbGVhbicgPyBvcHRpb25zLmNvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKICAgICAgdGhpcy5wb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucHJldmlvdXNQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaW50ZXJwb2xhdGVkUG9zaXRpb24gPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmluaXRQb3NpdGlvbiA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5wb3NpdGlvbikgewogICAgICAgIHRoaXMucG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLnByZXZpb3VzUG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFBvc2l0aW9uLmNvcHkob3B0aW9ucy5wb3NpdGlvbik7CiAgICAgICAgdGhpcy5pbml0UG9zaXRpb24uY29weShvcHRpb25zLnBvc2l0aW9uKTsKICAgICAgfQoKICAgICAgdGhpcy52ZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy52ZWxvY2l0eSkgewogICAgICAgIHRoaXMudmVsb2NpdHkuY29weShvcHRpb25zLnZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0VmVsb2NpdHkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmZvcmNlID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgbWFzcyA9IHR5cGVvZiBvcHRpb25zLm1hc3MgPT09ICdudW1iZXInID8gb3B0aW9ucy5tYXNzIDogMDsKICAgICAgdGhpcy5tYXNzID0gbWFzczsKICAgICAgdGhpcy5pbnZNYXNzID0gbWFzcyA+IDAgPyAxLjAgLyBtYXNzIDogMDsKICAgICAgdGhpcy5tYXRlcmlhbCA9IG9wdGlvbnMubWF0ZXJpYWwgfHwgbnVsbDsKICAgICAgdGhpcy5saW5lYXJEYW1waW5nID0gdHlwZW9mIG9wdGlvbnMubGluZWFyRGFtcGluZyA9PT0gJ251bWJlcicgPyBvcHRpb25zLmxpbmVhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLnR5cGUgPSBtYXNzIDw9IDAuMCA/IEJvZHkuU1RBVElDIDogQm9keS5EWU5BTUlDOwoKICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLnR5cGUgPT09IHR5cGVvZiBCb2R5LlNUQVRJQykgewogICAgICAgIHRoaXMudHlwZSA9IG9wdGlvbnMudHlwZTsKICAgICAgfQoKICAgICAgdGhpcy5hbGxvd1NsZWVwID0gdHlwZW9mIG9wdGlvbnMuYWxsb3dTbGVlcCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFsbG93U2xlZXAgOiB0cnVlOwogICAgICB0aGlzLnNsZWVwU3RhdGUgPSBCb2R5LkFXQUtFOwogICAgICB0aGlzLnNsZWVwU3BlZWRMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLnNsZWVwU3BlZWRMaW1pdCA6IDAuMTsKICAgICAgdGhpcy5zbGVlcFRpbWVMaW1pdCA9IHR5cGVvZiBvcHRpb25zLnNsZWVwVGltZUxpbWl0ICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuc2xlZXBUaW1lTGltaXQgOiAxOwogICAgICB0aGlzLnRpbWVMYXN0U2xlZXB5ID0gMDsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICAgIHRoaXMudG9ycXVlID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbml0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgdGhpcy5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgICAgIGlmIChvcHRpb25zLnF1YXRlcm5pb24pIHsKICAgICAgICB0aGlzLnF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMuaW5pdFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkob3B0aW9ucy5xdWF0ZXJuaW9uKTsKICAgICAgICB0aGlzLmludGVycG9sYXRlZFF1YXRlcm5pb24uY29weShvcHRpb25zLnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWMzKCk7CgogICAgICBpZiAob3B0aW9ucy5hbmd1bGFyVmVsb2NpdHkpIHsKICAgICAgICB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5jb3B5KG9wdGlvbnMuYW5ndWxhclZlbG9jaXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5pbml0QW5ndWxhclZlbG9jaXR5ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5zaGFwZXMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMgPSBbXTsKICAgICAgdGhpcy5zaGFwZU9yaWVudGF0aW9ucyA9IFtdOwogICAgICB0aGlzLmluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWEgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZCA9IG5ldyBNYXQzKCk7CiAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gMDsKICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlID0gbmV3IE1hdDMoKTsKICAgICAgdGhpcy5maXhlZFJvdGF0aW9uID0gdHlwZW9mIG9wdGlvbnMuZml4ZWRSb3RhdGlvbiAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmZpeGVkUm90YXRpb24gOiBmYWxzZTsKICAgICAgdGhpcy5hbmd1bGFyRGFtcGluZyA9IHR5cGVvZiBvcHRpb25zLmFuZ3VsYXJEYW1waW5nICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuYW5ndWxhckRhbXBpbmcgOiAwLjAxOwogICAgICB0aGlzLmxpbmVhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMubGluZWFyRmFjdG9yKSB7CiAgICAgICAgdGhpcy5saW5lYXJGYWN0b3IuY29weShvcHRpb25zLmxpbmVhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYW5ndWxhckZhY3RvciA9IG5ldyBWZWMzKDEsIDEsIDEpOwoKICAgICAgaWYgKG9wdGlvbnMuYW5ndWxhckZhY3RvcikgewogICAgICAgIHRoaXMuYW5ndWxhckZhY3Rvci5jb3B5KG9wdGlvbnMuYW5ndWxhckZhY3Rvcik7CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1JhZGl1cyA9IDA7CiAgICAgIHRoaXMud2xhbWJkYSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaXNUcmlnZ2VyID0gQm9vbGVhbihvcHRpb25zLmlzVHJpZ2dlcik7CgogICAgICBpZiAob3B0aW9ucy5zaGFwZSkgewogICAgICAgIHRoaXMuYWRkU2hhcGUob3B0aW9ucy5zaGFwZSk7CiAgICAgIH0KCiAgICAgIHRoaXMudXBkYXRlTWFzc1Byb3BlcnRpZXMoKTsKICAgIH0KICAgIC8qKgogICAgICogV2FrZSB0aGUgYm9keSB1cC4KICAgICAqLwoKCiAgICB3YWtlVXAoKSB7CiAgICAgIGNvbnN0IHByZXZTdGF0ZSA9IHRoaXMuc2xlZXBTdGF0ZTsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5BV0FLRTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CgogICAgICBpZiAocHJldlN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkud2FrZXVwRXZlbnQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEZvcmNlIGJvZHkgc2xlZXAKICAgICAqLwoKCiAgICBzbGVlcCgpIHsKICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUElORzsKICAgICAgdGhpcy52ZWxvY2l0eS5zZXQoMCwgMCwgMCk7CiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnNldCgwLCAwLCAwKTsKICAgICAgdGhpcy53YWtlVXBBZnRlck5hcnJvd3BoYXNlID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIENhbGxlZCBldmVyeSB0aW1lc3RlcCB0byB1cGRhdGUgaW50ZXJuYWwgc2xlZXAgdGltZXIgYW5kIGNoYW5nZSBzbGVlcCBzdGF0ZSBpZiBuZWVkZWQuCiAgICAgKiBAcGFyYW0gdGltZSBUaGUgd29ybGQgdGltZSBpbiBzZWNvbmRzCiAgICAgKi8KCgogICAgc2xlZXBUaWNrKHRpbWUpIHsKICAgICAgaWYgKHRoaXMuYWxsb3dTbGVlcCkgewogICAgICAgIGNvbnN0IHNsZWVwU3RhdGUgPSB0aGlzLnNsZWVwU3RhdGU7CiAgICAgICAgY29uc3Qgc3BlZWRTcXVhcmVkID0gdGhpcy52ZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCkgKyB0aGlzLmFuZ3VsYXJWZWxvY2l0eS5sZW5ndGhTcXVhcmVkKCk7CiAgICAgICAgY29uc3Qgc3BlZWRMaW1pdFNxdWFyZWQgPSB0aGlzLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5BV0FLRSAmJiBzcGVlZFNxdWFyZWQgPCBzcGVlZExpbWl0U3F1YXJlZCkgewogICAgICAgICAgdGhpcy5zbGVlcFN0YXRlID0gQm9keS5TTEVFUFk7IC8vIFNsZWVweQoKICAgICAgICAgIHRoaXMudGltZUxhc3RTbGVlcHkgPSB0aW1lOwogICAgICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KEJvZHkuc2xlZXB5RXZlbnQpOwogICAgICAgIH0gZWxzZSBpZiAoc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUFkgJiYgc3BlZWRTcXVhcmVkID4gc3BlZWRMaW1pdFNxdWFyZWQpIHsKICAgICAgICAgIHRoaXMud2FrZVVwKCk7IC8vIFdha2UgdXAKICAgICAgICB9IGVsc2UgaWYgKHNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBZICYmIHRpbWUgLSB0aGlzLnRpbWVMYXN0U2xlZXB5ID4gdGhpcy5zbGVlcFRpbWVMaW1pdCkgewogICAgICAgICAgdGhpcy5zbGVlcCgpOyAvLyBTbGVlcGluZwoKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChCb2R5LnNsZWVwRXZlbnQpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBJZiB0aGUgYm9keSBpcyBzbGVlcGluZywgaXQgc2hvdWxkIGJlIGltbW92YWJsZSAvIGhhdmUgaW5maW5pdGUgbWFzcyBkdXJpbmcgc29sdmUuIFdlIHNvbHZlIGl0IGJ5IGhhdmluZyBhIHNlcGFyYXRlICJzb2x2ZSBtYXNzIi4KICAgICAqLwoKCiAgICB1cGRhdGVTb2x2ZU1hc3NQcm9wZXJ0aWVzKCkgewogICAgICBpZiAodGhpcy5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHsKICAgICAgICB0aGlzLmludk1hc3NTb2x2ZSA9IDA7CiAgICAgICAgdGhpcy5pbnZJbmVydGlhU29sdmUuc2V0WmVybygpOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVdvcmxkU29sdmUuc2V0WmVybygpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuaW52TWFzc1NvbHZlID0gdGhpcy5pbnZNYXNzOwogICAgICAgIHRoaXMuaW52SW5lcnRpYVNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhKTsKICAgICAgICB0aGlzLmludkluZXJ0aWFXb3JsZFNvbHZlLmNvcHkodGhpcy5pbnZJbmVydGlhV29ybGQpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnZlcnQgYSB3b3JsZCBwb2ludCB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHBvaW50VG9Mb2NhbEZyYW1lKHdvcmxkUG9pbnQsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB3b3JsZFBvaW50LnZzdWIodGhpcy5wb3NpdGlvbiwgcmVzdWx0KTsKICAgICAgdGhpcy5xdWF0ZXJuaW9uLmNvbmp1Z2F0ZSgpLnZtdWx0KHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIHdvcmxkIHZlY3RvciB0byBsb2NhbCBib2R5IGZyYW1lLgogICAgICovCgoKICAgIHZlY3RvclRvTG9jYWxGcmFtZSh3b3JsZFZlY3RvciwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi5jb25qdWdhdGUoKS52bXVsdCh3b3JsZFZlY3RvciwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogQ29udmVydCBhIGxvY2FsIGJvZHkgcG9pbnQgdG8gd29ybGQgZnJhbWUuCiAgICAgKi8KCgogICAgcG9pbnRUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMucXVhdGVybmlvbi52bXVsdChsb2NhbFBvaW50LCByZXN1bHQpOwogICAgICByZXN1bHQudmFkZCh0aGlzLnBvc2l0aW9uLCByZXN1bHQpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBDb252ZXJ0IGEgbG9jYWwgYm9keSBwb2ludCB0byB3b3JsZCBmcmFtZS4KICAgICAqLwoKCiAgICB2ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxWZWN0b3IsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0aGlzLnF1YXRlcm5pb24udm11bHQobG9jYWxWZWN0b3IsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHNoYXBlIHRvIHRoZSBib2R5IHdpdGggYSBsb2NhbCBvZmZzZXQgYW5kIG9yaWVudGF0aW9uLgogICAgICogQHJldHVybiBUaGUgYm9keSBvYmplY3QsIGZvciBjaGFpbmFiaWxpdHkuCiAgICAgKi8KCgogICAgYWRkU2hhcGUoc2hhcGUsIF9vZmZzZXQsIF9vcmllbnRhdGlvbikgewogICAgICBjb25zdCBvZmZzZXQgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgogICAgICBpZiAoX29mZnNldCkgewogICAgICAgIG9mZnNldC5jb3B5KF9vZmZzZXQpOwogICAgICB9CgogICAgICBpZiAoX29yaWVudGF0aW9uKSB7CiAgICAgICAgb3JpZW50YXRpb24uY29weShfb3JpZW50YXRpb24pOwogICAgICB9CgogICAgICB0aGlzLnNoYXBlcy5wdXNoKHNoYXBlKTsKICAgICAgdGhpcy5zaGFwZU9mZnNldHMucHVzaChvZmZzZXQpOwogICAgICB0aGlzLnNoYXBlT3JpZW50YXRpb25zLnB1c2gob3JpZW50YXRpb24pOwogICAgICB0aGlzLnVwZGF0ZU1hc3NQcm9wZXJ0aWVzKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdSYWRpdXMoKTsKICAgICAgdGhpcy5hYWJiTmVlZHNVcGRhdGUgPSB0cnVlOwogICAgICBzaGFwZS5ib2R5ID0gdGhpczsKICAgICAgcmV0dXJuIHRoaXM7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZSBhIHNoYXBlIGZyb20gdGhlIGJvZHkuCiAgICAgKiBAcmV0dXJuIFRoZSBib2R5IG9iamVjdCwgZm9yIGNoYWluYWJpbGl0eS4KICAgICAqLwoKCiAgICByZW1vdmVTaGFwZShzaGFwZSkgewogICAgICBjb25zdCBpbmRleCA9IHRoaXMuc2hhcGVzLmluZGV4T2Yoc2hhcGUpOwoKICAgICAgaWYgKGluZGV4ID09PSAtMSkgewogICAgICAgIGNvbnNvbGUud2FybignU2hhcGUgZG9lcyBub3QgYmVsb25nIHRvIHRoZSBib2R5Jyk7CiAgICAgICAgcmV0dXJuIHRoaXM7CiAgICAgIH0KCiAgICAgIHRoaXMuc2hhcGVzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPZmZzZXRzLnNwbGljZShpbmRleCwgMSk7CiAgICAgIHRoaXMuc2hhcGVPcmllbnRhdGlvbnMuc3BsaWNlKGluZGV4LCAxKTsKICAgICAgdGhpcy51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nUmFkaXVzKCk7CiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgc2hhcGUuYm9keSA9IG51bGw7CiAgICAgIHJldHVybiB0aGlzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGJvdW5kaW5nIHJhZGl1cyBvZiB0aGUgYm9keS4gU2hvdWxkIGJlIGRvbmUgaWYgYW55IG9mIHRoZSBzaGFwZXMgYXJlIGNoYW5nZWQuCiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdSYWRpdXMoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3QgTiA9IHNoYXBlcy5sZW5ndGg7CiAgICAgIGxldCByYWRpdXMgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2ldOwogICAgICAgIHNoYXBlLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgICAgY29uc3Qgb2Zmc2V0ID0gc2hhcGVPZmZzZXRzW2ldLmxlbmd0aCgpOwogICAgICAgIGNvbnN0IHIgPSBzaGFwZS5ib3VuZGluZ1NwaGVyZVJhZGl1czsKCiAgICAgICAgaWYgKG9mZnNldCArIHIgPiByYWRpdXMpIHsKICAgICAgICAgIHJhZGl1cyA9IG9mZnNldCArIHI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nUmFkaXVzID0gcmFkaXVzOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGVzIHRoZSAuYWFiYgogICAgICovCgoKICAgIHVwZGF0ZUFBQkIoKSB7CiAgICAgIGNvbnN0IHNoYXBlcyA9IHRoaXMuc2hhcGVzOwogICAgICBjb25zdCBzaGFwZU9mZnNldHMgPSB0aGlzLnNoYXBlT2Zmc2V0czsKICAgICAgY29uc3Qgc2hhcGVPcmllbnRhdGlvbnMgPSB0aGlzLnNoYXBlT3JpZW50YXRpb25zOwogICAgICBjb25zdCBOID0gc2hhcGVzLmxlbmd0aDsKICAgICAgY29uc3Qgb2Zmc2V0ID0gdG1wVmVjOwogICAgICBjb25zdCBvcmllbnRhdGlvbiA9IHRtcFF1YXQ7CiAgICAgIGNvbnN0IGJvZHlRdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBhYWJiID0gdGhpcy5hYWJiOwogICAgICBjb25zdCBzaGFwZUFBQkIgPSB1cGRhdGVBQUJCX3NoYXBlQUFCQjsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBzaGFwZSA9IHNoYXBlc1tpXTsgLy8gR2V0IHNoYXBlIHdvcmxkIHBvc2l0aW9uCgogICAgICAgIGJvZHlRdWF0LnZtdWx0KHNoYXBlT2Zmc2V0c1tpXSwgb2Zmc2V0KTsKICAgICAgICBvZmZzZXQudmFkZCh0aGlzLnBvc2l0aW9uLCBvZmZzZXQpOyAvLyBHZXQgc2hhcGUgd29ybGQgcXVhdGVybmlvbgoKICAgICAgICBib2R5UXVhdC5tdWx0KHNoYXBlT3JpZW50YXRpb25zW2ldLCBvcmllbnRhdGlvbik7IC8vIEdldCBzaGFwZSBBQUJCCgogICAgICAgIHNoYXBlLmNhbGN1bGF0ZVdvcmxkQUFCQihvZmZzZXQsIG9yaWVudGF0aW9uLCBzaGFwZUFBQkIubG93ZXJCb3VuZCwgc2hhcGVBQUJCLnVwcGVyQm91bmQpOwoKICAgICAgICBpZiAoaSA9PT0gMCkgewogICAgICAgICAgYWFiYi5jb3B5KHNoYXBlQUFCQik7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGFhYmIuZXh0ZW5kKHNoYXBlQUFCQik7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmFhYmJOZWVkc1VwZGF0ZSA9IGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgYC5pbmVydGlhV29ybGRgIGFuZCBgLmludkluZXJ0aWFXb3JsZGAKICAgICAqLwoKCiAgICB1cGRhdGVJbmVydGlhV29ybGQoZm9yY2UpIHsKICAgICAgY29uc3QgSSA9IHRoaXMuaW52SW5lcnRpYTsKCiAgICAgIGlmIChJLnggPT09IEkueSAmJiBJLnkgPT09IEkueiAmJiAhZm9yY2UpIDsgZWxzZSB7CiAgICAgICAgY29uc3QgbTEgPSB1aXdfbTE7CiAgICAgICAgY29uc3QgbTIgPSB1aXdfbTI7CiAgICAgICAgbTEuc2V0Um90YXRpb25Gcm9tUXVhdGVybmlvbih0aGlzLnF1YXRlcm5pb24pOwogICAgICAgIG0xLnRyYW5zcG9zZShtMik7CiAgICAgICAgbTEuc2NhbGUoSSwgbTEpOwogICAgICAgIG0xLm1tdWx0KG0yLCB0aGlzLmludkluZXJ0aWFXb3JsZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgZm9yY2UgdG8gYSBwb2ludCBvZiB0aGUgYm9keS4gVGhpcyBjb3VsZCBmb3IgZXhhbXBsZSBiZSBhIHBvaW50IG9uIHRoZSBCb2R5IHN1cmZhY2UuCiAgICAgKiBBcHBseWluZyBmb3JjZSB0aGlzIHdheSB3aWxsIGFkZCB0byBCb2R5LmZvcmNlIGFuZCBCb2R5LnRvcnF1ZS4KICAgICAqIEBwYXJhbSBmb3JjZSBUaGUgYW1vdW50IG9mIGZvcmNlIHRvIGFkZC4KICAgICAqIEBwYXJhbSByZWxhdGl2ZVBvaW50IEEgcG9pbnQgcmVsYXRpdmUgdG8gdGhlIGNlbnRlciBvZiBtYXNzIHRvIGFwcGx5IHRoZSBmb3JjZSBvbi4KICAgICAqLwoKCiAgICBhcHBseUZvcmNlKGZvcmNlLCByZWxhdGl2ZVBvaW50KSB7CiAgICAgIGlmIChyZWxhdGl2ZVBvaW50ID09PSB2b2lkIDApIHsKICAgICAgICByZWxhdGl2ZVBvaW50ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgLy8gTmVlZGVkPwogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcHJvZHVjZWQgcm90YXRpb25hbCBmb3JjZQoKCiAgICAgIGNvbnN0IHJvdEZvcmNlID0gQm9keV9hcHBseUZvcmNlX3JvdEZvcmNlOwogICAgICByZWxhdGl2ZVBvaW50LmNyb3NzKGZvcmNlLCByb3RGb3JjZSk7IC8vIEFkZCBsaW5lYXIgZm9yY2UKCiAgICAgIHRoaXMuZm9yY2UudmFkZChmb3JjZSwgdGhpcy5mb3JjZSk7IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgogICAgICB0aGlzLnRvcnF1ZS52YWRkKHJvdEZvcmNlLCB0aGlzLnRvcnF1ZSk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IGZvcmNlIHRvIGEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gZm9yY2UgVGhlIGZvcmNlIHZlY3RvciB0byBhcHBseSwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBib2R5IGZyYW1lLgogICAgICogQHBhcmFtIGxvY2FsUG9pbnQgQSBsb2NhbCBwb2ludCBpbiB0aGUgYm9keSB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlMb2NhbEZvcmNlKGxvY2FsRm9yY2UsIGxvY2FsUG9pbnQpIHsKICAgICAgaWYgKGxvY2FsUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIGxvY2FsUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHdvcmxkRm9yY2UgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV93b3JsZEZvcmNlOwogICAgICBjb25zdCByZWxhdGl2ZVBvaW50V29ybGQgPSBCb2R5X2FwcGx5TG9jYWxGb3JjZV9yZWxhdGl2ZVBvaW50V29ybGQ7IC8vIFRyYW5zZm9ybSB0aGUgZm9yY2UgdmVjdG9yIHRvIHdvcmxkIHNwYWNlCgogICAgICB0aGlzLnZlY3RvclRvV29ybGRGcmFtZShsb2NhbEZvcmNlLCB3b3JsZEZvcmNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUZvcmNlKHdvcmxkRm9yY2UsIHJlbGF0aXZlUG9pbnRXb3JsZCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRvcnF1ZSB0byB0aGUgYm9keS4KICAgICAqIEBwYXJhbSB0b3JxdWUgVGhlIGFtb3VudCBvZiB0b3JxdWUgdG8gYWRkLgogICAgICovCgoKICAgIGFwcGx5VG9ycXVlKHRvcnF1ZSkgewogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIEFkZCByb3RhdGlvbmFsIGZvcmNlCgoKICAgICAgdGhpcy50b3JxdWUudmFkZCh0b3JxdWUsIHRoaXMudG9ycXVlKTsKICAgIH0KICAgIC8qKgogICAgICogQXBwbHkgaW1wdWxzZSB0byBhIHBvaW50IG9mIHRoZSBib2R5LiBUaGlzIGNvdWxkIGZvciBleGFtcGxlIGJlIGEgcG9pbnQgb24gdGhlIEJvZHkgc3VyZmFjZS4KICAgICAqIEFuIGltcHVsc2UgaXMgYSBmb3JjZSBhZGRlZCB0byBhIGJvZHkgZHVyaW5nIGEgc2hvcnQgcGVyaW9kIG9mIHRpbWUgKGltcHVsc2UgPSBmb3JjZSAqIHRpbWUpLgogICAgICogSW1wdWxzZXMgd2lsbCBiZSBhZGRlZCB0byBCb2R5LnZlbG9jaXR5IGFuZCBCb2R5LmFuZ3VsYXJWZWxvY2l0eS4KICAgICAqIEBwYXJhbSBpbXB1bHNlIFRoZSBhbW91bnQgb2YgaW1wdWxzZSB0byBhZGQuCiAgICAgKiBAcGFyYW0gcmVsYXRpdmVQb2ludCBBIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyB0byBhcHBseSB0aGUgZm9yY2Ugb24uCiAgICAgKi8KCgogICAgYXBwbHlJbXB1bHNlKGltcHVsc2UsIHJlbGF0aXZlUG9pbnQpIHsKICAgICAgaWYgKHJlbGF0aXZlUG9pbnQgPT09IHZvaWQgMCkgewogICAgICAgIHJlbGF0aXZlUG9pbnQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAodGhpcy50eXBlICE9PSBCb2R5LkRZTkFNSUMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpIHsKICAgICAgICB0aGlzLndha2VVcCgpOwogICAgICB9IC8vIENvbXB1dGUgcG9pbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGJvZHkgY2VudGVyCgoKICAgICAgY29uc3QgciA9IHJlbGF0aXZlUG9pbnQ7IC8vIENvbXB1dGUgcHJvZHVjZWQgY2VudHJhbCBpbXB1bHNlIHZlbG9jaXR5CgogICAgICBjb25zdCB2ZWxvID0gQm9keV9hcHBseUltcHVsc2VfdmVsbzsKICAgICAgdmVsby5jb3B5KGltcHVsc2UpOwogICAgICB2ZWxvLnNjYWxlKHRoaXMuaW52TWFzcywgdmVsbyk7IC8vIEFkZCBsaW5lYXIgaW1wdWxzZQoKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHZlbG8sIHRoaXMudmVsb2NpdHkpOyAvLyBDb21wdXRlIHByb2R1Y2VkIHJvdGF0aW9uYWwgaW1wdWxzZSB2ZWxvY2l0eQoKICAgICAgY29uc3Qgcm90VmVsbyA9IEJvZHlfYXBwbHlJbXB1bHNlX3JvdFZlbG87CiAgICAgIHIuY3Jvc3MoaW1wdWxzZSwgcm90VmVsbyk7CiAgICAgIC8qCiAgICAgICByb3RWZWxvLnggKj0gdGhpcy5pbnZJbmVydGlhLng7CiAgICAgICByb3RWZWxvLnkgKj0gdGhpcy5pbnZJbmVydGlhLnk7CiAgICAgICByb3RWZWxvLnogKj0gdGhpcy5pbnZJbmVydGlhLno7CiAgICAgICAqLwoKICAgICAgdGhpcy5pbnZJbmVydGlhV29ybGQudm11bHQocm90VmVsbywgcm90VmVsbyk7IC8vIEFkZCByb3RhdGlvbmFsIEltcHVsc2UKCiAgICAgIHRoaXMuYW5ndWxhclZlbG9jaXR5LnZhZGQocm90VmVsbywgdGhpcy5hbmd1bGFyVmVsb2NpdHkpOwogICAgfQogICAgLyoqCiAgICAgKiBBcHBseSBsb2NhbGx5LWRlZmluZWQgaW1wdWxzZSB0byBhIGxvY2FsIHBvaW50IGluIHRoZSBib2R5LgogICAgICogQHBhcmFtIGZvcmNlIFRoZSBmb3JjZSB2ZWN0b3IgdG8gYXBwbHksIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgYm9keSBmcmFtZS4KICAgICAqIEBwYXJhbSBsb2NhbFBvaW50IEEgbG9jYWwgcG9pbnQgaW4gdGhlIGJvZHkgdG8gYXBwbHkgdGhlIGZvcmNlIG9uLgogICAgICovCgoKICAgIGFwcGx5TG9jYWxJbXB1bHNlKGxvY2FsSW1wdWxzZSwgbG9jYWxQb2ludCkgewogICAgICBpZiAobG9jYWxQb2ludCA9PT0gdm9pZCAwKSB7CiAgICAgICAgbG9jYWxQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLnR5cGUgIT09IEJvZHkuRFlOQU1JQykgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgd29ybGRJbXB1bHNlID0gQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2U7CiAgICAgIGNvbnN0IHJlbGF0aXZlUG9pbnRXb3JsZCA9IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludDsgLy8gVHJhbnNmb3JtIHRoZSBmb3JjZSB2ZWN0b3IgdG8gd29ybGQgc3BhY2UKCiAgICAgIHRoaXMudmVjdG9yVG9Xb3JsZEZyYW1lKGxvY2FsSW1wdWxzZSwgd29ybGRJbXB1bHNlKTsKICAgICAgdGhpcy52ZWN0b3JUb1dvcmxkRnJhbWUobG9jYWxQb2ludCwgcmVsYXRpdmVQb2ludFdvcmxkKTsKICAgICAgdGhpcy5hcHBseUltcHVsc2Uod29ybGRJbXB1bHNlLCByZWxhdGl2ZVBvaW50V29ybGQpOwogICAgfQogICAgLyoqCiAgICAgKiBTaG91bGQgYmUgY2FsbGVkIHdoZW5ldmVyIHlvdSBjaGFuZ2UgdGhlIGJvZHkgc2hhcGUgb3IgbWFzcy4KICAgICAqLwoKCiAgICB1cGRhdGVNYXNzUHJvcGVydGllcygpIHsKICAgICAgY29uc3QgaGFsZkV4dGVudHMgPSBCb2R5X3VwZGF0ZU1hc3NQcm9wZXJ0aWVzX2hhbGZFeHRlbnRzOwogICAgICB0aGlzLmludk1hc3MgPSB0aGlzLm1hc3MgPiAwID8gMS4wIC8gdGhpcy5tYXNzIDogMDsKICAgICAgY29uc3QgSSA9IHRoaXMuaW5lcnRpYTsKICAgICAgY29uc3QgZml4ZWQgPSB0aGlzLmZpeGVkUm90YXRpb247IC8vIEFwcHJveGltYXRlIHdpdGggQUFCQiBib3gKCiAgICAgIHRoaXMudXBkYXRlQUFCQigpOwogICAgICBoYWxmRXh0ZW50cy5zZXQoKHRoaXMuYWFiYi51cHBlckJvdW5kLnggLSB0aGlzLmFhYmIubG93ZXJCb3VuZC54KSAvIDIsICh0aGlzLmFhYmIudXBwZXJCb3VuZC55IC0gdGhpcy5hYWJiLmxvd2VyQm91bmQueSkgLyAyLCAodGhpcy5hYWJiLnVwcGVyQm91bmQueiAtIHRoaXMuYWFiYi5sb3dlckJvdW5kLnopIC8gMik7CiAgICAgIEJveC5jYWxjdWxhdGVJbmVydGlhKGhhbGZFeHRlbnRzLCB0aGlzLm1hc3MsIEkpOwogICAgICB0aGlzLmludkluZXJ0aWEuc2V0KEkueCA+IDAgJiYgIWZpeGVkID8gMS4wIC8gSS54IDogMCwgSS55ID4gMCAmJiAhZml4ZWQgPyAxLjAgLyBJLnkgOiAwLCBJLnogPiAwICYmICFmaXhlZCA/IDEuMCAvIEkueiA6IDApOwogICAgICB0aGlzLnVwZGF0ZUluZXJ0aWFXb3JsZCh0cnVlKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHdvcmxkIHZlbG9jaXR5IG9mIGEgcG9pbnQgaW4gdGhlIGJvZHkuCiAgICAgKiBAcGFyYW0gd29ybGRQb2ludAogICAgICogQHBhcmFtIHJlc3VsdAogICAgICogQHJldHVybiBUaGUgcmVzdWx0IHZlY3Rvci4KICAgICAqLwoKCiAgICBnZXRWZWxvY2l0eUF0V29ybGRQb2ludCh3b3JsZFBvaW50LCByZXN1bHQpIHsKICAgICAgY29uc3QgciA9IG5ldyBWZWMzKCk7CiAgICAgIHdvcmxkUG9pbnQudnN1Yih0aGlzLnBvc2l0aW9uLCByKTsKICAgICAgdGhpcy5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MociwgcmVzdWx0KTsKICAgICAgdGhpcy52ZWxvY2l0eS52YWRkKHJlc3VsdCwgcmVzdWx0KTsKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogTW92ZSB0aGUgYm9keSBmb3J3YXJkIGluIHRpbWUuCiAgICAgKiBAcGFyYW0gZHQgVGltZSBzdGVwCiAgICAgKiBAcGFyYW0gcXVhdE5vcm1hbGl6ZSBTZXQgdG8gdHJ1ZSB0byBub3JtYWxpemUgdGhlIGJvZHkgcXVhdGVybmlvbgogICAgICogQHBhcmFtIHF1YXROb3JtYWxpemVGYXN0IElmIHRoZSBxdWF0ZXJuaW9uIHNob3VsZCBiZSBub3JtYWxpemVkIHVzaW5nICJmYXN0IiBxdWF0ZXJuaW9uIG5vcm1hbGl6YXRpb24KICAgICAqLwoKCiAgICBpbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgIC8vIFNhdmUgcHJldmlvdXMgcG9zaXRpb24KICAgICAgdGhpcy5wcmV2aW91c1Bvc2l0aW9uLmNvcHkodGhpcy5wb3NpdGlvbik7CiAgICAgIHRoaXMucHJldmlvdXNRdWF0ZXJuaW9uLmNvcHkodGhpcy5xdWF0ZXJuaW9uKTsKCiAgICAgIGlmICghKHRoaXMudHlwZSA9PT0gQm9keS5EWU5BTUlDIHx8IHRoaXMudHlwZSA9PT0gQm9keS5LSU5FTUFUSUMpIHx8IHRoaXMuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORykgewogICAgICAgIC8vIE9ubHkgZm9yIGR5bmFtaWMKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlbG8gPSB0aGlzLnZlbG9jaXR5OwogICAgICBjb25zdCBhbmd1bGFyVmVsbyA9IHRoaXMuYW5ndWxhclZlbG9jaXR5OwogICAgICBjb25zdCBwb3MgPSB0aGlzLnBvc2l0aW9uOwogICAgICBjb25zdCBmb3JjZSA9IHRoaXMuZm9yY2U7CiAgICAgIGNvbnN0IHRvcnF1ZSA9IHRoaXMudG9ycXVlOwogICAgICBjb25zdCBxdWF0ID0gdGhpcy5xdWF0ZXJuaW9uOwogICAgICBjb25zdCBpbnZNYXNzID0gdGhpcy5pbnZNYXNzOwogICAgICBjb25zdCBpbnZJbmVydGlhID0gdGhpcy5pbnZJbmVydGlhV29ybGQ7CiAgICAgIGNvbnN0IGxpbmVhckZhY3RvciA9IHRoaXMubGluZWFyRmFjdG9yOwogICAgICBjb25zdCBpTWR0ID0gaW52TWFzcyAqIGR0OwogICAgICB2ZWxvLnggKz0gZm9yY2UueCAqIGlNZHQgKiBsaW5lYXJGYWN0b3IueDsKICAgICAgdmVsby55ICs9IGZvcmNlLnkgKiBpTWR0ICogbGluZWFyRmFjdG9yLnk7CiAgICAgIHZlbG8ueiArPSBmb3JjZS56ICogaU1kdCAqIGxpbmVhckZhY3Rvci56OwogICAgICBjb25zdCBlID0gaW52SW5lcnRpYS5lbGVtZW50czsKICAgICAgY29uc3QgYW5ndWxhckZhY3RvciA9IHRoaXMuYW5ndWxhckZhY3RvcjsKICAgICAgY29uc3QgdHggPSB0b3JxdWUueCAqIGFuZ3VsYXJGYWN0b3IueDsKICAgICAgY29uc3QgdHkgPSB0b3JxdWUueSAqIGFuZ3VsYXJGYWN0b3IueTsKICAgICAgY29uc3QgdHogPSB0b3JxdWUueiAqIGFuZ3VsYXJGYWN0b3IuejsKICAgICAgYW5ndWxhclZlbG8ueCArPSBkdCAqIChlWzBdICogdHggKyBlWzFdICogdHkgKyBlWzJdICogdHopOwogICAgICBhbmd1bGFyVmVsby55ICs9IGR0ICogKGVbM10gKiB0eCArIGVbNF0gKiB0eSArIGVbNV0gKiB0eik7CiAgICAgIGFuZ3VsYXJWZWxvLnogKz0gZHQgKiAoZVs2XSAqIHR4ICsgZVs3XSAqIHR5ICsgZVs4XSAqIHR6KTsgLy8gVXNlIG5ldyB2ZWxvY2l0eSAgLSBsZWFwIGZyb2cKCiAgICAgIHBvcy54ICs9IHZlbG8ueCAqIGR0OwogICAgICBwb3MueSArPSB2ZWxvLnkgKiBkdDsKICAgICAgcG9zLnogKz0gdmVsby56ICogZHQ7CiAgICAgIHF1YXQuaW50ZWdyYXRlKHRoaXMuYW5ndWxhclZlbG9jaXR5LCBkdCwgdGhpcy5hbmd1bGFyRmFjdG9yLCBxdWF0KTsKCiAgICAgIGlmIChxdWF0Tm9ybWFsaXplKSB7CiAgICAgICAgaWYgKHF1YXROb3JtYWxpemVGYXN0KSB7CiAgICAgICAgICBxdWF0Lm5vcm1hbGl6ZUZhc3QoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcXVhdC5ub3JtYWxpemUoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuYWFiYk5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gVXBkYXRlIHdvcmxkIGluZXJ0aWEKCiAgICAgIHRoaXMudXBkYXRlSW5lcnRpYVdvcmxkKCk7CiAgICB9CgogIH0KICBCb2R5LmlkQ291bnRlciA9IDA7CiAgQm9keS5DT0xMSURFX0VWRU5UX05BTUUgPSAnY29sbGlkZSc7CiAgQm9keS5EWU5BTUlDID0gQk9EWV9UWVBFUy5EWU5BTUlDOwogIEJvZHkuU1RBVElDID0gQk9EWV9UWVBFUy5TVEFUSUM7CiAgQm9keS5LSU5FTUFUSUMgPSBCT0RZX1RZUEVTLktJTkVNQVRJQzsKICBCb2R5LkFXQUtFID0gQk9EWV9TTEVFUF9TVEFURVMuQVdBS0U7CiAgQm9keS5TTEVFUFkgPSBCT0RZX1NMRUVQX1NUQVRFUy5TTEVFUFk7CiAgQm9keS5TTEVFUElORyA9IEJPRFlfU0xFRVBfU1RBVEVTLlNMRUVQSU5HOwogIEJvZHkud2FrZXVwRXZlbnQgPSB7CiAgICB0eXBlOiAnd2FrZXVwJwogIH07CiAgQm9keS5zbGVlcHlFdmVudCA9IHsKICAgIHR5cGU6ICdzbGVlcHknCiAgfTsKICBCb2R5LnNsZWVwRXZlbnQgPSB7CiAgICB0eXBlOiAnc2xlZXAnCiAgfTsKICBjb25zdCB0bXBWZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFF1YXQgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHVwZGF0ZUFBQkJfc2hhcGVBQUJCID0gbmV3IEFBQkIoKTsKICBjb25zdCB1aXdfbTEgPSBuZXcgTWF0MygpOwogIGNvbnN0IHVpd19tMiA9IG5ldyBNYXQzKCk7CiAgbmV3IE1hdDMoKTsKICBjb25zdCBCb2R5X2FwcGx5Rm9yY2Vfcm90Rm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3dvcmxkRm9yY2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEZvcmNlX3JlbGF0aXZlUG9pbnRXb3JsZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2VfdmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUltcHVsc2Vfcm90VmVsbyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV9hcHBseUxvY2FsSW1wdWxzZV93b3JsZEltcHVsc2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IEJvZHlfYXBwbHlMb2NhbEltcHVsc2VfcmVsYXRpdmVQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQm9keV91cGRhdGVNYXNzUHJvcGVydGllc19oYWxmRXh0ZW50cyA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIEJhc2UgY2xhc3MgZm9yIGJyb2FkcGhhc2UgaW1wbGVtZW50YXRpb25zCiAgICogQGF1dGhvciBzY2h0ZXBwZQogICAqLwogIGNsYXNzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBUaGUgd29ybGQgdG8gc2VhcmNoIGZvciBjb2xsaXNpb25zIGluLgogICAgICovCgogICAgLyoqCiAgICAgKiBJZiBzZXQgdG8gdHJ1ZSwgdGhlIGJyb2FkcGhhc2UgdXNlcyBib3VuZGluZyBib3hlcyBmb3IgaW50ZXJzZWN0aW9uIHRlc3RzLCBlbHNlIGl0IHVzZXMgYm91bmRpbmcgc3BoZXJlcy4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIHRydWUgaWYgdGhlIG9iamVjdHMgaW4gdGhlIHdvcmxkIG1vdmVkLgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMudXNlQm91bmRpbmdCb3hlcyA9IGZhbHNlOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb2xsaXNpb24gcGFpcnMgZnJvbSB0aGUgd29ybGQKICAgICAqIEBwYXJhbSB3b3JsZCBUaGUgd29ybGQgdG8gc2VhcmNoIGluCiAgICAgKiBAcGFyYW0gcDEgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKiBAcGFyYW0gcDIgRW1wdHkgYXJyYXkgdG8gYmUgZmlsbGVkIHdpdGggYm9keSBvYmplY3RzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NvbGxpc2lvblBhaXJzIG5vdCBpbXBsZW1lbnRlZCBmb3IgdGhpcyBCcm9hZFBoYXNlIGNsYXNzIScpOwogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiBhIGJvZHkgcGFpciBuZWVkcyB0byBiZSBpbnRlcnNlY3Rpb24gdGVzdGVkIGF0IGFsbC4KICAgICAqLwoKCiAgICBuZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihib2R5QSwgYm9keUIpIHsKICAgICAgLy8gQ2hlY2sgY29sbGlzaW9uIGZpbHRlciBtYXNrcwogICAgICBpZiAoKGJvZHlBLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUIuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDAgfHwgKGJvZHlCLmNvbGxpc2lvbkZpbHRlckdyb3VwICYgYm9keUEuY29sbGlzaW9uRmlsdGVyTWFzaykgPT09IDApIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0gLy8gQ2hlY2sgdHlwZXMKCgogICAgICBpZiAoKChib2R5QS50eXBlICYgQm9keS5TVEFUSUMpICE9PSAwIHx8IGJvZHlBLnNsZWVwU3RhdGUgPT09IEJvZHkuU0xFRVBJTkcpICYmICgoYm9keUIudHlwZSAmIEJvZHkuU1RBVElDKSAhPT0gMCB8fCBib2R5Qi5zbGVlcFN0YXRlID09PSBCb2R5LlNMRUVQSU5HKSkgewogICAgICAgIC8vIEJvdGggYm9kaWVzIGFyZSBzdGF0aWMgb3Igc2xlZXBpbmcuIFNraXAuCiAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgICB9CgogICAgICByZXR1cm4gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHZvbHVtZXMgb2YgdHdvIGJvZGllcyBpbnRlcnNlY3QuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0aW9uVGVzdChib2R5QSwgYm9keUIsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGlmICh0aGlzLnVzZUJvdW5kaW5nQm94ZXMpIHsKICAgICAgICB0aGlzLmRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuZG9Cb3VuZGluZ1NwaGVyZUJyb2FkcGhhc2UoYm9keUEsIGJvZHlCLCBwYWlyczEsIHBhaXJzMik7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICogQHBhcmFtIHBhaXJzMSBib2R5QSBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICogQHBhcmFtIHBhaXJzMiBib2R5QiBpcyBhcHBlbmRlZCB0byB0aGlzIGFycmF5IGlmIGludGVyc2VjdGlvbgogICAgICovCgoKICAgIGRvQm91bmRpbmdTcGhlcmVCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgciA9IEJyb2FkcGhhc2VfY29sbGlzaW9uUGFpcnNfcjsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgcik7CiAgICAgIGNvbnN0IGJvdW5kaW5nUmFkaXVzU3VtMiA9IChib2R5QS5ib3VuZGluZ1JhZGl1cyArIGJvZHlCLmJvdW5kaW5nUmFkaXVzKSAqKiAyOwogICAgICBjb25zdCBub3JtMiA9IHIubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgaWYgKG5vcm0yIDwgYm91bmRpbmdSYWRpdXNTdW0yKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRpbmcgYm94ZXMgb2YgdHdvIGJvZGllcyBhcmUgaW50ZXJzZWN0aW5nLgogICAgICovCgoKICAgIGRvQm91bmRpbmdCb3hCcm9hZHBoYXNlKGJvZHlBLCBib2R5QiwgcGFpcnMxLCBwYWlyczIpIHsKICAgICAgaWYgKGJvZHlBLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlBLnVwZGF0ZUFBQkIoKTsKICAgICAgfQoKICAgICAgaWYgKGJvZHlCLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgIGJvZHlCLnVwZGF0ZUFBQkIoKTsKICAgICAgfSAvLyBDaGVjayBBQUJCIC8gQUFCQgoKCiAgICAgIGlmIChib2R5QS5hYWJiLm92ZXJsYXBzKGJvZHlCLmFhYmIpKSB7CiAgICAgICAgcGFpcnMxLnB1c2goYm9keUEpOwogICAgICAgIHBhaXJzMi5wdXNoKGJvZHlCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmVzIGR1cGxpY2F0ZSBwYWlycyBmcm9tIHRoZSBwYWlyIGFycmF5cy4KICAgICAqLwoKCiAgICBtYWtlUGFpcnNVbmlxdWUocGFpcnMxLCBwYWlyczIpIHsKICAgICAgY29uc3QgdCA9IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3RlbXA7CiAgICAgIGNvbnN0IHAxID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDE7CiAgICAgIGNvbnN0IHAyID0gQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDI7CiAgICAgIGNvbnN0IE4gPSBwYWlyczEubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIHAxW2ldID0gcGFpcnMxW2ldOwogICAgICAgIHAyW2ldID0gcGFpcnMyW2ldOwogICAgICB9CgogICAgICBwYWlyczEubGVuZ3RoID0gMDsKICAgICAgcGFpcnMyLmxlbmd0aCA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgaWQxID0gcDFbaV0uaWQ7CiAgICAgICAgY29uc3QgaWQyID0gcDJbaV0uaWQ7CiAgICAgICAgY29uc3Qga2V5ID0gaWQxIDwgaWQyID8gYCR7aWQxfSwke2lkMn1gIDogYCR7aWQyfSwke2lkMX1gOwogICAgICAgIHRba2V5XSA9IGk7CiAgICAgICAgdC5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IHQua2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGtleSA9IHQua2V5cy5wb3AoKTsKICAgICAgICBjb25zdCBwYWlySW5kZXggPSB0W2tleV07CiAgICAgICAgcGFpcnMxLnB1c2gocDFbcGFpckluZGV4XSk7CiAgICAgICAgcGFpcnMyLnB1c2gocDJbcGFpckluZGV4XSk7CiAgICAgICAgZGVsZXRlIHRba2V5XTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBUbyBiZSBpbXBsZW1lbnRlZCBieSBzdWJjYXNzZXMKICAgICAqLwoKCiAgICBzZXRXb3JsZCh3b3JsZCkge30KICAgIC8qKgogICAgICogQ2hlY2sgaWYgdGhlIGJvdW5kaW5nIHNwaGVyZXMgb2YgdHdvIGJvZGllcyBvdmVybGFwLgogICAgICovCgoKICAgIHN0YXRpYyBib3VuZGluZ1NwaGVyZUNoZWNrKGJvZHlBLCBib2R5QikgewogICAgICBjb25zdCBkaXN0ID0gbmV3IFZlYzMoKTsgLy8gYnNjX2Rpc3Q7CgogICAgICBib2R5QS5wb3NpdGlvbi52c3ViKGJvZHlCLnBvc2l0aW9uLCBkaXN0KTsKICAgICAgY29uc3Qgc2EgPSBib2R5QS5zaGFwZXNbMF07CiAgICAgIGNvbnN0IHNiID0gYm9keUIuc2hhcGVzWzBdOwogICAgICByZXR1cm4gTWF0aC5wb3coc2EuYm91bmRpbmdTcGhlcmVSYWRpdXMgKyBzYi5ib3VuZGluZ1NwaGVyZVJhZGl1cywgMikgPiBkaXN0Lmxlbmd0aFNxdWFyZWQoKTsKICAgIH0KICAgIC8qKgogICAgICogUmV0dXJucyBhbGwgdGhlIGJvZGllcyB3aXRoaW4gdGhlIEFBQkIuCiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KHdvcmxkLCBhYWJiLCByZXN1bHQpIHsKICAgICAgY29uc29sZS53YXJuKCcuYWFiYlF1ZXJ5IGlzIG5vdCBpbXBsZW1lbnRlZCBpbiB0aGlzIEJyb2FkcGhhc2Ugc3ViY2xhc3MuJyk7CiAgICAgIHJldHVybiBbXTsKICAgIH0KCiAgfSAvLyBUZW1wIG9iamVjdHMKCiAgY29uc3QgQnJvYWRwaGFzZV9jb2xsaXNpb25QYWlyc19yID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBRdWF0ZXJuaW9uKCk7CiAgbmV3IFZlYzMoKTsKICBjb25zdCBCcm9hZHBoYXNlX21ha2VQYWlyc1VuaXF1ZV90ZW1wID0gewogICAga2V5czogW10KICB9OwogIGNvbnN0IEJyb2FkcGhhc2VfbWFrZVBhaXJzVW5pcXVlX3AxID0gW107CiAgY29uc3QgQnJvYWRwaGFzZV9tYWtlUGFpcnNVbmlxdWVfcDIgPSBbXTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogTmFpdmUgYnJvYWRwaGFzZSBpbXBsZW1lbnRhdGlvbiwgdXNlZCBpbiBsYWNrIG9mIGJldHRlciBvbmVzLgogICAqCiAgICogVGhlIG5haXZlIGJyb2FkcGhhc2UgbG9va3MgYXQgYWxsIHBvc3NpYmxlIHBhaXJzIHdpdGhvdXQgcmVzdHJpY3Rpb24sIHRoZXJlZm9yZSBpdCBoYXMgY29tcGxleGl0eSBOXjIgXyh3aGljaCBpcyBiYWQpXwogICAqLwogIGNsYXNzIE5haXZlQnJvYWRwaGFzZSBleHRlbmRzIEJyb2FkcGhhc2UgewogICAgLyoqCiAgICAgKiBAdG9kbyBSZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCB0aGUgY29sbGlzaW9uIHBhaXJzIGluIHRoZSBwaHlzaWNzIHdvcmxkCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHBhaXJzMSwgcGFpcnMyKSB7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgbiA9IGJvZGllcy5sZW5ndGg7CiAgICAgIGxldCBiaTsKICAgICAgbGV0IGJqOyAvLyBOYWl2ZSBOXjIgZnR3IQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IG47IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBpOyBqKyspIHsKICAgICAgICAgIGJpID0gYm9kaWVzW2ldOwogICAgICAgICAgYmogPSBib2RpZXNbal07CgogICAgICAgICAgaWYgKCF0aGlzLm5lZWRCcm9hZHBoYXNlQ29sbGlzaW9uKGJpLCBiaikpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcGFpcnMxLCBwYWlyczIpOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGIgPSB3b3JsZC5ib2RpZXNbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfSAvLyBVZ2x5IGhhY2sgdW50aWwgQm9keSBnZXRzIGFhYmIKCgogICAgICAgIGlmIChiLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIHJlc3VsdC5wdXNoKGIpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KCiAgfQoKICAvKioKICAgKiBTdG9yYWdlIGZvciBSYXkgY2FzdGluZyBkYXRhCiAgICovCiAgY2xhc3MgUmF5Y2FzdFJlc3VsdCB7CiAgICAvKioKICAgICAqIHJheUZyb21Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiByYXlUb1dvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdE5vcm1hbFdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIGhpdFBvaW50V29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogaGFzSGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIHNoYXBlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJvZHkKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGluZGV4IG9mIHRoZSBoaXQgdHJpYW5nbGUsIGlmIHRoZSBoaXQgc2hhcGUgd2FzIGEgdHJpbWVzaAogICAgICovCgogICAgLyoqCiAgICAgKiBEaXN0YW5jZSB0byB0aGUgaGl0LiBXaWxsIGJlIHNldCB0byAtMSBpZiB0aGVyZSB3YXMgbm8gaGl0CiAgICAgKi8KCiAgICAvKioKICAgICAqIElmIHRoZSByYXkgc2hvdWxkIHN0b3AgdHJhdmVyc2luZyB0aGUgYm9kaWVzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZCA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogUmVzZXQgYWxsIHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLnJheUZyb21Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMucmF5VG9Xb3JsZC5zZXRaZXJvKCk7CiAgICAgIHRoaXMuaGl0Tm9ybWFsV29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhpdFBvaW50V29ybGQuc2V0WmVybygpOwogICAgICB0aGlzLmhhc0hpdCA9IGZhbHNlOwogICAgICB0aGlzLnNoYXBlID0gbnVsbDsKICAgICAgdGhpcy5ib2R5ID0gbnVsbDsKICAgICAgdGhpcy5oaXRGYWNlSW5kZXggPSAtMTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IC0xOwogICAgICB0aGlzLnNob3VsZFN0b3AgPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogYWJvcnQKICAgICAqLwoKCiAgICBhYm9ydCgpIHsKICAgICAgdGhpcy5zaG91bGRTdG9wID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHJlc3VsdCBkYXRhLgogICAgICovCgoKICAgIHNldChyYXlGcm9tV29ybGQsIHJheVRvV29ybGQsIGhpdE5vcm1hbFdvcmxkLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpIHsKICAgICAgdGhpcy5yYXlGcm9tV29ybGQuY29weShyYXlGcm9tV29ybGQpOwogICAgICB0aGlzLnJheVRvV29ybGQuY29weShyYXlUb1dvcmxkKTsKICAgICAgdGhpcy5oaXROb3JtYWxXb3JsZC5jb3B5KGhpdE5vcm1hbFdvcmxkKTsKICAgICAgdGhpcy5oaXRQb2ludFdvcmxkLmNvcHkoaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMuc2hhcGUgPSBzaGFwZTsKICAgICAgdGhpcy5ib2R5ID0gYm9keTsKICAgICAgdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwogICAgfQoKICB9CgogIGxldCBfU2hhcGUkdHlwZXMkU1BIRVJFLCBfU2hhcGUkdHlwZXMkUExBTkUsIF9TaGFwZSR0eXBlcyRCT1gsIF9TaGFwZSR0eXBlcyRDWUxJTkRFUiwgX1NoYXBlJHR5cGVzJENPTlZFWFBPLCBfU2hhcGUkdHlwZXMkSEVJR0hURkksIF9TaGFwZSR0eXBlcyRUUklNRVNIOwoKICAvKioKICAgKiBSQVlfTU9ERVMKICAgKi8KICBjb25zdCBSQVlfTU9ERVMgPSB7CiAgICAvKiogQ0xPU0VTVCAqLwogICAgQ0xPU0VTVDogMSwKCiAgICAvKiogQU5ZICovCiAgICBBTlk6IDIsCgogICAgLyoqIEFMTCAqLwogICAgQUxMOiA0CiAgfTsKICAvKioKICAgKiBSYXlNb2RlCiAgICovCgogIF9TaGFwZSR0eXBlcyRTUEhFUkUgPSBTaGFwZS50eXBlcy5TUEhFUkU7CiAgX1NoYXBlJHR5cGVzJFBMQU5FID0gU2hhcGUudHlwZXMuUExBTkU7CiAgX1NoYXBlJHR5cGVzJEJPWCA9IFNoYXBlLnR5cGVzLkJPWDsKICBfU2hhcGUkdHlwZXMkQ1lMSU5ERVIgPSBTaGFwZS50eXBlcy5DWUxJTkRFUjsKICBfU2hhcGUkdHlwZXMkQ09OVkVYUE8gPSBTaGFwZS50eXBlcy5DT05WRVhQT0xZSEVEUk9OOwogIF9TaGFwZSR0eXBlcyRIRUlHSFRGSSA9IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxEOwogIF9TaGFwZSR0eXBlcyRUUklNRVNIID0gU2hhcGUudHlwZXMuVFJJTUVTSDsKCiAgLyoqCiAgICogQSBsaW5lIGluIDNEIHNwYWNlIHRoYXQgaW50ZXJzZWN0cyBib2RpZXMgYW5kIHJldHVybiBwb2ludHMuCiAgICovCiAgY2xhc3MgUmF5IHsKICAgIC8qKgogICAgICogZnJvbQogICAgICovCgogICAgLyoqCiAgICAgKiB0bwogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb24KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHByZWNpc2lvbiBvZiB0aGUgcmF5LiBVc2VkIHdoZW4gY2hlY2tpbmcgcGFyYWxsZWxpdHkgZXRjLgogICAgICogQGRlZmF1bHQgMC4wMDAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byBgZmFsc2VgIGlmIHlvdSBkb24ndCB3YW50IHRoZSBSYXkgdG8gdGFrZSBgY29sbGlzaW9uUmVzcG9uc2VgIGZsYWdzIGludG8gYWNjb3VudCBvbiBib2RpZXMgYW5kIHNoYXBlcy4KICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogSWYgc2V0IHRvIGB0cnVlYCwgdGhlIHJheSBza2lwcyBhbnkgaGl0cyB3aXRoIG5vcm1hbC5kb3QocmF5RGlyZWN0aW9uKSA8IDAuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJNYXNrCiAgICAgKiBAZGVmYXVsdCAtMQogICAgICovCgogICAgLyoqCiAgICAgKiBjb2xsaXNpb25GaWx0ZXJHcm91cAogICAgICogQGRlZmF1bHQgLTEKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGludGVyc2VjdGlvbiBtb2RlLiBTaG91bGQgYmUgUmF5LkFOWSwgUmF5LkFMTCBvciBSYXkuQ0xPU0VTVC4KICAgICAqIEBkZWZhdWx0IFJBWS5BTlkKICAgICAqLwoKICAgIC8qKgogICAgICogQ3VycmVudCByZXN1bHQgb2JqZWN0LgogICAgICovCgogICAgLyoqCiAgICAgKiBXaWxsIGJlIHNldCB0byBgdHJ1ZWAgZHVyaW5nIGludGVyc2VjdFdvcmxkKCkgaWYgdGhlIHJheSBoaXQgYW55dGhpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZXItcHJvdmlkZWQgcmVzdWx0IGNhbGxiYWNrLiBXaWxsIGJlIHVzZWQgaWYgbW9kZSBpcyBSYXkuQUxMLgogICAgICovCgogICAgLyoqCiAgICAgKiBDTE9TRVNUCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFOWQogICAgICovCgogICAgLyoqCiAgICAgKiBBTEwKICAgICAqLwogICAgZ2V0IFtfU2hhcGUkdHlwZXMkU1BIRVJFXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdFNwaGVyZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRQTEFORV0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RQbGFuZTsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRCT1hdKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0Qm94OwogICAgfQoKICAgIGdldCBbX1NoYXBlJHR5cGVzJENZTElOREVSXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleDsKICAgIH0KCiAgICBnZXQgW19TaGFwZSR0eXBlcyRDT05WRVhQT10oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RDb252ZXg7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkSEVJR0hURkldKCkgewogICAgICByZXR1cm4gdGhpcy5faW50ZXJzZWN0SGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtfU2hhcGUkdHlwZXMkVFJJTUVTSF0oKSB7CiAgICAgIHJldHVybiB0aGlzLl9pbnRlcnNlY3RUcmltZXNoOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKGZyb20sIHRvKSB7CiAgICAgIGlmIChmcm9tID09PSB2b2lkIDApIHsKICAgICAgICBmcm9tID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgaWYgKHRvID09PSB2b2lkIDApIHsKICAgICAgICB0byA9IG5ldyBWZWMzKCk7CiAgICAgIH0KCiAgICAgIHRoaXMuZnJvbSA9IGZyb20uY2xvbmUoKTsKICAgICAgdGhpcy50byA9IHRvLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5wcmVjaXNpb24gPSAwLjAwMDE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRydWU7CiAgICAgIHRoaXMuc2tpcEJhY2tmYWNlcyA9IGZhbHNlOwogICAgICB0aGlzLmNvbGxpc2lvbkZpbHRlck1hc2sgPSAtMTsKICAgICAgdGhpcy5jb2xsaXNpb25GaWx0ZXJHcm91cCA9IC0xOwogICAgICB0aGlzLm1vZGUgPSBSYXkuQU5ZOwogICAgICB0aGlzLnJlc3VsdCA9IG5ldyBSYXljYXN0UmVzdWx0KCk7CiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CgogICAgICB0aGlzLmNhbGxiYWNrID0gcmVzdWx0ID0+IHt9OwogICAgfQogICAgLyoqCiAgICAgKiBEbyBpdGVyc2VjdGlvbiBhZ2FpbnN0IGFsbCBib2RpZXMgaW4gdGhlIGdpdmVuIFdvcmxkLgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSByYXkgaGl0IGFueXRoaW5nLCBvdGhlcndpc2UgZmFsc2UuCiAgICAgKi8KCgogICAgaW50ZXJzZWN0V29ybGQod29ybGQsIG9wdGlvbnMpIHsKICAgICAgdGhpcy5tb2RlID0gb3B0aW9ucy5tb2RlIHx8IFJheS5BTlk7CiAgICAgIHRoaXMucmVzdWx0ID0gb3B0aW9ucy5yZXN1bHQgfHwgbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy5za2lwQmFja2ZhY2VzID0gISFvcHRpb25zLnNraXBCYWNrZmFjZXM7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyTWFzayA9IHR5cGVvZiBvcHRpb25zLmNvbGxpc2lvbkZpbHRlck1hc2sgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJNYXNrIDogLTE7CiAgICAgIHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgPSB0eXBlb2Ygb3B0aW9ucy5jb2xsaXNpb25GaWx0ZXJHcm91cCAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmNvbGxpc2lvbkZpbHRlckdyb3VwIDogLTE7CiAgICAgIHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHR5cGVvZiBvcHRpb25zLmNoZWNrQ29sbGlzaW9uUmVzcG9uc2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5jaGVja0NvbGxpc2lvblJlc3BvbnNlIDogdHJ1ZTsKCiAgICAgIGlmIChvcHRpb25zLmZyb20pIHsKICAgICAgICB0aGlzLmZyb20uY29weShvcHRpb25zLmZyb20pOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy50bykgewogICAgICAgIHRoaXMudG8uY29weShvcHRpb25zLnRvKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWxsYmFjayA9IG9wdGlvbnMuY2FsbGJhY2sgfHwgKCgpID0+IHt9KTsKCiAgICAgIHRoaXMuaGFzSGl0ID0gZmFsc2U7CiAgICAgIHRoaXMucmVzdWx0LnJlc2V0KCk7CiAgICAgIHRoaXMudXBkYXRlRGlyZWN0aW9uKCk7CiAgICAgIHRoaXMuZ2V0QUFCQih0bXBBQUJCJDEpOwogICAgICB0bXBBcnJheS5sZW5ndGggPSAwOwogICAgICB3b3JsZC5icm9hZHBoYXNlLmFhYmJRdWVyeSh3b3JsZCwgdG1wQUFCQiQxLCB0bXBBcnJheSk7CiAgICAgIHRoaXMuaW50ZXJzZWN0Qm9kaWVzKHRtcEFycmF5KTsKICAgICAgcmV0dXJuIHRoaXMuaGFzSGl0OwogICAgfQogICAgLyoqCiAgICAgKiBTaG9vdCBhIHJheSBhdCBhIGJvZHksIGdldCBiYWNrIGluZm9ybWF0aW9uIGFib3V0IHRoZSBoaXQuCiAgICAgKiBAZGVwcmVjYXRlZCBAcGFyYW0gcmVzdWx0IHNldCB0aGUgcmVzdWx0IHByb3BlcnR5IG9mIHRoZSBSYXkgaW5zdGVhZC4KICAgICAqLwoKCiAgICBpbnRlcnNlY3RCb2R5KGJvZHksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgY29uc3QgY2hlY2tDb2xsaXNpb25SZXNwb25zZSA9IHRoaXMuY2hlY2tDb2xsaXNpb25SZXNwb25zZTsKCiAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFib2R5LmNvbGxpc2lvblJlc3BvbnNlKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoKHRoaXMuY29sbGlzaW9uRmlsdGVyR3JvdXAgJiBib2R5LmNvbGxpc2lvbkZpbHRlck1hc2spID09PSAwIHx8IChib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwICYgdGhpcy5jb2xsaXNpb25GaWx0ZXJNYXNrKSA9PT0gMCkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3QgeGkgPSBpbnRlcnNlY3RCb2R5X3hpOwogICAgICBjb25zdCBxaSA9IGludGVyc2VjdEJvZHlfcWk7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IGJvZHkuc2hhcGVzLmxlbmd0aDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHNoYXBlID0gYm9keS5zaGFwZXNbaV07CgogICAgICAgIGlmIChjaGVja0NvbGxpc2lvblJlc3BvbnNlICYmICFzaGFwZS5jb2xsaXNpb25SZXNwb25zZSkgewogICAgICAgICAgY29udGludWU7IC8vIFNraXAKICAgICAgICB9CgogICAgICAgIGJvZHkucXVhdGVybmlvbi5tdWx0KGJvZHkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICBib2R5LnF1YXRlcm5pb24udm11bHQoYm9keS5zaGFwZU9mZnNldHNbaV0sIHhpKTsKICAgICAgICB4aS52YWRkKGJvZHkucG9zaXRpb24sIHhpKTsKICAgICAgICB0aGlzLmludGVyc2VjdFNoYXBlKHNoYXBlLCBxaSwgeGksIGJvZHkpOwoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFNob290IGEgcmF5IGF0IGFuIGFycmF5IGJvZGllcywgZ2V0IGJhY2sgaW5mb3JtYXRpb24gYWJvdXQgdGhlIGhpdC4KICAgICAqIEBwYXJhbSBib2RpZXMgQW4gYXJyYXkgb2YgQm9keSBvYmplY3RzLgogICAgICogQGRlcHJlY2F0ZWQgQHBhcmFtIHJlc3VsdCBzZXQgdGhlIHJlc3VsdCBwcm9wZXJ0eSBvZiB0aGUgUmF5IGluc3RlYWQuCiAgICAgKgogICAgICovCgoKICAgIGludGVyc2VjdEJvZGllcyhib2RpZXMsIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0KSB7CiAgICAgICAgdGhpcy5yZXN1bHQgPSByZXN1bHQ7CiAgICAgICAgdGhpcy51cGRhdGVEaXJlY3Rpb24oKTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBib2RpZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpIDwgbDsgaSsrKSB7CiAgICAgICAgdGhpcy5pbnRlcnNlY3RCb2R5KGJvZGllc1tpXSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIHZlY3Rvci4KICAgICAqLwoKCiAgICB1cGRhdGVEaXJlY3Rpb24oKSB7CiAgICAgIHRoaXMudG8udnN1Yih0aGlzLmZyb20sIHRoaXMuZGlyZWN0aW9uKTsKICAgICAgdGhpcy5kaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICB9CgogICAgaW50ZXJzZWN0U2hhcGUoc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5KSB7CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207IC8vIENoZWNraW5nIGJvdW5kaW5nU3BoZXJlCgogICAgICBjb25zdCBkaXN0YW5jZSA9IGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCB0aGlzLmRpcmVjdGlvbiwgcG9zaXRpb24pOwoKICAgICAgaWYgKGRpc3RhbmNlID4gc2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGludGVyc2VjdE1ldGhvZCA9IHRoaXNbc2hhcGUudHlwZV07CgogICAgICBpZiAoaW50ZXJzZWN0TWV0aG9kKSB7CiAgICAgICAgaW50ZXJzZWN0TWV0aG9kLmNhbGwodGhpcywgc2hhcGUsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCBzaGFwZSk7CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Qm94KGJveCwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgcmV0dXJuIHRoaXMuX2ludGVyc2VjdENvbnZleChib3guY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSk7CiAgICB9CgogICAgX2ludGVyc2VjdFBsYW5lKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBjb25zdCBmcm9tID0gdGhpcy5mcm9tOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGRpcmVjdGlvbiA9IHRoaXMuZGlyZWN0aW9uOyAvLyBHZXQgcGxhbmUgbm9ybWFsCgogICAgICBjb25zdCB3b3JsZE5vcm1hbCA9IG5ldyBWZWMzKDAsIDAsIDEpOwogICAgICBxdWF0LnZtdWx0KHdvcmxkTm9ybWFsLCB3b3JsZE5vcm1hbCk7CiAgICAgIGNvbnN0IGxlbiA9IG5ldyBWZWMzKCk7CiAgICAgIGZyb20udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb0Zyb20gPSBsZW4uZG90KHdvcmxkTm9ybWFsKTsKICAgICAgdG8udnN1Yihwb3NpdGlvbiwgbGVuKTsKICAgICAgY29uc3QgcGxhbmVUb1RvID0gbGVuLmRvdCh3b3JsZE5vcm1hbCk7CgogICAgICBpZiAocGxhbmVUb0Zyb20gKiBwbGFuZVRvVG8gPiAwKSB7CiAgICAgICAgLy8gImZyb20iIGFuZCAidG8iIGFyZSBvbiB0aGUgc2FtZSBzaWRlIG9mIHRoZSBwbGFuZS4uLiBiYWlsIG91dAogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgaWYgKGZyb20uZGlzdGFuY2VUbyh0bykgPCBwbGFuZVRvRnJvbSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgY29uc3Qgbl9kb3RfZGlyID0gd29ybGROb3JtYWwuZG90KGRpcmVjdGlvbik7CgogICAgICBpZiAoTWF0aC5hYnMobl9kb3RfZGlyKSA8IHRoaXMucHJlY2lzaW9uKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBjb25zdCBwbGFuZVBvaW50VG9Gcm9tID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgZGlyX3NjYWxlZF93aXRoX3QgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoaXRQb2ludFdvcmxkID0gbmV3IFZlYzMoKTsKICAgICAgZnJvbS52c3ViKHBvc2l0aW9uLCBwbGFuZVBvaW50VG9Gcm9tKTsKICAgICAgY29uc3QgdCA9IC13b3JsZE5vcm1hbC5kb3QocGxhbmVQb2ludFRvRnJvbSkgLyBuX2RvdF9kaXI7CiAgICAgIGRpcmVjdGlvbi5zY2FsZSh0LCBkaXJfc2NhbGVkX3dpdGhfdCk7CiAgICAgIGZyb20udmFkZChkaXJfc2NhbGVkX3dpdGhfdCwgaGl0UG9pbnRXb3JsZCk7CiAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKHdvcmxkTm9ybWFsLCBoaXRQb2ludFdvcmxkLCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgd29ybGQgQUFCQiBvZiB0aGUgcmF5LgogICAgICovCgoKICAgIGdldEFBQkIoYWFiYikgewogICAgICBjb25zdCB7CiAgICAgICAgbG93ZXJCb3VuZCwKICAgICAgICB1cHBlckJvdW5kCiAgICAgIH0gPSBhYWJiOwogICAgICBjb25zdCB0byA9IHRoaXMudG87CiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGxvd2VyQm91bmQueCA9IE1hdGgubWluKHRvLngsIGZyb20ueCk7CiAgICAgIGxvd2VyQm91bmQueSA9IE1hdGgubWluKHRvLnksIGZyb20ueSk7CiAgICAgIGxvd2VyQm91bmQueiA9IE1hdGgubWluKHRvLnosIGZyb20ueik7CiAgICAgIHVwcGVyQm91bmQueCA9IE1hdGgubWF4KHRvLngsIGZyb20ueCk7CiAgICAgIHVwcGVyQm91bmQueSA9IE1hdGgubWF4KHRvLnksIGZyb20ueSk7CiAgICAgIHVwcGVyQm91bmQueiA9IE1hdGgubWF4KHRvLnosIGZyb20ueik7CiAgICB9CgogICAgX2ludGVyc2VjdEhlaWdodGZpZWxkKHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSkgewogICAgICBzaGFwZS5kYXRhOwogICAgICBzaGFwZS5lbGVtZW50U2l6ZTsgLy8gQ29udmVydCB0aGUgcmF5IHRvIGxvY2FsIGhlaWdodGZpZWxkIGNvb3JkaW5hdGVzCgogICAgICBjb25zdCBsb2NhbFJheSA9IGludGVyc2VjdEhlaWdodGZpZWxkX2xvY2FsUmF5OyAvL25ldyBSYXkodGhpcy5mcm9tLCB0aGlzLnRvKTsKCiAgICAgIGxvY2FsUmF5LmZyb20uY29weSh0aGlzLmZyb20pOwogICAgICBsb2NhbFJheS50by5jb3B5KHRoaXMudG8pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LmZyb20sIGxvY2FsUmF5LmZyb20pOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb0xvY2FsRnJhbWUocG9zaXRpb24sIHF1YXQsIGxvY2FsUmF5LnRvLCBsb2NhbFJheS50byk7CiAgICAgIGxvY2FsUmF5LnVwZGF0ZURpcmVjdGlvbigpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGNvbnN0IGluZGV4ID0gaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXg7CiAgICAgIGxldCBpTWluWDsKICAgICAgbGV0IGlNaW5ZOwogICAgICBsZXQgaU1heFg7CiAgICAgIGxldCBpTWF4WTsgLy8gU2V0IHRvIG1heAoKICAgICAgaU1pblggPSBpTWluWSA9IDA7CiAgICAgIGlNYXhYID0gaU1heFkgPSBzaGFwZS5kYXRhLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGFhYmIgPSBuZXcgQUFCQigpOwogICAgICBsb2NhbFJheS5nZXRBQUJCKGFhYmIpOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi5sb3dlckJvdW5kLngsIGFhYmIubG93ZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNaW5YID0gTWF0aC5tYXgoaU1pblgsIGluZGV4WzBdKTsKICAgICAgaU1pblkgPSBNYXRoLm1heChpTWluWSwgaW5kZXhbMV0pOwogICAgICBzaGFwZS5nZXRJbmRleE9mUG9zaXRpb24oYWFiYi51cHBlckJvdW5kLngsIGFhYmIudXBwZXJCb3VuZC55LCBpbmRleCwgdHJ1ZSk7CiAgICAgIGlNYXhYID0gTWF0aC5taW4oaU1heFgsIGluZGV4WzBdICsgMSk7CiAgICAgIGlNYXhZID0gTWF0aC5taW4oaU1heFksIGluZGV4WzFdICsgMSk7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgaWYgKHRoaXMucmVzdWx0LnNob3VsZFN0b3ApIHsKICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgfQoKICAgICAgICAgIHNoYXBlLmdldEFhYmJBdEluZGV4KGksIGosIGFhYmIpOwoKICAgICAgICAgIGlmICghYWFiYi5vdmVybGFwc1JheShsb2NhbFJheSkpIHsKICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICB9IC8vIExvd2VyIHRyaWFuZ2xlCgoKICAgICAgICAgIHNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShwb3NpdGlvbiwgcXVhdCwgc2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgdGhpcy5faW50ZXJzZWN0Q29udmV4KHNoYXBlLnBpbGxhckNvbnZleCwgcXVhdCwgd29ybGRQaWxsYXJPZmZzZXQsIGJvZHksIHJlcG9ydGVkU2hhcGUsIGludGVyc2VjdENvbnZleE9wdGlvbnMpOwoKICAgICAgICAgIGlmICh0aGlzLnJlc3VsdC5zaG91bGRTdG9wKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgc2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgdHJ1ZSk7CiAgICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIHNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIHRoaXMuX2ludGVyc2VjdENvbnZleChzaGFwZS5waWxsYXJDb252ZXgsIHF1YXQsIHdvcmxkUGlsbGFyT2Zmc2V0LCBib2R5LCByZXBvcnRlZFNoYXBlLCBpbnRlcnNlY3RDb252ZXhPcHRpb25zKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0U3BoZXJlKHNwaGVyZSwgcXVhdCwgcG9zaXRpb24sIGJvZHksIHJlcG9ydGVkU2hhcGUpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCByID0gc3BoZXJlLnJhZGl1czsKICAgICAgY29uc3QgYSA9ICh0by54IC0gZnJvbS54KSAqKiAyICsgKHRvLnkgLSBmcm9tLnkpICoqIDIgKyAodG8ueiAtIGZyb20ueikgKiogMjsKICAgICAgY29uc3QgYiA9IDIgKiAoKHRvLnggLSBmcm9tLngpICogKGZyb20ueCAtIHBvc2l0aW9uLngpICsgKHRvLnkgLSBmcm9tLnkpICogKGZyb20ueSAtIHBvc2l0aW9uLnkpICsgKHRvLnogLSBmcm9tLnopICogKGZyb20ueiAtIHBvc2l0aW9uLnopKTsKICAgICAgY29uc3QgYyA9IChmcm9tLnggLSBwb3NpdGlvbi54KSAqKiAyICsgKGZyb20ueSAtIHBvc2l0aW9uLnkpICoqIDIgKyAoZnJvbS56IC0gcG9zaXRpb24ueikgKiogMiAtIHIgKiogMjsKICAgICAgY29uc3QgZGVsdGEgPSBiICoqIDIgLSA0ICogYSAqIGM7CiAgICAgIGNvbnN0IGludGVyc2VjdGlvblBvaW50ID0gUmF5X2ludGVyc2VjdFNwaGVyZV9pbnRlcnNlY3Rpb25Qb2ludDsKICAgICAgY29uc3Qgbm9ybWFsID0gUmF5X2ludGVyc2VjdFNwaGVyZV9ub3JtYWw7CgogICAgICBpZiAoZGVsdGEgPCAwKSB7CiAgICAgICAgLy8gTm8gaW50ZXJzZWN0aW9uCiAgICAgICAgcmV0dXJuOwogICAgICB9IGVsc2UgaWYgKGRlbHRhID09PSAwKSB7CiAgICAgICAgLy8gc2luZ2xlIGludGVyc2VjdGlvbiBwb2ludAogICAgICAgIGZyb20ubGVycCh0bywgZGVsdGEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICBpbnRlcnNlY3Rpb25Qb2ludC52c3ViKHBvc2l0aW9uLCBub3JtYWwpOwogICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgY29uc3QgZDEgPSAoLWIgLSBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CiAgICAgICAgY29uc3QgZDIgPSAoLWIgKyBNYXRoLnNxcnQoZGVsdGEpKSAvICgyICogYSk7CgogICAgICAgIGlmIChkMSA+PSAwICYmIGQxIDw9IDEpIHsKICAgICAgICAgIGZyb20ubGVycCh0bywgZDEsIGludGVyc2VjdGlvblBvaW50KTsKICAgICAgICAgIGludGVyc2VjdGlvblBvaW50LnZzdWIocG9zaXRpb24sIG5vcm1hbCk7CiAgICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdGlvblBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCAtMSk7CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5yZXN1bHQuc2hvdWxkU3RvcCkgewogICAgICAgICAgcmV0dXJuOwogICAgICAgIH0KCiAgICAgICAgaWYgKGQyID49IDAgJiYgZDIgPD0gMSkgewogICAgICAgICAgZnJvbS5sZXJwKHRvLCBkMiwgaW50ZXJzZWN0aW9uUG9pbnQpOwogICAgICAgICAgaW50ZXJzZWN0aW9uUG9pbnQudnN1Yihwb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgICAgIG5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgICAgIHRoaXMucmVwb3J0SW50ZXJzZWN0aW9uKG5vcm1hbCwgaW50ZXJzZWN0aW9uUG9pbnQsIHJlcG9ydGVkU2hhcGUsIGJvZHksIC0xKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBfaW50ZXJzZWN0Q29udmV4KHNoYXBlLCBxdWF0LCBwb3NpdGlvbiwgYm9keSwgcmVwb3J0ZWRTaGFwZSwgb3B0aW9ucykgewogICAgICBjb25zdCBub3JtYWwgPSBpbnRlcnNlY3RDb252ZXhfbm9ybWFsOwogICAgICBjb25zdCB2ZWN0b3IgPSBpbnRlcnNlY3RDb252ZXhfdmVjdG9yOwogICAgICBjb25zdCBmYWNlTGlzdCA9IG9wdGlvbnMgJiYgb3B0aW9ucy5mYWNlTGlzdCB8fCBudWxsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgZmFjZXMgPSBzaGFwZS5mYWNlczsKICAgICAgY29uc3QgdmVydGljZXMgPSBzaGFwZS52ZXJ0aWNlczsKICAgICAgY29uc3Qgbm9ybWFscyA9IHNoYXBlLmZhY2VOb3JtYWxzOwogICAgICBjb25zdCBkaXJlY3Rpb24gPSB0aGlzLmRpcmVjdGlvbjsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBmcm9tVG9EaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyh0byk7CiAgICAgIGNvbnN0IE5mYWNlcyA9IGZhY2VMaXN0ID8gZmFjZUxpc3QubGVuZ3RoIDogZmFjZXMubGVuZ3RoOwogICAgICBjb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdDsKCiAgICAgIGZvciAobGV0IGogPSAwOyAhcmVzdWx0LnNob3VsZFN0b3AgJiYgaiA8IE5mYWNlczsgaisrKSB7CiAgICAgICAgY29uc3QgZmkgPSBmYWNlTGlzdCA/IGZhY2VMaXN0W2pdIDogajsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbZmldOwogICAgICAgIGNvbnN0IGZhY2VOb3JtYWwgPSBub3JtYWxzW2ZpXTsKICAgICAgICBjb25zdCBxID0gcXVhdDsKICAgICAgICBjb25zdCB4ID0gcG9zaXRpb247IC8vIGRldGVybWluZSBpZiByYXkgaW50ZXJzZWN0cyB0aGUgcGxhbmUgb2YgdGhlIGZhY2UKICAgICAgICAvLyBub3RlOiB0aGlzIHdvcmtzIHJlZ2FyZGxlc3Mgb2YgdGhlIGRpcmVjdGlvbiBvZiB0aGUgZmFjZSBub3JtYWwKICAgICAgICAvLyBHZXQgcGxhbmUgcG9pbnQgaW4gd29ybGQgY29vcmRpbmF0ZXMuLi4KCiAgICAgICAgdmVjdG9yLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQodmVjdG9yLCB2ZWN0b3IpOwogICAgICAgIHZlY3Rvci52YWRkKHgsIHZlY3Rvcik7IC8vIC4uLmJ1dCBtYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSByYXkgZnJvbS4gV2UnbGwgZml4IHRoaXMgbGF0ZXIuCgogICAgICAgIHZlY3Rvci52c3ViKGZyb20sIHZlY3Rvcik7IC8vIEdldCBwbGFuZSBub3JtYWwKCiAgICAgICAgcS52bXVsdChmYWNlTm9ybWFsLCBub3JtYWwpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBkaXJlY3Rpb24uZG90KG5vcm1hbCk7IC8vIEJhaWwgb3V0IGlmIHJheSBhbmQgcGxhbmUgYXJlIHBhcmFsbGVsCgogICAgICAgIGlmIChNYXRoLmFicyhkb3QpIDwgdGhpcy5wcmVjaXNpb24pIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKCiAgICAgICAgY29uc3Qgc2NhbGFyID0gbm9ybWFsLmRvdCh2ZWN0b3IpIC8gZG90OyAvLyBpZiBuZWdhdGl2ZSBkaXN0YW5jZSwgdGhlbiBwbGFuZSBpcyBiZWhpbmQgcmF5CgogICAgICAgIGlmIChzY2FsYXIgPCAwKSB7CiAgICAgICAgICBjb250aW51ZTsKICAgICAgICB9IC8vIGlmIChkb3QgPCAwKSB7CiAgICAgICAgLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGRpcmVjdGlvbi5zY2FsZShzY2FsYXIsIGludGVyc2VjdFBvaW50KTsKICAgICAgICBpbnRlcnNlY3RQb2ludC52YWRkKGZyb20sIGludGVyc2VjdFBvaW50KTsgLy8gYSBpcyB0aGUgcG9pbnQgd2UgY29tcGFyZSBwb2ludHMgYiBhbmQgYyB3aXRoLgoKICAgICAgICBhLmNvcHkodmVydGljZXNbZmFjZVswXV0pOwogICAgICAgIHEudm11bHQoYSwgYSk7CiAgICAgICAgeC52YWRkKGEsIGEpOwoKICAgICAgICBmb3IgKGxldCBpID0gMTsgIXJlc3VsdC5zaG91bGRTdG9wICYmIGkgPCBmYWNlLmxlbmd0aCAtIDE7IGkrKykgewogICAgICAgICAgLy8gVHJhbnNmb3JtIDMgdmVydGljZXMgdG8gd29ybGQgY29vcmRzCiAgICAgICAgICBiLmNvcHkodmVydGljZXNbZmFjZVtpXV0pOwogICAgICAgICAgYy5jb3B5KHZlcnRpY2VzW2ZhY2VbaSArIDFdXSk7CiAgICAgICAgICBxLnZtdWx0KGIsIGIpOwogICAgICAgICAgcS52bXVsdChjLCBjKTsKICAgICAgICAgIHgudmFkZChiLCBiKTsKICAgICAgICAgIHgudmFkZChjLCBjKTsKICAgICAgICAgIGNvbnN0IGRpc3RhbmNlID0gaW50ZXJzZWN0UG9pbnQuZGlzdGFuY2VUbyhmcm9tKTsKCiAgICAgICAgICBpZiAoIShSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBhLCBiLCBjKSB8fCBSYXkucG9pbnRJblRyaWFuZ2xlKGludGVyc2VjdFBvaW50LCBiLCBhLCBjKSkgfHwgZGlzdGFuY2UgPiBmcm9tVG9EaXN0YW5jZSkgewogICAgICAgICAgICBjb250aW51ZTsKICAgICAgICAgIH0KCiAgICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGludGVyc2VjdFBvaW50LCByZXBvcnRlZFNoYXBlLCBib2R5LCBmaSk7CiAgICAgICAgfSAvLyB9CgogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEB0b2RvIE9wdGltaXplIGJ5IHRyYW5zZm9ybWluZyB0aGUgd29ybGQgdG8gbG9jYWwgc3BhY2UgZmlyc3QuCiAgICAgKiBAdG9kbyBVc2UgT2N0cmVlIGxvb2t1cAogICAgICovCgoKICAgIF9pbnRlcnNlY3RUcmltZXNoKG1lc2gsIHF1YXQsIHBvc2l0aW9uLCBib2R5LCByZXBvcnRlZFNoYXBlLCBvcHRpb25zKSB7CiAgICAgIGNvbnN0IG5vcm1hbCA9IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBpbnRlcnNlY3RUcmltZXNoX3RyaWFuZ2xlczsKICAgICAgY29uc3QgdHJlZVRyYW5zZm9ybSA9IGludGVyc2VjdFRyaW1lc2hfdHJlZVRyYW5zZm9ybTsKICAgICAgY29uc3QgdmVjdG9yID0gaW50ZXJzZWN0Q29udmV4X3ZlY3RvcjsKICAgICAgY29uc3QgbG9jYWxEaXJlY3Rpb24gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uOwogICAgICBjb25zdCBsb2NhbEZyb20gPSBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbTsKICAgICAgY29uc3QgbG9jYWxUbyA9IGludGVyc2VjdFRyaW1lc2hfbG9jYWxUbzsKICAgICAgY29uc3Qgd29ybGRJbnRlcnNlY3RQb2ludCA9IGludGVyc2VjdFRyaW1lc2hfd29ybGRJbnRlcnNlY3RQb2ludDsKICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsOyAvLyBDaGVja2luZyBmYWNlcwoKICAgICAgY29uc3QgaW5kaWNlcyA9IG1lc2guaW5kaWNlczsKICAgICAgbWVzaC52ZXJ0aWNlczsgLy8gY29uc3Qgbm9ybWFscyA9IG1lc2guZmFjZU5vcm1hbHMKCiAgICAgIGNvbnN0IGZyb20gPSB0aGlzLmZyb207CiAgICAgIGNvbnN0IHRvID0gdGhpcy50bzsKICAgICAgY29uc3QgZGlyZWN0aW9uID0gdGhpcy5kaXJlY3Rpb247CiAgICAgIHRyZWVUcmFuc2Zvcm0ucG9zaXRpb24uY29weShwb3NpdGlvbik7CiAgICAgIHRyZWVUcmFuc2Zvcm0ucXVhdGVybmlvbi5jb3B5KHF1YXQpOyAvLyBUcmFuc2Zvcm0gcmF5IHRvIGxvY2FsIHNwYWNlIQoKICAgICAgVHJhbnNmb3JtLnZlY3RvclRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZGlyZWN0aW9uLCBsb2NhbERpcmVjdGlvbik7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShwb3NpdGlvbiwgcXVhdCwgZnJvbSwgbG9jYWxGcm9tKTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKHBvc2l0aW9uLCBxdWF0LCB0bywgbG9jYWxUbyk7CiAgICAgIGxvY2FsVG8ueCAqPSBtZXNoLnNjYWxlLng7CiAgICAgIGxvY2FsVG8ueSAqPSBtZXNoLnNjYWxlLnk7CiAgICAgIGxvY2FsVG8ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsRnJvbS54ICo9IG1lc2guc2NhbGUueDsKICAgICAgbG9jYWxGcm9tLnkgKj0gbWVzaC5zY2FsZS55OwogICAgICBsb2NhbEZyb20ueiAqPSBtZXNoLnNjYWxlLno7CiAgICAgIGxvY2FsVG8udnN1Yihsb2NhbEZyb20sIGxvY2FsRGlyZWN0aW9uKTsKICAgICAgbG9jYWxEaXJlY3Rpb24ubm9ybWFsaXplKCk7CiAgICAgIGNvbnN0IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCA9IGxvY2FsRnJvbS5kaXN0YW5jZVNxdWFyZWQobG9jYWxUbyk7CiAgICAgIG1lc2gudHJlZS5yYXlRdWVyeSh0aGlzLCB0cmVlVHJhbnNmb3JtLCB0cmlhbmdsZXMpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB0cmlhbmdsZXMubGVuZ3RoOyAhdGhpcy5yZXN1bHQuc2hvdWxkU3RvcCAmJiBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCB0cmlhbmdsZXNJbmRleCA9IHRyaWFuZ2xlc1tpXTsKICAgICAgICBtZXNoLmdldE5vcm1hbCh0cmlhbmdsZXNJbmRleCwgbm9ybWFsKTsgLy8gZGV0ZXJtaW5lIGlmIHJheSBpbnRlcnNlY3RzIHRoZSBwbGFuZSBvZiB0aGUgZmFjZQogICAgICAgIC8vIG5vdGU6IHRoaXMgd29ya3MgcmVnYXJkbGVzcyBvZiB0aGUgZGlyZWN0aW9uIG9mIHRoZSBmYWNlIG5vcm1hbAogICAgICAgIC8vIEdldCBwbGFuZSBwb2ludCBpbiB3b3JsZCBjb29yZGluYXRlcy4uLgoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogM10sIGEpOyAvLyAuLi5idXQgbWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgcmF5IGZyb20uIFdlJ2xsIGZpeCB0aGlzIGxhdGVyLgoKICAgICAgICBhLnZzdWIobG9jYWxGcm9tLCB2ZWN0b3IpOyAvLyBJZiB0aGlzIGRvdCBwcm9kdWN0IGlzIG5lZ2F0aXZlLCB3ZSBoYXZlIHNvbWV0aGluZyBpbnRlcmVzdGluZwoKICAgICAgICBjb25zdCBkb3QgPSBsb2NhbERpcmVjdGlvbi5kb3Qobm9ybWFsKTsgLy8gQmFpbCBvdXQgaWYgcmF5IGFuZCBwbGFuZSBhcmUgcGFyYWxsZWwKICAgICAgICAvLyBpZiAoTWF0aC5hYnMoIGRvdCApIDwgdGhpcy5wcmVjaXNpb24pewogICAgICAgIC8vICAgICBjb250aW51ZTsKICAgICAgICAvLyB9CiAgICAgICAgLy8gY2FsYyBkaXN0YW5jZSB0byBwbGFuZQoKICAgICAgICBjb25zdCBzY2FsYXIgPSBub3JtYWwuZG90KHZlY3RvcikgLyBkb3Q7IC8vIGlmIG5lZ2F0aXZlIGRpc3RhbmNlLCB0aGVuIHBsYW5lIGlzIGJlaGluZCByYXkKCiAgICAgICAgaWYgKHNjYWxhciA8IDApIHsKICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgIH0gLy8gSW50ZXJzZWN0aW9uIHBvaW50IGlzIGZyb20gKyBkaXJlY3Rpb24gKiBzY2FsYXIKCgogICAgICAgIGxvY2FsRGlyZWN0aW9uLnNjYWxlKHNjYWxhciwgaW50ZXJzZWN0UG9pbnQpOwogICAgICAgIGludGVyc2VjdFBvaW50LnZhZGQobG9jYWxGcm9tLCBpbnRlcnNlY3RQb2ludCk7IC8vIEdldCB0cmlhbmdsZSB2ZXJ0aWNlcwoKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDFdLCBiKTsKICAgICAgICBtZXNoLmdldFZlcnRleChpbmRpY2VzW3RyaWFuZ2xlc0luZGV4ICogMyArIDJdLCBjKTsKICAgICAgICBjb25zdCBzcXVhcmVkRGlzdGFuY2UgPSBpbnRlcnNlY3RQb2ludC5kaXN0YW5jZVNxdWFyZWQobG9jYWxGcm9tKTsKCiAgICAgICAgaWYgKCEoUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYiwgYSwgYykgfHwgUmF5LnBvaW50SW5UcmlhbmdsZShpbnRlcnNlY3RQb2ludCwgYSwgYiwgYykpIHx8IHNxdWFyZWREaXN0YW5jZSA+IGZyb21Ub0Rpc3RhbmNlU3F1YXJlZCkgewogICAgICAgICAgY29udGludWU7CiAgICAgICAgfSAvLyB0cmFuc2Zvcm0gaW50ZXJzZWN0cG9pbnQgYW5kIG5vcm1hbCB0byB3b3JsZAoKCiAgICAgICAgVHJhbnNmb3JtLnZlY3RvclRvV29ybGRGcmFtZShxdWF0LCBub3JtYWwsIHdvcmxkTm9ybWFsKTsKICAgICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zaXRpb24sIHF1YXQsIGludGVyc2VjdFBvaW50LCB3b3JsZEludGVyc2VjdFBvaW50KTsKICAgICAgICB0aGlzLnJlcG9ydEludGVyc2VjdGlvbih3b3JsZE5vcm1hbCwgd29ybGRJbnRlcnNlY3RQb2ludCwgcmVwb3J0ZWRTaGFwZSwgYm9keSwgdHJpYW5nbGVzSW5kZXgpOwogICAgICB9CgogICAgICB0cmlhbmdsZXMubGVuZ3RoID0gMDsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBUcnVlIGlmIHRoZSBpbnRlcnNlY3Rpb25zIHNob3VsZCBjb250aW51ZQogICAgICovCgoKICAgIHJlcG9ydEludGVyc2VjdGlvbihub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBoaXRGYWNlSW5kZXgpIHsKICAgICAgY29uc3QgZnJvbSA9IHRoaXMuZnJvbTsKICAgICAgY29uc3QgdG8gPSB0aGlzLnRvOwogICAgICBjb25zdCBkaXN0YW5jZSA9IGZyb20uZGlzdGFuY2VUbyhoaXRQb2ludFdvcmxkKTsKICAgICAgY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHQ7IC8vIFNraXAgYmFjayBmYWNlcz8KCiAgICAgIGlmICh0aGlzLnNraXBCYWNrZmFjZXMgJiYgbm9ybWFsLmRvdCh0aGlzLmRpcmVjdGlvbikgPiAwKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICByZXN1bHQuaGl0RmFjZUluZGV4ID0gdHlwZW9mIGhpdEZhY2VJbmRleCAhPT0gJ3VuZGVmaW5lZCcgPyBoaXRGYWNlSW5kZXggOiAtMTsKCiAgICAgIHN3aXRjaCAodGhpcy5tb2RlKSB7CiAgICAgICAgY2FzZSBSYXkuQUxMOgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0LnNldChmcm9tLCB0bywgbm9ybWFsLCBoaXRQb2ludFdvcmxkLCBzaGFwZSwgYm9keSwgZGlzdGFuY2UpOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICB0aGlzLmNhbGxiYWNrKHJlc3VsdCk7CiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQ0xPU0VTVDoKICAgICAgICAgIC8vIFN0b3JlIGlmIGNsb3NlciB0aGFuIGN1cnJlbnQgY2xvc2VzdAogICAgICAgICAgaWYgKGRpc3RhbmNlIDwgcmVzdWx0LmRpc3RhbmNlIHx8ICFyZXN1bHQuaGFzSGl0KSB7CiAgICAgICAgICAgIHRoaXMuaGFzSGl0ID0gdHJ1ZTsKICAgICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICAgIHJlc3VsdC5zZXQoZnJvbSwgdG8sIG5vcm1hbCwgaGl0UG9pbnRXb3JsZCwgc2hhcGUsIGJvZHksIGRpc3RhbmNlKTsKICAgICAgICAgIH0KCiAgICAgICAgICBicmVhazsKCiAgICAgICAgY2FzZSBSYXkuQU5ZOgogICAgICAgICAgLy8gUmVwb3J0IGFuZCBzdG9wLgogICAgICAgICAgdGhpcy5oYXNIaXQgPSB0cnVlOwogICAgICAgICAgcmVzdWx0Lmhhc0hpdCA9IHRydWU7CiAgICAgICAgICByZXN1bHQuc2V0KGZyb20sIHRvLCBub3JtYWwsIGhpdFBvaW50V29ybGQsIHNoYXBlLCBib2R5LCBkaXN0YW5jZSk7CiAgICAgICAgICByZXN1bHQuc2hvdWxkU3RvcCA9IHRydWU7CiAgICAgICAgICBicmVhazsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBBcyBwZXIgIkJhcnljZW50cmljIFRlY2huaXF1ZSIgYXMgbmFtZWQKICAgICAqIHtAbGluayBodHRwczovL3d3dy5ibGFja3Bhd24uY29tL3RleHRzL3BvaW50aW5wb2x5L2RlZmF1bHQuaHRtbCBoZXJlfSBidXQgd2l0aG91dCB0aGUgZGl2aXNpb24KICAgICAqLwoKCiAgICBzdGF0aWMgcG9pbnRJblRyaWFuZ2xlKHAsIGEsIGIsIGMpIHsKICAgICAgYy52c3ViKGEsIHYwKTsKICAgICAgYi52c3ViKGEsIHYxKTsKICAgICAgcC52c3ViKGEsIHYyKTsKICAgICAgY29uc3QgZG90MDAgPSB2MC5kb3QodjApOwogICAgICBjb25zdCBkb3QwMSA9IHYwLmRvdCh2MSk7CiAgICAgIGNvbnN0IGRvdDAyID0gdjAuZG90KHYyKTsKICAgICAgY29uc3QgZG90MTEgPSB2MS5kb3QodjEpOwogICAgICBjb25zdCBkb3QxMiA9IHYxLmRvdCh2Mik7CiAgICAgIGxldCB1OwogICAgICBsZXQgdjsKICAgICAgcmV0dXJuICh1ID0gZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIpID49IDAgJiYgKHYgPSBkb3QwMCAqIGRvdDEyIC0gZG90MDEgKiBkb3QwMikgPj0gMCAmJiB1ICsgdiA8IGRvdDAwICogZG90MTEgLSBkb3QwMSAqIGRvdDAxOwogICAgfQoKICB9CiAgUmF5LkNMT1NFU1QgPSBSQVlfTU9ERVMuQ0xPU0VTVDsKICBSYXkuQU5ZID0gUkFZX01PREVTLkFOWTsKICBSYXkuQUxMID0gUkFZX01PREVTLkFMTDsKICBjb25zdCB0bXBBQUJCJDEgPSBuZXcgQUFCQigpOwogIGNvbnN0IHRtcEFycmF5ID0gW107CiAgY29uc3QgdjEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3hpID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RCb2R5X3FpID0gbmV3IFF1YXRlcm5pb24oKTsKICBjb25zdCBpbnRlcnNlY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYyA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgUmF5Y2FzdFJlc3VsdCgpOwogIGNvbnN0IGludGVyc2VjdENvbnZleE9wdGlvbnMgPSB7CiAgICBmYWNlTGlzdDogWzBdCiAgfTsKICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfbG9jYWxSYXkgPSBuZXcgUmF5KCk7CiAgY29uc3QgaW50ZXJzZWN0SGVpZ2h0ZmllbGRfaW5kZXggPSBbXTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX2ludGVyc2VjdGlvblBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCBSYXlfaW50ZXJzZWN0U3BoZXJlX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0Q29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdENvbnZleF92ZWN0b3IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdFRyaW1lc2hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRGlyZWN0aW9uID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX2xvY2FsRnJvbSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF9sb2NhbFRvID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3dvcmxkSW50ZXJzZWN0UG9pbnQgPSBuZXcgVmVjMygpOwogIG5ldyBBQUJCKCk7CiAgY29uc3QgaW50ZXJzZWN0VHJpbWVzaF90cmlhbmdsZXMgPSBbXTsKICBjb25zdCBpbnRlcnNlY3RUcmltZXNoX3RyZWVUcmFuc2Zvcm0gPSBuZXcgVHJhbnNmb3JtKCk7CiAgY29uc3QgdjAgPSBuZXcgVmVjMygpOwogIGNvbnN0IGludGVyc2VjdCA9IG5ldyBWZWMzKCk7CgogIGZ1bmN0aW9uIGRpc3RhbmNlRnJvbUludGVyc2VjdGlvbihmcm9tLCBkaXJlY3Rpb24sIHBvc2l0aW9uKSB7CiAgICAvLyB2MCBpcyB2ZWN0b3IgZnJvbSBmcm9tIHRvIHBvc2l0aW9uCiAgICBwb3NpdGlvbi52c3ViKGZyb20sIHYwKTsKICAgIGNvbnN0IGRvdCA9IHYwLmRvdChkaXJlY3Rpb24pOyAvLyBpbnRlcnNlY3QgPSBkaXJlY3Rpb24qZG90ICsgZnJvbQoKICAgIGRpcmVjdGlvbi5zY2FsZShkb3QsIGludGVyc2VjdCk7CiAgICBpbnRlcnNlY3QudmFkZChmcm9tLCBpbnRlcnNlY3QpOwogICAgY29uc3QgZGlzdGFuY2UgPSBwb3NpdGlvbi5kaXN0YW5jZVRvKGludGVyc2VjdCk7CiAgICByZXR1cm4gZGlzdGFuY2U7CiAgfQoKICAvKioKICAgKiBTd2VlcCBhbmQgcHJ1bmUgYnJvYWRwaGFzZSBhbG9uZyBvbmUgYXhpcy4KICAgKi8KICBjbGFzcyBTQVBCcm9hZHBoYXNlIGV4dGVuZHMgQnJvYWRwaGFzZSB7CiAgICAvKioKICAgICAqIExpc3Qgb2YgYm9kaWVzIGN1cnJlbnRseSBpbiB0aGUgYnJvYWRwaGFzZS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHdvcmxkIHRvIHNlYXJjaCBpbi4KICAgICAqLwoKICAgIC8qKgogICAgICogQXhpcyB0byBzb3J0IHRoZSBib2RpZXMgYWxvbmcuCiAgICAgKiBTZXQgdG8gMCBmb3IgeCBheGlzLCBhbmQgMSBmb3IgeSBheGlzLgogICAgICogRm9yIGJlc3QgcGVyZm9ybWFuY2UsIHBpY2sgdGhlIGF4aXMgd2hlcmUgYm9kaWVzIGFyZSBtb3N0IGRpc3RyaWJ1dGVkLgogICAgICovCgogICAgLyoqCiAgICAgKiBDaGVjayBpZiB0aGUgYm91bmRzIG9mIHR3byBib2RpZXMgb3ZlcmxhcCwgYWxvbmcgdGhlIGdpdmVuIFNBUCBheGlzLgogICAgICovCiAgICBzdGF0aWMgY2hlY2tCb3VuZHMoYmksIGJqLCBheGlzSW5kZXgpIHsKICAgICAgbGV0IGJpUG9zOwogICAgICBsZXQgYmpQb3M7CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAwKSB7CiAgICAgICAgYmlQb3MgPSBiaS5wb3NpdGlvbi54OwogICAgICAgIGJqUG9zID0gYmoucG9zaXRpb24ueDsKICAgICAgfSBlbHNlIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBiaVBvcyA9IGJpLnBvc2l0aW9uLnk7CiAgICAgICAgYmpQb3MgPSBiai5wb3NpdGlvbi55OwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIGJpUG9zID0gYmkucG9zaXRpb24uejsKICAgICAgICBialBvcyA9IGJqLnBvc2l0aW9uLno7CiAgICAgIH0KCiAgICAgIGNvbnN0IHJpID0gYmkuYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIHJqID0gYmouYm91bmRpbmdSYWRpdXMsCiAgICAgICAgICAgIGJvdW5kQTIgPSBiaVBvcyArIHJpLAogICAgICAgICAgICBib3VuZEIxID0gYmpQb3MgLSByajsKICAgICAgcmV0dXJuIGJvdW5kQjEgPCBib3VuZEEyOwogICAgfSAvLyBOb3RlOiB0aGVzZSBhcmUgaWRlbnRpY2FsLCBzYXZlIGZvciB4L3kveiBsb3dlcmJvdW5kCgogICAgLyoqCiAgICAgKiBpbnNlcnRpb25Tb3J0WAogICAgICovCgoKICAgIHN0YXRpYyBpbnNlcnRpb25Tb3J0WChhKSB7CiAgICAgIGZvciAobGV0IGkgPSAxLCBsID0gYS5sZW5ndGg7IGkgPCBsOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gYVtpXTsKICAgICAgICBsZXQgajsKCiAgICAgICAgZm9yIChqID0gaSAtIDE7IGogPj0gMDsgai0tKSB7CiAgICAgICAgICBpZiAoYVtqXS5hYWJiLmxvd2VyQm91bmQueCA8PSB2LmFhYmIubG93ZXJCb3VuZC54KSB7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgICAgfQoKICAgICAgICAgIGFbaiArIDFdID0gYVtqXTsKICAgICAgICB9CgogICAgICAgIGFbaiArIDFdID0gdjsKICAgICAgfQoKICAgICAgcmV0dXJuIGE7CiAgICB9CiAgICAvKioKICAgICAqIGluc2VydGlvblNvcnRZCiAgICAgKi8KCgogICAgc3RhdGljIGluc2VydGlvblNvcnRZKGEpIHsKICAgICAgZm9yIChsZXQgaSA9IDEsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkrKykgewogICAgICAgIGNvbnN0IHYgPSBhW2ldOwogICAgICAgIGxldCBqOwoKICAgICAgICBmb3IgKGogPSBpIC0gMTsgaiA+PSAwOyBqLS0pIHsKICAgICAgICAgIGlmIChhW2pdLmFhYmIubG93ZXJCb3VuZC55IDw9IHYuYWFiYi5sb3dlckJvdW5kLnkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgYVtqICsgMV0gPSBhW2pdOwogICAgICAgIH0KCiAgICAgICAgYVtqICsgMV0gPSB2OwogICAgICB9CgogICAgICByZXR1cm4gYTsKICAgIH0KICAgIC8qKgogICAgICogaW5zZXJ0aW9uU29ydFoKICAgICAqLwoKCiAgICBzdGF0aWMgaW5zZXJ0aW9uU29ydFooYSkgewogICAgICBmb3IgKGxldCBpID0gMSwgbCA9IGEubGVuZ3RoOyBpIDwgbDsgaSsrKSB7CiAgICAgICAgY29uc3QgdiA9IGFbaV07CiAgICAgICAgbGV0IGo7CgogICAgICAgIGZvciAoaiA9IGkgLSAxOyBqID49IDA7IGotLSkgewogICAgICAgICAgaWYgKGFbal0uYWFiYi5sb3dlckJvdW5kLnogPD0gdi5hYWJiLmxvd2VyQm91bmQueikgewogICAgICAgICAgICBicmVhazsKICAgICAgICAgIH0KCiAgICAgICAgICBhW2ogKyAxXSA9IGFbal07CiAgICAgICAgfQoKICAgICAgICBhW2ogKyAxXSA9IHY7CiAgICAgIH0KCiAgICAgIHJldHVybiBhOwogICAgfQoKICAgIGNvbnN0cnVjdG9yKHdvcmxkKSB7CiAgICAgIHN1cGVyKCk7CiAgICAgIHRoaXMuYXhpc0xpc3QgPSBbXTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICAgIHRoaXMuYXhpc0luZGV4ID0gMDsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwoKICAgICAgdGhpcy5fYWRkQm9keUhhbmRsZXIgPSBldmVudCA9PiB7CiAgICAgICAgYXhpc0xpc3QucHVzaChldmVudC5ib2R5KTsKICAgICAgfTsKCiAgICAgIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyID0gZXZlbnQgPT4gewogICAgICAgIGNvbnN0IGlkeCA9IGF4aXNMaXN0LmluZGV4T2YoZXZlbnQuYm9keSk7CgogICAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgICBheGlzTGlzdC5zcGxpY2UoaWR4LCAxKTsKICAgICAgICB9CiAgICAgIH07CgogICAgICBpZiAod29ybGQpIHsKICAgICAgICB0aGlzLnNldFdvcmxkKHdvcmxkKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBDaGFuZ2UgdGhlIHdvcmxkCiAgICAgKi8KCgogICAgc2V0V29ybGQod29ybGQpIHsKICAgICAgLy8gQ2xlYXIgdGhlIG9sZCBheGlzIGFycmF5CiAgICAgIHRoaXMuYXhpc0xpc3QubGVuZ3RoID0gMDsgLy8gQWRkIGFsbCBib2RpZXMgZnJvbSB0aGUgbmV3IHdvcmxkCgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHdvcmxkLmJvZGllcy5sZW5ndGg7IGkrKykgewogICAgICAgIHRoaXMuYXhpc0xpc3QucHVzaCh3b3JsZC5ib2RpZXNbaV0pOwogICAgICB9IC8vIFJlbW92ZSBvbGQgaGFuZGxlcnMsIGlmIGFueQoKCiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2FkZEJvZHknLCB0aGlzLl9hZGRCb2R5SGFuZGxlcik7CiAgICAgIHdvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3JlbW92ZUJvZHknLCB0aGlzLl9yZW1vdmVCb2R5SGFuZGxlcik7IC8vIEFkZCBoYW5kbGVycyB0byB1cGRhdGUgdGhlIGxpc3Qgb2YgYm9kaWVzLgoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcignYWRkQm9keScsIHRoaXMuX2FkZEJvZHlIYW5kbGVyKTsKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncmVtb3ZlQm9keScsIHRoaXMuX3JlbW92ZUJvZHlIYW5kbGVyKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgICB0aGlzLmRpcnR5ID0gdHJ1ZTsKICAgIH0KICAgIC8qKgogICAgICogQ29sbGVjdCBhbGwgY29sbGlzaW9uIHBhaXJzCiAgICAgKi8KCgogICAgY29sbGlzaW9uUGFpcnMod29ybGQsIHAxLCBwMikgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBOID0gYm9kaWVzLmxlbmd0aDsKICAgICAgY29uc3QgYXhpc0luZGV4ID0gdGhpcy5heGlzSW5kZXg7CiAgICAgIGxldCBpOwogICAgICBsZXQgajsKCiAgICAgIGlmICh0aGlzLmRpcnR5KSB7CiAgICAgICAgdGhpcy5zb3J0TGlzdCgpOwogICAgICAgIHRoaXMuZGlydHkgPSBmYWxzZTsKICAgICAgfSAvLyBMb29rIHRocm91Z2ggdGhlIGxpc3QKCgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgZm9yIChqID0gaSArIDE7IGogPCBOOyBqKyspIHsKICAgICAgICAgIGNvbnN0IGJqID0gYm9kaWVzW2pdOwoKICAgICAgICAgIGlmICghdGhpcy5uZWVkQnJvYWRwaGFzZUNvbGxpc2lvbihiaSwgYmopKSB7CiAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgfQoKICAgICAgICAgIGlmICghU0FQQnJvYWRwaGFzZS5jaGVja0JvdW5kcyhiaSwgYmosIGF4aXNJbmRleCkpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CgogICAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25UZXN0KGJpLCBiaiwgcDEsIHAyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzb3J0TGlzdCgpIHsKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBjb25zdCBheGlzSW5kZXggPSB0aGlzLmF4aXNJbmRleDsKICAgICAgY29uc3QgTiA9IGF4aXNMaXN0Lmxlbmd0aDsgLy8gVXBkYXRlIEFBQkJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBheGlzTGlzdFtpXTsKCiAgICAgICAgaWYgKGJpLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYmkudXBkYXRlQUFCQigpOwogICAgICAgIH0KICAgICAgfSAvLyBTb3J0IHRoZSBsaXN0CgoKICAgICAgaWYgKGF4aXNJbmRleCA9PT0gMCkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFgoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMSkgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFkoYXhpc0xpc3QpOwogICAgICB9IGVsc2UgaWYgKGF4aXNJbmRleCA9PT0gMikgewogICAgICAgIFNBUEJyb2FkcGhhc2UuaW5zZXJ0aW9uU29ydFooYXhpc0xpc3QpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIHRoZSB2YXJpYW5jZSBvZiB0aGUgYm9keSBwb3NpdGlvbnMgYW5kIGVzdGltYXRlcyB0aGUgYmVzdCBheGlzIHRvIHVzZS4KICAgICAqIFdpbGwgYXV0b21hdGljYWxseSBzZXQgcHJvcGVydHkgYGF4aXNJbmRleGAuCiAgICAgKi8KCgogICAgYXV0b0RldGVjdEF4aXMoKSB7CiAgICAgIGxldCBzdW1YID0gMDsKICAgICAgbGV0IHN1bVgyID0gMDsKICAgICAgbGV0IHN1bVkgPSAwOwogICAgICBsZXQgc3VtWTIgPSAwOwogICAgICBsZXQgc3VtWiA9IDA7CiAgICAgIGxldCBzdW1aMiA9IDA7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYXhpc0xpc3Q7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBpbnZOID0gMSAvIE47CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYiA9IGJvZGllc1tpXTsKICAgICAgICBjb25zdCBjZW50ZXJYID0gYi5wb3NpdGlvbi54OwogICAgICAgIHN1bVggKz0gY2VudGVyWDsKICAgICAgICBzdW1YMiArPSBjZW50ZXJYICogY2VudGVyWDsKICAgICAgICBjb25zdCBjZW50ZXJZID0gYi5wb3NpdGlvbi55OwogICAgICAgIHN1bVkgKz0gY2VudGVyWTsKICAgICAgICBzdW1ZMiArPSBjZW50ZXJZICogY2VudGVyWTsKICAgICAgICBjb25zdCBjZW50ZXJaID0gYi5wb3NpdGlvbi56OwogICAgICAgIHN1bVogKz0gY2VudGVyWjsKICAgICAgICBzdW1aMiArPSBjZW50ZXJaICogY2VudGVyWjsKICAgICAgfQoKICAgICAgY29uc3QgdmFyaWFuY2VYID0gc3VtWDIgLSBzdW1YICogc3VtWCAqIGludk47CiAgICAgIGNvbnN0IHZhcmlhbmNlWSA9IHN1bVkyIC0gc3VtWSAqIHN1bVkgKiBpbnZOOwogICAgICBjb25zdCB2YXJpYW5jZVogPSBzdW1aMiAtIHN1bVogKiBzdW1aICogaW52TjsKCiAgICAgIGlmICh2YXJpYW5jZVggPiB2YXJpYW5jZVkpIHsKICAgICAgICBpZiAodmFyaWFuY2VYID4gdmFyaWFuY2VaKSB7CiAgICAgICAgICB0aGlzLmF4aXNJbmRleCA9IDA7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgICB9CiAgICAgIH0gZWxzZSBpZiAodmFyaWFuY2VZID4gdmFyaWFuY2VaKSB7CiAgICAgICAgdGhpcy5heGlzSW5kZXggPSAxOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYXhpc0luZGV4ID0gMjsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZXR1cm5zIGFsbCB0aGUgYm9kaWVzIHdpdGhpbiBhbiBBQUJCLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSByZXN1bHRpbmcgYm9kaWVzIGluLgogICAgICovCgoKICAgIGFhYmJRdWVyeSh3b3JsZCwgYWFiYiwgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgPT09IHZvaWQgMCkgewogICAgICAgIHJlc3VsdCA9IFtdOwogICAgICB9CgogICAgICBpZiAodGhpcy5kaXJ0eSkgewogICAgICAgIHRoaXMuc29ydExpc3QoKTsKICAgICAgICB0aGlzLmRpcnR5ID0gZmFsc2U7CiAgICAgIH0KCiAgICAgIGNvbnN0IGF4aXNJbmRleCA9IHRoaXMuYXhpc0luZGV4OwogICAgICBsZXQgYXhpcyA9ICd4JzsKCiAgICAgIGlmIChheGlzSW5kZXggPT09IDEpIHsKICAgICAgICBheGlzID0gJ3knOwogICAgICB9CgogICAgICBpZiAoYXhpc0luZGV4ID09PSAyKSB7CiAgICAgICAgYXhpcyA9ICd6JzsKICAgICAgfQoKICAgICAgY29uc3QgYXhpc0xpc3QgPSB0aGlzLmF4aXNMaXN0OwogICAgICBhYWJiLmxvd2VyQm91bmRbYXhpc107CiAgICAgIGFhYmIudXBwZXJCb3VuZFtheGlzXTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYXhpc0xpc3QubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCBiID0gYXhpc0xpc3RbaV07CgogICAgICAgIGlmIChiLmFhYmJOZWVkc1VwZGF0ZSkgewogICAgICAgICAgYi51cGRhdGVBQUJCKCk7CiAgICAgICAgfQoKICAgICAgICBpZiAoYi5hYWJiLm92ZXJsYXBzKGFhYmIpKSB7CiAgICAgICAgICByZXN1bHQucHVzaChiKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CgogIH0KCiAgY2xhc3MgVXRpbHMgewogICAgLyoqCiAgICAgKiBFeHRlbmQgYW4gb3B0aW9ucyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEBwYXJhbSBvcHRpb25zIFRoZSBvcHRpb25zIG9iamVjdC4gTWF5IGJlIGZhbHN5OiBpbiB0aGlzIGNhc2UsIGEgbmV3IG9iamVjdCBpcyBjcmVhdGVkIGFuZCByZXR1cm5lZC4KICAgICAqIEBwYXJhbSBkZWZhdWx0cyBBbiBvYmplY3QgY29udGFpbmluZyBkZWZhdWx0IHZhbHVlcy4KICAgICAqIEByZXR1cm4gVGhlIG1vZGlmaWVkIG9wdGlvbnMgb2JqZWN0LgogICAgICovCiAgICBzdGF0aWMgZGVmYXVsdHMob3B0aW9ucywgZGVmYXVsdHMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgZm9yIChsZXQga2V5IGluIGRlZmF1bHRzKSB7CiAgICAgICAgaWYgKCEoa2V5IGluIG9wdGlvbnMpKSB7CiAgICAgICAgICBvcHRpb25zW2tleV0gPSBkZWZhdWx0c1trZXldOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG9wdGlvbnM7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBiYXNlIGNsYXNzCiAgICovCiAgY2xhc3MgQ29uc3RyYWludCB7CiAgICAvKioKICAgICAqIEVxdWF0aW9ucyB0byBiZSBzb2x2ZWQgaW4gdGhpcyBjb25zdHJhaW50LgogICAgICovCgogICAgLyoqCiAgICAgKiBCb2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIEJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogU2V0IHRvIGZhbHNlIGlmIHlvdSBkb24ndCB3YW50IHRoZSBib2RpZXMgdG8gY29sbGlkZSB3aGVuIHRoZXkgYXJlIGNvbm5lY3RlZC4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgY29sbGlkZUNvbm5lY3RlZDogdHJ1ZSwKICAgICAgICB3YWtlVXBCb2RpZXM6IHRydWUKICAgICAgfSk7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICAgIHRoaXMuYm9keUEgPSBib2R5QTsKICAgICAgdGhpcy5ib2R5QiA9IGJvZHlCOwogICAgICB0aGlzLmlkID0gQ29uc3RyYWludC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gb3B0aW9ucy5jb2xsaWRlQ29ubmVjdGVkOwoKICAgICAgaWYgKG9wdGlvbnMud2FrZVVwQm9kaWVzKSB7CiAgICAgICAgaWYgKGJvZHlBKSB7CiAgICAgICAgICBib2R5QS53YWtlVXAoKTsKICAgICAgICB9CgogICAgICAgIGlmIChib2R5QikgewogICAgICAgICAgYm9keUIud2FrZVVwKCk7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSBhbGwgdGhlIGVxdWF0aW9ucyB3aXRoIGRhdGEuCiAgICAgKi8KCgogICAgdXBkYXRlKCkgewogICAgICB0aHJvdyBuZXcgRXJyb3IoJ21ldGhvZCB1cGRhdGUoKSBub3QgaW1wbG1lbWVudGVkIGluIHRoaXMgQ29uc3RyYWludCBzdWJjbGFzcyEnKTsKICAgIH0KICAgIC8qKgogICAgICogRW5hYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGVuYWJsZSgpIHsKICAgICAgY29uc3QgZXFzID0gdGhpcy5lcXVhdGlvbnM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGVxcy5sZW5ndGg7IGkrKykgewogICAgICAgIGVxc1tpXS5lbmFibGVkID0gdHJ1ZTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBEaXNhYmxlcyBhbGwgZXF1YXRpb25zIGluIHRoZSBjb25zdHJhaW50LgogICAgICovCgoKICAgIGRpc2FibGUoKSB7CiAgICAgIGNvbnN0IGVxcyA9IHRoaXMuZXF1YXRpb25zOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBlcXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBlcXNbaV0uZW5hYmxlZCA9IGZhbHNlOwogICAgICB9CiAgICB9CgogIH0KICBDb25zdHJhaW50LmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEFuIGVsZW1lbnQgY29udGFpbmluZyA2IGVudHJpZXMsIDMgc3BhdGlhbCBhbmQgMyByb3RhdGlvbmFsIGRlZ3JlZXMgb2YgZnJlZWRvbS4KICAgKi8KCiAgY2xhc3MgSmFjb2JpYW5FbGVtZW50IHsKICAgIC8qKgogICAgICogc3BhdGlhbAogICAgICovCgogICAgLyoqCiAgICAgKiByb3RhdGlvbmFsCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKCkgewogICAgICB0aGlzLnNwYXRpYWwgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJvdGF0aW9uYWwgPSBuZXcgVmVjMygpOwogICAgfQogICAgLyoqCiAgICAgKiBNdWx0aXBseSB3aXRoIG90aGVyIEphY29iaWFuRWxlbWVudAogICAgICovCgoKICAgIG11bHRpcGx5RWxlbWVudChlbGVtZW50KSB7CiAgICAgIHJldHVybiBlbGVtZW50LnNwYXRpYWwuZG90KHRoaXMuc3BhdGlhbCkgKyBlbGVtZW50LnJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CiAgICAvKioKICAgICAqIE11bHRpcGx5IHdpdGggdHdvIHZlY3RvcnMKICAgICAqLwoKCiAgICBtdWx0aXBseVZlY3RvcnMoc3BhdGlhbCwgcm90YXRpb25hbCkgewogICAgICByZXR1cm4gc3BhdGlhbC5kb3QodGhpcy5zcGF0aWFsKSArIHJvdGF0aW9uYWwuZG90KHRoaXMucm90YXRpb25hbCk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogRXF1YXRpb24gYmFzZSBjbGFzcy4KICAgKgogICAqIGBhYCwgYGJgIGFuZCBgZXBzYCBhcmUge0BsaW5rIGh0dHBzOi8vd3d3OC5jcy51bXUuc2Uva3Vyc2VyLzVEVjA1OC9WVDE1L2xlY3R1cmVzL1NQT09LbGFibm90ZXMucGRmIFNQT09LfSBwYXJhbWV0ZXJzIHRoYXQgZGVmYXVsdCB0byBgMC4wYC4gU2VlIHtAbGluayBodHRwczovL2dpdGh1Yi5jb20vc2NodGVwcGUvY2Fubm9uLmpzL2lzc3Vlcy8yMzgjaXNzdWVjb21tZW50LTE0NzE3MjMyNyB0aGlzIGV4Y2hhbmdlfSBmb3IgbW9yZSBkZXRhaWxzIG9uIENhbm5vbidzIHBoeXNpY3MgaW1wbGVtZW50YXRpb24uCiAgICovCiAgY2xhc3MgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBNaW5pbXVtIChyZWFkOiBuZWdhdGl2ZSBtYXgpIGZvcmNlIHRvIGJlIGFwcGxpZWQgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heGltdW0gKHJlYWQ6IHBvc2l0aXZlIG1heCkgZm9yY2UgdG8gYmUgYXBwbGllZCBieSB0aGUgY29uc3RyYWludC4KICAgICAqLwoKICAgIC8qKgogICAgICogU1BPT0sgcGFyYW1ldGVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNQT09LIHBhcmFtZXRlcgogICAgICovCgogICAgLyoqCiAgICAgKiBTUE9PSyBwYXJhbWV0ZXIKICAgICAqLwoKICAgIC8qKgogICAgICogQSBudW1iZXIsIHByb3BvcnRpb25hbCB0byB0aGUgZm9yY2UgYWRkZWQgdG8gdGhlIGJvZGllcy4KICAgICAqLwogICAgY29uc3RydWN0b3IoYmksIGJqLCBtaW5Gb3JjZSwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1pbkZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtaW5Gb3JjZSA9IC0xZTY7CiAgICAgIH0KCiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHRoaXMuaWQgPSBFcXVhdGlvbi5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5taW5Gb3JjZSA9IG1pbkZvcmNlOwogICAgICB0aGlzLm1heEZvcmNlID0gbWF4Rm9yY2U7CiAgICAgIHRoaXMuYmkgPSBiaTsKICAgICAgdGhpcy5iaiA9IGJqOwogICAgICB0aGlzLmEgPSAwLjA7IC8vIFNQT09LIHBhcmFtZXRlcgoKICAgICAgdGhpcy5iID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuZXBzID0gMC4wOyAvLyBTUE9PSyBwYXJhbWV0ZXIKCiAgICAgIHRoaXMuamFjb2JpYW5FbGVtZW50QSA9IG5ldyBKYWNvYmlhbkVsZW1lbnQoKTsKICAgICAgdGhpcy5qYWNvYmlhbkVsZW1lbnRCID0gbmV3IEphY29iaWFuRWxlbWVudCgpOwogICAgICB0aGlzLmVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLm11bHRpcGxpZXIgPSAwOwogICAgICB0aGlzLnNldFNwb29rUGFyYW1zKDFlNywgNCwgMSAvIDYwKTsgLy8gU2V0IHR5cGljYWwgc3Bvb2sgcGFyYW1zCiAgICB9CiAgICAvKioKICAgICAqIFJlY2FsY3VsYXRlcyBhLCBiLCBhbmQgZXBzLgogICAgICoKICAgICAqIFRoZSBFcXVhdGlvbiBjb25zdHJ1Y3RvciBzZXRzIHR5cGljYWwgU1BPT0sgcGFyYW1ldGVycyBhcyBzdWNoOgogICAgICogKiBgc3RpZmZuZXNzYCA9IDFlNwogICAgICogKiBgcmVsYXhhdGlvbmAgPSA0CiAgICAgKiAqIGB0aW1lU3RlcGA9IDEgLyA2MCwgX25vdGUgdGhlIGhhcmRjb2RlZCByZWZyZXNoIHJhdGUuXwogICAgICovCgoKICAgIHNldFNwb29rUGFyYW1zKHN0aWZmbmVzcywgcmVsYXhhdGlvbiwgdGltZVN0ZXApIHsKICAgICAgY29uc3QgZCA9IHJlbGF4YXRpb247CiAgICAgIGNvbnN0IGsgPSBzdGlmZm5lc3M7CiAgICAgIGNvbnN0IGggPSB0aW1lU3RlcDsKICAgICAgdGhpcy5hID0gNC4wIC8gKGggKiAoMSArIDQgKiBkKSk7CiAgICAgIHRoaXMuYiA9IDQuMCAqIGQgLyAoMSArIDQgKiBkKTsKICAgICAgdGhpcy5lcHMgPSA0LjAgLyAoaCAqIGggKiBrICogKDEgKyA0ICogZCkpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyB0aGUgcmlnaHQgaGFuZCBzaWRlIG9mIHRoZSBTUE9PSyBlcXVhdGlvbgogICAgICovCgoKICAgIGNvbXB1dGVCKGEsIGIsIGgpIHsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHcSA9IHRoaXMuY29tcHV0ZUdxKCk7CiAgICAgIGNvbnN0IEdpTWYgPSB0aGlzLmNvbXB1dGVHaU1mKCk7CiAgICAgIHJldHVybiAtR3EgKiBhIC0gR1cgKiBiIC0gR2lNZiAqIGg7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqcSwgd2hlcmUgcSBhcmUgdGhlIGdlbmVyYWxpemVkIGJvZHkgY29vcmRpbmF0ZXMKICAgICAqLwoKCiAgICBjb21wdXRlR3EoKSB7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgYmkgPSB0aGlzLmJpOwogICAgICBjb25zdCBiaiA9IHRoaXMuYmo7CiAgICAgIGNvbnN0IHhpID0gYmkucG9zaXRpb247CiAgICAgIGNvbnN0IHhqID0gYmoucG9zaXRpb247CiAgICAgIHJldHVybiBHQS5zcGF0aWFsLmRvdCh4aSkgKyBHQi5zcGF0aWFsLmRvdCh4aik7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGVzIEcqVywgd2hlcmUgVyBhcmUgdGhlIGJvZHkgdmVsb2NpdGllcwogICAgICovCgoKICAgIGNvbXB1dGVHVygpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgdmkgPSBiaS52ZWxvY2l0eTsKICAgICAgY29uc3QgdmogPSBiai52ZWxvY2l0eTsKICAgICAgY29uc3Qgd2kgPSBiaS5hbmd1bGFyVmVsb2NpdHk7CiAgICAgIGNvbnN0IHdqID0gYmouYW5ndWxhclZlbG9jaXR5OwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKHZpLCB3aSkgKyBHQi5tdWx0aXBseVZlY3RvcnModmosIHdqKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZXMgRypXbGFtYmRhLCB3aGVyZSBXIGFyZSB0aGUgYm9keSB2ZWxvY2l0aWVzCiAgICAgKi8KCgogICAgY29tcHV0ZUdXbGFtYmRhKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB2aSA9IGJpLnZsYW1iZGE7CiAgICAgIGNvbnN0IHZqID0gYmoudmxhbWJkYTsKICAgICAgY29uc3Qgd2kgPSBiaS53bGFtYmRhOwogICAgICBjb25zdCB3aiA9IGJqLndsYW1iZGE7CiAgICAgIHJldHVybiBHQS5tdWx0aXBseVZlY3RvcnModmksIHdpKSArIEdCLm11bHRpcGx5VmVjdG9ycyh2aiwgd2opOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpmLCB3aGVyZSBNIGlzIHRoZSBtYXNzIG1hdHJpeCB3aXRoIGRpYWdvbmFsIGJsb2NrcyBmb3IgZWFjaCBib2R5LCBhbmQgZiBhcmUgdGhlIGZvcmNlcyBvbiB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGNvbXB1dGVHaU1mKCkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCBmaSA9IGJpLmZvcmNlOwogICAgICBjb25zdCB0aSA9IGJpLnRvcnF1ZTsKICAgICAgY29uc3QgZmogPSBiai5mb3JjZTsKICAgICAgY29uc3QgdGogPSBiai50b3JxdWU7CiAgICAgIGNvbnN0IGludk1hc3NpID0gYmkuaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZNYXNzaiA9IGJqLmludk1hc3NTb2x2ZTsKICAgICAgZmkuc2NhbGUoaW52TWFzc2ksIGlNZmkpOwogICAgICBmai5zY2FsZShpbnZNYXNzaiwgaU1maik7CiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KHRpLCBpbnZJaV92bXVsdF90YXVpKTsKICAgICAgYmouaW52SW5lcnRpYVdvcmxkU29sdmUudm11bHQodGosIGludklqX3ZtdWx0X3RhdWopOwogICAgICByZXR1cm4gR0EubXVsdGlwbHlWZWN0b3JzKGlNZmksIGludklpX3ZtdWx0X3RhdWkpICsgR0IubXVsdGlwbHlWZWN0b3JzKGlNZmosIGludklqX3ZtdWx0X3RhdWopOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlcyBHKmludihNKSpHJwogICAgICovCgoKICAgIGNvbXB1dGVHaU1HdCgpIHsKICAgICAgY29uc3QgR0EgPSB0aGlzLmphY29iaWFuRWxlbWVudEE7CiAgICAgIGNvbnN0IEdCID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRCOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgaW52TWFzc2kgPSBiaS5pbnZNYXNzU29sdmU7CiAgICAgIGNvbnN0IGludk1hc3NqID0gYmouaW52TWFzc1NvbHZlOwogICAgICBjb25zdCBpbnZJaSA9IGJpLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBjb25zdCBpbnZJaiA9IGJqLmludkluZXJ0aWFXb3JsZFNvbHZlOwogICAgICBsZXQgcmVzdWx0ID0gaW52TWFzc2kgKyBpbnZNYXNzajsKICAgICAgaW52SWkudm11bHQoR0Eucm90YXRpb25hbCwgdG1wKTsKICAgICAgcmVzdWx0ICs9IHRtcC5kb3QoR0Eucm90YXRpb25hbCk7CiAgICAgIGludklqLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRtcCk7CiAgICAgIHJlc3VsdCArPSB0bXAuZG90KEdCLnJvdGF0aW9uYWwpOwogICAgICByZXR1cm4gcmVzdWx0OwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgY29uc3RyYWludCB2ZWxvY2l0eSB0byB0aGUgYm9kaWVzLgogICAgICovCgoKICAgIGFkZFRvV2xhbWJkYShkZWx0YWxhbWJkYSkgewogICAgICBjb25zdCBHQSA9IHRoaXMuamFjb2JpYW5FbGVtZW50QTsKICAgICAgY29uc3QgR0IgPSB0aGlzLmphY29iaWFuRWxlbWVudEI7CiAgICAgIGNvbnN0IGJpID0gdGhpcy5iaTsKICAgICAgY29uc3QgYmogPSB0aGlzLmJqOwogICAgICBjb25zdCB0ZW1wID0gYWRkVG9XbGFtYmRhX3RlbXA7IC8vIEFkZCB0byBsaW5lYXIgdmVsb2NpdHkKICAgICAgLy8gdl9sYW1iZGEgKz0gaW52KE0pICogZGVsdGFfbGFtYmEgKiBHCgogICAgICBiaS52bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihiaS5pbnZNYXNzU29sdmUgKiBkZWx0YWxhbWJkYSwgR0Euc3BhdGlhbCwgYmkudmxhbWJkYSk7CiAgICAgIGJqLnZsYW1iZGEuYWRkU2NhbGVkVmVjdG9yKGJqLmludk1hc3NTb2x2ZSAqIGRlbHRhbGFtYmRhLCBHQi5zcGF0aWFsLCBiai52bGFtYmRhKTsgLy8gQWRkIHRvIGFuZ3VsYXIgdmVsb2NpdHkKCiAgICAgIGJpLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdBLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiaS53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmkud2xhbWJkYSk7CiAgICAgIGJqLmludkluZXJ0aWFXb3JsZFNvbHZlLnZtdWx0KEdCLnJvdGF0aW9uYWwsIHRlbXApOwogICAgICBiai53bGFtYmRhLmFkZFNjYWxlZFZlY3RvcihkZWx0YWxhbWJkYSwgdGVtcCwgYmoud2xhbWJkYSk7CiAgICB9CiAgICAvKioKICAgICAqIENvbXB1dGUgdGhlIGRlbm9taW5hdG9yIHBhcnQgb2YgdGhlIFNQT09LIGVxdWF0aW9uOiBDID0gRyppbnYoTSkqRycgKyBlcHMKICAgICAqLwoKCiAgICBjb21wdXRlQygpIHsKICAgICAgcmV0dXJuIHRoaXMuY29tcHV0ZUdpTUd0KCkgKyB0aGlzLmVwczsKICAgIH0KCiAgfQogIEVxdWF0aW9uLmlkQ291bnRlciA9IDA7CiAgY29uc3QgaU1maSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaU1maiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWlfdm11bHRfdGF1aSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgaW52SWpfdm11bHRfdGF1aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wID0gbmV3IFZlYzMoKTsKICBjb25zdCBhZGRUb1dsYW1iZGFfdGVtcCA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnRhY3Qvbm9uLXBlbmV0cmF0aW9uIGNvbnN0cmFpbnQgZXF1YXRpb24KICAgKi8KICBjbGFzcyBDb250YWN0RXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqICJib3VuY2luZXNzIjogdTEgPSAtZSp1MAogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZC1vcmllbnRlZCB2ZWN0b3IgdGhhdCBnb2VzIGZyb20gdGhlIGNlbnRlciBvZiBiaSB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogV29ybGQtb3JpZW50ZWQgdmVjdG9yIHRoYXQgc3RhcnRzIGluIGJvZHkgaiBwb3NpdGlvbiBhbmQgZ29lcyB0byB0aGUgY29udGFjdCBwb2ludC4KICAgICAqLwoKICAgIC8qKgogICAgICogQ29udGFjdCBub3JtYWwsIHBvaW50aW5nIG91dCBvZiBib2R5IGkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAwLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSAwLjA7CiAgICAgIHRoaXMucmkgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnJqID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5uaSA9IG5ldyBWZWMzKCk7CiAgICB9CgogICAgY29tcHV0ZUIoaCkgewogICAgICBjb25zdCBhID0gdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICBjb25zdCBiaSA9IHRoaXMuYmk7CiAgICAgIGNvbnN0IGJqID0gdGhpcy5iajsKICAgICAgY29uc3QgcmkgPSB0aGlzLnJpOwogICAgICBjb25zdCByaiA9IHRoaXMucmo7CiAgICAgIGNvbnN0IHJpeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeG4gPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDI7CiAgICAgIGNvbnN0IHZpID0gYmkudmVsb2NpdHk7CiAgICAgIGNvbnN0IHdpID0gYmkuYW5ndWxhclZlbG9jaXR5OwogICAgICBiaS5mb3JjZTsKICAgICAgYmkudG9ycXVlOwogICAgICBjb25zdCB2aiA9IGJqLnZlbG9jaXR5OwogICAgICBjb25zdCB3aiA9IGJqLmFuZ3VsYXJWZWxvY2l0eTsKICAgICAgYmouZm9yY2U7CiAgICAgIGJqLnRvcnF1ZTsKICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDM7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgY29uc3QgbiA9IHRoaXMubmk7IC8vIENhbHVjbGF0ZSBjcm9zcyBwcm9kdWN0cwoKICAgICAgcmkuY3Jvc3Mobiwgcml4bik7CiAgICAgIHJqLmNyb3NzKG4sIHJqeG4pOyAvLyBnID0geGorcmogLSh4aStyaSkKICAgICAgLy8gRyA9IFsgLW5pICAtcml4biAgbmkgIHJqeG4gXQoKICAgICAgbi5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeG4ubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkobik7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanhuKTsgLy8gQ2FsY3VsYXRlIHRoZSBwZW5ldHJhdGlvbiB2ZWN0b3IKCiAgICAgIHBlbmV0cmF0aW9uVmVjLmNvcHkoYmoucG9zaXRpb24pOwogICAgICBwZW5ldHJhdGlvblZlYy52YWRkKHJqLCBwZW5ldHJhdGlvblZlYyk7CiAgICAgIHBlbmV0cmF0aW9uVmVjLnZzdWIoYmkucG9zaXRpb24sIHBlbmV0cmF0aW9uVmVjKTsKICAgICAgcGVuZXRyYXRpb25WZWMudnN1YihyaSwgcGVuZXRyYXRpb25WZWMpOwogICAgICBjb25zdCBnID0gbi5kb3QocGVuZXRyYXRpb25WZWMpOyAvLyBDb21wdXRlIGl0ZXJhdGlvbgoKICAgICAgY29uc3QgZVBsdXNPbmUgPSB0aGlzLnJlc3RpdHV0aW9uICsgMTsKICAgICAgY29uc3QgR1cgPSBlUGx1c09uZSAqIHZqLmRvdChuKSAtIGVQbHVzT25lICogdmkuZG90KG4pICsgd2ouZG90KHJqeG4pIC0gd2kuZG90KHJpeG4pOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGN1cnJlbnQgcmVsYXRpdmUgdmVsb2NpdHkgaW4gdGhlIGNvbnRhY3QgcG9pbnQuCiAgICAgKi8KCgogICAgZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbCgpIHsKICAgICAgY29uc3QgdmkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aTsKICAgICAgY29uc3QgdmogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92ajsKICAgICAgY29uc3QgeGkgPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94aTsKICAgICAgY29uc3QgeGogPSBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF94ajsKICAgICAgY29uc3QgcmVsVmVsID0gQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfcmVsVmVsOwogICAgICB0aGlzLmJpLnBvc2l0aW9uLnZhZGQodGhpcy5yaSwgeGkpOwogICAgICB0aGlzLmJqLnBvc2l0aW9uLnZhZGQodGhpcy5yaiwgeGopOwogICAgICB0aGlzLmJpLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHhpLCB2aSk7CiAgICAgIHRoaXMuYmouZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoeGosIHZqKTsKICAgICAgdmkudnN1Yih2aiwgcmVsVmVsKTsKICAgICAgcmV0dXJuIHRoaXMubmkuZG90KHJlbFZlbCk7CiAgICB9CgogIH0KICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMKCiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fY29tcHV0ZUJfdGVtcDMgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3ZpID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF92aiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgQ29udGFjdEVxdWF0aW9uX2dldEltcGFjdFZlbG9jaXR5QWxvbmdOb3JtYWxfeGkgPSBuZXcgVmVjMygpOwogIGNvbnN0IENvbnRhY3RFcXVhdGlvbl9nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsX3hqID0gbmV3IFZlYzMoKTsKICBjb25zdCBDb250YWN0RXF1YXRpb25fZ2V0SW1wYWN0VmVsb2NpdHlBbG9uZ05vcm1hbF9yZWxWZWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBDb25uZWN0cyB0d28gYm9kaWVzIGF0IGdpdmVuIG9mZnNldCBwb2ludHMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgYm9keUEgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgY29uc3QgYm9keUIgPSBuZXcgQm9keSh7IG1hc3M6IDEgfSkKICAgKiAgICAgYm9keUEucG9zaXRpb24uc2V0KC0xLCAwLCAwKQogICAqICAgICBib2R5Qi5wb3NpdGlvbi5zZXQoMSwgMCwgMCkKICAgKiAgICAgYm9keUEuYWRkU2hhcGUoc2hhcGVBKQogICAqICAgICBib2R5Qi5hZGRTaGFwZShzaGFwZUIpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUEpCiAgICogICAgIHdvcmxkLmFkZEJvZHkoYm9keUIpCiAgICogICAgIGNvbnN0IGxvY2FsUGl2b3RBID0gbmV3IFZlYzMoMSwgMCwgMCkKICAgKiAgICAgY29uc3QgbG9jYWxQaXZvdEIgPSBuZXcgVmVjMygtMSwgMCwgMCkKICAgKiAgICAgY29uc3QgY29uc3RyYWludCA9IG5ldyBQb2ludFRvUG9pbnRDb25zdHJhaW50KGJvZHlBLCBsb2NhbFBpdm90QSwgYm9keUIsIGxvY2FsUGl2b3RCKQogICAqICAgICB3b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpCiAgICovCiAgY2xhc3MgUG9pbnRUb1BvaW50Q29uc3RyYWludCBleHRlbmRzIENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlBLgogICAgICovCgogICAgLyoqCiAgICAgKiBQaXZvdCwgZGVmaW5lZCBsb2NhbGx5IGluIGJvZHlCLgogICAgICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcGl2b3RBIFRoZSBwb2ludCByZWxhdGl2ZSB0byB0aGUgY2VudGVyIG9mIG1hc3Mgb2YgYm9keUEgd2hpY2ggYm9keUEgaXMgY29uc3RyYWluZWQgdG8uCiAgICAgKiBAcGFyYW0gYm9keUIgQm9keSB0aGF0IHdpbGwgYmUgY29uc3RyYWluZWQgaW4gYSBzaW1pbGFyIHdheSB0byB0aGUgc2FtZSBwb2ludCBhcyBib2R5QS4gV2Ugd2lsbCB0aGVyZWZvcmUgZ2V0IGEgbGluayBiZXR3ZWVuIGJvZHlBIGFuZCBib2R5Qi4gSWYgbm90IHNwZWNpZmllZCwgYm9keUEgd2lsbCBiZSBjb25zdHJhaW5lZCB0byBhIHN0YXRpYyBwb2ludC4KICAgICAqIEBwYXJhbSBwaXZvdEIgVGhlIHBvaW50IHJlbGF0aXZlIHRvIHRoZSBjZW50ZXIgb2YgbWFzcyBvZiBib2R5QiB3aGljaCBib2R5QiBpcyBjb25zdHJhaW5lZCB0by4KICAgICAqIEBwYXJhbSBtYXhGb3JjZSBUaGUgbWF4aW11bSBmb3JjZSB0aGF0IHNob3VsZCBiZSBhcHBsaWVkIHRvIGNvbnN0cmFpbiB0aGUgYm9kaWVzLgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgcGl2b3RBLCBib2R5QiwgcGl2b3RCLCBtYXhGb3JjZSkgewogICAgICBpZiAocGl2b3RBID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAocGl2b3RCID09PSB2b2lkIDApIHsKICAgICAgICBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICBpZiAobWF4Rm9yY2UgPT09IHZvaWQgMCkgewogICAgICAgIG1heEZvcmNlID0gMWU2OwogICAgICB9CgogICAgICBzdXBlcihib2R5QSwgYm9keUIpOwogICAgICB0aGlzLnBpdm90QSA9IHBpdm90QS5jbG9uZSgpOwogICAgICB0aGlzLnBpdm90QiA9IHBpdm90Qi5jbG9uZSgpOwogICAgICBjb25zdCB4ID0gdGhpcy5lcXVhdGlvblggPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIGNvbnN0IHkgPSB0aGlzLmVxdWF0aW9uWSA9IG5ldyBDb250YWN0RXF1YXRpb24oYm9keUEsIGJvZHlCKTsKICAgICAgY29uc3QgeiA9IHRoaXMuZXF1YXRpb25aID0gbmV3IENvbnRhY3RFcXVhdGlvbihib2R5QSwgYm9keUIpOyAvLyBFcXVhdGlvbnMgdG8gYmUgZmVkIHRvIHRoZSBzb2x2ZXIKCiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goeCwgeSwgeik7IC8vIE1ha2UgdGhlIGVxdWF0aW9ucyBiaWRpcmVjdGlvbmFsCgogICAgICB4Lm1pbkZvcmNlID0geS5taW5Gb3JjZSA9IHoubWluRm9yY2UgPSAtbWF4Rm9yY2U7CiAgICAgIHgubWF4Rm9yY2UgPSB5Lm1heEZvcmNlID0gei5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgICB4Lm5pLnNldCgxLCAwLCAwKTsKICAgICAgeS5uaS5zZXQoMCwgMSwgMCk7CiAgICAgIHoubmkuc2V0KDAsIDAsIDEpOwogICAgfQoKICAgIHVwZGF0ZSgpIHsKICAgICAgY29uc3QgYm9keUEgPSB0aGlzLmJvZHlBOwogICAgICBjb25zdCBib2R5QiA9IHRoaXMuYm9keUI7CiAgICAgIGNvbnN0IHggPSB0aGlzLmVxdWF0aW9uWDsKICAgICAgY29uc3QgeSA9IHRoaXMuZXF1YXRpb25ZOwogICAgICBjb25zdCB6ID0gdGhpcy5lcXVhdGlvblo7IC8vIFJvdGF0ZSB0aGUgcGl2b3RzIHRvIHdvcmxkIHNwYWNlCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KHRoaXMucGl2b3RBLCB4LnJpKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdCh0aGlzLnBpdm90QiwgeC5yaik7CiAgICAgIHkucmkuY29weSh4LnJpKTsKICAgICAgeS5yai5jb3B5KHgucmopOwogICAgICB6LnJpLmNvcHkoeC5yaSk7CiAgICAgIHoucmouY29weSh4LnJqKTsKICAgIH0KCiAgfQoKICAvKioKICAgKiBDb25lIGVxdWF0aW9uLiBXb3JrcyB0byBrZWVwIHRoZSBnaXZlbiBib2R5IHdvcmxkIHZlY3RvcnMgYWxpZ25lZCwgb3IgdGlsdGVkIHdpdGhpbiBhIGdpdmVuIGFuZ2xlIGZyb20gZWFjaCBvdGhlci4KICAgKi8KICBjbGFzcyBDb25lRXF1YXRpb24gZXh0ZW5kcyBFcXVhdGlvbiB7CiAgICAvKioKICAgICAqIExvY2FsIGF4aXMgaW4gQQogICAgICovCgogICAgLyoqCiAgICAgKiBMb2NhbCBheGlzIGluIEIKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlICJjb25lIGFuZ2xlIiB0byBrZWVwCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMjsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDI7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBUaGUgYW5nbGUgYmV0d2VlbiB0d28gdmVjdG9yIGlzOgogICAgICAvLyBjb3ModGhldGEpID0gYSAqIGIgLyAobGVuZ3RoKGEpICogbGVuZ3RoKGIpID0geyBsZW4oYSkgPSBsZW4oYikgPSAxIH0gPSBhICogYgogICAgICAvLyBnID0gYSAqIGIKICAgICAgLy8gZ2RvdCA9IChiIHggYSkgKiB3aSArIChhIHggYikgKiB3agogICAgICAvLyBHID0gWzAgYnhhIDAgYXhiXQogICAgICAvLyBXID0gW3ZpIHdpIHZqIHdqXQoKICAgICAgR0Eucm90YXRpb25hbC5jb3B5KG5qeG5pKTsKICAgICAgR0Iucm90YXRpb25hbC5jb3B5KG5peG5qKTsKICAgICAgY29uc3QgZyA9IE1hdGguY29zKHRoaXMuYW5nbGUpIC0gbmkuZG90KG5qKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLWcgKiBhIC0gR1cgKiBiIC0gaCAqIEdpTWY7CiAgICAgIHJldHVybiBCOwogICAgfQoKICB9CiAgY29uc3QgdG1wVmVjMSQyID0gbmV3IFZlYzMoKTsKICBjb25zdCB0bXBWZWMyJDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIGNvbnN0cmFpbnQuIFdvcmtzIHRvIGtlZXAgdGhlIGxvY2FsIHZlY3RvcnMgb3J0aG9nb25hbCB0byBlYWNoIG90aGVyIGluIHdvcmxkIHNwYWNlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxFcXVhdGlvbiBleHRlbmRzIEVxdWF0aW9uIHsKICAgIC8qKgogICAgICogV29ybGQgb3JpZW50ZWQgcm90YXRpb25hbCBheGlzLgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIG1heEFuZ2xlCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLW1heEZvcmNlLCBtYXhGb3JjZSk7CiAgICAgIHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMCwgMSwgMCk7CiAgICAgIHRoaXMubWF4QW5nbGUgPSBNYXRoLlBJIC8gMjsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIGNvbnN0IGEgPSB0aGlzLmE7CiAgICAgIGNvbnN0IGIgPSB0aGlzLmI7CiAgICAgIGNvbnN0IG5pID0gdGhpcy5heGlzQTsKICAgICAgY29uc3QgbmogPSB0aGlzLmF4aXNCOwogICAgICBjb25zdCBuaXhuaiA9IHRtcFZlYzEkMTsKICAgICAgY29uc3Qgbmp4bmkgPSB0bXBWZWMyJDE7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gQ2FsdWNsYXRlIGNyb3NzIHByb2R1Y3RzCgogICAgICBuaS5jcm9zcyhuaiwgbml4bmopOwogICAgICBuai5jcm9zcyhuaSwgbmp4bmkpOyAvLyBnID0gbmkgKiBuagogICAgICAvLyBnZG90ID0gKG5qIHggbmkpICogd2kgKyAobmkgeCBuaikgKiB3agogICAgICAvLyBHID0gWzAgbmp4bmkgMCBuaXhual0KICAgICAgLy8gVyA9IFt2aSB3aSB2aiB3al0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShuanhuaSk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShuaXhuaik7CiAgICAgIGNvbnN0IGcgPSBNYXRoLmNvcyh0aGlzLm1heEFuZ2xlKSAtIG5pLmRvdChuaik7CiAgICAgIGNvbnN0IEdXID0gdGhpcy5jb21wdXRlR1coKTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1nICogYSAtIEdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IHRtcFZlYzEkMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiQxID0gbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQSBDb25lIFR3aXN0IGNvbnN0cmFpbnQsIHVzZWZ1bCBmb3IgcmFnZG9sbHMuCiAgICovCiAgY2xhc3MgQ29uZVR3aXN0Q29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBUaGUgYXhpcyBkaXJlY3Rpb24gZm9yIHRoZSBjb25zdHJhaW50IG9mIHRoZSBib2R5IEEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBheGlzIGRpcmVjdGlvbiBmb3IgdGhlIGNvbnN0cmFpbnQgb2YgdGhlIGJvZHkgQi4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGFwZXJ0dXJlIGFuZ2xlIG9mIHRoZSBjb25lLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgdHdpc3QgYW5nbGUgb2YgdGhlIGpvaW50LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcihib2R5QSwgYm9keUIsIG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgY29uc3QgbWF4Rm9yY2UgPSB0eXBlb2Ygb3B0aW9ucy5tYXhGb3JjZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLm1heEZvcmNlIDogMWU2OyAvLyBTZXQgcGl2b3QgcG9pbnQgaW4gYmV0d2VlbgoKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICB0aGlzLmF4aXNBID0gb3B0aW9ucy5heGlzQSA/IG9wdGlvbnMuYXhpc0EuY2xvbmUoKSA6IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgdGhpcy5jb2xsaWRlQ29ubmVjdGVkID0gISFvcHRpb25zLmNvbGxpZGVDb25uZWN0ZWQ7CiAgICAgIHRoaXMuYW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy5hbmdsZSAhPT0gJ3VuZGVmaW5lZCcgPyBvcHRpb25zLmFuZ2xlIDogMDsKICAgICAgY29uc3QgYyA9IHRoaXMuY29uZUVxdWF0aW9uID0gbmV3IENvbmVFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCB0ID0gdGhpcy50d2lzdEVxdWF0aW9uID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLnR3aXN0QW5nbGUgPSB0eXBlb2Ygb3B0aW9ucy50d2lzdEFuZ2xlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMudHdpc3RBbmdsZSA6IDA7IC8vIE1ha2UgdGhlIGNvbmUgZXF1YXRpb24gcHVzaCB0aGUgYm9kaWVzIHRvd2FyZCB0aGUgY29uZSBheGlzLCBub3Qgb3V0d2FyZAoKICAgICAgYy5tYXhGb3JjZSA9IDA7CiAgICAgIGMubWluRm9yY2UgPSAtbWF4Rm9yY2U7IC8vIE1ha2UgdGhlIHR3aXN0IGVxdWF0aW9uIGFkZCB0b3JxdWUgdG93YXJkIHRoZSBpbml0aWFsIHBvc2l0aW9uCgogICAgICB0Lm1heEZvcmNlID0gMDsKICAgICAgdC5taW5Gb3JjZSA9IC1tYXhGb3JjZTsKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChjLCB0KTsKICAgIH0KCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBjb25lID0gdGhpcy5jb25lRXF1YXRpb247CiAgICAgIGNvbnN0IHR3aXN0ID0gdGhpcy50d2lzdEVxdWF0aW9uOwogICAgICBzdXBlci51cGRhdGUoKTsgLy8gVXBkYXRlIHRoZSBheGVzIHRvIHRoZSBjb25lIGNvbnN0cmFpbnQKCiAgICAgIGJvZHlBLnZlY3RvclRvV29ybGRGcmFtZSh0aGlzLmF4aXNBLCBjb25lLmF4aXNBKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHRoaXMuYXhpc0IsIGNvbmUuYXhpc0IpOyAvLyBVcGRhdGUgdGhlIHdvcmxkIGF4ZXMgaW4gdGhlIHR3aXN0IGNvbnN0cmFpbnQKCiAgICAgIHRoaXMuYXhpc0EudGFuZ2VudHModHdpc3QuYXhpc0EsIHR3aXN0LmF4aXNBKTsKICAgICAgYm9keUEudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNBLCB0d2lzdC5heGlzQSk7CiAgICAgIHRoaXMuYXhpc0IudGFuZ2VudHModHdpc3QuYXhpc0IsIHR3aXN0LmF4aXNCKTsKICAgICAgYm9keUIudmVjdG9yVG9Xb3JsZEZyYW1lKHR3aXN0LmF4aXNCLCB0d2lzdC5heGlzQik7CiAgICAgIGNvbmUuYW5nbGUgPSB0aGlzLmFuZ2xlOwogICAgICB0d2lzdC5tYXhBbmdsZSA9IHRoaXMudHdpc3RBbmdsZTsKICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ29uc3RyYWlucyB0d28gYm9kaWVzIHRvIGJlIGF0IGEgY29uc3RhbnQgZGlzdGFuY2UgZnJvbSBlYWNoIG90aGVycyBjZW50ZXIgb2YgbWFzcy4KICAgKi8KICBjbGFzcyBEaXN0YW5jZUNvbnN0cmFpbnQgZXh0ZW5kcyBDb25zdHJhaW50IHsKICAgIC8qKgogICAgICogVGhlIGRpc3RhbmNlIHRvIGtlZXAuIElmIHVuZGVmaW5lZCwgaXQgd2lsbCBiZSBzZXQgdG8gdGhlIGN1cnJlbnQgZGlzdGFuY2UgYmV0d2VlbiBib2R5QSBhbmQgYm9keUIKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRpc3RhbmNlIFRoZSBkaXN0YW5jZSB0byBrZWVwLiBJZiB1bmRlZmluZWQsIGl0IHdpbGwgYmUgc2V0IHRvIHRoZSBjdXJyZW50IGRpc3RhbmNlIGJldHdlZW4gYm9keUEgYW5kIGJvZHlCLgogICAgICogQHBhcmFtIG1heEZvcmNlIFRoZSBtYXhpbXVtIGZvcmNlIHRoYXQgc2hvdWxkIGJlIGFwcGxpZWQgdG8gY29uc3RyYWluIHRoZSBib2RpZXMuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgZGlzdGFuY2UsIG1heEZvcmNlKSB7CiAgICAgIGlmIChtYXhGb3JjZSA9PT0gdm9pZCAwKSB7CiAgICAgICAgbWF4Rm9yY2UgPSAxZTY7CiAgICAgIH0KCiAgICAgIHN1cGVyKGJvZHlBLCBib2R5Qik7CgogICAgICBpZiAodHlwZW9mIGRpc3RhbmNlID09PSAndW5kZWZpbmVkJykgewogICAgICAgIGRpc3RhbmNlID0gYm9keUEucG9zaXRpb24uZGlzdGFuY2VUbyhib2R5Qi5wb3NpdGlvbik7CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKICAgICAgY29uc3QgZXEgPSB0aGlzLmRpc3RhbmNlRXF1YXRpb24gPSBuZXcgQ29udGFjdEVxdWF0aW9uKGJvZHlBLCBib2R5Qik7CiAgICAgIHRoaXMuZXF1YXRpb25zLnB1c2goZXEpOyAvLyBNYWtlIGl0IGJpZGlyZWN0aW9uYWwKCiAgICAgIGVxLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgICBlcS5tYXhGb3JjZSA9IG1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBlcSA9IHRoaXMuZGlzdGFuY2VFcXVhdGlvbjsKICAgICAgY29uc3QgaGFsZkRpc3QgPSB0aGlzLmRpc3RhbmNlICogMC41OwogICAgICBjb25zdCBub3JtYWwgPSBlcS5uaTsKICAgICAgYm9keUIucG9zaXRpb24udnN1Yihib2R5QS5wb3NpdGlvbiwgbm9ybWFsKTsKICAgICAgbm9ybWFsLm5vcm1hbGl6ZSgpOwogICAgICBub3JtYWwuc2NhbGUoaGFsZkRpc3QsIGVxLnJpKTsKICAgICAgbm9ybWFsLnNjYWxlKC1oYWxmRGlzdCwgZXEucmopOwogICAgfQoKICB9CgogIC8qKgogICAqIExvY2sgY29uc3RyYWludC4gV2lsbCByZW1vdmUgYWxsIGRlZ3JlZXMgb2YgZnJlZWRvbSBiZXR3ZWVuIHRoZSBib2RpZXMuCiAgICovCiAgY2xhc3MgTG9ja0NvbnN0cmFpbnQgZXh0ZW5kcyBQb2ludFRvUG9pbnRDb25zdHJhaW50IHsKICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBjb25zdCBtYXhGb3JjZSA9IHR5cGVvZiBvcHRpb25zLm1heEZvcmNlICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMubWF4Rm9yY2UgOiAxZTY7IC8vIFNldCBwaXZvdCBwb2ludCBpbiBiZXR3ZWVuCgogICAgICBjb25zdCBwaXZvdEEgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBwaXZvdEIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBoYWxmV2F5ID0gbmV3IFZlYzMoKTsKICAgICAgYm9keUEucG9zaXRpb24udmFkZChib2R5Qi5wb3NpdGlvbiwgaGFsZldheSk7CiAgICAgIGhhbGZXYXkuc2NhbGUoMC41LCBoYWxmV2F5KTsKICAgICAgYm9keUIucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RCKTsKICAgICAgYm9keUEucG9pbnRUb0xvY2FsRnJhbWUoaGFsZldheSwgcGl2b3RBKTsgLy8gVGhlIHBvaW50LXRvLXBvaW50IGNvbnN0cmFpbnQgd2lsbCBrZWVwIGEgcG9pbnQgc2hhcmVkIGJldHdlZW4gdGhlIGJvZGllcwoKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOyAvLyBTdG9yZSBpbml0aWFsIHJvdGF0aW9uIG9mIHRoZSBib2RpZXMgYXMgdW5pdCB2ZWN0b3JzIGluIHRoZSBsb2NhbCBib2R5IHNwYWNlcwoKICAgICAgdGhpcy54QSA9IGJvZHlBLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWCk7CiAgICAgIHRoaXMueEIgPSBib2R5Qi52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1gpOwogICAgICB0aGlzLnlBID0gYm9keUEudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9ZKTsKICAgICAgdGhpcy55QiA9IGJvZHlCLnZlY3RvclRvTG9jYWxGcmFtZShWZWMzLlVOSVRfWSk7CiAgICAgIHRoaXMuekEgPSBib2R5QS52ZWN0b3JUb0xvY2FsRnJhbWUoVmVjMy5VTklUX1opOwogICAgICB0aGlzLnpCID0gYm9keUIudmVjdG9yVG9Mb2NhbEZyYW1lKFZlYzMuVU5JVF9aKTsgLy8gLi4uYW5kIHRoZSBmb2xsb3dpbmcgcm90YXRpb25hbCBlcXVhdGlvbnMgd2lsbCBrZWVwIGFsbCByb3RhdGlvbmFsIERPRidzIGluIHBsYWNlCgogICAgICBjb25zdCByMSA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMSA9IG5ldyBSb3RhdGlvbmFsRXF1YXRpb24oYm9keUEsIGJvZHlCLCBvcHRpb25zKTsKICAgICAgY29uc3QgcjIgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjIgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHIzID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24zID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKHIxLCByMiwgcjMpOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICB0aGlzLm1vdG9yRXF1YXRpb247CiAgICAgIGNvbnN0IHIxID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24xOwogICAgICBjb25zdCByMiA9IHRoaXMucm90YXRpb25hbEVxdWF0aW9uMjsKICAgICAgY29uc3QgcjMgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjM7CiAgICAgIHN1cGVyLnVwZGF0ZSgpOyAvLyBUaGVzZSB2ZWN0b3IgcGFpcnMgbXVzdCBiZSBvcnRob2dvbmFsCgogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QSwgcjEuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QiwgcjEuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy55QSwgcjIuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QiwgcjIuYXhpc0IpOwogICAgICBib2R5QS52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy56QSwgcjMuYXhpc0EpOwogICAgICBib2R5Qi52ZWN0b3JUb1dvcmxkRnJhbWUodGhpcy54QiwgcjMuYXhpc0IpOwogICAgfQoKICB9CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwoKICAvKioKICAgKiBSb3RhdGlvbmFsIG1vdG9yIGNvbnN0cmFpbnQuIFRyaWVzIHRvIGtlZXAgdGhlIHJlbGF0aXZlIGFuZ3VsYXIgdmVsb2NpdHkgb2YgdGhlIGJvZGllcyB0byBhIGdpdmVuIHZhbHVlLgogICAqLwogIGNsYXNzIFJvdGF0aW9uYWxNb3RvckVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLyoqCiAgICAgKiBXb3JsZCBvcmllbnRlZCByb3RhdGlvbmFsIGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdvcmxkIG9yaWVudGVkIHJvdGF0aW9uYWwgYXhpcy4KICAgICAqLwoKICAgIC8qKgogICAgICogTW90b3IgdmVsb2NpdHkuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5QiwgbWF4Rm9yY2UpIHsKICAgICAgaWYgKG1heEZvcmNlID09PSB2b2lkIDApIHsKICAgICAgICBtYXhGb3JjZSA9IDFlNjsKICAgICAgfQoKICAgICAgc3VwZXIoYm9keUEsIGJvZHlCLCAtbWF4Rm9yY2UsIG1heEZvcmNlKTsKICAgICAgdGhpcy5heGlzQSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMuYXhpc0IgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnRhcmdldFZlbG9jaXR5ID0gMDsKICAgIH0KCiAgICBjb21wdXRlQihoKSB7CiAgICAgIHRoaXMuYTsKICAgICAgY29uc3QgYiA9IHRoaXMuYjsKICAgICAgdGhpcy5iaTsKICAgICAgdGhpcy5iajsKICAgICAgY29uc3QgYXhpc0EgPSB0aGlzLmF4aXNBOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0I7CiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsgLy8gZyA9IDAKICAgICAgLy8gZ2RvdCA9IGF4aXNBICogd2kgLSBheGlzQiAqIHdqCiAgICAgIC8vIGdkb3QgPSBHICogVyA9IEcgKiBbdmkgd2kgdmogd2pdCiAgICAgIC8vID0+CiAgICAgIC8vIEcgPSBbMCBheGlzQSAwIC1heGlzQl0KCiAgICAgIEdBLnJvdGF0aW9uYWwuY29weShheGlzQSk7CiAgICAgIGF4aXNCLm5lZ2F0ZShHQi5yb3RhdGlvbmFsKTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpIC0gdGhpcy50YXJnZXRWZWxvY2l0eTsKICAgICAgY29uc3QgR2lNZiA9IHRoaXMuY29tcHV0ZUdpTWYoKTsKICAgICAgY29uc3QgQiA9IC1HVyAqIGIgLSBoICogR2lNZjsKICAgICAgcmV0dXJuIEI7CiAgICB9CgogIH0KCiAgLyoqCiAgICogSGluZ2UgY29uc3RyYWludC4gVGhpbmsgb2YgaXQgYXMgYSBkb29yIGhpbmdlLiBJdCB0cmllcyB0byBrZWVwIHRoZSBkb29yIGluIHRoZSBjb3JyZWN0IHBsYWNlIGFuZCB3aXRoIHRoZSBjb3JyZWN0IG9yaWVudGF0aW9uLgogICAqLwogIGNsYXNzIEhpbmdlQ29uc3RyYWludCBleHRlbmRzIFBvaW50VG9Qb2ludENvbnN0cmFpbnQgewogICAgLyoqCiAgICAgKiBSb3RhdGlvbiBheGlzLCBkZWZpbmVkIGxvY2FsbHkgaW4gYm9keUEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIGF4aXMsIGRlZmluZWQgbG9jYWxseSBpbiBib2R5Qi4KICAgICAqLwogICAgY29uc3RydWN0b3IoYm9keUEsIGJvZHlCLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IG1heEZvcmNlID0gdHlwZW9mIG9wdGlvbnMubWF4Rm9yY2UgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhGb3JjZSA6IDFlNjsKICAgICAgY29uc3QgcGl2b3RBID0gb3B0aW9ucy5waXZvdEEgPyBvcHRpb25zLnBpdm90QS5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcGl2b3RCID0gb3B0aW9ucy5waXZvdEIgPyBvcHRpb25zLnBpdm90Qi5jbG9uZSgpIDogbmV3IFZlYzMoKTsKICAgICAgc3VwZXIoYm9keUEsIHBpdm90QSwgYm9keUIsIHBpdm90QiwgbWF4Rm9yY2UpOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0EgPSBvcHRpb25zLmF4aXNBID8gb3B0aW9ucy5heGlzQS5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNBLm5vcm1hbGl6ZSgpOwogICAgICBjb25zdCBheGlzQiA9IHRoaXMuYXhpc0IgPSBvcHRpb25zLmF4aXNCID8gb3B0aW9ucy5heGlzQi5jbG9uZSgpIDogbmV3IFZlYzMoMSwgMCwgMCk7CiAgICAgIGF4aXNCLm5vcm1hbGl6ZSgpOwogICAgICB0aGlzLmNvbGxpZGVDb25uZWN0ZWQgPSAhIW9wdGlvbnMuY29sbGlkZUNvbm5lY3RlZDsKICAgICAgY29uc3Qgcm90YXRpb25hbDEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjEgPSBuZXcgUm90YXRpb25hbEVxdWF0aW9uKGJvZHlBLCBib2R5Qiwgb3B0aW9ucyk7CiAgICAgIGNvbnN0IHJvdGF0aW9uYWwyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yID0gbmV3IFJvdGF0aW9uYWxFcXVhdGlvbihib2R5QSwgYm9keUIsIG9wdGlvbnMpOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbiA9IG5ldyBSb3RhdGlvbmFsTW90b3JFcXVhdGlvbihib2R5QSwgYm9keUIsIG1heEZvcmNlKTsKICAgICAgbW90b3IuZW5hYmxlZCA9IGZhbHNlOyAvLyBOb3QgZW5hYmxlZCBieSBkZWZhdWx0CiAgICAgIC8vIEVxdWF0aW9ucyB0byBiZSBmZWQgdG8gdGhlIHNvbHZlcgoKICAgICAgdGhpcy5lcXVhdGlvbnMucHVzaChyb3RhdGlvbmFsMSwgcm90YXRpb25hbDIsIG1vdG9yKTsKICAgIH0KICAgIC8qKgogICAgICogZW5hYmxlTW90b3IKICAgICAqLwoKCiAgICBlbmFibGVNb3RvcigpIHsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLmVuYWJsZWQgPSB0cnVlOwogICAgfQogICAgLyoqCiAgICAgKiBkaXNhYmxlTW90b3IKICAgICAqLwoKCiAgICBkaXNhYmxlTW90b3IoKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi5lbmFibGVkID0gZmFsc2U7CiAgICB9CiAgICAvKioKICAgICAqIHNldE1vdG9yU3BlZWQKICAgICAqLwoKCiAgICBzZXRNb3RvclNwZWVkKHNwZWVkKSB7CiAgICAgIHRoaXMubW90b3JFcXVhdGlvbi50YXJnZXRWZWxvY2l0eSA9IHNwZWVkOwogICAgfQogICAgLyoqCiAgICAgKiBzZXRNb3Rvck1heEZvcmNlCiAgICAgKi8KCgogICAgc2V0TW90b3JNYXhGb3JjZShtYXhGb3JjZSkgewogICAgICB0aGlzLm1vdG9yRXF1YXRpb24ubWF4Rm9yY2UgPSBtYXhGb3JjZTsKICAgICAgdGhpcy5tb3RvckVxdWF0aW9uLm1pbkZvcmNlID0gLW1heEZvcmNlOwogICAgfQogICAgLyoqCiAgICAgKiB1cGRhdGUKICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIGNvbnN0IGJvZHlBID0gdGhpcy5ib2R5QTsKICAgICAgY29uc3QgYm9keUIgPSB0aGlzLmJvZHlCOwogICAgICBjb25zdCBtb3RvciA9IHRoaXMubW90b3JFcXVhdGlvbjsKICAgICAgY29uc3QgcjEgPSB0aGlzLnJvdGF0aW9uYWxFcXVhdGlvbjE7CiAgICAgIGNvbnN0IHIyID0gdGhpcy5yb3RhdGlvbmFsRXF1YXRpb24yOwogICAgICBjb25zdCB3b3JsZEF4aXNBID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMxOwogICAgICBjb25zdCB3b3JsZEF4aXNCID0gSGluZ2VDb25zdHJhaW50X3VwZGF0ZV90bXBWZWMyOwogICAgICBjb25zdCBheGlzQSA9IHRoaXMuYXhpc0E7CiAgICAgIGNvbnN0IGF4aXNCID0gdGhpcy5heGlzQjsKICAgICAgc3VwZXIudXBkYXRlKCk7IC8vIEdldCB3b3JsZCBheGVzCgogICAgICBib2R5QS5xdWF0ZXJuaW9uLnZtdWx0KGF4aXNBLCB3b3JsZEF4aXNBKTsKICAgICAgYm9keUIucXVhdGVybmlvbi52bXVsdChheGlzQiwgd29ybGRBeGlzQik7CiAgICAgIHdvcmxkQXhpc0EudGFuZ2VudHMocjEuYXhpc0EsIHIyLmF4aXNBKTsKICAgICAgcjEuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKICAgICAgcjIuYXhpc0IuY29weSh3b3JsZEF4aXNCKTsKCiAgICAgIGlmICh0aGlzLm1vdG9yRXF1YXRpb24uZW5hYmxlZCkgewogICAgICAgIGJvZHlBLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQSwgbW90b3IuYXhpc0EpOwogICAgICAgIGJvZHlCLnF1YXRlcm5pb24udm11bHQodGhpcy5heGlzQiwgbW90b3IuYXhpc0IpOwogICAgICB9CiAgICB9CgogIH0KICBjb25zdCBIaW5nZUNvbnN0cmFpbnRfdXBkYXRlX3RtcFZlYzEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEhpbmdlQ29uc3RyYWludF91cGRhdGVfdG1wVmVjMiA9IG5ldyBWZWMzKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnMgdGhlIHNsaXBwaW5nIGluIGEgY29udGFjdCBhbG9uZyBhIHRhbmdlbnQKICAgKi8KICBjbGFzcyBGcmljdGlvbkVxdWF0aW9uIGV4dGVuZHMgRXF1YXRpb24gewogICAgLy8gVGFuZ2VudAoKICAgIC8qKgogICAgICogQHBhcmFtIHNsaXBGb3JjZSBzaG91bGQgYmUgKy1GX2ZyaWN0aW9uID0gKy1tdSAqIEZfbm9ybWFsID0gKy1tdSAqIG0gKiBnCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgc2xpcEZvcmNlKSB7CiAgICAgIHN1cGVyKGJvZHlBLCBib2R5QiwgLXNsaXBGb3JjZSwgc2xpcEZvcmNlKTsKICAgICAgdGhpcy5yaSA9IG5ldyBWZWMzKCk7CiAgICAgIHRoaXMucmogPSBuZXcgVmVjMygpOwogICAgICB0aGlzLnQgPSBuZXcgVmVjMygpOwogICAgfQoKICAgIGNvbXB1dGVCKGgpIHsKICAgICAgdGhpcy5hOwogICAgICBjb25zdCBiID0gdGhpcy5iOwogICAgICB0aGlzLmJpOwogICAgICB0aGlzLmJqOwogICAgICBjb25zdCByaSA9IHRoaXMucmk7CiAgICAgIGNvbnN0IHJqID0gdGhpcy5yajsKICAgICAgY29uc3Qgcml4dCA9IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDE7CiAgICAgIGNvbnN0IHJqeHQgPSBGcmljdGlvbkVxdWF0aW9uX2NvbXB1dGVCX3RlbXAyOwogICAgICBjb25zdCB0ID0gdGhpcy50OyAvLyBDYWx1Y2xhdGUgY3Jvc3MgcHJvZHVjdHMKCiAgICAgIHJpLmNyb3NzKHQsIHJpeHQpOwogICAgICByai5jcm9zcyh0LCByanh0KTsgLy8gRyA9IFstdCAtcml4dCB0IHJqeHRdCiAgICAgIC8vIEFuZCByZW1lbWJlciwgdGhpcyBpcyBhIHB1cmUgdmVsb2NpdHkgY29uc3RyYWludCwgZyBpcyBhbHdheXMgemVybyEKCiAgICAgIGNvbnN0IEdBID0gdGhpcy5qYWNvYmlhbkVsZW1lbnRBOwogICAgICBjb25zdCBHQiA9IHRoaXMuamFjb2JpYW5FbGVtZW50QjsKICAgICAgdC5uZWdhdGUoR0Euc3BhdGlhbCk7CiAgICAgIHJpeHQubmVnYXRlKEdBLnJvdGF0aW9uYWwpOwogICAgICBHQi5zcGF0aWFsLmNvcHkodCk7CiAgICAgIEdCLnJvdGF0aW9uYWwuY29weShyanh0KTsKICAgICAgY29uc3QgR1cgPSB0aGlzLmNvbXB1dGVHVygpOwogICAgICBjb25zdCBHaU1mID0gdGhpcy5jb21wdXRlR2lNZigpOwogICAgICBjb25zdCBCID0gLUdXICogYiAtIGggKiBHaU1mOwogICAgICByZXR1cm4gQjsKICAgIH0KCiAgfQogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IEZyaWN0aW9uRXF1YXRpb25fY29tcHV0ZUJfdGVtcDIgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBEZWZpbmVzIHdoYXQgaGFwcGVucyB3aGVuIHR3byBtYXRlcmlhbHMgbWVldC4KICAgKiBAdG9kbyBSZWZhY3RvciBtYXRlcmlhbHMgdG8gbWF0ZXJpYWxBIGFuZCBtYXRlcmlhbEIKICAgKi8KICBjbGFzcyBDb250YWN0TWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBJZGVudGlmaWVyIG9mIHRoaXMgbWF0ZXJpYWwuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFBhcnRpY2lwYXRpbmcgbWF0ZXJpYWxzLgogICAgICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBSZXN0aXR1dGlvbiBjb2VmZmljaWVudC4KICAgICAqIEBkZWZhdWx0IDAuMwogICAgICovCgogICAgLyoqCiAgICAgKiBTdGlmZm5lc3Mgb2YgdGhlIHByb2R1Y2VkIGNvbnRhY3QgZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgY29udGFjdCBlcXVhdGlvbnMuCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KCiAgICAvKioKICAgICAqIFN0aWZmbmVzcyBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zLgogICAgICogQGRlZmF1bHQgMWU3CiAgICAgKi8KCiAgICAvKioKICAgICAqIFJlbGF4YXRpb24gdGltZSBvZiB0aGUgcHJvZHVjZWQgZnJpY3Rpb24gZXF1YXRpb25zCiAgICAgKiBAZGVmYXVsdCAzCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG0xLCBtMiwgb3B0aW9ucykgewogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGZyaWN0aW9uOiAwLjMsCiAgICAgICAgcmVzdGl0dXRpb246IDAuMywKICAgICAgICBjb250YWN0RXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBjb250YWN0RXF1YXRpb25SZWxheGF0aW9uOiAzLAogICAgICAgIGZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3M6IDFlNywKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbjogMwogICAgICB9KTsKICAgICAgdGhpcy5pZCA9IENvbnRhY3RNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5tYXRlcmlhbHMgPSBbbTEsIG0yXTsKICAgICAgdGhpcy5mcmljdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb247CiAgICAgIHRoaXMucmVzdGl0dXRpb24gPSBvcHRpb25zLnJlc3RpdHV0aW9uOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuY29udGFjdEVxdWF0aW9uU3RpZmZuZXNzOwogICAgICB0aGlzLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24gPSBvcHRpb25zLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb247CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcyA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzczsKICAgICAgdGhpcy5mcmljdGlvbkVxdWF0aW9uUmVsYXhhdGlvbiA9IG9wdGlvbnMuZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb247CiAgICB9CgogIH0KICBDb250YWN0TWF0ZXJpYWwuaWRDb3VudGVyID0gMDsKCiAgLyoqCiAgICogRGVmaW5lcyBhIHBoeXNpY3MgbWF0ZXJpYWwuCiAgICovCiAgY2xhc3MgTWF0ZXJpYWwgewogICAgLyoqCiAgICAgKiBNYXRlcmlhbCBuYW1lLgogICAgICogSWYgb3B0aW9ucyBpcyBhIHN0cmluZywgbmFtZSB3aWxsIGJlIHNldCB0byB0aGF0IHN0cmluZy4KICAgICAqIEB0b2RvIERlcHJlY2F0ZSB0aGlzCiAgICAgKi8KCiAgICAvKiogTWF0ZXJpYWwgaWQuICovCgogICAgLyoqCiAgICAgKiBGcmljdGlvbiBmb3IgdGhpcyBtYXRlcmlhbC4KICAgICAqIElmIG5vbi1uZWdhdGl2ZSwgaXQgd2lsbCBiZSB1c2VkIGluc3RlYWQgb2YgdGhlIGZyaWN0aW9uIGdpdmVuIGJ5IENvbnRhY3RNYXRlcmlhbHMuIElmIHRoZXJlJ3Mgbm8gbWF0Y2hpbmcgQ29udGFjdE1hdGVyaWFsLCB0aGUgdmFsdWUgZnJvbSBgZGVmYXVsdENvbnRhY3RNYXRlcmlhbGAgaW4gdGhlIFdvcmxkIHdpbGwgYmUgdXNlZC4KICAgICAqLwoKICAgIC8qKgogICAgICogUmVzdGl0dXRpb24gZm9yIHRoaXMgbWF0ZXJpYWwuCiAgICAgKiBJZiBub24tbmVnYXRpdmUsIGl0IHdpbGwgYmUgdXNlZCBpbnN0ZWFkIG9mIHRoZSByZXN0aXR1dGlvbiBnaXZlbiBieSBDb250YWN0TWF0ZXJpYWxzLiBJZiB0aGVyZSdzIG5vIG1hdGNoaW5nIENvbnRhY3RNYXRlcmlhbCwgdGhlIHZhbHVlIGZyb20gYGRlZmF1bHRDb250YWN0TWF0ZXJpYWxgIGluIHRoZSBXb3JsZCB3aWxsIGJlIHVzZWQuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHsKICAgICAgaWYgKG9wdGlvbnMgPT09IHZvaWQgMCkgewogICAgICAgIG9wdGlvbnMgPSB7fTsKICAgICAgfQoKICAgICAgbGV0IG5hbWUgPSAnJzsgLy8gQmFja3dhcmRzIGNvbXBhdGliaWxpdHkgZml4CgogICAgICBpZiAodHlwZW9mIG9wdGlvbnMgPT09ICdzdHJpbmcnKSB7CiAgICAgICAgLy9jb25zb2xlLndhcm4oYFBhc3NpbmcgYSBzdHJpbmcgdG8gTWF0ZXJpYWxPcHRpb25zIGlzIGRlcHJlY2F0ZWQsIGFuZCBoYXMgbm8gZWZmZWN0YCkKICAgICAgICBuYW1lID0gb3B0aW9uczsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIHRoaXMubmFtZSA9IG5hbWU7CiAgICAgIHRoaXMuaWQgPSBNYXRlcmlhbC5pZENvdW50ZXIrKzsKICAgICAgdGhpcy5mcmljdGlvbiA9IHR5cGVvZiBvcHRpb25zLmZyaWN0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuZnJpY3Rpb24gOiAtMTsKICAgICAgdGhpcy5yZXN0aXR1dGlvbiA9IHR5cGVvZiBvcHRpb25zLnJlc3RpdHV0aW9uICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMucmVzdGl0dXRpb24gOiAtMTsKICAgIH0KCiAgfQogIE1hdGVyaWFsLmlkQ291bnRlciA9IDA7CgogIC8qKgogICAqIEEgc3ByaW5nLCBjb25uZWN0aW5nIHR3byBib2RpZXMuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3Qgc3ByaW5nID0gbmV3IFNwcmluZyhib3hCb2R5LCBzcGhlcmVCb2R5LCB7CiAgICogICAgICAgcmVzdExlbmd0aDogMCwKICAgKiAgICAgICBzdGlmZm5lc3M6IDUwLAogICAqICAgICAgIGRhbXBpbmc6IDEsCiAgICogICAgIH0pCiAgICoKICAgKiAgICAgLy8gQ29tcHV0ZSB0aGUgZm9yY2UgYWZ0ZXIgZWFjaCBzdGVwCiAgICogICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgKGV2ZW50KSA9PiB7CiAgICogICAgICAgc3ByaW5nLmFwcGx5Rm9yY2UoKQogICAqICAgICB9KQogICAqLwogIGNsYXNzIFNwcmluZyB7CiAgICAvKioKICAgICAqIFJlc3QgbGVuZ3RoIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID4gMC4KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogU3RpZmZuZXNzIG9mIHRoZSBzcHJpbmcuIEEgbnVtYmVyID49IDAuCiAgICAgKiBAZGVmYXVsdCAxMDAKICAgICAqLwoKICAgIC8qKgogICAgICogRGFtcGluZyBvZiB0aGUgc3ByaW5nLiBBIG51bWJlciA+PSAwLgogICAgICogQGRlZmF1bHQgMQogICAgICovCgogICAgLyoqCiAgICAgKiBGaXJzdCBjb25uZWN0ZWQgYm9keS4KICAgICAqLwoKICAgIC8qKgogICAgICogU2Vjb25kIGNvbm5lY3RlZCBib2R5LgogICAgICovCgogICAgLyoqCiAgICAgKiBBbmNob3IgZm9yIGJvZHlBIGluIGxvY2FsIGJvZHlBIGNvb3JkaW5hdGVzLgogICAgICogV2hlcmUgdG8gaG9vayB0aGUgc3ByaW5nIHRvIGJvZHkgQSwgaW4gbG9jYWwgYm9keSBjb29yZGluYXRlcy4KICAgICAqIEBkZWZhdWx0IG5ldyBWZWMzKCkKICAgICAqLwoKICAgIC8qKgogICAgICogQW5jaG9yIGZvciBib2R5QiBpbiBsb2NhbCBib2R5QiBjb29yZGluYXRlcy4KICAgICAqIFdoZXJlIHRvIGhvb2sgdGhlIHNwcmluZyB0byBib2R5IEIsIGluIGxvY2FsIGJvZHkgY29vcmRpbmF0ZXMuCiAgICAgKiBAZGVmYXVsdCBuZXcgVmVjMygpCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKGJvZHlBLCBib2R5Qiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJlc3RMZW5ndGggPSB0eXBlb2Ygb3B0aW9ucy5yZXN0TGVuZ3RoID09PSAnbnVtYmVyJyA/IG9wdGlvbnMucmVzdExlbmd0aCA6IDE7CiAgICAgIHRoaXMuc3RpZmZuZXNzID0gb3B0aW9ucy5zdGlmZm5lc3MgfHwgMTAwOwogICAgICB0aGlzLmRhbXBpbmcgPSBvcHRpb25zLmRhbXBpbmcgfHwgMTsKICAgICAgdGhpcy5ib2R5QSA9IGJvZHlBOwogICAgICB0aGlzLmJvZHlCID0gYm9keUI7CiAgICAgIHRoaXMubG9jYWxBbmNob3JBID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy5sb2NhbEFuY2hvckIgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMubG9jYWxBbmNob3JBKSB7CiAgICAgICAgdGhpcy5sb2NhbEFuY2hvckEuY29weShvcHRpb25zLmxvY2FsQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmxvY2FsQW5jaG9yQikgewogICAgICAgIHRoaXMubG9jYWxBbmNob3JCLmNvcHkob3B0aW9ucy5sb2NhbEFuY2hvckIpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy53b3JsZEFuY2hvckEpIHsKICAgICAgICB0aGlzLnNldFdvcmxkQW5jaG9yQShvcHRpb25zLndvcmxkQW5jaG9yQSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLndvcmxkQW5jaG9yQikgewogICAgICAgIHRoaXMuc2V0V29ybGRBbmNob3JCKG9wdGlvbnMud29ybGRBbmNob3JCKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIGFuY2hvciBwb2ludCBvbiBib2R5IEEsIHVzaW5nIHdvcmxkIGNvb3JkaW5hdGVzLgogICAgICovCgoKICAgIHNldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpIHsKICAgICAgdGhpcy5ib2R5QS5wb2ludFRvTG9jYWxGcmFtZSh3b3JsZEFuY2hvckEsIHRoaXMubG9jYWxBbmNob3JBKTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBhbmNob3IgcG9pbnQgb24gYm9keSBCLCB1c2luZyB3b3JsZCBjb29yZGluYXRlcy4KICAgICAqLwoKCiAgICBzZXRXb3JsZEFuY2hvckIod29ybGRBbmNob3JCKSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb0xvY2FsRnJhbWUod29ybGRBbmNob3JCLCB0aGlzLmxvY2FsQW5jaG9yQik7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQSwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckEocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUEucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckEsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgYW5jaG9yIHBvaW50IG9uIGJvZHkgQiwgaW4gd29ybGQgY29vcmRpbmF0ZXMuCiAgICAgKiBAcGFyYW0gcmVzdWx0IFRoZSB2ZWN0b3IgdG8gc3RvcmUgdGhlIHJlc3VsdCBpbi4KICAgICAqLwoKCiAgICBnZXRXb3JsZEFuY2hvckIocmVzdWx0KSB7CiAgICAgIHRoaXMuYm9keUIucG9pbnRUb1dvcmxkRnJhbWUodGhpcy5sb2NhbEFuY2hvckIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIEFwcGx5IHRoZSBzcHJpbmcgZm9yY2UgdG8gdGhlIGNvbm5lY3RlZCBib2RpZXMuCiAgICAgKi8KCgogICAgYXBwbHlGb3JjZSgpIHsKICAgICAgY29uc3QgayA9IHRoaXMuc3RpZmZuZXNzOwogICAgICBjb25zdCBkID0gdGhpcy5kYW1waW5nOwogICAgICBjb25zdCBsID0gdGhpcy5yZXN0TGVuZ3RoOwogICAgICBjb25zdCBib2R5QSA9IHRoaXMuYm9keUE7CiAgICAgIGNvbnN0IGJvZHlCID0gdGhpcy5ib2R5QjsKICAgICAgY29uc3QgciA9IGFwcGx5Rm9yY2VfcjsKICAgICAgY29uc3Qgcl91bml0ID0gYXBwbHlGb3JjZV9yX3VuaXQ7CiAgICAgIGNvbnN0IHUgPSBhcHBseUZvcmNlX3U7CiAgICAgIGNvbnN0IGYgPSBhcHBseUZvcmNlX2Y7CiAgICAgIGNvbnN0IHRtcCA9IGFwcGx5Rm9yY2VfdG1wOwogICAgICBjb25zdCB3b3JsZEFuY2hvckEgPSBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQTsKICAgICAgY29uc3Qgd29ybGRBbmNob3JCID0gYXBwbHlGb3JjZV93b3JsZEFuY2hvckI7CiAgICAgIGNvbnN0IHJpID0gYXBwbHlGb3JjZV9yaTsKICAgICAgY29uc3QgcmogPSBhcHBseUZvcmNlX3JqOwogICAgICBjb25zdCByaV94X2YgPSBhcHBseUZvcmNlX3JpX3hfZjsKICAgICAgY29uc3QgcmpfeF9mID0gYXBwbHlGb3JjZV9yal94X2Y7IC8vIEdldCB3b3JsZCBhbmNob3JzCgogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQSh3b3JsZEFuY2hvckEpOwogICAgICB0aGlzLmdldFdvcmxkQW5jaG9yQih3b3JsZEFuY2hvckIpOyAvLyBHZXQgb2Zmc2V0IHBvaW50cwoKICAgICAgd29ybGRBbmNob3JBLnZzdWIoYm9keUEucG9zaXRpb24sIHJpKTsKICAgICAgd29ybGRBbmNob3JCLnZzdWIoYm9keUIucG9zaXRpb24sIHJqKTsgLy8gQ29tcHV0ZSBkaXN0YW5jZSB2ZWN0b3IgYmV0d2VlbiB3b3JsZCBhbmNob3IgcG9pbnRzCgogICAgICB3b3JsZEFuY2hvckIudnN1Yih3b3JsZEFuY2hvckEsIHIpOwogICAgICBjb25zdCBybGVuID0gci5sZW5ndGgoKTsKICAgICAgcl91bml0LmNvcHkocik7CiAgICAgIHJfdW5pdC5ub3JtYWxpemUoKTsgLy8gQ29tcHV0ZSByZWxhdGl2ZSB2ZWxvY2l0eSBvZiB0aGUgYW5jaG9yIHBvaW50cywgdQoKICAgICAgYm9keUIudmVsb2NpdHkudnN1Yihib2R5QS52ZWxvY2l0eSwgdSk7IC8vIEFkZCByb3RhdGlvbmFsIHZlbG9jaXR5CgogICAgICBib2R5Qi5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmosIHRtcCk7CiAgICAgIHUudmFkZCh0bXAsIHUpOwogICAgICBib2R5QS5hbmd1bGFyVmVsb2NpdHkuY3Jvc3MocmksIHRtcCk7CiAgICAgIHUudnN1Yih0bXAsIHUpOyAvLyBGID0gLSBrICogKCB4IC0gTCApIC0gRCAqICggdSApCgogICAgICByX3VuaXQuc2NhbGUoLWsgKiAocmxlbiAtIGwpIC0gZCAqIHUuZG90KHJfdW5pdCksIGYpOyAvLyBBZGQgZm9yY2VzIHRvIGJvZGllcwoKICAgICAgYm9keUEuZm9yY2UudnN1YihmLCBib2R5QS5mb3JjZSk7CiAgICAgIGJvZHlCLmZvcmNlLnZhZGQoZiwgYm9keUIuZm9yY2UpOyAvLyBBbmd1bGFyIGZvcmNlCgogICAgICByaS5jcm9zcyhmLCByaV94X2YpOwogICAgICByai5jcm9zcyhmLCByal94X2YpOwogICAgICBib2R5QS50b3JxdWUudnN1YihyaV94X2YsIGJvZHlBLnRvcnF1ZSk7CiAgICAgIGJvZHlCLnRvcnF1ZS52YWRkKHJqX3hfZiwgYm9keUIudG9ycXVlKTsKICAgIH0KCiAgfQogIGNvbnN0IGFwcGx5Rm9yY2VfciA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9yX3VuaXQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfdSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3dvcmxkQW5jaG9yQSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV93b3JsZEFuY2hvckIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmkgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmogPSBuZXcgVmVjMygpOwogIGNvbnN0IGFwcGx5Rm9yY2VfcmlfeF9mID0gbmV3IFZlYzMoKTsKICBjb25zdCBhcHBseUZvcmNlX3JqX3hfZiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgYXBwbHlGb3JjZV90bXAgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBXaGVlbEluZm8KICAgKi8KICBjbGFzcyBXaGVlbEluZm8gewogICAgLyoqCiAgICAgKiBNYXggdHJhdmVsIGRpc3RhbmNlIG9mIHRoZSBzdXNwZW5zaW9uLCBpbiBtZXRlcnMuCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNwZWVkIHRvIGFwcGx5IHRvIHRoZSB3aGVlbCByb3RhdGlvbiB3aGVuIHRoZSB3aGVlbCBpcyBzbGlkaW5nLgogICAgICogQGRlZmF1bHQgLTAuMQogICAgICovCgogICAgLyoqCiAgICAgKiBJZiB0aGUgY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCBzaG91bGQgYmUgdXNlZC4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaWRpbmcKICAgICAqLwoKICAgIC8qKgogICAgICogQ29ubmVjdGlvbiBwb2ludCwgZGVmaW5lZCBsb2NhbGx5IGluIHRoZSBjaGFzc2lzIGJvZHkgZnJhbWUuCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Mb2NhbAogICAgICovCgogICAgLyoqCiAgICAgKiBkaXJlY3Rpb25Xb3JsZAogICAgICovCgogICAgLyoqCiAgICAgKiBheGxlTG9jYWwKICAgICAqLwoKICAgIC8qKgogICAgICogYXhsZVdvcmxkCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25SZXN0TGVuZ3RoCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25NYXhMZW5ndGgKICAgICAqIEBkZWZhdWx0IDIKICAgICAqLwoKICAgIC8qKgogICAgICogcmFkaXVzCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25TdGlmZm5lc3MKICAgICAqIEBkZWZhdWx0IDEwMAogICAgICovCgogICAgLyoqCiAgICAgKiBkYW1waW5nQ29tcHJlc3Npb24KICAgICAqIEBkZWZhdWx0IDEwCiAgICAgKi8KCiAgICAvKioKICAgICAqIGRhbXBpbmdSZWxheGF0aW9uCiAgICAgKiBAZGVmYXVsdCAxMAogICAgICovCgogICAgLyoqCiAgICAgKiBmcmljdGlvblNsaXAKICAgICAqIEBkZWZhdWx0IDEwLjUKICAgICAqLwoKICAgIC8qKiBmb3J3YXJkQWNjZWxlcmF0aW9uICovCgogICAgLyoqIHNpZGVBY2NlbGVyYXRpb24gKi8KCiAgICAvKioKICAgICAqIHN0ZWVyaW5nCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFJvdGF0aW9uIHZhbHVlLCBpbiByYWRpYW5zLgogICAgICogQGRlZmF1bHQgMAogICAgICovCgogICAgLyoqCiAgICAgKiBkZWx0YVJvdGF0aW9uCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHJvbGxJbmZsdWVuY2UKICAgICAqIEBkZWZhdWx0IDAuMDEKICAgICAqLwoKICAgIC8qKgogICAgICogbWF4U3VzcGVuc2lvbkZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGVuZ2luZUZvcmNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGJyYWtlCiAgICAgKi8KCiAgICAvKioKICAgICAqIGlzRnJvbnRXaGVlbAogICAgICogQGRlZmF1bHQgdHJ1ZQogICAgICovCgogICAgLyoqCiAgICAgKiBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24KICAgICAqIEBkZWZhdWx0IDEKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc3VzcGVuc2lvbkZvcmNlCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNsaXBJbmZvCiAgICAgKi8KCiAgICAvKioKICAgICAqIHNraWRJbmZvCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIHN1c3BlbnNpb25MZW5ndGgKICAgICAqIEBkZWZhdWx0IDAKICAgICAqLwoKICAgIC8qKgogICAgICogc2lkZUltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogZm9yd2FyZEltcHVsc2UKICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIHJlc3VsdCBmcm9tIHJheWNhc3RpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZWVsIHdvcmxkIHRyYW5zZm9ybS4KICAgICAqLwoKICAgIC8qKgogICAgICogaXNJbkNvbnRhY3QKICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zID0gVXRpbHMuZGVmYXVsdHMob3B0aW9ucywgewogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbDogbmV3IFZlYzMoKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uTG9jYWw6IG5ldyBWZWMzKCksCiAgICAgICAgZGlyZWN0aW9uV29ybGQ6IG5ldyBWZWMzKCksCiAgICAgICAgYXhsZUxvY2FsOiBuZXcgVmVjMygpLAogICAgICAgIGF4bGVXb3JsZDogbmV3IFZlYzMoKSwKICAgICAgICBzdXNwZW5zaW9uUmVzdExlbmd0aDogMSwKICAgICAgICBzdXNwZW5zaW9uTWF4TGVuZ3RoOiAyLAogICAgICAgIHJhZGl1czogMSwKICAgICAgICBzdXNwZW5zaW9uU3RpZmZuZXNzOiAxMDAsCiAgICAgICAgZGFtcGluZ0NvbXByZXNzaW9uOiAxMCwKICAgICAgICBkYW1waW5nUmVsYXhhdGlvbjogMTAsCiAgICAgICAgZnJpY3Rpb25TbGlwOiAxMC41LAogICAgICAgIGZvcndhcmRBY2NlbGVyYXRpb246IDEsCiAgICAgICAgc2lkZUFjY2VsZXJhdGlvbjogMSwKICAgICAgICBzdGVlcmluZzogMCwKICAgICAgICByb3RhdGlvbjogMCwKICAgICAgICBkZWx0YVJvdGF0aW9uOiAwLAogICAgICAgIHJvbGxJbmZsdWVuY2U6IDAuMDEsCiAgICAgICAgbWF4U3VzcGVuc2lvbkZvcmNlOiBOdW1iZXIuTUFYX1ZBTFVFLAogICAgICAgIGlzRnJvbnRXaGVlbDogdHJ1ZSwKICAgICAgICBjbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb246IDEsCiAgICAgICAgc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHk6IDAsCiAgICAgICAgc3VzcGVuc2lvbkZvcmNlOiAwLAogICAgICAgIHNsaXBJbmZvOiAwLAogICAgICAgIHNraWRJbmZvOiAwLAogICAgICAgIHN1c3BlbnNpb25MZW5ndGg6IDAsCiAgICAgICAgbWF4U3VzcGVuc2lvblRyYXZlbDogMSwKICAgICAgICB1c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiBmYWxzZSwKICAgICAgICBjdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOiAtMC4xCiAgICAgIH0pOwogICAgICB0aGlzLm1heFN1c3BlbnNpb25UcmF2ZWwgPSBvcHRpb25zLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgIHRoaXMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZCA9IG9wdGlvbnMuY3VzdG9tU2xpZGluZ1JvdGF0aW9uYWxTcGVlZDsKICAgICAgdGhpcy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkID0gb3B0aW9ucy51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkOwogICAgICB0aGlzLnNsaWRpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5jaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWwgPSBvcHRpb25zLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbC5jbG9uZSgpOwogICAgICB0aGlzLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZCA9IG9wdGlvbnMuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uTG9jYWwgPSBvcHRpb25zLmRpcmVjdGlvbkxvY2FsLmNsb25lKCk7CiAgICAgIHRoaXMuZGlyZWN0aW9uV29ybGQgPSBvcHRpb25zLmRpcmVjdGlvbldvcmxkLmNsb25lKCk7CiAgICAgIHRoaXMuYXhsZUxvY2FsID0gb3B0aW9ucy5heGxlTG9jYWwuY2xvbmUoKTsKICAgICAgdGhpcy5heGxlV29ybGQgPSBvcHRpb25zLmF4bGVXb3JsZC5jbG9uZSgpOwogICAgICB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgdGhpcy5zdXNwZW5zaW9uTWF4TGVuZ3RoID0gb3B0aW9ucy5zdXNwZW5zaW9uTWF4TGVuZ3RoOwogICAgICB0aGlzLnJhZGl1cyA9IG9wdGlvbnMucmFkaXVzOwogICAgICB0aGlzLnN1c3BlbnNpb25TdGlmZm5lc3MgPSBvcHRpb25zLnN1c3BlbnNpb25TdGlmZm5lc3M7CiAgICAgIHRoaXMuZGFtcGluZ0NvbXByZXNzaW9uID0gb3B0aW9ucy5kYW1waW5nQ29tcHJlc3Npb247CiAgICAgIHRoaXMuZGFtcGluZ1JlbGF4YXRpb24gPSBvcHRpb25zLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICB0aGlzLmZyaWN0aW9uU2xpcCA9IG9wdGlvbnMuZnJpY3Rpb25TbGlwOwogICAgICB0aGlzLmZvcndhcmRBY2NlbGVyYXRpb24gPSBvcHRpb25zLmZvcndhcmRBY2NlbGVyYXRpb247CiAgICAgIHRoaXMuc2lkZUFjY2VsZXJhdGlvbiA9IG9wdGlvbnMuc2lkZUFjY2VsZXJhdGlvbjsKICAgICAgdGhpcy5zdGVlcmluZyA9IDA7CiAgICAgIHRoaXMucm90YXRpb24gPSAwOwogICAgICB0aGlzLmRlbHRhUm90YXRpb24gPSAwOwogICAgICB0aGlzLnJvbGxJbmZsdWVuY2UgPSBvcHRpb25zLnJvbGxJbmZsdWVuY2U7CiAgICAgIHRoaXMubWF4U3VzcGVuc2lvbkZvcmNlID0gb3B0aW9ucy5tYXhTdXNwZW5zaW9uRm9yY2U7CiAgICAgIHRoaXMuZW5naW5lRm9yY2UgPSAwOwogICAgICB0aGlzLmJyYWtlID0gMDsKICAgICAgdGhpcy5pc0Zyb250V2hlZWwgPSBvcHRpb25zLmlzRnJvbnRXaGVlbDsKICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxOwogICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgdGhpcy5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICB0aGlzLnNsaXBJbmZvID0gMDsKICAgICAgdGhpcy5za2lkSW5mbyA9IDA7CiAgICAgIHRoaXMuc3VzcGVuc2lvbkxlbmd0aCA9IDA7CiAgICAgIHRoaXMuc2lkZUltcHVsc2UgPSAwOwogICAgICB0aGlzLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgdGhpcy5yYXljYXN0UmVzdWx0ID0gbmV3IFJheWNhc3RSZXN1bHQoKTsKICAgICAgdGhpcy53b3JsZFRyYW5zZm9ybSA9IG5ldyBUcmFuc2Zvcm0oKTsKICAgICAgdGhpcy5pc0luQ29udGFjdCA9IGZhbHNlOwogICAgfQoKICAgIHVwZGF0ZVdoZWVsKGNoYXNzaXMpIHsKICAgICAgY29uc3QgcmF5Y2FzdFJlc3VsdCA9IHRoaXMucmF5Y2FzdFJlc3VsdDsKCiAgICAgIGlmICh0aGlzLmlzSW5Db250YWN0KSB7CiAgICAgICAgY29uc3QgcHJvamVjdCA9IHJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHJheWNhc3RSZXN1bHQuZGlyZWN0aW9uV29ybGQpOwogICAgICAgIHJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXMucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY2hhc3Npcy5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChyZWxwb3MsIGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKICAgICAgICBjb25zdCBwcm9qVmVsID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZC5kb3QoY2hhc3Npc192ZWxvY2l0eV9hdF9jb250YWN0UG9pbnQpOwoKICAgICAgICBpZiAocHJvamVjdCA+PSAtMC4xKSB7CiAgICAgICAgICB0aGlzLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjAgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gcHJvamVjdDsKICAgICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSBwcm9qVmVsICogaW52OwogICAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vIE5vdCBpbiBjb250YWN0IDogcG9zaXRpb24gd2hlZWwgaW4gYSBuaWNlIChyZXN0IGxlbmd0aCkgcG9zaXRpb24KICAgICAgICByYXljYXN0UmVzdWx0LnN1c3BlbnNpb25MZW5ndGggPSB0aGlzLnN1c3BlbnNpb25SZXN0TGVuZ3RoOwogICAgICAgIHRoaXMuc3VzcGVuc2lvblJlbGF0aXZlVmVsb2NpdHkgPSAwLjA7CiAgICAgICAgcmF5Y2FzdFJlc3VsdC5kaXJlY3Rpb25Xb3JsZC5zY2FsZSgtMSwgcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZCk7CiAgICAgICAgdGhpcy5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KICAgIH0KCiAgfQogIGNvbnN0IGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50ID0gbmV3IFZlYzMoKTsKICBjb25zdCByZWxwb3MgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBWZWhpY2xlIGhlbHBlciBjbGFzcyB0aGF0IGNhc3RzIHJheXMgZnJvbSB0aGUgd2hlZWwgcG9zaXRpb25zIHRvd2FyZHMgdGhlIGdyb3VuZCBhbmQgYXBwbGllcyBmb3JjZXMuCiAgICovCiAgY2xhc3MgUmF5Y2FzdFZlaGljbGUgewogICAgLyoqIFRoZSBjYXIgY2hhc3NpcyBib2R5LiAqLwoKICAgIC8qKiBUaGUgd2hlZWxzLiAqLwoKICAgIC8qKiBXaWxsIGJlIHNldCB0byB0cnVlIGlmIHRoZSBjYXIgaXMgc2xpZGluZy4gKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIHJpZ2h0IGF4aXMuIHg9MCwgeT0xLCB6PTIgKi8KCiAgICAvKiogSW5kZXggb2YgdGhlIGZvcndhcmQgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBJbmRleCBvZiB0aGUgdXAgYXhpcy4geD0wLCB5PTEsIHo9MiAqLwoKICAgIC8qKiBUaGUgY29uc3RyYWludHMuICovCgogICAgLyoqIE9wdGlvbmFsIHByZS1zdGVwIGNhbGxiYWNrLiAqLwoKICAgIC8qKiBOdW1iZXIgb2Ygd2hlZWxzIG9uIHRoZSBncm91bmQuICovCiAgICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7CiAgICAgIHRoaXMuY2hhc3Npc0JvZHkgPSBvcHRpb25zLmNoYXNzaXNCb2R5OwogICAgICB0aGlzLndoZWVsSW5mb3MgPSBbXTsKICAgICAgdGhpcy5zbGlkaW5nID0gZmFsc2U7CiAgICAgIHRoaXMud29ybGQgPSBudWxsOwogICAgICB0aGlzLmluZGV4UmlnaHRBeGlzID0gdHlwZW9mIG9wdGlvbnMuaW5kZXhSaWdodEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleFJpZ2h0QXhpcyA6IDI7CiAgICAgIHRoaXMuaW5kZXhGb3J3YXJkQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4Rm9yd2FyZEF4aXMgIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5pbmRleEZvcndhcmRBeGlzIDogMDsKICAgICAgdGhpcy5pbmRleFVwQXhpcyA9IHR5cGVvZiBvcHRpb25zLmluZGV4VXBBeGlzICE9PSAndW5kZWZpbmVkJyA/IG9wdGlvbnMuaW5kZXhVcEF4aXMgOiAxOwogICAgICB0aGlzLmNvbnN0cmFpbnRzID0gW107CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHt9OwoKICAgICAgdGhpcy5jdXJyZW50VmVoaWNsZVNwZWVkS21Ib3VyID0gMDsKICAgICAgdGhpcy5udW1XaGVlbHNPbkdyb3VuZCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIEFkZCBhIHdoZWVsLiBGb3IgaW5mb3JtYXRpb24gYWJvdXQgdGhlIG9wdGlvbnMsIHNlZSBgV2hlZWxJbmZvYC4KICAgICAqLwoKCiAgICBhZGRXaGVlbChvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIGNvbnN0IGluZm8gPSBuZXcgV2hlZWxJbmZvKG9wdGlvbnMpOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMud2hlZWxJbmZvcy5sZW5ndGg7CiAgICAgIHRoaXMud2hlZWxJbmZvcy5wdXNoKGluZm8pOwogICAgICByZXR1cm4gaW5kZXg7CiAgICB9CiAgICAvKioKICAgICAqIFNldCB0aGUgc3RlZXJpbmcgdmFsdWUgb2YgYSB3aGVlbC4KICAgICAqLwoKCiAgICBzZXRTdGVlcmluZ1ZhbHVlKHZhbHVlLCB3aGVlbEluZGV4KSB7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB3aGVlbC5zdGVlcmluZyA9IHZhbHVlOwogICAgfQogICAgLyoqCiAgICAgKiBTZXQgdGhlIHdoZWVsIGZvcmNlIHRvIGFwcGx5IG9uIG9uZSBvZiB0aGUgd2hlZWxzIGVhY2ggdGltZSBzdGVwCiAgICAgKi8KCgogICAgYXBwbHlFbmdpbmVGb3JjZSh2YWx1ZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uZW5naW5lRm9yY2UgPSB2YWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBicmFraW5nIGZvcmNlIG9mIGEgd2hlZWwKICAgICAqLwoKCiAgICBzZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCkgewogICAgICB0aGlzLndoZWVsSW5mb3Nbd2hlZWxJbmRleF0uYnJha2UgPSBicmFrZTsKICAgIH0KICAgIC8qKgogICAgICogQWRkIHRoZSB2ZWhpY2xlIGluY2x1ZGluZyBpdHMgY29uc3RyYWludHMgdG8gdGhlIHdvcmxkLgogICAgICovCgoKICAgIGFkZFRvV29ybGQod29ybGQpIHsKICAgICAgd29ybGQuYWRkQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgY29uc3QgdGhhdCA9IHRoaXM7CgogICAgICB0aGlzLnByZVN0ZXBDYWxsYmFjayA9ICgpID0+IHsKICAgICAgICB0aGF0LnVwZGF0ZVZlaGljbGUod29ybGQuZHQpOwogICAgICB9OwoKICAgICAgd29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IHdvcmxkOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgb25lIG9mIHRoZSB3aGVlbCBheGxlcywgd29ybGQtb3JpZW50ZWQuCiAgICAgKi8KCgogICAgZ2V0VmVoaWNsZUF4aXNXb3JsZChheGlzSW5kZXgsIHJlc3VsdCkgewogICAgICByZXN1bHQuc2V0KGF4aXNJbmRleCA9PT0gMCA/IDEgOiAwLCBheGlzSW5kZXggPT09IDEgPyAxIDogMCwgYXhpc0luZGV4ID09PSAyID8gMSA6IDApOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnZlY3RvclRvV29ybGRGcmFtZShyZXN1bHQsIHJlc3VsdCk7CiAgICB9CgogICAgdXBkYXRlVmVoaWNsZSh0aW1lU3RlcCkgewogICAgICBjb25zdCB3aGVlbEluZm9zID0gdGhpcy53aGVlbEluZm9zOwogICAgICBjb25zdCBudW1XaGVlbHMgPSB3aGVlbEluZm9zLmxlbmd0aDsKICAgICAgY29uc3QgY2hhc3Npc0JvZHkgPSB0aGlzLmNoYXNzaXNCb2R5OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm0oaSk7CiAgICAgIH0KCiAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciA9IDMuNiAqIGNoYXNzaXNCb2R5LnZlbG9jaXR5Lmxlbmd0aCgpOwogICAgICBjb25zdCBmb3J3YXJkV29ybGQgPSBuZXcgVmVjMygpOwogICAgICB0aGlzLmdldFZlaGljbGVBeGlzV29ybGQodGhpcy5pbmRleEZvcndhcmRBeGlzLCBmb3J3YXJkV29ybGQpOwoKICAgICAgaWYgKGZvcndhcmRXb3JsZC5kb3QoY2hhc3Npc0JvZHkudmVsb2NpdHkpIDwgMCkgewogICAgICAgIHRoaXMuY3VycmVudFZlaGljbGVTcGVlZEttSG91ciAqPSAtMTsKICAgICAgfSAvLyBzaW11bGF0ZSBzdXNwZW5zaW9uCgoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIHRoaXMuY2FzdFJheSh3aGVlbEluZm9zW2ldKTsKICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVTdXNwZW5zaW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaW1wdWxzZSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgLy9hcHBseSBzdXNwZW5zaW9uIGZvcmNlCiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOwogICAgICAgIGxldCBzdXNwZW5zaW9uRm9yY2UgPSB3aGVlbC5zdXNwZW5zaW9uRm9yY2U7CgogICAgICAgIGlmIChzdXNwZW5zaW9uRm9yY2UgPiB3aGVlbC5tYXhTdXNwZW5zaW9uRm9yY2UpIHsKICAgICAgICAgIHN1c3BlbnNpb25Gb3JjZSA9IHdoZWVsLm1heFN1c3BlbnNpb25Gb3JjZTsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUoc3VzcGVuc2lvbkZvcmNlICogdGltZVN0ZXAsIGltcHVsc2UpOwogICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGNoYXNzaXNCb2R5LnBvc2l0aW9uLCByZWxwb3MpOwogICAgICAgIGNoYXNzaXNCb2R5LmFwcGx5SW1wdWxzZShpbXB1bHNlLCByZWxwb3MpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUZyaWN0aW9uKHRpbWVTdGVwKTsKICAgICAgY29uc3QgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGZ3ZCA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IHZlbCA9IG5ldyBWZWMzKCk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG51bVdoZWVsczsgaSsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW2ldOyAvL2NvbnN0IHJlbHBvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgLy93aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQudnN1YihjaGFzc2lzQm9keS5wb3NpdGlvbiwgcmVscG9zKTsKCiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCB2ZWwpOyAvLyBIYWNrIHRvIGdldCB0aGUgcm90YXRpb24gaW4gdGhlIGNvcnJlY3QgZGlyZWN0aW9uCgogICAgICAgIGxldCBtID0gMTsKCiAgICAgICAgc3dpdGNoICh0aGlzLmluZGV4VXBBeGlzKSB7CiAgICAgICAgICBjYXNlIDE6CiAgICAgICAgICAgIG0gPSAtMTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIHRoaXMuZ2V0VmVoaWNsZUF4aXNXb3JsZCh0aGlzLmluZGV4Rm9yd2FyZEF4aXMsIGZ3ZCk7CiAgICAgICAgICBjb25zdCBwcm9qID0gZndkLmRvdCh3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuc2NhbGUocHJvaiwgaGl0Tm9ybWFsV29ybGRTY2FsZWRXaXRoUHJvaik7CiAgICAgICAgICBmd2QudnN1YihoaXROb3JtYWxXb3JsZFNjYWxlZFdpdGhQcm9qLCBmd2QpOwogICAgICAgICAgY29uc3QgcHJvajIgPSBmd2QuZG90KHZlbCk7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gbSAqIHByb2oyICogdGltZVN0ZXAgLyB3aGVlbC5yYWRpdXM7CiAgICAgICAgfQoKICAgICAgICBpZiAoKHdoZWVsLnNsaWRpbmcgfHwgIXdoZWVsLmlzSW5Db250YWN0KSAmJiB3aGVlbC5lbmdpbmVGb3JjZSAhPT0gMCAmJiB3aGVlbC51c2VDdXN0b21TbGlkaW5nUm90YXRpb25hbFNwZWVkKSB7CiAgICAgICAgICAvLyBBcHBseSBjdXN0b20gcm90YXRpb24gd2hlbiBhY2NlbGVyYXRpbmcgYW5kIHNsaWRpbmcKICAgICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gPSAod2hlZWwuZW5naW5lRm9yY2UgPiAwID8gMSA6IC0xKSAqIHdoZWVsLmN1c3RvbVNsaWRpbmdSb3RhdGlvbmFsU3BlZWQgKiB0aW1lU3RlcDsKICAgICAgICB9IC8vIExvY2sgd2hlZWxzCgoKICAgICAgICBpZiAoTWF0aC5hYnMod2hlZWwuYnJha2UpID4gTWF0aC5hYnMod2hlZWwuZW5naW5lRm9yY2UpKSB7CiAgICAgICAgICB3aGVlbC5kZWx0YVJvdGF0aW9uID0gMDsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnJvdGF0aW9uICs9IHdoZWVsLmRlbHRhUm90YXRpb247IC8vIFVzZSB0aGUgb2xkIHZhbHVlCgogICAgICAgIHdoZWVsLmRlbHRhUm90YXRpb24gKj0gMC45OTsgLy8gZGFtcGluZyBvZiByb3RhdGlvbiB3aGVuIG5vdCBpbiBjb250YWN0CiAgICAgIH0KICAgIH0KCiAgICB1cGRhdGVTdXNwZW5zaW9uKGRlbHRhVGltZSkgewogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGNoYXNzaXNNYXNzID0gY2hhc3Npc0JvZHkubWFzczsKICAgICAgY29uc3Qgd2hlZWxJbmZvcyA9IHRoaXMud2hlZWxJbmZvczsKICAgICAgY29uc3QgbnVtV2hlZWxzID0gd2hlZWxJbmZvcy5sZW5ndGg7CgogICAgICBmb3IgKGxldCB3X2l0ID0gMDsgd19pdCA8IG51bVdoZWVsczsgd19pdCsrKSB7CiAgICAgICAgY29uc3Qgd2hlZWwgPSB3aGVlbEluZm9zW3dfaXRdOwoKICAgICAgICBpZiAod2hlZWwuaXNJbkNvbnRhY3QpIHsKICAgICAgICAgIGxldCBmb3JjZTsgLy8gU3ByaW5nCgogICAgICAgICAgY29uc3Qgc3VzcF9sZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aDsKICAgICAgICAgIGNvbnN0IGN1cnJlbnRfbGVuZ3RoID0gd2hlZWwuc3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICAgIGNvbnN0IGxlbmd0aF9kaWZmID0gc3VzcF9sZW5ndGggLSBjdXJyZW50X2xlbmd0aDsKICAgICAgICAgIGZvcmNlID0gd2hlZWwuc3VzcGVuc2lvblN0aWZmbmVzcyAqIGxlbmd0aF9kaWZmICogd2hlZWwuY2xpcHBlZEludkNvbnRhY3REb3RTdXNwZW5zaW9uOyAvLyBEYW1wZXIKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWRfcmVsX3ZlbCA9IHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5OwogICAgICAgICAgbGV0IHN1c3BfZGFtcGluZzsKCiAgICAgICAgICBpZiAocHJvamVjdGVkX3JlbF92ZWwgPCAwKSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdDb21wcmVzc2lvbjsKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHN1c3BfZGFtcGluZyA9IHdoZWVsLmRhbXBpbmdSZWxheGF0aW9uOwogICAgICAgICAgfQoKICAgICAgICAgIGZvcmNlIC09IHN1c3BfZGFtcGluZyAqIHByb2plY3RlZF9yZWxfdmVsOwogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkZvcmNlID0gZm9yY2UgKiBjaGFzc2lzTWFzczsKCiAgICAgICAgICBpZiAod2hlZWwuc3VzcGVuc2lvbkZvcmNlIDwgMCkgewogICAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uRm9yY2UgPSAwOwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgdGhlIHZlaGljbGUgaW5jbHVkaW5nIGl0cyBjb25zdHJhaW50cyBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwoKCiAgICByZW1vdmVGcm9tV29ybGQod29ybGQpIHsKICAgICAgdGhpcy5jb25zdHJhaW50czsKICAgICAgd29ybGQucmVtb3ZlQm9keSh0aGlzLmNoYXNzaXNCb2R5KTsKICAgICAgd29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHRoaXMucHJlU3RlcENhbGxiYWNrKTsKICAgICAgdGhpcy53b3JsZCA9IG51bGw7CiAgICB9CgogICAgY2FzdFJheSh3aGVlbCkgewogICAgICBjb25zdCByYXl2ZWN0b3IgPSBjYXN0UmF5X3JheXZlY3RvcjsKICAgICAgY29uc3QgdGFyZ2V0ID0gY2FzdFJheV90YXJnZXQ7CiAgICAgIHRoaXMudXBkYXRlV2hlZWxUcmFuc2Zvcm1Xb3JsZCh3aGVlbCk7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgbGV0IGRlcHRoID0gLTE7CiAgICAgIGNvbnN0IHJheWxlbiA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwucmFkaXVzOwogICAgICB3aGVlbC5kaXJlY3Rpb25Xb3JsZC5zY2FsZShyYXlsZW4sIHJheXZlY3Rvcik7CiAgICAgIGNvbnN0IHNvdXJjZSA9IHdoZWVsLmNoYXNzaXNDb25uZWN0aW9uUG9pbnRXb3JsZDsKICAgICAgc291cmNlLnZhZGQocmF5dmVjdG9yLCB0YXJnZXQpOwogICAgICBjb25zdCByYXljYXN0UmVzdWx0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdDsKICAgICAgcmF5Y2FzdFJlc3VsdC5yZXNldCgpOyAvLyBUdXJuIG9mZiByYXkgY29sbGlzaW9uIHdpdGggdGhlIGNoYXNzaXMgdGVtcG9yYXJpbHkKCiAgICAgIGNvbnN0IG9sZFN0YXRlID0gY2hhc3Npc0JvZHkuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gZmFsc2U7IC8vIENhc3QgcmF5IGFnYWluc3Qgd29ybGQKCiAgICAgIHRoaXMud29ybGQucmF5VGVzdChzb3VyY2UsIHRhcmdldCwgcmF5Y2FzdFJlc3VsdCk7CiAgICAgIGNoYXNzaXNCb2R5LmNvbGxpc2lvblJlc3BvbnNlID0gb2xkU3RhdGU7CiAgICAgIGNvbnN0IG9iamVjdCA9IHJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5ncm91bmRPYmplY3QgPSAwOwoKICAgICAgaWYgKG9iamVjdCkgewogICAgICAgIGRlcHRoID0gcmF5Y2FzdFJlc3VsdC5kaXN0YW5jZTsKICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkID0gcmF5Y2FzdFJlc3VsdC5oaXROb3JtYWxXb3JsZDsKICAgICAgICB3aGVlbC5pc0luQ29udGFjdCA9IHRydWU7CiAgICAgICAgY29uc3QgaGl0RGlzdGFuY2UgPSByYXljYXN0UmVzdWx0LmRpc3RhbmNlOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSBoaXREaXN0YW5jZSAtIHdoZWVsLnJhZGl1czsgLy8gY2xhbXAgb24gbWF4IHN1c3BlbnNpb24gdHJhdmVsCgogICAgICAgIGNvbnN0IG1pblN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCAtIHdoZWVsLm1heFN1c3BlbnNpb25UcmF2ZWw7CiAgICAgICAgY29uc3QgbWF4U3VzcGVuc2lvbkxlbmd0aCA9IHdoZWVsLnN1c3BlbnNpb25SZXN0TGVuZ3RoICsgd2hlZWwubWF4U3VzcGVuc2lvblRyYXZlbDsKCiAgICAgICAgaWYgKHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPCBtaW5TdXNwZW5zaW9uTGVuZ3RoKSB7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID0gbWluU3VzcGVuc2lvbkxlbmd0aDsKICAgICAgICB9CgogICAgICAgIGlmICh3aGVlbC5zdXNwZW5zaW9uTGVuZ3RoID4gbWF4U3VzcGVuc2lvbkxlbmd0aCkgewogICAgICAgICAgd2hlZWwuc3VzcGVuc2lvbkxlbmd0aCA9IG1heFN1c3BlbnNpb25MZW5ndGg7CiAgICAgICAgICB3aGVlbC5yYXljYXN0UmVzdWx0LnJlc2V0KCk7CiAgICAgICAgfQoKICAgICAgICBjb25zdCBkZW5vbWluYXRvciA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgICBjb25zdCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCA9IG5ldyBWZWMzKCk7CiAgICAgICAgY2hhc3Npc0JvZHkuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBjaGFzc2lzX3ZlbG9jaXR5X2F0X2NvbnRhY3RQb2ludCk7CiAgICAgICAgY29uc3QgcHJvalZlbCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQuZG90KGNoYXNzaXNfdmVsb2NpdHlfYXRfY29udGFjdFBvaW50KTsKCiAgICAgICAgaWYgKGRlbm9taW5hdG9yID49IC0wLjEpIHsKICAgICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMDsKICAgICAgICAgIHdoZWVsLmNsaXBwZWRJbnZDb250YWN0RG90U3VzcGVuc2lvbiA9IDEgLyAwLjE7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbnN0IGludiA9IC0xIC8gZGVub21pbmF0b3I7CiAgICAgICAgICB3aGVlbC5zdXNwZW5zaW9uUmVsYXRpdmVWZWxvY2l0eSA9IHByb2pWZWwgKiBpbnY7CiAgICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSBpbnY7CiAgICAgICAgfQogICAgICB9IGVsc2UgewogICAgICAgIC8vcHV0IHdoZWVsIGluZm8gYXMgaW4gcmVzdCBwb3NpdGlvbgogICAgICAgIHdoZWVsLnN1c3BlbnNpb25MZW5ndGggPSB3aGVlbC5zdXNwZW5zaW9uUmVzdExlbmd0aCArIDAgKiB3aGVlbC5tYXhTdXNwZW5zaW9uVHJhdmVsOwogICAgICAgIHdoZWVsLnN1c3BlbnNpb25SZWxhdGl2ZVZlbG9jaXR5ID0gMC4wOwogICAgICAgIHdoZWVsLmRpcmVjdGlvbldvcmxkLnNjYWxlKC0xLCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdE5vcm1hbFdvcmxkKTsKICAgICAgICB3aGVlbC5jbGlwcGVkSW52Q29udGFjdERvdFN1c3BlbnNpb24gPSAxLjA7CiAgICAgIH0KCiAgICAgIHJldHVybiBkZXB0aDsKICAgIH0KCiAgICB1cGRhdGVXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsKSB7CiAgICAgIHdoZWVsLmlzSW5Db250YWN0ID0gZmFsc2U7CiAgICAgIGNvbnN0IGNoYXNzaXNCb2R5ID0gdGhpcy5jaGFzc2lzQm9keTsKICAgICAgY2hhc3Npc0JvZHkucG9pbnRUb1dvcmxkRnJhbWUod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsLCB3aGVlbC5jaGFzc2lzQ29ubmVjdGlvblBvaW50V29ybGQpOwogICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUod2hlZWwuZGlyZWN0aW9uTG9jYWwsIHdoZWVsLmRpcmVjdGlvbldvcmxkKTsKICAgICAgY2hhc3Npc0JvZHkudmVjdG9yVG9Xb3JsZEZyYW1lKHdoZWVsLmF4bGVMb2NhbCwgd2hlZWwuYXhsZVdvcmxkKTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIG9uZSBvZiB0aGUgd2hlZWwgdHJhbnNmb3JtLgogICAgICogTm90ZSB3aGVuIHJlbmRlcmluZyB3aGVlbHM6IGR1cmluZyBlYWNoIHN0ZXAsIHdoZWVsIHRyYW5zZm9ybXMgYXJlIHVwZGF0ZWQgQkVGT1JFIHRoZSBjaGFzc2lzOyBpZS4gdGhlaXIgcG9zaXRpb24gYmVjb21lcyBpbnZhbGlkIGFmdGVyIHRoZSBzdGVwLiBUaHVzIHdoZW4geW91IHJlbmRlciB3aGVlbHMsIHlvdSBtdXN0IHVwZGF0ZSB3aGVlbCB0cmFuc2Zvcm1zIGJlZm9yZSByZW5kZXJpbmcgdGhlbS4gU2VlIHJheWNhc3RWZWhpY2xlIGRlbW8gZm9yIGFuIGV4YW1wbGUuCiAgICAgKiBAcGFyYW0gd2hlZWxJbmRleCBUaGUgd2hlZWwgaW5kZXggdG8gdXBkYXRlLgogICAgICovCgoKICAgIHVwZGF0ZVdoZWVsVHJhbnNmb3JtKHdoZWVsSW5kZXgpIHsKICAgICAgY29uc3QgdXAgPSB0bXBWZWM0OwogICAgICBjb25zdCByaWdodCA9IHRtcFZlYzU7CiAgICAgIGNvbnN0IGZ3ZCA9IHRtcFZlYzY7CiAgICAgIGNvbnN0IHdoZWVsID0gdGhpcy53aGVlbEluZm9zW3doZWVsSW5kZXhdOwogICAgICB0aGlzLnVwZGF0ZVdoZWVsVHJhbnNmb3JtV29ybGQod2hlZWwpOwogICAgICB3aGVlbC5kaXJlY3Rpb25Mb2NhbC5zY2FsZSgtMSwgdXApOwogICAgICByaWdodC5jb3B5KHdoZWVsLmF4bGVMb2NhbCk7CiAgICAgIHVwLmNyb3NzKHJpZ2h0LCBmd2QpOwogICAgICBmd2Qubm9ybWFsaXplKCk7CiAgICAgIHJpZ2h0Lm5vcm1hbGl6ZSgpOyAvLyBSb3RhdGUgYXJvdW5kIHN0ZWVyaW5nIG92ZXIgdGhlIHdoZWVsQXhsZQoKICAgICAgY29uc3Qgc3RlZXJpbmcgPSB3aGVlbC5zdGVlcmluZzsKICAgICAgY29uc3Qgc3RlZXJpbmdPcm4gPSBuZXcgUXVhdGVybmlvbigpOwogICAgICBzdGVlcmluZ09ybi5zZXRGcm9tQXhpc0FuZ2xlKHVwLCBzdGVlcmluZyk7CiAgICAgIGNvbnN0IHJvdGF0aW5nT3JuID0gbmV3IFF1YXRlcm5pb24oKTsKICAgICAgcm90YXRpbmdPcm4uc2V0RnJvbUF4aXNBbmdsZShyaWdodCwgd2hlZWwucm90YXRpb24pOyAvLyBXb3JsZCByb3RhdGlvbiBvZiB0aGUgd2hlZWwKCiAgICAgIGNvbnN0IHEgPSB3aGVlbC53b3JsZFRyYW5zZm9ybS5xdWF0ZXJuaW9uOwogICAgICB0aGlzLmNoYXNzaXNCb2R5LnF1YXRlcm5pb24ubXVsdChzdGVlcmluZ09ybiwgcSk7CiAgICAgIHEubXVsdChyb3RhdGluZ09ybiwgcSk7CiAgICAgIHEubm9ybWFsaXplKCk7IC8vIHdvcmxkIHBvc2l0aW9uIG9mIHRoZSB3aGVlbAoKICAgICAgY29uc3QgcCA9IHdoZWVsLndvcmxkVHJhbnNmb3JtLnBvc2l0aW9uOwogICAgICBwLmNvcHkod2hlZWwuZGlyZWN0aW9uV29ybGQpOwogICAgICBwLnNjYWxlKHdoZWVsLnN1c3BlbnNpb25MZW5ndGgsIHApOwogICAgICBwLnZhZGQod2hlZWwuY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludFdvcmxkLCBwKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSB3b3JsZCB0cmFuc2Zvcm0gb2Ygb25lIG9mIHRoZSB3aGVlbHMKICAgICAqLwoKCiAgICBnZXRXaGVlbFRyYW5zZm9ybVdvcmxkKHdoZWVsSW5kZXgpIHsKICAgICAgcmV0dXJuIHRoaXMud2hlZWxJbmZvc1t3aGVlbEluZGV4XS53b3JsZFRyYW5zZm9ybTsKICAgIH0KCiAgICB1cGRhdGVGcmljdGlvbih0aW1lU3RlcCkgewogICAgICBjb25zdCBzdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2o7IC8vY2FsY3VsYXRlIHRoZSBpbXB1bHNlLCBzbyB0aGF0IHRoZSB3aGVlbHMgZG9uJ3QgbW92ZSBzaWRld2FyZHMKCiAgICAgIGNvbnN0IHdoZWVsSW5mb3MgPSB0aGlzLndoZWVsSW5mb3M7CiAgICAgIGNvbnN0IG51bVdoZWVscyA9IHdoZWVsSW5mb3MubGVuZ3RoOwogICAgICBjb25zdCBjaGFzc2lzQm9keSA9IHRoaXMuY2hhc3Npc0JvZHk7CiAgICAgIGNvbnN0IGZvcndhcmRXUyA9IHVwZGF0ZUZyaWN0aW9uX2ZvcndhcmRXUzsKICAgICAgY29uc3QgYXhsZSA9IHVwZGF0ZUZyaWN0aW9uX2F4bGU7CiAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQgPSAwOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHRoaXMubnVtV2hlZWxzT25Hcm91bmQrKzsKICAgICAgICB9CgogICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5mb3J3YXJkSW1wdWxzZSA9IDA7CgogICAgICAgIGlmICghZm9yd2FyZFdTW2ldKSB7CiAgICAgICAgICBmb3J3YXJkV1NbaV0gPSBuZXcgVmVjMygpOwogICAgICAgIH0KCiAgICAgICAgaWYgKCFheGxlW2ldKSB7CiAgICAgICAgICBheGxlW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgZ3JvdW5kT2JqZWN0ID0gd2hlZWwucmF5Y2FzdFJlc3VsdC5ib2R5OwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBheGxlaSA9IGF4bGVbaV07CiAgICAgICAgICBjb25zdCB3aGVlbFRyYW5zID0gdGhpcy5nZXRXaGVlbFRyYW5zZm9ybVdvcmxkKGkpOyAvLyBHZXQgd29ybGQgYXhsZQoKICAgICAgICAgIHdoZWVsVHJhbnMudmVjdG9yVG9Xb3JsZEZyYW1lKGRpcmVjdGlvbnNbdGhpcy5pbmRleFJpZ2h0QXhpc10sIGF4bGVpKTsKICAgICAgICAgIGNvbnN0IHN1cmZOb3JtYWxXUyA9IHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0Tm9ybWFsV29ybGQ7CiAgICAgICAgICBjb25zdCBwcm9qID0gYXhsZWkuZG90KHN1cmZOb3JtYWxXUyk7CiAgICAgICAgICBzdXJmTm9ybWFsV1Muc2NhbGUocHJvaiwgc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qKTsKICAgICAgICAgIGF4bGVpLnZzdWIoc3VyZk5vcm1hbFdTX3NjYWxlZF9wcm9qLCBheGxlaSk7CiAgICAgICAgICBheGxlaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHN1cmZOb3JtYWxXUy5jcm9zcyhheGxlaSwgZm9yd2FyZFdTW2ldKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5ub3JtYWxpemUoKTsKICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlID0gcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbChjaGFzc2lzQm9keSwgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLCBncm91bmRPYmplY3QsIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZCwgYXhsZWkpOwogICAgICAgICAgd2hlZWwuc2lkZUltcHVsc2UgKj0gc2lkZUZyaWN0aW9uU3RpZmZuZXNzMjsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IHNpZGVGYWN0b3IgPSAxOwogICAgICBjb25zdCBmd2RGYWN0b3IgPSAwLjU7CiAgICAgIHRoaXMuc2xpZGluZyA9IGZhbHNlOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1XaGVlbHM7IGkrKykgewogICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKICAgICAgICBjb25zdCBncm91bmRPYmplY3QgPSB3aGVlbC5yYXljYXN0UmVzdWx0LmJvZHk7CiAgICAgICAgbGV0IHJvbGxpbmdGcmljdGlvbiA9IDA7CiAgICAgICAgd2hlZWwuc2xpcEluZm8gPSAxOwoKICAgICAgICBpZiAoZ3JvdW5kT2JqZWN0KSB7CiAgICAgICAgICBjb25zdCBkZWZhdWx0Um9sbGluZ0ZyaWN0aW9uSW1wdWxzZSA9IDA7CiAgICAgICAgICBjb25zdCBtYXhJbXB1bHNlID0gd2hlZWwuYnJha2UgPyB3aGVlbC5icmFrZSA6IGRlZmF1bHRSb2xsaW5nRnJpY3Rpb25JbXB1bHNlOyAvLyBidFdoZWVsQ29udGFjdFBvaW50IGNvbnRhY3RQdChjaGFzc2lzQm9keSxncm91bmRPYmplY3Qsd2hlZWxJbmZyYXljYXN0SW5mby5oaXRQb2ludFdvcmxkLGZvcndhcmRXU1t3aGVlbF0sbWF4SW1wdWxzZSk7CiAgICAgICAgICAvLyByb2xsaW5nRnJpY3Rpb24gPSBjYWxjUm9sbGluZ0ZyaWN0aW9uKGNvbnRhY3RQdCk7CgogICAgICAgICAgcm9sbGluZ0ZyaWN0aW9uID0gY2FsY1JvbGxpbmdGcmljdGlvbihjaGFzc2lzQm9keSwgZ3JvdW5kT2JqZWN0LCB3aGVlbC5yYXljYXN0UmVzdWx0LmhpdFBvaW50V29ybGQsIGZvcndhcmRXU1tpXSwgbWF4SW1wdWxzZSk7CiAgICAgICAgICByb2xsaW5nRnJpY3Rpb24gKz0gd2hlZWwuZW5naW5lRm9yY2UgKiB0aW1lU3RlcDsgLy8gcm9sbGluZ0ZyaWN0aW9uID0gMDsKCiAgICAgICAgICBjb25zdCBmYWN0b3IgPSBtYXhJbXB1bHNlIC8gcm9sbGluZ0ZyaWN0aW9uOwogICAgICAgICAgd2hlZWwuc2xpcEluZm8gKj0gZmFjdG9yOwogICAgICAgIH0gLy9zd2l0Y2ggYmV0d2VlbiBhY3RpdmUgcm9sbGluZyAodGhyb3R0bGUpLCBicmFraW5nIGFuZCBub24tYWN0aXZlIHJvbGxpbmcgZnJpY3Rpb24gKG50aHJvdHRsZS9icmVhaykKCgogICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlID0gMDsKICAgICAgICB3aGVlbC5za2lkSW5mbyA9IDE7CgogICAgICAgIGlmIChncm91bmRPYmplY3QpIHsKICAgICAgICAgIHdoZWVsLnNraWRJbmZvID0gMTsKICAgICAgICAgIGNvbnN0IG1heGltcCA9IHdoZWVsLnN1c3BlbnNpb25Gb3JjZSAqIHRpbWVTdGVwICogd2hlZWwuZnJpY3Rpb25TbGlwOwogICAgICAgICAgY29uc3QgbWF4aW1wU2lkZSA9IG1heGltcDsKICAgICAgICAgIGNvbnN0IG1heGltcFNxdWFyZWQgPSBtYXhpbXAgKiBtYXhpbXBTaWRlOwogICAgICAgICAgd2hlZWwuZm9yd2FyZEltcHVsc2UgPSByb2xsaW5nRnJpY3Rpb247IC8vd2hlZWxJbmZvLmVuZ2luZUZvcmNlKiB0aW1lU3RlcDsKCiAgICAgICAgICBjb25zdCB4ID0gd2hlZWwuZm9yd2FyZEltcHVsc2UgKiBmd2RGYWN0b3IgLyB3aGVlbC5mb3J3YXJkQWNjZWxlcmF0aW9uOwogICAgICAgICAgY29uc3QgeSA9IHdoZWVsLnNpZGVJbXB1bHNlICogc2lkZUZhY3RvciAvIHdoZWVsLnNpZGVBY2NlbGVyYXRpb247CiAgICAgICAgICBjb25zdCBpbXB1bHNlU3F1YXJlZCA9IHggKiB4ICsgeSAqIHk7CiAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gZmFsc2U7CgogICAgICAgICAgaWYgKGltcHVsc2VTcXVhcmVkID4gbWF4aW1wU3F1YXJlZCkgewogICAgICAgICAgICB0aGlzLnNsaWRpbmcgPSB0cnVlOwogICAgICAgICAgICB3aGVlbC5zbGlkaW5nID0gdHJ1ZTsKICAgICAgICAgICAgY29uc3QgZmFjdG9yID0gbWF4aW1wIC8gTWF0aC5zcXJ0KGltcHVsc2VTcXVhcmVkKTsKICAgICAgICAgICAgd2hlZWwuc2tpZEluZm8gKj0gZmFjdG9yOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHRoaXMuc2xpZGluZykgewogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IHdoZWVsID0gd2hlZWxJbmZvc1tpXTsKCiAgICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgICAgaWYgKHdoZWVsLnNraWRJbmZvIDwgMSkgewogICAgICAgICAgICAgIHdoZWVsLmZvcndhcmRJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICAgIHdoZWVsLnNpZGVJbXB1bHNlICo9IHdoZWVsLnNraWRJbmZvOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIGFwcGx5IHRoZSBpbXB1bHNlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtV2hlZWxzOyBpKyspIHsKICAgICAgICBjb25zdCB3aGVlbCA9IHdoZWVsSW5mb3NbaV07CiAgICAgICAgY29uc3QgcmVsX3BvcyA9IG5ldyBWZWMzKCk7CiAgICAgICAgd2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkLnZzdWIoY2hhc3Npc0JvZHkucG9zaXRpb24sIHJlbF9wb3MpOyAvLyBjYW5ub25zIGFwcGx5aW1wdWxzZSBpcyB1c2luZyB3b3JsZCBjb29yZCBmb3IgdGhlIHBvc2l0aW9uCiAgICAgICAgLy9yZWxfcG9zLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgaWYgKHdoZWVsLmZvcndhcmRJbXB1bHNlICE9PSAwKSB7CiAgICAgICAgICBjb25zdCBpbXB1bHNlID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGZvcndhcmRXU1tpXS5zY2FsZSh3aGVlbC5mb3J3YXJkSW1wdWxzZSwgaW1wdWxzZSk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2UoaW1wdWxzZSwgcmVsX3Bvcyk7CiAgICAgICAgfQoKICAgICAgICBpZiAod2hlZWwuc2lkZUltcHVsc2UgIT09IDApIHsKICAgICAgICAgIGNvbnN0IGdyb3VuZE9iamVjdCA9IHdoZWVsLnJheWNhc3RSZXN1bHQuYm9keTsKICAgICAgICAgIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKICAgICAgICAgIHdoZWVsLnJheWNhc3RSZXN1bHQuaGl0UG9pbnRXb3JsZC52c3ViKGdyb3VuZE9iamVjdC5wb3NpdGlvbiwgcmVsX3BvczIpOyAvL3JlbF9wb3MyLmNvcHkod2hlZWwucmF5Y2FzdFJlc3VsdC5oaXRQb2ludFdvcmxkKTsKCiAgICAgICAgICBjb25zdCBzaWRlSW1wID0gbmV3IFZlYzMoKTsKICAgICAgICAgIGF4bGVbaV0uc2NhbGUod2hlZWwuc2lkZUltcHVsc2UsIHNpZGVJbXApOyAvLyBTY2FsZSB0aGUgcmVsYXRpdmUgcG9zaXRpb24gaW4gdGhlIHVwIGRpcmVjdGlvbiB3aXRoIHJvbGxJbmZsdWVuY2UuCiAgICAgICAgICAvLyBJZiByb2xsSW5mbHVlbmNlIGlzIDEsIHRoZSBpbXB1bHNlIHdpbGwgYmUgYXBwbGllZCBvbiB0aGUgaGl0UG9pbnQgKGVhc3kgdG8gcm9sbCBvdmVyKSwgaWYgaXQgaXMgemVybyBpdCB3aWxsIGJlIGFwcGxpZWQgaW4gdGhlIHNhbWUgcGxhbmUgYXMgdGhlIGNlbnRlciBvZiBtYXNzIChub3QgZWFzeSB0byByb2xsIG92ZXIpLgoKICAgICAgICAgIGNoYXNzaXNCb2R5LnZlY3RvclRvTG9jYWxGcmFtZShyZWxfcG9zLCByZWxfcG9zKTsKICAgICAgICAgIHJlbF9wb3NbJ3h5eidbdGhpcy5pbmRleFVwQXhpc11dICo9IHdoZWVsLnJvbGxJbmZsdWVuY2U7CiAgICAgICAgICBjaGFzc2lzQm9keS52ZWN0b3JUb1dvcmxkRnJhbWUocmVsX3BvcywgcmVsX3Bvcyk7CiAgICAgICAgICBjaGFzc2lzQm9keS5hcHBseUltcHVsc2Uoc2lkZUltcCwgcmVsX3Bvcyk7IC8vYXBwbHkgZnJpY3Rpb24gaW1wdWxzZSBvbiB0aGUgZ3JvdW5kCgogICAgICAgICAgc2lkZUltcC5zY2FsZSgtMSwgc2lkZUltcCk7CiAgICAgICAgICBncm91bmRPYmplY3QuYXBwbHlJbXB1bHNlKHNpZGVJbXAsIHJlbF9wb3MyKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcFZlYzYgPSBuZXcgVmVjMygpOwogIG5ldyBSYXkoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IGNhc3RSYXlfcmF5dmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBjYXN0UmF5X3RhcmdldCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZGlyZWN0aW9ucyA9IFtuZXcgVmVjMygxLCAwLCAwKSwgbmV3IFZlYzMoMCwgMSwgMCksIG5ldyBWZWMzKDAsIDAsIDEpXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9zdXJmTm9ybWFsV1Nfc2NhbGVkX3Byb2ogPSBuZXcgVmVjMygpOwogIGNvbnN0IHVwZGF0ZUZyaWN0aW9uX2F4bGUgPSBbXTsKICBjb25zdCB1cGRhdGVGcmljdGlvbl9mb3J3YXJkV1MgPSBbXTsKICBjb25zdCBzaWRlRnJpY3Rpb25TdGlmZm5lc3MyID0gMTsKICBjb25zdCBjYWxjUm9sbGluZ0ZyaWN0aW9uX3ZlbDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBjYWxjUm9sbGluZ0ZyaWN0aW9uKGJvZHkwLCBib2R5MSwgZnJpY3Rpb25Qb3NXb3JsZCwgZnJpY3Rpb25EaXJlY3Rpb25Xb3JsZCwgbWF4SW1wdWxzZSkgewogICAgbGV0IGoxID0gMDsKICAgIGNvbnN0IGNvbnRhY3RQb3NXb3JsZCA9IGZyaWN0aW9uUG9zV29ybGQ7IC8vIGNvbnN0IHJlbF9wb3MxID0gbmV3IFZlYzMoKTsKICAgIC8vIGNvbnN0IHJlbF9wb3MyID0gbmV3IFZlYzMoKTsKCiAgICBjb25zdCB2ZWwxID0gY2FsY1JvbGxpbmdGcmljdGlvbl92ZWwxOwogICAgY29uc3QgdmVsMiA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsMjsKICAgIGNvbnN0IHZlbCA9IGNhbGNSb2xsaW5nRnJpY3Rpb25fdmVsOyAvLyBjb250YWN0UG9zV29ybGQudnN1Yihib2R5MC5wb3NpdGlvbiwgcmVsX3BvczEpOwogICAgLy8gY29udGFjdFBvc1dvcmxkLnZzdWIoYm9keTEucG9zaXRpb24sIHJlbF9wb3MyKTsKCiAgICBib2R5MC5nZXRWZWxvY2l0eUF0V29ybGRQb2ludChjb250YWN0UG9zV29ybGQsIHZlbDEpOwogICAgYm9keTEuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQoY29udGFjdFBvc1dvcmxkLCB2ZWwyKTsKICAgIHZlbDEudnN1Yih2ZWwyLCB2ZWwpOwogICAgY29uc3QgdnJlbCA9IGZyaWN0aW9uRGlyZWN0aW9uV29ybGQuZG90KHZlbCk7CiAgICBjb25zdCBkZW5vbTAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yKGJvZHkwLCBmcmljdGlvblBvc1dvcmxkLCBmcmljdGlvbkRpcmVjdGlvbldvcmxkKTsKICAgIGNvbnN0IGRlbm9tMSA9IGNvbXB1dGVJbXB1bHNlRGVub21pbmF0b3IoYm9keTEsIGZyaWN0aW9uUG9zV29ybGQsIGZyaWN0aW9uRGlyZWN0aW9uV29ybGQpOwogICAgY29uc3QgcmVsYXhhdGlvbiA9IDE7CiAgICBjb25zdCBqYWNEaWFnQUJJbnYgPSByZWxheGF0aW9uIC8gKGRlbm9tMCArIGRlbm9tMSk7IC8vIGNhbGN1bGF0ZSBqIHRoYXQgbW92ZXMgdXMgdG8gemVybyByZWxhdGl2ZSB2ZWxvY2l0eQoKICAgIGoxID0gLXZyZWwgKiBqYWNEaWFnQUJJbnY7CgogICAgaWYgKG1heEltcHVsc2UgPCBqMSkgewogICAgICBqMSA9IG1heEltcHVsc2U7CiAgICB9CgogICAgaWYgKGoxIDwgLW1heEltcHVsc2UpIHsKICAgICAgajEgPSAtbWF4SW1wdWxzZTsKICAgIH0KCiAgICByZXR1cm4gajE7CiAgfQoKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3ZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tID0gbmV3IFZlYzMoKTsKCiAgZnVuY3Rpb24gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcihib2R5LCBwb3MsIG5vcm1hbCkgewogICAgY29uc3QgcjAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX3IwOwogICAgY29uc3QgYzAgPSBjb21wdXRlSW1wdWxzZURlbm9taW5hdG9yX2MwOwogICAgY29uc3QgdmVjID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl92ZWM7CiAgICBjb25zdCBtID0gY29tcHV0ZUltcHVsc2VEZW5vbWluYXRvcl9tOwogICAgcG9zLnZzdWIoYm9keS5wb3NpdGlvbiwgcjApOwogICAgcjAuY3Jvc3Mobm9ybWFsLCBjMCk7CiAgICBib2R5LmludkluZXJ0aWFXb3JsZC52bXVsdChjMCwgbSk7CiAgICBtLmNyb3NzKHIwLCB2ZWMpOwogICAgcmV0dXJuIGJvZHkuaW52TWFzcyArIG5vcm1hbC5kb3QodmVjKTsKICB9CgogIGNvbnN0IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcmVzb2x2ZVNpbmdsZUJpbGF0ZXJhbF92ZWwyID0gbmV3IFZlYzMoKTsKICBjb25zdCByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbCA9IG5ldyBWZWMzKCk7IC8vIGJpbGF0ZXJhbCBjb25zdHJhaW50IGJldHdlZW4gdHdvIGR5bmFtaWMgb2JqZWN0cwoKICBmdW5jdGlvbiByZXNvbHZlU2luZ2xlQmlsYXRlcmFsKGJvZHkxLCBwb3MxLCBib2R5MiwgcG9zMiwgbm9ybWFsKSB7CiAgICBjb25zdCBub3JtYWxMZW5TcXIgPSBub3JtYWwubGVuZ3RoU3F1YXJlZCgpOwoKICAgIGlmIChub3JtYWxMZW5TcXIgPiAxLjEpIHsKICAgICAgcmV0dXJuIDA7IC8vIG5vIGltcHVsc2UKICAgIH0gLy8gY29uc3QgcmVsX3BvczEgPSBuZXcgVmVjMygpOwogICAgLy8gY29uc3QgcmVsX3BvczIgPSBuZXcgVmVjMygpOwogICAgLy8gcG9zMS52c3ViKGJvZHkxLnBvc2l0aW9uLCByZWxfcG9zMSk7CiAgICAvLyBwb3MyLnZzdWIoYm9keTIucG9zaXRpb24sIHJlbF9wb3MyKTsKCgogICAgY29uc3QgdmVsMSA9IHJlc29sdmVTaW5nbGVCaWxhdGVyYWxfdmVsMTsKICAgIGNvbnN0IHZlbDIgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDI7CiAgICBjb25zdCB2ZWwgPSByZXNvbHZlU2luZ2xlQmlsYXRlcmFsX3ZlbDsKICAgIGJvZHkxLmdldFZlbG9jaXR5QXRXb3JsZFBvaW50KHBvczEsIHZlbDEpOwogICAgYm9keTIuZ2V0VmVsb2NpdHlBdFdvcmxkUG9pbnQocG9zMiwgdmVsMik7CiAgICB2ZWwxLnZzdWIodmVsMiwgdmVsKTsKICAgIGNvbnN0IHJlbF92ZWwgPSBub3JtYWwuZG90KHZlbCk7CiAgICBjb25zdCBjb250YWN0RGFtcGluZyA9IDAuMjsKICAgIGNvbnN0IG1hc3NUZXJtID0gMSAvIChib2R5MS5pbnZNYXNzICsgYm9keTIuaW52TWFzcyk7CiAgICBjb25zdCBpbXB1bHNlID0gLWNvbnRhY3REYW1waW5nICogcmVsX3ZlbCAqIG1hc3NUZXJtOwogICAgcmV0dXJuIGltcHVsc2U7CiAgfQoKICAvKioKICAgKiBTcGhlcmljYWwgc2hhcGUKICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCByYWRpdXMgPSAxCiAgICogICAgIGNvbnN0IHNwaGVyZVNoYXBlID0gbmV3IENBTk5PTi5TcGhlcmUocmFkaXVzKQogICAqICAgICBjb25zdCBzcGhlcmVCb2R5ID0gbmV3IENBTk5PTi5Cb2R5KHsgbWFzczogMSwgc2hhcGU6IHNwaGVyZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoc3BoZXJlQm9keSkKICAgKi8KICBjbGFzcyBTcGhlcmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIFRoZSByYWRpdXMgb2YgdGhlIHNwaGVyZS4KICAgICAqLwoKICAgIC8qKgogICAgICoKICAgICAqIEBwYXJhbSByYWRpdXMgVGhlIHJhZGl1cyBvZiB0aGUgc3BoZXJlLCBhIG5vbi1uZWdhdGl2ZSBudW1iZXIuCiAgICAgKi8KICAgIGNvbnN0cnVjdG9yKHJhZGl1cykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuU1BIRVJFCiAgICAgIH0pOwogICAgICB0aGlzLnJhZGl1cyA9IHJhZGl1cyAhPT0gdW5kZWZpbmVkID8gcmFkaXVzIDogMS4wOwoKICAgICAgaWYgKHRoaXMucmFkaXVzIDwgMCkgewogICAgICAgIHRocm93IG5ldyBFcnJvcignVGhlIHNwaGVyZSByYWRpdXMgY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICB0aGlzLnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICB9CiAgICAvKiogY2FsY3VsYXRlTG9jYWxJbmVydGlhICovCgoKICAgIGNhbGN1bGF0ZUxvY2FsSW5lcnRpYShtYXNzLCB0YXJnZXQpIHsKICAgICAgaWYgKHRhcmdldCA9PT0gdm9pZCAwKSB7CiAgICAgICAgdGFyZ2V0ID0gbmV3IFZlYzMoKTsKICAgICAgfQoKICAgICAgY29uc3QgSSA9IDIuMCAqIG1hc3MgKiB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzIC8gNS4wOwogICAgICB0YXJnZXQueCA9IEk7CiAgICAgIHRhcmdldC55ID0gSTsKICAgICAgdGFyZ2V0LnogPSBJOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQogICAgLyoqIHZvbHVtZSAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogTWF0aC5wb3codGhpcy5yYWRpdXMsIDMpIC8gMy4wOwogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gdGhpcy5yYWRpdXM7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgY29uc3QgciA9IHRoaXMucmFkaXVzOwogICAgICBjb25zdCBheGVzID0gWyd4JywgJ3knLCAneiddOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBheGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3QgYXggPSBheGVzW2ldOwogICAgICAgIG1pbltheF0gPSBwb3NbYXhdIC0gcjsKICAgICAgICBtYXhbYXhdID0gcG9zW2F4XSArIHI7CiAgICAgIH0KICAgIH0KCiAgfQogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOyAvLyBUZW1wIHZlY3RvcnMgZm9yIGNhbGN1bGF0aW9uCgogIG5ldyBWZWMzKCk7IC8vIFJlbGF0aXZlIHZlbG9jaXR5CgogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKCiAgLyoqCiAgICogQ3lsaW5kZXIgY2xhc3MuCiAgICogQGV4YW1wbGUKICAgKiAgICAgY29uc3QgcmFkaXVzVG9wID0gMC41CiAgICogICAgIGNvbnN0IHJhZGl1c0JvdHRvbSA9IDAuNQogICAqICAgICBjb25zdCBoZWlnaHQgPSAyCiAgICogICAgIGNvbnN0IG51bVNlZ21lbnRzID0gMTIKICAgKiAgICAgY29uc3QgY3lsaW5kZXJTaGFwZSA9IG5ldyBDQU5OT04uQ3lsaW5kZXIocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpCiAgICogICAgIGNvbnN0IGN5bGluZGVyQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBjeWxpbmRlclNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoY3lsaW5kZXJCb2R5KQogICAqLwoKICBjbGFzcyBDeWxpbmRlciBleHRlbmRzIENvbnZleFBvbHloZWRyb24gewogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuICovCgogICAgLyoqIFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLiAqLwoKICAgIC8qKiBUaGUgbnVtYmVyIG9mIHNlZ21lbnRzIHRvIGJ1aWxkIHRoZSBjeWxpbmRlciBvdXQgb2YuICovCgogICAgLyoqCiAgICAgKiBAcGFyYW0gcmFkaXVzVG9wIFRoZSByYWRpdXMgb2YgdGhlIHRvcCBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gcmFkaXVzQm90dG9tIFRoZSByYWRpdXMgb2YgdGhlIGJvdHRvbSBvZiB0aGUgQ3lsaW5kZXIuCiAgICAgKiBAcGFyYW0gaGVpZ2h0IFRoZSBoZWlnaHQgb2YgdGhlIEN5bGluZGVyLgogICAgICogQHBhcmFtIG51bVNlZ21lbnRzIFRoZSBudW1iZXIgb2Ygc2VnbWVudHMgdG8gYnVpbGQgdGhlIGN5bGluZGVyIG91dCBvZi4KICAgICAqLwogICAgY29uc3RydWN0b3IocmFkaXVzVG9wLCByYWRpdXNCb3R0b20sIGhlaWdodCwgbnVtU2VnbWVudHMpIHsKICAgICAgaWYgKHJhZGl1c1RvcCA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzVG9wID0gMTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA9PT0gdm9pZCAwKSB7CiAgICAgICAgcmFkaXVzQm90dG9tID0gMTsKICAgICAgfQoKICAgICAgaWYgKGhlaWdodCA9PT0gdm9pZCAwKSB7CiAgICAgICAgaGVpZ2h0ID0gMTsKICAgICAgfQoKICAgICAgaWYgKG51bVNlZ21lbnRzID09PSB2b2lkIDApIHsKICAgICAgICBudW1TZWdtZW50cyA9IDg7CiAgICAgIH0KCiAgICAgIGlmIChyYWRpdXNUb3AgPCAwKSB7CiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdUaGUgY3lsaW5kZXIgcmFkaXVzVG9wIGNhbm5vdCBiZSBuZWdhdGl2ZS4nKTsKICAgICAgfQoKICAgICAgaWYgKHJhZGl1c0JvdHRvbSA8IDApIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ1RoZSBjeWxpbmRlciByYWRpdXNCb3R0b20gY2Fubm90IGJlIG5lZ2F0aXZlLicpOwogICAgICB9CgogICAgICBjb25zdCBOID0gbnVtU2VnbWVudHM7CiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGF4ZXMgPSBbXTsKICAgICAgY29uc3QgZmFjZXMgPSBbXTsKICAgICAgY29uc3QgYm90dG9tZmFjZSA9IFtdOwogICAgICBjb25zdCB0b3BmYWNlID0gW107CiAgICAgIGNvbnN0IGNvcyA9IE1hdGguY29zOwogICAgICBjb25zdCBzaW4gPSBNYXRoLnNpbjsgLy8gRmlyc3QgYm90dG9tIHBvaW50CgogICAgICB2ZXJ0aWNlcy5wdXNoKG5ldyBWZWMzKC1yYWRpdXNCb3R0b20gKiBzaW4oMCksIC1oZWlnaHQgKiAwLjUsIHJhZGl1c0JvdHRvbSAqIGNvcygwKSkpOwogICAgICBib3R0b21mYWNlLnB1c2goMCk7IC8vIEZpcnN0IHRvcCBwb2ludAoKICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzVG9wICogc2luKDApLCBoZWlnaHQgKiAwLjUsIHJhZGl1c1RvcCAqIGNvcygwKSkpOwogICAgICB0b3BmYWNlLnB1c2goMSk7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE47IGkrKykgewogICAgICAgIGNvbnN0IHRoZXRhID0gMiAqIE1hdGguUEkgLyBOICogKGkgKyAxKTsKICAgICAgICBjb25zdCB0aGV0YU4gPSAyICogTWF0aC5QSSAvIE4gKiAoaSArIDAuNSk7CgogICAgICAgIGlmIChpIDwgTiAtIDEpIHsKICAgICAgICAgIC8vIEJvdHRvbQogICAgICAgICAgdmVydGljZXMucHVzaChuZXcgVmVjMygtcmFkaXVzQm90dG9tICogc2luKHRoZXRhKSwgLWhlaWdodCAqIDAuNSwgcmFkaXVzQm90dG9tICogY29zKHRoZXRhKSkpOwogICAgICAgICAgYm90dG9tZmFjZS5wdXNoKDIgKiBpICsgMik7IC8vIFRvcAoKICAgICAgICAgIHZlcnRpY2VzLnB1c2gobmV3IFZlYzMoLXJhZGl1c1RvcCAqIHNpbih0aGV0YSksIGhlaWdodCAqIDAuNSwgcmFkaXVzVG9wICogY29zKHRoZXRhKSkpOwogICAgICAgICAgdG9wZmFjZS5wdXNoKDIgKiBpICsgMyk7IC8vIEZhY2UKCiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAyICogaSArIDMsIDIgKiBpICsgMl0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBmYWNlcy5wdXNoKFsyICogaSwgMiAqIGkgKyAxLCAxLCAwXSk7IC8vIENvbm5lY3QKICAgICAgICB9IC8vIEF4aXM6IHdlIGNhbiBjdXQgb2ZmIGhhbGYgb2YgdGhlbSBpZiB3ZSBoYXZlIGV2ZW4gbnVtYmVyIG9mIHNlZ21lbnRzCgoKICAgICAgICBpZiAoTiAlIDIgPT09IDEgfHwgaSA8IE4gLyAyKSB7CiAgICAgICAgICBheGVzLnB1c2gobmV3IFZlYzMoLXNpbih0aGV0YU4pLCAwLCBjb3ModGhldGFOKSkpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZmFjZXMucHVzaChib3R0b21mYWNlKTsKICAgICAgYXhlcy5wdXNoKG5ldyBWZWMzKDAsIDEsIDApKTsgLy8gUmVvcmRlciB0b3AgZmFjZQoKICAgICAgY29uc3QgdGVtcCA9IFtdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0b3BmYWNlLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdGVtcC5wdXNoKHRvcGZhY2VbdG9wZmFjZS5sZW5ndGggLSBpIC0gMV0pOwogICAgICB9CgogICAgICBmYWNlcy5wdXNoKHRlbXApOwogICAgICBzdXBlcih7CiAgICAgICAgdmVydGljZXMsCiAgICAgICAgZmFjZXMsCiAgICAgICAgYXhlcwogICAgICB9KTsKICAgICAgdGhpcy50eXBlID0gU2hhcGUudHlwZXMuQ1lMSU5ERVI7CiAgICAgIHRoaXMucmFkaXVzVG9wID0gcmFkaXVzVG9wOwogICAgICB0aGlzLnJhZGl1c0JvdHRvbSA9IHJhZGl1c0JvdHRvbTsKICAgICAgdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CiAgICAgIHRoaXMubnVtU2VnbWVudHMgPSBudW1TZWdtZW50czsKICAgIH0KCiAgfQoKICAvKioKICAgKiBQYXJ0aWNsZSBzaGFwZS4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwYXJ0aWNsZVNoYXBlID0gbmV3IENBTk5PTi5QYXJ0aWNsZSgpCiAgICogICAgIGNvbnN0IHBhcnRpY2xlQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDEsIHNoYXBlOiBwYXJ0aWNsZVNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkocGFydGljbGVCb2R5KQogICAqLwogIGNsYXNzIFBhcnRpY2xlIGV4dGVuZHMgU2hhcGUgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QQVJUSUNMRQogICAgICB9KTsKICAgIH0KICAgIC8qKgogICAgICogY2FsY3VsYXRlTG9jYWxJbmVydGlhCiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuIDA7CiAgICB9CgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIHRoaXMuYm91bmRpbmdTcGhlcmVSYWRpdXMgPSAwOwogICAgfQoKICAgIGNhbGN1bGF0ZVdvcmxkQUFCQihwb3MsIHF1YXQsIG1pbiwgbWF4KSB7CiAgICAgIC8vIEdldCBlYWNoIGF4aXMgbWF4CiAgICAgIG1pbi5jb3B5KHBvcyk7CiAgICAgIG1heC5jb3B5KHBvcyk7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQSBwbGFuZSwgZmFjaW5nIGluIHRoZSBaIGRpcmVjdGlvbi4gVGhlIHBsYW5lIGhhcyBpdHMgc3VyZmFjZSBhdCB6PTAgYW5kIGV2ZXJ5dGhpbmcgYmVsb3cgej0wIGlzIGFzc3VtZWQgdG8gYmUgc29saWQgcGxhbmUuIFRvIG1ha2UgdGhlIHBsYW5lIGZhY2UgaW4gc29tZSBvdGhlciBkaXJlY3Rpb24gdGhhbiB6LCB5b3UgbXVzdCBwdXQgaXQgaW5zaWRlIGEgQm9keSBhbmQgcm90YXRlIHRoYXQgYm9keS4gU2VlIHRoZSBkZW1vcy4KICAgKiBAZXhhbXBsZQogICAqICAgICBjb25zdCBwbGFuZVNoYXBlID0gbmV3IENBTk5PTi5QbGFuZSgpCiAgICogICAgIGNvbnN0IHBsYW5lQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IG1hc3M6IDAsIHNoYXBlOiAgcGxhbmVTaGFwZSB9KQogICAqICAgICBwbGFuZUJvZHkucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoLU1hdGguUEkgLyAyLCAwLCAwKSAvLyBtYWtlIGl0IGZhY2UgdXAKICAgKiAgICAgd29ybGQuYWRkQm9keShwbGFuZUJvZHkpCiAgICovCiAgY2xhc3MgUGxhbmUgZXh0ZW5kcyBTaGFwZSB7CiAgICAvKiogd29ybGROb3JtYWwgKi8KCiAgICAvKiogd29ybGROb3JtYWxOZWVkc1VwZGF0ZSAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5QTEFORQogICAgICB9KTsgLy8gV29ybGQgb3JpZW50ZWQgbm9ybWFsCgogICAgICB0aGlzLndvcmxkTm9ybWFsID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyA9IE51bWJlci5NQVhfVkFMVUU7CiAgICB9CiAgICAvKiogY29tcHV0ZVdvcmxkTm9ybWFsICovCgoKICAgIGNvbXB1dGVXb3JsZE5vcm1hbChxdWF0KSB7CiAgICAgIGNvbnN0IG4gPSB0aGlzLndvcmxkTm9ybWFsOwogICAgICBuLnNldCgwLCAwLCAxKTsKICAgICAgcXVhdC52bXVsdChuLCBuKTsKICAgICAgdGhpcy53b3JsZE5vcm1hbE5lZWRzVXBkYXRlID0gZmFsc2U7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgcGxhbmUgaXMgaW5maW5pdGUuLi4KICAgICAgICBOdW1iZXIuTUFYX1ZBTFVFCiAgICAgICk7CiAgICB9CgogICAgY2FsY3VsYXRlV29ybGRBQUJCKHBvcywgcXVhdCwgbWluLCBtYXgpIHsKICAgICAgLy8gVGhlIHBsYW5lIEFBQkIgaXMgaW5maW5pdGUsIGV4Y2VwdCBpZiB0aGUgbm9ybWFsIGlzIHBvaW50aW5nIGFsb25nIGFueSBheGlzCiAgICAgIHRlbXBOb3JtYWwuc2V0KDAsIDAsIDEpOyAvLyBEZWZhdWx0IHBsYW5lIG5vcm1hbCBpcyB6CgogICAgICBxdWF0LnZtdWx0KHRlbXBOb3JtYWwsIHRlbXBOb3JtYWwpOwogICAgICBjb25zdCBtYXhWYWwgPSBOdW1iZXIuTUFYX1ZBTFVFOwogICAgICBtaW4uc2V0KC1tYXhWYWwsIC1tYXhWYWwsIC1tYXhWYWwpOwogICAgICBtYXguc2V0KG1heFZhbCwgbWF4VmFsLCBtYXhWYWwpOwoKICAgICAgaWYgKHRlbXBOb3JtYWwueCA9PT0gMSkgewogICAgICAgIG1heC54ID0gcG9zLng7CiAgICAgIH0gZWxzZSBpZiAodGVtcE5vcm1hbC54ID09PSAtMSkgewogICAgICAgIG1pbi54ID0gcG9zLng7CiAgICAgIH0KCiAgICAgIGlmICh0ZW1wTm9ybWFsLnkgPT09IDEpIHsKICAgICAgICBtYXgueSA9IHBvcy55OwogICAgICB9IGVsc2UgaWYgKHRlbXBOb3JtYWwueSA9PT0gLTEpIHsKICAgICAgICBtaW4ueSA9IHBvcy55OwogICAgICB9CgogICAgICBpZiAodGVtcE5vcm1hbC56ID09PSAxKSB7CiAgICAgICAgbWF4LnogPSBwb3MuejsKICAgICAgfSBlbHNlIGlmICh0ZW1wTm9ybWFsLnogPT09IC0xKSB7CiAgICAgICAgbWluLnogPSBwb3MuejsKICAgICAgfQogICAgfQoKICAgIHVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCkgewogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTnVtYmVyLk1BWF9WQUxVRTsKICAgIH0KCiAgfQogIGNvbnN0IHRlbXBOb3JtYWwgPSBuZXcgVmVjMygpOwoKICAvKioKICAgKiBIZWlnaHRmaWVsZCBzaGFwZSBjbGFzcy4gSGVpZ2h0IGRhdGEgaXMgZ2l2ZW4gYXMgYW4gYXJyYXkuIFRoZXNlIGRhdGEgcG9pbnRzIGFyZSBzcHJlYWQgb3V0IGV2ZW5seSB3aXRoIGEgZ2l2ZW4gZGlzdGFuY2UuCiAgICogQHRvZG8gU2hvdWxkIGJlIHBvc3NpYmxlIHRvIHVzZSBhbG9uZyBhbGwgYXhlcywgbm90IGp1c3QgeQogICAqIEB0b2RvIHNob3VsZCBiZSBwb3NzaWJsZSB0byBzY2FsZSBhbG9uZyBhbGwgYXhlcwogICAqIEB0b2RvIFJlZmFjdG9yIGVsZW1lbnRTaXplIHRvIGVsZW1lbnRTaXplWCBhbmQgZWxlbWVudFNpemVZCiAgICoKICAgKiBAZXhhbXBsZQogICAqICAgICAvLyBHZW5lcmF0ZSBzb21lIGhlaWdodCBkYXRhICh5LXZhbHVlcykuCiAgICogICAgIGNvbnN0IGRhdGEgPSBbXQogICAqICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDEwMDA7IGkrKykgewogICAqICAgICAgICAgY29uc3QgeSA9IDAuNSAqIE1hdGguY29zKDAuMiAqIGkpCiAgICogICAgICAgICBkYXRhLnB1c2goeSkKICAgKiAgICAgfQogICAqCiAgICogICAgIC8vIENyZWF0ZSB0aGUgaGVpZ2h0ZmllbGQgc2hhcGUKICAgKiAgICAgY29uc3QgaGVpZ2h0ZmllbGRTaGFwZSA9IG5ldyBDQU5OT04uSGVpZ2h0ZmllbGQoZGF0YSwgewogICAqICAgICAgICAgZWxlbWVudFNpemU6IDEgLy8gRGlzdGFuY2UgYmV0d2VlbiB0aGUgZGF0YSBwb2ludHMgaW4gWCBhbmQgWSBkaXJlY3Rpb25zCiAgICogICAgIH0pCiAgICogICAgIGNvbnN0IGhlaWdodGZpZWxkQm9keSA9IG5ldyBDQU5OT04uQm9keSh7IHNoYXBlOiBoZWlnaHRmaWVsZFNoYXBlIH0pCiAgICogICAgIHdvcmxkLmFkZEJvZHkoaGVpZ2h0ZmllbGRCb2R5KQogICAqLwogIGNsYXNzIEhlaWdodGZpZWxkIGV4dGVuZHMgU2hhcGUgewogICAgLyoqCiAgICAgKiBBbiBhcnJheSBvZiBudW1iZXJzLCBvciBoZWlnaHQgdmFsdWVzLCB0aGF0IGFyZSBzcHJlYWQgb3V0IGFsb25nIHRoZSB4IGF4aXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1heCB2YWx1ZSBvZiB0aGUgZGF0YSBwb2ludHMgaW4gdGhlIGRhdGEgYXJyYXkuCiAgICAgKi8KCiAgICAvKioKICAgICAqIE1pbmltdW0gdmFsdWUgb2YgdGhlIGRhdGEgcG9pbnRzIGluIHRoZSBkYXRhIGFycmF5LgogICAgICovCgogICAgLyoqCiAgICAgKiBXb3JsZCBzcGFjaW5nIGJldHdlZW4gdGhlIGRhdGEgcG9pbnRzIGluIFggYW5kIFkgZGlyZWN0aW9uLgogICAgICogQHRvZG8gZWxlbWVudFNpemVYIGFuZCBZCiAgICAgKiBAZGVmYXVsdCAxCiAgICAgKi8KCiAgICAvKioKICAgICAqIEBkZWZhdWx0IHRydWUKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGRhdGEgQW4gYXJyYXkgb2YgbnVtYmVycywgb3IgaGVpZ2h0IHZhbHVlcywgdGhhdCBhcmUgc3ByZWFkIG91dCBhbG9uZyB0aGUgeCBheGlzLgogICAgICovCiAgICBjb25zdHJ1Y3RvcihkYXRhLCBvcHRpb25zKSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMgPSBVdGlscy5kZWZhdWx0cyhvcHRpb25zLCB7CiAgICAgICAgbWF4VmFsdWU6IG51bGwsCiAgICAgICAgbWluVmFsdWU6IG51bGwsCiAgICAgICAgZWxlbWVudFNpemU6IDEKICAgICAgfSk7CiAgICAgIHN1cGVyKHsKICAgICAgICB0eXBlOiBTaGFwZS50eXBlcy5IRUlHSFRGSUVMRAogICAgICB9KTsKICAgICAgdGhpcy5kYXRhID0gZGF0YTsKICAgICAgdGhpcy5tYXhWYWx1ZSA9IG9wdGlvbnMubWF4VmFsdWU7CiAgICAgIHRoaXMubWluVmFsdWUgPSBvcHRpb25zLm1pblZhbHVlOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gb3B0aW9ucy5lbGVtZW50U2l6ZTsKCiAgICAgIGlmIChvcHRpb25zLm1pblZhbHVlID09PSBudWxsKSB7CiAgICAgICAgdGhpcy51cGRhdGVNaW5WYWx1ZSgpOwogICAgICB9CgogICAgICBpZiAob3B0aW9ucy5tYXhWYWx1ZSA9PT0gbnVsbCkgewogICAgICAgIHRoaXMudXBkYXRlTWF4VmFsdWUoKTsKICAgICAgfQoKICAgICAgdGhpcy5jYWNoZUVuYWJsZWQgPSB0cnVlOwogICAgICB0aGlzLnBpbGxhckNvbnZleCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgIHRoaXMucGlsbGFyT2Zmc2V0ID0gbmV3IFZlYzMoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOyAvLyAiaV9qX2lzVXBwZXIiID0+IHsgY29udmV4OiAuLi4sIG9mZnNldDogLi4uIH0KICAgICAgLy8gZm9yIGV4YW1wbGU6CiAgICAgIC8vIF9jYWNoZWRQaWxsYXJzWyIwXzJfMSJdCgogICAgICB0aGlzLl9jYWNoZWRQaWxsYXJzID0ge307CiAgICB9CiAgICAvKioKICAgICAqIENhbGwgd2hlbmV2ZXIgeW91IGNoYW5nZSB0aGUgZGF0YSBhcnJheS4KICAgICAqLwoKCiAgICB1cGRhdGUoKSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnMgPSB7fTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWluVmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWluVmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtaW5WYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA8IG1pblZhbHVlKSB7CiAgICAgICAgICAgIG1pblZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWluVmFsdWUgPSBtaW5WYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogVXBkYXRlIHRoZSBgbWF4VmFsdWVgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlTWF4VmFsdWUoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGxldCBtYXhWYWx1ZSA9IGRhdGFbMF1bMF07CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gZGF0YS5sZW5ndGg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBkYXRhW2ldLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCB2ID0gZGF0YVtpXVtqXTsKCiAgICAgICAgICBpZiAodiA+IG1heFZhbHVlKSB7CiAgICAgICAgICAgIG1heFZhbHVlID0gdjsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMubWF4VmFsdWUgPSBtYXhWYWx1ZTsKICAgIH0KICAgIC8qKgogICAgICogU2V0IHRoZSBoZWlnaHQgdmFsdWUgYXQgYW4gaW5kZXguIERvbid0IGZvcmdldCB0byB1cGRhdGUgbWF4VmFsdWUgYW5kIG1pblZhbHVlIGFmdGVyIHlvdSdyZSBkb25lLgogICAgICovCgoKICAgIHNldEhlaWdodFZhbHVlQXRJbmRleCh4aSwgeWksIHZhbHVlKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGRhdGFbeGldW3lpXSA9IHZhbHVlOyAvLyBJbnZhbGlkYXRlIGNhY2hlCgogICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBmYWxzZSk7CgogICAgICBpZiAoeGkgPiAwKSB7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpIC0gMSwgeWksIHRydWUpOwogICAgICAgIHRoaXMuY2xlYXJDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSAtIDEsIHlpLCBmYWxzZSk7CiAgICAgIH0KCiAgICAgIGlmICh5aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpIC0gMSwgdHJ1ZSk7CiAgICAgICAgdGhpcy5jbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSAtIDEsIGZhbHNlKTsKICAgICAgfQoKICAgICAgaWYgKHlpID4gMCAmJiB4aSA+IDApIHsKICAgICAgICB0aGlzLmNsZWFyQ2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGkgLSAxLCB5aSAtIDEsIHRydWUpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBtYXgvbWluIGluIGEgcmVjdGFuZ2xlIGluIHRoZSBtYXRyaXggZGF0YQogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSB0byBzdG9yZSB0aGUgcmVzdWx0cyBpbi4KICAgICAqIEByZXR1cm4gVGhlIHJlc3VsdCBhcnJheSwgaWYgaXQgd2FzIHBhc3NlZCBpbi4gTWluaW11bSB3aWxsIGJlIGF0IHBvc2l0aW9uIDAgYW5kIG1heCBhdCAxLgogICAgICovCgoKICAgIGdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIHJlc3VsdCkgewogICAgICBpZiAocmVzdWx0ID09PSB2b2lkIDApIHsKICAgICAgICByZXN1bHQgPSBbXTsKICAgICAgfQoKICAgICAgLy8gR2V0IG1heCBhbmQgbWluIG9mIHRoZSBkYXRhCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7IC8vIFNldCBmaXJzdCB2YWx1ZQoKICAgICAgbGV0IG1heCA9IHRoaXMubWluVmFsdWU7CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPD0gaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8PSBpTWF4WTsgaisrKSB7CiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBkYXRhW2ldW2pdOwoKICAgICAgICAgIGlmIChoZWlnaHQgPiBtYXgpIHsKICAgICAgICAgICAgbWF4ID0gaGVpZ2h0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmVzdWx0WzBdID0gdGhpcy5taW5WYWx1ZTsKICAgICAgcmVzdWx0WzFdID0gbWF4OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGluZGV4IG9mIGEgbG9jYWwgcG9zaXRpb24gb24gdGhlIGhlaWdodGZpZWxkLiBUaGUgaW5kZXhlcyBpbmRpY2F0ZSB0aGUgcmVjdGFuZ2xlcywgc28gaWYgeW91ciB0ZXJyYWluIGlzIG1hZGUgb2YgTiB4IE4gaGVpZ2h0IGRhdGEgcG9pbnRzLCB5b3Ugd2lsbCBoYXZlIHJlY3RhbmdsZSBpbmRleGVzIHJhbmdpbmcgZnJvbSAwIHRvIE4tMS4KICAgICAqIEBwYXJhbSByZXN1bHQgVHdvLWVsZW1lbnQgYXJyYXkKICAgICAqIEBwYXJhbSBjbGFtcCBJZiB0aGUgcG9zaXRpb24gc2hvdWxkIGJlIGNsYW1wZWQgdG8gdGhlIGhlaWdodGZpZWxkIGVkZ2UuCiAgICAgKi8KCgogICAgZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIHJlc3VsdCwgY2xhbXApIHsKICAgICAgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CiAgICAgIGNvbnN0IHcgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBsZXQgeGkgPSBNYXRoLmZsb29yKHggLyB3KTsKICAgICAgbGV0IHlpID0gTWF0aC5mbG9vcih5IC8gdyk7CiAgICAgIHJlc3VsdFswXSA9IHhpOwogICAgICByZXN1bHRbMV0gPSB5aTsKCiAgICAgIGlmIChjbGFtcCkgewogICAgICAgIC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCiAgICAgICAgaWYgKHhpIDwgMCkgewogICAgICAgICAgeGkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHlpIDwgMCkgewogICAgICAgICAgeWkgPSAwOwogICAgICAgIH0KCiAgICAgICAgaWYgKHhpID49IGRhdGEubGVuZ3RoIC0gMSkgewogICAgICAgICAgeGkgPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgICAgfQoKICAgICAgICBpZiAoeWkgPj0gZGF0YVswXS5sZW5ndGggLSAxKSB7CiAgICAgICAgICB5aSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgICB9CiAgICAgIH0gLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKCiAgICAgIGlmICh4aSA8IDAgfHwgeWkgPCAwIHx8IHhpID49IGRhdGEubGVuZ3RoIC0gMSB8fCB5aSA+PSBkYXRhWzBdLmxlbmd0aCAtIDEpIHsKICAgICAgICByZXR1cm4gZmFsc2U7CiAgICAgIH0KCiAgICAgIHJldHVybiB0cnVlOwogICAgfQoKICAgIGdldFRyaWFuZ2xlQXQoeCwgeSwgZWRnZUNsYW1wLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGlkeCA9IGdldEhlaWdodEF0X2lkeDsKICAgICAgdGhpcy5nZXRJbmRleE9mUG9zaXRpb24oeCwgeSwgaWR4LCBlZGdlQ2xhbXApOwogICAgICBsZXQgeGkgPSBpZHhbMF07CiAgICAgIGxldCB5aSA9IGlkeFsxXTsKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCiAgICAgIGlmIChlZGdlQ2xhbXApIHsKICAgICAgICB4aSA9IE1hdGgubWluKGRhdGEubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeGkpKTsKICAgICAgICB5aSA9IE1hdGgubWluKGRhdGFbMF0ubGVuZ3RoIC0gMiwgTWF0aC5tYXgoMCwgeWkpKTsKICAgICAgfQoKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBsb3dlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtIHhpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtIHlpKSAqKiAyOwogICAgICBjb25zdCB1cHBlckRpc3QyID0gKHggLyBlbGVtZW50U2l6ZSAtICh4aSArIDEpKSAqKiAyICsgKHkgLyBlbGVtZW50U2l6ZSAtICh5aSArIDEpKSAqKiAyOwogICAgICBjb25zdCB1cHBlciA9IGxvd2VyRGlzdDIgPiB1cHBlckRpc3QyOwogICAgICB0aGlzLmdldFRyaWFuZ2xlKHhpLCB5aSwgdXBwZXIsIGEsIGIsIGMpOwogICAgICByZXR1cm4gdXBwZXI7CiAgICB9CgogICAgZ2V0Tm9ybWFsQXQoeCwgeSwgZWRnZUNsYW1wLCByZXN1bHQpIHsKICAgICAgY29uc3QgYSA9IGdldE5vcm1hbEF0X2E7CiAgICAgIGNvbnN0IGIgPSBnZXROb3JtYWxBdF9iOwogICAgICBjb25zdCBjID0gZ2V0Tm9ybWFsQXRfYzsKICAgICAgY29uc3QgZTAgPSBnZXROb3JtYWxBdF9lMDsKICAgICAgY29uc3QgZTEgPSBnZXROb3JtYWxBdF9lMTsKICAgICAgdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGIudnN1YihhLCBlMCk7CiAgICAgIGMudnN1YihhLCBlMSk7CiAgICAgIGUwLmNyb3NzKGUxLCByZXN1bHQpOwogICAgICByZXN1bHQubm9ybWFsaXplKCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBBQUJCIG9mIGEgc3F1YXJlIGluIHRoZSBoZWlnaHRmaWVsZAogICAgICogQHBhcmFtIHhpCiAgICAgKiBAcGFyYW0geWkKICAgICAqIEBwYXJhbSByZXN1bHQKICAgICAqLwoKCiAgICBnZXRBYWJiQXRJbmRleCh4aSwgeWksIF9yZWYpIHsKICAgICAgbGV0IHsKICAgICAgICBsb3dlckJvdW5kLAogICAgICAgIHVwcGVyQm91bmQKICAgICAgfSA9IF9yZWY7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGVsZW1lbnRTaXplID0gdGhpcy5lbGVtZW50U2l6ZTsKICAgICAgbG93ZXJCb3VuZC5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgdXBwZXJCb3VuZC5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpICsgMV0pOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdGhlIGhlaWdodCBpbiB0aGUgaGVpZ2h0ZmllbGQgYXQgYSBnaXZlbiBwb3NpdGlvbgogICAgICovCgoKICAgIGdldEhlaWdodEF0KHgsIHksIGVkZ2VDbGFtcCkgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBhID0gZ2V0SGVpZ2h0QXRfYTsKICAgICAgY29uc3QgYiA9IGdldEhlaWdodEF0X2I7CiAgICAgIGNvbnN0IGMgPSBnZXRIZWlnaHRBdF9jOwogICAgICBjb25zdCBpZHggPSBnZXRIZWlnaHRBdF9pZHg7CiAgICAgIHRoaXMuZ2V0SW5kZXhPZlBvc2l0aW9uKHgsIHksIGlkeCwgZWRnZUNsYW1wKTsKICAgICAgbGV0IHhpID0gaWR4WzBdOwogICAgICBsZXQgeWkgPSBpZHhbMV07CgogICAgICBpZiAoZWRnZUNsYW1wKSB7CiAgICAgICAgeGkgPSBNYXRoLm1pbihkYXRhLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHhpKSk7CiAgICAgICAgeWkgPSBNYXRoLm1pbihkYXRhWzBdLmxlbmd0aCAtIDIsIE1hdGgubWF4KDAsIHlpKSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IHVwcGVyID0gdGhpcy5nZXRUcmlhbmdsZUF0KHgsIHksIGVkZ2VDbGFtcCwgYSwgYiwgYyk7CiAgICAgIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBhLngsIGEueSwgYi54LCBiLnksIGMueCwgYy55LCBnZXRIZWlnaHRBdF93ZWlnaHRzKTsKICAgICAgY29uc3QgdyA9IGdldEhlaWdodEF0X3dlaWdodHM7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aSArIDFdW3lpICsgMV0gKiB3LnggKyBkYXRhW3hpXVt5aSArIDFdICogdy55ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcuejsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICByZXR1cm4gZGF0YVt4aV1beWldICogdy54ICsgZGF0YVt4aSArIDFdW3lpXSAqIHcueSArIGRhdGFbeGldW3lpICsgMV0gKiB3Lno7CiAgICAgIH0KICAgIH0KCiAgICBnZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICByZXR1cm4gYCR7eGl9XyR7eWl9XyR7Z2V0VXBwZXJUcmlhbmdsZSA/IDEgOiAwfWA7CiAgICB9CgogICAgZ2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgIHJldHVybiB0aGlzLl9jYWNoZWRQaWxsYXJzW3RoaXMuZ2V0Q2FjaGVDb252ZXhUcmlhbmdsZVBpbGxhcktleSh4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUpXTsKICAgIH0KCiAgICBzZXRDYWNoZWRDb252ZXhUcmlhbmdsZVBpbGxhcih4aSwgeWksIGdldFVwcGVyVHJpYW5nbGUsIGNvbnZleCwgb2Zmc2V0KSB7CiAgICAgIHRoaXMuX2NhY2hlZFBpbGxhcnNbdGhpcy5nZXRDYWNoZUNvbnZleFRyaWFuZ2xlUGlsbGFyS2V5KHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSldID0gewogICAgICAgIGNvbnZleCwKICAgICAgICBvZmZzZXQKICAgICAgfTsKICAgIH0KCiAgICBjbGVhckNhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBkZWxldGUgdGhpcy5fY2FjaGVkUGlsbGFyc1t0aGlzLmdldENhY2hlQ29udmV4VHJpYW5nbGVQaWxsYXJLZXkoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlKV07CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHRyaWFuZ2xlIGZyb20gdGhlIGhlaWdodGZpZWxkCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGUoeGksIHlpLCB1cHBlciwgYSwgYiwgYykgewogICAgICBjb25zdCBkYXRhID0gdGhpcy5kYXRhOwogICAgICBjb25zdCBlbGVtZW50U2l6ZSA9IHRoaXMuZWxlbWVudFNpemU7CgogICAgICBpZiAodXBwZXIpIHsKICAgICAgICAvLyBUb3AgdHJpYW5nbGUgdmVydHMKICAgICAgICBhLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWkgKyAxXSk7CiAgICAgICAgYi5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgKHlpICsgMSkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSk7CiAgICAgICAgYy5zZXQoKHhpICsgMSkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aSArIDFdW3lpXSk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgLy8gVG9wIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgYS5zZXQoeGkgKiBlbGVtZW50U2l6ZSwgeWkgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWldKTsKICAgICAgICBiLnNldCgoeGkgKyAxKSAqIGVsZW1lbnRTaXplLCB5aSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpICsgMV1beWldKTsKICAgICAgICBjLnNldCh4aSAqIGVsZW1lbnRTaXplLCAoeWkgKyAxKSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB0cmlhbmdsZSBpbiB0aGUgdGVycmFpbiBpbiB0aGUgZm9ybSBvZiBhIHRyaWFuZ3VsYXIgY29udmV4IHNoYXBlLgogICAgICovCgoKICAgIGdldENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSkgewogICAgICBsZXQgcmVzdWx0ID0gdGhpcy5waWxsYXJDb252ZXg7CiAgICAgIGxldCBvZmZzZXRSZXN1bHQgPSB0aGlzLnBpbGxhck9mZnNldDsKCiAgICAgIGlmICh0aGlzLmNhY2hlRW5hYmxlZCkgewogICAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmdldENhY2hlZENvbnZleFRyaWFuZ2xlUGlsbGFyKHhpLCB5aSwgZ2V0VXBwZXJUcmlhbmdsZSk7CgogICAgICAgIGlmIChkYXRhKSB7CiAgICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IGRhdGEuY29udmV4OwogICAgICAgICAgdGhpcy5waWxsYXJPZmZzZXQgPSBkYXRhLm9mZnNldDsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIHJlc3VsdCA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAgICAgb2Zmc2V0UmVzdWx0ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLnBpbGxhckNvbnZleCA9IHJlc3VsdDsKICAgICAgICB0aGlzLnBpbGxhck9mZnNldCA9IG9mZnNldFJlc3VsdDsKICAgICAgfQoKICAgICAgY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKICAgICAgY29uc3QgZWxlbWVudFNpemUgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICBjb25zdCBmYWNlcyA9IHJlc3VsdC5mYWNlczsgLy8gUmV1c2UgdmVydHMgaWYgcG9zc2libGUKCiAgICAgIHJlc3VsdC52ZXJ0aWNlcy5sZW5ndGggPSA2OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA2OyBpKyspIHsKICAgICAgICBpZiAoIXJlc3VsdC52ZXJ0aWNlc1tpXSkgewogICAgICAgICAgcmVzdWx0LnZlcnRpY2VzW2ldID0gbmV3IFZlYzMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gUmV1c2UgZmFjZXMgaWYgcG9zc2libGUKCgogICAgICBmYWNlcy5sZW5ndGggPSA1OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCA1OyBpKyspIHsKICAgICAgICBpZiAoIWZhY2VzW2ldKSB7CiAgICAgICAgICBmYWNlc1tpXSA9IFtdOwogICAgICAgIH0KICAgICAgfQoKICAgICAgY29uc3QgdmVydHMgPSByZXN1bHQudmVydGljZXM7CiAgICAgIGNvbnN0IGggPSAoTWF0aC5taW4oZGF0YVt4aV1beWldLCBkYXRhW3hpICsgMV1beWldLCBkYXRhW3hpXVt5aSArIDFdLCBkYXRhW3hpICsgMV1beWkgKyAxXSkgLSB0aGlzLm1pblZhbHVlKSAvIDIgKyB0aGlzLm1pblZhbHVlOwoKICAgICAgaWYgKCFnZXRVcHBlclRyaWFuZ2xlKSB7CiAgICAgICAgLy8gQ2VudGVyIG9mIHRoZSB0cmlhbmdsZSBwaWxsYXIgLSBhbGwgcG9seWdvbnMgYXJlIGdpdmVuIHJlbGF0aXZlIHRvIHRoaXMgb25lCiAgICAgICAgb2Zmc2V0UmVzdWx0LnNldCgoeGkgKyAwLjI1KSAqIGVsZW1lbnRTaXplLCAvLyBzb3J0IG9mIGNlbnRlciBvZiBhIHRyaWFuZ2xlCiAgICAgICAgKHlpICsgMC4yNSkgKiBlbGVtZW50U2l6ZSwgaCAvLyB2ZXJ0aWNhbCBjZW50ZXIKICAgICAgICApOyAvLyBUb3AgdHJpYW5nbGUgdmVydHMKCiAgICAgICAgdmVydHNbMF0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGldW3lpXSAtIGgpOwogICAgICAgIHZlcnRzWzFdLnNldCgwLjc1ICogZWxlbWVudFNpemUsIC0wLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsKICAgICAgICB2ZXJ0c1syXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgMC43NSAqIGVsZW1lbnRTaXplLCBkYXRhW3hpXVt5aSArIDFdIC0gaCk7IC8vIGJvdHRvbSB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1szXS5zZXQoLTAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KDAuNzUgKiBlbGVtZW50U2l6ZSwgLTAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KC0wLjI1ICogZWxlbWVudFNpemUsIDAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIHRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAteCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMl1bMV0gPSAyOwogICAgICAgIGZhY2VzWzJdWzJdID0gNTsKICAgICAgICBmYWNlc1syXVszXSA9IDM7IC8vIC15IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMTsKICAgICAgICBmYWNlc1szXVsxXSA9IDA7CiAgICAgICAgZmFjZXNbM11bMl0gPSAzOwogICAgICAgIGZhY2VzWzNdWzNdID0gNDsgLy8gK3h5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gNDsKICAgICAgICBmYWNlc1s0XVsxXSA9IDU7CiAgICAgICAgZmFjZXNbNF1bMl0gPSAyOwogICAgICAgIGZhY2VzWzRdWzNdID0gMTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBDZW50ZXIgb2YgdGhlIHRyaWFuZ2xlIHBpbGxhciAtIGFsbCBwb2x5Z29ucyBhcmUgZ2l2ZW4gcmVsYXRpdmUgdG8gdGhpcyBvbmUKICAgICAgICBvZmZzZXRSZXN1bHQuc2V0KCh4aSArIDAuNzUpICogZWxlbWVudFNpemUsIC8vIHNvcnQgb2YgY2VudGVyIG9mIGEgdHJpYW5nbGUKICAgICAgICAoeWkgKyAwLjc1KSAqIGVsZW1lbnRTaXplLCBoIC8vIHZlcnRpY2FsIGNlbnRlcgogICAgICAgICk7IC8vIFRvcCB0cmlhbmdsZSB2ZXJ0cwoKICAgICAgICB2ZXJ0c1swXS5zZXQoMC4yNSAqIGVsZW1lbnRTaXplLCAwLjI1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aSArIDFdIC0gaCk7CiAgICAgICAgdmVydHNbMV0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgZGF0YVt4aV1beWkgKyAxXSAtIGgpOwogICAgICAgIHZlcnRzWzJdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIC0wLjc1ICogZWxlbWVudFNpemUsIGRhdGFbeGkgKyAxXVt5aV0gLSBoKTsgLy8gYm90dG9tIHRyaWFuZ2xlIHZlcnRzCgogICAgICAgIHZlcnRzWzNdLnNldCgwLjI1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNF0uc2V0KC0wLjc1ICogZWxlbWVudFNpemUsIDAuMjUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7CiAgICAgICAgdmVydHNbNV0uc2V0KDAuMjUgKiBlbGVtZW50U2l6ZSwgLTAuNzUgKiBlbGVtZW50U2l6ZSwgLU1hdGguYWJzKGgpIC0gMSk7IC8vIFRvcCB0cmlhbmdsZQoKICAgICAgICBmYWNlc1swXVswXSA9IDA7CiAgICAgICAgZmFjZXNbMF1bMV0gPSAxOwogICAgICAgIGZhY2VzWzBdWzJdID0gMjsgLy8gYm90dG9tIHRyaWFuZ2xlCgogICAgICAgIGZhY2VzWzFdWzBdID0gNTsKICAgICAgICBmYWNlc1sxXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbMV1bMl0gPSAzOyAvLyAreCBmYWNpbmcgcXVhZAoKICAgICAgICBmYWNlc1syXVswXSA9IDI7CiAgICAgICAgZmFjZXNbMl1bMV0gPSA1OwogICAgICAgIGZhY2VzWzJdWzJdID0gMzsKICAgICAgICBmYWNlc1syXVszXSA9IDA7IC8vICt5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzNdWzBdID0gMzsKICAgICAgICBmYWNlc1szXVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbM11bMl0gPSAxOwogICAgICAgIGZhY2VzWzNdWzNdID0gMDsgLy8gLXh5IGZhY2luZyBxdWFkCgogICAgICAgIGZhY2VzWzRdWzBdID0gMTsKICAgICAgICBmYWNlc1s0XVsxXSA9IDQ7CiAgICAgICAgZmFjZXNbNF1bMl0gPSA1OwogICAgICAgIGZhY2VzWzRdWzNdID0gMjsKICAgICAgfQoKICAgICAgcmVzdWx0LmNvbXB1dGVOb3JtYWxzKCk7CiAgICAgIHJlc3VsdC5jb21wdXRlRWRnZXMoKTsKICAgICAgcmVzdWx0LnVwZGF0ZUJvdW5kaW5nU3BoZXJlUmFkaXVzKCk7CiAgICAgIHRoaXMuc2V0Q2FjaGVkQ29udmV4VHJpYW5nbGVQaWxsYXIoeGksIHlpLCBnZXRVcHBlclRyaWFuZ2xlLCByZXN1bHQsIG9mZnNldFJlc3VsdCk7CiAgICB9CgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICBpZiAodGFyZ2V0ID09PSB2b2lkIDApIHsKICAgICAgICB0YXJnZXQgPSBuZXcgVmVjMygpOwogICAgICB9CgogICAgICB0YXJnZXQuc2V0KDAsIDAsIDApOwogICAgICByZXR1cm4gdGFyZ2V0OwogICAgfQoKICAgIHZvbHVtZSgpIHsKICAgICAgcmV0dXJuICgvLyBUaGUgdGVycmFpbiBpcyBpbmZpbml0ZQogICAgICAgIE51bWJlci5NQVhfVkFMVUUKICAgICAgKTsKICAgIH0KCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKiogQFRPRE8gZG8gaXQgcHJvcGVybHkgKi8KICAgICAgbWluLnNldCgtTnVtYmVyLk1BWF9WQUxVRSwgLU51bWJlci5NQVhfVkFMVUUsIC1OdW1iZXIuTUFYX1ZBTFVFKTsKICAgICAgbWF4LnNldChOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFLCBOdW1iZXIuTUFYX1ZBTFVFKTsKICAgIH0KCiAgICB1cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpIHsKICAgICAgLy8gVXNlIHRoZSBib3VuZGluZyBib3ggb2YgdGhlIG1pbi9tYXggdmFsdWVzCiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IHMgPSB0aGlzLmVsZW1lbnRTaXplOwogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gbmV3IFZlYzMoZGF0YS5sZW5ndGggKiBzLCBkYXRhWzBdLmxlbmd0aCAqIHMsIE1hdGgubWF4KE1hdGguYWJzKHRoaXMubWF4VmFsdWUpLCBNYXRoLmFicyh0aGlzLm1pblZhbHVlKSkpLmxlbmd0aCgpOwogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIHRoZSBoZWlnaHQgdmFsdWVzIGZyb20gYW4gaW1hZ2UuIEN1cnJlbnRseSBvbmx5IHN1cHBvcnRlZCBpbiBicm93c2VyLgogICAgICovCgoKICAgIHNldEhlaWdodHNGcm9tSW1hZ2UoaW1hZ2UsIHNjYWxlKSB7CiAgICAgIGNvbnN0IHsKICAgICAgICB4LAogICAgICAgIHosCiAgICAgICAgeQogICAgICB9ID0gc2NhbGU7CiAgICAgIGNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpOwogICAgICBjYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKICAgICAgY2FudmFzLmhlaWdodCA9IGltYWdlLmhlaWdodDsKICAgICAgY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCcyZCcpOwogICAgICBjb250ZXh0LmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7CiAgICAgIGNvbnN0IGltYWdlRGF0YSA9IGNvbnRleHQuZ2V0SW1hZ2VEYXRhKDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQpOwogICAgICBjb25zdCBtYXRyaXggPSB0aGlzLmRhdGE7CiAgICAgIG1hdHJpeC5sZW5ndGggPSAwOwogICAgICB0aGlzLmVsZW1lbnRTaXplID0gTWF0aC5hYnMoeCkgLyBpbWFnZURhdGEud2lkdGg7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGltYWdlRGF0YS5oZWlnaHQ7IGkrKykgewogICAgICAgIGNvbnN0IHJvdyA9IFtdOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGltYWdlRGF0YS53aWR0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBhID0gaW1hZ2VEYXRhLmRhdGFbKGkgKiBpbWFnZURhdGEuaGVpZ2h0ICsgaikgKiA0XTsKICAgICAgICAgIGNvbnN0IGIgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAxXTsKICAgICAgICAgIGNvbnN0IGMgPSBpbWFnZURhdGEuZGF0YVsoaSAqIGltYWdlRGF0YS5oZWlnaHQgKyBqKSAqIDQgKyAyXTsKICAgICAgICAgIGNvbnN0IGhlaWdodCA9IChhICsgYiArIGMpIC8gNCAvIDI1NSAqIHo7CgogICAgICAgICAgaWYgKHggPCAwKSB7CiAgICAgICAgICAgIHJvdy5wdXNoKGhlaWdodCk7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICByb3cudW5zaGlmdChoZWlnaHQpOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYgKHkgPCAwKSB7CiAgICAgICAgICBtYXRyaXgudW5zaGlmdChyb3cpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBtYXRyaXgucHVzaChyb3cpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgdGhpcy51cGRhdGVNYXhWYWx1ZSgpOwogICAgICB0aGlzLnVwZGF0ZU1pblZhbHVlKCk7CiAgICAgIHRoaXMudXBkYXRlKCk7CiAgICB9CgogIH0KICBjb25zdCBnZXRIZWlnaHRBdF9pZHggPSBbXTsKICBjb25zdCBnZXRIZWlnaHRBdF93ZWlnaHRzID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXRIZWlnaHRBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9hID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9iID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9jID0gbmV3IFZlYzMoKTsKICBjb25zdCBnZXROb3JtYWxBdF9lMCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0Tm9ybWFsQXRfZTEgPSBuZXcgVmVjMygpOyAvLyBmcm9tIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0JhcnljZW50cmljX2Nvb3JkaW5hdGVfc3lzdGVtCgogIGZ1bmN0aW9uIGJhcnljZW50cmljV2VpZ2h0cyh4LCB5LCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCByZXN1bHQpIHsKICAgIHJlc3VsdC54ID0gKChieSAtIGN5KSAqICh4IC0gY3gpICsgKGN4IC0gYngpICogKHkgLSBjeSkpIC8gKChieSAtIGN5KSAqIChheCAtIGN4KSArIChjeCAtIGJ4KSAqIChheSAtIGN5KSk7CiAgICByZXN1bHQueSA9ICgoY3kgLSBheSkgKiAoeCAtIGN4KSArIChheCAtIGN4KSAqICh5IC0gY3kpKSAvICgoYnkgLSBjeSkgKiAoYXggLSBjeCkgKyAoY3ggLSBieCkgKiAoYXkgLSBjeSkpOwogICAgcmVzdWx0LnogPSAxIC0gcmVzdWx0LnggLSByZXN1bHQueTsKICB9CgogIC8qKgogICAqIE9jdHJlZU5vZGUKICAgKi8KICBjbGFzcyBPY3RyZWVOb2RlIHsKICAgIC8qKiBUaGUgcm9vdCBub2RlICovCgogICAgLyoqIEJvdW5kYXJ5IG9mIHRoaXMgbm9kZSAqLwoKICAgIC8qKiBDb250YWluZWQgZGF0YSBhdCB0aGUgY3VycmVudCBub2RlIGxldmVsICovCgogICAgLyoqIENoaWxkcmVuIHRvIHRoaXMgbm9kZSAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICB0aGlzLnJvb3QgPSBvcHRpb25zLnJvb3QgfHwgbnVsbDsKICAgICAgdGhpcy5hYWJiID0gb3B0aW9ucy5hYWJiID8gb3B0aW9ucy5hYWJiLmNsb25lKCkgOiBuZXcgQUFCQigpOwogICAgICB0aGlzLmRhdGEgPSBbXTsKICAgICAgdGhpcy5jaGlsZHJlbiA9IFtdOwogICAgfQogICAgLyoqCiAgICAgKiByZXNldAogICAgICovCgoKICAgIHJlc2V0KCkgewogICAgICB0aGlzLmNoaWxkcmVuLmxlbmd0aCA9IHRoaXMuZGF0YS5sZW5ndGggPSAwOwogICAgfQogICAgLyoqCiAgICAgKiBJbnNlcnQgZGF0YSBpbnRvIHRoaXMgbm9kZQogICAgICogQHJldHVybiBUcnVlIGlmIHN1Y2Nlc3NmdWwsIG90aGVyd2lzZSBmYWxzZQogICAgICovCgoKICAgIGluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwpIHsKICAgICAgaWYgKGxldmVsID09PSB2b2lkIDApIHsKICAgICAgICBsZXZlbCA9IDA7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5vZGVEYXRhID0gdGhpcy5kYXRhOyAvLyBJZ25vcmUgb2JqZWN0cyB0aGF0IGRvIG5vdCBiZWxvbmcgaW4gdGhpcyBub2RlCgogICAgICBpZiAoIXRoaXMuYWFiYi5jb250YWlucyhhYWJiKSkgewogICAgICAgIHJldHVybiBmYWxzZTsgLy8gb2JqZWN0IGNhbm5vdCBiZSBhZGRlZAogICAgICB9CgogICAgICBjb25zdCBjaGlsZHJlbiA9IHRoaXMuY2hpbGRyZW47CiAgICAgIGNvbnN0IG1heERlcHRoID0gdGhpcy5tYXhEZXB0aCB8fCB0aGlzLnJvb3QubWF4RGVwdGg7CgogICAgICBpZiAobGV2ZWwgPCBtYXhEZXB0aCkgewogICAgICAgIC8vIFN1YmRpdmlkZSBpZiB0aGVyZSBhcmUgbm8gY2hpbGRyZW4geWV0CiAgICAgICAgbGV0IHN1YmRpdmlkZWQgPSBmYWxzZTsKCiAgICAgICAgaWYgKCFjaGlsZHJlbi5sZW5ndGgpIHsKICAgICAgICAgIHRoaXMuc3ViZGl2aWRlKCk7CiAgICAgICAgICBzdWJkaXZpZGVkID0gdHJ1ZTsKICAgICAgICB9IC8vIGFkZCB0byB3aGljaGV2ZXIgbm9kZSB3aWxsIGFjY2VwdCBpdAoKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IDg7IGkrKykgewogICAgICAgICAgaWYgKGNoaWxkcmVuW2ldLmluc2VydChhYWJiLCBlbGVtZW50RGF0YSwgbGV2ZWwgKyAxKSkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChzdWJkaXZpZGVkKSB7CiAgICAgICAgICAvLyBObyBjaGlsZHJlbiBhY2NlcHRlZCEgTWlnaHQgYXMgd2VsbCBqdXN0IHJlbW92ZSBlbSBzaW5jZSB0aGV5IGNvbnRhaW4gbm9uZQogICAgICAgICAgY2hpbGRyZW4ubGVuZ3RoID0gMDsKICAgICAgICB9CiAgICAgIH0gLy8gVG9vIGRlZXAsIG9yIGNoaWxkcmVuIGRpZG50IHdhbnQgaXQuIGFkZCBpdCBpbiBjdXJyZW50IG5vZGUKCgogICAgICBub2RlRGF0YS5wdXNoKGVsZW1lbnREYXRhKTsKICAgICAgcmV0dXJuIHRydWU7CiAgICB9CiAgICAvKioKICAgICAqIENyZWF0ZSA4IGVxdWFsbHkgc2l6ZWQgY2hpbGRyZW4gbm9kZXMgYW5kIHB1dCB0aGVtIGluIHRoZSBgY2hpbGRyZW5gIGFycmF5LgogICAgICovCgoKICAgIHN1YmRpdmlkZSgpIHsKICAgICAgY29uc3QgYWFiYiA9IHRoaXMuYWFiYjsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwogICAgICBjaGlsZHJlbi5wdXNoKG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygwLCAwLCAwKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMSwgMCwgMCkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDEsIDEsIDApCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAxLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMSkKICAgICAgICB9KQogICAgICB9KSwgbmV3IE9jdHJlZU5vZGUoewogICAgICAgIGFhYmI6IG5ldyBBQUJCKHsKICAgICAgICAgIGxvd2VyQm91bmQ6IG5ldyBWZWMzKDAsIDAsIDEpCiAgICAgICAgfSkKICAgICAgfSksIG5ldyBPY3RyZWVOb2RlKHsKICAgICAgICBhYWJiOiBuZXcgQUFCQih7CiAgICAgICAgICBsb3dlckJvdW5kOiBuZXcgVmVjMygxLCAwLCAxKQogICAgICAgIH0pCiAgICAgIH0pLCBuZXcgT2N0cmVlTm9kZSh7CiAgICAgICAgYWFiYjogbmV3IEFBQkIoewogICAgICAgICAgbG93ZXJCb3VuZDogbmV3IFZlYzMoMCwgMSwgMCkKICAgICAgICB9KQogICAgICB9KSk7CiAgICAgIHUudnN1YihsLCBoYWxmRGlhZ29uYWwpOwogICAgICBoYWxmRGlhZ29uYWwuc2NhbGUoMC41LCBoYWxmRGlhZ29uYWwpOwogICAgICBjb25zdCByb290ID0gdGhpcy5yb290IHx8IHRoaXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gODsgaSsrKSB7CiAgICAgICAgY29uc3QgY2hpbGQgPSBjaGlsZHJlbltpXTsgLy8gU2V0IGN1cnJlbnQgbm9kZSBhcyByb290CgogICAgICAgIGNoaWxkLnJvb3QgPSByb290OyAvLyBDb21wdXRlIGJvdW5kcwoKICAgICAgICBjb25zdCBsb3dlckJvdW5kID0gY2hpbGQuYWFiYi5sb3dlckJvdW5kOwogICAgICAgIGxvd2VyQm91bmQueCAqPSBoYWxmRGlhZ29uYWwueDsKICAgICAgICBsb3dlckJvdW5kLnkgKj0gaGFsZkRpYWdvbmFsLnk7CiAgICAgICAgbG93ZXJCb3VuZC56ICo9IGhhbGZEaWFnb25hbC56OwogICAgICAgIGxvd2VyQm91bmQudmFkZChsLCBsb3dlckJvdW5kKTsgLy8gVXBwZXIgYm91bmQgaXMgYWx3YXlzIGxvd2VyIGJvdW5kICsgaGFsZkRpYWdvbmFsCgogICAgICAgIGxvd2VyQm91bmQudmFkZChoYWxmRGlhZ29uYWwsIGNoaWxkLmFhYmIudXBwZXJCb3VuZCk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSB3aXRoaW4gYW4gQUFCQgogICAgICogQHJldHVybiBUaGUgInJlc3VsdCIgb2JqZWN0CiAgICAgKi8KCgogICAgYWFiYlF1ZXJ5KGFhYmIsIHJlc3VsdCkgewogICAgICB0aGlzLmRhdGE7IC8vIGFib3J0IGlmIHRoZSByYW5nZSBkb2VzIG5vdCBpbnRlcnNlY3QgdGhpcyBub2RlCiAgICAgIC8vIGlmICghdGhpcy5hYWJiLm92ZXJsYXBzKGFhYmIpKXsKICAgICAgLy8gICAgIHJldHVybiByZXN1bHQ7CiAgICAgIC8vIH0KICAgICAgLy8gQWRkIG9iamVjdHMgYXQgdGhpcyBsZXZlbAogICAgICAvLyBBcnJheS5wcm90b3R5cGUucHVzaC5hcHBseShyZXN1bHQsIG5vZGVEYXRhKTsKICAgICAgLy8gQWRkIGNoaWxkIGRhdGEKICAgICAgLy8gQHRvZG8gdW53cmFwIHJlY3Vyc2lvbiBpbnRvIGEgcXVldWUgLyBsb29wLCB0aGF0J3MgZmFzdGVyIGluIEpTCgogICAgICB0aGlzLmNoaWxkcmVuOyAvLyBmb3IgKGxldCBpID0gMCwgTiA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICE9PSBOOyBpKyspIHsKICAgICAgLy8gICAgIGNoaWxkcmVuW2ldLmFhYmJRdWVyeShhYWJiLCByZXN1bHQpOwogICAgICAvLyB9CgogICAgICBjb25zdCBxdWV1ZSA9IFt0aGlzXTsKCiAgICAgIHdoaWxlIChxdWV1ZS5sZW5ndGgpIHsKICAgICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7CgogICAgICAgIGlmIChub2RlLmFhYmIub3ZlcmxhcHMoYWFiYikpIHsKICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHJlc3VsdCwgbm9kZS5kYXRhKTsKICAgICAgICB9CgogICAgICAgIEFycmF5LnByb3RvdHlwZS5wdXNoLmFwcGx5KHF1ZXVlLCBub2RlLmNoaWxkcmVuKTsKICAgICAgfQoKICAgICAgcmV0dXJuIHJlc3VsdDsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFsbCBkYXRhLCBwb3RlbnRpYWxseSBpbnRlcnNlY3RlZCBieSBhIHJheS4KICAgICAqIEByZXR1cm4gVGhlICJyZXN1bHQiIG9iamVjdAogICAgICovCgoKICAgIHJheVF1ZXJ5KHJheSwgdHJlZVRyYW5zZm9ybSwgcmVzdWx0KSB7CiAgICAgIC8vIFVzZSBhYWJiIHF1ZXJ5IGZvciBub3cuCgogICAgICAvKiogQHRvZG8gaW1wbGVtZW50IHJlYWwgcmF5IHF1ZXJ5IHdoaWNoIG5lZWRzIGxlc3MgbG9va3VwcyAqLwogICAgICByYXkuZ2V0QUFCQih0bXBBQUJCKTsKICAgICAgdG1wQUFCQi50b0xvY2FsRnJhbWUodHJlZVRyYW5zZm9ybSwgdG1wQUFCQik7CiAgICAgIHRoaXMuYWFiYlF1ZXJ5KHRtcEFBQkIsIHJlc3VsdCk7CiAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9CiAgICAvKioKICAgICAqIHJlbW92ZUVtcHR5Tm9kZXMKICAgICAqLwoKCiAgICByZW1vdmVFbXB0eU5vZGVzKCkgewogICAgICBmb3IgKGxldCBpID0gdGhpcy5jaGlsZHJlbi5sZW5ndGggLSAxOyBpID49IDA7IGktLSkgewogICAgICAgIHRoaXMuY2hpbGRyZW5baV0ucmVtb3ZlRW1wdHlOb2RlcygpOwoKICAgICAgICBpZiAoIXRoaXMuY2hpbGRyZW5baV0uY2hpbGRyZW4ubGVuZ3RoICYmICF0aGlzLmNoaWxkcmVuW2ldLmRhdGEubGVuZ3RoKSB7CiAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgfQogIC8qKgogICAqIE9jdHJlZQogICAqLwoKCiAgY2xhc3MgT2N0cmVlIGV4dGVuZHMgT2N0cmVlTm9kZSB7CiAgICAvKioKICAgICAqIE1heGltdW0gc3ViZGl2aXNpb24gZGVwdGgKICAgICAqIEBkZWZhdWx0IDgKICAgICAqLwoKICAgIC8qKgogICAgICogQHBhcmFtIGFhYmIgVGhlIHRvdGFsIEFBQkIgb2YgdGhlIHRyZWUKICAgICAqLwogICAgY29uc3RydWN0b3IoYWFiYiwgb3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcih7CiAgICAgICAgcm9vdDogbnVsbCwKICAgICAgICBhYWJiCiAgICAgIH0pOwogICAgICB0aGlzLm1heERlcHRoID0gdHlwZW9mIG9wdGlvbnMubWF4RGVwdGggIT09ICd1bmRlZmluZWQnID8gb3B0aW9ucy5tYXhEZXB0aCA6IDg7CiAgICB9CgogIH0KICBjb25zdCBoYWxmRGlhZ29uYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHRtcEFBQkIgPSBuZXcgQUFCQigpOwoKICAvKioKICAgKiBUcmltZXNoLgogICAqIEBleGFtcGxlCiAgICogICAgIC8vIEhvdyB0byBtYWtlIGEgbWVzaCB3aXRoIGEgc2luZ2xlIHRyaWFuZ2xlCiAgICogICAgIGNvbnN0IHZlcnRpY2VzID0gWwogICAqICAgICAgICAgMCwgMCwgMCwgLy8gdmVydGV4IDAKICAgKiAgICAgICAgIDEsIDAsIDAsIC8vIHZlcnRleCAxCiAgICogICAgICAgICAwLCAxLCAwICAvLyB2ZXJ0ZXggMgogICAqICAgICBdCiAgICogICAgIGNvbnN0IGluZGljZXMgPSBbCiAgICogICAgICAgICAwLCAxLCAyICAvLyB0cmlhbmdsZSAwCiAgICogICAgIF0KICAgKiAgICAgY29uc3QgdHJpbWVzaFNoYXBlID0gbmV3IENBTk5PTi5UcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKQogICAqLwogIGNsYXNzIFRyaW1lc2ggZXh0ZW5kcyBTaGFwZSB7CiAgICAvKioKICAgICAqIHZlcnRpY2VzCiAgICAgKi8KCiAgICAvKioKICAgICAqIEFycmF5IG9mIGludGVnZXJzLCBpbmRpY2F0aW5nIHdoaWNoIHZlcnRpY2VzIGVhY2ggdHJpYW5nbGUgY29uc2lzdHMgb2YuIFRoZSBsZW5ndGggb2YgdGhpcyBhcnJheSBpcyB0aHVzIDMgdGltZXMgdGhlIG51bWJlciBvZiB0cmlhbmdsZXMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBub3JtYWxzIGRhdGEuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBsb2NhbCBBQUJCIG9mIHRoZSBtZXNoLgogICAgICovCgogICAgLyoqCiAgICAgKiBSZWZlcmVuY2VzIHRvIHZlcnRleCBwYWlycywgbWFraW5nIHVwIGFsbCB1bmlxdWUgZWRnZXMgaW4gdGhlIHRyaW1lc2guCiAgICAgKi8KCiAgICAvKioKICAgICAqIExvY2FsIHNjYWxpbmcgb2YgdGhlIG1lc2guIFVzZSAuc2V0U2NhbGUoKSB0byBzZXQgaXQuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBpbmRleGVkIHRyaWFuZ2xlcy4gVXNlIC51cGRhdGVUcmVlKCkgdG8gdXBkYXRlIGl0LgogICAgICovCiAgICBjb25zdHJ1Y3Rvcih2ZXJ0aWNlcywgaW5kaWNlcykgewogICAgICBzdXBlcih7CiAgICAgICAgdHlwZTogU2hhcGUudHlwZXMuVFJJTUVTSAogICAgICB9KTsKICAgICAgdGhpcy52ZXJ0aWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkodmVydGljZXMpOwogICAgICB0aGlzLmluZGljZXMgPSBuZXcgSW50MTZBcnJheShpbmRpY2VzKTsKICAgICAgdGhpcy5ub3JtYWxzID0gbmV3IEZsb2F0MzJBcnJheShpbmRpY2VzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWFiYiA9IG5ldyBBQUJCKCk7CiAgICAgIHRoaXMuZWRnZXMgPSBudWxsOwogICAgICB0aGlzLnNjYWxlID0gbmV3IFZlYzMoMSwgMSwgMSk7CiAgICAgIHRoaXMudHJlZSA9IG5ldyBPY3RyZWUoKTsKICAgICAgdGhpcy51cGRhdGVFZGdlcygpOwogICAgICB0aGlzLnVwZGF0ZU5vcm1hbHMoKTsKICAgICAgdGhpcy51cGRhdGVBQUJCKCk7CiAgICAgIHRoaXMudXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKTsKICAgICAgdGhpcy51cGRhdGVUcmVlKCk7CiAgICB9CiAgICAvKioKICAgICAqIHVwZGF0ZVRyZWUKICAgICAqLwoKCiAgICB1cGRhdGVUcmVlKCkgewogICAgICBjb25zdCB0cmVlID0gdGhpcy50cmVlOwogICAgICB0cmVlLnJlc2V0KCk7CiAgICAgIHRyZWUuYWFiYi5jb3B5KHRoaXMuYWFiYik7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsgLy8gVGhlIGxvY2FsIG1lc2ggQUFCQiBpcyBzY2FsZWQsIGJ1dCB0aGUgb2N0cmVlIEFBQkIgc2hvdWxkIGJlIHVuc2NhbGVkCgogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIubG93ZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC54ICo9IDEgLyBzY2FsZS54OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC55ICo9IDEgLyBzY2FsZS55OwogICAgICB0cmVlLmFhYmIudXBwZXJCb3VuZC56ICo9IDEgLyBzY2FsZS56OyAvLyBJbnNlcnQgYWxsIHRyaWFuZ2xlcwoKICAgICAgY29uc3QgdHJpYW5nbGVBQUJCID0gbmV3IEFBQkIoKTsKICAgICAgY29uc3QgYSA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IGIgPSBuZXcgVmVjMygpOwogICAgICBjb25zdCBjID0gbmV3IFZlYzMoKTsKICAgICAgY29uc3QgcG9pbnRzID0gW2EsIGIsIGNdOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy90aGlzLmdldFRyaWFuZ2xlVmVydGljZXMoaSwgYSwgYiwgYyk7CiAgICAgICAgLy8gR2V0IHVuc2NhbGVkIHRyaWFuZ2xlIHZlcnRzCiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzXSwgYSk7CgogICAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDFdLCBiKTsKCiAgICAgICAgdGhpcy5fZ2V0VW5zY2FsZWRWZXJ0ZXgodGhpcy5pbmRpY2VzW2kzICsgMl0sIGMpOwoKICAgICAgICB0cmlhbmdsZUFBQkIuc2V0RnJvbVBvaW50cyhwb2ludHMpOwogICAgICAgIHRyZWUuaW5zZXJ0KHRyaWFuZ2xlQUFCQiwgaSk7CiAgICAgIH0KCiAgICAgIHRyZWUucmVtb3ZlRW1wdHlOb2RlcygpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgdHJpYW5nbGVzIGluIGEgbG9jYWwgQUFCQiBmcm9tIHRoZSB0cmltZXNoLgogICAgICogQHBhcmFtIHJlc3VsdCBBbiBhcnJheSBvZiBpbnRlZ2VycywgcmVmZXJlbmNpbmcgdGhlIHF1ZXJpZWQgdHJpYW5nbGVzLgogICAgICovCgoKICAgIGdldFRyaWFuZ2xlc0luQUFCQihhYWJiLCByZXN1bHQpIHsKICAgICAgdW5zY2FsZWRBQUJCLmNvcHkoYWFiYik7IC8vIFNjYWxlIGl0IHRvIGxvY2FsCgogICAgICBjb25zdCBzY2FsZSA9IHRoaXMuc2NhbGU7CiAgICAgIGNvbnN0IGlzeCA9IHNjYWxlLng7CiAgICAgIGNvbnN0IGlzeSA9IHNjYWxlLnk7CiAgICAgIGNvbnN0IGlzeiA9IHNjYWxlLno7CiAgICAgIGNvbnN0IGwgPSB1bnNjYWxlZEFBQkIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IHVuc2NhbGVkQUFCQi51cHBlckJvdW5kOwogICAgICBsLnggLz0gaXN4OwogICAgICBsLnkgLz0gaXN5OwogICAgICBsLnogLz0gaXN6OwogICAgICB1LnggLz0gaXN4OwogICAgICB1LnkgLz0gaXN5OwogICAgICB1LnogLz0gaXN6OwogICAgICByZXR1cm4gdGhpcy50cmVlLmFhYmJRdWVyeSh1bnNjYWxlZEFBQkIsIHJlc3VsdCk7CiAgICB9CiAgICAvKioKICAgICAqIHNldFNjYWxlCiAgICAgKi8KCgogICAgc2V0U2NhbGUoc2NhbGUpIHsKICAgICAgY29uc3Qgd2FzVW5pZm9ybSA9IHRoaXMuc2NhbGUueCA9PT0gdGhpcy5zY2FsZS55ICYmIHRoaXMuc2NhbGUueSA9PT0gdGhpcy5zY2FsZS56OwogICAgICBjb25zdCBpc1VuaWZvcm0gPSBzY2FsZS54ID09PSBzY2FsZS55ICYmIHNjYWxlLnkgPT09IHNjYWxlLno7CgogICAgICBpZiAoISh3YXNVbmlmb3JtICYmIGlzVW5pZm9ybSkpIHsKICAgICAgICAvLyBOb24tdW5pZm9ybSBzY2FsaW5nLiBOZWVkIHRvIHVwZGF0ZSBub3JtYWxzLgogICAgICAgIHRoaXMudXBkYXRlTm9ybWFscygpOwogICAgICB9CgogICAgICB0aGlzLnNjYWxlLmNvcHkoc2NhbGUpOwogICAgICB0aGlzLnVwZGF0ZUFBQkIoKTsKICAgICAgdGhpcy51cGRhdGVCb3VuZGluZ1NwaGVyZVJhZGl1cygpOwogICAgfQogICAgLyoqCiAgICAgKiBDb21wdXRlIHRoZSBub3JtYWxzIG9mIHRoZSBmYWNlcy4gV2lsbCBzYXZlIGluIHRoZSBgLm5vcm1hbHNgIGFycmF5LgogICAgICovCgoKICAgIHVwZGF0ZU5vcm1hbHMoKSB7CiAgICAgIGNvbnN0IG4gPSBjb21wdXRlTm9ybWFsc19uOyAvLyBHZW5lcmF0ZSBub3JtYWxzCgogICAgICBjb25zdCBub3JtYWxzID0gdGhpcy5ub3JtYWxzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIHRoaXMuZ2V0VmVydGV4KGEsIHZhKTsKICAgICAgICB0aGlzLmdldFZlcnRleChiLCB2Yik7CiAgICAgICAgdGhpcy5nZXRWZXJ0ZXgoYywgdmMpOwogICAgICAgIFRyaW1lc2guY29tcHV0ZU5vcm1hbCh2YiwgdmEsIHZjLCBuKTsKICAgICAgICBub3JtYWxzW2kzXSA9IG4ueDsKICAgICAgICBub3JtYWxzW2kzICsgMV0gPSBuLnk7CiAgICAgICAgbm9ybWFsc1tpMyArIDJdID0gbi56OwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIFVwZGF0ZSB0aGUgYC5lZGdlc2AgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVFZGdlcygpIHsKICAgICAgY29uc3QgZWRnZXMgPSB7fTsKCiAgICAgIGNvbnN0IGFkZCA9IChhLCBiKSA9PiB7CiAgICAgICAgY29uc3Qga2V5ID0gYSA8IGIgPyBgJHthfV8ke2J9YCA6IGAke2J9XyR7YX1gOwogICAgICAgIGVkZ2VzW2tleV0gPSB0cnVlOwogICAgICB9OwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgY29uc3QgaTMgPSBpICogMzsKICAgICAgICBjb25zdCBhID0gdGhpcy5pbmRpY2VzW2kzXTsKICAgICAgICBjb25zdCBiID0gdGhpcy5pbmRpY2VzW2kzICsgMV07CiAgICAgICAgY29uc3QgYyA9IHRoaXMuaW5kaWNlc1tpMyArIDJdOwogICAgICAgIGFkZChhLCBiKTsKICAgICAgICBhZGQoYiwgYyk7CiAgICAgICAgYWRkKGMsIGEpOwogICAgICB9CgogICAgICBjb25zdCBrZXlzID0gT2JqZWN0LmtleXMoZWRnZXMpOwogICAgICB0aGlzLmVkZ2VzID0gbmV3IEludDE2QXJyYXkoa2V5cy5sZW5ndGggKiAyKTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5cy5sZW5ndGg7IGkrKykgewogICAgICAgIGNvbnN0IGluZGljZXMgPSBrZXlzW2ldLnNwbGl0KCdfJyk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaV0gPSBwYXJzZUludChpbmRpY2VzWzBdLCAxMCk7CiAgICAgICAgdGhpcy5lZGdlc1syICogaSArIDFdID0gcGFyc2VJbnQoaW5kaWNlc1sxXSwgMTApOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhbiBlZGdlIHZlcnRleAogICAgICogQHBhcmFtIGZpcnN0T3JTZWNvbmQgMCBvciAxLCBkZXBlbmRpbmcgb24gd2hpY2ggb25lIG9mIHRoZSB2ZXJ0aWNlcyB5b3UgbmVlZC4KICAgICAqIEBwYXJhbSB2ZXJ0ZXhTdG9yZSBXaGVyZSB0byBzdG9yZSB0aGUgcmVzdWx0CiAgICAgKi8KCgogICAgZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIGZpcnN0T3JTZWNvbmQsIHZlcnRleFN0b3JlKSB7CiAgICAgIGNvbnN0IHZlcnRleEluZGV4ID0gdGhpcy5lZGdlc1tlZGdlSW5kZXggKiAyICsgKGZpcnN0T3JTZWNvbmQgPyAxIDogMCldOwogICAgICB0aGlzLmdldFZlcnRleCh2ZXJ0ZXhJbmRleCwgdmVydGV4U3RvcmUpOwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgYSB2ZWN0b3IgYWxvbmcgYW4gZWRnZS4KICAgICAqLwoKCiAgICBnZXRFZGdlVmVjdG9yKGVkZ2VJbmRleCwgdmVjdG9yU3RvcmUpIHsKICAgICAgY29uc3QgdmEgPSBnZXRFZGdlVmVjdG9yX3ZhOwogICAgICBjb25zdCB2YiA9IGdldEVkZ2VWZWN0b3JfdmI7CiAgICAgIHRoaXMuZ2V0RWRnZVZlcnRleChlZGdlSW5kZXgsIDAsIHZhKTsKICAgICAgdGhpcy5nZXRFZGdlVmVydGV4KGVkZ2VJbmRleCwgMSwgdmIpOwogICAgICB2Yi52c3ViKHZhLCB2ZWN0b3JTdG9yZSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBmYWNlIG5vcm1hbCBnaXZlbiAzIHZlcnRpY2VzCiAgICAgKi8KCgogICAgc3RhdGljIGNvbXB1dGVOb3JtYWwodmEsIHZiLCB2YywgdGFyZ2V0KSB7CiAgICAgIHZiLnZzdWIodmEsIGFiKTsKICAgICAgdmMudnN1Yih2YiwgY2IpOwogICAgICBjYi5jcm9zcyhhYiwgdGFyZ2V0KTsKCiAgICAgIGlmICghdGFyZ2V0LmlzWmVybygpKSB7CiAgICAgICAgdGFyZ2V0Lm5vcm1hbGl6ZSgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIEdldCB2ZXJ0ZXggaS4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRWZXJ0ZXgoaSwgb3V0KSB7CiAgICAgIGNvbnN0IHNjYWxlID0gdGhpcy5zY2FsZTsKCiAgICAgIHRoaXMuX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCk7CgogICAgICBvdXQueCAqPSBzY2FsZS54OwogICAgICBvdXQueSAqPSBzY2FsZS55OwogICAgICBvdXQueiAqPSBzY2FsZS56OwogICAgICByZXR1cm4gb3V0OwogICAgfQogICAgLyoqCiAgICAgKiBHZXQgcmF3IHZlcnRleCBpCiAgICAgKiBAcmV0dXJuIFRoZSAib3V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgX2dldFVuc2NhbGVkVmVydGV4KGksIG91dCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIHJldHVybiBvdXQuc2V0KHZlcnRpY2VzW2kzXSwgdmVydGljZXNbaTMgKyAxXSwgdmVydGljZXNbaTMgKyAyXSk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhIHZlcnRleCBmcm9tIHRoZSB0cmltZXNoLHRyYW5zZm9ybWVkIGJ5IHRoZSBnaXZlbiBwb3NpdGlvbiBhbmQgcXVhdGVybmlvbi4KICAgICAqIEByZXR1cm4gVGhlICJvdXQiIHZlY3RvciBvYmplY3QKICAgICAqLwoKCiAgICBnZXRXb3JsZFZlcnRleChpLCBwb3MsIHF1YXQsIG91dCkgewogICAgICB0aGlzLmdldFZlcnRleChpLCBvdXQpOwogICAgICBUcmFuc2Zvcm0ucG9pbnRUb1dvcmxkRnJhbWUocG9zLCBxdWF0LCBvdXQsIG91dCk7CiAgICAgIHJldHVybiBvdXQ7CiAgICB9CiAgICAvKioKICAgICAqIEdldCB0aGUgdGhyZWUgdmVydGljZXMgZm9yIHRyaWFuZ2xlIGkuCiAgICAgKi8KCgogICAgZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCBhLCBiLCBjKSB7CiAgICAgIGNvbnN0IGkzID0gaSAqIDM7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpM10sIGEpOwogICAgICB0aGlzLmdldFZlcnRleCh0aGlzLmluZGljZXNbaTMgKyAxXSwgYik7CiAgICAgIHRoaXMuZ2V0VmVydGV4KHRoaXMuaW5kaWNlc1tpMyArIDJdLCBjKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbm9ybWFsIG9mIHRyaWFuZ2xlIGkuCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgZ2V0Tm9ybWFsKGksIHRhcmdldCkgewogICAgICBjb25zdCBpMyA9IGkgKiAzOwogICAgICByZXR1cm4gdGFyZ2V0LnNldCh0aGlzLm5vcm1hbHNbaTNdLCB0aGlzLm5vcm1hbHNbaTMgKyAxXSwgdGhpcy5ub3JtYWxzW2kzICsgMl0pOwogICAgfQogICAgLyoqCiAgICAgKiBAcmV0dXJuIFRoZSAidGFyZ2V0IiB2ZWN0b3Igb2JqZWN0CiAgICAgKi8KCgogICAgY2FsY3VsYXRlTG9jYWxJbmVydGlhKG1hc3MsIHRhcmdldCkgewogICAgICAvLyBBcHByb3hpbWF0ZSB3aXRoIGJveCBpbmVydGlhCiAgICAgIC8vIEV4YWN0IGluZXJ0aWEgY2FsY3VsYXRpb24gaXMgb3ZlcmtpbGwsIGJ1dCBzZWUgaHR0cDovL2dlb21ldHJpY3Rvb2xzLmNvbS9Eb2N1bWVudGF0aW9uL1BvbHloZWRyYWxNYXNzUHJvcGVydGllcy5wZGYgZm9yIHRoZSBjb3JyZWN0IHdheSB0byBkbyBpdAogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIoY2xpX2FhYmIpOwogICAgICBjb25zdCB4ID0gY2xpX2FhYmIudXBwZXJCb3VuZC54IC0gY2xpX2FhYmIubG93ZXJCb3VuZC54OwogICAgICBjb25zdCB5ID0gY2xpX2FhYmIudXBwZXJCb3VuZC55IC0gY2xpX2FhYmIubG93ZXJCb3VuZC55OwogICAgICBjb25zdCB6ID0gY2xpX2FhYmIudXBwZXJCb3VuZC56IC0gY2xpX2FhYmIubG93ZXJCb3VuZC56OwogICAgICByZXR1cm4gdGFyZ2V0LnNldCgxLjAgLyAxMi4wICogbWFzcyAqICgyICogeSAqIDIgKiB5ICsgMiAqIHogKiAyICogeiksIDEuMCAvIDEyLjAgKiBtYXNzICogKDIgKiB4ICogMiAqIHggKyAyICogeiAqIDIgKiB6KSwgMS4wIC8gMTIuMCAqIG1hc3MgKiAoMiAqIHkgKiAyICogeSArIDIgKiB4ICogMiAqIHgpKTsKICAgIH0KICAgIC8qKgogICAgICogQ29tcHV0ZSB0aGUgbG9jYWwgQUFCQiBmb3IgdGhlIHRyaW1lc2gKICAgICAqLwoKCiAgICBjb21wdXRlTG9jYWxBQUJCKGFhYmIpIHsKICAgICAgY29uc3QgbCA9IGFhYmIubG93ZXJCb3VuZDsKICAgICAgY29uc3QgdSA9IGFhYmIudXBwZXJCb3VuZDsKICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoOwogICAgICB0aGlzLnZlcnRpY2VzOwogICAgICBjb25zdCB2ID0gY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQ7CiAgICAgIHRoaXMuZ2V0VmVydGV4KDAsIHYpOwogICAgICBsLmNvcHkodik7CiAgICAgIHUuY29weSh2KTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBuOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKCiAgICAgICAgaWYgKHYueCA8IGwueCkgewogICAgICAgICAgbC54ID0gdi54OwogICAgICAgIH0gZWxzZSBpZiAodi54ID4gdS54KSB7CiAgICAgICAgICB1LnggPSB2Lng7CiAgICAgICAgfQoKICAgICAgICBpZiAodi55IDwgbC55KSB7CiAgICAgICAgICBsLnkgPSB2Lnk7CiAgICAgICAgfSBlbHNlIGlmICh2LnkgPiB1LnkpIHsKICAgICAgICAgIHUueSA9IHYueTsKICAgICAgICB9CgogICAgICAgIGlmICh2LnogPCBsLnopIHsKICAgICAgICAgIGwueiA9IHYuejsKICAgICAgICB9IGVsc2UgaWYgKHYueiA+IHUueikgewogICAgICAgICAgdS56ID0gdi56OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBVcGRhdGUgdGhlIGAuYWFiYmAgcHJvcGVydHkKICAgICAqLwoKCiAgICB1cGRhdGVBQUJCKCkgewogICAgICB0aGlzLmNvbXB1dGVMb2NhbEFBQkIodGhpcy5hYWJiKTsKICAgIH0KICAgIC8qKgogICAgICogV2lsbCB1cGRhdGUgdGhlIGAuYm91bmRpbmdTcGhlcmVSYWRpdXNgIHByb3BlcnR5CiAgICAgKi8KCgogICAgdXBkYXRlQm91bmRpbmdTcGhlcmVSYWRpdXMoKSB7CiAgICAgIC8vIEFzc3VtZSBwb2ludHMgYXJlIGRpc3RyaWJ1dGVkIHdpdGggbG9jYWwgKDAsMCwwKSBhcyBjZW50ZXIKICAgICAgbGV0IG1heDIgPSAwOwogICAgICBjb25zdCB2ZXJ0aWNlcyA9IHRoaXMudmVydGljZXM7CiAgICAgIGNvbnN0IHYgPSBuZXcgVmVjMygpOwoKICAgICAgZm9yIChsZXQgaSA9IDAsIE4gPSB2ZXJ0aWNlcy5sZW5ndGggLyAzOyBpICE9PSBOOyBpKyspIHsKICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICBjb25zdCBub3JtMiA9IHYubGVuZ3RoU3F1YXJlZCgpOwoKICAgICAgICBpZiAobm9ybTIgPiBtYXgyKSB7CiAgICAgICAgICBtYXgyID0gbm9ybTI7CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmJvdW5kaW5nU3BoZXJlUmFkaXVzID0gTWF0aC5zcXJ0KG1heDIpOwogICAgfQogICAgLyoqCiAgICAgKiBjYWxjdWxhdGVXb3JsZEFBQkIKICAgICAqLwoKCiAgICBjYWxjdWxhdGVXb3JsZEFBQkIocG9zLCBxdWF0LCBtaW4sIG1heCkgewogICAgICAvKgogICAgICAgICAgY29uc3QgbiA9IHRoaXMudmVydGljZXMubGVuZ3RoIC8gMywKICAgICAgICAgICAgICB2ZXJ0cyA9IHRoaXMudmVydGljZXM7CiAgICAgICAgICBjb25zdCBtaW54LG1pbnksbWlueixtYXh4LG1heHksbWF4ejsKICAgICAgICAgICBjb25zdCB2ID0gdGVtcFdvcmxkVmVydGV4OwogICAgICAgICAgZm9yKGxldCBpPTA7IGk8bjsgaSsrKXsKICAgICAgICAgICAgICB0aGlzLmdldFZlcnRleChpLCB2KTsKICAgICAgICAgICAgICBxdWF0LnZtdWx0KHYsIHYpOwogICAgICAgICAgICAgIHBvcy52YWRkKHYsIHYpOwogICAgICAgICAgICAgIGlmICh2LnggPCBtaW54IHx8IG1pbng9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtaW54ID0gdi54OwogICAgICAgICAgICAgIH0gZWxzZSBpZih2LnggPiBtYXh4IHx8IG1heHg9PT11bmRlZmluZWQpewogICAgICAgICAgICAgICAgICBtYXh4ID0gdi54OwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgaWYgKHYueSA8IG1pbnkgfHwgbWlueT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1pbnkgPSB2Lnk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmKHYueSA+IG1heHkgfHwgbWF4eT09PXVuZGVmaW5lZCl7CiAgICAgICAgICAgICAgICAgIG1heHkgPSB2Lnk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICBpZiAodi56IDwgbWlueiB8fCBtaW56PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWlueiA9IHYuejsKICAgICAgICAgICAgICB9IGVsc2UgaWYodi56ID4gbWF4eiB8fCBtYXh6PT09dW5kZWZpbmVkKXsKICAgICAgICAgICAgICAgICAgbWF4eiA9IHYuejsKICAgICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgICBtaW4uc2V0KG1pbngsbWlueSxtaW56KTsKICAgICAgICAgIG1heC5zZXQobWF4eCxtYXh5LG1heHopOwogICAgICAgICAgKi8KICAgICAgLy8gRmFzdGVyIGFwcHJveGltYXRpb24gdXNpbmcgbG9jYWwgQUFCQgogICAgICBjb25zdCBmcmFtZSA9IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZTsKICAgICAgY29uc3QgcmVzdWx0ID0gY2FsY3VsYXRlV29ybGRBQUJCX2FhYmI7CiAgICAgIGZyYW1lLnBvc2l0aW9uID0gcG9zOwogICAgICBmcmFtZS5xdWF0ZXJuaW9uID0gcXVhdDsKICAgICAgdGhpcy5hYWJiLnRvV29ybGRGcmFtZShmcmFtZSwgcmVzdWx0KTsKICAgICAgbWluLmNvcHkocmVzdWx0Lmxvd2VyQm91bmQpOwogICAgICBtYXguY29weShyZXN1bHQudXBwZXJCb3VuZCk7CiAgICB9CiAgICAvKioKICAgICAqIEdldCBhcHByb3hpbWF0ZSB2b2x1bWUKICAgICAqLwoKCiAgICB2b2x1bWUoKSB7CiAgICAgIHJldHVybiA0LjAgKiBNYXRoLlBJICogdGhpcy5ib3VuZGluZ1NwaGVyZVJhZGl1cyAvIDMuMDsKICAgIH0KICAgIC8qKgogICAgICogQ3JlYXRlIGEgVHJpbWVzaCBpbnN0YW5jZSwgc2hhcGVkIGFzIGEgdG9ydXMuCiAgICAgKi8KCgogICAgc3RhdGljIGNyZWF0ZVRvcnVzKHJhZGl1cywgdHViZSwgcmFkaWFsU2VnbWVudHMsIHR1YnVsYXJTZWdtZW50cywgYXJjKSB7CiAgICAgIGlmIChyYWRpdXMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGl1cyA9IDE7CiAgICAgIH0KCiAgICAgIGlmICh0dWJlID09PSB2b2lkIDApIHsKICAgICAgICB0dWJlID0gMC41OwogICAgICB9CgogICAgICBpZiAocmFkaWFsU2VnbWVudHMgPT09IHZvaWQgMCkgewogICAgICAgIHJhZGlhbFNlZ21lbnRzID0gODsKICAgICAgfQoKICAgICAgaWYgKHR1YnVsYXJTZWdtZW50cyA9PT0gdm9pZCAwKSB7CiAgICAgICAgdHVidWxhclNlZ21lbnRzID0gNjsKICAgICAgfQoKICAgICAgaWYgKGFyYyA9PT0gdm9pZCAwKSB7CiAgICAgICAgYXJjID0gTWF0aC5QSSAqIDI7CiAgICAgIH0KCiAgICAgIGNvbnN0IHZlcnRpY2VzID0gW107CiAgICAgIGNvbnN0IGluZGljZXMgPSBbXTsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkrKykgewogICAgICAgICAgY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBhcmM7CiAgICAgICAgICBjb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CiAgICAgICAgICBjb25zdCB4ID0gKHJhZGl1cyArIHR1YmUgKiBNYXRoLmNvcyh2KSkgKiBNYXRoLmNvcyh1KTsKICAgICAgICAgIGNvbnN0IHkgPSAocmFkaXVzICsgdHViZSAqIE1hdGguY29zKHYpKSAqIE1hdGguc2luKHUpOwogICAgICAgICAgY29uc3QgeiA9IHR1YmUgKiBNYXRoLnNpbih2KTsKICAgICAgICAgIHZlcnRpY2VzLnB1c2goeCwgeSwgeik7CiAgICAgICAgfQogICAgICB9CgogICAgICBmb3IgKGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpKyspIHsKICAgICAgICAgIGNvbnN0IGEgPSAodHVidWxhclNlZ21lbnRzICsgMSkgKiBqICsgaSAtIDE7CiAgICAgICAgICBjb25zdCBiID0gKHR1YnVsYXJTZWdtZW50cyArIDEpICogKGogLSAxKSArIGkgLSAxOwogICAgICAgICAgY29uc3QgYyA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIChqIC0gMSkgKyBpOwogICAgICAgICAgY29uc3QgZCA9ICh0dWJ1bGFyU2VnbWVudHMgKyAxKSAqIGogKyBpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGEsIGIsIGQpOwogICAgICAgICAgaW5kaWNlcy5wdXNoKGIsIGMsIGQpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKHZlcnRpY2VzLCBpbmRpY2VzKTsKICAgIH0KCiAgfQogIGNvbnN0IGNvbXB1dGVOb3JtYWxzX24gPSBuZXcgVmVjMygpOwogIGNvbnN0IHVuc2NhbGVkQUFCQiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgZ2V0RWRnZVZlY3Rvcl92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY2IgPSBuZXcgVmVjMygpOwogIGNvbnN0IGFiID0gbmV3IFZlYzMoKTsKICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdmIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHZjID0gbmV3IFZlYzMoKTsKICBjb25zdCBjbGlfYWFiYiA9IG5ldyBBQUJCKCk7CiAgY29uc3QgY29tcHV0ZUxvY2FsQUFCQl93b3JsZFZlcnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNhbGN1bGF0ZVdvcmxkQUFCQl9mcmFtZSA9IG5ldyBUcmFuc2Zvcm0oKTsKICBjb25zdCBjYWxjdWxhdGVXb3JsZEFBQkJfYWFiYiA9IG5ldyBBQUJCKCk7CgogIC8qKgogICAqIENvbnN0cmFpbnQgZXF1YXRpb24gc29sdmVyIGJhc2UgY2xhc3MuCiAgICovCiAgY2xhc3MgU29sdmVyIHsKICAgIC8qKgogICAgICogQWxsIGVxdWF0aW9ucyB0byBiZSBzb2x2ZWQKICAgICAqLwoKICAgIC8qKgogICAgICogQHRvZG8gcmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zID0gW107CiAgICB9CiAgICAvKioKICAgICAqIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBzdWJjbGFzc2VzIQogICAgICogQHRvZG8gdXNlIGFic3RyYWN0CiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICByZXR1cm4gKC8vIFNob3VsZCByZXR1cm4gdGhlIG51bWJlciBvZiBpdGVyYXRpb25zIGRvbmUhCiAgICAgICAgMAogICAgICApOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICBhZGRFcXVhdGlvbihlcSkgewogICAgICBpZiAoZXEuZW5hYmxlZCAmJiAhZXEuYmkuaXNUcmlnZ2VyICYmICFlcS5iai5pc1RyaWdnZXIpIHsKICAgICAgICB0aGlzLmVxdWF0aW9ucy5wdXNoKGVxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSZW1vdmUgYW4gZXF1YXRpb24KICAgICAqLwoKCiAgICByZW1vdmVFcXVhdGlvbihlcSkgewogICAgICBjb25zdCBlcXMgPSB0aGlzLmVxdWF0aW9uczsKICAgICAgY29uc3QgaSA9IGVxcy5pbmRleE9mKGVxKTsKCiAgICAgIGlmIChpICE9PSAtMSkgewogICAgICAgIGVxcy5zcGxpY2UoaSwgMSk7CiAgICAgIH0KICAgIH0KICAgIC8qKgogICAgICogQWRkIGFsbCBlcXVhdGlvbnMKICAgICAqLwoKCiAgICByZW1vdmVBbGxFcXVhdGlvbnMoKSB7CiAgICAgIHRoaXMuZXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICB9CgogIH0KCiAgLyoqCiAgICogQ29uc3RyYWludCBlcXVhdGlvbiBHYXVzcy1TZWlkZWwgc29sdmVyLgogICAqIEB0b2RvIFRoZSBzcG9vayBwYXJhbWV0ZXJzIHNob3VsZCBiZSBzcGVjaWZpZWQgZm9yIGVhY2ggY29uc3RyYWludCwgbm90IGdsb2JhbGx5LgogICAqIEBzZWUgaHR0cHM6Ly93d3c4LmNzLnVtdS5zZS9rdXJzZXIvNURWMDU4L1ZUMDkvbGVjdHVyZXMvc3Bvb2tub3Rlcy5wZGYKICAgKi8KICBjbGFzcyBHU1NvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuCiAgICAgKiBUaGUgbW9yZSBpdGVyYXRpb25zLCB0aGUgbW9yZSBjb3JyZWN0IHNpbXVsYXRpb24uIE1vcmUgaXRlcmF0aW9ucyBuZWVkIG1vcmUgY29tcHV0YXRpb25zIHRob3VnaC4gSWYgeW91IGhhdmUgYSBsYXJnZSBncmF2aXR5IGZvcmNlIGluIHlvdXIgd29ybGQsIHlvdSB3aWxsIG5lZWQgbW9yZSBpdGVyYXRpb25zLgogICAgICovCgogICAgLyoqCiAgICAgKiBXaGVuIHRvbGVyYW5jZSBpcyByZWFjaGVkLCB0aGUgc3lzdGVtIGlzIGFzc3VtZWQgdG8gYmUgY29udmVyZ2VkLgogICAgICovCgogICAgLyoqCiAgICAgKiBAdG9kbyByZW1vdmUgdXNlbGVzcyBjb25zdHJ1Y3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgIH0KICAgIC8qKgogICAgICogU29sdmUKICAgICAqIEByZXR1cm4gbnVtYmVyIG9mIGl0ZXJhdGlvbnMgcGVyZm9ybWVkCiAgICAgKi8KCgogICAgc29sdmUoZHQsIHdvcmxkKSB7CiAgICAgIGxldCBpdGVyID0gMDsKICAgICAgY29uc3QgbWF4SXRlciA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgdG9sU3F1YXJlZCA9IHRoaXMudG9sZXJhbmNlICogdGhpcy50b2xlcmFuY2U7CiAgICAgIGNvbnN0IGVxdWF0aW9ucyA9IHRoaXMuZXF1YXRpb25zOwogICAgICBjb25zdCBOZXEgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB3b3JsZC5ib2RpZXM7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBoID0gZHQ7CiAgICAgIGxldCBCOwogICAgICBsZXQgaW52QzsKICAgICAgbGV0IGRlbHRhbGFtYmRhOwogICAgICBsZXQgZGVsdGFsYW1iZGFUb3Q7CiAgICAgIGxldCBHV2xhbWJkYTsKICAgICAgbGV0IGxhbWJkYWo7IC8vIFVwZGF0ZSBzb2x2ZSBtYXNzCgogICAgICBpZiAoTmVxICE9PSAwKSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5ib2RpZXM7IGkrKykgewogICAgICAgICAgYm9kaWVzW2ldLnVwZGF0ZVNvbHZlTWFzc1Byb3BlcnRpZXMoKTsKICAgICAgICB9CiAgICAgIH0gLy8gVGhpbmdzIHRoYXQgZG8gbm90IGNoYW5nZSBkdXJpbmcgaXRlcmF0aW9uIGNhbiBiZSBjb21wdXRlZCBvbmNlCgoKICAgICAgY29uc3QgaW52Q3MgPSBHU1NvbHZlcl9zb2x2ZV9pbnZDczsKICAgICAgY29uc3QgQnMgPSBHU1NvbHZlcl9zb2x2ZV9CczsKICAgICAgY29uc3QgbGFtYmRhID0gR1NTb2x2ZXJfc29sdmVfbGFtYmRhOwogICAgICBpbnZDcy5sZW5ndGggPSBOZXE7CiAgICAgIEJzLmxlbmd0aCA9IE5lcTsKICAgICAgbGFtYmRhLmxlbmd0aCA9IE5lcTsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBOZXE7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBlcXVhdGlvbnNbaV07CiAgICAgICAgbGFtYmRhW2ldID0gMC4wOwogICAgICAgIEJzW2ldID0gYy5jb21wdXRlQihoKTsKICAgICAgICBpbnZDc1tpXSA9IDEuMCAvIGMuY29tcHV0ZUMoKTsKICAgICAgfQoKICAgICAgaWYgKE5lcSAhPT0gMCkgewogICAgICAgIC8vIFJlc2V0IHZsYW1iZGEKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdmxhbWJkYSA9IGIudmxhbWJkYTsKICAgICAgICAgIGNvbnN0IHdsYW1iZGEgPSBiLndsYW1iZGE7CiAgICAgICAgICB2bGFtYmRhLnNldCgwLCAwLCAwKTsKICAgICAgICAgIHdsYW1iZGEuc2V0KDAsIDAsIDApOwogICAgICAgIH0gLy8gSXRlcmF0ZSBvdmVyIGVxdWF0aW9ucwoKCiAgICAgICAgZm9yIChpdGVyID0gMDsgaXRlciAhPT0gbWF4SXRlcjsgaXRlcisrKSB7CiAgICAgICAgICAvLyBBY2N1bXVsYXRlIHRoZSB0b3RhbCBlcnJvciBmb3IgZWFjaCBpdGVyYXRpb24uCiAgICAgICAgICBkZWx0YWxhbWJkYVRvdCA9IDAuMDsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gTmVxOyBqKyspIHsKICAgICAgICAgICAgY29uc3QgYyA9IGVxdWF0aW9uc1tqXTsgLy8gQ29tcHV0ZSBpdGVyYXRpb24KCiAgICAgICAgICAgIEIgPSBCc1tqXTsKICAgICAgICAgICAgaW52QyA9IGludkNzW2pdOwogICAgICAgICAgICBsYW1iZGFqID0gbGFtYmRhW2pdOwogICAgICAgICAgICBHV2xhbWJkYSA9IGMuY29tcHV0ZUdXbGFtYmRhKCk7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhID0gaW52QyAqIChCIC0gR1dsYW1iZGEgLSBjLmVwcyAqIGxhbWJkYWopOyAvLyBDbGFtcCBpZiB3ZSBhcmUgbm90IHdpdGhpbiB0aGUgbWluL21heCBpbnRlcnZhbAoKICAgICAgICAgICAgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA8IGMubWluRm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWluRm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9IGVsc2UgaWYgKGxhbWJkYWogKyBkZWx0YWxhbWJkYSA+IGMubWF4Rm9yY2UpIHsKICAgICAgICAgICAgICBkZWx0YWxhbWJkYSA9IGMubWF4Rm9yY2UgLSBsYW1iZGFqOwogICAgICAgICAgICB9CgogICAgICAgICAgICBsYW1iZGFbal0gKz0gZGVsdGFsYW1iZGE7CiAgICAgICAgICAgIGRlbHRhbGFtYmRhVG90ICs9IGRlbHRhbGFtYmRhID4gMC4wID8gZGVsdGFsYW1iZGEgOiAtZGVsdGFsYW1iZGE7IC8vIGFicyhkZWx0YWxhbWJkYSkKCiAgICAgICAgICAgIGMuYWRkVG9XbGFtYmRhKGRlbHRhbGFtYmRhKTsKICAgICAgICAgIH0gLy8gSWYgdGhlIHRvdGFsIGVycm9yIGlzIHNtYWxsIGVub3VnaCAtIHN0b3AgaXRlcmF0ZQoKCiAgICAgICAgICBpZiAoZGVsdGFsYW1iZGFUb3QgKiBkZWx0YWxhbWJkYVRvdCA8IHRvbFNxdWFyZWQpIHsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBBZGQgcmVzdWx0IHRvIHZlbG9jaXR5CgoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiID0gYm9kaWVzW2ldOwogICAgICAgICAgY29uc3QgdiA9IGIudmVsb2NpdHk7CiAgICAgICAgICBjb25zdCB3ID0gYi5hbmd1bGFyVmVsb2NpdHk7CiAgICAgICAgICBiLnZsYW1iZGEudm11bChiLmxpbmVhckZhY3RvciwgYi52bGFtYmRhKTsKICAgICAgICAgIHYudmFkZChiLnZsYW1iZGEsIHYpOwogICAgICAgICAgYi53bGFtYmRhLnZtdWwoYi5hbmd1bGFyRmFjdG9yLCBiLndsYW1iZGEpOwogICAgICAgICAgdy52YWRkKGIud2xhbWJkYSwgdyk7CiAgICAgICAgfSAvLyBTZXQgdGhlIGAubXVsdGlwbGllcmAgcHJvcGVydHkgb2YgZWFjaCBlcXVhdGlvbgoKCiAgICAgICAgbGV0IGwgPSBlcXVhdGlvbnMubGVuZ3RoOwogICAgICAgIGNvbnN0IGludkR0ID0gMSAvIGg7CgogICAgICAgIHdoaWxlIChsLS0pIHsKICAgICAgICAgIGVxdWF0aW9uc1tsXS5tdWx0aXBsaWVyID0gbGFtYmRhW2xdICogaW52RHQ7CiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gaXRlcjsKICAgIH0KCiAgfSAvLyBKdXN0IHRlbXBvcmFyeSBudW1iZXIgaG9sZGVycyB0aGF0IHdlIHdhbnQgdG8gcmV1c2UgZWFjaCBpdGVyYXRpb24uCgogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2xhbWJkYSA9IFtdOwogIGNvbnN0IEdTU29sdmVyX3NvbHZlX2ludkNzID0gW107CiAgY29uc3QgR1NTb2x2ZXJfc29sdmVfQnMgPSBbXTsKCiAgLyoqCiAgICogU3BsaXRzIHRoZSBlcXVhdGlvbnMgaW50byBpc2xhbmRzIGFuZCBzb2x2ZXMgdGhlbSBpbmRlcGVuZGVudGx5LiBDYW4gaW1wcm92ZSBwZXJmb3JtYW5jZS4KICAgKi8KICBjbGFzcyBTcGxpdFNvbHZlciBleHRlbmRzIFNvbHZlciB7CiAgICAvKioKICAgICAqIFRoZSBudW1iZXIgb2Ygc29sdmVyIGl0ZXJhdGlvbnMgZGV0ZXJtaW5lcyBxdWFsaXR5IG9mIHRoZSBjb25zdHJhaW50cyBpbiB0aGUgd29ybGQuIFRoZSBtb3JlIGl0ZXJhdGlvbnMsIHRoZSBtb3JlIGNvcnJlY3Qgc2ltdWxhdGlvbi4gTW9yZSBpdGVyYXRpb25zIG5lZWQgbW9yZSBjb21wdXRhdGlvbnMgdGhvdWdoLiBJZiB5b3UgaGF2ZSBhIGxhcmdlIGdyYXZpdHkgZm9yY2UgaW4geW91ciB3b3JsZCwgeW91IHdpbGwgbmVlZCBtb3JlIGl0ZXJhdGlvbnMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFdoZW4gdG9sZXJhbmNlIGlzIHJlYWNoZWQsIHRoZSBzeXN0ZW0gaXMgYXNzdW1lZCB0byBiZSBjb252ZXJnZWQuCiAgICAgKi8KCiAgICAvKiogc3Vic29sdmVyICovCiAgICBjb25zdHJ1Y3RvcihzdWJzb2x2ZXIpIHsKICAgICAgc3VwZXIoKTsKICAgICAgdGhpcy5pdGVyYXRpb25zID0gMTA7CiAgICAgIHRoaXMudG9sZXJhbmNlID0gMWUtNzsKICAgICAgdGhpcy5zdWJzb2x2ZXIgPSBzdWJzb2x2ZXI7CiAgICAgIHRoaXMubm9kZXMgPSBbXTsKICAgICAgdGhpcy5ub2RlUG9vbCA9IFtdOyAvLyBDcmVhdGUgbmVlZGVkIG5vZGVzLCByZXVzZSBpZiBwb3NzaWJsZQoKICAgICAgd2hpbGUgKHRoaXMubm9kZVBvb2wubGVuZ3RoIDwgMTI4KSB7CiAgICAgICAgdGhpcy5ub2RlUG9vbC5wdXNoKHRoaXMuY3JlYXRlTm9kZSgpKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBjcmVhdGVOb2RlCiAgICAgKi8KCgogICAgY3JlYXRlTm9kZSgpIHsKICAgICAgcmV0dXJuIHsKICAgICAgICBib2R5OiBudWxsLAogICAgICAgIGNoaWxkcmVuOiBbXSwKICAgICAgICBlcXM6IFtdLAogICAgICAgIHZpc2l0ZWQ6IGZhbHNlCiAgICAgIH07CiAgICB9CiAgICAvKioKICAgICAqIFNvbHZlIHRoZSBzdWJzeXN0ZW1zCiAgICAgKiBAcmV0dXJuIG51bWJlciBvZiBpdGVyYXRpb25zIHBlcmZvcm1lZAogICAgICovCgoKICAgIHNvbHZlKGR0LCB3b3JsZCkgewogICAgICBjb25zdCBub2RlcyA9IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzOwogICAgICBjb25zdCBub2RlUG9vbCA9IHRoaXMubm9kZVBvb2w7CiAgICAgIGNvbnN0IGJvZGllcyA9IHdvcmxkLmJvZGllczsKICAgICAgY29uc3QgZXF1YXRpb25zID0gdGhpcy5lcXVhdGlvbnM7CiAgICAgIGNvbnN0IE5lcSA9IGVxdWF0aW9ucy5sZW5ndGg7CiAgICAgIGNvbnN0IE5ib2RpZXMgPSBib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBzdWJzb2x2ZXIgPSB0aGlzLnN1YnNvbHZlcjsgLy8gQ3JlYXRlIG5lZWRlZCBub2RlcywgcmV1c2UgaWYgcG9zc2libGUKCiAgICAgIHdoaWxlIChub2RlUG9vbC5sZW5ndGggPCBOYm9kaWVzKSB7CiAgICAgICAgbm9kZVBvb2wucHVzaCh0aGlzLmNyZWF0ZU5vZGUoKSk7CiAgICAgIH0KCiAgICAgIG5vZGVzLmxlbmd0aCA9IE5ib2RpZXM7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IE5ib2RpZXM7IGkrKykgewogICAgICAgIG5vZGVzW2ldID0gbm9kZVBvb2xbaV07CiAgICAgIH0gLy8gUmVzZXQgbm9kZSB2YWx1ZXMKCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmJvZGllczsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwogICAgICAgIG5vZGUuYm9keSA9IGJvZGllc1tpXTsKICAgICAgICBub2RlLmNoaWxkcmVuLmxlbmd0aCA9IDA7CiAgICAgICAgbm9kZS5lcXMubGVuZ3RoID0gMDsKICAgICAgICBub2RlLnZpc2l0ZWQgPSBmYWxzZTsKICAgICAgfQoKICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IE5lcTsgaysrKSB7CiAgICAgICAgY29uc3QgZXEgPSBlcXVhdGlvbnNba107CiAgICAgICAgY29uc3QgaSA9IGJvZGllcy5pbmRleE9mKGVxLmJpKTsKICAgICAgICBjb25zdCBqID0gYm9kaWVzLmluZGV4T2YoZXEuYmopOwogICAgICAgIGNvbnN0IG5pID0gbm9kZXNbaV07CiAgICAgICAgY29uc3QgbmogPSBub2Rlc1tqXTsKICAgICAgICBuaS5jaGlsZHJlbi5wdXNoKG5qKTsKICAgICAgICBuaS5lcXMucHVzaChlcSk7CiAgICAgICAgbmouY2hpbGRyZW4ucHVzaChuaSk7CiAgICAgICAgbmouZXFzLnB1c2goZXEpOwogICAgICB9CgogICAgICBsZXQgY2hpbGQ7CiAgICAgIGxldCBuID0gMDsKICAgICAgbGV0IGVxcyA9IFNwbGl0U29sdmVyX3NvbHZlX2VxczsKICAgICAgc3Vic29sdmVyLnRvbGVyYW5jZSA9IHRoaXMudG9sZXJhbmNlOwogICAgICBzdWJzb2x2ZXIuaXRlcmF0aW9ucyA9IHRoaXMuaXRlcmF0aW9uczsKICAgICAgY29uc3QgZHVtbXlXb3JsZCA9IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQ7CgogICAgICB3aGlsZSAoY2hpbGQgPSBnZXRVbnZpc2l0ZWROb2RlKG5vZGVzKSkgewogICAgICAgIGVxcy5sZW5ndGggPSAwOwogICAgICAgIGR1bW15V29ybGQuYm9kaWVzLmxlbmd0aCA9IDA7CiAgICAgICAgYmZzKGNoaWxkLCB2aXNpdEZ1bmMsIGR1bW15V29ybGQuYm9kaWVzLCBlcXMpOwogICAgICAgIGNvbnN0IE5lcXMgPSBlcXMubGVuZ3RoOwogICAgICAgIGVxcyA9IGVxcy5zb3J0KHNvcnRCeUlkKTsKCiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5lcXM7IGkrKykgewogICAgICAgICAgc3Vic29sdmVyLmFkZEVxdWF0aW9uKGVxc1tpXSk7CiAgICAgICAgfQoKICAgICAgICBzdWJzb2x2ZXIuc29sdmUoZHQsIGR1bW15V29ybGQpOwogICAgICAgIHN1YnNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsKICAgICAgICBuKys7CiAgICAgIH0KCiAgICAgIHJldHVybiBuOwogICAgfQoKICB9IC8vIFJldHVybnMgdGhlIG51bWJlciBvZiBzdWJzeXN0ZW1zCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX25vZGVzID0gW107IC8vIEFsbCBhbGxvY2F0ZWQgbm9kZSBvYmplY3RzCgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2VxcyA9IFtdOyAvLyBUZW1wIGFycmF5CgogIGNvbnN0IFNwbGl0U29sdmVyX3NvbHZlX2R1bW15V29ybGQgPSB7CiAgICBib2RpZXM6IFtdCiAgfTsgLy8gVGVtcCBvYmplY3QKCiAgY29uc3QgU1RBVElDID0gQm9keS5TVEFUSUM7CgogIGZ1bmN0aW9uIGdldFVudmlzaXRlZE5vZGUobm9kZXMpIHsKICAgIGNvbnN0IE5ub2RlcyA9IG5vZGVzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTm5vZGVzOyBpKyspIHsKICAgICAgY29uc3Qgbm9kZSA9IG5vZGVzW2ldOwoKICAgICAgaWYgKCFub2RlLnZpc2l0ZWQgJiYgIShub2RlLmJvZHkudHlwZSAmIFNUQVRJQykpIHsKICAgICAgICByZXR1cm4gbm9kZTsKICAgICAgfQogICAgfQoKICAgIHJldHVybiBmYWxzZTsKICB9CgogIGNvbnN0IHF1ZXVlID0gW107CgogIGZ1bmN0aW9uIGJmcyhyb290LCB2aXNpdEZ1bmMsIGJkcywgZXFzKSB7CiAgICBxdWV1ZS5wdXNoKHJvb3QpOwogICAgcm9vdC52aXNpdGVkID0gdHJ1ZTsKICAgIHZpc2l0RnVuYyhyb290LCBiZHMsIGVxcyk7CgogICAgd2hpbGUgKHF1ZXVlLmxlbmd0aCkgewogICAgICBjb25zdCBub2RlID0gcXVldWUucG9wKCk7IC8vIExvb3Agb3ZlciB1bnZpc2l0ZWQgY2hpbGQgbm9kZXMKCiAgICAgIGxldCBjaGlsZDsKCiAgICAgIHdoaWxlIChjaGlsZCA9IGdldFVudmlzaXRlZE5vZGUobm9kZS5jaGlsZHJlbikpIHsKICAgICAgICBjaGlsZC52aXNpdGVkID0gdHJ1ZTsKICAgICAgICB2aXNpdEZ1bmMoY2hpbGQsIGJkcywgZXFzKTsKICAgICAgICBxdWV1ZS5wdXNoKGNoaWxkKTsKICAgICAgfQogICAgfQogIH0KCiAgZnVuY3Rpb24gdmlzaXRGdW5jKG5vZGUsIGJkcywgZXFzKSB7CiAgICBiZHMucHVzaChub2RlLmJvZHkpOwogICAgY29uc3QgTmVxcyA9IG5vZGUuZXFzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTmVxczsgaSsrKSB7CiAgICAgIGNvbnN0IGVxID0gbm9kZS5lcXNbaV07CgogICAgICBpZiAoIWVxcy5pbmNsdWRlcyhlcSkpIHsKICAgICAgICBlcXMucHVzaChlcSk7CiAgICAgIH0KICAgIH0KICB9CgogIGZ1bmN0aW9uIHNvcnRCeUlkKGEsIGIpIHsKICAgIHJldHVybiBiLmlkIC0gYS5pZDsKICB9CgogIC8qKgogICAqIEZvciBwb29saW5nIG9iamVjdHMgdGhhdCBjYW4gYmUgcmV1c2VkLgogICAqLwogIGNsYXNzIFBvb2wgewogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMub2JqZWN0cyA9IFtdOwogICAgICB0aGlzLnR5cGUgPSBPYmplY3Q7CiAgICB9CgogICAgLyoqCiAgICAgKiBSZWxlYXNlIGFuIG9iamVjdCBhZnRlciB1c2UKICAgICAqLwogICAgcmVsZWFzZSgpIHsKICAgICAgY29uc3QgTmFyZ3MgPSBhcmd1bWVudHMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE5hcmdzOyBpKyspIHsKICAgICAgICB0aGlzLm9iamVjdHMucHVzaChpIDwgMCB8fCBhcmd1bWVudHMubGVuZ3RoIDw9IGkgPyB1bmRlZmluZWQgOiBhcmd1bWVudHNbaV0pOwogICAgICB9CgogICAgICByZXR1cm4gdGhpczsKICAgIH0KICAgIC8qKgogICAgICogR2V0IGFuIG9iamVjdAogICAgICovCgoKICAgIGdldCgpIHsKICAgICAgaWYgKHRoaXMub2JqZWN0cy5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy5jb25zdHJ1Y3RPYmplY3QoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gdGhpcy5vYmplY3RzLnBvcCgpOwogICAgICB9CiAgICB9CiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhbiBvYmplY3QuIFNob3VsZCBiZSBpbXBsZW1lbnRlZCBpbiBlYWNoIHN1YmNsYXNzLgogICAgICovCgoKICAgIGNvbnN0cnVjdE9iamVjdCgpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb25zdHJ1Y3RPYmplY3QoKSBub3QgaW1wbGVtZW50ZWQgaW4gdGhpcyBQb29sIHN1YmNsYXNzIHlldCEnKTsKICAgIH0KICAgIC8qKgogICAgICogQHJldHVybiBTZWxmLCBmb3IgY2hhaW5pbmcKICAgICAqLwoKCiAgICByZXNpemUoc2l6ZSkgewogICAgICBjb25zdCBvYmplY3RzID0gdGhpcy5vYmplY3RzOwoKICAgICAgd2hpbGUgKG9iamVjdHMubGVuZ3RoID4gc2l6ZSkgewogICAgICAgIG9iamVjdHMucG9wKCk7CiAgICAgIH0KCiAgICAgIHdoaWxlIChvYmplY3RzLmxlbmd0aCA8IHNpemUpIHsKICAgICAgICBvYmplY3RzLnB1c2godGhpcy5jb25zdHJ1Y3RPYmplY3QoKSk7CiAgICAgIH0KCiAgICAgIHJldHVybiB0aGlzOwogICAgfQoKICB9CgogIC8qKgogICAqIFZlYzNQb29sCiAgICovCgogIGNsYXNzIFZlYzNQb29sIGV4dGVuZHMgUG9vbCB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgc3VwZXIoLi4uYXJndW1lbnRzKTsKICAgICAgdGhpcy50eXBlID0gVmVjMzsKICAgIH0KCiAgICAvKioKICAgICAqIENvbnN0cnVjdCBhIHZlY3RvcgogICAgICovCiAgICBjb25zdHJ1Y3RPYmplY3QoKSB7CiAgICAgIHJldHVybiBuZXcgVmVjMygpOwogICAgfQoKICB9CgogIC8vIE5hbWluZyBydWxlOiBiYXNlZCBvZiB0aGUgb3JkZXIgaW4gU0hBUEVfVFlQRVMsCiAgLy8gdGhlIGZpcnN0IHBhcnQgb2YgdGhlIG1ldGhvZCBpcyBmb3JtZWQgYnkgdGhlCiAgLy8gc2hhcGUgdHlwZSB0aGF0IGNvbWVzIGJlZm9yZSwgaW4gdGhlIHNlY29uZCBwYXJ0CiAgLy8gdGhlcmUgaXMgdGhlIHNoYXBlIHR5cGUgdGhhdCBjb21lcyBhZnRlciBpbiB0aGUgU0hBUEVfVFlQRVMgbGlzdAogIGNvbnN0IENPTExJU0lPTl9UWVBFUyA9IHsKICAgIHNwaGVyZVNwaGVyZTogU2hhcGUudHlwZXMuU1BIRVJFLAogICAgc3BoZXJlUGxhbmU6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLlBMQU5FLAogICAgYm94Qm94OiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5CT1gsCiAgICBzcGhlcmVCb3g6IFNoYXBlLnR5cGVzLlNQSEVSRSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIHBsYW5lQm94OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkJPWCwKICAgIGNvbnZleENvbnZleDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHNwaGVyZUNvbnZleDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiwKICAgIHBsYW5lQ29udmV4OiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBib3hDb252ZXg6IFNoYXBlLnR5cGVzLkJPWCB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBzcGhlcmVIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuU1BIRVJFIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBib3hIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuSEVJR0hURklFTEQsCiAgICBjb252ZXhIZWlnaHRmaWVsZDogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkhFSUdIVEZJRUxELAogICAgc3BoZXJlUGFydGljbGU6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuU1BIRVJFLAogICAgcGxhbmVQYXJ0aWNsZTogU2hhcGUudHlwZXMuUExBTkUgfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGJveFBhcnRpY2xlOiBTaGFwZS50eXBlcy5CT1ggfCBTaGFwZS50eXBlcy5QQVJUSUNMRSwKICAgIGNvbnZleFBhcnRpY2xlOiBTaGFwZS50eXBlcy5QQVJUSUNMRSB8IFNoYXBlLnR5cGVzLkNPTlZFWFBPTFlIRURST04sCiAgICBjeWxpbmRlckN5bGluZGVyOiBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHNwaGVyZUN5bGluZGVyOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBsYW5lQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBMQU5FIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBib3hDeWxpbmRlcjogU2hhcGUudHlwZXMuQk9YIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBjb252ZXhDeWxpbmRlcjogU2hhcGUudHlwZXMuQ09OVkVYUE9MWUhFRFJPTiB8IFNoYXBlLnR5cGVzLkNZTElOREVSLAogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcjogU2hhcGUudHlwZXMuSEVJR0hURklFTEQgfCBTaGFwZS50eXBlcy5DWUxJTkRFUiwKICAgIHBhcnRpY2xlQ3lsaW5kZXI6IFNoYXBlLnR5cGVzLlBBUlRJQ0xFIHwgU2hhcGUudHlwZXMuQ1lMSU5ERVIsCiAgICBzcGhlcmVUcmltZXNoOiBTaGFwZS50eXBlcy5TUEhFUkUgfCBTaGFwZS50eXBlcy5UUklNRVNILAogICAgcGxhbmVUcmltZXNoOiBTaGFwZS50eXBlcy5QTEFORSB8IFNoYXBlLnR5cGVzLlRSSU1FU0gKICB9OwoKICAvKioKICAgKiBIZWxwZXIgY2xhc3MgZm9yIHRoZSBXb3JsZC4gR2VuZXJhdGVzIENvbnRhY3RFcXVhdGlvbnMuCiAgICogQHRvZG8gU3BoZXJlLUNvbnZleFBvbHloZWRyb24gY29udGFjdHMKICAgKiBAdG9kbyBDb250YWN0IHJlZHVjdGlvbgogICAqIEB0b2RvIHNob3VsZCBtb3ZlIG1ldGhvZHMgdG8gcHJvdG90eXBlCiAgICovCiAgY2xhc3MgTmFycm93cGhhc2UgewogICAgLyoqCiAgICAgKiBJbnRlcm5hbCBzdG9yYWdlIG9mIHBvb2xlZCBjb250YWN0IHBvaW50cy4KICAgICAqLwoKICAgIC8qKgogICAgICogUG9vbGVkIHZlY3RvcnMuCiAgICAgKi8KICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVNwaGVyZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVNwaGVyZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVQbGFuZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnNwaGVyZVBsYW5lOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEJveF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmJveEJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5zcGhlcmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVCb3g7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVCb3hdKCkgewogICAgICByZXR1cm4gdGhpcy5wbGFuZUJveDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhDb252ZXhdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lQ29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94Q29udmV4XSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZUhlaWdodGZpZWxkXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlSGVpZ2h0ZmllbGQ7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94SGVpZ2h0ZmllbGRdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hIZWlnaHRmaWVsZDsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhIZWlnaHRmaWVsZF0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleEhlaWdodGZpZWxkOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVBhcnRpY2xlXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuc3BoZXJlUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lUGFydGljbGU7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuYm94UGFydGljbGVdKCkgewogICAgICByZXR1cm4gdGhpcy5ib3hQYXJ0aWNsZTsKICAgIH0KCiAgICBnZXQgW0NPTExJU0lPTl9UWVBFUy5jb252ZXhQYXJ0aWNsZV0oKSB7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleFBhcnRpY2xlOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmN5bGluZGVyQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMuc3BoZXJlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVDb252ZXg7CiAgICB9CgogICAgZ2V0IFtDT0xMSVNJT05fVFlQRVMucGxhbmVDeWxpbmRlcl0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lQ29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmJveEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuYm94Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmNvbnZleEN5bGluZGVyXSgpIHsKICAgICAgcmV0dXJuIHRoaXMuY29udmV4Q29udmV4OwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLmhlaWdodGZpZWxkQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5oZWlnaHRmaWVsZEN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBhcnRpY2xlQ3lsaW5kZXJdKCkgewogICAgICByZXR1cm4gdGhpcy5wYXJ0aWNsZUN5bGluZGVyOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnNwaGVyZVRyaW1lc2hdKCkgewogICAgICByZXR1cm4gdGhpcy5zcGhlcmVUcmltZXNoOwogICAgfQoKICAgIGdldCBbQ09MTElTSU9OX1RZUEVTLnBsYW5lVHJpbWVzaF0oKSB7CiAgICAgIHJldHVybiB0aGlzLnBsYW5lVHJpbWVzaDsKICAgIH0gLy8gZ2V0IFtDT0xMSVNJT05fVFlQRVMuY29udmV4VHJpbWVzaF0oKSB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNvbnZleFRyaW1lc2gKICAgIC8vIH0KCgogICAgY29uc3RydWN0b3Iod29ybGQpIHsKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsKICAgICAgdGhpcy5yZXN1bHQgPSBbXTsKICAgICAgdGhpcy5mcmljdGlvblJlc3VsdCA9IFtdOwogICAgICB0aGlzLnYzcG9vbCA9IG5ldyBWZWMzUG9vbCgpOwogICAgICB0aGlzLndvcmxkID0gd29ybGQ7CiAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgIHRoaXMuZW5hYmxlRnJpY3Rpb25SZWR1Y3Rpb24gPSBmYWxzZTsKICAgIH0KICAgIC8qKgogICAgICogTWFrZSBhIGNvbnRhY3Qgb2JqZWN0LCBieSB1c2luZyB0aGUgaW50ZXJuYWwgcG9vbCBvciBjcmVhdGluZyBhIG5ldyBvbmUuCiAgICAgKi8KCgogICAgY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCBvdmVycmlkZVNoYXBlQSwgb3ZlcnJpZGVTaGFwZUIpIHsKICAgICAgbGV0IGM7CgogICAgICBpZiAodGhpcy5jb250YWN0UG9pbnRQb29sLmxlbmd0aCkgewogICAgICAgIGMgPSB0aGlzLmNvbnRhY3RQb2ludFBvb2wucG9wKCk7CiAgICAgICAgYy5iaSA9IGJpOwogICAgICAgIGMuYmogPSBiajsKICAgICAgfSBlbHNlIHsKICAgICAgICBjID0gbmV3IENvbnRhY3RFcXVhdGlvbihiaSwgYmopOwogICAgICB9CgogICAgICBjLmVuYWJsZWQgPSBiaS5jb2xsaXNpb25SZXNwb25zZSAmJiBiai5jb2xsaXNpb25SZXNwb25zZSAmJiBzaS5jb2xsaXNpb25SZXNwb25zZSAmJiBzai5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgY29uc3QgY20gPSB0aGlzLmN1cnJlbnRDb250YWN0TWF0ZXJpYWw7CiAgICAgIGMucmVzdGl0dXRpb24gPSBjbS5yZXN0aXR1dGlvbjsKICAgICAgYy5zZXRTcG9va1BhcmFtcyhjbS5jb250YWN0RXF1YXRpb25TdGlmZm5lc3MsIGNtLmNvbnRhY3RFcXVhdGlvblJlbGF4YXRpb24sIHRoaXMud29ybGQuZHQpOwogICAgICBjb25zdCBtYXRBID0gc2kubWF0ZXJpYWwgfHwgYmkubWF0ZXJpYWw7CiAgICAgIGNvbnN0IG1hdEIgPSBzai5tYXRlcmlhbCB8fCBiai5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5yZXN0aXR1dGlvbiA+PSAwICYmIG1hdEIucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgIGMucmVzdGl0dXRpb24gPSBtYXRBLnJlc3RpdHV0aW9uICogbWF0Qi5yZXN0aXR1dGlvbjsKICAgICAgfQoKICAgICAgYy5zaSA9IG92ZXJyaWRlU2hhcGVBIHx8IHNpOwogICAgICBjLnNqID0gb3ZlcnJpZGVTaGFwZUIgfHwgc2o7CiAgICAgIHJldHVybiBjOwogICAgfQoKICAgIGNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoY29udGFjdEVxdWF0aW9uLCBvdXRBcnJheSkgewogICAgICBjb25zdCBib2R5QSA9IGNvbnRhY3RFcXVhdGlvbi5iaTsKICAgICAgY29uc3QgYm9keUIgPSBjb250YWN0RXF1YXRpb24uYmo7CiAgICAgIGNvbnN0IHNoYXBlQSA9IGNvbnRhY3RFcXVhdGlvbi5zaTsKICAgICAgY29uc3Qgc2hhcGVCID0gY29udGFjdEVxdWF0aW9uLnNqOwogICAgICBjb25zdCB3b3JsZCA9IHRoaXMud29ybGQ7CiAgICAgIGNvbnN0IGNtID0gdGhpcy5jdXJyZW50Q29udGFjdE1hdGVyaWFsOyAvLyBJZiBmcmljdGlvbiBvciByZXN0aXR1dGlvbiB3ZXJlIHNwZWNpZmllZCBpbiB0aGUgbWF0ZXJpYWwsIHVzZSB0aGVtCgogICAgICBsZXQgZnJpY3Rpb24gPSBjbS5mcmljdGlvbjsKICAgICAgY29uc3QgbWF0QSA9IHNoYXBlQS5tYXRlcmlhbCB8fCBib2R5QS5tYXRlcmlhbDsKICAgICAgY29uc3QgbWF0QiA9IHNoYXBlQi5tYXRlcmlhbCB8fCBib2R5Qi5tYXRlcmlhbDsKCiAgICAgIGlmIChtYXRBICYmIG1hdEIgJiYgbWF0QS5mcmljdGlvbiA+PSAwICYmIG1hdEIuZnJpY3Rpb24gPj0gMCkgewogICAgICAgIGZyaWN0aW9uID0gbWF0QS5mcmljdGlvbiAqIG1hdEIuZnJpY3Rpb247CiAgICAgIH0KCiAgICAgIGlmIChmcmljdGlvbiA+IDApIHsKICAgICAgICAvLyBDcmVhdGUgMiB0YW5nZW50IGVxdWF0aW9ucwogICAgICAgIC8vIFVzZXJzIG1heSBwcm92aWRlIGEgZm9yY2UgZGlmZmVyZW50IGZyb20gZ2xvYmFsIGdyYXZpdHkgdG8gdXNlIHdoZW4gY29tcHV0aW5nIGNvbnRhY3QgZnJpY3Rpb24uCiAgICAgICAgY29uc3QgbXVnID0gZnJpY3Rpb24gKiAod29ybGQuZnJpY3Rpb25HcmF2aXR5IHx8IHdvcmxkLmdyYXZpdHkpLmxlbmd0aCgpOwogICAgICAgIGxldCByZWR1Y2VkTWFzcyA9IGJvZHlBLmludk1hc3MgKyBib2R5Qi5pbnZNYXNzOwoKICAgICAgICBpZiAocmVkdWNlZE1hc3MgPiAwKSB7CiAgICAgICAgICByZWR1Y2VkTWFzcyA9IDEgLyByZWR1Y2VkTWFzczsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHBvb2wgPSB0aGlzLmZyaWN0aW9uRXF1YXRpb25Qb29sOwogICAgICAgIGNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYm9keUEsIGJvZHlCLCBtdWcgKiByZWR1Y2VkTWFzcyk7CiAgICAgICAgY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihib2R5QSwgYm9keUIsIG11ZyAqIHJlZHVjZWRNYXNzKTsKICAgICAgICBjMS5iaSA9IGMyLmJpID0gYm9keUE7CiAgICAgICAgYzEuYmogPSBjMi5iaiA9IGJvZHlCOwogICAgICAgIGMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnICogcmVkdWNlZE1hc3M7CiAgICAgICAgYzEubWF4Rm9yY2UgPSBjMi5tYXhGb3JjZSA9IG11ZyAqIHJlZHVjZWRNYXNzOyAvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKCiAgICAgICAgYzEucmkuY29weShjb250YWN0RXF1YXRpb24ucmkpOwogICAgICAgIGMxLnJqLmNvcHkoY29udGFjdEVxdWF0aW9uLnJqKTsKICAgICAgICBjMi5yaS5jb3B5KGNvbnRhY3RFcXVhdGlvbi5yaSk7CiAgICAgICAgYzIucmouY29weShjb250YWN0RXF1YXRpb24ucmopOyAvLyBDb25zdHJ1Y3QgdGFuZ2VudHMKCiAgICAgICAgY29udGFjdEVxdWF0aW9uLm5pLnRhbmdlbnRzKGMxLnQsIGMyLnQpOyAvLyBTZXQgc3Bvb2sgcGFyYW1zCgogICAgICAgIGMxLnNldFNwb29rUGFyYW1zKGNtLmZyaWN0aW9uRXF1YXRpb25TdGlmZm5lc3MsIGNtLmZyaWN0aW9uRXF1YXRpb25SZWxheGF0aW9uLCB3b3JsZC5kdCk7CiAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIHdvcmxkLmR0KTsKICAgICAgICBjMS5lbmFibGVkID0gYzIuZW5hYmxlZCA9IGNvbnRhY3RFcXVhdGlvbi5lbmFibGVkOwogICAgICAgIG91dEFycmF5LnB1c2goYzEsIGMyKTsKICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgfQoKICAgICAgcmV0dXJuIGZhbHNlOwogICAgfQogICAgLyoqCiAgICAgKiBUYWtlIHRoZSBhdmVyYWdlIE4gbGF0ZXN0IGNvbnRhY3QgcG9pbnQgb24gdGhlIHBsYW5lLgogICAgICovCgoKICAgIGNyZWF0ZUZyaWN0aW9uRnJvbUF2ZXJhZ2UobnVtQ29udGFjdHMpIHsKICAgICAgLy8gVGhlIGxhc3QgY29udGFjdEVxdWF0aW9uCiAgICAgIGxldCBjID0gdGhpcy5yZXN1bHRbdGhpcy5yZXN1bHQubGVuZ3RoIC0gMV07IC8vIENyZWF0ZSB0aGUgcmVzdWx0OiB0d28gImF2ZXJhZ2UiIGZyaWN0aW9uIGVxdWF0aW9ucwoKICAgICAgaWYgKCF0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QoYywgdGhpcy5mcmljdGlvblJlc3VsdCkgfHwgbnVtQ29udGFjdHMgPT09IDEpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IGYxID0gdGhpcy5mcmljdGlvblJlc3VsdFt0aGlzLmZyaWN0aW9uUmVzdWx0Lmxlbmd0aCAtIDJdOwogICAgICBjb25zdCBmMiA9IHRoaXMuZnJpY3Rpb25SZXN1bHRbdGhpcy5mcmljdGlvblJlc3VsdC5sZW5ndGggLSAxXTsKICAgICAgYXZlcmFnZU5vcm1hbC5zZXRaZXJvKCk7CiAgICAgIGF2ZXJhZ2VDb250YWN0UG9pbnRBLnNldFplcm8oKTsKICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEIuc2V0WmVybygpOwogICAgICBjb25zdCBib2R5QSA9IGMuYmk7CiAgICAgIGMuYmo7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gbnVtQ29udGFjdHM7IGkrKykgewogICAgICAgIGMgPSB0aGlzLnJlc3VsdFt0aGlzLnJlc3VsdC5sZW5ndGggLSAxIC0gaV07CgogICAgICAgIGlmIChjLmJpICE9PSBib2R5QSkgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52YWRkKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJpLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmosIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgYXZlcmFnZU5vcm1hbC52c3ViKGMubmksIGF2ZXJhZ2VOb3JtYWwpOwogICAgICAgICAgYXZlcmFnZUNvbnRhY3RQb2ludEEudmFkZChjLnJqLCBhdmVyYWdlQ29udGFjdFBvaW50QSk7CiAgICAgICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi52YWRkKGMucmksIGF2ZXJhZ2VDb250YWN0UG9pbnRCKTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNvbnN0IGludk51bUNvbnRhY3RzID0gMSAvIG51bUNvbnRhY3RzOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50QS5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmkpOwogICAgICBhdmVyYWdlQ29udGFjdFBvaW50Qi5zY2FsZShpbnZOdW1Db250YWN0cywgZjEucmopOwogICAgICBmMi5yaS5jb3B5KGYxLnJpKTsgLy8gU2hvdWxkIGJlIHRoZSBzYW1lCgogICAgICBmMi5yai5jb3B5KGYxLnJqKTsKICAgICAgYXZlcmFnZU5vcm1hbC5ub3JtYWxpemUoKTsKICAgICAgYXZlcmFnZU5vcm1hbC50YW5nZW50cyhmMS50LCBmMi50KTsgLy8gcmV0dXJuIGVxOwogICAgfQogICAgLyoqCiAgICAgKiBHZW5lcmF0ZSBhbGwgY29udGFjdHMgYmV0d2VlbiBhIGxpc3Qgb2YgYm9keSBwYWlycwogICAgICogQHBhcmFtIHAxIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHAyIEFycmF5IG9mIGJvZHkgaW5kaWNlcwogICAgICogQHBhcmFtIHJlc3VsdCBBcnJheSB0byBzdG9yZSBnZW5lcmF0ZWQgY29udGFjdHMKICAgICAqIEBwYXJhbSBvbGRjb250YWN0cyBPcHRpb25hbC4gQXJyYXkgb2YgcmV1c2FibGUgY29udGFjdCBvYmplY3RzCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdHMocDEsIHAyLCB3b3JsZCwgcmVzdWx0LCBvbGRjb250YWN0cywgZnJpY3Rpb25SZXN1bHQsIGZyaWN0aW9uUG9vbCkgewogICAgICAvLyBTYXZlIG9sZCBjb250YWN0IG9iamVjdHMKICAgICAgdGhpcy5jb250YWN0UG9pbnRQb29sID0gb2xkY29udGFjdHM7CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBmcmljdGlvblBvb2w7CiAgICAgIHRoaXMucmVzdWx0ID0gcmVzdWx0OwogICAgICB0aGlzLmZyaWN0aW9uUmVzdWx0ID0gZnJpY3Rpb25SZXN1bHQ7CiAgICAgIGNvbnN0IHFpID0gdG1wUXVhdDE7CiAgICAgIGNvbnN0IHFqID0gdG1wUXVhdDI7CiAgICAgIGNvbnN0IHhpID0gdG1wVmVjMTsKICAgICAgY29uc3QgeGogPSB0bXBWZWMyOwoKICAgICAgZm9yIChsZXQgayA9IDAsIE4gPSBwMS5sZW5ndGg7IGsgIT09IE47IGsrKykgewogICAgICAgIC8vIEdldCBjdXJyZW50IGNvbGxpc2lvbiBib2RpZXMKICAgICAgICBjb25zdCBiaSA9IHAxW2tdOwogICAgICAgIGNvbnN0IGJqID0gcDJba107IC8vIEdldCBjb250YWN0IG1hdGVyaWFsCgogICAgICAgIGxldCBib2R5Q29udGFjdE1hdGVyaWFsID0gbnVsbDsKCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBib2R5Q29udGFjdE1hdGVyaWFsID0gd29ybGQuZ2V0Q29udGFjdE1hdGVyaWFsKGJpLm1hdGVyaWFsLCBiai5tYXRlcmlhbCkgfHwgbnVsbDsKICAgICAgICB9CgogICAgICAgIGNvbnN0IGp1c3RUZXN0ID0gYmkudHlwZSAmIEJvZHkuS0lORU1BVElDICYmIGJqLnR5cGUgJiBCb2R5LlNUQVRJQyB8fCBiaS50eXBlICYgQm9keS5TVEFUSUMgJiYgYmoudHlwZSAmIEJvZHkuS0lORU1BVElDIHx8IGJpLnR5cGUgJiBCb2R5LktJTkVNQVRJQyAmJiBiai50eXBlICYgQm9keS5LSU5FTUFUSUM7CgogICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYmkuc2hhcGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBiaS5xdWF0ZXJuaW9uLm11bHQoYmkuc2hhcGVPcmllbnRhdGlvbnNbaV0sIHFpKTsKICAgICAgICAgIGJpLnF1YXRlcm5pb24udm11bHQoYmkuc2hhcGVPZmZzZXRzW2ldLCB4aSk7CiAgICAgICAgICB4aS52YWRkKGJpLnBvc2l0aW9uLCB4aSk7CiAgICAgICAgICBjb25zdCBzaSA9IGJpLnNoYXBlc1tpXTsKCiAgICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IGJqLnNoYXBlcy5sZW5ndGg7IGorKykgewogICAgICAgICAgICAvLyBDb21wdXRlIHdvcmxkIHRyYW5zZm9ybSBvZiBzaGFwZXMKICAgICAgICAgICAgYmoucXVhdGVybmlvbi5tdWx0KGJqLnNoYXBlT3JpZW50YXRpb25zW2pdLCBxaik7CiAgICAgICAgICAgIGJqLnF1YXRlcm5pb24udm11bHQoYmouc2hhcGVPZmZzZXRzW2pdLCB4aik7CiAgICAgICAgICAgIHhqLnZhZGQoYmoucG9zaXRpb24sIHhqKTsKICAgICAgICAgICAgY29uc3Qgc2ogPSBiai5zaGFwZXNbal07CgogICAgICAgICAgICBpZiAoIShzaS5jb2xsaXNpb25GaWx0ZXJNYXNrICYgc2ouY29sbGlzaW9uRmlsdGVyR3JvdXAgJiYgc2ouY29sbGlzaW9uRmlsdGVyTWFzayAmIHNpLmNvbGxpc2lvbkZpbHRlckdyb3VwKSkgewogICAgICAgICAgICAgIGNvbnRpbnVlOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIH0gLy8gR2V0IGNvbGxpc2lvbiBtYXRlcmlhbAoKCiAgICAgICAgICAgIGxldCBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IG51bGw7CgogICAgICAgICAgICBpZiAoc2kubWF0ZXJpYWwgJiYgc2oubWF0ZXJpYWwpIHsKICAgICAgICAgICAgICBzaGFwZUNvbnRhY3RNYXRlcmlhbCA9IHdvcmxkLmdldENvbnRhY3RNYXRlcmlhbChzaS5tYXRlcmlhbCwgc2oubWF0ZXJpYWwpIHx8IG51bGw7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIHRoaXMuY3VycmVudENvbnRhY3RNYXRlcmlhbCA9IHNoYXBlQ29udGFjdE1hdGVyaWFsIHx8IGJvZHlDb250YWN0TWF0ZXJpYWwgfHwgd29ybGQuZGVmYXVsdENvbnRhY3RNYXRlcmlhbDsgLy8gR2V0IGNvbnRhY3RzCgogICAgICAgICAgICBjb25zdCByZXNvbHZlckluZGV4ID0gc2kudHlwZSB8IHNqLnR5cGU7CiAgICAgICAgICAgIGNvbnN0IHJlc29sdmVyID0gdGhpc1tyZXNvbHZlckluZGV4XTsKCiAgICAgICAgICAgIGlmIChyZXNvbHZlcikgewogICAgICAgICAgICAgIGxldCByZXR2YWwgPSBmYWxzZTsgLy8gVE8gRE86IGludmVzdGlnYXRlIHdoeSBzcGhlcmVQYXJ0aWNsZSBhbmQgY29udmV4UGFydGljbGUKICAgICAgICAgICAgICAvLyByZXNvbHZlcnMgZXhwZWN0IHNpIGFuZCBzaiBzaGFwZXMgdG8gYmUgaW4gcmV2ZXJzZSBvcmRlcgogICAgICAgICAgICAgIC8vIChpLmUuIGxhcmdlciBpbnRlZ2VyIHZhbHVlIHR5cGUgZmlyc3QgaW5zdGVhZCBvZiBzbWFsbGVyIGZpcnN0KQoKICAgICAgICAgICAgICBpZiAoc2kudHlwZSA8IHNqLnR5cGUpIHsKICAgICAgICAgICAgICAgIHJldHZhbCA9IHJlc29sdmVyLmNhbGwodGhpcywgc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgcmV0dmFsID0gcmVzb2x2ZXIuY2FsbCh0aGlzLCBzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHNpLCBzaiwganVzdFRlc3QpOwogICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgaWYgKHJldHZhbCAmJiBqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgLy8gUmVnaXN0ZXIgb3ZlcmxhcAogICAgICAgICAgICAgICAgd29ybGQuc2hhcGVPdmVybGFwS2VlcGVyLnNldChzaS5pZCwgc2ouaWQpOwogICAgICAgICAgICAgICAgd29ybGQuYm9keU92ZXJsYXBLZWVwZXIuc2V0KGJpLmlkLCBiai5pZCk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgc3BoZXJlU3BoZXJlKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgIHJldHVybiB4aS5kaXN0YW5jZVNxdWFyZWQoeGopIDwgKHNpLnJhZGl1cyArIHNqLnJhZGl1cykgKiogMjsKICAgICAgfSAvLyBXZSB3aWxsIGhhdmUgb25seSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKCgogICAgICBjb25zdCBjb250YWN0RXEgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgeGoudnN1Yih4aSwgY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLm5pLm5vcm1hbGl6ZSgpOyAvLyBDb250YWN0IHBvaW50IGxvY2F0aW9ucwoKICAgICAgY29udGFjdEVxLnJpLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJqLmNvcHkoY29udGFjdEVxLm5pKTsKICAgICAgY29udGFjdEVxLnJpLnNjYWxlKHNpLnJhZGl1cywgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnNjYWxlKC1zai5yYWRpdXMsIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yaS52YWRkKHhpLCBjb250YWN0RXEucmkpOwogICAgICBjb250YWN0RXEucmkudnN1YihiaS5wb3NpdGlvbiwgY29udGFjdEVxLnJpKTsKICAgICAgY29udGFjdEVxLnJqLnZhZGQoeGosIGNvbnRhY3RFcS5yaik7CiAgICAgIGNvbnRhY3RFcS5yai52c3ViKGJqLnBvc2l0aW9uLCBjb250YWN0RXEucmopOwogICAgICB0aGlzLnJlc3VsdC5wdXNoKGNvbnRhY3RFcSk7CiAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChjb250YWN0RXEsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgfQoKICAgIHNwaGVyZVBsYW5lKHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFdlIHdpbGwgaGF2ZSBvbmUgY29udGFjdCBpbiB0aGlzIGNhc2UKICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7IC8vIENvbnRhY3Qgbm9ybWFsCgogICAgICByLm5pLnNldCgwLCAwLCAxKTsKICAgICAgcWoudm11bHQoci5uaSwgci5uaSk7CiAgICAgIHIubmkubmVnYXRlKHIubmkpOyAvLyBib2R5IGkgaXMgdGhlIHNwaGVyZSwgZmxpcCBub3JtYWwKCiAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIE5lZWRlZD8KICAgICAgLy8gVmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBjb250YWN0IHBvaW50CgogICAgICByLm5pLnNjYWxlKHNpLnJhZGl1cywgci5yaSk7IC8vIFByb2plY3QgZG93biBzcGhlcmUgb24gcGxhbmUKCiAgICAgIHhpLnZzdWIoeGosIHBvaW50X29uX3BsYW5lX3RvX3NwaGVyZSk7CiAgICAgIHIubmkuc2NhbGUoci5uaS5kb3QocG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlKSwgcGxhbmVfdG9fc3BoZXJlX29ydGhvKTsKICAgICAgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLnZzdWIocGxhbmVfdG9fc3BoZXJlX29ydGhvLCByLnJqKTsgLy8gVGhlIHNwaGVyZSBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gcGxhbmUKCiAgICAgIGlmICgtcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlLmRvdChyLm5pKSA8PSBzaS5yYWRpdXMpIHsKICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgIH0gLy8gTWFrZSBpdCByZWxhdGl2ZSB0byB0aGUgYm9keQoKCiAgICAgICAgY29uc3QgcmkgPSByLnJpOwogICAgICAgIGNvbnN0IHJqID0gci5yajsKICAgICAgICByaS52YWRkKHhpLCByaSk7CiAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICByai52c3ViKGJqLnBvc2l0aW9uLCByaik7CiAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgIH0KICAgIH0KCiAgICBib3hCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5tYXRlcmlhbCA9IHNqLm1hdGVyaWFsOwogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uY29sbGlzaW9uUmVzcG9uc2UgPSBzaS5jb2xsaXNpb25SZXNwb25zZTsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2ouY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlQm94KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IHYzcG9vbCA9IHRoaXMudjNwb29sOyAvLyB3ZSByZWZlciB0byB0aGUgYm94IGFzIGJvZHkgagoKICAgICAgY29uc3Qgc2lkZXMgPSBzcGhlcmVCb3hfc2lkZXM7CiAgICAgIHhpLnZzdWIoeGosIGJveF90b19zcGhlcmUpOwogICAgICBzai5nZXRTaWRlTm9ybWFscyhzaWRlcywgcWopOwogICAgICBjb25zdCBSID0gc2kucmFkaXVzOwoKICAgICAgbGV0IGZvdW5kID0gZmFsc2U7IC8vIFN0b3JlIHRoZSByZXN1bHRpbmcgc2lkZSBwZW5ldHJhdGlvbiBpbmZvCgogICAgICBjb25zdCBzaWRlX25zID0gc3BoZXJlQm94X3NpZGVfbnM7CiAgICAgIGNvbnN0IHNpZGVfbnMxID0gc3BoZXJlQm94X3NpZGVfbnMxOwogICAgICBjb25zdCBzaWRlX25zMiA9IHNwaGVyZUJveF9zaWRlX25zMjsKICAgICAgbGV0IHNpZGVfaCA9IG51bGw7CiAgICAgIGxldCBzaWRlX3BlbmV0cmF0aW9ucyA9IDA7CiAgICAgIGxldCBzaWRlX2RvdDEgPSAwOwogICAgICBsZXQgc2lkZV9kb3QyID0gMDsKICAgICAgbGV0IHNpZGVfZGlzdGFuY2UgPSBudWxsOwoKICAgICAgZm9yIChsZXQgaWR4ID0gMCwgbnNpZGVzID0gc2lkZXMubGVuZ3RoOyBpZHggIT09IG5zaWRlcyAmJiBmb3VuZCA9PT0gZmFsc2U7IGlkeCsrKSB7CiAgICAgICAgLy8gR2V0IHRoZSBwbGFuZSBzaWRlIG5vcm1hbCAobnMpCiAgICAgICAgY29uc3QgbnMgPSBzcGhlcmVCb3hfbnM7CiAgICAgICAgbnMuY29weShzaWRlc1tpZHhdKTsKICAgICAgICBjb25zdCBoID0gbnMubGVuZ3RoKCk7CiAgICAgICAgbnMubm9ybWFsaXplKCk7IC8vIFRoZSBub3JtYWwvZGlzdGFuY2UgZG90IHByb2R1Y3QgdGVsbHMgd2hpY2ggc2lkZSBvZiB0aGUgcGxhbmUgd2UgYXJlCgogICAgICAgIGNvbnN0IGRvdCA9IGJveF90b19zcGhlcmUuZG90KG5zKTsKCiAgICAgICAgaWYgKGRvdCA8IGggKyBSICYmIGRvdCA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayB0aGUgb3RoZXIgdHdvIGRpbWVuc2lvbnMKICAgICAgICAgIGNvbnN0IG5zMSA9IHNwaGVyZUJveF9uczE7CiAgICAgICAgICBjb25zdCBuczIgPSBzcGhlcmVCb3hfbnMyOwogICAgICAgICAgbnMxLmNvcHkoc2lkZXNbKGlkeCArIDEpICUgM10pOwogICAgICAgICAgbnMyLmNvcHkoc2lkZXNbKGlkeCArIDIpICUgM10pOwogICAgICAgICAgY29uc3QgaDEgPSBuczEubGVuZ3RoKCk7CiAgICAgICAgICBjb25zdCBoMiA9IG5zMi5sZW5ndGgoKTsKICAgICAgICAgIG5zMS5ub3JtYWxpemUoKTsKICAgICAgICAgIG5zMi5ub3JtYWxpemUoKTsKICAgICAgICAgIGNvbnN0IGRvdDEgPSBib3hfdG9fc3BoZXJlLmRvdChuczEpOwogICAgICAgICAgY29uc3QgZG90MiA9IGJveF90b19zcGhlcmUuZG90KG5zMik7CgogICAgICAgICAgaWYgKGRvdDEgPCBoMSAmJiBkb3QxID4gLWgxICYmIGRvdDIgPCBoMiAmJiBkb3QyID4gLWgyKSB7CiAgICAgICAgICAgIGNvbnN0IGRpc3QgPSBNYXRoLmFicyhkb3QgLSBoIC0gUik7CgogICAgICAgICAgICBpZiAoc2lkZV9kaXN0YW5jZSA9PT0gbnVsbCB8fCBkaXN0IDwgc2lkZV9kaXN0YW5jZSkgewogICAgICAgICAgICAgIHNpZGVfZGlzdGFuY2UgPSBkaXN0OwogICAgICAgICAgICAgIHNpZGVfZG90MSA9IGRvdDE7CiAgICAgICAgICAgICAgc2lkZV9kb3QyID0gZG90MjsKICAgICAgICAgICAgICBzaWRlX2ggPSBoOwogICAgICAgICAgICAgIHNpZGVfbnMuY29weShucyk7CiAgICAgICAgICAgICAgc2lkZV9uczEuY29weShuczEpOwogICAgICAgICAgICAgIHNpZGVfbnMyLmNvcHkobnMyKTsKICAgICAgICAgICAgICBzaWRlX3BlbmV0cmF0aW9ucysrOwoKICAgICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYgKHNpZGVfcGVuZXRyYXRpb25zKSB7CiAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHNpZGVfbnMuc2NhbGUoLVIsIHIucmkpOyAvLyBTcGhlcmUgcgoKICAgICAgICByLm5pLmNvcHkoc2lkZV9ucyk7CiAgICAgICAgci5uaS5uZWdhdGUoci5uaSk7IC8vIE5vcm1hbCBzaG91bGQgYmUgb3V0IG9mIHNwaGVyZQoKICAgICAgICBzaWRlX25zLnNjYWxlKHNpZGVfaCwgc2lkZV9ucyk7CiAgICAgICAgc2lkZV9uczEuc2NhbGUoc2lkZV9kb3QxLCBzaWRlX25zMSk7CiAgICAgICAgc2lkZV9ucy52YWRkKHNpZGVfbnMxLCBzaWRlX25zKTsKICAgICAgICBzaWRlX25zMi5zY2FsZShzaWRlX2RvdDIsIHNpZGVfbnMyKTsKICAgICAgICBzaWRlX25zLnZhZGQoc2lkZV9uczIsIHIucmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICByLnJpLnZhZGQoeGksIHIucmkpOwogICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgci5yai52YWRkKHhqLCByLnJqKTsKICAgICAgICByLnJqLnZzdWIoYmoucG9zaXRpb24sIHIucmopOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9IC8vIENoZWNrIGNvcm5lcnMKCgogICAgICBsZXQgcmogPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVCb3hfc3BoZXJlX3RvX2Nvcm5lcjsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSAyICYmICFmb3VuZDsgaisrKSB7CiAgICAgICAgZm9yIChsZXQgayA9IDA7IGsgIT09IDIgJiYgIWZvdW5kOyBrKyspIHsKICAgICAgICAgIGZvciAobGV0IGwgPSAwOyBsICE9PSAyICYmICFmb3VuZDsgbCsrKSB7CiAgICAgICAgICAgIHJqLnNldCgwLCAwLCAwKTsKCiAgICAgICAgICAgIGlmIChqKSB7CiAgICAgICAgICAgICAgcmoudmFkZChzaWRlc1swXSwgcmopOwogICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgIHJqLnZzdWIoc2lkZXNbMF0sIHJqKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgaWYgKGspIHsKICAgICAgICAgICAgICByai52YWRkKHNpZGVzWzFdLCByaik7CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgcmoudnN1YihzaWRlc1sxXSwgcmopOwogICAgICAgICAgICB9CgogICAgICAgICAgICBpZiAobCkgewogICAgICAgICAgICAgIHJqLnZhZGQoc2lkZXNbMl0sIHJqKTsKICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICByai52c3ViKHNpZGVzWzJdLCByaik7CiAgICAgICAgICAgIH0gLy8gV29ybGQgcG9zaXRpb24gb2YgY29ybmVyCgoKICAgICAgICAgICAgeGoudmFkZChyaiwgc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICAgIHNwaGVyZV90b19jb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgICAgICBpZiAoc3BoZXJlX3RvX2Nvcm5lci5sZW5ndGhTcXVhcmVkKCkgPCBSICogUikgewogICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgICAgfQoKICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7CiAgICAgICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICAgICAgci5yaS5jb3B5KHNwaGVyZV90b19jb3JuZXIpOwogICAgICAgICAgICAgIHIucmkubm9ybWFsaXplKCk7CiAgICAgICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgICAgIHIucmkuc2NhbGUoUiwgci5yaSk7CiAgICAgICAgICAgICAgci5yai5jb3B5KHJqKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgdjNwb29sLnJlbGVhc2UocmopOwogICAgICByaiA9IG51bGw7IC8vIENoZWNrIGVkZ2VzCgogICAgICBjb25zdCBlZGdlVGFuZ2VudCA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgZWRnZUNlbnRlciA9IHYzcG9vbC5nZXQoKTsKICAgICAgY29uc3QgciA9IHYzcG9vbC5nZXQoKTsgLy8gciA9IGVkZ2UgY2VudGVyIHRvIHNwaGVyZSBjZW50ZXIKCiAgICAgIGNvbnN0IG9ydGhvZ29uYWwgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IGRpc3QgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgIGNvbnN0IE5zaWRlcyA9IHNpZGVzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBOc2lkZXMgJiYgIWZvdW5kOyBqKyspIHsKICAgICAgICBmb3IgKGxldCBrID0gMDsgayAhPT0gTnNpZGVzICYmICFmb3VuZDsgaysrKSB7CiAgICAgICAgICBpZiAoaiAlIDMgIT09IGsgJSAzKSB7CiAgICAgICAgICAgIC8vIEdldCBlZGdlIHRhbmdlbnQKICAgICAgICAgICAgc2lkZXNba10uY3Jvc3Moc2lkZXNbal0sIGVkZ2VUYW5nZW50KTsKICAgICAgICAgICAgZWRnZVRhbmdlbnQubm9ybWFsaXplKCk7CiAgICAgICAgICAgIHNpZGVzW2pdLnZhZGQoc2lkZXNba10sIGVkZ2VDZW50ZXIpOwogICAgICAgICAgICByLmNvcHkoeGkpOwogICAgICAgICAgICByLnZzdWIoZWRnZUNlbnRlciwgcik7CiAgICAgICAgICAgIHIudnN1Yih4aiwgcik7CiAgICAgICAgICAgIGNvbnN0IG9ydGhvbm9ybSA9IHIuZG90KGVkZ2VUYW5nZW50KTsgLy8gZGlzdGFuY2UgZnJvbSBlZGdlIGNlbnRlciB0byBzcGhlcmUgY2VudGVyIGluIHRoZSB0YW5nZW50IGRpcmVjdGlvbgoKICAgICAgICAgICAgZWRnZVRhbmdlbnQuc2NhbGUob3J0aG9ub3JtLCBvcnRob2dvbmFsKTsgLy8gVmVjdG9yIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIGNlbnRlciBpbiB0aGUgdGFuZ2VudCBkaXJlY3Rpb24KICAgICAgICAgICAgLy8gRmluZCB0aGUgdGhpcmQgc2lkZSBvcnRob2dvbmFsIHRvIHRoaXMgb25lCgogICAgICAgICAgICBsZXQgbCA9IDA7CgogICAgICAgICAgICB3aGlsZSAobCA9PT0gaiAlIDMgfHwgbCA9PT0gayAlIDMpIHsKICAgICAgICAgICAgICBsKys7CiAgICAgICAgICAgIH0gLy8gdmVjIGZyb20gZWRnZSBjZW50ZXIgdG8gc3BoZXJlIHByb2plY3RlZCB0byB0aGUgcGxhbmUgb3J0aG9nb25hbCB0byB0aGUgZWRnZSB0YW5nZW50CgoKICAgICAgICAgICAgZGlzdC5jb3B5KHhpKTsKICAgICAgICAgICAgZGlzdC52c3ViKG9ydGhvZ29uYWwsIGRpc3QpOwogICAgICAgICAgICBkaXN0LnZzdWIoZWRnZUNlbnRlciwgZGlzdCk7CiAgICAgICAgICAgIGRpc3QudnN1Yih4aiwgZGlzdCk7IC8vIERpc3RhbmNlcyBpbiB0YW5nZW50IGRpcmVjdGlvbiBhbmQgZGlzdGFuY2UgaW4gdGhlIHBsYW5lIG9ydGhvZ29uYWwgdG8gaXQKCiAgICAgICAgICAgIGNvbnN0IHRkaXN0ID0gTWF0aC5hYnMob3J0aG9ub3JtKTsKICAgICAgICAgICAgY29uc3QgbmRpc3QgPSBkaXN0Lmxlbmd0aCgpOwoKICAgICAgICAgICAgaWYgKHRkaXN0IDwgc2lkZXNbbF0ubGVuZ3RoKCkgJiYgbmRpc3QgPCBSKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTsKICAgICAgICAgICAgICBjb25zdCByZXMgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgICAgIGVkZ2VDZW50ZXIudmFkZChvcnRob2dvbmFsLCByZXMucmopOyAvLyBib3ggcmoKCiAgICAgICAgICAgICAgcmVzLnJqLmNvcHkocmVzLnJqKTsKICAgICAgICAgICAgICBkaXN0Lm5lZ2F0ZShyZXMubmkpOwogICAgICAgICAgICAgIHJlcy5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuY29weShyZXMucmopOwogICAgICAgICAgICAgIHJlcy5yaS52YWRkKHhqLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS52c3ViKHhpLCByZXMucmkpOwogICAgICAgICAgICAgIHJlcy5yaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICByZXMucmkuc2NhbGUoUiwgcmVzLnJpKTsgLy8gTWFrZSByZWxhdGl2ZSB0byBib2RpZXMKCiAgICAgICAgICAgICAgcmVzLnJpLnZhZGQoeGksIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJpLnZzdWIoYmkucG9zaXRpb24sIHJlcy5yaSk7CiAgICAgICAgICAgICAgcmVzLnJqLnZhZGQoeGosIHJlcy5yaik7CiAgICAgICAgICAgICAgcmVzLnJqLnZzdWIoYmoucG9zaXRpb24sIHJlcy5yaik7CiAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyZXMpOwogICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyZXMsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB2M3Bvb2wucmVsZWFzZShlZGdlVGFuZ2VudCwgZWRnZUNlbnRlciwgciwgb3J0aG9nb25hbCwgZGlzdCk7CiAgICB9CgogICAgcGxhbmVCb3goc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2ouY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2oubWF0ZXJpYWw7CiAgICAgIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNqLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICBzai5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24uaWQgPSBzai5pZDsKICAgICAgcmV0dXJuIHRoaXMucGxhbmVDb252ZXgoc2ksIHNqLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgc2ksIHNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgY29udmV4Q29udmV4KHNpLCBzaiwgeGksIHhqLCBxaSwgcWosIGJpLCBiaiwgcnNpLCByc2osIGp1c3RUZXN0LCBmYWNlTGlzdEEsIGZhY2VMaXN0QikgewogICAgICBjb25zdCBzZXBBeGlzID0gY29udmV4Q29udmV4X3NlcEF4aXM7CgogICAgICBpZiAoeGkuZGlzdGFuY2VUbyh4aikgPiBzaS5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNqLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBpZiAoc2kuZmluZFNlcGFyYXRpbmdBeGlzKHNqLCB4aSwgcWksIHhqLCBxaiwgc2VwQXhpcywgZmFjZUxpc3RBLCBmYWNlTGlzdEIpKSB7CiAgICAgICAgY29uc3QgcmVzID0gW107CiAgICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgICAgIHNpLmNsaXBBZ2FpbnN0SHVsbCh4aSwgcWksIHNqLCB4aiwgcWosIHNlcEF4aXMsIC0xMDAsIDEwMCwgcmVzKTsKICAgICAgICBsZXQgbnVtQ29udGFjdHMgPSAwOwoKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiAhPT0gcmVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7CiAgICAgICAgICBzZXBBeGlzLm5lZ2F0ZShyLm5pKTsKICAgICAgICAgIHJlc1tqXS5ub3JtYWwubmVnYXRlKHEpOwogICAgICAgICAgcS5zY2FsZShyZXNbal0uZGVwdGgsIHEpOwogICAgICAgICAgcmVzW2pdLnBvaW50LnZhZGQocSwgcmkpOwogICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOyAvLyBDb250YWN0IHBvaW50cyBhcmUgaW4gd29ybGQgY29vcmRpbmF0ZXMuIFRyYW5zZm9ybSBiYWNrIHRvIHJlbGF0aXZlCgogICAgICAgICAgcmkudnN1Yih4aSwgcmkpOwogICAgICAgICAgcmoudnN1Yih4aiwgcmopOyAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwoKICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgICAgICAgIHJpLnZzdWIoYmkucG9zaXRpb24sIHJpKTsKICAgICAgICAgIHJqLnZhZGQoeGosIHJqKTsKICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICBudW1Db250YWN0cysrOwoKICAgICAgICAgIGlmICghdGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbikgewogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAodGhpcy5lbmFibGVGcmljdGlvblJlZHVjdGlvbiAmJiBudW1Db250YWN0cykgewogICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBzcGhlcmVDb252ZXgoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgY29uc3QgdjNwb29sID0gdGhpcy52M3Bvb2w7CiAgICAgIHhpLnZzdWIoeGosIGNvbnZleF90b19zcGhlcmUpOwogICAgICBjb25zdCBub3JtYWxzID0gc2ouZmFjZU5vcm1hbHM7CiAgICAgIGNvbnN0IGZhY2VzID0gc2ouZmFjZXM7CiAgICAgIGNvbnN0IHZlcnRzID0gc2oudmVydGljZXM7CiAgICAgIGNvbnN0IFIgPSBzaS5yYWRpdXM7CiAgICAgIC8vICAgICByZXR1cm47CiAgICAgIC8vIH0KCiAgICAgIGxldCBmb3VuZCA9IGZhbHNlOyAvLyBDaGVjayBjb3JuZXJzCgogICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gdmVydHMubGVuZ3RoOyBpKyspIHsKICAgICAgICBjb25zdCB2ID0gdmVydHNbaV07IC8vIFdvcmxkIHBvc2l0aW9uIG9mIGNvcm5lcgoKICAgICAgICBjb25zdCB3b3JsZENvcm5lciA9IHNwaGVyZUNvbnZleF93b3JsZENvcm5lcjsKICAgICAgICBxai52bXVsdCh2LCB3b3JsZENvcm5lcik7CiAgICAgICAgeGoudmFkZCh3b3JsZENvcm5lciwgd29ybGRDb3JuZXIpOwogICAgICAgIGNvbnN0IHNwaGVyZV90b19jb3JuZXIgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Db3JuZXI7CiAgICAgICAgd29ybGRDb3JuZXIudnN1Yih4aSwgc3BoZXJlX3RvX2Nvcm5lcik7CgogICAgICAgIGlmIChzcGhlcmVfdG9fY29ybmVyLmxlbmd0aFNxdWFyZWQoKSA8IFIgKiBSKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKGJpLCBiaiwgc2ksIHNqLCByc2ksIHJzaik7CiAgICAgICAgICByLnJpLmNvcHkoc3BoZXJlX3RvX2Nvcm5lcik7CiAgICAgICAgICByLnJpLm5vcm1hbGl6ZSgpOwogICAgICAgICAgci5uaS5jb3B5KHIucmkpOwogICAgICAgICAgci5yaS5zY2FsZShSLCByLnJpKTsKICAgICAgICAgIHdvcmxkQ29ybmVyLnZzdWIoeGosIHIucmopOyAvLyBTaG91bGQgYmUgcmVsYXRpdmUgdG8gdGhlIGJvZHkuCgogICAgICAgICAgci5yaS52YWRkKHhpLCByLnJpKTsKICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsKICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIHNpZGUgKHBsYW5lKSBpbnRlcnNlY3Rpb25zCgoKICAgICAgZm9yIChsZXQgaSA9IDAsIG5mYWNlcyA9IGZhY2VzLmxlbmd0aDsgaSAhPT0gbmZhY2VzICYmIGZvdW5kID09PSBmYWxzZTsgaSsrKSB7CiAgICAgICAgY29uc3Qgbm9ybWFsID0gbm9ybWFsc1tpXTsKICAgICAgICBjb25zdCBmYWNlID0gZmFjZXNbaV07IC8vIEdldCB3b3JsZC10cmFuc2Zvcm1lZCBub3JtYWwgb2YgdGhlIGZhY2UKCiAgICAgICAgY29uc3Qgd29ybGROb3JtYWwgPSBzcGhlcmVDb252ZXhfd29ybGROb3JtYWw7CiAgICAgICAgcWoudm11bHQobm9ybWFsLCB3b3JsZE5vcm1hbCk7IC8vIEdldCBhIHdvcmxkIHZlcnRleCBmcm9tIHRoZSBmYWNlCgogICAgICAgIGNvbnN0IHdvcmxkUG9pbnQgPSBzcGhlcmVDb252ZXhfd29ybGRQb2ludDsKICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWzBdXSwgd29ybGRQb2ludCk7CiAgICAgICAgd29ybGRQb2ludC52YWRkKHhqLCB3b3JsZFBvaW50KTsgLy8gR2V0IGEgcG9pbnQgb24gdGhlIHNwaGVyZSwgY2xvc2VzdCB0byB0aGUgZmFjZSBub3JtYWwKCiAgICAgICAgY29uc3Qgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lID0gc3BoZXJlQ29udmV4X3dvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZTsKICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsKICAgICAgICB4aS52YWRkKHdvcmxkU3BoZXJlUG9pbnRDbG9zZXN0VG9QbGFuZSwgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lKTsgLy8gVmVjdG9yIGZyb20gYSBmYWNlIHBvaW50IHRvIHRoZSBjbG9zZXN0IHBvaW50IG9uIHRoZSBzcGhlcmUKCiAgICAgICAgY29uc3QgcGVuZXRyYXRpb25WZWMgPSBzcGhlcmVDb252ZXhfcGVuZXRyYXRpb25WZWM7CiAgICAgICAgd29ybGRTcGhlcmVQb2ludENsb3Nlc3RUb1BsYW5lLnZzdWIod29ybGRQb2ludCwgcGVuZXRyYXRpb25WZWMpOyAvLyBUaGUgcGVuZXRyYXRpb24uIE5lZ2F0aXZlIHZhbHVlIG1lYW5zIG92ZXJsYXAuCgogICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb25WZWMuZG90KHdvcmxkTm9ybWFsKTsKICAgICAgICBjb25zdCB3b3JsZFBvaW50VG9TcGhlcmUgPSBzcGhlcmVDb252ZXhfc3BoZXJlVG9Xb3JsZFBvaW50OwogICAgICAgIHhpLnZzdWIod29ybGRQb2ludCwgd29ybGRQb2ludFRvU3BoZXJlKTsKCiAgICAgICAgaWYgKHBlbmV0cmF0aW9uIDwgMCAmJiB3b3JsZFBvaW50VG9TcGhlcmUuZG90KHdvcmxkTm9ybWFsKSA+IDApIHsKICAgICAgICAgIC8vIEludGVyc2VjdHMgcGxhbmUuIE5vdyBjaGVjayBpZiB0aGUgc3BoZXJlIGlzIGluc2lkZSB0aGUgZmFjZSBwb2x5Z29uCiAgICAgICAgICBjb25zdCBmYWNlVmVydHMgPSBbXTsgLy8gRmFjZSB2ZXJ0aWNlcywgaW4gd29ybGQgY29vcmRzCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE52ZXJ0cyA9IGZhY2UubGVuZ3RoOyBqICE9PSBOdmVydHM7IGorKykgewogICAgICAgICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgcWoudm11bHQodmVydHNbZmFjZVtqXV0sIHdvcmxkVmVydGV4KTsKICAgICAgICAgICAgeGoudmFkZCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgICAgICBmYWNlVmVydHMucHVzaCh3b3JsZFZlcnRleCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKHBvaW50SW5Qb2x5Z29uKGZhY2VWZXJ0cywgd29ybGROb3JtYWwsIHhpKSkgewogICAgICAgICAgICAvLyBJcyB0aGUgc3BoZXJlIGNlbnRlciBpbiB0aGUgZmFjZSBwb2x5Z29uPwogICAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgZm91bmQgPSB0cnVlOwogICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLVIsIHIucmkpOyAvLyBDb250YWN0IG9mZnNldCwgZnJvbSBzcGhlcmUgY2VudGVyIHRvIGNvbnRhY3QKCiAgICAgICAgICAgIHdvcmxkTm9ybWFsLm5lZ2F0ZShyLm5pKTsgLy8gTm9ybWFsIHBvaW50aW5nIG91dCBvZiBzcGhlcmUKCiAgICAgICAgICAgIGNvbnN0IHBlbmV0cmF0aW9uVmVjMiA9IHYzcG9vbC5nZXQoKTsKICAgICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUoLXBlbmV0cmF0aW9uLCBwZW5ldHJhdGlvblZlYzIpOwogICAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvblNwaGVyZVBvaW50ID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICB3b3JsZE5vcm1hbC5zY2FsZSgtUiwgcGVuZXRyYXRpb25TcGhlcmVQb2ludCk7IC8veGkudnN1Yih4aikudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50KS52YWRkKHBlbmV0cmF0aW9uVmVjMiAsIHIucmopOwoKICAgICAgICAgICAgeGkudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudmFkZChwZW5ldHJhdGlvblNwaGVyZVBvaW50LCByLnJqKTsKICAgICAgICAgICAgci5yai52YWRkKHBlbmV0cmF0aW9uVmVjMiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmoudmFkZCh4aiwgci5yaik7CiAgICAgICAgICAgIHIucmoudnN1Yihiai5wb3NpdGlvbiwgci5yaik7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgIHIucmkudnN1YihiaS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uVmVjMik7CiAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHBlbmV0cmF0aW9uU3BoZXJlUG9pbnQpOwogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCiAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgcmV0dXJuOyAvLyBXZSBvbmx5IGV4cGVjdCAqb25lKiBmYWNlIGNvbnRhY3QKICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIC8vIEVkZ2U/CiAgICAgICAgICAgIGZvciAobGV0IGogPSAwOyBqICE9PSBmYWNlLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICAgICAgLy8gR2V0IHR3byB3b3JsZCB0cmFuc2Zvcm1lZCB2ZXJ0aWNlcwogICAgICAgICAgICAgIGNvbnN0IHYxID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYyID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHFqLnZtdWx0KHZlcnRzW2ZhY2VbKGogKyAxKSAlIGZhY2UubGVuZ3RoXV0sIHYxKTsKICAgICAgICAgICAgICBxai52bXVsdCh2ZXJ0c1tmYWNlWyhqICsgMikgJSBmYWNlLmxlbmd0aF1dLCB2Mik7CiAgICAgICAgICAgICAgeGoudmFkZCh2MSwgdjEpOwogICAgICAgICAgICAgIHhqLnZhZGQodjIsIHYyKTsgLy8gQ29uc3RydWN0IGVkZ2UgdmVjdG9yCgogICAgICAgICAgICAgIGNvbnN0IGVkZ2UgPSBzcGhlcmVDb252ZXhfZWRnZTsKICAgICAgICAgICAgICB2Mi52c3ViKHYxLCBlZGdlKTsgLy8gQ29uc3RydWN0IHRoZSBzYW1lIHZlY3RvciwgYnV0IG5vcm1hbGl6ZWQKCiAgICAgICAgICAgICAgY29uc3QgZWRnZVVuaXQgPSBzcGhlcmVDb252ZXhfZWRnZVVuaXQ7CiAgICAgICAgICAgICAgZWRnZS51bml0KGVkZ2VVbml0KTsgLy8gcCBpcyB4aSBwcm9qZWN0ZWQgb250byB0aGUgZWRnZQoKICAgICAgICAgICAgICBjb25zdCBwID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIGNvbnN0IHYxX3RvX3hpID0gdjNwb29sLmdldCgpOwogICAgICAgICAgICAgIHhpLnZzdWIodjEsIHYxX3RvX3hpKTsKICAgICAgICAgICAgICBjb25zdCBkb3QgPSB2MV90b194aS5kb3QoZWRnZVVuaXQpOwogICAgICAgICAgICAgIGVkZ2VVbml0LnNjYWxlKGRvdCwgcCk7CiAgICAgICAgICAgICAgcC52YWRkKHYxLCBwKTsgLy8gQ29tcHV0ZSBhIHZlY3RvciBmcm9tIHAgdG8gdGhlIGNlbnRlciBvZiB0aGUgc3BoZXJlCgogICAgICAgICAgICAgIGNvbnN0IHhpX3RvX3AgPSB2M3Bvb2wuZ2V0KCk7CiAgICAgICAgICAgICAgcC52c3ViKHhpLCB4aV90b19wKTsgLy8gQ29sbGlzaW9uIGlmIHRoZSBlZGdlLXNwaGVyZSBkaXN0YW5jZSBpcyBsZXNzIHRoYW4gdGhlIHJhZGl1cwogICAgICAgICAgICAgIC8vIEFORCBpZiBwIGlzIGluIGJldHdlZW4gdjEgYW5kIHYyCgogICAgICAgICAgICAgIGlmIChkb3QgPiAwICYmIGRvdCAqIGRvdCA8IGVkZ2UubGVuZ3RoU3F1YXJlZCgpICYmIHhpX3RvX3AubGVuZ3RoU3F1YXJlZCgpIDwgUiAqIFIpIHsKICAgICAgICAgICAgICAgIC8vIENvbGxpc2lvbiBpZiB0aGUgZWRnZS1zcGhlcmUgZGlzdGFuY2UgaXMgbGVzcyB0aGFuIHRoZSByYWRpdXMKICAgICAgICAgICAgICAgIC8vIEVkZ2UgY29udGFjdCEKICAgICAgICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICAgICAgICAgIHAudnN1Yih4aiwgci5yaik7CiAgICAgICAgICAgICAgICBwLnZzdWIoeGksIHIubmkpOwogICAgICAgICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgICAgICAgIHIubmkuc2NhbGUoUiwgci5yaSk7IC8vIFNob3VsZCBiZSByZWxhdGl2ZSB0byB0aGUgYm9keS4KCiAgICAgICAgICAgICAgICByLnJqLnZhZGQoeGosIHIucmopOwogICAgICAgICAgICAgICAgci5yai52c3ViKGJqLnBvc2l0aW9uLCByLnJqKTsgLy8gU2hvdWxkIGJlIHJlbGF0aXZlIHRvIHRoZSBib2R5LgoKICAgICAgICAgICAgICAgIHIucmkudmFkZCh4aSwgci5yaSk7CiAgICAgICAgICAgICAgICByLnJpLnZzdWIoYmkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsgLy8gUmVsZWFzZSB3b3JsZCB2ZXJ0aWNlcwoKICAgICAgICAgICAgICAgIGZvciAobGV0IGogPSAwLCBOZmFjZXZlcnRzID0gZmFjZVZlcnRzLmxlbmd0aDsgaiAhPT0gTmZhY2V2ZXJ0czsgaisrKSB7CiAgICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKGZhY2VWZXJ0c1tqXSk7CiAgICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjEpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjIpOwogICAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh4aV90b19wKTsKICAgICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxX3RvX3hpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIHYzcG9vbC5yZWxlYXNlKHYxKTsKICAgICAgICAgICAgICB2M3Bvb2wucmVsZWFzZSh2Mik7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UocCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoeGlfdG9fcCk7CiAgICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UodjFfdG9feGkpOwogICAgICAgICAgICB9CiAgICAgICAgICB9IC8vIFJlbGVhc2Ugd29ybGQgdmVydGljZXMKCgogICAgICAgICAgZm9yIChsZXQgaiA9IDAsIE5mYWNldmVydHMgPSBmYWNlVmVydHMubGVuZ3RoOyBqICE9PSBOZmFjZXZlcnRzOyBqKyspIHsKICAgICAgICAgICAgdjNwb29sLnJlbGVhc2UoZmFjZVZlcnRzW2pdKTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgIH0KCiAgICBwbGFuZUNvbnZleChwbGFuZVNoYXBlLCBjb252ZXhTaGFwZSwgcGxhbmVQb3NpdGlvbiwgY29udmV4UG9zaXRpb24sIHBsYW5lUXVhdCwgY29udmV4UXVhdCwgcGxhbmVCb2R5LCBjb252ZXhCb2R5LCBzaSwgc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFNpbXBseSByZXR1cm4gdGhlIHBvaW50cyBiZWhpbmQgdGhlIHBsYW5lLgogICAgICBjb25zdCB3b3JsZFZlcnRleCA9IHBsYW5lQ29udmV4X3Y7CiAgICAgIGNvbnN0IHdvcmxkTm9ybWFsID0gcGxhbmVDb252ZXhfbm9ybWFsOwogICAgICB3b3JsZE5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdCh3b3JsZE5vcm1hbCwgd29ybGROb3JtYWwpOyAvLyBUdXJuIG5vcm1hbCBhY2NvcmRpbmcgdG8gcGxhbmUgb3JpZW50YXRpb24KCiAgICAgIGxldCBudW1Db250YWN0cyA9IDA7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lQ29udmV4X3JlbHBvczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpICE9PSBjb252ZXhTaGFwZS52ZXJ0aWNlcy5sZW5ndGg7IGkrKykgewogICAgICAgIC8vIEdldCB3b3JsZCBjb252ZXggdmVydGV4CiAgICAgICAgd29ybGRWZXJ0ZXguY29weShjb252ZXhTaGFwZS52ZXJ0aWNlc1tpXSk7CiAgICAgICAgY29udmV4UXVhdC52bXVsdCh3b3JsZFZlcnRleCwgd29ybGRWZXJ0ZXgpOwogICAgICAgIGNvbnZleFBvc2l0aW9uLnZhZGQod29ybGRWZXJ0ZXgsIHdvcmxkVmVydGV4KTsKICAgICAgICB3b3JsZFZlcnRleC52c3ViKHBsYW5lUG9zaXRpb24sIHJlbHBvcyk7CiAgICAgICAgY29uc3QgZG90ID0gd29ybGROb3JtYWwuZG90KHJlbHBvcyk7CgogICAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgY29uc3QgciA9IHRoaXMuY3JlYXRlQ29udGFjdEVxdWF0aW9uKHBsYW5lQm9keSwgY29udmV4Qm9keSwgcGxhbmVTaGFwZSwgY29udmV4U2hhcGUsIHNpLCBzaik7IC8vIEdldCB2ZXJ0ZXggcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgICAgY29uc3QgcHJvamVjdGVkID0gcGxhbmVDb252ZXhfcHJvamVjdGVkOwogICAgICAgICAgd29ybGROb3JtYWwuc2NhbGUod29ybGROb3JtYWwuZG90KHJlbHBvcyksIHByb2plY3RlZCk7CiAgICAgICAgICB3b3JsZFZlcnRleC52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsKICAgICAgICAgIHByb2plY3RlZC52c3ViKHBsYW5lUG9zaXRpb24sIHIucmkpOyAvLyBGcm9tIHBsYW5lIHRvIHZlcnRleCBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICByLm5pLmNvcHkod29ybGROb3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsIG91dCBmcm9tIHBsYW5lCiAgICAgICAgICAvLyByaiBpcyBub3cganVzdCB0aGUgdmVjdG9yIGZyb20gdGhlIGNvbnZleCBjZW50ZXIgdG8gdGhlIHZlcnRleAoKICAgICAgICAgIHdvcmxkVmVydGV4LnZzdWIoY29udmV4UG9zaXRpb24sIHIucmopOyAvLyBNYWtlIGl0IHJlbGF0aXZlIHRvIHRoZSBib2R5CgogICAgICAgICAgci5yaS52YWRkKHBsYW5lUG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHBsYW5lQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICByLnJqLnZhZGQoY29udmV4UG9zaXRpb24sIHIucmopOwogICAgICAgICAgci5yai52c3ViKGNvbnZleEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIG51bUNvbnRhY3RzKys7CgogICAgICAgICAgaWYgKCF0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uKSB7CiAgICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmICh0aGlzLmVuYWJsZUZyaWN0aW9uUmVkdWN0aW9uICYmIG51bUNvbnRhY3RzKSB7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkZyb21BdmVyYWdlKG51bUNvbnRhY3RzKTsKICAgICAgfQogICAgfQoKICAgIGJveENvbnZleChzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24ubWF0ZXJpYWwgPSBzaS5tYXRlcmlhbDsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLmNvbGxpc2lvblJlc3BvbnNlID0gc2kuY29sbGlzaW9uUmVzcG9uc2U7CiAgICAgIHJldHVybiB0aGlzLmNvbnZleENvbnZleChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBzcGhlcmVIZWlnaHRmaWVsZChzcGhlcmVTaGFwZSwgaGZTaGFwZSwgc3BoZXJlUG9zLCBoZlBvcywgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCByYWRpdXMgPSBzcGhlcmVTaGFwZS5yYWRpdXM7CiAgICAgIGNvbnN0IHcgPSBoZlNoYXBlLmVsZW1lbnRTaXplOwogICAgICBjb25zdCB3b3JsZFBpbGxhck9mZnNldCA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDI7IC8vIEdldCBzcGhlcmUgcG9zaXRpb24gdG8gaGVpZ2h0ZmllbGQgbG9jYWwhCgogICAgICBjb25zdCBsb2NhbFNwaGVyZVBvcyA9IHNwaGVyZUhlaWdodGZpZWxkX3RtcDE7CiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZShoZlBvcywgaGZRdWF0LCBzcGhlcmVQb3MsIGxvY2FsU3BoZXJlUG9zKTsgLy8gR2V0IHRoZSBpbmRleCBvZiB0aGUgZGF0YSBwb2ludHMgdG8gdGVzdCBhZ2FpbnN0CgogICAgICBsZXQgaU1pblggPSBNYXRoLmZsb29yKChsb2NhbFNwaGVyZVBvcy54IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhYID0gTWF0aC5jZWlsKChsb2NhbFNwaGVyZVBvcy54ICsgcmFkaXVzKSAvIHcpICsgMTsKICAgICAgbGV0IGlNaW5ZID0gTWF0aC5mbG9vcigobG9jYWxTcGhlcmVQb3MueSAtIHJhZGl1cykgLyB3KSAtIDE7CiAgICAgIGxldCBpTWF4WSA9IE1hdGguY2VpbCgobG9jYWxTcGhlcmVQb3MueSArIHJhZGl1cykgLyB3KSArIDE7IC8vIEJhaWwgb3V0IGlmIHdlIGFyZSBvdXQgb2YgdGhlIHRlcnJhaW4KCiAgICAgIGlmIChpTWF4WCA8IDAgfHwgaU1heFkgPCAwIHx8IGlNaW5YID4gZGF0YS5sZW5ndGggfHwgaU1pblkgPiBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIHJldHVybjsKICAgICAgfSAvLyBDbGFtcCBpbmRleCB0byBlZGdlcwoKCiAgICAgIGlmIChpTWluWCA8IDApIHsKICAgICAgICBpTWluWCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA8IDApIHsKICAgICAgICBpTWF4WCA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA8IDApIHsKICAgICAgICBpTWluWSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WSA8IDApIHsKICAgICAgICBpTWF4WSA9IDA7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNaW5YID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFggPj0gZGF0YS5sZW5ndGgpIHsKICAgICAgICBpTWF4WCA9IGRhdGEubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1heFkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWluWSA+PSBkYXRhWzBdLmxlbmd0aCkgewogICAgICAgIGlNaW5ZID0gZGF0YVswXS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBjb25zdCBtaW5NYXggPSBbXTsKICAgICAgaGZTaGFwZS5nZXRSZWN0TWluTWF4KGlNaW5YLCBpTWluWSwgaU1heFgsIGlNYXhZLCBtaW5NYXgpOwogICAgICBjb25zdCBtaW4gPSBtaW5NYXhbMF07CiAgICAgIGNvbnN0IG1heCA9IG1pbk1heFsxXTsgLy8gQmFpbCBvdXQgaWYgd2UgY2FuJ3QgdG91Y2ggdGhlIGJvdW5kaW5nIGhlaWdodCBib3gKCiAgICAgIGlmIChsb2NhbFNwaGVyZVBvcy56IC0gcmFkaXVzID4gbWF4IHx8IGxvY2FsU3BoZXJlUG9zLnogKyByYWRpdXMgPCBtaW4pIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0OwoKICAgICAgZm9yIChsZXQgaSA9IGlNaW5YOyBpIDwgaU1heFg7IGkrKykgewogICAgICAgIGZvciAobGV0IGogPSBpTWluWTsgaiA8IGlNYXhZOyBqKyspIHsKICAgICAgICAgIGNvbnN0IG51bUNvbnRhY3RzQmVmb3JlID0gcmVzdWx0Lmxlbmd0aDsKICAgICAgICAgIGxldCBpbnRlcnNlY3RpbmcgPSBmYWxzZTsgLy8gTG93ZXIgdHJpYW5nbGUKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIGZhbHNlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0gLy8gVXBwZXIgdHJpYW5nbGUKCgogICAgICAgICAgaGZTaGFwZS5nZXRDb252ZXhUcmlhbmdsZVBpbGxhcihpLCBqLCB0cnVlKTsKICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZShoZlBvcywgaGZRdWF0LCBoZlNoYXBlLnBpbGxhck9mZnNldCwgd29ybGRQaWxsYXJPZmZzZXQpOwoKICAgICAgICAgIGlmIChzcGhlcmVQb3MuZGlzdGFuY2VUbyh3b3JsZFBpbGxhck9mZnNldCkgPCBoZlNoYXBlLnBpbGxhckNvbnZleC5ib3VuZGluZ1NwaGVyZVJhZGl1cyArIHNwaGVyZVNoYXBlLmJvdW5kaW5nU3BoZXJlUmFkaXVzKSB7CiAgICAgICAgICAgIGludGVyc2VjdGluZyA9IHRoaXMuc3BoZXJlQ29udmV4KHNwaGVyZVNoYXBlLCBoZlNoYXBlLnBpbGxhckNvbnZleCwgc3BoZXJlUG9zLCB3b3JsZFBpbGxhck9mZnNldCwgc3BoZXJlUXVhdCwgaGZRdWF0LCBzcGhlcmVCb2R5LCBoZkJvZHksIHNwaGVyZVNoYXBlLCBoZlNoYXBlLCBqdXN0VGVzdCk7CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGp1c3RUZXN0ICYmIGludGVyc2VjdGluZykgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCBudW1Db250YWN0cyA9IHJlc3VsdC5sZW5ndGggLSBudW1Db250YWN0c0JlZm9yZTsKCiAgICAgICAgICBpZiAobnVtQ29udGFjdHMgPiAyKSB7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgIH0KICAgICAgICAgIC8qCiAgICAgICAgICAgIC8vIFNraXAgYWxsIGJ1dCAxCiAgICAgICAgICAgIGZvciAobGV0IGsgPSAwOyBrIDwgbnVtQ29udGFjdHMgLSAxOyBrKyspIHsKICAgICAgICAgICAgICAgIHJlc3VsdC5wb3AoKTsKICAgICAgICAgICAgfQogICAgICAgICAgKi8KCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYm94SGVpZ2h0ZmllbGQoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBkYXRhID0gaGZTaGFwZS5kYXRhOwogICAgICBjb25zdCB3ID0gaGZTaGFwZS5lbGVtZW50U2l6ZTsKICAgICAgY29uc3QgcmFkaXVzID0gY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXM7CiAgICAgIGNvbnN0IHdvcmxkUGlsbGFyT2Zmc2V0ID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMjsKICAgICAgY29uc3QgZmFjZUxpc3QgPSBjb252ZXhIZWlnaHRmaWVsZF9mYWNlTGlzdDsgLy8gR2V0IHNwaGVyZSBwb3NpdGlvbiB0byBoZWlnaHRmaWVsZCBsb2NhbCEKCiAgICAgIGNvbnN0IGxvY2FsQ29udmV4UG9zID0gY29udmV4SGVpZ2h0ZmllbGRfdG1wMTsKICAgICAgVHJhbnNmb3JtLnBvaW50VG9Mb2NhbEZyYW1lKGhmUG9zLCBoZlF1YXQsIGNvbnZleFBvcywgbG9jYWxDb252ZXhQb3MpOyAvLyBHZXQgdGhlIGluZGV4IG9mIHRoZSBkYXRhIHBvaW50cyB0byB0ZXN0IGFnYWluc3QKCiAgICAgIGxldCBpTWluWCA9IE1hdGguZmxvb3IoKGxvY2FsQ29udmV4UG9zLnggLSByYWRpdXMpIC8gdykgLSAxOwogICAgICBsZXQgaU1heFggPSBNYXRoLmNlaWwoKGxvY2FsQ29udmV4UG9zLnggKyByYWRpdXMpIC8gdykgKyAxOwogICAgICBsZXQgaU1pblkgPSBNYXRoLmZsb29yKChsb2NhbENvbnZleFBvcy55IC0gcmFkaXVzKSAvIHcpIC0gMTsKICAgICAgbGV0IGlNYXhZID0gTWF0aC5jZWlsKChsb2NhbENvbnZleFBvcy55ICsgcmFkaXVzKSAvIHcpICsgMTsgLy8gQmFpbCBvdXQgaWYgd2UgYXJlIG91dCBvZiB0aGUgdGVycmFpbgoKICAgICAgaWYgKGlNYXhYIDwgMCB8fCBpTWF4WSA8IDAgfHwgaU1pblggPiBkYXRhLmxlbmd0aCB8fCBpTWluWSA+IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9IC8vIENsYW1wIGluZGV4IHRvIGVkZ2VzCgoKICAgICAgaWYgKGlNaW5YIDwgMCkgewogICAgICAgIGlNaW5YID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhYIDwgMCkgewogICAgICAgIGlNYXhYID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZIDwgMCkgewogICAgICAgIGlNaW5ZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNYXhZIDwgMCkgewogICAgICAgIGlNYXhZID0gMDsKICAgICAgfQoKICAgICAgaWYgKGlNaW5YID49IGRhdGEubGVuZ3RoKSB7CiAgICAgICAgaU1pblggPSBkYXRhLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGlmIChpTWF4WCA+PSBkYXRhLmxlbmd0aCkgewogICAgICAgIGlNYXhYID0gZGF0YS5sZW5ndGggLSAxOwogICAgICB9CgogICAgICBpZiAoaU1heFkgPj0gZGF0YVswXS5sZW5ndGgpIHsKICAgICAgICBpTWF4WSA9IGRhdGFbMF0ubGVuZ3RoIC0gMTsKICAgICAgfQoKICAgICAgaWYgKGlNaW5ZID49IGRhdGFbMF0ubGVuZ3RoKSB7CiAgICAgICAgaU1pblkgPSBkYXRhWzBdLmxlbmd0aCAtIDE7CiAgICAgIH0KCiAgICAgIGNvbnN0IG1pbk1heCA9IFtdOwogICAgICBoZlNoYXBlLmdldFJlY3RNaW5NYXgoaU1pblgsIGlNaW5ZLCBpTWF4WCwgaU1heFksIG1pbk1heCk7CiAgICAgIGNvbnN0IG1pbiA9IG1pbk1heFswXTsKICAgICAgY29uc3QgbWF4ID0gbWluTWF4WzFdOyAvLyBCYWlsIG91dCBpZiB3ZSdyZSBjYW50IHRvdWNoIHRoZSBib3VuZGluZyBoZWlnaHQgYm94CgogICAgICBpZiAobG9jYWxDb252ZXhQb3MueiAtIHJhZGl1cyA+IG1heCB8fCBsb2NhbENvbnZleFBvcy56ICsgcmFkaXVzIDwgbWluKSB7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICBmb3IgKGxldCBpID0gaU1pblg7IGkgPCBpTWF4WDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IGlNaW5ZOyBqIDwgaU1heFk7IGorKykgewogICAgICAgICAgbGV0IGludGVyc2VjdGluZyA9IGZhbHNlOyAvLyBMb3dlciB0cmlhbmdsZQoKICAgICAgICAgIGhmU2hhcGUuZ2V0Q29udmV4VHJpYW5nbGVQaWxsYXIoaSwgaiwgZmFsc2UpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfSAvLyBVcHBlciB0cmlhbmdsZQoKCiAgICAgICAgICBoZlNoYXBlLmdldENvbnZleFRyaWFuZ2xlUGlsbGFyKGksIGosIHRydWUpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKGhmUG9zLCBoZlF1YXQsIGhmU2hhcGUucGlsbGFyT2Zmc2V0LCB3b3JsZFBpbGxhck9mZnNldCk7CgogICAgICAgICAgaWYgKGNvbnZleFBvcy5kaXN0YW5jZVRvKHdvcmxkUGlsbGFyT2Zmc2V0KSA8IGhmU2hhcGUucGlsbGFyQ29udmV4LmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgY29udmV4U2hhcGUuYm91bmRpbmdTcGhlcmVSYWRpdXMpIHsKICAgICAgICAgICAgaW50ZXJzZWN0aW5nID0gdGhpcy5jb252ZXhDb252ZXgoY29udmV4U2hhcGUsIGhmU2hhcGUucGlsbGFyQ29udmV4LCBjb252ZXhQb3MsIHdvcmxkUGlsbGFyT2Zmc2V0LCBjb252ZXhRdWF0LCBoZlF1YXQsIGNvbnZleEJvZHksIGhmQm9keSwgbnVsbCwgbnVsbCwganVzdFRlc3QsIGZhY2VMaXN0LCBudWxsKTsKICAgICAgICAgIH0KCiAgICAgICAgICBpZiAoanVzdFRlc3QgJiYgaW50ZXJzZWN0aW5nKSB7CiAgICAgICAgICAgIHJldHVybiB0cnVlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIHNwaGVyZVBhcnRpY2xlKHNqLCBzaSwgeGosIHhpLCBxaiwgcWksIGJqLCBiaSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIC8vIFRoZSBub3JtYWwgaXMgdGhlIHVuaXQgdmVjdG9yIGZyb20gc3BoZXJlIGNlbnRlciB0byBwYXJ0aWNsZSBjZW50ZXIKICAgICAgY29uc3Qgbm9ybWFsID0gcGFydGljbGVTcGhlcmVfbm9ybWFsOwogICAgICBub3JtYWwuc2V0KDAsIDAsIDEpOwogICAgICB4aS52c3ViKHhqLCBub3JtYWwpOwogICAgICBjb25zdCBsZW5ndGhTcXVhcmVkID0gbm9ybWFsLmxlbmd0aFNxdWFyZWQoKTsKCiAgICAgIGlmIChsZW5ndGhTcXVhcmVkIDw9IHNqLnJhZGl1cyAqIHNqLnJhZGl1cykgewogICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgfQoKICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oYmksIGJqLCBzaSwgc2osIHJzaSwgcnNqKTsKICAgICAgICBub3JtYWwubm9ybWFsaXplKCk7CiAgICAgICAgci5yai5jb3B5KG5vcm1hbCk7CiAgICAgICAgci5yai5zY2FsZShzai5yYWRpdXMsIHIucmopOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgICAgICByLnJpLnNldCgwLCAwLCAwKTsgLy8gQ2VudGVyIG9mIHBhcnRpY2xlCgogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgcGxhbmVQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBjb25zdCBub3JtYWwgPSBwYXJ0aWNsZVBsYW5lX25vcm1hbDsKICAgICAgbm9ybWFsLnNldCgwLCAwLCAxKTsKICAgICAgYmoucXVhdGVybmlvbi52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZSBvcmllbnRhdGlvbgoKICAgICAgY29uc3QgcmVscG9zID0gcGFydGljbGVQbGFuZV9yZWxwb3M7CiAgICAgIHhpLnZzdWIoYmoucG9zaXRpb24sIHJlbHBvcyk7CiAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgIGlmIChkb3QgPD0gMC4wKSB7CiAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICB9CgogICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgIHIubmkuY29weShub3JtYWwpOyAvLyBDb250YWN0IG5vcm1hbCBpcyB0aGUgcGxhbmUgbm9ybWFsCgogICAgICAgIHIubmkubmVnYXRlKHIubmkpOwogICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKICAgICAgICAvLyBHZXQgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIG9uIHBsYW5lCgogICAgICAgIGNvbnN0IHByb2plY3RlZCA9IHBhcnRpY2xlUGxhbmVfcHJvamVjdGVkOwogICAgICAgIG5vcm1hbC5zY2FsZShub3JtYWwuZG90KHhpKSwgcHJvamVjdGVkKTsKICAgICAgICB4aS52c3ViKHByb2plY3RlZCwgcHJvamVjdGVkKTsgLy9wcm9qZWN0ZWQudmFkZChiai5wb3NpdGlvbixwcm9qZWN0ZWQpOwogICAgICAgIC8vIHJqIGlzIG5vdyB0aGUgcHJvamVjdGVkIHdvcmxkIHBvc2l0aW9uIG1pbnVzIHBsYW5lIHBvc2l0aW9uCgogICAgICAgIHIucmouY29weShwcm9qZWN0ZWQpOwogICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICB9CiAgICB9CgogICAgYm94UGFydGljbGUoc2ksIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgc2kuY29udmV4UG9seWhlZHJvblJlcHJlc2VudGF0aW9uLm1hdGVyaWFsID0gc2kubWF0ZXJpYWw7CiAgICAgIHNpLmNvbnZleFBvbHloZWRyb25SZXByZXNlbnRhdGlvbi5jb2xsaXNpb25SZXNwb25zZSA9IHNpLmNvbGxpc2lvblJlc3BvbnNlOwogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaS5jb252ZXhQb2x5aGVkcm9uUmVwcmVzZW50YXRpb24sIHNqLCB4aSwgeGosIHFpLCBxaiwgYmksIGJqLCBzaSwgc2osIGp1c3RUZXN0KTsKICAgIH0KCiAgICBjb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICBsZXQgcGVuZXRyYXRlZEZhY2VJbmRleCA9IC0xOwogICAgICBjb25zdCBwZW5ldHJhdGVkRmFjZU5vcm1hbCA9IGNvbnZleFBhcnRpY2xlX3BlbmV0cmF0ZWRGYWNlTm9ybWFsOwogICAgICBjb25zdCB3b3JsZFBlbmV0cmF0aW9uVmVjID0gY29udmV4UGFydGljbGVfd29ybGRQZW5ldHJhdGlvblZlYzsKICAgICAgbGV0IG1pblBlbmV0cmF0aW9uID0gbnVsbDsKCiAgICAgIGNvbnN0IGxvY2FsID0gY29udmV4UGFydGljbGVfbG9jYWw7CiAgICAgIGxvY2FsLmNvcHkoeGkpOwogICAgICBsb2NhbC52c3ViKHhqLCBsb2NhbCk7IC8vIENvbnZlcnQgcG9zaXRpb24gdG8gcmVsYXRpdmUgdGhlIGNvbnZleCBvcmlnaW4KCiAgICAgIHFqLmNvbmp1Z2F0ZShjcWopOwogICAgICBjcWoudm11bHQobG9jYWwsIGxvY2FsKTsKCiAgICAgIGlmIChzai5wb2ludElzSW5zaWRlKGxvY2FsKSkgewogICAgICAgIGlmIChzai53b3JsZFZlcnRpY2VzTmVlZHNVcGRhdGUpIHsKICAgICAgICAgIHNqLmNvbXB1dGVXb3JsZFZlcnRpY2VzKHhqLCBxaik7CiAgICAgICAgfQoKICAgICAgICBpZiAoc2oud29ybGRGYWNlTm9ybWFsc05lZWRzVXBkYXRlKSB7CiAgICAgICAgICBzai5jb21wdXRlV29ybGRGYWNlTm9ybWFscyhxaik7CiAgICAgICAgfSAvLyBGb3IgZWFjaCB3b3JsZCBwb2x5Z29uIGluIHRoZSBwb2x5aGVkcmEKCgogICAgICAgIGZvciAobGV0IGkgPSAwLCBuZmFjZXMgPSBzai5mYWNlcy5sZW5ndGg7IGkgIT09IG5mYWNlczsgaSsrKSB7CiAgICAgICAgICAvLyBDb25zdHJ1Y3Qgd29ybGQgZmFjZSB2ZXJ0aWNlcwogICAgICAgICAgY29uc3QgdmVydHMgPSBbc2oud29ybGRWZXJ0aWNlc1tzai5mYWNlc1tpXVswXV1dOwogICAgICAgICAgY29uc3Qgbm9ybWFsID0gc2oud29ybGRGYWNlTm9ybWFsc1tpXTsgLy8gQ2hlY2sgaG93IG11Y2ggdGhlIHBhcnRpY2xlIHBlbmV0cmF0ZXMgdGhlIHBvbHlnb24gcGxhbmUuCgogICAgICAgICAgeGkudnN1Yih2ZXJ0c1swXSwgY29udmV4UGFydGljbGVfdmVydGV4VG9QYXJ0aWNsZSk7CiAgICAgICAgICBjb25zdCBwZW5ldHJhdGlvbiA9IC1ub3JtYWwuZG90KGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUpOwoKICAgICAgICAgIGlmIChtaW5QZW5ldHJhdGlvbiA9PT0gbnVsbCB8fCBNYXRoLmFicyhwZW5ldHJhdGlvbikgPCBNYXRoLmFicyhtaW5QZW5ldHJhdGlvbikpIHsKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIG1pblBlbmV0cmF0aW9uID0gcGVuZXRyYXRpb247CiAgICAgICAgICAgIHBlbmV0cmF0ZWRGYWNlSW5kZXggPSBpOwogICAgICAgICAgICBwZW5ldHJhdGVkRmFjZU5vcm1hbC5jb3B5KG5vcm1hbCk7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAocGVuZXRyYXRlZEZhY2VJbmRleCAhPT0gLTEpIHsKICAgICAgICAgIC8vIFNldHVwIGNvbnRhY3QKICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSwgYmosIHNpLCBzaiwgcnNpLCByc2opOwogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwuc2NhbGUobWluUGVuZXRyYXRpb24sIHdvcmxkUGVuZXRyYXRpb25WZWMpOyAvLyByaiBpcyB0aGUgcGFydGljbGUgcG9zaXRpb24gcHJvamVjdGVkIHRvIHRoZSBmYWNlCgogICAgICAgICAgd29ybGRQZW5ldHJhdGlvblZlYy52YWRkKHhpLCB3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIHdvcmxkUGVuZXRyYXRpb25WZWMudnN1Yih4aiwgd29ybGRQZW5ldHJhdGlvblZlYyk7CiAgICAgICAgICByLnJqLmNvcHkod29ybGRQZW5ldHJhdGlvblZlYyk7IC8vY29uc3QgcHJvamVjdGVkVG9GYWNlID0geGkudnN1Yih4aikudmFkZCh3b3JsZFBlbmV0cmF0aW9uVmVjKTsKICAgICAgICAgIC8vcHJvamVjdGVkVG9GYWNlLmNvcHkoci5yaik7CiAgICAgICAgICAvL3FqLnZtdWx0KHIucmosci5yaik7CgogICAgICAgICAgcGVuZXRyYXRlZEZhY2VOb3JtYWwubmVnYXRlKHIubmkpOyAvLyBDb250YWN0IG5vcm1hbAoKICAgICAgICAgIHIucmkuc2V0KDAsIDAsIDApOyAvLyBDZW50ZXIgb2YgcGFydGljbGUKCiAgICAgICAgICBjb25zdCByaSA9IHIucmk7CiAgICAgICAgICBjb25zdCByaiA9IHIucmo7IC8vIE1ha2UgcmVsYXRpdmUgdG8gYm9kaWVzCgogICAgICAgICAgcmkudmFkZCh4aSwgcmkpOwogICAgICAgICAgcmkudnN1YihiaS5wb3NpdGlvbiwgcmkpOwogICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgICAgICAgcmoudnN1Yihiai5wb3NpdGlvbiwgcmopOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgY29uc29sZS53YXJuKCdQb2ludCBmb3VuZCBpbnNpZGUgY29udmV4LCBidXQgZGlkIG5vdCBmaW5kIHBlbmV0cmF0aW5nIGZhY2UhJyk7CiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgaGVpZ2h0ZmllbGRDeWxpbmRlcihoZlNoYXBlLCBjb252ZXhTaGFwZSwgaGZQb3MsIGNvbnZleFBvcywgaGZRdWF0LCBjb252ZXhRdWF0LCBoZkJvZHksIGNvbnZleEJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhIZWlnaHRmaWVsZChjb252ZXhTaGFwZSwgaGZTaGFwZSwgY29udmV4UG9zLCBoZlBvcywgY29udmV4UXVhdCwgaGZRdWF0LCBjb252ZXhCb2R5LCBoZkJvZHksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgcGFydGljbGVDeWxpbmRlcihzaSwgc2osIHhpLCB4aiwgcWksIHFqLCBiaSwgYmosIHJzaSwgcnNqLCBqdXN0VGVzdCkgewogICAgICByZXR1cm4gdGhpcy5jb252ZXhQYXJ0aWNsZShzaiwgc2ksIHhqLCB4aSwgcWosIHFpLCBiaiwgYmksIHJzaSwgcnNqLCBqdXN0VGVzdCk7CiAgICB9CgogICAgc3BoZXJlVHJpbWVzaChzcGhlcmVTaGFwZSwgdHJpbWVzaFNoYXBlLCBzcGhlcmVQb3MsIHRyaW1lc2hQb3MsIHNwaGVyZVF1YXQsIHRyaW1lc2hRdWF0LCBzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgcnNpLCByc2osIGp1c3RUZXN0KSB7CiAgICAgIGNvbnN0IGVkZ2VWZXJ0ZXhBID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QTsKICAgICAgY29uc3QgZWRnZVZlcnRleEIgPSBzcGhlcmVUcmltZXNoX2VkZ2VWZXJ0ZXhCOwogICAgICBjb25zdCBlZGdlVmVjdG9yID0gc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yOwogICAgICBjb25zdCBlZGdlVmVjdG9yVW5pdCA9IHNwaGVyZVRyaW1lc2hfZWRnZVZlY3RvclVuaXQ7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlUG9zID0gc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZVBvczsKICAgICAgY29uc3QgdG1wID0gc3BoZXJlVHJpbWVzaF90bXA7CiAgICAgIGNvbnN0IGxvY2FsU3BoZXJlQUFCQiA9IHNwaGVyZVRyaW1lc2hfbG9jYWxTcGhlcmVBQUJCOwogICAgICBjb25zdCB2MiA9IHNwaGVyZVRyaW1lc2hfdjI7CiAgICAgIGNvbnN0IHJlbHBvcyA9IHNwaGVyZVRyaW1lc2hfcmVscG9zOwogICAgICBjb25zdCB0cmlhbmdsZXMgPSBzcGhlcmVUcmltZXNoX3RyaWFuZ2xlczsgLy8gQ29udmVydCBzcGhlcmUgcG9zaXRpb24gdG8gbG9jYWwgaW4gdGhlIHRyaW1lc2gKCiAgICAgIFRyYW5zZm9ybS5wb2ludFRvTG9jYWxGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgc3BoZXJlUG9zLCBsb2NhbFNwaGVyZVBvcyk7IC8vIEdldCB0aGUgYWFiYiBvZiB0aGUgc3BoZXJlIGxvY2FsbHkgaW4gdGhlIHRyaW1lc2gKCiAgICAgIGNvbnN0IHNwaGVyZVJhZGl1cyA9IHNwaGVyZVNoYXBlLnJhZGl1czsKICAgICAgbG9jYWxTcGhlcmVBQUJCLmxvd2VyQm91bmQuc2V0KGxvY2FsU3BoZXJlUG9zLnggLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnkgLSBzcGhlcmVSYWRpdXMsIGxvY2FsU3BoZXJlUG9zLnogLSBzcGhlcmVSYWRpdXMpOwogICAgICBsb2NhbFNwaGVyZUFBQkIudXBwZXJCb3VuZC5zZXQobG9jYWxTcGhlcmVQb3MueCArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueSArIHNwaGVyZVJhZGl1cywgbG9jYWxTcGhlcmVQb3MueiArIHNwaGVyZVJhZGl1cyk7CiAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZXNJbkFBQkIobG9jYWxTcGhlcmVBQUJCLCB0cmlhbmdsZXMpOyAvL2ZvciAobGV0IGkgPSAwOyBpIDwgdHJpbWVzaFNoYXBlLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB0cmlhbmdsZXMucHVzaChpKTsgLy8gQWxsCiAgICAgIC8vIFZlcnRpY2VzCgogICAgICBjb25zdCB2ID0gc3BoZXJlVHJpbWVzaF92OwogICAgICBjb25zdCByYWRpdXNTcXVhcmVkID0gc3BoZXJlU2hhcGUucmFkaXVzICogc3BoZXJlU2hhcGUucmFkaXVzOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmlhbmdsZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDM7IGorKykgewogICAgICAgICAgdHJpbWVzaFNoYXBlLmdldFZlcnRleCh0cmltZXNoU2hhcGUuaW5kaWNlc1t0cmlhbmdsZXNbaV0gKiAzICsgal0sIHYpOyAvLyBDaGVjayB2ZXJ0ZXggb3ZlcmxhcCBpbiBzcGhlcmUKCiAgICAgICAgICB2LnZzdWIobG9jYWxTcGhlcmVQb3MsIHJlbHBvcyk7CgogICAgICAgICAgaWYgKHJlbHBvcy5sZW5ndGhTcXVhcmVkKCkgPD0gcmFkaXVzU3F1YXJlZCkgewogICAgICAgICAgICAvLyBTYWZlIHVwCiAgICAgICAgICAgIHYyLmNvcHkodik7CiAgICAgICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOwogICAgICAgICAgICB2LnZzdWIoc3BoZXJlUG9zLCByZWxwb3MpOwoKICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICAgIH0KCiAgICAgICAgICAgIGxldCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24oc3BoZXJlQm9keSwgdHJpbWVzaEJvZHksIHNwaGVyZVNoYXBlLCB0cmltZXNoU2hhcGUsIHJzaSwgcnNqKTsKICAgICAgICAgICAgci5uaS5jb3B5KHJlbHBvcyk7CiAgICAgICAgICAgIHIubmkubm9ybWFsaXplKCk7IC8vIHJpIGlzIHRoZSB2ZWN0b3IgZnJvbSBzcGhlcmUgY2VudGVyIHRvIHRoZSBzcGhlcmUgc3VyZmFjZQoKICAgICAgICAgICAgci5yaS5jb3B5KHIubmkpOwogICAgICAgICAgICByLnJpLnNjYWxlKHNwaGVyZVNoYXBlLnJhZGl1cywgci5yaSk7CiAgICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgIHIucmouY29weSh2KTsKICAgICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgICB0aGlzLnJlc3VsdC5wdXNoKHIpOwogICAgICAgICAgICB0aGlzLmNyZWF0ZUZyaWN0aW9uRXF1YXRpb25zRnJvbUNvbnRhY3QociwgdGhpcy5mcmljdGlvblJlc3VsdCk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIENoZWNrIGFsbCBlZGdlcwoKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCAzOyBqKyspIHsKICAgICAgICAgIHRyaW1lc2hTaGFwZS5nZXRWZXJ0ZXgodHJpbWVzaFNoYXBlLmluZGljZXNbdHJpYW5nbGVzW2ldICogMyArIGpdLCBlZGdlVmVydGV4QSk7CiAgICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KHRyaW1lc2hTaGFwZS5pbmRpY2VzW3RyaWFuZ2xlc1tpXSAqIDMgKyAoaiArIDEpICUgM10sIGVkZ2VWZXJ0ZXhCKTsKICAgICAgICAgIGVkZ2VWZXJ0ZXhCLnZzdWIoZWRnZVZlcnRleEEsIGVkZ2VWZWN0b3IpOyAvLyBQcm9qZWN0IHNwaGVyZSBwb3NpdGlvbiB0byB0aGUgZWRnZQoKICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEIsIHRtcCk7CiAgICAgICAgICBjb25zdCBwb3NpdGlvbkFsb25nRWRnZUIgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwogICAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1YihlZGdlVmVydGV4QSwgdG1wKTsKICAgICAgICAgIGxldCBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3IpOwoKICAgICAgICAgIGlmIChwb3NpdGlvbkFsb25nRWRnZUEgPiAwICYmIHBvc2l0aW9uQWxvbmdFZGdlQiA8IDApIHsKICAgICAgICAgICAgLy8gTm93IGNoZWNrIHRoZSBvcnRob2dvbmFsIGRpc3RhbmNlIGZyb20gZWRnZSB0byBzcGhlcmUgY2VudGVyCiAgICAgICAgICAgIGxvY2FsU3BoZXJlUG9zLnZzdWIoZWRnZVZlcnRleEEsIHRtcCk7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0LmNvcHkoZWRnZVZlY3Rvcik7CiAgICAgICAgICAgIGVkZ2VWZWN0b3JVbml0Lm5vcm1hbGl6ZSgpOwogICAgICAgICAgICBwb3NpdGlvbkFsb25nRWRnZUEgPSB0bXAuZG90KGVkZ2VWZWN0b3JVbml0KTsKICAgICAgICAgICAgZWRnZVZlY3RvclVuaXQuc2NhbGUocG9zaXRpb25BbG9uZ0VkZ2VBLCB0bXApOwogICAgICAgICAgICB0bXAudmFkZChlZGdlVmVydGV4QSwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIGNlbnRlciBwb3NpdGlvbiBwcm9qZWN0ZWQgdG8gdGhlIGVkZ2UsIGRlZmluZWQgbG9jYWxseSBpbiB0aGUgdHJpbWVzaCBmcmFtZQoKICAgICAgICAgICAgY29uc3QgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgICAgIGlmIChkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICAgICAgaWYgKGp1c3RUZXN0KSB7CiAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgICAgICB9CgogICAgICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgICAgIHRtcC52c3ViKGxvY2FsU3BoZXJlUG9zLCByLm5pKTsKICAgICAgICAgICAgICByLm5pLm5vcm1hbGl6ZSgpOwogICAgICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZhZGQoc3BoZXJlUG9zLCByLnJpKTsKICAgICAgICAgICAgICByLnJpLnZzdWIoc3BoZXJlQm9keS5wb3NpdGlvbiwgci5yaSk7CiAgICAgICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICAgICAgdG1wLnZzdWIodHJpbWVzaEJvZHkucG9zaXRpb24sIHIucmopOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIubmksIHIubmkpOwogICAgICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgICAgIHRoaXMucmVzdWx0LnB1c2gocik7CiAgICAgICAgICAgICAgdGhpcy5jcmVhdGVGcmljdGlvbkVxdWF0aW9uc0Zyb21Db250YWN0KHIsIHRoaXMuZnJpY3Rpb25SZXN1bHQpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9IC8vIFRyaWFuZ2xlIGZhY2VzCgoKICAgICAgY29uc3QgdmEgPSBzcGhlcmVUcmltZXNoX3ZhOwogICAgICBjb25zdCB2YiA9IHNwaGVyZVRyaW1lc2hfdmI7CiAgICAgIGNvbnN0IHZjID0gc3BoZXJlVHJpbWVzaF92YzsKICAgICAgY29uc3Qgbm9ybWFsID0gc3BoZXJlVHJpbWVzaF9ub3JtYWw7CgogICAgICBmb3IgKGxldCBpID0gMCwgTiA9IHRyaWFuZ2xlcy5sZW5ndGg7IGkgIT09IE47IGkrKykgewogICAgICAgIHRyaW1lc2hTaGFwZS5nZXRUcmlhbmdsZVZlcnRpY2VzKHRyaWFuZ2xlc1tpXSwgdmEsIHZiLCB2Yyk7CiAgICAgICAgdHJpbWVzaFNoYXBlLmdldE5vcm1hbCh0cmlhbmdsZXNbaV0sIG5vcm1hbCk7CiAgICAgICAgbG9jYWxTcGhlcmVQb3MudnN1Yih2YSwgdG1wKTsKICAgICAgICBsZXQgZGlzdCA9IHRtcC5kb3Qobm9ybWFsKTsKICAgICAgICBub3JtYWwuc2NhbGUoZGlzdCwgdG1wKTsKICAgICAgICBsb2NhbFNwaGVyZVBvcy52c3ViKHRtcCwgdG1wKTsgLy8gdG1wIGlzIG5vdyB0aGUgc3BoZXJlIHBvc2l0aW9uIHByb2plY3RlZCB0byB0aGUgdHJpYW5nbGUgcGxhbmUKCiAgICAgICAgZGlzdCA9IHRtcC5kaXN0YW5jZVRvKGxvY2FsU3BoZXJlUG9zKTsKCiAgICAgICAgaWYgKFJheS5wb2ludEluVHJpYW5nbGUodG1wLCB2YSwgdmIsIHZjKSAmJiBkaXN0IDwgc3BoZXJlU2hhcGUucmFkaXVzKSB7CiAgICAgICAgICBpZiAoanVzdFRlc3QpIHsKICAgICAgICAgICAgcmV0dXJuIHRydWU7CiAgICAgICAgICB9CgogICAgICAgICAgbGV0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihzcGhlcmVCb2R5LCB0cmltZXNoQm9keSwgc3BoZXJlU2hhcGUsIHRyaW1lc2hTaGFwZSwgcnNpLCByc2opOwogICAgICAgICAgdG1wLnZzdWIobG9jYWxTcGhlcmVQb3MsIHIubmkpOwogICAgICAgICAgci5uaS5ub3JtYWxpemUoKTsKICAgICAgICAgIHIubmkuc2NhbGUoc3BoZXJlU2hhcGUucmFkaXVzLCByLnJpKTsKICAgICAgICAgIHIucmkudmFkZChzcGhlcmVQb3MsIHIucmkpOwogICAgICAgICAgci5yaS52c3ViKHNwaGVyZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgVHJhbnNmb3JtLnBvaW50VG9Xb3JsZEZyYW1lKHRyaW1lc2hQb3MsIHRyaW1lc2hRdWF0LCB0bXAsIHRtcCk7CiAgICAgICAgICB0bXAudnN1Yih0cmltZXNoQm9keS5wb3NpdGlvbiwgci5yaik7CiAgICAgICAgICBUcmFuc2Zvcm0udmVjdG9yVG9Xb3JsZEZyYW1lKHRyaW1lc2hRdWF0LCByLm5pLCByLm5pKTsKICAgICAgICAgIFRyYW5zZm9ybS52ZWN0b3JUb1dvcmxkRnJhbWUodHJpbWVzaFF1YXQsIHIucmksIHIucmkpOwogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRyaWFuZ2xlcy5sZW5ndGggPSAwOwogICAgfQoKICAgIHBsYW5lVHJpbWVzaChwbGFuZVNoYXBlLCB0cmltZXNoU2hhcGUsIHBsYW5lUG9zLCB0cmltZXNoUG9zLCBwbGFuZVF1YXQsIHRyaW1lc2hRdWF0LCBwbGFuZUJvZHksIHRyaW1lc2hCb2R5LCByc2ksIHJzaiwganVzdFRlc3QpIHsKICAgICAgLy8gTWFrZSBjb250YWN0cyEKICAgICAgY29uc3QgdiA9IG5ldyBWZWMzKCk7CiAgICAgIGNvbnN0IG5vcm1hbCA9IHBsYW5lVHJpbWVzaF9ub3JtYWw7CiAgICAgIG5vcm1hbC5zZXQoMCwgMCwgMSk7CiAgICAgIHBsYW5lUXVhdC52bXVsdChub3JtYWwsIG5vcm1hbCk7IC8vIFR1cm4gbm9ybWFsIGFjY29yZGluZyB0byBwbGFuZQoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0cmltZXNoU2hhcGUudmVydGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAgICAgLy8gR2V0IHdvcmxkIHZlcnRleCBmcm9tIHRyaW1lc2gKICAgICAgICB0cmltZXNoU2hhcGUuZ2V0VmVydGV4KGksIHYpOyAvLyBTYWZlIHVwCgogICAgICAgIGNvbnN0IHYyID0gbmV3IFZlYzMoKTsKICAgICAgICB2Mi5jb3B5KHYpOwogICAgICAgIFRyYW5zZm9ybS5wb2ludFRvV29ybGRGcmFtZSh0cmltZXNoUG9zLCB0cmltZXNoUXVhdCwgdjIsIHYpOyAvLyBDaGVjayBwbGFuZSBzaWRlCgogICAgICAgIGNvbnN0IHJlbHBvcyA9IHBsYW5lVHJpbWVzaF9yZWxwb3M7CiAgICAgICAgdi52c3ViKHBsYW5lUG9zLCByZWxwb3MpOwogICAgICAgIGNvbnN0IGRvdCA9IG5vcm1hbC5kb3QocmVscG9zKTsKCiAgICAgICAgaWYgKGRvdCA8PSAwLjApIHsKICAgICAgICAgIGlmIChqdXN0VGVzdCkgewogICAgICAgICAgICByZXR1cm4gdHJ1ZTsKICAgICAgICAgIH0KCiAgICAgICAgICBjb25zdCByID0gdGhpcy5jcmVhdGVDb250YWN0RXF1YXRpb24ocGxhbmVCb2R5LCB0cmltZXNoQm9keSwgcGxhbmVTaGFwZSwgdHJpbWVzaFNoYXBlLCByc2ksIHJzaik7CiAgICAgICAgICByLm5pLmNvcHkobm9ybWFsKTsgLy8gQ29udGFjdCBub3JtYWwgaXMgdGhlIHBsYW5lIG5vcm1hbAogICAgICAgICAgLy8gR2V0IHZlcnRleCBwb3NpdGlvbiBwcm9qZWN0ZWQgb24gcGxhbmUKCiAgICAgICAgICBjb25zdCBwcm9qZWN0ZWQgPSBwbGFuZVRyaW1lc2hfcHJvamVjdGVkOwogICAgICAgICAgbm9ybWFsLnNjYWxlKHJlbHBvcy5kb3Qobm9ybWFsKSwgcHJvamVjdGVkKTsKICAgICAgICAgIHYudnN1Yihwcm9qZWN0ZWQsIHByb2plY3RlZCk7IC8vIHJpIGlzIHRoZSBwcm9qZWN0ZWQgd29ybGQgcG9zaXRpb24gbWludXMgcGxhbmUgcG9zaXRpb24KCiAgICAgICAgICByLnJpLmNvcHkocHJvamVjdGVkKTsKICAgICAgICAgIHIucmkudnN1YihwbGFuZUJvZHkucG9zaXRpb24sIHIucmkpOwogICAgICAgICAgci5yai5jb3B5KHYpOwogICAgICAgICAgci5yai52c3ViKHRyaW1lc2hCb2R5LnBvc2l0aW9uLCByLnJqKTsgLy8gU3RvcmUgcmVzdWx0CgogICAgICAgICAgdGhpcy5yZXN1bHQucHVzaChyKTsKICAgICAgICAgIHRoaXMuY3JlYXRlRnJpY3Rpb25FcXVhdGlvbnNGcm9tQ29udGFjdChyLCB0aGlzLmZyaWN0aW9uUmVzdWx0KTsKICAgICAgICB9CiAgICAgIH0KICAgIH0gLy8gY29udmV4VHJpbWVzaCgKICAgIC8vICAgc2k6IENvbnZleFBvbHloZWRyb24sIHNqOiBUcmltZXNoLCB4aTogVmVjMywgeGo6IFZlYzMsIHFpOiBRdWF0ZXJuaW9uLCBxajogUXVhdGVybmlvbiwKICAgIC8vICAgYmk6IEJvZHksIGJqOiBCb2R5LCByc2k/OiBTaGFwZSB8IG51bGwsIHJzaj86IFNoYXBlIHwgbnVsbCwKICAgIC8vICAgZmFjZUxpc3RBPzogbnVtYmVyW10gfCBudWxsLCBmYWNlTGlzdEI/OiBudW1iZXJbXSB8IG51bGwsCiAgICAvLyApIHsKICAgIC8vICAgY29uc3Qgc2VwQXhpcyA9IGNvbnZleENvbnZleF9zZXBBeGlzOwogICAgLy8gICBpZih4aS5kaXN0YW5jZVRvKHhqKSA+IHNpLmJvdW5kaW5nU3BoZXJlUmFkaXVzICsgc2ouYm91bmRpbmdTcGhlcmVSYWRpdXMpewogICAgLy8gICAgICAgcmV0dXJuOwogICAgLy8gICB9CiAgICAvLyAgIC8vIENvbnN0cnVjdCBhIHRlbXAgaHVsbCBmb3IgZWFjaCB0cmlhbmdsZQogICAgLy8gICBjb25zdCBodWxsQiA9IG5ldyBDb252ZXhQb2x5aGVkcm9uKCk7CiAgICAvLyAgIGh1bGxCLmZhY2VzID0gW1swLDEsMl1dOwogICAgLy8gICBjb25zdCB2YSA9IG5ldyBWZWMzKCk7CiAgICAvLyAgIGNvbnN0IHZiID0gbmV3IFZlYzMoKTsKICAgIC8vICAgY29uc3QgdmMgPSBuZXcgVmVjMygpOwogICAgLy8gICBodWxsQi52ZXJ0aWNlcyA9IFsKICAgIC8vICAgICAgIHZhLAogICAgLy8gICAgICAgdmIsCiAgICAvLyAgICAgICB2YwogICAgLy8gICBdOwogICAgLy8gICBmb3IgKGxldCBpID0gMDsgaSA8IHNqLmluZGljZXMubGVuZ3RoIC8gMzsgaSsrKSB7CiAgICAvLyAgICAgICBjb25zdCB0cmlhbmdsZU5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgICAvLyAgICAgICBzai5nZXROb3JtYWwoaSwgdHJpYW5nbGVOb3JtYWwpOwogICAgLy8gICAgICAgaHVsbEIuZmFjZU5vcm1hbHMgPSBbdHJpYW5nbGVOb3JtYWxdOwogICAgLy8gICAgICAgc2ouZ2V0VHJpYW5nbGVWZXJ0aWNlcyhpLCB2YSwgdmIsIHZjKTsKICAgIC8vICAgICAgIGxldCBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICBpZighZCl7CiAgICAvLyAgICAgICAgICAgdHJpYW5nbGVOb3JtYWwuc2NhbGUoLTEsIHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICBkID0gc2kudGVzdFNlcEF4aXModHJpYW5nbGVOb3JtYWwsIGh1bGxCLCB4aSwgcWksIHhqLCBxaik7CiAgICAvLyAgICAgICAgICAgaWYoIWQpewogICAgLy8gICAgICAgICAgICAgICBjb250aW51ZTsKICAgIC8vICAgICAgICAgICB9CiAgICAvLyAgICAgICB9CiAgICAvLyAgICAgICBjb25zdCByZXM6IENvbnZleFBvbHloZWRyb25Db250YWN0UG9pbnRbXSA9IFtdOwogICAgLy8gICAgICAgY29uc3QgcSA9IGNvbnZleENvbnZleF9xOwogICAgLy8gICAgICAgc2kuY2xpcEFnYWluc3RIdWxsKHhpLHFpLGh1bGxCLHhqLHFqLHRyaWFuZ2xlTm9ybWFsLC0xMDAsMTAwLHJlcyk7CiAgICAvLyAgICAgICBmb3IobGV0IGogPSAwOyBqICE9PSByZXMubGVuZ3RoOyBqKyspewogICAgLy8gICAgICAgICAgIGNvbnN0IHIgPSB0aGlzLmNyZWF0ZUNvbnRhY3RFcXVhdGlvbihiaSxiaixzaSxzaixyc2kscnNqKSwKICAgIC8vICAgICAgICAgICAgICAgcmkgPSByLnJpLAogICAgLy8gICAgICAgICAgICAgICByaiA9IHIucmo7CiAgICAvLyAgICAgICAgICAgci5uaS5jb3B5KHRyaWFuZ2xlTm9ybWFsKTsKICAgIC8vICAgICAgICAgICByLm5pLm5lZ2F0ZShyLm5pKTsKICAgIC8vICAgICAgICAgICByZXNbal0ubm9ybWFsLm5lZ2F0ZShxKTsKICAgIC8vICAgICAgICAgICBxLm11bHQocmVzW2pdLmRlcHRoLCBxKTsKICAgIC8vICAgICAgICAgICByZXNbal0ucG9pbnQudmFkZChxLCByaSk7CiAgICAvLyAgICAgICAgICAgcmouY29weShyZXNbal0ucG9pbnQpOwogICAgLy8gICAgICAgICAgIC8vIENvbnRhY3QgcG9pbnRzIGFyZSBpbiB3b3JsZCBjb29yZGluYXRlcy4gVHJhbnNmb3JtIGJhY2sgdG8gcmVsYXRpdmUKICAgIC8vICAgICAgICAgICByaS52c3ViKHhpLHJpKTsKICAgIC8vICAgICAgICAgICByai52c3ViKHhqLHJqKTsKICAgIC8vICAgICAgICAgICAvLyBNYWtlIHJlbGF0aXZlIHRvIGJvZGllcwogICAgLy8gICAgICAgICAgIHJpLnZhZGQoeGksIHJpKTsKICAgIC8vICAgICAgICAgICByaS52c3ViKGJpLnBvc2l0aW9uLCByaSk7CiAgICAvLyAgICAgICAgICAgcmoudmFkZCh4aiwgcmopOwogICAgLy8gICAgICAgICAgIHJqLnZzdWIoYmoucG9zaXRpb24sIHJqKTsKICAgIC8vICAgICAgICAgICByZXN1bHQucHVzaChyKTsKICAgIC8vICAgICAgIH0KICAgIC8vICAgfQogICAgLy8gfQoKCiAgfQogIGNvbnN0IGF2ZXJhZ2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGF2ZXJhZ2VDb250YWN0UG9pbnRBID0gbmV3IFZlYzMoKTsKICBjb25zdCBhdmVyYWdlQ29udGFjdFBvaW50QiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wVmVjMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgdG1wUXVhdDEgPSBuZXcgUXVhdGVybmlvbigpOwogIGNvbnN0IHRtcFF1YXQyID0gbmV3IFF1YXRlcm5pb24oKTsKCiAgY29uc3QgcGxhbmVUcmltZXNoX25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3JlbHBvcyA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVUcmltZXNoX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfcmVscG9zID0gbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92MiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVydGV4QiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9lZGdlVmVjdG9yID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2VkZ2VWZWN0b3JVbml0ID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX2xvY2FsU3BoZXJlUG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVUcmltZXNoX3RtcCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YiA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF92YyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlVHJpbWVzaF9sb2NhbFNwaGVyZUFBQkIgPSBuZXcgQUFCQigpOwogIGNvbnN0IHNwaGVyZVRyaW1lc2hfdHJpYW5nbGVzID0gW107CiAgY29uc3QgcG9pbnRfb25fcGxhbmVfdG9fc3BoZXJlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZV90b19zcGhlcmVfb3J0aG8gPSBuZXcgVmVjMygpOyAvLyBTZWUgaHR0cDovL2J1bGxldHBoeXNpY3MuY29tL0J1bGxldC9CdWxsZXRGdWxsL1NwaGVyZVRyaWFuZ2xlRGV0ZWN0b3JfOGNwcF9zb3VyY2UuaHRtbAoKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl9lZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKICBjb25zdCBwb2ludEluUG9seWdvbl92dHAgPSBuZXcgVmVjMygpOwoKICBmdW5jdGlvbiBwb2ludEluUG9seWdvbih2ZXJ0cywgbm9ybWFsLCBwKSB7CiAgICBsZXQgcG9zaXRpdmVSZXN1bHQgPSBudWxsOwogICAgY29uc3QgTiA9IHZlcnRzLmxlbmd0aDsKCiAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgIGNvbnN0IHYgPSB2ZXJ0c1tpXTsgLy8gR2V0IGVkZ2UgdG8gdGhlIG5leHQgdmVydGV4CgogICAgICBjb25zdCBlZGdlID0gcG9pbnRJblBvbHlnb25fZWRnZTsKICAgICAgdmVydHNbKGkgKyAxKSAlIE5dLnZzdWIodiwgZWRnZSk7IC8vIEdldCBjcm9zcyBwcm9kdWN0IGJldHdlZW4gcG9seWdvbiBub3JtYWwgYW5kIHRoZSBlZGdlCgogICAgICBjb25zdCBlZGdlX3hfbm9ybWFsID0gcG9pbnRJblBvbHlnb25fZWRnZV94X25vcm1hbDsgLy9jb25zdCBlZGdlX3hfbm9ybWFsID0gbmV3IFZlYzMoKTsKCiAgICAgIGVkZ2UuY3Jvc3Mobm9ybWFsLCBlZGdlX3hfbm9ybWFsKTsgLy8gR2V0IHZlY3RvciBiZXR3ZWVuIHBvaW50IGFuZCBjdXJyZW50IHZlcnRleAoKICAgICAgY29uc3QgdmVydGV4X3RvX3AgPSBwb2ludEluUG9seWdvbl92dHA7CiAgICAgIHAudnN1Yih2LCB2ZXJ0ZXhfdG9fcCk7IC8vIFRoaXMgZG90IHByb2R1Y3QgZGV0ZXJtaW5lcyB3aGljaCBzaWRlIG9mIHRoZSBlZGdlIHRoZSBwb2ludCBpcwoKICAgICAgY29uc3QgciA9IGVkZ2VfeF9ub3JtYWwuZG90KHZlcnRleF90b19wKTsgLy8gSWYgYWxsIHN1Y2ggZG90IHByb2R1Y3RzIGhhdmUgc2FtZSBzaWduLCB3ZSBhcmUgaW5zaWRlIHRoZSBwb2x5Z29uLgoKICAgICAgaWYgKHBvc2l0aXZlUmVzdWx0ID09PSBudWxsIHx8IHIgPiAwICYmIHBvc2l0aXZlUmVzdWx0ID09PSB0cnVlIHx8IHIgPD0gMCAmJiBwb3NpdGl2ZVJlc3VsdCA9PT0gZmFsc2UpIHsKICAgICAgICBpZiAocG9zaXRpdmVSZXN1bHQgPT09IG51bGwpIHsKICAgICAgICAgIHBvc2l0aXZlUmVzdWx0ID0gciA+IDA7CiAgICAgICAgfQoKICAgICAgICBjb250aW51ZTsKICAgICAgfSBlbHNlIHsKICAgICAgICByZXR1cm4gZmFsc2U7IC8vIEVuY291bnRlcmVkIHNvbWUgb3RoZXIgc2lnbi4gRXhpdC4KICAgICAgfQogICAgfSAvLyBJZiB3ZSBnb3QgaGVyZSwgYWxsIGRvdCBwcm9kdWN0cyB3ZXJlIG9mIHRoZSBzYW1lIHNpZ24uCgoKICAgIHJldHVybiB0cnVlOwogIH0KCiAgY29uc3QgYm94X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQm94X25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMxID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfbnMyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZXMgPSBbbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKSwgbmV3IFZlYzMoKV07CiAgY29uc3Qgc3BoZXJlQm94X3NwaGVyZV90b19jb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVCb3hfc2lkZV9uczEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUJveF9zaWRlX25zMiA9IG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4X3RvX3NwaGVyZSA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X2VkZ2UgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9lZGdlVW5pdCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvQ29ybmVyID0gbmV3IFZlYzMoKTsKICBjb25zdCBzcGhlcmVDb252ZXhfd29ybGRDb3JuZXIgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZE5vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3dvcmxkUG9pbnQgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF93b3JsZFNwaGVyZVBvaW50Q2xvc2VzdFRvUGxhbmUgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUNvbnZleF9wZW5ldHJhdGlvblZlYyA9IG5ldyBWZWMzKCk7CiAgY29uc3Qgc3BoZXJlQ29udmV4X3NwaGVyZVRvV29ybGRQb2ludCA9IG5ldyBWZWMzKCk7CiAgbmV3IFZlYzMoKTsKICBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X3YgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBsYW5lQ29udmV4X25vcm1hbCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGxhbmVDb252ZXhfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwbGFuZUNvbnZleF9wcm9qZWN0ZWQgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleENvbnZleF9zZXBBeGlzID0gbmV3IFZlYzMoKTsKICBjb25zdCBjb252ZXhDb252ZXhfcSA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVQbGFuZV9ub3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IHBhcnRpY2xlUGxhbmVfcmVscG9zID0gbmV3IFZlYzMoKTsKICBjb25zdCBwYXJ0aWNsZVBsYW5lX3Byb2plY3RlZCA9IG5ldyBWZWMzKCk7CiAgY29uc3QgcGFydGljbGVTcGhlcmVfbm9ybWFsID0gbmV3IFZlYzMoKTsgLy8gV0lQCgogIGNvbnN0IGNxaiA9IG5ldyBRdWF0ZXJuaW9uKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfbG9jYWwgPSBuZXcgVmVjMygpOwogIG5ldyBWZWMzKCk7CiAgY29uc3QgY29udmV4UGFydGljbGVfcGVuZXRyYXRlZEZhY2VOb3JtYWwgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3ZlcnRleFRvUGFydGljbGUgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleFBhcnRpY2xlX3dvcmxkUGVuZXRyYXRpb25WZWMgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwogIGNvbnN0IGNvbnZleEhlaWdodGZpZWxkX2ZhY2VMaXN0ID0gWzBdOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDEgPSBuZXcgVmVjMygpOwogIGNvbnN0IHNwaGVyZUhlaWdodGZpZWxkX3RtcDIgPSBuZXcgVmVjMygpOwoKICBjbGFzcyBPdmVybGFwS2VlcGVyIHsKICAgIC8qKgogICAgICogQHRvZG8gUmVtb3ZlIHVzZWxlc3MgY29uc3RydWN0b3IKICAgICAqLwogICAgY29uc3RydWN0b3IoKSB7CiAgICAgIHRoaXMuY3VycmVudCA9IFtdOwogICAgICB0aGlzLnByZXZpb3VzID0gW107CiAgICB9CiAgICAvKioKICAgICAqIGdldEtleQogICAgICovCgoKICAgIGdldEtleShpLCBqKSB7CiAgICAgIGlmIChqIDwgaSkgewogICAgICAgIGNvbnN0IHRlbXAgPSBqOwogICAgICAgIGogPSBpOwogICAgICAgIGkgPSB0ZW1wOwogICAgICB9CgogICAgICByZXR1cm4gaSA8PCAxNiB8IGo7CiAgICB9CiAgICAvKioKICAgICAqIHNldAogICAgICovCgoKICAgIHNldChpLCBqKSB7CiAgICAgIC8vIEluc2VydGlvbiBzb3J0LiBUaGlzIHdheSB0aGUgZGlmZiB3aWxsIGhhdmUgbGluZWFyIGNvbXBsZXhpdHkuCiAgICAgIGNvbnN0IGtleSA9IHRoaXMuZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBjdXJyZW50ID0gdGhpcy5jdXJyZW50OwogICAgICBsZXQgaW5kZXggPSAwOwoKICAgICAgd2hpbGUgKGtleSA+IGN1cnJlbnRbaW5kZXhdKSB7CiAgICAgICAgaW5kZXgrKzsKICAgICAgfQoKICAgICAgaWYgKGtleSA9PT0gY3VycmVudFtpbmRleF0pIHsKICAgICAgICByZXR1cm47IC8vIFBhaXIgd2FzIGFscmVhZHkgYWRkZWQKICAgICAgfQoKICAgICAgZm9yIChsZXQgaiA9IGN1cnJlbnQubGVuZ3RoIC0gMTsgaiA+PSBpbmRleDsgai0tKSB7CiAgICAgICAgY3VycmVudFtqICsgMV0gPSBjdXJyZW50W2pdOwogICAgICB9CgogICAgICBjdXJyZW50W2luZGV4XSA9IGtleTsKICAgIH0KICAgIC8qKgogICAgICogdGljawogICAgICovCgoKICAgIHRpY2soKSB7CiAgICAgIGNvbnN0IHRtcCA9IHRoaXMuY3VycmVudDsKICAgICAgdGhpcy5jdXJyZW50ID0gdGhpcy5wcmV2aW91czsKICAgICAgdGhpcy5wcmV2aW91cyA9IHRtcDsKICAgICAgdGhpcy5jdXJyZW50Lmxlbmd0aCA9IDA7CiAgICB9CiAgICAvKioKICAgICAqIGdldERpZmYKICAgICAqLwoKCiAgICBnZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpIHsKICAgICAgY29uc3QgYSA9IHRoaXMuY3VycmVudDsKICAgICAgY29uc3QgYiA9IHRoaXMucHJldmlvdXM7CiAgICAgIGNvbnN0IGFsID0gYS5sZW5ndGg7CiAgICAgIGNvbnN0IGJsID0gYi5sZW5ndGg7CiAgICAgIGxldCBqID0gMDsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYWw7IGkrKykgewogICAgICAgIGxldCBmb3VuZCA9IGZhbHNlOwogICAgICAgIGNvbnN0IGtleUEgPSBhW2ldOwoKICAgICAgICB3aGlsZSAoa2V5QSA+IGJbal0pIHsKICAgICAgICAgIGorKzsKICAgICAgICB9CgogICAgICAgIGZvdW5kID0ga2V5QSA9PT0gYltqXTsKCiAgICAgICAgaWYgKCFmb3VuZCkgewogICAgICAgICAgdW5wYWNrQW5kUHVzaChhZGRpdGlvbnMsIGtleUEpOwogICAgICAgIH0KICAgICAgfQoKICAgICAgaiA9IDA7CgogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGJsOyBpKyspIHsKICAgICAgICBsZXQgZm91bmQgPSBmYWxzZTsKICAgICAgICBjb25zdCBrZXlCID0gYltpXTsKCiAgICAgICAgd2hpbGUgKGtleUIgPiBhW2pdKSB7CiAgICAgICAgICBqKys7CiAgICAgICAgfQoKICAgICAgICBmb3VuZCA9IGFbal0gPT09IGtleUI7CgogICAgICAgIGlmICghZm91bmQpIHsKICAgICAgICAgIHVucGFja0FuZFB1c2gocmVtb3ZhbHMsIGtleUIpOwogICAgICAgIH0KICAgICAgfQogICAgfQoKICB9CgogIGZ1bmN0aW9uIHVucGFja0FuZFB1c2goYXJyYXksIGtleSkgewogICAgYXJyYXkucHVzaCgoa2V5ICYgMHhmZmZmMDAwMCkgPj4gMTYsIGtleSAmIDB4MDAwMGZmZmYpOwogIH0KCiAgY29uc3QgZ2V0S2V5ID0gKGksIGopID0+IGkgPCBqID8gYCR7aX0tJHtqfWAgOiBgJHtqfS0ke2l9YDsKICAvKioKICAgKiBUdXBsZURpY3Rpb25hcnkKICAgKi8KCgogIGNsYXNzIFR1cGxlRGljdGlvbmFyeSB7CiAgICBjb25zdHJ1Y3RvcigpIHsKICAgICAgdGhpcy5kYXRhID0gewogICAgICAgIGtleXM6IFtdCiAgICAgIH07CiAgICB9CgogICAgLyoqIGdldCAqLwogICAgZ2V0KGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICByZXR1cm4gdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogc2V0ICovCgoKICAgIHNldChpLCBqLCB2YWx1ZSkgewogICAgICBjb25zdCBrZXkgPSBnZXRLZXkoaSwgaik7IC8vIENoZWNrIGlmIGtleSBhbHJlYWR5IGV4aXN0cwoKICAgICAgaWYgKCF0aGlzLmdldChpLCBqKSkgewogICAgICAgIHRoaXMuZGF0YS5rZXlzLnB1c2goa2V5KTsKICAgICAgfQoKICAgICAgdGhpcy5kYXRhW2tleV0gPSB2YWx1ZTsKICAgIH0KICAgIC8qKiBkZWxldGUgKi8KCgogICAgZGVsZXRlKGksIGopIHsKICAgICAgY29uc3Qga2V5ID0gZ2V0S2V5KGksIGopOwogICAgICBjb25zdCBpbmRleCA9IHRoaXMuZGF0YS5rZXlzLmluZGV4T2Yoa2V5KTsKCiAgICAgIGlmIChpbmRleCAhPT0gLTEpIHsKICAgICAgICB0aGlzLmRhdGEua2V5cy5zcGxpY2UoaW5kZXgsIDEpOwogICAgICB9CgogICAgICBkZWxldGUgdGhpcy5kYXRhW2tleV07CiAgICB9CiAgICAvKiogcmVzZXQgKi8KCgogICAgcmVzZXQoKSB7CiAgICAgIGNvbnN0IGRhdGEgPSB0aGlzLmRhdGE7CiAgICAgIGNvbnN0IGtleXMgPSBkYXRhLmtleXM7CgogICAgICB3aGlsZSAoa2V5cy5sZW5ndGggPiAwKSB7CiAgICAgICAgY29uc3Qga2V5ID0ga2V5cy5wb3AoKTsKICAgICAgICBkZWxldGUgZGF0YVtrZXldOwogICAgICB9CiAgICB9CgogIH0KCiAgLyoqCiAgICogVGhlIHBoeXNpY3Mgd29ybGQKICAgKi8KICBjbGFzcyBXb3JsZCBleHRlbmRzIEV2ZW50VGFyZ2V0IHsKICAgIC8qKgogICAgICogQ3VycmVudGx5IC8gbGFzdCB1c2VkIHRpbWVzdGVwLiBJcyBzZXQgdG8gLTEgaWYgbm90IGF2YWlsYWJsZS4gVGhpcyB2YWx1ZSBpcyB1cGRhdGVkIGJlZm9yZSBlYWNoIGludGVybmFsIHN0ZXAsIHdoaWNoIG1lYW5zIHRoYXQgaXQgaXMgImZyZXNoIiBpbnNpZGUgZXZlbnQgY2FsbGJhY2tzLgogICAgICovCgogICAgLyoqCiAgICAgKiBNYWtlcyBib2RpZXMgZ28gdG8gc2xlZXAgd2hlbiB0aGV5J3ZlIGJlZW4gaW5hY3RpdmUuCiAgICAgKiBAZGVmYXVsdCBmYWxzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgdGhlIGN1cnJlbnQgY29udGFjdHMgKGluc3RhbmNlcyBvZiBDb250YWN0RXF1YXRpb24pIGluIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogSG93IG9mdGVuIHRvIG5vcm1hbGl6ZSBxdWF0ZXJuaW9ucy4gU2V0IHRvIDAgZm9yIGV2ZXJ5IHN0ZXAsIDEgZm9yIGV2ZXJ5IHNlY29uZCBldGMuLiBBIGxhcmdlciB2YWx1ZSBpbmNyZWFzZXMgcGVyZm9ybWFuY2UuIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBhIHNtYWxsZXIgdmFsdWUgKHplcm8gdG8gYmUgc3VyZSBub3RoaW5nIGNhbiBnbyB3cm9uZykuCiAgICAgKiBAZGVmYXVsdCAwCiAgICAgKi8KCiAgICAvKioKICAgICAqIFNldCB0byB0cnVlIHRvIHVzZSBmYXN0IHF1YXRlcm5pb24gbm9ybWFsaXphdGlvbi4gSXQgaXMgb2Z0ZW4gZW5vdWdoIGFjY3VyYXRlIHRvIHVzZS4KICAgICAqIElmIGJvZGllcyB0ZW5kIHRvIGV4cGxvZGUsIHNldCB0byBmYWxzZS4KICAgICAqIEBkZWZhdWx0IGZhbHNlCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSB3YWxsLWNsb2NrIHRpbWUgc2luY2Ugc2ltdWxhdGlvbiBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogTnVtYmVyIG9mIHRpbWVzdGVwcyB0YWtlbiBzaW5jZSBzdGFydC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGVmYXVsdCBhbmQgbGFzdCB0aW1lc3RlcCBzaXplcy4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGdyYXZpdHkgb2YgdGhlIHdvcmxkLgogICAgICovCgogICAgLyoqCiAgICAgKiBHcmF2aXR5IHRvIHVzZSB3aGVuIGFwcHJveGltYXRpbmcgdGhlIGZyaWN0aW9uIG1heCBmb3JjZSAobXUqbWFzcypncmF2aXR5KS4KICAgICAqIElmIHVuZGVmaW5lZCwgZ2xvYmFsIGdyYXZpdHkgd2lsbCBiZSB1c2VkLgogICAgICogVXNlIHRvIGVuYWJsZSBmcmljdGlvbiBpbiBhIFdvcmxkIHdpdGggYSBudWxsIGdyYXZpdHkgdmVjdG9yIChubyBncmF2aXR5KS4KICAgICAqLwoKICAgIC8qKgogICAgICogVGhlIGJyb2FkcGhhc2UgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IE5haXZlQnJvYWRwaGFzZQogICAgICovCgogICAgLyoqCiAgICAgKiBBbGwgYm9kaWVzIGluIHRoaXMgd29ybGQKICAgICAqLwoKICAgIC8qKgogICAgICogVHJ1ZSBpZiBhbnkgYm9kaWVzIGFyZSBub3Qgc2xlZXBpbmcsIGZhbHNlIGlmIGV2ZXJ5IGJvZHkgaXMgc2xlZXBpbmcuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFRoZSBzb2x2ZXIgYWxnb3JpdGhtIHRvIHVzZS4KICAgICAqIEBkZWZhdWx0IEdTU29sdmVyCiAgICAgKi8KCiAgICAvKioKICAgICAqIGNvbGxpc2lvbk1hdHJpeAogICAgICovCgogICAgLyoqCiAgICAgKiBDb2xsaXNpb25NYXRyaXggZnJvbSB0aGUgcHJldmlvdXMgc3RlcC4KICAgICAqLwoKICAgIC8qKgogICAgICogQWxsIGFkZGVkIGNvbnRhY3RtYXRlcmlhbHMuCiAgICAgKi8KCiAgICAvKioKICAgICAqIFVzZWQgdG8gbG9vayB1cCBhIENvbnRhY3RNYXRlcmlhbCBnaXZlbiB0d28gaW5zdGFuY2VzIG9mIE1hdGVyaWFsLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGUgZGVmYXVsdCBtYXRlcmlhbCBvZiB0aGUgYm9kaWVzLgogICAgICovCgogICAgLyoqCiAgICAgKiBUaGlzIGNvbnRhY3QgbWF0ZXJpYWwgaXMgdXNlZCBpZiBubyBzdWl0YWJsZSBjb250YWN0bWF0ZXJpYWwgaXMgZm91bmQgZm9yIGEgY29udGFjdC4KICAgICAqLwoKICAgIC8qKgogICAgICogVGltZSBhY2N1bXVsYXRvciBmb3IgaW50ZXJwb2xhdGlvbi4KICAgICAqIEBzZWUgaHR0cHM6Ly9nYWZmZXJvbmdhbWVzLmNvbS9nYW1lLXBoeXNpY3MvZml4LXlvdXItdGltZXN0ZXAvCiAgICAgKi8KCiAgICAvKioKICAgICAqIERpc3BhdGNoZWQgYWZ0ZXIgYSBib2R5IGhhcyBiZWVuIGFkZGVkIHRvIHRoZSB3b3JsZC4KICAgICAqLwoKICAgIC8qKgogICAgICogRGlzcGF0Y2hlZCBhZnRlciBhIGJvZHkgaGFzIGJlZW4gcmVtb3ZlZCBmcm9tIHRoZSB3b3JsZC4KICAgICAqLwogICAgY29uc3RydWN0b3Iob3B0aW9ucykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBzdXBlcigpOwogICAgICB0aGlzLmR0ID0gLTE7CiAgICAgIHRoaXMuYWxsb3dTbGVlcCA9ICEhb3B0aW9ucy5hbGxvd1NsZWVwOwogICAgICB0aGlzLmNvbnRhY3RzID0gW107CiAgICAgIHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMgPSBbXTsKICAgICAgdGhpcy5xdWF0Tm9ybWFsaXplU2tpcCA9IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMucXVhdE5vcm1hbGl6ZVNraXAgOiAwOwogICAgICB0aGlzLnF1YXROb3JtYWxpemVGYXN0ID0gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5xdWF0Tm9ybWFsaXplRmFzdCA6IGZhbHNlOwogICAgICB0aGlzLnRpbWUgPSAwLjA7CiAgICAgIHRoaXMuc3RlcG51bWJlciA9IDA7CiAgICAgIHRoaXMuZGVmYXVsdF9kdCA9IDEgLyA2MDsKICAgICAgdGhpcy5uZXh0SWQgPSAwOwogICAgICB0aGlzLmdyYXZpdHkgPSBuZXcgVmVjMygpOwoKICAgICAgaWYgKG9wdGlvbnMuZ3Jhdml0eSkgewogICAgICAgIHRoaXMuZ3Jhdml0eS5jb3B5KG9wdGlvbnMuZ3Jhdml0eSk7CiAgICAgIH0KCiAgICAgIGlmIChvcHRpb25zLmZyaWN0aW9uR3Jhdml0eSkgewogICAgICAgIHRoaXMuZnJpY3Rpb25HcmF2aXR5ID0gbmV3IFZlYzMoKTsKICAgICAgICB0aGlzLmZyaWN0aW9uR3Jhdml0eS5jb3B5KG9wdGlvbnMuZnJpY3Rpb25HcmF2aXR5KTsKICAgICAgfQoKICAgICAgdGhpcy5icm9hZHBoYXNlID0gb3B0aW9ucy5icm9hZHBoYXNlICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJyb2FkcGhhc2UgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICAgIHRoaXMuYm9kaWVzID0gW107CiAgICAgIHRoaXMuaGFzQWN0aXZlQm9kaWVzID0gZmFsc2U7CiAgICAgIHRoaXMuc29sdmVyID0gb3B0aW9ucy5zb2x2ZXIgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuc29sdmVyIDogbmV3IEdTU29sdmVyKCk7CiAgICAgIHRoaXMuY29uc3RyYWludHMgPSBbXTsKICAgICAgdGhpcy5uYXJyb3dwaGFzZSA9IG5ldyBOYXJyb3dwaGFzZSh0aGlzKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSBuZXcgQXJyYXlDb2xsaXNpb25NYXRyaXgoKTsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXhQcmV2aW91cyA9IG5ldyBBcnJheUNvbGxpc2lvbk1hdHJpeCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyID0gbmV3IE92ZXJsYXBLZWVwZXIoKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIgPSBuZXcgT3ZlcmxhcEtlZXBlcigpOwogICAgICB0aGlzLmNvbnRhY3RtYXRlcmlhbHMgPSBbXTsKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZSA9IG5ldyBUdXBsZURpY3Rpb25hcnkoKTsKICAgICAgdGhpcy5kZWZhdWx0TWF0ZXJpYWwgPSBuZXcgTWF0ZXJpYWwoJ2RlZmF1bHQnKTsKICAgICAgdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbCh0aGlzLmRlZmF1bHRNYXRlcmlhbCwgdGhpcy5kZWZhdWx0TWF0ZXJpYWwsIHsKICAgICAgICBmcmljdGlvbjogMC4zLAogICAgICAgIHJlc3RpdHV0aW9uOiAwLjAKICAgICAgfSk7CiAgICAgIHRoaXMuZG9Qcm9maWxpbmcgPSBmYWxzZTsKICAgICAgdGhpcy5wcm9maWxlID0gewogICAgICAgIHNvbHZlOiAwLAogICAgICAgIG1ha2VDb250YWN0Q29uc3RyYWludHM6IDAsCiAgICAgICAgYnJvYWRwaGFzZTogMCwKICAgICAgICBpbnRlZ3JhdGU6IDAsCiAgICAgICAgbmFycm93cGhhc2U6IDAKICAgICAgfTsKICAgICAgdGhpcy5hY2N1bXVsYXRvciA9IDA7CiAgICAgIHRoaXMuc3Vic3lzdGVtcyA9IFtdOwogICAgICB0aGlzLmFkZEJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAnYWRkQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudCA9IHsKICAgICAgICB0eXBlOiAncmVtb3ZlQm9keScsCiAgICAgICAgYm9keTogbnVsbAogICAgICB9OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwID0ge307CiAgICAgIHRoaXMuYnJvYWRwaGFzZS5zZXRXb3JsZCh0aGlzKTsKICAgIH0KICAgIC8qKgogICAgICogR2V0IHRoZSBjb250YWN0IG1hdGVyaWFsIGJldHdlZW4gbWF0ZXJpYWxzIG0xIGFuZCBtMgogICAgICogQHJldHVybiBUaGUgY29udGFjdCBtYXRlcmlhbCBpZiBpdCB3YXMgZm91bmQuCiAgICAgKi8KCgogICAgZ2V0Q29udGFjdE1hdGVyaWFsKG0xLCBtMikgewogICAgICByZXR1cm4gdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5nZXQobTEuaWQsIG0yLmlkKTsKICAgIH0KICAgIC8qKgogICAgICogU3RvcmUgb2xkIGNvbGxpc2lvbiBzdGF0ZSBpbmZvCiAgICAgKi8KCgogICAgY29sbGlzaW9uTWF0cml4VGljaygpIHsKICAgICAgY29uc3QgdGVtcCA9IHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXM7CiAgICAgIHRoaXMuY29sbGlzaW9uTWF0cml4UHJldmlvdXMgPSB0aGlzLmNvbGxpc2lvbk1hdHJpeDsKICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXggPSB0ZW1wOwogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5yZXNldCgpOwogICAgICB0aGlzLmJvZHlPdmVybGFwS2VlcGVyLnRpY2soKTsKICAgICAgdGhpcy5zaGFwZU92ZXJsYXBLZWVwZXIudGljaygpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSBjb25zdHJhaW50IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIGFkZENvbnN0cmFpbnQoYykgewogICAgICB0aGlzLmNvbnN0cmFpbnRzLnB1c2goYyk7CiAgICB9CiAgICAvKioKICAgICAqIFJlbW92ZXMgYSBjb25zdHJhaW50CiAgICAgKi8KCgogICAgcmVtb3ZlQ29uc3RyYWludChjKSB7CiAgICAgIGNvbnN0IGlkeCA9IHRoaXMuY29uc3RyYWludHMuaW5kZXhPZihjKTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgdGhpcy5jb25zdHJhaW50cy5zcGxpY2UoaWR4LCAxKTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXljYXN0IHRlc3QKICAgICAqIEBkZXByZWNhdGVkIFVzZSAucmF5Y2FzdEFsbCwgLnJheWNhc3RDbG9zZXN0IG9yIC5yYXljYXN0QW55IGluc3RlYWQuCiAgICAgKi8KCgogICAgcmF5VGVzdChmcm9tLCB0bywgcmVzdWx0KSB7CiAgICAgIGlmIChyZXN1bHQgaW5zdGFuY2VvZiBSYXljYXN0UmVzdWx0KSB7CiAgICAgICAgLy8gRG8gcmF5Y2FzdENsb3Nlc3QKICAgICAgICB0aGlzLnJheWNhc3RDbG9zZXN0KGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfSBlbHNlIHsKICAgICAgICAvLyBEbyByYXljYXN0QWxsCiAgICAgICAgdGhpcy5yYXljYXN0QWxsKGZyb20sIHRvLCB7CiAgICAgICAgICBza2lwQmFja2ZhY2VzOiB0cnVlCiAgICAgICAgfSwgcmVzdWx0KTsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCBhZ2FpbnN0IGFsbCBib2RpZXMuIFRoZSBwcm92aWRlZCBjYWxsYmFjayB3aWxsIGJlIGV4ZWN1dGVkIGZvciBlYWNoIGhpdCB3aXRoIGEgUmF5Y2FzdFJlc3VsdCBhcyBzaW5nbGUgYXJndW1lbnQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0QWxsKGZyb20sIHRvLCBvcHRpb25zLCBjYWxsYmFjaykgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQUxMOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMuY2FsbGJhY2sgPSBjYWxsYmFjazsKICAgICAgcmV0dXJuIHRtcFJheS5pbnRlcnNlY3RXb3JsZCh0aGlzLCBvcHRpb25zKTsKICAgIH0KICAgIC8qKgogICAgICogUmF5IGNhc3QsIGFuZCBzdG9wIGF0IHRoZSBmaXJzdCByZXN1bHQuIE5vdGUgdGhhdCB0aGUgb3JkZXIgaXMgcmFuZG9tIC0gYnV0IHRoZSBtZXRob2QgaXMgZmFzdC4KICAgICAqIEByZXR1cm4gVHJ1ZSBpZiBhbnkgYm9keSB3YXMgaGl0LgogICAgICovCgoKICAgIHJheWNhc3RBbnkoZnJvbSwgdG8sIG9wdGlvbnMsIHJlc3VsdCkgewogICAgICBpZiAob3B0aW9ucyA9PT0gdm9pZCAwKSB7CiAgICAgICAgb3B0aW9ucyA9IHt9OwogICAgICB9CgogICAgICBvcHRpb25zLm1vZGUgPSBSYXkuQU5ZOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBSYXkgY2FzdCwgYW5kIHJldHVybiBpbmZvcm1hdGlvbiBvZiB0aGUgY2xvc2VzdCBoaXQuCiAgICAgKiBAcmV0dXJuIFRydWUgaWYgYW55IGJvZHkgd2FzIGhpdC4KICAgICAqLwoKCiAgICByYXljYXN0Q2xvc2VzdChmcm9tLCB0bywgb3B0aW9ucywgcmVzdWx0KSB7CiAgICAgIGlmIChvcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgICBvcHRpb25zID0ge307CiAgICAgIH0KCiAgICAgIG9wdGlvbnMubW9kZSA9IFJheS5DTE9TRVNUOwogICAgICBvcHRpb25zLmZyb20gPSBmcm9tOwogICAgICBvcHRpb25zLnRvID0gdG87CiAgICAgIG9wdGlvbnMucmVzdWx0ID0gcmVzdWx0OwogICAgICByZXR1cm4gdG1wUmF5LmludGVyc2VjdFdvcmxkKHRoaXMsIG9wdGlvbnMpOwogICAgfQogICAgLyoqCiAgICAgKiBBZGQgYSByaWdpZCBib2R5IHRvIHRoZSBzaW11bGF0aW9uLgogICAgICogQHRvZG8gSWYgdGhlIHNpbXVsYXRpb24gaGFzIG5vdCB5ZXQgc3RhcnRlZCwgd2h5IHJlY3JldGUgYW5kIGNvcHkgYXJyYXlzIGZvciBlYWNoIGJvZHk/IEFjY3VtdWxhdGUgaW4gZHluYW1pYyBhcnJheXMgaW4gdGhpcyBjYXNlLgogICAgICogQHRvZG8gQWRkaW5nIGFuIGFycmF5IG9mIGJvZGllcyBzaG91bGQgYmUgcG9zc2libGUuIFRoaXMgd291bGQgc2F2ZSBzb21lIGxvb3BzIHRvbwogICAgICovCgoKICAgIGFkZEJvZHkoYm9keSkgewogICAgICBpZiAodGhpcy5ib2RpZXMuaW5jbHVkZXMoYm9keSkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIGJvZHkuaW5kZXggPSB0aGlzLmJvZGllcy5sZW5ndGg7CiAgICAgIHRoaXMuYm9kaWVzLnB1c2goYm9keSk7CiAgICAgIGJvZHkud29ybGQgPSB0aGlzOwogICAgICBib2R5LmluaXRQb3NpdGlvbi5jb3B5KGJvZHkucG9zaXRpb24pOwogICAgICBib2R5LmluaXRWZWxvY2l0eS5jb3B5KGJvZHkudmVsb2NpdHkpOwogICAgICBib2R5LnRpbWVMYXN0U2xlZXB5ID0gdGhpcy50aW1lOwoKICAgICAgaWYgKGJvZHkgaW5zdGFuY2VvZiBCb2R5KSB7CiAgICAgICAgYm9keS5pbml0QW5ndWxhclZlbG9jaXR5LmNvcHkoYm9keS5hbmd1bGFyVmVsb2NpdHkpOwogICAgICAgIGJvZHkuaW5pdFF1YXRlcm5pb24uY29weShib2R5LnF1YXRlcm5pb24pOwogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXROdW1PYmplY3RzKHRoaXMuYm9kaWVzLmxlbmd0aCk7CiAgICAgIHRoaXMuYWRkQm9keUV2ZW50LmJvZHkgPSBib2R5OwogICAgICB0aGlzLmlkVG9Cb2R5TWFwW2JvZHkuaWRdID0gYm9keTsKICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KHRoaXMuYWRkQm9keUV2ZW50KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlIGEgcmlnaWQgYm9keSBmcm9tIHRoZSBzaW11bGF0aW9uLgogICAgICovCgoKICAgIHJlbW92ZUJvZHkoYm9keSkgewogICAgICBib2R5LndvcmxkID0gbnVsbDsKICAgICAgY29uc3QgbiA9IHRoaXMuYm9kaWVzLmxlbmd0aCAtIDE7CiAgICAgIGNvbnN0IGJvZGllcyA9IHRoaXMuYm9kaWVzOwogICAgICBjb25zdCBpZHggPSBib2RpZXMuaW5kZXhPZihib2R5KTsKCiAgICAgIGlmIChpZHggIT09IC0xKSB7CiAgICAgICAgYm9kaWVzLnNwbGljZShpZHgsIDEpOyAvLyBUb2RvOiBzaG91bGQgdXNlIGEgZ2FyYmFnZSBmcmVlIG1ldGhvZAogICAgICAgIC8vIFJlY29tcHV0ZSBpbmRleAoKICAgICAgICBmb3IgKGxldCBpID0gMDsgaSAhPT0gYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgICBib2RpZXNbaV0uaW5kZXggPSBpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5jb2xsaXNpb25NYXRyaXguc2V0TnVtT2JqZWN0cyhuKTsKICAgICAgICB0aGlzLnJlbW92ZUJvZHlFdmVudC5ib2R5ID0gYm9keTsKICAgICAgICBkZWxldGUgdGhpcy5pZFRvQm9keU1hcFtib2R5LmlkXTsKICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQodGhpcy5yZW1vdmVCb2R5RXZlbnQpOwogICAgICB9CiAgICB9CgogICAgZ2V0Qm9keUJ5SWQoaWQpIHsKICAgICAgcmV0dXJuIHRoaXMuaWRUb0JvZHlNYXBbaWRdOwogICAgfQogICAgLyoqCiAgICAgKiBAdG9kbyBNYWtlIGEgZmFzdGVyIG1hcAogICAgICovCgoKICAgIGdldFNoYXBlQnlJZChpZCkgewogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgYm9kaWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgY29uc3Qgc2hhcGVzID0gYm9kaWVzW2ldLnNoYXBlczsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBzaGFwZXMubGVuZ3RoOyBqKyspIHsKICAgICAgICAgIGNvbnN0IHNoYXBlID0gc2hhcGVzW2pdOwoKICAgICAgICAgIGlmIChzaGFwZS5pZCA9PT0gaWQpIHsKICAgICAgICAgICAgcmV0dXJuIHNoYXBlOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIG51bGw7CiAgICB9CiAgICAvKioKICAgICAqIEFkZHMgYSBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBXb3JsZAogICAgICovCgoKICAgIGFkZENvbnRhY3RNYXRlcmlhbChjbWF0KSB7CiAgICAgIC8vIEFkZCBjb250YWN0IG1hdGVyaWFsCiAgICAgIHRoaXMuY29udGFjdG1hdGVyaWFscy5wdXNoKGNtYXQpOyAvLyBBZGQgY3VycmVudCBjb250YWN0IG1hdGVyaWFsIHRvIHRoZSBtYXRlcmlhbCB0YWJsZQoKICAgICAgdGhpcy5jb250YWN0TWF0ZXJpYWxUYWJsZS5zZXQoY21hdC5tYXRlcmlhbHNbMF0uaWQsIGNtYXQubWF0ZXJpYWxzWzFdLmlkLCBjbWF0KTsKICAgIH0KICAgIC8qKgogICAgICogUmVtb3ZlcyBhIGNvbnRhY3QgbWF0ZXJpYWwgZnJvbSB0aGUgV29ybGQuCiAgICAgKi8KCgogICAgcmVtb3ZlQ29udGFjdE1hdGVyaWFsKGNtYXQpIHsKICAgICAgY29uc3QgaWR4ID0gdGhpcy5jb250YWN0bWF0ZXJpYWxzLmluZGV4T2YoY21hdCk7CgogICAgICBpZiAoaWR4ID09PSAtMSkgewogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgdGhpcy5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpZHgsIDEpOwogICAgICB0aGlzLmNvbnRhY3RNYXRlcmlhbFRhYmxlLmRlbGV0ZShjbWF0Lm1hdGVyaWFsc1swXS5pZCwgY21hdC5tYXRlcmlhbHNbMV0uaWQpOwogICAgfQogICAgLyoqCiAgICAgKiBTdGVwIHRoZSBzaW11bGF0aW9uIGZvcndhcmQga2VlcGluZyB0cmFjayBvZiBsYXN0IGNhbGxlZCB0aW1lCiAgICAgKiB0byBiZSBhYmxlIHRvIHN0ZXAgdGhlIHdvcmxkIGF0IGEgZml4ZWQgcmF0ZSwgaW5kZXBlbmRlbnRseSBvZiBmcmFtZXJhdGUuCiAgICAgKgogICAgICogQHBhcmFtIGR0IFRoZSBmaXhlZCB0aW1lIHN0ZXAgc2l6ZSB0byB1c2UgKGRlZmF1bHQ6IDEgLyA2MCkuCiAgICAgKiBAcGFyYW0gbWF4U3ViU3RlcHMgTWF4aW11bSBudW1iZXIgb2YgZml4ZWQgc3RlcHMgdG8gdGFrZSBwZXIgZnVuY3Rpb24gY2FsbCAoZGVmYXVsdDogMTApLgogICAgICogQHNlZSBodHRwczovL2dhZmZlcm9uZ2FtZXMuY29tL3Bvc3QvZml4X3lvdXJfdGltZXN0ZXAvCiAgICAgKiBAZXhhbXBsZQogICAgICogICAgIC8vIFJ1biB0aGUgc2ltdWxhdGlvbiBpbmRlcGVuZGVudGx5IG9mIGZyYW1lcmF0ZSBldmVyeSAxIC8gNjAgbXMKICAgICAqICAgICB3b3JsZC5maXhlZFN0ZXAoKQogICAgICovCgoKICAgIGZpeGVkU3RlcChkdCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKGR0ID09PSB2b2lkIDApIHsKICAgICAgICBkdCA9IDEgLyA2MDsKICAgICAgfQoKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBjb25zdCB0aW1lID0gcGVyZm9ybWFuY2Uubm93KCkgLyAxMDAwOyAvLyBzZWNvbmRzCgogICAgICBpZiAoIXRoaXMubGFzdENhbGxUaW1lKSB7CiAgICAgICAgdGhpcy5zdGVwKGR0LCB1bmRlZmluZWQsIG1heFN1YlN0ZXBzKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBjb25zdCB0aW1lU2luY2VMYXN0Q2FsbGVkID0gdGltZSAtIHRoaXMubGFzdENhbGxUaW1lOwogICAgICAgIHRoaXMuc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgICB9CgogICAgICB0aGlzLmxhc3RDYWxsVGltZSA9IHRpbWU7CiAgICB9CiAgICAvKioKICAgICAqIFN0ZXAgdGhlIHBoeXNpY3Mgd29ybGQgZm9yd2FyZCBpbiB0aW1lLgogICAgICoKICAgICAqIFRoZXJlIGFyZSB0d28gbW9kZXMuIFRoZSBzaW1wbGUgbW9kZSBpcyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uLiBJbiB0aGlzIGNhc2UgeW91IG9ubHkgdXNlIHRoZSBmaXJzdCBhcmd1bWVudC4gVGhlIHNlY29uZCBjYXNlIHVzZXMgaW50ZXJwb2xhdGlvbi4gSW4gdGhhdCB5b3UgYWxzbyBwcm92aWRlIHRoZSB0aW1lIHNpbmNlIHRoZSBmdW5jdGlvbiB3YXMgbGFzdCB1c2VkLCBhcyB3ZWxsIGFzIHRoZSBtYXhpbXVtIGZpeGVkIHRpbWVzdGVwcyB0byB0YWtlLgogICAgICoKICAgICAqIEBwYXJhbSBkdCBUaGUgZml4ZWQgdGltZSBzdGVwIHNpemUgdG8gdXNlLgogICAgICogQHBhcmFtIHRpbWVTaW5jZUxhc3RDYWxsZWQgVGhlIHRpbWUgZWxhcHNlZCBzaW5jZSB0aGUgZnVuY3Rpb24gd2FzIGxhc3QgY2FsbGVkLgogICAgICogQHBhcmFtIG1heFN1YlN0ZXBzIE1heGltdW0gbnVtYmVyIG9mIGZpeGVkIHN0ZXBzIHRvIHRha2UgcGVyIGZ1bmN0aW9uIGNhbGwgKGRlZmF1bHQ6IDEwKS4KICAgICAqIEBzZWUgaHR0cHM6Ly93ZWIuYXJjaGl2ZS5vcmcvd2ViLzIwMTgwNDI2MTU0NTMxL2h0dHA6Ly9idWxsZXRwaHlzaWNzLm9yZy9tZWRpYXdpa2ktMS41LjgvaW5kZXgucGhwL1N0ZXBwaW5nX1RoZV9Xb3JsZCNXaGF0X2RvX3RoZV9wYXJhbWV0ZXJzX3RvX2J0RHluYW1pY3NXb3JsZDo6c3RlcFNpbXVsYXRpb25fbWVhbi4zRgogICAgICogQGV4YW1wbGUKICAgICAqICAgICAvLyBmaXhlZCB0aW1lc3RlcHBpbmcgd2l0aG91dCBpbnRlcnBvbGF0aW9uCiAgICAgKiAgICAgd29ybGQuc3RlcCgxIC8gNjApCiAgICAgKi8KCgogICAgc3RlcChkdCwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpIHsKICAgICAgaWYgKG1heFN1YlN0ZXBzID09PSB2b2lkIDApIHsKICAgICAgICBtYXhTdWJTdGVwcyA9IDEwOwogICAgICB9CgogICAgICBpZiAodGltZVNpbmNlTGFzdENhbGxlZCA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgLy8gRml4ZWQsIHNpbXBsZSBzdGVwcGluZwogICAgICAgIHRoaXMuaW50ZXJuYWxTdGVwKGR0KTsgLy8gSW5jcmVtZW50IHRpbWUKCiAgICAgICAgdGhpcy50aW1lICs9IGR0OwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgKz0gdGltZVNpbmNlTGFzdENhbGxlZDsKICAgICAgICBjb25zdCB0MCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICAgIGxldCBzdWJzdGVwcyA9IDA7CgogICAgICAgIHdoaWxlICh0aGlzLmFjY3VtdWxhdG9yID49IGR0ICYmIHN1YnN0ZXBzIDwgbWF4U3ViU3RlcHMpIHsKICAgICAgICAgIC8vIERvIGZpeGVkIHN0ZXBzIHRvIGNhdGNoIHVwCiAgICAgICAgICB0aGlzLmludGVybmFsU3RlcChkdCk7CiAgICAgICAgICB0aGlzLmFjY3VtdWxhdG9yIC09IGR0OwogICAgICAgICAgc3Vic3RlcHMrKzsKCiAgICAgICAgICBpZiAocGVyZm9ybWFuY2Uubm93KCkgLSB0MCA+IGR0ICogMTAwMCkgewogICAgICAgICAgICAvLyBUaGUgZnJhbWVyYXRlIGlzIG5vdCBpbnRlcmFjdGl2ZSBhbnltb3JlLgogICAgICAgICAgICAvLyBXZSBhcmUgYmVsb3cgdGhlIHRhcmdldCBmcmFtZXJhdGUuCiAgICAgICAgICAgIC8vIEJldHRlciBiYWlsIG91dC4KICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBSZW1vdmUgdGhlIGV4Y2VzcyBhY2N1bXVsYXRvciwgc2luY2Ugd2UgbWF5IG5vdAogICAgICAgIC8vIGhhdmUgaGFkIGVub3VnaCBzdWJzdGVwcyBhdmFpbGFibGUgdG8gY2F0Y2ggdXAKCgogICAgICAgIHRoaXMuYWNjdW11bGF0b3IgPSB0aGlzLmFjY3VtdWxhdG9yICUgZHQ7CiAgICAgICAgY29uc3QgdCA9IHRoaXMuYWNjdW11bGF0b3IgLyBkdDsKCiAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogIT09IHRoaXMuYm9kaWVzLmxlbmd0aDsgaisrKSB7CiAgICAgICAgICBjb25zdCBiID0gdGhpcy5ib2RpZXNbal07CiAgICAgICAgICBiLnByZXZpb3VzUG9zaXRpb24ubGVycChiLnBvc2l0aW9uLCB0LCBiLmludGVycG9sYXRlZFBvc2l0aW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLnNsZXJwKGIucXVhdGVybmlvbiwgdCwgYi5pbnRlcnBvbGF0ZWRRdWF0ZXJuaW9uKTsKICAgICAgICAgIGIucHJldmlvdXNRdWF0ZXJuaW9uLm5vcm1hbGl6ZSgpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy50aW1lICs9IHRpbWVTaW5jZUxhc3RDYWxsZWQ7CiAgICAgIH0KICAgIH0KCiAgICBpbnRlcm5hbFN0ZXAoZHQpIHsKICAgICAgdGhpcy5kdCA9IGR0OwogICAgICBjb25zdCBjb250YWN0cyA9IHRoaXMuY29udGFjdHM7CiAgICAgIGNvbnN0IHAxID0gV29ybGRfc3RlcF9wMTsKICAgICAgY29uc3QgcDIgPSBXb3JsZF9zdGVwX3AyOwogICAgICBjb25zdCBOID0gdGhpcy5ib2RpZXMubGVuZ3RoOwogICAgICBjb25zdCBib2RpZXMgPSB0aGlzLmJvZGllczsKICAgICAgY29uc3Qgc29sdmVyID0gdGhpcy5zb2x2ZXI7CiAgICAgIGNvbnN0IGdyYXZpdHkgPSB0aGlzLmdyYXZpdHk7CiAgICAgIGNvbnN0IGRvUHJvZmlsaW5nID0gdGhpcy5kb1Byb2ZpbGluZzsKICAgICAgY29uc3QgcHJvZmlsZSA9IHRoaXMucHJvZmlsZTsKICAgICAgY29uc3QgRFlOQU1JQyA9IEJvZHkuRFlOQU1JQzsKICAgICAgbGV0IHByb2ZpbGluZ1N0YXJ0ID0gLUluZmluaXR5OwogICAgICBjb25zdCBjb25zdHJhaW50cyA9IHRoaXMuY29uc3RyYWludHM7CiAgICAgIGNvbnN0IGZyaWN0aW9uRXF1YXRpb25Qb29sID0gV29ybGRfc3RlcF9mcmljdGlvbkVxdWF0aW9uUG9vbDsKICAgICAgZ3Jhdml0eS5sZW5ndGgoKTsKICAgICAgY29uc3QgZ3ggPSBncmF2aXR5Lng7CiAgICAgIGNvbnN0IGd5ID0gZ3Jhdml0eS55OwogICAgICBjb25zdCBneiA9IGdyYXZpdHkuejsKICAgICAgbGV0IGkgPSAwOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsaW5nU3RhcnQgPSBwZXJmb3JtYW5jZS5ub3coKTsKICAgICAgfSAvLyBBZGQgZ3Jhdml0eSB0byBhbGwgb2JqZWN0cwoKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGJpID0gYm9kaWVzW2ldOwoKICAgICAgICBpZiAoYmkudHlwZSA9PT0gRFlOQU1JQykgewogICAgICAgICAgLy8gT25seSBmb3IgZHluYW1pYyBib2RpZXMKICAgICAgICAgIGNvbnN0IGYgPSBiaS5mb3JjZTsKICAgICAgICAgIGNvbnN0IG0gPSBiaS5tYXNzOwogICAgICAgICAgZi54ICs9IG0gKiBneDsKICAgICAgICAgIGYueSArPSBtICogZ3k7CiAgICAgICAgICBmLnogKz0gbSAqIGd6OwogICAgICAgIH0KICAgICAgfSAvLyBVcGRhdGUgc3Vic3lzdGVtcwoKCiAgICAgIGZvciAobGV0IGkgPSAwLCBOc3Vic3lzdGVtcyA9IHRoaXMuc3Vic3lzdGVtcy5sZW5ndGg7IGkgIT09IE5zdWJzeXN0ZW1zOyBpKyspIHsKICAgICAgICB0aGlzLnN1YnN5c3RlbXNbaV0udXBkYXRlKCk7CiAgICAgIH0gLy8gQ29sbGlzaW9uIGRldGVjdGlvbgoKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIHAxLmxlbmd0aCA9IDA7IC8vIENsZWFuIHVwIHBhaXIgYXJyYXlzIGZyb20gbGFzdCBzdGVwCgogICAgICBwMi5sZW5ndGggPSAwOwogICAgICB0aGlzLmJyb2FkcGhhc2UuY29sbGlzaW9uUGFpcnModGhpcywgcDEsIHAyKTsKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGUuYnJvYWRwaGFzZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGNvbnN0cmFpbmVkIHBhaXJzIHdpdGggY29sbGlkZUNvbm5lY3RlZCA9PSBmYWxzZQoKCiAgICAgIGxldCBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKCiAgICAgICAgaWYgKCFjLmNvbGxpZGVDb25uZWN0ZWQpIHsKICAgICAgICAgIGZvciAobGV0IGogPSBwMS5sZW5ndGggLSAxOyBqID49IDA7IGogLT0gMSkgewogICAgICAgICAgICBpZiAoYy5ib2R5QSA9PT0gcDFbal0gJiYgYy5ib2R5QiA9PT0gcDJbal0gfHwgYy5ib2R5QiA9PT0gcDFbal0gJiYgYy5ib2R5QSA9PT0gcDJbal0pIHsKICAgICAgICAgICAgICBwMS5zcGxpY2UoaiwgMSk7CiAgICAgICAgICAgICAgcDIuc3BsaWNlKGosIDEpOwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeFRpY2soKTsgLy8gR2VuZXJhdGUgY29udGFjdHMKCiAgICAgIGlmIChkb1Byb2ZpbGluZykgewogICAgICAgIHByb2ZpbGluZ1N0YXJ0ID0gcGVyZm9ybWFuY2Uubm93KCk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG9sZGNvbnRhY3RzID0gV29ybGRfc3RlcF9vbGRDb250YWN0czsKICAgICAgY29uc3QgTm9sZENvbnRhY3RzID0gY29udGFjdHMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZENvbnRhY3RzOyBpKyspIHsKICAgICAgICBvbGRjb250YWN0cy5wdXNoKGNvbnRhY3RzW2ldKTsKICAgICAgfQoKICAgICAgY29udGFjdHMubGVuZ3RoID0gMDsgLy8gVHJhbnNmZXIgRnJpY3Rpb25FcXVhdGlvbiBmcm9tIGN1cnJlbnQgbGlzdCB0byB0aGUgcG9vbCBmb3IgcmV1c2UKCiAgICAgIGNvbnN0IE5vbGRGcmljdGlvbkVxdWF0aW9ucyA9IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOwoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTm9sZEZyaWN0aW9uRXF1YXRpb25zOyBpKyspIHsKICAgICAgICBmcmljdGlvbkVxdWF0aW9uUG9vbC5wdXNoKHRoaXMuZnJpY3Rpb25FcXVhdGlvbnNbaV0pOwogICAgICB9CgogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLmxlbmd0aCA9IDA7CiAgICAgIHRoaXMubmFycm93cGhhc2UuZ2V0Q29udGFjdHMocDEsIHAyLCB0aGlzLCBjb250YWN0cywgb2xkY29udGFjdHMsIC8vIFRvIGJlIHJldXNlZAogICAgICB0aGlzLmZyaWN0aW9uRXF1YXRpb25zLCBmcmljdGlvbkVxdWF0aW9uUG9vbCk7CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxlLm5hcnJvd3BoYXNlID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgfSAvLyBMb29wIG92ZXIgYWxsIGNvbGxpc2lvbnMKCgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIEFkZCBhbGwgZnJpY3Rpb24gZXFzCgoKICAgICAgZm9yIChpID0gMDsgaSA8IHRoaXMuZnJpY3Rpb25FcXVhdGlvbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBzb2x2ZXIuYWRkRXF1YXRpb24odGhpcy5mcmljdGlvbkVxdWF0aW9uc1tpXSk7CiAgICAgIH0KCiAgICAgIGNvbnN0IG5jb250YWN0cyA9IGNvbnRhY3RzLmxlbmd0aDsKCiAgICAgIGZvciAobGV0IGsgPSAwOyBrICE9PSBuY29udGFjdHM7IGsrKykgewogICAgICAgIC8vIEN1cnJlbnQgY29udGFjdAogICAgICAgIGNvbnN0IGMgPSBjb250YWN0c1trXTsgLy8gR2V0IGN1cnJlbnQgY29sbGlzaW9uIGluZGVjZXMKCiAgICAgICAgY29uc3QgYmkgPSBjLmJpOwogICAgICAgIGNvbnN0IGJqID0gYy5iajsKICAgICAgICBjb25zdCBzaSA9IGMuc2k7CiAgICAgICAgY29uc3Qgc2ogPSBjLnNqOyAvLyBHZXQgY29sbGlzaW9uIHByb3BlcnRpZXMKCiAgICAgICAgbGV0IGNtOwoKICAgICAgICBpZiAoYmkubWF0ZXJpYWwgJiYgYmoubWF0ZXJpYWwpIHsKICAgICAgICAgIGNtID0gdGhpcy5nZXRDb250YWN0TWF0ZXJpYWwoYmkubWF0ZXJpYWwsIGJqLm1hdGVyaWFsKSB8fCB0aGlzLmRlZmF1bHRDb250YWN0TWF0ZXJpYWw7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNtID0gdGhpcy5kZWZhdWx0Q29udGFjdE1hdGVyaWFsOwogICAgICAgIH0gLy8gYy5lbmFibGVkID0gYmkuY29sbGlzaW9uUmVzcG9uc2UgJiYgYmouY29sbGlzaW9uUmVzcG9uc2UgJiYgc2kuY29sbGlzaW9uUmVzcG9uc2UgJiYgc2ouY29sbGlzaW9uUmVzcG9uc2U7CgoKICAgICAgICBjbS5mcmljdGlvbjsgLy8gYy5yZXN0aXR1dGlvbiA9IGNtLnJlc3RpdHV0aW9uOwogICAgICAgIC8vIElmIGZyaWN0aW9uIG9yIHJlc3RpdHV0aW9uIHdlcmUgc3BlY2lmaWVkIGluIHRoZSBtYXRlcmlhbCwgdXNlIHRoZW0KCiAgICAgICAgaWYgKGJpLm1hdGVyaWFsICYmIGJqLm1hdGVyaWFsKSB7CiAgICAgICAgICBpZiAoYmkubWF0ZXJpYWwuZnJpY3Rpb24gPj0gMCAmJiBiai5tYXRlcmlhbC5mcmljdGlvbiA+PSAwKSB7CiAgICAgICAgICAgIGJpLm1hdGVyaWFsLmZyaWN0aW9uICogYmoubWF0ZXJpYWwuZnJpY3Rpb247CiAgICAgICAgICB9CgogICAgICAgICAgaWYgKGJpLm1hdGVyaWFsLnJlc3RpdHV0aW9uID49IDAgJiYgYmoubWF0ZXJpYWwucmVzdGl0dXRpb24gPj0gMCkgewogICAgICAgICAgICBjLnJlc3RpdHV0aW9uID0gYmkubWF0ZXJpYWwucmVzdGl0dXRpb24gKiBiai5tYXRlcmlhbC5yZXN0aXR1dGlvbjsKICAgICAgICAgIH0KICAgICAgICB9IC8vIGMuc2V0U3Bvb2tQYXJhbXMoCiAgICAgICAgLy8gICAgICAgICAgIGNtLmNvbnRhY3RFcXVhdGlvblN0aWZmbmVzcywKICAgICAgICAvLyAgICAgICAgICAgY20uY29udGFjdEVxdWF0aW9uUmVsYXhhdGlvbiwKICAgICAgICAvLyAgICAgICAgICAgZHQKICAgICAgICAvLyAgICAgICApOwoKCiAgICAgICAgc29sdmVyLmFkZEVxdWF0aW9uKGMpOyAvLyAvLyBBZGQgZnJpY3Rpb24gY29uc3RyYWludCBlcXVhdGlvbgogICAgICAgIC8vIGlmKG11ID4gMCl7CiAgICAgICAgLy8gCS8vIENyZWF0ZSAyIHRhbmdlbnQgZXF1YXRpb25zCiAgICAgICAgLy8gCWNvbnN0IG11ZyA9IG11ICogZ25vcm07CiAgICAgICAgLy8gCWNvbnN0IHJlZHVjZWRNYXNzID0gKGJpLmludk1hc3MgKyBiai5pbnZNYXNzKTsKICAgICAgICAvLyAJaWYocmVkdWNlZE1hc3MgPiAwKXsKICAgICAgICAvLyAJCXJlZHVjZWRNYXNzID0gMS9yZWR1Y2VkTWFzczsKICAgICAgICAvLyAJfQogICAgICAgIC8vIAljb25zdCBwb29sID0gZnJpY3Rpb25FcXVhdGlvblBvb2w7CiAgICAgICAgLy8gCWNvbnN0IGMxID0gcG9vbC5sZW5ndGggPyBwb29sLnBvcCgpIDogbmV3IEZyaWN0aW9uRXF1YXRpb24oYmksYmosbXVnKnJlZHVjZWRNYXNzKTsKICAgICAgICAvLyAJY29uc3QgYzIgPSBwb29sLmxlbmd0aCA/IHBvb2wucG9wKCkgOiBuZXcgRnJpY3Rpb25FcXVhdGlvbihiaSxiaixtdWcqcmVkdWNlZE1hc3MpOwogICAgICAgIC8vIAl0aGlzLmZyaWN0aW9uRXF1YXRpb25zLnB1c2goYzEsIGMyKTsKICAgICAgICAvLyAJYzEuYmkgPSBjMi5iaSA9IGJpOwogICAgICAgIC8vIAljMS5iaiA9IGMyLmJqID0gYmo7CiAgICAgICAgLy8gCWMxLm1pbkZvcmNlID0gYzIubWluRm9yY2UgPSAtbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAljMS5tYXhGb3JjZSA9IGMyLm1heEZvcmNlID0gbXVnKnJlZHVjZWRNYXNzOwogICAgICAgIC8vIAkvLyBDb3B5IG92ZXIgdGhlIHJlbGF0aXZlIHZlY3RvcnMKICAgICAgICAvLyAJYzEucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzEucmouY29weShjLnJqKTsKICAgICAgICAvLyAJYzIucmkuY29weShjLnJpKTsKICAgICAgICAvLyAJYzIucmouY29weShjLnJqKTsKICAgICAgICAvLyAJLy8gQ29uc3RydWN0IHRhbmdlbnRzCiAgICAgICAgLy8gCWMubmkudGFuZ2VudHMoYzEudCwgYzIudCk7CiAgICAgICAgLy8gICAgICAgICAgIC8vIFNldCBzcG9vayBwYXJhbXMKICAgICAgICAvLyAgICAgICAgICAgYzEuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzIuc2V0U3Bvb2tQYXJhbXMoY20uZnJpY3Rpb25FcXVhdGlvblN0aWZmbmVzcywgY20uZnJpY3Rpb25FcXVhdGlvblJlbGF4YXRpb24sIGR0KTsKICAgICAgICAvLyAgICAgICAgICAgYzEuZW5hYmxlZCA9IGMyLmVuYWJsZWQgPSBjLmVuYWJsZWQ7CiAgICAgICAgLy8gCS8vIEFkZCBlcXVhdGlvbnMgdG8gc29sdmVyCiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMSk7CiAgICAgICAgLy8gCXNvbHZlci5hZGRFcXVhdGlvbihjMik7CiAgICAgICAgLy8gfQoKICAgICAgICBpZiAoYmkuYWxsb3dTbGVlcCAmJiBiaS50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmkuc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiai5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJqLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRCID0gYmoudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmouYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQiA9IGJqLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRCID49IHNwZWVkTGltaXRTcXVhcmVkQiAqIDIpIHsKICAgICAgICAgICAgYmkud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQoKICAgICAgICBpZiAoYmouYWxsb3dTbGVlcCAmJiBiai50eXBlID09PSBCb2R5LkRZTkFNSUMgJiYgYmouc2xlZXBTdGF0ZSA9PT0gQm9keS5TTEVFUElORyAmJiBiaS5zbGVlcFN0YXRlID09PSBCb2R5LkFXQUtFICYmIGJpLnR5cGUgIT09IEJvZHkuU1RBVElDKSB7CiAgICAgICAgICBjb25zdCBzcGVlZFNxdWFyZWRBID0gYmkudmVsb2NpdHkubGVuZ3RoU3F1YXJlZCgpICsgYmkuYW5ndWxhclZlbG9jaXR5Lmxlbmd0aFNxdWFyZWQoKTsKICAgICAgICAgIGNvbnN0IHNwZWVkTGltaXRTcXVhcmVkQSA9IGJpLnNsZWVwU3BlZWRMaW1pdCAqKiAyOwoKICAgICAgICAgIGlmIChzcGVlZFNxdWFyZWRBID49IHNwZWVkTGltaXRTcXVhcmVkQSAqIDIpIHsKICAgICAgICAgICAgYmoud2FrZVVwQWZ0ZXJOYXJyb3dwaGFzZSA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfSAvLyBOb3cgd2Uga25vdyB0aGF0IGkgYW5kIGogYXJlIGluIGNvbnRhY3QuIFNldCBjb2xsaXNpb24gbWF0cml4IHN0YXRlCgoKICAgICAgICB0aGlzLmNvbGxpc2lvbk1hdHJpeC5zZXQoYmksIGJqLCB0cnVlKTsKCiAgICAgICAgaWYgKCF0aGlzLmNvbGxpc2lvbk1hdHJpeFByZXZpb3VzLmdldChiaSwgYmopKSB7CiAgICAgICAgICAvLyBGaXJzdCBjb250YWN0IQogICAgICAgICAgLy8gV2UgcmV1c2UgdGhlIGNvbGxpZGVFdmVudCBvYmplY3QsIG90aGVyd2lzZSB3ZSB3aWxsIGVuZCB1cCBjcmVhdGluZyBuZXcgb2JqZWN0cyBmb3IgZWFjaCBuZXcgY29udGFjdCwgZXZlbiBpZiB0aGVyZSdzIG5vIGV2ZW50IGxpc3RlbmVyIGF0dGFjaGVkLgogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuYm9keSA9IGJqOwogICAgICAgICAgV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQuY29udGFjdCA9IGM7CiAgICAgICAgICBiaS5kaXNwYXRjaEV2ZW50KFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50KTsKICAgICAgICAgIFdvcmxkX3N0ZXBfY29sbGlkZUV2ZW50LmJvZHkgPSBiaTsKICAgICAgICAgIGJqLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9jb2xsaWRlRXZlbnQpOwogICAgICAgIH0KCiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5zZXQoYmkuaWQsIGJqLmlkKTsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5zZXQoc2kuaWQsIHNqLmlkKTsKICAgICAgfQoKICAgICAgdGhpcy5lbWl0Q29udGFjdEV2ZW50cygpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5tYWtlQ29udGFjdENvbnN0cmFpbnRzID0gcGVyZm9ybWFuY2Uubm93KCkgLSBwcm9maWxpbmdTdGFydDsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9IC8vIFdha2UgdXAgYm9kaWVzCgoKICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgY29uc3QgYmkgPSBib2RpZXNbaV07CgogICAgICAgIGlmIChiaS53YWtlVXBBZnRlck5hcnJvd3BoYXNlKSB7CiAgICAgICAgICBiaS53YWtlVXAoKTsKICAgICAgICAgIGJpLndha2VVcEFmdGVyTmFycm93cGhhc2UgPSBmYWxzZTsKICAgICAgICB9CiAgICAgIH0gLy8gQWRkIHVzZXItYWRkZWQgY29uc3RyYWludHMKCgogICAgICBOY29uc3RyYWludHMgPSBjb25zdHJhaW50cy5sZW5ndGg7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOY29uc3RyYWludHM7IGkrKykgewogICAgICAgIGNvbnN0IGMgPSBjb25zdHJhaW50c1tpXTsKICAgICAgICBjLnVwZGF0ZSgpOwoKICAgICAgICBmb3IgKGxldCBqID0gMCwgTmVxID0gYy5lcXVhdGlvbnMubGVuZ3RoOyBqICE9PSBOZXE7IGorKykgewogICAgICAgICAgY29uc3QgZXEgPSBjLmVxdWF0aW9uc1tqXTsKICAgICAgICAgIHNvbHZlci5hZGRFcXVhdGlvbihlcSk7CiAgICAgICAgfQogICAgICB9IC8vIFNvbHZlIHRoZSBjb25zdHJhaW5lZCBzeXN0ZW0KCgogICAgICBzb2x2ZXIuc29sdmUoZHQsIHRoaXMpOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5zb2x2ZSA9IHBlcmZvcm1hbmNlLm5vdygpIC0gcHJvZmlsaW5nU3RhcnQ7CiAgICAgIH0gLy8gUmVtb3ZlIGFsbCBjb250YWN0cyBmcm9tIHNvbHZlcgoKCiAgICAgIHNvbHZlci5yZW1vdmVBbGxFcXVhdGlvbnMoKTsgLy8gQXBwbHkgZGFtcGluZywgc2VlIGh0dHA6Ly9jb2RlLmdvb2dsZS5jb20vcC9idWxsZXQvaXNzdWVzL2RldGFpbD9pZD03NCBmb3IgZGV0YWlscwoKICAgICAgY29uc3QgcG93ID0gTWF0aC5wb3c7CgogICAgICBmb3IgKGkgPSAwOyBpICE9PSBOOyBpKyspIHsKICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKCiAgICAgICAgaWYgKGJpLnR5cGUgJiBEWU5BTUlDKSB7CiAgICAgICAgICAvLyBPbmx5IGZvciBkeW5hbWljIGJvZGllcwogICAgICAgICAgY29uc3QgbGQgPSBwb3coMS4wIC0gYmkubGluZWFyRGFtcGluZywgZHQpOwogICAgICAgICAgY29uc3QgdiA9IGJpLnZlbG9jaXR5OwogICAgICAgICAgdi5zY2FsZShsZCwgdik7CiAgICAgICAgICBjb25zdCBhdiA9IGJpLmFuZ3VsYXJWZWxvY2l0eTsKCiAgICAgICAgICBpZiAoYXYpIHsKICAgICAgICAgICAgY29uc3QgYWQgPSBwb3coMS4wIC0gYmkuYW5ndWxhckRhbXBpbmcsIGR0KTsKICAgICAgICAgICAgYXYuc2NhbGUoYWQsIGF2KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChXb3JsZF9zdGVwX3ByZVN0ZXBFdmVudCk7IC8vIExlYXAgZnJvZwogICAgICAvLyB2bmV3ID0gdiArIGgqZi9tCiAgICAgIC8vIHhuZXcgPSB4ICsgaCp2bmV3CgogICAgICBpZiAoZG9Qcm9maWxpbmcpIHsKICAgICAgICBwcm9maWxpbmdTdGFydCA9IHBlcmZvcm1hbmNlLm5vdygpOwogICAgICB9CgogICAgICBjb25zdCBzdGVwbnVtYmVyID0gdGhpcy5zdGVwbnVtYmVyOwogICAgICBjb25zdCBxdWF0Tm9ybWFsaXplID0gc3RlcG51bWJlciAlICh0aGlzLnF1YXROb3JtYWxpemVTa2lwICsgMSkgPT09IDA7CiAgICAgIGNvbnN0IHF1YXROb3JtYWxpemVGYXN0ID0gdGhpcy5xdWF0Tm9ybWFsaXplRmFzdDsKCiAgICAgIGZvciAoaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGJvZGllc1tpXS5pbnRlZ3JhdGUoZHQsIHF1YXROb3JtYWxpemUsIHF1YXROb3JtYWxpemVGYXN0KTsKICAgICAgfQoKICAgICAgdGhpcy5jbGVhckZvcmNlcygpOwogICAgICB0aGlzLmJyb2FkcGhhc2UuZGlydHkgPSB0cnVlOwoKICAgICAgaWYgKGRvUHJvZmlsaW5nKSB7CiAgICAgICAgcHJvZmlsZS5pbnRlZ3JhdGUgPSBwZXJmb3JtYW5jZS5ub3coKSAtIHByb2ZpbGluZ1N0YXJ0OwogICAgICB9IC8vIFVwZGF0ZSBzdGVwIG51bWJlcgoKCiAgICAgIHRoaXMuc3RlcG51bWJlciArPSAxOwogICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50KTsgLy8gU2xlZXBpbmcgdXBkYXRlCgogICAgICBsZXQgaGFzQWN0aXZlQm9kaWVzID0gdHJ1ZTsKCiAgICAgIGlmICh0aGlzLmFsbG93U2xlZXApIHsKICAgICAgICBoYXNBY3RpdmVCb2RpZXMgPSBmYWxzZTsKCiAgICAgICAgZm9yIChpID0gMDsgaSAhPT0gTjsgaSsrKSB7CiAgICAgICAgICBjb25zdCBiaSA9IGJvZGllc1tpXTsKICAgICAgICAgIGJpLnNsZWVwVGljayh0aGlzLnRpbWUpOwoKICAgICAgICAgIGlmIChiaS5zbGVlcFN0YXRlICE9PSBCb2R5LlNMRUVQSU5HKSB7CiAgICAgICAgICAgIGhhc0FjdGl2ZUJvZGllcyA9IHRydWU7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9CgogICAgICB0aGlzLmhhc0FjdGl2ZUJvZGllcyA9IGhhc0FjdGl2ZUJvZGllczsKICAgIH0KCiAgICBlbWl0Q29udGFjdEV2ZW50cygpIHsKICAgICAgY29uc3QgaGFzQmVnaW5Db250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignZW5kQ29udGFjdCcpOwoKICAgICAgaWYgKGhhc0JlZ2luQ29udGFjdCB8fCBoYXNFbmRDb250YWN0KSB7CiAgICAgICAgdGhpcy5ib2R5T3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5Db250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSBhZGRpdGlvbnMubGVuZ3RoOyBpIDwgbDsgaSArPSAyKSB7CiAgICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IHRoaXMuZ2V0Qm9keUJ5SWQoYWRkaXRpb25zW2ldKTsKICAgICAgICAgIGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gdGhpcy5nZXRCb2R5QnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChiZWdpbkNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpbkNvbnRhY3RFdmVudC5ib2R5QSA9IGJlZ2luQ29udGFjdEV2ZW50LmJvZHlCID0gbnVsbDsKICAgICAgfQoKICAgICAgaWYgKGhhc0VuZENvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IHJlbW92YWxzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMikgewogICAgICAgICAgZW5kQ29udGFjdEV2ZW50LmJvZHlBID0gdGhpcy5nZXRCb2R5QnlJZChyZW1vdmFsc1tpXSk7CiAgICAgICAgICBlbmRDb250YWN0RXZlbnQuYm9keUIgPSB0aGlzLmdldEJvZHlCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoZW5kQ29udGFjdEV2ZW50KTsKICAgICAgICB9CgogICAgICAgIGVuZENvbnRhY3RFdmVudC5ib2R5QSA9IGVuZENvbnRhY3RFdmVudC5ib2R5QiA9IG51bGw7CiAgICAgIH0KCiAgICAgIGFkZGl0aW9ucy5sZW5ndGggPSByZW1vdmFscy5sZW5ndGggPSAwOwogICAgICBjb25zdCBoYXNCZWdpblNoYXBlQ29udGFjdCA9IHRoaXMuaGFzQW55RXZlbnRMaXN0ZW5lcignYmVnaW5TaGFwZUNvbnRhY3QnKTsKICAgICAgY29uc3QgaGFzRW5kU2hhcGVDb250YWN0ID0gdGhpcy5oYXNBbnlFdmVudExpc3RlbmVyKCdlbmRTaGFwZUNvbnRhY3QnKTsKCiAgICAgIGlmIChoYXNCZWdpblNoYXBlQ29udGFjdCB8fCBoYXNFbmRTaGFwZUNvbnRhY3QpIHsKICAgICAgICB0aGlzLnNoYXBlT3ZlcmxhcEtlZXBlci5nZXREaWZmKGFkZGl0aW9ucywgcmVtb3ZhbHMpOwogICAgICB9CgogICAgICBpZiAoaGFzQmVnaW5TaGFwZUNvbnRhY3QpIHsKICAgICAgICBmb3IgKGxldCBpID0gMCwgbCA9IGFkZGl0aW9ucy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKGFkZGl0aW9uc1tpXSk7CiAgICAgICAgICBjb25zdCBzaGFwZUIgPSB0aGlzLmdldFNoYXBlQnlJZChhZGRpdGlvbnNbaSArIDFdKTsKICAgICAgICAgIGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gc2hhcGVBOwogICAgICAgICAgYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gc2hhcGVBLmJvZHk7CiAgICAgICAgICBpZiAoc2hhcGVCKSBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gc2hhcGVCLmJvZHk7CiAgICAgICAgICB0aGlzLmRpc3BhdGNoRXZlbnQoYmVnaW5TaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBiZWdpblNoYXBlQ29udGFjdEV2ZW50LmJvZHlBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5ib2R5QiA9IGJlZ2luU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gYmVnaW5TaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBudWxsOwogICAgICB9CgogICAgICBpZiAoaGFzRW5kU2hhcGVDb250YWN0KSB7CiAgICAgICAgZm9yIChsZXQgaSA9IDAsIGwgPSByZW1vdmFscy5sZW5ndGg7IGkgPCBsOyBpICs9IDIpIHsKICAgICAgICAgIGNvbnN0IHNoYXBlQSA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2ldKTsKICAgICAgICAgIGNvbnN0IHNoYXBlQiA9IHRoaXMuZ2V0U2hhcGVCeUlkKHJlbW92YWxzW2kgKyAxXSk7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUEgPSBzaGFwZUE7CiAgICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5zaGFwZUIgPSBzaGFwZUI7CiAgICAgICAgICBpZiAoc2hhcGVBKSBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IHNoYXBlQS5ib2R5OwogICAgICAgICAgaWYgKHNoYXBlQikgZW5kU2hhcGVDb250YWN0RXZlbnQuYm9keUIgPSBzaGFwZUIuYm9keTsKICAgICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChlbmRTaGFwZUNvbnRhY3RFdmVudCk7CiAgICAgICAgfQoKICAgICAgICBlbmRTaGFwZUNvbnRhY3RFdmVudC5ib2R5QSA9IGVuZFNoYXBlQ29udGFjdEV2ZW50LmJvZHlCID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVBID0gZW5kU2hhcGVDb250YWN0RXZlbnQuc2hhcGVCID0gbnVsbDsKICAgICAgfQogICAgfQogICAgLyoqCiAgICAgKiBTZXRzIGFsbCBib2R5IGZvcmNlcyBpbiB0aGUgd29ybGQgdG8gemVyby4KICAgICAqLwoKCiAgICBjbGVhckZvcmNlcygpIHsKICAgICAgY29uc3QgYm9kaWVzID0gdGhpcy5ib2RpZXM7CiAgICAgIGNvbnN0IE4gPSBib2RpZXMubGVuZ3RoOwoKICAgICAgZm9yIChsZXQgaSA9IDA7IGkgIT09IE47IGkrKykgewogICAgICAgIGNvbnN0IGIgPSBib2RpZXNbaV07CiAgICAgICAgYi5mb3JjZTsKICAgICAgICBiLnRvcnF1ZTsKICAgICAgICBiLmZvcmNlLnNldCgwLCAwLCAwKTsKICAgICAgICBiLnRvcnF1ZS5zZXQoMCwgMCwgMCk7CiAgICAgIH0KICAgIH0KCiAgfSAvLyBUZW1wIHN0dWZmCgogIG5ldyBBQUJCKCk7CiAgY29uc3QgdG1wUmF5ID0gbmV3IFJheSgpOyAvLyBwZXJmb3JtYW5jZS5ub3coKSBmYWxsYmFjayBvbiBEYXRlLm5vdygpCgogIGNvbnN0IHBlcmZvcm1hbmNlID0gZ2xvYmFsVGhpcy5wZXJmb3JtYW5jZSB8fCB7fTsKCiAgaWYgKCFwZXJmb3JtYW5jZS5ub3cpIHsKICAgIGxldCBub3dPZmZzZXQgPSBEYXRlLm5vdygpOwoKICAgIGlmIChwZXJmb3JtYW5jZS50aW1pbmcgJiYgcGVyZm9ybWFuY2UudGltaW5nLm5hdmlnYXRpb25TdGFydCkgewogICAgICBub3dPZmZzZXQgPSBwZXJmb3JtYW5jZS50aW1pbmcubmF2aWdhdGlvblN0YXJ0OwogICAgfQoKICAgIHBlcmZvcm1hbmNlLm5vdyA9ICgpID0+IERhdGUubm93KCkgLSBub3dPZmZzZXQ7CiAgfQoKICBuZXcgVmVjMygpOyAvLyBEaXNwYXRjaGVkIGFmdGVyIHRoZSB3b3JsZCBoYXMgc3RlcHBlZCBmb3J3YXJkIGluIHRpbWUuCiAgLy8gUmV1c2FibGUgZXZlbnQgb2JqZWN0cyB0byBzYXZlIG1lbW9yeS4KCiAgY29uc3QgV29ybGRfc3RlcF9wb3N0U3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3Bvc3RTdGVwJwogIH07IC8vIERpc3BhdGNoZWQgYmVmb3JlIHRoZSB3b3JsZCBzdGVwcyBmb3J3YXJkIGluIHRpbWUuCgogIGNvbnN0IFdvcmxkX3N0ZXBfcHJlU3RlcEV2ZW50ID0gewogICAgdHlwZTogJ3ByZVN0ZXAnCiAgfTsKICBjb25zdCBXb3JsZF9zdGVwX2NvbGxpZGVFdmVudCA9IHsKICAgIHR5cGU6IEJvZHkuQ09MTElERV9FVkVOVF9OQU1FLAogICAgYm9keTogbnVsbCwKICAgIGNvbnRhY3Q6IG51bGwKICB9OyAvLyBQb29scyBmb3IgdW51c2VkIG9iamVjdHMKCiAgY29uc3QgV29ybGRfc3RlcF9vbGRDb250YWN0cyA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfZnJpY3Rpb25FcXVhdGlvblBvb2wgPSBbXTsgLy8gUmV1c2FibGUgYXJyYXlzIGZvciBjb2xsaXNpb24gcGFpcnMKCiAgY29uc3QgV29ybGRfc3RlcF9wMSA9IFtdOwogIGNvbnN0IFdvcmxkX3N0ZXBfcDIgPSBbXTsgLy8gU3R1ZmYgZm9yIGVtaXRDb250YWN0RXZlbnRzCgogIGNvbnN0IGFkZGl0aW9ucyA9IFtdOwogIGNvbnN0IHJlbW92YWxzID0gW107CiAgY29uc3QgYmVnaW5Db250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5Db250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGVuZENvbnRhY3RFdmVudCA9IHsKICAgIHR5cGU6ICdlbmRDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwKICB9OwogIGNvbnN0IGJlZ2luU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnYmVnaW5TaGFwZUNvbnRhY3QnLAogICAgYm9keUE6IG51bGwsCiAgICBib2R5QjogbnVsbCwKICAgIHNoYXBlQTogbnVsbCwKICAgIHNoYXBlQjogbnVsbAogIH07CiAgY29uc3QgZW5kU2hhcGVDb250YWN0RXZlbnQgPSB7CiAgICB0eXBlOiAnZW5kU2hhcGVDb250YWN0JywKICAgIGJvZHlBOiBudWxsLAogICAgYm9keUI6IG51bGwsCiAgICBzaGFwZUE6IG51bGwsCiAgICBzaGFwZUI6IG51bGwKICB9OwoKICBjb25zdCBhZGRDb250YWN0TWF0ZXJpYWwgPSAod29ybGQsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmLCB1dWlkKSA9PiB7CiAgICBsZXQgW21hdGVyaWFsQSwgbWF0ZXJpYWxCLCBvcHRpb25zXSA9IF9yZWY7CiAgICBjb25zdCBtYXRBID0gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWxBKTsKICAgIGNvbnN0IG1hdEIgPSBjcmVhdGVNYXRlcmlhbChtYXRlcmlhbEIpOwogICAgY29uc3QgY29udGFjdE1hdGVyaWFsID0gbmV3IENvbnRhY3RNYXRlcmlhbChtYXRBLCBtYXRCLCBvcHRpb25zKTsKICAgIGNvbnRhY3RNYXRlcmlhbC51dWlkID0gdXVpZDsKICAgIHdvcmxkLmFkZENvbnRhY3RNYXRlcmlhbChjb250YWN0TWF0ZXJpYWwpOwogIH07CiAgY29uc3QgcmVtb3ZlQ29udGFjdE1hdGVyaWFsID0gKHdvcmxkLCBjbVVVSUQpID0+IHsKICAgIGNvbnN0IGluZGV4ID0gd29ybGQuY29udGFjdG1hdGVyaWFscy5maW5kSW5kZXgoX3JlZjIgPT4gewogICAgICBsZXQgewogICAgICAgIHV1aWQKICAgICAgfSA9IF9yZWYyOwogICAgICByZXR1cm4gdXVpZCA9PT0gY21VVUlEOwogICAgfSk7CiAgICBjb25zdCBbewogICAgICBpZDogaQogICAgfSwgewogICAgICBpZDogagogICAgfV0gPSB3b3JsZC5jb250YWN0bWF0ZXJpYWxzW2luZGV4XS5tYXRlcmlhbHM7CiAgICB3b3JsZC5jb250YWN0bWF0ZXJpYWxzLnNwbGljZShpbmRleCwgMSk7CiAgICBkZWxldGUgd29ybGQuY29udGFjdE1hdGVyaWFsVGFibGUuZGF0YVtpIDwgaiA/IGAke2l9LSR7an1gIDogYCR7an0tJHtpfWBdOwogIH07CgogIGxldCBtYXRlcmlhbElkID0gMDsKICBjb25zdCBjcmVhdGVNYXRlcmlhbEZhY3RvcnkgPSBtYXRlcmlhbHMgPT4gZnVuY3Rpb24gKG5hbWVPck9wdGlvbnMpIHsKICAgIGlmIChuYW1lT3JPcHRpb25zID09PSB2b2lkIDApIHsKICAgICAgbmFtZU9yT3B0aW9ucyA9IHt9OwogICAgfQogICAgY29uc3QgbWF0ZXJpYWxPcHRpb25zID0gdHlwZW9mIG5hbWVPck9wdGlvbnMgPT09ICdzdHJpbmcnID8gewogICAgICBuYW1lOiBuYW1lT3JPcHRpb25zCiAgICB9IDogewogICAgICBuYW1lOiBTeW1ib2wuZm9yKGBNYXRlcmlhbCR7bWF0ZXJpYWxJZCsrfWApLAogICAgICAuLi5uYW1lT3JPcHRpb25zCiAgICB9OwogICAgY29uc3QgewogICAgICBuYW1lCiAgICB9ID0gbWF0ZXJpYWxPcHRpb25zOwogICAgbWF0ZXJpYWxzW25hbWVdID0gbWF0ZXJpYWxzW25hbWVdIHx8IG5ldyBNYXRlcmlhbChtYXRlcmlhbE9wdGlvbnMpOwogICAgcmV0dXJuIG1hdGVyaWFsc1tuYW1lXTsKICB9OwoKICAvKioKICAgKiBAdHlwZWRlZiB7IGltcG9ydCgnY2Fubm9uLWVzJykuTWF0ZXJpYWxPcHRpb25zIH0gTWF0ZXJpYWxPcHRpb25zCiAgICovCgogIGNvbnN0IG1ha2VWZWMzID0gX3JlZiA9PiB7CiAgICBsZXQgW3gsIHksIHpdID0gX3JlZjsKICAgIHJldHVybiBuZXcgVmVjMyh4LCB5LCB6KTsKICB9OwogIGNvbnN0IHByZXBhcmVTcGhlcmUgPSBhcmdzID0+IEFycmF5LmlzQXJyYXkoYXJncykgPyBhcmdzIDogW2FyZ3NdOwogIGNvbnN0IHByZXBhcmVDb252ZXhQb2x5aGVkcm9uID0gX3JlZjIgPT4gewogICAgbGV0IFt2LCBmYWNlcywgbiwgYSwgYm91bmRpbmdTcGhlcmVSYWRpdXNdID0gX3JlZjI7CiAgICByZXR1cm4gW3sKICAgICAgYXhlczogYSA/IGEubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZCwKICAgICAgYm91bmRpbmdTcGhlcmVSYWRpdXMsCiAgICAgIGZhY2VzLAogICAgICBub3JtYWxzOiBuID8gbi5tYXAobWFrZVZlYzMpIDogdW5kZWZpbmVkLAogICAgICB2ZXJ0aWNlczogdiA/IHYubWFwKG1ha2VWZWMzKSA6IHVuZGVmaW5lZAogICAgfV07CiAgfTsKICBmdW5jdGlvbiBjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSB7CiAgICBzd2l0Y2ggKHR5cGUpIHsKICAgICAgY2FzZSAnQm94JzoKICAgICAgICByZXR1cm4gbmV3IEJveChuZXcgVmVjMyguLi5hcmdzLm1hcCh2ID0+IHYgLyAyKSkpOwogICAgICAvLyBleHRlbnRzID0+IGhhbGZFeHRlbnRzCiAgICAgIGNhc2UgJ0NvbnZleFBvbHloZWRyb24nOgogICAgICAgIHJldHVybiBuZXcgQ29udmV4UG9seWhlZHJvbiguLi5wcmVwYXJlQ29udmV4UG9seWhlZHJvbihhcmdzKSk7CiAgICAgIGNhc2UgJ0N5bGluZGVyJzoKICAgICAgICByZXR1cm4gbmV3IEN5bGluZGVyKC4uLmFyZ3MpOwogICAgICAvLyBbIHJhZGl1c1RvcCwgcmFkaXVzQm90dG9tLCBoZWlnaHQsIG51bVNlZ21lbnRzIF0gPSBhcmdzCiAgICAgIGNhc2UgJ0hlaWdodGZpZWxkJzoKICAgICAgICByZXR1cm4gbmV3IEhlaWdodGZpZWxkKC4uLmFyZ3MpOwogICAgICAvLyBbIEFycmF5IGRhdGEsIG9wdGlvbnM6IHttaW5WYWx1ZSwgbWF4VmFsdWUsIGVsZW1lbnRTaXplfSAgXSA9IGFyZ3MKICAgICAgY2FzZSAnUGFydGljbGUnOgogICAgICAgIHJldHVybiBuZXcgUGFydGljbGUoKTsKICAgICAgLy8gbm8gYXJncwogICAgICBjYXNlICdQbGFuZSc6CiAgICAgICAgcmV0dXJuIG5ldyBQbGFuZSgpOwogICAgICAvLyBubyBhcmdzLCBpbmZpbml0ZSB4IGFuZCB5CiAgICAgIGNhc2UgJ1NwaGVyZSc6CiAgICAgICAgcmV0dXJuIG5ldyBTcGhlcmUoLi4ucHJlcGFyZVNwaGVyZShhcmdzKSk7CiAgICAgIC8vIHJhZGl1cyA9IGFyZ3MKICAgICAgY2FzZSAnVHJpbWVzaCc6CiAgICAgICAgcmV0dXJuIG5ldyBUcmltZXNoKC4uLmFyZ3MpOwogICAgICAvLyBbdmVydGljZXMsIGluZGljZXNdID0gYXJncwogICAgfQogIH0KCiAgLyoqCiAgICogQHBhcmFtIHtUSFJFRS5RdWF0ZXJuaW9ufSB0YXJnZXQKICAgKiBAcGFyYW0ge3sgcm90YXRpb24/OiBUSFJFRS5WZWN0b3IzVHVwbGUgcXVhdGVybmlvbj86IFRIUkVFLlZlY3RvcjRUdXBsZSB9fSBwcm9wcwogICAqIEByZXR1cm5zIHtUSFJFRS5RdWF0ZXJuaW9ufQogICAqLwogIGNvbnN0IHNldFF1YXRlcm5pb24gPSAodGFyZ2V0LCBfcmVmMykgPT4gewogICAgbGV0IHsKICAgICAgcXVhdGVybmlvbiwKICAgICAgcm90YXRpb24KICAgIH0gPSBfcmVmMzsKICAgIGlmIChxdWF0ZXJuaW9uKSB7CiAgICAgIHRhcmdldC5zZXQoLi4ucXVhdGVybmlvbik7CiAgICB9IGVsc2UgaWYgKHJvdGF0aW9uKSB7CiAgICAgIHRhcmdldC5zZXRGcm9tRXVsZXIoLi4ucm90YXRpb24pOwogICAgfQogICAgcmV0dXJuIHRhcmdldDsKICB9OwoKICAvKioKICAgKiBAZnVuY3Rpb24KICAgKiBAcGFyYW0ge09iamVjdH0gb3B0aW9ucwogICAqIEBwYXJhbSB7c3RyaW5nfSBvcHRpb25zLnV1aWQKICAgKiBAcGFyYW0ge0JvZHlQcm9wc30gb3B0aW9ucy5wcm9wcwogICAqIEBwYXJhbSB7Qm9keVNoYXBlVHlwZX0gb3B0aW9ucy50eXBlCiAgICogQHBhcmFtIHsobWF0ZXJpYWxPcHRpb25zOiBNYXRlcmlhbE9wdGlvbnMpID0+IE1hdGVyaWFsID19IG9wdGlvbnMuY3JlYXRlTWF0ZXJpYWwKICAgKiBAcmV0dXJucyB7Qm9keX0KICAgKi8KICBjb25zdCBwcm9wc1RvQm9keSA9IG9wdGlvbnMgPT4gewogICAgY29uc3QgewogICAgICB1dWlkLAogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgY3JlYXRlTWF0ZXJpYWwgPSBtYXRlcmlhbE9wdGlvbnMgPT4gbmV3IE1hdGVyaWFsKG1hdGVyaWFsT3B0aW9ucykKICAgIH0gPSBvcHRpb25zOwogICAgY29uc3QgewogICAgICBhbmd1bGFyRmFjdG9yID0gWzEsIDEsIDFdLAogICAgICBhbmd1bGFyVmVsb2NpdHkgPSBbMCwgMCwgMF0sCiAgICAgIGFyZ3MgPSBbXSwKICAgICAgY29sbGlzaW9uUmVzcG9uc2UsCiAgICAgIGxpbmVhckZhY3RvciA9IFsxLCAxLCAxXSwKICAgICAgbWFzcywKICAgICAgbWF0ZXJpYWwsCiAgICAgIG9uQ29sbGlkZSwKICAgICAgcG9zaXRpb24gPSBbMCwgMCwgMF0sCiAgICAgIHJvdGF0aW9uLAogICAgICBxdWF0ZXJuaW9uLAogICAgICBzaGFwZXMsCiAgICAgIHR5cGU6IGJvZHlUeXBlLAogICAgICB2ZWxvY2l0eSA9IFswLCAwLCAwXSwKICAgICAgLi4uZXh0cmEKICAgIH0gPSBwcm9wczsKICAgIGNvbnN0IGJvZHkgPSBuZXcgQm9keSh7CiAgICAgIC4uLmV4dHJhLAogICAgICBtYXNzOiBib2R5VHlwZSA9PT0gJ1N0YXRpYycgPyAwIDogbWFzcywKICAgICAgbWF0ZXJpYWw6IG1hdGVyaWFsID8gY3JlYXRlTWF0ZXJpYWwobWF0ZXJpYWwpIDogdW5kZWZpbmVkLAogICAgICB0eXBlOiBib2R5VHlwZSA/IEJvZHlbYm9keVR5cGUudG9VcHBlckNhc2UoKV0gOiB1bmRlZmluZWQKICAgIH0pOwogICAgYm9keS51dWlkID0gdXVpZDsKICAgIGlmIChjb2xsaXNpb25SZXNwb25zZSAhPT0gdW5kZWZpbmVkKSB7CiAgICAgIGJvZHkuY29sbGlzaW9uUmVzcG9uc2UgPSBjb2xsaXNpb25SZXNwb25zZTsKICAgIH0KICAgIGlmICh0eXBlID09PSAnQ29tcG91bmQnKSB7CiAgICAgIHNoYXBlcy5mb3JFYWNoKF9yZWY0ID0+IHsKICAgICAgICBsZXQgewogICAgICAgICAgdHlwZSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICBwb3NpdGlvbiwKICAgICAgICAgIHJvdGF0aW9uLAogICAgICAgICAgcXVhdGVybmlvbiwKICAgICAgICAgIG1hdGVyaWFsLAogICAgICAgICAgLi4uZXh0cmEKICAgICAgICB9ID0gX3JlZjQ7CiAgICAgICAgY29uc3Qgc2hhcGVCb2R5ID0gYm9keS5hZGRTaGFwZShjcmVhdGVTaGFwZSh0eXBlLCBhcmdzKSwgcG9zaXRpb24gPyBuZXcgVmVjMyguLi5wb3NpdGlvbikgOiB1bmRlZmluZWQsIHNldFF1YXRlcm5pb24obmV3IFF1YXRlcm5pb24oMCwgMCwgMCwgMSksIHsKICAgICAgICAgIHF1YXRlcm5pb24sCiAgICAgICAgICByb3RhdGlvbgogICAgICAgIH0pKTsKICAgICAgICBpZiAobWF0ZXJpYWwpIHNoYXBlQm9keS5tYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsKG1hdGVyaWFsKTsKICAgICAgICBPYmplY3QuYXNzaWduKHNoYXBlQm9keSwgZXh0cmEpOwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIGJvZHkuYWRkU2hhcGUoY3JlYXRlU2hhcGUodHlwZSwgYXJncykpOwogICAgfQogICAgYm9keS5wb3NpdGlvbi5zZXQocG9zaXRpb25bMF0sIHBvc2l0aW9uWzFdLCBwb3NpdGlvblsyXSk7CiAgICBib2R5LnZlbG9jaXR5LnNldCh2ZWxvY2l0eVswXSwgdmVsb2NpdHlbMV0sIHZlbG9jaXR5WzJdKTsKICAgIGJvZHkuYW5ndWxhclZlbG9jaXR5LnNldChhbmd1bGFyVmVsb2NpdHlbMF0sIGFuZ3VsYXJWZWxvY2l0eVsxXSwgYW5ndWxhclZlbG9jaXR5WzJdKTsKICAgIGJvZHkubGluZWFyRmFjdG9yLnNldChsaW5lYXJGYWN0b3JbMF0sIGxpbmVhckZhY3RvclsxXSwgbGluZWFyRmFjdG9yWzJdKTsKICAgIGJvZHkuYW5ndWxhckZhY3Rvci5zZXQoYW5ndWxhckZhY3RvclswXSwgYW5ndWxhckZhY3RvclsxXSwgYW5ndWxhckZhY3RvclsyXSk7CiAgICBzZXRRdWF0ZXJuaW9uKGJvZHkucXVhdGVybmlvbiwgewogICAgICBxdWF0ZXJuaW9uLAogICAgICByb3RhdGlvbgogICAgfSk7CiAgICByZXR1cm4gYm9keTsKICB9OwoKICBjb25zdCBhZGRCb2RpZXMgPSAoc3RhdGUsIGNyZWF0ZU1hdGVyaWFsLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wcywKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBmb3IgKGxldCBpID0gMDsgaSA8IHV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgY29uc3QgYm9keSA9IHByb3BzVG9Cb2R5KHsKICAgICAgICBjcmVhdGVNYXRlcmlhbCwKICAgICAgICBwcm9wczogcHJvcHNbaV0sCiAgICAgICAgdHlwZSwKICAgICAgICB1dWlkOiB1dWlkW2ldCiAgICAgIH0pOwogICAgICBzdGF0ZS53b3JsZC5hZGRCb2R5KGJvZHkpOwogICAgICBpZiAocHJvcHNbaV0ub25Db2xsaWRlKSBib2R5LmFkZEV2ZW50TGlzdGVuZXIoJ2NvbGxpZGUnLCBfcmVmMiA9PiB7CiAgICAgICAgbGV0IHsKICAgICAgICAgIHR5cGUsCiAgICAgICAgICBib2R5LAogICAgICAgICAgdGFyZ2V0LAogICAgICAgICAgY29udGFjdAogICAgICAgIH0gPSBfcmVmMjsKICAgICAgICBpZiAoIWJvZHkudXVpZCB8fCAhdGFyZ2V0LnV1aWQpIHJldHVybjsKICAgICAgICBjb25zdCB7CiAgICAgICAgICBuaSwKICAgICAgICAgIHJpLAogICAgICAgICAgcmosCiAgICAgICAgICBiaSwKICAgICAgICAgIGJqLAogICAgICAgICAgaWQKICAgICAgICB9ID0gY29udGFjdDsKICAgICAgICBjb25zdCBjb250YWN0UG9pbnQgPSBiaS5wb3NpdGlvbi52YWRkKHJpKTsKICAgICAgICBjb25zdCBjb250YWN0Tm9ybWFsID0gYmkgPT09IGJvZHkgPyBuaSA6IG5pLnNjYWxlKC0xKTsKICAgICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICAgIGJvZHk6IGJvZHkudXVpZCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlcnM6IHsKICAgICAgICAgICAgYm9keUZpbHRlckdyb3VwOiBib2R5LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICBib2R5RmlsdGVyTWFzazogYm9keS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJHcm91cDogdGFyZ2V0LmNvbGxpc2lvbkZpbHRlckdyb3VwLAogICAgICAgICAgICB0YXJnZXRGaWx0ZXJNYXNrOiB0YXJnZXQuY29sbGlzaW9uRmlsdGVyTWFzawogICAgICAgICAgfSwKICAgICAgICAgIGNvbnRhY3Q6IHsKICAgICAgICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiB1c2UgaWQgaW5zdGVhZCBvZiB1dWlkCiAgICAgICAgICAgIGJpOiBiaS51dWlkLAogICAgICAgICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIFRPRE86IHVzZSBpZCBpbnN0ZWFkIG9mIHV1aWQKICAgICAgICAgICAgYmo6IGJqLnV1aWQsCiAgICAgICAgICAgIC8vIE5vcm1hbCBvZiB0aGUgY29udGFjdCwgcmVsYXRpdmUgdG8gdGhlIGNvbGxpZGluZyBib2R5CiAgICAgICAgICAgIGNvbnRhY3ROb3JtYWw6IGNvbnRhY3ROb3JtYWwudG9BcnJheSgpLAogICAgICAgICAgICAvLyBXb3JsZCBwb3NpdGlvbiBvZiB0aGUgY29udGFjdAogICAgICAgICAgICBjb250YWN0UG9pbnQ6IGNvbnRhY3RQb2ludC50b0FycmF5KCksCiAgICAgICAgICAgIGlkLAogICAgICAgICAgICBpbXBhY3RWZWxvY2l0eTogY29udGFjdC5nZXRJbXBhY3RWZWxvY2l0eUFsb25nTm9ybWFsKCksCiAgICAgICAgICAgIG5pOiBuaS50b0FycmF5KCksCiAgICAgICAgICAgIHJpOiByaS50b0FycmF5KCksCiAgICAgICAgICAgIHJqOiByai50b0FycmF5KCkKICAgICAgICAgIH0sCiAgICAgICAgICBvcDogJ2V2ZW50JywKICAgICAgICAgIHRhcmdldDogdGFyZ2V0LnV1aWQsCiAgICAgICAgICB0eXBlCiAgICAgICAgfSk7CiAgICAgIH0pOwogICAgfQogIH07CgogIGNvbnN0IHRyaXBsZXRUb1ZlYzMgPSB0ID0+IHQgPyBuZXcgVmVjMyguLi50KSA6IHVuZGVmaW5lZDsKCiAgY29uc3QgYWRkQ29uc3RyYWludCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IFtib2R5QSwgYm9keUIsIHsKICAgICAgICBhbmdsZSwKICAgICAgICBheGlzQSwKICAgICAgICBheGlzQiwKICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgIGRpc3RhbmNlLAogICAgICAgIG1heEZvcmNlLAogICAgICAgIG1heE11bHRpcGxpZXIsCiAgICAgICAgcGl2b3RBLAogICAgICAgIHBpdm90QiwKICAgICAgICB0d2lzdEFuZ2xlLAogICAgICAgIHdha2VVcEJvZGllcwogICAgICB9XSwKICAgICAgdHlwZSwKICAgICAgdXVpZAogICAgfSA9IF9yZWY7CiAgICBsZXQgY29uc3RyYWludDsKICAgIHN3aXRjaCAodHlwZSkgewogICAgICBjYXNlICdQb2ludFRvUG9pbnQnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgUG9pbnRUb1BvaW50Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCB0cmlwbGV0VG9WZWMzKHBpdm90QSksIHN0YXRlLmJvZGllc1tib2R5Ql0sIHRyaXBsZXRUb1ZlYzMocGl2b3RCKSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdDb25lVHdpc3QnOgogICAgICAgIGNvbnN0cmFpbnQgPSBuZXcgQ29uZVR3aXN0Q29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBhbmdsZSwKICAgICAgICAgIGF4aXNBOiB0cmlwbGV0VG9WZWMzKGF4aXNBKSwKICAgICAgICAgIGF4aXNCOiB0cmlwbGV0VG9WZWMzKGF4aXNCKSwKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICBtYXhGb3JjZSwKICAgICAgICAgIHBpdm90QTogdHJpcGxldFRvVmVjMyhwaXZvdEEpLAogICAgICAgICAgcGl2b3RCOiB0cmlwbGV0VG9WZWMzKHBpdm90QiksCiAgICAgICAgICB0d2lzdEFuZ2xlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0hpbmdlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IEhpbmdlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCB7CiAgICAgICAgICBheGlzQTogdHJpcGxldFRvVmVjMyhheGlzQSksCiAgICAgICAgICBheGlzQjogdHJpcGxldFRvVmVjMyhheGlzQiksCiAgICAgICAgICBjb2xsaWRlQ29ubmVjdGVkLAogICAgICAgICAgbWF4Rm9yY2UsCiAgICAgICAgICBwaXZvdEE6IHRyaXBsZXRUb1ZlYzMocGl2b3RBKSwKICAgICAgICAgIHBpdm90QjogdHJpcGxldFRvVmVjMyhwaXZvdEIpCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ0Rpc3RhbmNlJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IERpc3RhbmNlQ29uc3RyYWludChzdGF0ZS5ib2RpZXNbYm9keUFdLCBzdGF0ZS5ib2RpZXNbYm9keUJdLCBkaXN0YW5jZSwgbWF4Rm9yY2UpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdMb2NrJzoKICAgICAgICBjb25zdHJhaW50ID0gbmV3IExvY2tDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIG1heEZvcmNlCiAgICAgICAgfSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgICAgICAgY29uc3RyYWludCA9IG5ldyBDb25zdHJhaW50KHN0YXRlLmJvZGllc1tib2R5QV0sIHN0YXRlLmJvZGllc1tib2R5Ql0sIHsKICAgICAgICAgIGNvbGxpZGVDb25uZWN0ZWQsCiAgICAgICAgICB3YWtlVXBCb2RpZXMKICAgICAgICB9KTsKICAgICAgICBicmVhazsKICAgIH0KICAgIGNvbnN0cmFpbnQudXVpZCA9IHV1aWQ7CiAgICBzdGF0ZS53b3JsZC5hZGRDb25zdHJhaW50KGNvbnN0cmFpbnQpOwogICAgaWYgKG1heE11bHRpcGxpZXIgIT09IHVuZGVmaW5lZCkgewogICAgICBjb25zdCBwb3N0U3RlcENvbnN0cmFpbnQgPSAoKSA9PiB7CiAgICAgICAgLy8gVGhlIG11bHRpcGxpZXIgaXMgcHJvcG9ydGlvbmFsIHRvIGhvdyBtdWNoIGZvcmNlIGlzIGFkZGVkIHRvIHRoZSBib2RpZXMgYnkgdGhlIGNvbnN0cmFpbnQuCiAgICAgICAgLy8gSWYgdGhpcyBleGNlZWRzIGEgbGltaXQgdGhlIGNvbnN0cmFpbnQgaXMgZGlzYWJsZWQuCiAgICAgICAgY29uc3QgbXVsdGlwbGllciA9IE1hdGguYWJzKGNvbnN0cmFpbnQuZXF1YXRpb25zWzBdLm11bHRpcGxpZXIpOwogICAgICAgIGlmIChtdWx0aXBsaWVyID4gbWF4TXVsdGlwbGllcikgewogICAgICAgICAgY29uc3RyYWludC5kaXNhYmxlKCk7CiAgICAgICAgfQogICAgICB9OwogICAgICBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSA9IHBvc3RTdGVwQ29uc3RyYWludDsKICAgICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1t1dWlkXSk7CiAgICB9CiAgfTsKCiAgZnVuY3Rpb24gdG9VcHBlcmNhc2Uoc3RyKSB7CiAgICByZXR1cm4gc3RyLnRvVXBwZXJDYXNlKCk7CiAgfQogIGNvbnN0IGFkZFJheSA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcHJvcHM6IHsKICAgICAgICBmcm9tLAogICAgICAgIG1vZGUsCiAgICAgICAgdG8sCiAgICAgICAgLi4ucmF5T3B0aW9ucwogICAgICB9LAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHJheSA9IG5ldyBSYXkodHJpcGxldFRvVmVjMyhmcm9tKSwgdHJpcGxldFRvVmVjMyh0bykpOwogICAgY29uc3Qgb3B0aW9ucyA9IHsKICAgICAgbW9kZTogUkFZX01PREVTW3RvVXBwZXJjYXNlKG1vZGUpXSwKICAgICAgcmVzdWx0OiBuZXcgUmF5Y2FzdFJlc3VsdCgpLAogICAgICAuLi5yYXlPcHRpb25zCiAgICB9OwogICAgc3RhdGUucmF5c1t1dWlkXSA9ICgpID0+IHsKICAgICAgcmF5LmludGVyc2VjdFdvcmxkKHN0YXRlLndvcmxkLCBvcHRpb25zKTsKICAgICAgaWYgKCFvcHRpb25zLnJlc3VsdCB8fCAhb3B0aW9ucy5yZXN1bHQuYm9keSkgcmV0dXJuOwogICAgICBjb25zdCB7CiAgICAgICAgYm9keSwKICAgICAgICBzaGFwZSwKICAgICAgICByYXlGcm9tV29ybGQsCiAgICAgICAgcmF5VG9Xb3JsZCwKICAgICAgICBoaXROb3JtYWxXb3JsZCwKICAgICAgICBoaXRQb2ludFdvcmxkLAogICAgICAgIC4uLnJlc3QKICAgICAgfSA9IG9wdGlvbnMucmVzdWx0OwogICAgICBjb25zdCBib2R5VVVJRCA9IGJvZHkudXVpZDsKICAgICAgaWYgKCFib2R5VVVJRCkgcmV0dXJuOwogICAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgICBib2R5OiBib2R5VVVJRCwKICAgICAgICBoaXROb3JtYWxXb3JsZDogaGl0Tm9ybWFsV29ybGQudG9BcnJheSgpLAogICAgICAgIGhpdFBvaW50V29ybGQ6IGhpdFBvaW50V29ybGQudG9BcnJheSgpLAogICAgICAgIG9wOiAnZXZlbnQnLAogICAgICAgIHJheTogewogICAgICAgICAgY29sbGlzaW9uRmlsdGVyR3JvdXA6IHJheS5jb2xsaXNpb25GaWx0ZXJHcm91cCwKICAgICAgICAgIGNvbGxpc2lvbkZpbHRlck1hc2s6IHJheS5jb2xsaXNpb25GaWx0ZXJNYXNrLAogICAgICAgICAgZGlyZWN0aW9uOiByYXkuZGlyZWN0aW9uLnRvQXJyYXkoKSwKICAgICAgICAgIGZyb20sCiAgICAgICAgICB0bywKICAgICAgICAgIHV1aWQKICAgICAgICB9LAogICAgICAgIHJheUZyb21Xb3JsZDogcmF5RnJvbVdvcmxkLnRvQXJyYXkoKSwKICAgICAgICByYXlUb1dvcmxkOiByYXlUb1dvcmxkLnRvQXJyYXkoKSwKICAgICAgICBzaGFwZTogc2hhcGUgPyB7CiAgICAgICAgICAuLi5zaGFwZSwKICAgICAgICAgIGJvZHk6IGJvZHlVVUlECiAgICAgICAgfSA6IG51bGwsCiAgICAgICAgdHlwZTogJ3JheWhpdCcsCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH07CiAgICBzdGF0ZS53b3JsZC5hZGRFdmVudExpc3RlbmVyKCdwcmVTdGVwJywgc3RhdGUucmF5c1t1dWlkXSk7CiAgfTsKCiAgY29uc3QgYWRkUmF5Y2FzdFZlaGljbGUgPSAoc3RhdGUsIGRhdGEpID0+IHsKICAgIGNvbnN0IFtjaGFzc2lzQm9keSwgd2hlZWxzLCB3aGVlbEluZm9zLCBpbmRleEZvcndhcmRBeGlzLCBpbmRleFJpZ2h0QXhpcywgaW5kZXhVcEF4aXNdID0gZGF0YS5wcm9wczsKICAgIGNvbnN0IHZlaGljbGUgPSBuZXcgUmF5Y2FzdFZlaGljbGUoewogICAgICBjaGFzc2lzQm9keTogc3RhdGUuYm9kaWVzW2NoYXNzaXNCb2R5XSwKICAgICAgaW5kZXhGb3J3YXJkQXhpcywKICAgICAgaW5kZXhSaWdodEF4aXMsCiAgICAgIGluZGV4VXBBeGlzCiAgICB9KTsKICAgIHZlaGljbGUud29ybGQgPSBzdGF0ZS53b3JsZDsKICAgIGZvciAobGV0IGkgPSAwOyBpIDwgd2hlZWxJbmZvcy5sZW5ndGg7IGkrKykgewogICAgICBjb25zdCB7CiAgICAgICAgYXhsZUxvY2FsLAogICAgICAgIGNoYXNzaXNDb25uZWN0aW9uUG9pbnRMb2NhbCwKICAgICAgICBkaXJlY3Rpb25Mb2NhbCwKICAgICAgICAuLi5yZXN0CiAgICAgIH0gPSB3aGVlbEluZm9zW2ldOwogICAgICB2ZWhpY2xlLmFkZFdoZWVsKHsKICAgICAgICBheGxlTG9jYWw6IHRyaXBsZXRUb1ZlYzMoYXhsZUxvY2FsKSwKICAgICAgICBjaGFzc2lzQ29ubmVjdGlvblBvaW50TG9jYWw6IHRyaXBsZXRUb1ZlYzMoY2hhc3Npc0Nvbm5lY3Rpb25Qb2ludExvY2FsKSwKICAgICAgICBkaXJlY3Rpb25Mb2NhbDogdHJpcGxldFRvVmVjMyhkaXJlY3Rpb25Mb2NhbCksCiAgICAgICAgLi4ucmVzdAogICAgICB9KTsKICAgIH0KICAgIGNvbnN0IHByZVN0ZXAgPSAoKSA9PiB7CiAgICAgIHZlaGljbGUudXBkYXRlVmVoaWNsZShzdGF0ZS53b3JsZC5kdCk7CiAgICB9OwogICAgY29uc3QgcG9zdFN0ZXAgPSAoKSA9PiB7CiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdmVoaWNsZS53aGVlbEluZm9zLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmVoaWNsZS51cGRhdGVXaGVlbFRyYW5zZm9ybShpKTsKICAgICAgICBjb25zdCB0ID0gdmVoaWNsZS53aGVlbEluZm9zW2ldLndvcmxkVHJhbnNmb3JtOwogICAgICAgIGNvbnN0IHdoZWVsQm9keSA9IHN0YXRlLmJvZGllc1t3aGVlbHNbaV1dOwogICAgICAgIHdoZWVsQm9keS5wb3NpdGlvbi5jb3B5KHQucG9zaXRpb24pOwogICAgICAgIHdoZWVsQm9keS5xdWF0ZXJuaW9uLmNvcHkodC5xdWF0ZXJuaW9uKTsKICAgICAgfQogICAgfTsKICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0gPSB7CiAgICAgIHBvc3RTdGVwLAogICAgICBwcmVTdGVwLAogICAgICB2ZWhpY2xlCiAgICB9OwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncHJlU3RlcCcsIHByZVN0ZXApOwogICAgc3RhdGUud29ybGQuYWRkRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBwb3N0U3RlcCk7CiAgfTsKCiAgY29uc3QgYWRkU3ByaW5nID0gKHN0YXRlLCBfcmVmKSA9PiB7CiAgICBsZXQgewogICAgICBwcm9wczogW2JvZHlBLCBib2R5QiwgewogICAgICAgIGRhbXBpbmcsCiAgICAgICAgbG9jYWxBbmNob3JBLAogICAgICAgIGxvY2FsQW5jaG9yQiwKICAgICAgICByZXN0TGVuZ3RoLAogICAgICAgIHN0aWZmbmVzcywKICAgICAgICB3b3JsZEFuY2hvckEsCiAgICAgICAgd29ybGRBbmNob3JCCiAgICAgIH1dLAogICAgICB1dWlkCiAgICB9ID0gX3JlZjsKICAgIGNvbnN0IHNwcmluZyA9IG5ldyBTcHJpbmcoc3RhdGUuYm9kaWVzW2JvZHlBXSwgc3RhdGUuYm9kaWVzW2JvZHlCXSwgewogICAgICBkYW1waW5nLAogICAgICBsb2NhbEFuY2hvckE6IHRyaXBsZXRUb1ZlYzMobG9jYWxBbmNob3JBKSwKICAgICAgbG9jYWxBbmNob3JCOiB0cmlwbGV0VG9WZWMzKGxvY2FsQW5jaG9yQiksCiAgICAgIHJlc3RMZW5ndGgsCiAgICAgIHN0aWZmbmVzcywKICAgICAgd29ybGRBbmNob3JBOiB0cmlwbGV0VG9WZWMzKHdvcmxkQW5jaG9yQSksCiAgICAgIHdvcmxkQW5jaG9yQjogdHJpcGxldFRvVmVjMyh3b3JsZEFuY2hvckIpCiAgICB9KTsKICAgIHNwcmluZy51dWlkID0gdXVpZDsKICAgIGNvbnN0IHBvc3RTdGVwU3ByaW5nID0gKCkgPT4gc3ByaW5nLmFwcGx5Rm9yY2UoKTsKICAgIHN0YXRlLnNwcmluZ3NbdXVpZF0gPSBwb3N0U3RlcFNwcmluZzsKICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1t1dWlkXSA9IHNwcmluZzsKCiAgICAvLyBDb21wdXRlIHRoZSBmb3JjZSBhZnRlciBlYWNoIHN0ZXAKICAgIHN0YXRlLndvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1t1dWlkXSk7CiAgfTsKCiAgZnVuY3Rpb24gZW1pdEJlZ2luQ29udGFjdChfcmVmKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmOwogICAgaWYgKCEoYm9keUEgIT0gbnVsbCAmJiBib2R5QS51dWlkKSB8fCAhKGJvZHlCICE9IG51bGwgJiYgYm9keUIudXVpZCkpIHJldHVybjsKICAgIHNlbGYucG9zdE1lc3NhZ2UoewogICAgICBib2R5QTogYm9keUEudXVpZCwKICAgICAgYm9keUI6IGJvZHlCLnV1aWQsCiAgICAgIG9wOiAnZXZlbnQnLAogICAgICB0eXBlOiAnY29sbGlkZUJlZ2luJwogICAgfSk7CiAgfQogIGZ1bmN0aW9uIGVtaXRFbmRDb250YWN0KF9yZWYyKSB7CiAgICBsZXQgewogICAgICBib2R5QSwKICAgICAgYm9keUIKICAgIH0gPSBfcmVmMjsKICAgIGlmICghKGJvZHlBICE9IG51bGwgJiYgYm9keUEudXVpZCkgfHwgIShib2R5QiAhPSBudWxsICYmIGJvZHlCLnV1aWQpKSByZXR1cm47CiAgICBzZWxmLnBvc3RNZXNzYWdlKHsKICAgICAgYm9keUE6IGJvZHlBLnV1aWQsCiAgICAgIGJvZHlCOiBib2R5Qi51dWlkLAogICAgICBvcDogJ2V2ZW50JywKICAgICAgdHlwZTogJ2NvbGxpZGVFbmQnCiAgICB9KTsKICB9CiAgY29uc3QgaW5pdCA9ICh3b3JsZCwgX3JlZjMpID0+IHsKICAgIGxldCB7CiAgICAgIGFsbG93U2xlZXAsCiAgICAgIGF4aXNJbmRleCA9IDAsCiAgICAgIGJyb2FkcGhhc2UsCiAgICAgIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwsCiAgICAgIGZyaWN0aW9uR3Jhdml0eSwKICAgICAgZ3Jhdml0eSwKICAgICAgaXRlcmF0aW9ucywKICAgICAgcXVhdE5vcm1hbGl6ZUZhc3QsCiAgICAgIHF1YXROb3JtYWxpemVTa2lwLAogICAgICBzb2x2ZXIsCiAgICAgIHRvbGVyYW5jZQogICAgfSA9IF9yZWYzOwogICAgd29ybGQuYWxsb3dTbGVlcCA9IGFsbG93U2xlZXA7CiAgICB3b3JsZC5ncmF2aXR5LnNldCguLi5ncmF2aXR5KTsKICAgIHdvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGZyaWN0aW9uR3Jhdml0eSA/IG5ldyBWZWMzKC4uLmZyaWN0aW9uR3Jhdml0eSkgOiB1bmRlZmluZWQ7CiAgICB3b3JsZC5xdWF0Tm9ybWFsaXplRmFzdCA9IHF1YXROb3JtYWxpemVGYXN0OwogICAgd29ybGQucXVhdE5vcm1hbGl6ZVNraXAgPSBxdWF0Tm9ybWFsaXplU2tpcDsKICAgIGlmIChzb2x2ZXIgPT09ICdTcGxpdCcpIHsKICAgICAgd29ybGQuc29sdmVyID0gbmV3IFNwbGl0U29sdmVyKG5ldyBHU1NvbHZlcigpKTsKICAgIH0KICAgIGlmICh3b3JsZC5zb2x2ZXIgaW5zdGFuY2VvZiBHU1NvbHZlcikgewogICAgICB3b3JsZC5zb2x2ZXIudG9sZXJhbmNlID0gdG9sZXJhbmNlOwogICAgICB3b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGl0ZXJhdGlvbnM7CiAgICB9CiAgICB3b3JsZC5icm9hZHBoYXNlID0gYnJvYWRwaGFzZSA9PT0gJ1NBUCcgPyBuZXcgU0FQQnJvYWRwaGFzZSh3b3JsZCkgOiBuZXcgTmFpdmVCcm9hZHBoYXNlKCk7CiAgICBpZiAod29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgd29ybGQuYnJvYWRwaGFzZS5heGlzSW5kZXggPSBheGlzSW5kZXg7CiAgICB9CiAgICB3b3JsZC5hZGRFdmVudExpc3RlbmVyKCdiZWdpbkNvbnRhY3QnLCBlbWl0QmVnaW5Db250YWN0KTsKICAgIHdvcmxkLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZENvbnRhY3QnLCBlbWl0RW5kQ29udGFjdCk7CiAgICBPYmplY3QuYXNzaWduKHdvcmxkLmRlZmF1bHRDb250YWN0TWF0ZXJpYWwsIGRlZmF1bHRDb250YWN0TWF0ZXJpYWwpOwogIH07CgogIGNvbnN0IGlzUW9yViA9IHYgPT4gdiBpbnN0YW5jZW9mIFF1YXRlcm5pb24gfHwgdiBpbnN0YW5jZW9mIFZlYzM7CiAgY29uc3Qgc3RlcCA9IChzdGF0ZSwgX3JlZikgPT4gewogICAgbGV0IHsKICAgICAgcG9zaXRpb25zLAogICAgICBwcm9wczogewogICAgICAgIG1heFN1YlN0ZXBzLAogICAgICAgIHN0ZXBTaXplLAogICAgICAgIHRpbWVTaW5jZUxhc3RDYWxsZWQKICAgICAgfSwKICAgICAgcXVhdGVybmlvbnMKICAgIH0gPSBfcmVmOwogICAgc3RhdGUud29ybGQuc3RlcChzdGVwU2l6ZSwgdGltZVNpbmNlTGFzdENhbGxlZCwgbWF4U3ViU3RlcHMpOwogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzdGF0ZS53b3JsZC5ib2RpZXMubGVuZ3RoOyBpICs9IDEpIHsKICAgICAgY29uc3QgcCA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5wb3NpdGlvbjsKICAgICAgY29uc3QgcSA9IHN0YXRlLndvcmxkLmJvZGllc1tpXS5xdWF0ZXJuaW9uOwogICAgICBwb3NpdGlvbnNbMyAqIGkgKyAwXSA9IHAueDsKICAgICAgcG9zaXRpb25zWzMgKiBpICsgMV0gPSBwLnk7CiAgICAgIHBvc2l0aW9uc1szICogaSArIDJdID0gcC56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDBdID0gcS54OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDFdID0gcS55OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDJdID0gcS56OwogICAgICBxdWF0ZXJuaW9uc1s0ICogaSArIDNdID0gcS53OwogICAgfQogICAgY29uc3Qgb2JzZXJ2YXRpb25zID0gW107CiAgICBmb3IgKGNvbnN0IGlkIG9mIE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpKSB7CiAgICAgIGNvbnN0IFt1dWlkLCB0eXBlLCB0YXJnZXQgPSAnYm9kaWVzJ10gPSBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXTsKICAgICAgY29uc3QgewogICAgICAgIGJvZGllcywKICAgICAgICB2ZWhpY2xlcwogICAgICB9ID0gc3RhdGU7CiAgICAgIGNvbnN0IHZhbHVlID0gdGFyZ2V0ID09PSAndmVoaWNsZXMnID8KICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdmVoaWNsZXNbdXVpZF0udmVoaWNsZVt0eXBlXSA6CiAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgVE9ETzogRGlmZmVyZW50aWF0ZSB0aGVzZSAidHlwZXMiCiAgICAgIGJvZGllc1t1dWlkXVt0eXBlXTsKICAgICAgY29uc3Qgc2VyaWFsaXphYmxlVmFsdWUgPSBpc1FvclYodmFsdWUpID8gdmFsdWUudG9BcnJheSgpIDogdmFsdWU7CiAgICAgIG9ic2VydmF0aW9ucy5wdXNoKFtOdW1iZXIoaWQpLCBzZXJpYWxpemFibGVWYWx1ZSwKICAgICAgLy8gQHRzLWV4cGVjdC1lcnJvciBUT0RPOiBEaWZmZXJlbnRpYXRlIHRoZXNlICJ0eXBlcyIKICAgICAgdHlwZV0pOwogICAgfQogICAgY29uc3QgbWVzc2FnZSA9IHsKICAgICAgYWN0aXZlOiBzdGF0ZS53b3JsZC5oYXNBY3RpdmVCb2RpZXMsCiAgICAgIG9ic2VydmF0aW9ucywKICAgICAgb3A6ICdmcmFtZScsCiAgICAgIHBvc2l0aW9ucywKICAgICAgcXVhdGVybmlvbnMKICAgIH07CiAgICBpZiAoc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcpIHsKICAgICAgbWVzc2FnZS5ib2RpZXMgPSBzdGF0ZS53b3JsZC5ib2RpZXMucmVkdWNlKChib2RpZXMsIGJvZHkpID0+IHsKICAgICAgICBpZiAoYm9keS51dWlkKSBib2RpZXMucHVzaChib2R5LnV1aWQpOwogICAgICAgIHJldHVybiBib2RpZXM7CiAgICAgIH0sIFtdKTsKICAgICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSBmYWxzZTsKICAgIH0KICAgIHNlbGYucG9zdE1lc3NhZ2UobWVzc2FnZSwgW3Bvc2l0aW9ucy5idWZmZXIsIHF1YXRlcm5pb25zLmJ1ZmZlcl0pOwogIH07CgogIGNvbnN0IHN0YXRlID0gewogICAgYm9kaWVzOiB7fSwKICAgIGJvZGllc05lZWRTeW5jaW5nOiBmYWxzZSwKICAgIGNvbnN0cmFpbnRzOiB7fSwKICAgIG1hdGVyaWFsczoge30sCiAgICByYXlzOiB7fSwKICAgIHNwcmluZ0luc3RhbmNlczoge30sCiAgICBzcHJpbmdzOiB7fSwKICAgIHN1YnNjcmlwdGlvbnM6IHt9LAogICAgdmVoaWNsZXM6IHt9LAogICAgd29ybGQ6IG5ldyBXb3JsZCgpCiAgfTsKCiAgLy8vIDxyZWZlcmVuY2Ugbm8tZGVmYXVsdC1saWI9InRydWUiLz4KICBjb25zdCBpc0hpbmdlQ29uc3RyYWludCA9IGMgPT4gYyBpbnN0YW5jZW9mIEhpbmdlQ29uc3RyYWludDsKICBmdW5jdGlvbiBzeW5jQm9kaWVzKCkgewogICAgc3RhdGUuYm9kaWVzTmVlZFN5bmNpbmcgPSB0cnVlOwogICAgc3RhdGUuYm9kaWVzID0gc3RhdGUud29ybGQuYm9kaWVzLnJlZHVjZSgoYm9kaWVzLCBib2R5KSA9PiBib2R5LnV1aWQgPyB7CiAgICAgIC4uLmJvZGllcywKICAgICAgW2JvZHkudXVpZF06IGJvZHkKICAgIH0gOiBib2RpZXMsIHt9KTsKICB9CiAgY29uc3QgYnJvYWRwaGFzZXMgPSB7CiAgICBOYWl2ZUJyb2FkcGhhc2UsCiAgICBTQVBCcm9hZHBoYXNlCiAgfTsKICBjb25zdCBjcmVhdGVNYXRlcmlhbCA9IGNyZWF0ZU1hdGVyaWFsRmFjdG9yeShzdGF0ZS5tYXRlcmlhbHMpOwogIHNlbGYub25tZXNzYWdlID0gX3JlZiA9PiB7CiAgICBsZXQgewogICAgICBkYXRhCiAgICB9ID0gX3JlZjsKICAgIHN3aXRjaCAoZGF0YS5vcCkgewogICAgICBjYXNlICdpbml0JzoKICAgICAgICB7CiAgICAgICAgICBpbml0KHN0YXRlLndvcmxkLCBkYXRhLnByb3BzKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc3RlcCc6CiAgICAgICAgewogICAgICAgICAgc3RlcChzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZEJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgYWRkQm9kaWVzKHN0YXRlLCBjcmVhdGVNYXRlcmlhbCwgZGF0YSk7CiAgICAgICAgICBzeW5jQm9kaWVzKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3JlbW92ZUJvZGllcyc6CiAgICAgICAgewogICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBkYXRhLnV1aWQubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlQm9keShzdGF0ZS5ib2RpZXNbZGF0YS51dWlkW2ldXSk7CiAgICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWRbaV0pOwogICAgICAgICAgICBpZiAoa2V5KSB7CiAgICAgICAgICAgICAgZGVsZXRlIHN0YXRlLnN1YnNjcmlwdGlvbnNba2V5XTsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgc3luY0JvZGllcygpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzdWJzY3JpYmUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IHsKICAgICAgICAgICAgaWQsCiAgICAgICAgICAgIHRhcmdldCwKICAgICAgICAgICAgdHlwZQogICAgICAgICAgfSA9IGRhdGEucHJvcHM7CiAgICAgICAgICBzdGF0ZS5zdWJzY3JpcHRpb25zW2lkXSA9IFtkYXRhLnV1aWQsIHR5cGUsIHRhcmdldF07CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3Vuc3Vic2NyaWJlJzoKICAgICAgICB7CiAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1tkYXRhLnByb3BzXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0UG9zaXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnBvc2l0aW9uLnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0UXVhdGVybmlvbic6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ucXVhdGVybmlvbi5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSwgZGF0YS5wcm9wc1szXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFJvdGF0aW9uJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5xdWF0ZXJuaW9uLnNldEZyb21FdWxlcihkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VmVsb2NpdHknOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnZlbG9jaXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhclZlbG9jaXR5JzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hbmd1bGFyVmVsb2NpdHkuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmxpbmVhckZhY3Rvci5zZXQoZGF0YS5wcm9wc1swXSwgZGF0YS5wcm9wc1sxXSwgZGF0YS5wcm9wc1syXSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEFuZ3VsYXJGYWN0b3InOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJGYWN0b3Iuc2V0KGRhdGEucHJvcHNbMF0sIGRhdGEucHJvcHNbMV0sIGRhdGEucHJvcHNbMl0pOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXNzJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5tYXNzID0gZGF0YS5wcm9wczsKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS51cGRhdGVNYXNzUHJvcGVydGllcygpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRNYXRlcmlhbCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ubWF0ZXJpYWwgPSBkYXRhLnByb3BzID8gY3JlYXRlTWF0ZXJpYWwoZGF0YS5wcm9wcykgOiBudWxsOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRMaW5lYXJEYW1waW5nJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5saW5lYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QW5ndWxhckRhbXBpbmcnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFuZ3VsYXJEYW1waW5nID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QWxsb3dTbGVlcCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uYWxsb3dTbGVlcCA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldFNsZWVwU3BlZWRMaW1pdCc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uc2xlZXBTcGVlZExpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0U2xlZXBUaW1lTGltaXQnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLnNsZWVwVGltZUxpbWl0ID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyR3JvdXAnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmNvbGxpc2lvbkZpbHRlckdyb3VwID0gZGF0YS5wcm9wczsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29sbGlzaW9uRmlsdGVyTWFzayc6CiAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0uY29sbGlzaW9uRmlsdGVyTWFzayA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbGxpc2lvblJlc3BvbnNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5jb2xsaXNpb25SZXNwb25zZSA9IGRhdGEucHJvcHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldEZpeGVkUm90YXRpb24nOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmZpeGVkUm90YXRpb24gPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRGcmljdGlvbkdyYXZpdHknOgogICAgICAgIHN0YXRlLndvcmxkLmZyaWN0aW9uR3Jhdml0eSA9IGRhdGEucHJvcHMgPyBuZXcgVmVjMyguLi5kYXRhLnByb3BzKSA6IHVuZGVmaW5lZDsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXNUcmlnZ2VyJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5pc1RyaWdnZXIgPSBkYXRhLnByb3BzOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRHcmF2aXR5JzoKICAgICAgICBzdGF0ZS53b3JsZC5ncmF2aXR5LnNldChkYXRhLnByb3BzWzBdLCBkYXRhLnByb3BzWzFdLCBkYXRhLnByb3BzWzJdKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0VG9sZXJhbmNlJzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuc29sdmVyIGluc3RhbmNlb2YgR1NTb2x2ZXIpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnNvbHZlci50b2xlcmFuY2UgPSBkYXRhLnByb3BzOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0SXRlcmF0aW9ucyc6CiAgICAgICAgaWYgKHN0YXRlLndvcmxkLnNvbHZlciBpbnN0YW5jZW9mIEdTU29sdmVyKSB7CiAgICAgICAgICBzdGF0ZS53b3JsZC5zb2x2ZXIuaXRlcmF0aW9ucyA9IGRhdGEucHJvcHM7CiAgICAgICAgfQogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdzZXRCcm9hZHBoYXNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5icm9hZHBoYXNlID0gbmV3IChicm9hZHBoYXNlc1tgJHtkYXRhLnByb3BzfUJyb2FkcGhhc2VgXSB8fCBOYWl2ZUJyb2FkcGhhc2UpKHN0YXRlLndvcmxkKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0QXhpc0luZGV4JzoKICAgICAgICBpZiAoc3RhdGUud29ybGQuYnJvYWRwaGFzZSBpbnN0YW5jZW9mIFNBUEJyb2FkcGhhc2UpIHsKICAgICAgICAgIHN0YXRlLndvcmxkLmJyb2FkcGhhc2UuYXhpc0luZGV4ID0gZGF0YS5wcm9wcyA9PT0gdW5kZWZpbmVkIHx8IGRhdGEucHJvcHMgPT09IG51bGwgPyAwIDogZGF0YS5wcm9wczsKICAgICAgICB9CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5Rm9yY2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5Rm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlJbXB1bHNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUltcHVsc2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEZvcmNlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseUxvY2FsRm9yY2UobmV3IFZlYzMoLi4uZGF0YS5wcm9wc1swXSksIG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMV0pKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnYXBwbHlMb2NhbEltcHVsc2UnOgogICAgICAgIHN0YXRlLmJvZGllc1tkYXRhLnV1aWRdLmFwcGx5TG9jYWxJbXB1bHNlKG5ldyBWZWMzKC4uLmRhdGEucHJvcHNbMF0pLCBuZXcgVmVjMyguLi5kYXRhLnByb3BzWzFdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FwcGx5VG9ycXVlJzoKICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5hcHBseVRvcnF1ZShuZXcgVmVjMyguLi5kYXRhLnByb3BzWzBdKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ2FkZENvbnN0cmFpbnQnOgogICAgICAgIHsKICAgICAgICAgIGFkZENvbnN0cmFpbnQoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVDb25zdHJhaW50JzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoX3JlZjIgPT4gewogICAgICAgICAgbGV0IHsKICAgICAgICAgICAgdXVpZAogICAgICAgICAgfSA9IF9yZWYyOwogICAgICAgICAgcmV0dXJuIHV1aWQgPT09IGRhdGEudXVpZDsKICAgICAgICB9KS5tYXAoYyA9PiBzdGF0ZS53b3JsZC5yZW1vdmVDb25zdHJhaW50KGMpKTsKICAgICAgICBpZiAoc3RhdGUuY29uc3RyYWludHNbZGF0YS51dWlkXSkgewogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGRlbGV0ZSBzdGF0ZS5jb25zdHJhaW50c1tkYXRhLnV1aWRdOwogICAgICAgIH0KICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZW5hYmxlKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludCc6CiAgICAgICAgc3RhdGUud29ybGQuY29uc3RyYWludHMuZmlsdGVyKGMgPT4gYy51dWlkID09PSBkYXRhLnV1aWQpLm1hcChjID0+IGMuZGlzYWJsZSgpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnZW5hYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmVuYWJsZU1vdG9yKCkpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdkaXNhYmxlQ29uc3RyYWludE1vdG9yJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLmRpc2FibGVNb3RvcigpKTsKICAgICAgICBicmVhazsKICAgICAgY2FzZSAnc2V0Q29uc3RyYWludE1vdG9yU3BlZWQnOgogICAgICAgIHN0YXRlLndvcmxkLmNvbnN0cmFpbnRzLmZpbHRlcihjID0+IGMudXVpZCA9PT0gZGF0YS51dWlkKS5maWx0ZXIoaXNIaW5nZUNvbnN0cmFpbnQpLm1hcChjID0+IGMuc2V0TW90b3JTcGVlZChkYXRhLnByb3BzKSk7CiAgICAgICAgYnJlYWs7CiAgICAgIGNhc2UgJ3NldENvbnN0cmFpbnRNb3Rvck1heEZvcmNlJzoKICAgICAgICBzdGF0ZS53b3JsZC5jb25zdHJhaW50cy5maWx0ZXIoYyA9PiBjLnV1aWQgPT09IGRhdGEudXVpZCkuZmlsdGVyKGlzSGluZ2VDb25zdHJhaW50KS5tYXAoYyA9PiBjLnNldE1vdG9yTWF4Rm9yY2UoZGF0YS5wcm9wcykpOwogICAgICAgIGJyZWFrOwogICAgICBjYXNlICdhZGRTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIGFkZFNwcmluZyhzdGF0ZSwgZGF0YSk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ1N0aWZmbmVzcyc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0uc3RpZmZuZXNzID0gZGF0YS5wcm9wczsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnc2V0U3ByaW5nUmVzdExlbmd0aCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuc3ByaW5nSW5zdGFuY2VzW2RhdGEudXVpZF0ucmVzdExlbmd0aCA9IGRhdGEucHJvcHM7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NldFNwcmluZ0RhbXBpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLnNwcmluZ0luc3RhbmNlc1tkYXRhLnV1aWRdLmRhbXBpbmcgPSBkYXRhLnByb3BzOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVTcHJpbmcnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Bvc3RTdGVwJywgc3RhdGUuc3ByaW5nc1tkYXRhLnV1aWRdKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5JzoKICAgICAgICB7CiAgICAgICAgICBhZGRSYXkoc3RhdGUsIGRhdGEpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdyZW1vdmVSYXknOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS5yYXlzW2RhdGEudXVpZF0pOwogICAgICAgICAgZGVsZXRlIHN0YXRlLnJheXNbZGF0YS51dWlkXTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAnYWRkUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIGFkZFJheWNhc3RWZWhpY2xlKHN0YXRlLCBkYXRhKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlUmF5Y2FzdFZlaGljbGUnOgogICAgICAgIHsKICAgICAgICAgIHN0YXRlLndvcmxkLnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3ByZVN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnByZVN0ZXApOwogICAgICAgICAgc3RhdGUud29ybGQucmVtb3ZlRXZlbnRMaXN0ZW5lcigncG9zdFN0ZXAnLCBzdGF0ZS52ZWhpY2xlc1tkYXRhLnV1aWRdLnBvc3RTdGVwKTsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS53b3JsZCA9IG51bGw7CiAgICAgICAgICBkZWxldGUgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXTsKICAgICAgICAgIGNvbnN0IGtleSA9IE9iamVjdC5rZXlzKHN0YXRlLnN1YnNjcmlwdGlvbnMpLmZpbmQoayA9PiBzdGF0ZS5zdWJzY3JpcHRpb25zW2tdWzBdID09PSBkYXRhLnV1aWQpOwogICAgICAgICAgaWYgKGtleSkgewogICAgICAgICAgICBkZWxldGUgc3RhdGUuc3Vic2NyaXB0aW9uc1trZXldOwogICAgICAgICAgfQogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZVN0ZWVyaW5nVmFsdWUnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLnNldFN0ZWVyaW5nVmFsdWUodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdhcHBseVJheWNhc3RWZWhpY2xlRW5naW5lRm9yY2UnOgogICAgICAgIHsKICAgICAgICAgIGNvbnN0IFt2YWx1ZSwgd2hlZWxJbmRleF0gPSBkYXRhLnByb3BzOwogICAgICAgICAgc3RhdGUudmVoaWNsZXNbZGF0YS51dWlkXS52ZWhpY2xlLmFwcGx5RW5naW5lRm9yY2UodmFsdWUsIHdoZWVsSW5kZXgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgICBjYXNlICdzZXRSYXljYXN0VmVoaWNsZUJyYWtlJzoKICAgICAgICB7CiAgICAgICAgICBjb25zdCBbYnJha2UsIHdoZWVsSW5kZXhdID0gZGF0YS5wcm9wczsKICAgICAgICAgIHN0YXRlLnZlaGljbGVzW2RhdGEudXVpZF0udmVoaWNsZS5zZXRCcmFrZShicmFrZSwgd2hlZWxJbmRleCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ2FkZENvbnRhY3RNYXRlcmlhbCc6CiAgICAgICAgewogICAgICAgICAgYWRkQ29udGFjdE1hdGVyaWFsKHN0YXRlLndvcmxkLCBjcmVhdGVNYXRlcmlhbCwgZGF0YS5wcm9wcywgZGF0YS51dWlkKTsKICAgICAgICAgIGJyZWFrOwogICAgICAgIH0KICAgICAgY2FzZSAncmVtb3ZlQ29udGFjdE1hdGVyaWFsJzoKICAgICAgICB7CiAgICAgICAgICByZW1vdmVDb250YWN0TWF0ZXJpYWwoc3RhdGUud29ybGQsIGRhdGEudXVpZCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3dha2VVcCc6CiAgICAgICAgewogICAgICAgICAgc3RhdGUuYm9kaWVzW2RhdGEudXVpZF0ud2FrZVVwKCk7CiAgICAgICAgICBicmVhazsKICAgICAgICB9CiAgICAgIGNhc2UgJ3NsZWVwJzoKICAgICAgICB7CiAgICAgICAgICBzdGF0ZS5ib2RpZXNbZGF0YS51dWlkXS5zbGVlcCgpOwogICAgICAgICAgYnJlYWs7CiAgICAgICAgfQogICAgfQogIH07Cgp9KSgpOwoK");class gj extends sj{get axisIndex(){return this.config.axisIndex}set axisIndex(e){this.config.axisIndex=e,this.postMessage({op:"setAxisIndex",props:e})}get broadphase(){return this.config.broadphase}set broadphase(e){this.config.broadphase=e,this.postMessage({op:"setBroadphase",props:e})}get frictionGravity(){return this.config.frictionGravity}set frictionGravity(e){this.config.frictionGravity=e,this.postMessage({op:"setFrictionGravity",props:e})}get gravity(){return this.config.gravity}set gravity(e){this.config.gravity=e,this.postMessage({op:"setGravity",props:e})}get iterations(){return this.config.iterations}set iterations(e){this.config.iterations=e,this.postMessage({op:"setIterations",props:e})}get tolerance(){return this.config.tolerance}set tolerance(e){this.config.tolerance=e,this.postMessage({op:"setTolerance",props:e})}messageQueue=[];worker=null;constructor(e){let{allowSleep:t=!1,axisIndex:n=0,broadphase:i="Naive",defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:l=[0,-9.81,0],iterations:c=5,quatNormalizeFast:u=!1,quatNormalizeSkip:h=0,size:A=1e3,solver:f="GS",tolerance:p=.001}=e;super(),this.config={allowSleep:t,axisIndex:n,broadphase:i,defaultContactMaterial:s,frictionGravity:o,gravity:l,iterations:c,quatNormalizeFast:u,quatNormalizeSkip:h,size:A,solver:f,tolerance:p},this.buffers={positions:new Float32Array(A*3),quaternions:new Float32Array(A*4)}}addBodies(e){let{props:t,type:n,uuid:i}=e;this.postMessage({op:"addBodies",props:t,type:n,uuid:i})}addConstraint(e){let{props:[t,n,i],type:s,uuid:o}=e;this.postMessage({op:"addConstraint",props:[t,n,i],type:s,uuid:o})}addContactMaterial(e){let{props:t,uuid:n}=e;this.postMessage({op:"addContactMaterial",props:t,uuid:n})}addRay(e){let{props:t,uuid:n}=e;this.postMessage({op:"addRay",props:t,uuid:n})}addRaycastVehicle(e){let{props:[t,n,i,s,o,l],uuid:c}=e;this.postMessage({op:"addRaycastVehicle",props:[t,n,i,s,o,l],uuid:c})}addSpring(e){let{props:[t,n,i],uuid:s}=e;this.postMessage({op:"addSpring",props:[t,n,i],uuid:s})}applyForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyForce",props:t,uuid:n})}applyImpulse(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyImpulse",props:t,uuid:n})}applyLocalForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyLocalForce",props:t,uuid:n})}applyLocalImpulse(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyLocalImpulse",props:t,uuid:n})}applyRaycastVehicleEngineForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyRaycastVehicleEngineForce",props:t,uuid:n})}applyTorque(e){let{props:t,uuid:n}=e;this.postMessage({op:"applyTorque",props:t,uuid:n})}connect(){this.worker=new cj,this.worker.onmessage=e=>{if(e.data.op==="frame"){this.buffers.positions=e.data.positions,this.buffers.quaternions=e.data.quaternions,this.emit(e.data.op,e.data);return}this.emit(e.data.type,e.data)};for(const e of this.messageQueue)this.worker.postMessage(e);this.messageQueue.length=0}disableConstraint(e){let{uuid:t}=e;this.postMessage({op:"disableConstraint",uuid:t})}disableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"disableConstraintMotor",uuid:t})}disconnect(){this.worker&&(this.worker.onmessage=null)}enableConstraint(e){let{uuid:t}=e;this.postMessage({op:"enableConstraint",uuid:t})}enableConstraintMotor(e){let{uuid:t}=e;this.postMessage({op:"enableConstraintMotor",uuid:t})}init(){const{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:i,frictionGravity:s,gravity:o,iterations:l,quatNormalizeFast:c,quatNormalizeSkip:u,solver:h,tolerance:A}=this.config;this.postMessage({op:"init",props:{allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:i,frictionGravity:s,gravity:o,iterations:l,quatNormalizeFast:c,quatNormalizeSkip:u,solver:h,tolerance:A}})}removeBodies(e){let{uuid:t}=e;this.postMessage({op:"removeBodies",uuid:t})}removeConstraint(e){let{uuid:t}=e;this.postMessage({op:"removeConstraint",uuid:t})}removeContactMaterial(e){let{uuid:t}=e;this.postMessage({op:"removeContactMaterial",uuid:t})}removeRay(e){let{uuid:t}=e;this.postMessage({op:"removeRay",uuid:t})}removeRaycastVehicle(e){let{uuid:t}=e;this.postMessage({op:"removeRaycastVehicle",uuid:t})}removeSpring(e){let{uuid:t}=e;this.postMessage({op:"removeSpring",uuid:t})}setAllowSleep(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAllowSleep",props:t,uuid:n})}setAngularDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularDamping",props:t,uuid:n})}setAngularFactor(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularFactor",props:t,uuid:n})}setAngularVelocity(e){let{props:t,uuid:n}=e;this.postMessage({op:"setAngularVelocity",props:t,uuid:n})}setCollisionFilterGroup(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionFilterGroup",props:t,uuid:n})}setCollisionFilterMask(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionFilterMask",props:t,uuid:n})}setCollisionResponse(e){let{props:t,uuid:n}=e;this.postMessage({op:"setCollisionResponse",props:t,uuid:n})}setConstraintMotorMaxForce(e){let{props:t,uuid:n}=e;this.postMessage({op:"setConstraintMotorMaxForce",props:t,uuid:n})}setConstraintMotorSpeed(e){let{props:t,uuid:n}=e;this.postMessage({op:"setConstraintMotorSpeed",props:t,uuid:n})}setFixedRotation(e){let{props:t,uuid:n}=e;this.postMessage({op:"setFixedRotation",props:t,uuid:n})}setIsTrigger(e){let{props:t,uuid:n}=e;this.postMessage({op:"setIsTrigger",props:t,uuid:n})}setLinearDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setLinearDamping",props:t,uuid:n})}setLinearFactor(e){let{props:t,uuid:n}=e;this.postMessage({op:"setLinearFactor",props:t,uuid:n})}setMass(e){let{props:t,uuid:n}=e;this.postMessage({op:"setMass",props:t,uuid:n})}setMaterial(e){let{props:t,uuid:n}=e;this.postMessage({op:"setMaterial",props:t,uuid:n})}setPosition(e){let{props:t,uuid:n}=e;this.postMessage({op:"setPosition",props:t,uuid:n})}setQuaternion(e){let{props:[t,n,i,s],uuid:o}=e;this.postMessage({op:"setQuaternion",props:[t,n,i,s],uuid:o})}setRaycastVehicleBrake(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRaycastVehicleBrake",props:t,uuid:n})}setRaycastVehicleSteeringValue(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRaycastVehicleSteeringValue",props:t,uuid:n})}setRotation(e){let{props:t,uuid:n}=e;this.postMessage({op:"setRotation",props:t,uuid:n})}setSleepSpeedLimit(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSleepSpeedLimit",props:t,uuid:n})}setSleepTimeLimit(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSleepTimeLimit",props:t,uuid:n})}setSpringDamping(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringDamping",props:t,uuid:n})}setSpringRestLength(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringRestLength",props:t,uuid:n})}setSpringStiffness(e){let{props:t,uuid:n}=e;this.postMessage({op:"setSpringStiffness",props:t,uuid:n})}setUserData(e){let{props:t,uuid:n}=e;this.postMessage({op:"setUserData",props:t,uuid:n})}setVelocity(e){let{props:t,uuid:n}=e;this.postMessage({op:"setVelocity",props:t,uuid:n})}sleep(e){let{uuid:t}=e;this.postMessage({op:"sleep",uuid:t})}step(e){var t;const{buffers:{positions:n,quaternions:i}}=this;!n.byteLength&&!i.byteLength||(t=this.worker)==null||t.postMessage({op:"step",positions:n,props:e,quaternions:i},[n.buffer,i.buffer])}subscribe(e){let{props:{id:t,target:n,type:i},uuid:s}=e;this.postMessage({op:"subscribe",props:{id:t,target:n,type:i},uuid:s})}terminate(){var e;(e=this.worker)==null||e.terminate(),this.worker=null}unsubscribe(e){let{props:t}=e;this.postMessage({op:"unsubscribe",props:t})}wakeUp(e){let{uuid:t}=e;this.postMessage({op:"wakeUp",uuid:t})}postMessage(e){if(this.worker)return this.worker.postMessage(e);this.messageQueue.push(e)}}class Bg{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new fe);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new fe);const n=this.elements,i=e.x,s=e.y,o=e.z;return t.x=n[0]*i+n[1]*s+n[2]*o,t.y=n[3]*i+n[4]*s+n[5]*o,t.z=n[6]*i+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Bg);const n=this.elements,i=e.elements,s=t.elements,o=n[0],l=n[1],c=n[2],u=n[3],h=n[4],A=n[5],f=n[6],p=n[7],y=n[8],G=i[0],B=i[1],S=i[2],N=i[3],R=i[4],w=i[5],V=i[6],H=i[7],X=i[8];return s[0]=o*G+l*N+c*V,s[1]=o*B+l*R+c*H,s[2]=o*S+l*w+c*X,s[3]=u*G+h*N+A*V,s[4]=u*B+h*R+A*H,s[5]=u*S+h*w+A*X,s[6]=f*G+p*N+y*V,s[7]=f*B+p*R+y*H,s[8]=f*S+p*w+y*X,t}scale(e,t){t===void 0&&(t=new Bg);const n=this.elements,i=t.elements;for(let s=0;s!==3;s++)i[3*s+0]=e.x*n[3*s+0],i[3*s+1]=e.y*n[3*s+1],i[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new fe);const n=3,i=4,s=[];let o,l;for(o=0;o<n*i;o++)s.push(0);for(o=0;o<3;o++)for(l=0;l<3;l++)s[o+i*l]=this.elements[o+3*l];s[3]=e.x,s[7]=e.y,s[11]=e.z;let c=3;const u=c;let h;const A=4;let f;do{if(o=u-c,s[o+i*o]===0){for(l=o+1;l<u;l++)if(s[o+i*l]!==0){h=A;do f=A-h,s[f+i*o]+=s[f+i*l];while(--h);break}}if(s[o+i*o]!==0)for(l=o+1;l<u;l++){const p=s[o+i*l]/s[o+i*o];h=A;do f=A-h,s[f+i*l]=f<=o?0:s[f+i*l]-s[f+i*o]*p;while(--h)}}while(--c);if(t.z=s[2*i+3]/s[2*i+2],t.y=(s[1*i+3]-s[1*i+2]*t.z)/s[1*i+1],t.x=(s[0*i+3]-s[0*i+2]*t.z-s[0*i+1]*t.y)/s[0*i+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let n=0;n<9;n++)e+=this.elements[n]+",";return e}reverse(e){e===void 0&&(e=new Bg);const t=3,n=6,i=uj;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+n*o]=this.elements[s+3*o];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;let l=3;const c=l;let u;const h=n;let A;do{if(s=c-l,i[s+n*s]===0){for(o=s+1;o<c;o++)if(i[s+n*o]!==0){u=h;do A=h-u,i[A+n*s]+=i[A+n*o];while(--u);break}}if(i[s+n*s]!==0)for(o=s+1;o<c;o++){const f=i[s+n*o]/i[s+n*s];u=h;do A=h-u,i[A+n*o]=A<=s?0:i[A+n*o]-i[A+n*s]*f;while(--u)}}while(--l);s=2;do{o=s-1;do{const f=i[s+n*o]/i[s+n*s];u=n;do A=n-u,i[A+n*o]=i[A+n*o]-i[A+n*s]*f;while(--u)}while(o--)}while(--s);s=2;do{const f=1/i[s+n*s];u=n;do A=n-u,i[A+n*s]=i[A+n*s]*f;while(--u)}while(s--);s=2;do{o=2;do{if(A=i[t+o+n*s],isNaN(A)||A===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,A)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,s=e.w,o=t+t,l=n+n,c=i+i,u=t*o,h=t*l,A=t*c,f=n*l,p=n*c,y=i*c,G=s*o,B=s*l,S=s*c,N=this.elements;return N[0]=1-(f+y),N[1]=h-S,N[2]=A+B,N[3]=h+S,N[4]=1-(u+y),N[5]=p-G,N[6]=A-B,N[7]=p+G,N[8]=1-(u+f),this}transpose(e){e===void 0&&(e=new Bg);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const uj=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class fe{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new fe);const n=e.x,i=e.y,s=e.z,o=this.x,l=this.y,c=this.z;return t.x=l*s-c*i,t.y=c*n-o*s,t.z=o*i-l*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new fe(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new fe(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Bg([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const s=1/i;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new fe);const t=this.x,n=this.y,i=this.z;let s=Math.sqrt(t*t+n*n+i*i);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=i*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(l-i)*(l-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(l-i)*(l-i)}scale(e,t){t===void 0&&(t=new fe);const n=this.x,i=this.y,s=this.z;return t.x=e*n,t.y=e*i,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new fe),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new fe),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new fe),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=dj,s=1/n;i.set(this.x*s,this.y*s,this.z*s);const o=Ij;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,s=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(S1),S1.almostEquals(e,t)}clone(){return new fe(this.x,this.y,this.z)}}fe.ZERO=new fe(0,0,0);fe.UNIT_X=new fe(1,0,0);fe.UNIT_Y=new fe(0,1,0);fe.UNIT_Z=new fe(0,0,1);const dj=new fe,Ij=new fe,S1=new fe;class Or{constructor(e){e===void 0&&(e={}),this.lowerBound=new fe,this.upperBound=new fe,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const s=this.lowerBound,o=this.upperBound,l=n;s.copy(e[0]),l&&l.vmult(s,s),o.copy(s);for(let c=1;c<e.length;c++){let u=e[c];l&&(l.vmult(u,x1),u=x1),u.x>o.x&&(o.x=u.x),u.x<s.x&&(s.x=u.x),u.y>o.y&&(o.y=u.y),u.y<s.y&&(s.y=u.y),u.z>o.z&&(o.z=u.z),u.z<s.z&&(s.z=u.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),i&&(s.x-=i,s.y-=i,s.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new Or().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound,o=i.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,l=i.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,c=i.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&l&&c}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound;return t.x<=i.x&&n.x>=s.x&&t.y<=i.y&&n.y>=s.y&&t.z<=i.z&&n.z>=s.z}getCorners(e,t,n,i,s,o,l,c){const u=this.lowerBound,h=this.upperBound;e.copy(u),t.set(h.x,u.y,u.z),n.set(h.x,h.y,u.z),i.set(u.x,h.y,h.z),s.set(h.x,u.y,h.z),o.set(u.x,h.y,u.z),l.set(u.x,u.y,h.z),c.copy(h)}toLocalFrame(e,t){const n=Z1,i=n[0],s=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],A=n[7];this.getCorners(i,s,o,l,c,u,h,A);for(let f=0;f!==8;f++){const p=n[f];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=Z1,i=n[0],s=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],A=n[7];this.getCorners(i,s,o,l,c,u,h,A);for(let f=0;f!==8;f++){const p=n[f];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,s=1/t.y,o=1/t.z,l=(this.lowerBound.x-n.x)*i,c=(this.upperBound.x-n.x)*i,u=(this.lowerBound.y-n.y)*s,h=(this.upperBound.y-n.y)*s,A=(this.lowerBound.z-n.z)*o,f=(this.upperBound.z-n.z)*o,p=Math.max(Math.max(Math.min(l,c),Math.min(u,h)),Math.min(A,f)),y=Math.min(Math.min(Math.max(l,c),Math.max(u,h)),Math.max(A,f));return!(y<0||p>y)}}const x1=new fe,Z1=[new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe];class fo{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new fe),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=hj,i=Cj;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new fo);const n=this.x,i=this.y,s=this.z,o=this.w,l=e.x,c=e.y,u=e.z,h=e.w;return t.x=n*h+o*l+i*u-s*c,t.y=i*h+o*c+s*l-n*u,t.z=s*h+o*u+n*c-i*l,t.w=o*h-n*l-i*c-s*u,t}inverse(e){e===void 0&&(e=new fo);const t=this.x,n=this.y,i=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new fo),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new fe);const n=e.x,i=e.y,s=e.z,o=this.x,l=this.y,c=this.z,u=this.w,h=u*n+l*s-c*i,A=u*i+c*n-o*s,f=u*s+o*i-l*n,p=-o*n-l*i-c*s;return t.x=h*u+p*-o+A*-c-f*-l,t.y=A*u+p*-l+f*-o-h*-c,t.z=f*u+p*-c+h*-l-A*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,i,s;const o=this.x,l=this.y,c=this.z,u=this.w;switch(t){case"YZX":const h=o*l+c*u;if(h>.499&&(n=2*Math.atan2(o,u),i=Math.PI/2,s=0),h<-.499&&(n=-2*Math.atan2(o,u),i=-Math.PI/2,s=0),n===void 0){const A=o*o,f=l*l,p=c*c;n=Math.atan2(2*l*u-2*o*c,1-2*f-2*p),i=Math.asin(2*h),s=Math.atan2(2*o*u-2*l*c,1-2*A-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=i,e.x=s}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),l=Math.cos(n/2),c=Math.sin(e/2),u=Math.sin(t/2),h=Math.sin(n/2);return i==="XYZ"?(this.x=c*o*l+s*u*h,this.y=s*u*l-c*o*h,this.z=s*o*h+c*u*l,this.w=s*o*l-c*u*h):i==="YXZ"?(this.x=c*o*l+s*u*h,this.y=s*u*l-c*o*h,this.z=s*o*h-c*u*l,this.w=s*o*l+c*u*h):i==="ZXY"?(this.x=c*o*l-s*u*h,this.y=s*u*l+c*o*h,this.z=s*o*h+c*u*l,this.w=s*o*l-c*u*h):i==="ZYX"?(this.x=c*o*l-s*u*h,this.y=s*u*l+c*o*h,this.z=s*o*h-c*u*l,this.w=s*o*l+c*u*h):i==="YZX"?(this.x=c*o*l+s*u*h,this.y=s*u*l+c*o*h,this.z=s*o*h-c*u*l,this.w=s*o*l-c*u*h):i==="XZY"&&(this.x=c*o*l-s*u*h,this.y=s*u*l-c*o*h,this.z=s*o*h+c*u*l,this.w=s*o*l+c*u*h),this}clone(){return new fo(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new fo);const i=this.x,s=this.y,o=this.z,l=this.w;let c=e.x,u=e.y,h=e.z,A=e.w,f,p,y,G,B;return p=i*c+s*u+o*h+l*A,p<0&&(p=-p,c=-c,u=-u,h=-h,A=-A),1-p>1e-6?(f=Math.acos(p),y=Math.sin(f),G=Math.sin((1-t)*f)/y,B=Math.sin(t*f)/y):(G=1-t,B=t),n.x=G*i+B*c,n.y=G*s+B*u,n.z=G*o+B*h,n.w=G*l+B*A,n}integrate(e,t,n,i){i===void 0&&(i=new fo);const s=e.x*n.x,o=e.y*n.y,l=e.z*n.z,c=this.x,u=this.y,h=this.z,A=this.w,f=t*.5;return i.x+=f*(s*A+o*h-l*u),i.y+=f*(o*A+l*c-s*h),i.z+=f*(l*A+s*u-o*c),i.w+=f*(-s*c-o*u-l*h),i}}const hj=new fe,Cj=new fe,Aj={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class dn{constructor(e){e===void 0&&(e={}),this.id=dn.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}dn.idCounter=0;dn.types=Aj;class To{constructor(e){e===void 0&&(e={}),this.position=new fe,this.quaternion=new fo,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return To.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return To.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new fe),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new fe),n.vsub(e,i),t.conjugate(w1),w1.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new fe),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new fe),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new fe),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const w1=new fo;new fe;new fe;new fe;new fe;new fe,new fe,new fe,new fe,new fe,new fe,new fe,new fe;new fe;new fo;new Or;new Bg;new Bg;new Bg;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fo;new fe;new fe;new fe;new fe;class z2{constructor(){this.rayFromWorld=new fe,this.rayToWorld=new fe,this.hitNormalWorld=new fe,this.hitPointWorld=new fe,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,s,o,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=s,this.body=o,this.distance=l}}let z3,L3,k3,U3,D3,O3,j3;const cx={CLOSEST:1,ANY:2,ALL:4};z3=dn.types.SPHERE;L3=dn.types.PLANE;k3=dn.types.BOX;U3=dn.types.CYLINDER;D3=dn.types.CONVEXPOLYHEDRON;O3=dn.types.HEIGHTFIELD;j3=dn.types.TRIMESH;class Ls{get[z3](){return this._intersectSphere}get[L3](){return this._intersectPlane}get[k3](){return this._intersectBox}get[U3](){return this._intersectConvex}get[D3](){return this._intersectConvex}get[O3](){return this._intersectHeightfield}get[j3](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new fe),t===void 0&&(t=new fe),this.from=e.clone(),this.to=t.clone(),this.direction=new fe,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=Ls.ANY,this.result=new z2,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||Ls.ANY,this.result=t.result||new z2,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(R1),HB.length=0,e.broadphase.aabbQuery(e,R1,HB),this.intersectBodies(HB),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=fj,s=mj;for(let o=0,l=e.shapes.length;o<l;o++){const c=e.shapes[o];if(!(n&&!c.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(c,s,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const s=this.from;if(Vj(s,this.direction,n)>e.boundingSphereRadius)return;const l=this[e.type];l&&l.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,s)}_intersectPlane(e,t,n,i,s){const o=this.from,l=this.to,c=this.direction,u=new fe(0,0,1);t.vmult(u,u);const h=new fe;o.vsub(n,h);const A=h.dot(u);l.vsub(n,h);const f=h.dot(u);if(A*f>0||o.distanceTo(l)<A)return;const p=u.dot(c);if(Math.abs(p)<this.precision)return;const y=new fe,G=new fe,B=new fe;o.vsub(n,y);const S=-u.dot(y)/p;c.scale(S,G),o.vadd(G,B),this.reportIntersection(u,B,s,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),n.x=Math.max(i.x,s.x),n.y=Math.max(i.y,s.y),n.z=Math.max(i.z,s.z)}_intersectHeightfield(e,t,n,i,s){e.data,e.elementSize;const o=pj;o.from.copy(this.from),o.to.copy(this.to),To.pointToLocalFrame(n,t,o.from,o.from),To.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const l=bj;let c,u,h,A;c=u=0,h=A=e.data.length-1;const f=new Or;o.getAABB(f),e.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,l,!0),c=Math.max(c,l[0]),u=Math.max(u,l[1]),e.getIndexOfPosition(f.upperBound.x,f.upperBound.y,l,!0),h=Math.min(h,l[0]+1),A=Math.min(A,l[1]+1);for(let p=c;p<h;p++)for(let y=u;y<A;y++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,y,f),!!f.overlapsRay(o)){if(e.getConvexTrianglePillar(p,y,!1),To.pointToWorldFrame(n,t,e.pillarOffset,e0),this._intersectConvex(e.pillarConvex,t,e0,i,s,N1),this.result.shouldStop)return;e.getConvexTrianglePillar(p,y,!0),To.pointToWorldFrame(n,t,e.pillarOffset,e0),this._intersectConvex(e.pillarConvex,t,e0,i,s,N1)}}}_intersectSphere(e,t,n,i,s){const o=this.from,l=this.to,c=e.radius,u=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,h=2*((l.x-o.x)*(o.x-n.x)+(l.y-o.y)*(o.y-n.y)+(l.z-o.z)*(o.z-n.z)),A=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-c**2,f=h**2-4*u*A,p=yj,y=vj;if(!(f<0))if(f===0)o.lerp(l,f,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1);else{const G=(-h-Math.sqrt(f))/(2*u),B=(-h+Math.sqrt(f))/(2*u);if(G>=0&&G<=1&&(o.lerp(l,G,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1)),this.result.shouldStop)return;B>=0&&B<=1&&(o.lerp(l,B,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1))}}_intersectConvex(e,t,n,i,s,o){const l=Gj,c=W1,u=o&&o.faceList||null,h=e.faces,A=e.vertices,f=e.faceNormals,p=this.direction,y=this.from,G=this.to,B=y.distanceTo(G),S=u?u.length:h.length,N=this.result;for(let R=0;!N.shouldStop&&R<S;R++){const w=u?u[R]:R,V=h[w],H=f[w],X=t,Y=n;c.copy(A[V[0]]),X.vmult(c,c),c.vadd(Y,c),c.vsub(y,c),X.vmult(H,l);const M=p.dot(l);if(Math.abs(M)<this.precision)continue;const E=l.dot(c)/M;if(!(E<0)){p.scale(E,Eo),Eo.vadd(y,Eo),Gl.copy(A[V[0]]),X.vmult(Gl,Gl),Y.vadd(Gl,Gl);for(let O=1;!N.shouldStop&&O<V.length-1;O++){hc.copy(A[V[O]]),Cc.copy(A[V[O+1]]),X.vmult(hc,hc),X.vmult(Cc,Cc),Y.vadd(hc,hc),Y.vadd(Cc,Cc);const P=Eo.distanceTo(y);!(Ls.pointInTriangle(Eo,Gl,hc,Cc)||Ls.pointInTriangle(Eo,hc,Gl,Cc))||P>B||this.reportIntersection(l,Eo,s,i,w)}}}}_intersectTrimesh(e,t,n,i,s,o){const l=Bj,c=Nj,u=Wj,h=W1,A=Sj,f=xj,p=Zj,y=Rj,G=wj,B=e.indices;e.vertices;const S=this.from,N=this.to,R=this.direction;u.position.copy(n),u.quaternion.copy(t),To.vectorToLocalFrame(n,t,R,A),To.pointToLocalFrame(n,t,S,f),To.pointToLocalFrame(n,t,N,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,p.vsub(f,A),A.normalize();const w=f.distanceSquared(p);e.tree.rayQuery(this,u,c);for(let V=0,H=c.length;!this.result.shouldStop&&V!==H;V++){const X=c[V];e.getNormal(X,l),e.getVertex(B[X*3],Gl),Gl.vsub(f,h);const Y=A.dot(l),M=l.dot(h)/Y;if(M<0)continue;A.scale(M,Eo),Eo.vadd(f,Eo),e.getVertex(B[X*3+1],hc),e.getVertex(B[X*3+2],Cc);const E=Eo.distanceSquared(f);!(Ls.pointInTriangle(Eo,hc,Gl,Cc)||Ls.pointInTriangle(Eo,Gl,hc,Cc))||E>w||(To.vectorToWorldFrame(t,l,G),To.pointToWorldFrame(n,t,Eo,y),this.reportIntersection(G,y,s,i,X))}c.length=0}reportIntersection(e,t,n,i,s){const o=this.from,l=this.to,c=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case Ls.ALL:this.hasHit=!0,u.set(o,l,e,t,n,i,c),u.hasHit=!0,this.callback(u);break;case Ls.CLOSEST:(c<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,c));break;case Ls.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,c),u.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,qd),n.vsub(t,mf),e.vsub(t,EB);const s=qd.dot(qd),o=qd.dot(mf),l=qd.dot(EB),c=mf.dot(mf),u=mf.dot(EB);let h,A;return(h=c*l-o*u)>=0&&(A=s*u-o*l)>=0&&h+A<s*c-o*o}}Ls.CLOSEST=cx.CLOSEST;Ls.ANY=cx.ANY;Ls.ALL=cx.ALL;const R1=new Or,HB=[],mf=new fe,EB=new fe,fj=new fe,mj=new fo,Eo=new fe,Gl=new fe,hc=new fe,Cc=new fe;new fe;new z2;const N1={faceList:[0]},e0=new fe,pj=new Ls,bj=[],yj=new fe,vj=new fe,Gj=new fe;new fe;new fe;const W1=new fe,Bj=new fe,Sj=new fe,xj=new fe,Zj=new fe,wj=new fe,Rj=new fe;new Or;const Nj=[],Wj=new To,qd=new fe,t0=new fe;function Vj(a,e,t){t.vsub(a,qd);const n=qd.dot(e);return e.scale(n,t0),t0.vadd(a,t0),t.distanceTo(t0)}new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new Ls;new fe;new fe;new fe;new fe(1,0,0),new fe(0,1,0),new fe(0,0,1);new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new Or;new fe;new Or;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new Or;new fe;new To;new Or;dn.types.SPHERE,dn.types.SPHERE|dn.types.PLANE,dn.types.BOX|dn.types.BOX,dn.types.SPHERE|dn.types.BOX,dn.types.PLANE|dn.types.BOX,dn.types.CONVEXPOLYHEDRON,dn.types.SPHERE|dn.types.CONVEXPOLYHEDRON,dn.types.PLANE|dn.types.CONVEXPOLYHEDRON,dn.types.BOX|dn.types.CONVEXPOLYHEDRON,dn.types.SPHERE|dn.types.HEIGHTFIELD,dn.types.BOX|dn.types.HEIGHTFIELD,dn.types.CONVEXPOLYHEDRON|dn.types.HEIGHTFIELD,dn.types.PARTICLE|dn.types.SPHERE,dn.types.PLANE|dn.types.PARTICLE,dn.types.BOX|dn.types.PARTICLE,dn.types.PARTICLE|dn.types.CONVEXPOLYHEDRON,dn.types.CYLINDER,dn.types.SPHERE|dn.types.CYLINDER,dn.types.PLANE|dn.types.CYLINDER,dn.types.BOX|dn.types.CYLINDER,dn.types.CONVEXPOLYHEDRON|dn.types.CYLINDER,dn.types.HEIGHTFIELD|dn.types.CYLINDER,dn.types.PARTICLE|dn.types.CYLINDER,dn.types.SPHERE|dn.types.TRIMESH,dn.types.PLANE|dn.types.TRIMESH;new fe;new fe;new fe;new fe;new fe;new fo;new fo;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new Or;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe,new fe,new fe,new fe,new fe,new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fo;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new fe;new Or;new Ls;const pf=globalThis.performance||{};if(!pf.now){let a=Date.now();pf.timing&&pf.timing.navigationStart&&(a=pf.timing.navigationStart),pf.now=()=>Date.now()-a}new fe;class Sg{constructor(e){e===void 0&&(e=[0,0,0,0,0,0,0,0,0]),this.elements=e}identity(){const e=this.elements;e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1}setZero(){const e=this.elements;e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=0,e[6]=0,e[7]=0,e[8]=0}setTrace(e){const t=this.elements;t[0]=e.x,t[4]=e.y,t[8]=e.z}getTrace(e){e===void 0&&(e=new me);const t=this.elements;return e.x=t[0],e.y=t[4],e.z=t[8],e}vmult(e,t){t===void 0&&(t=new me);const n=this.elements,i=e.x,s=e.y,o=e.z;return t.x=n[0]*i+n[1]*s+n[2]*o,t.y=n[3]*i+n[4]*s+n[5]*o,t.z=n[6]*i+n[7]*s+n[8]*o,t}smult(e){for(let t=0;t<this.elements.length;t++)this.elements[t]*=e}mmult(e,t){t===void 0&&(t=new Sg);const n=this.elements,i=e.elements,s=t.elements,o=n[0],l=n[1],c=n[2],u=n[3],h=n[4],A=n[5],f=n[6],p=n[7],y=n[8],G=i[0],B=i[1],S=i[2],N=i[3],R=i[4],w=i[5],V=i[6],H=i[7],X=i[8];return s[0]=o*G+l*N+c*V,s[1]=o*B+l*R+c*H,s[2]=o*S+l*w+c*X,s[3]=u*G+h*N+A*V,s[4]=u*B+h*R+A*H,s[5]=u*S+h*w+A*X,s[6]=f*G+p*N+y*V,s[7]=f*B+p*R+y*H,s[8]=f*S+p*w+y*X,t}scale(e,t){t===void 0&&(t=new Sg);const n=this.elements,i=t.elements;for(let s=0;s!==3;s++)i[3*s+0]=e.x*n[3*s+0],i[3*s+1]=e.y*n[3*s+1],i[3*s+2]=e.z*n[3*s+2];return t}solve(e,t){t===void 0&&(t=new me);const n=3,i=4,s=[];let o,l;for(o=0;o<n*i;o++)s.push(0);for(o=0;o<3;o++)for(l=0;l<3;l++)s[o+i*l]=this.elements[o+3*l];s[3]=e.x,s[7]=e.y,s[11]=e.z;let c=3;const u=c;let h;const A=4;let f;do{if(o=u-c,s[o+i*o]===0){for(l=o+1;l<u;l++)if(s[o+i*l]!==0){h=A;do f=A-h,s[f+i*o]+=s[f+i*l];while(--h);break}}if(s[o+i*o]!==0)for(l=o+1;l<u;l++){const p=s[o+i*l]/s[o+i*o];h=A;do f=A-h,s[f+i*l]=f<=o?0:s[f+i*l]-s[f+i*o]*p;while(--h)}}while(--c);if(t.z=s[2*i+3]/s[2*i+2],t.y=(s[1*i+3]-s[1*i+2]*t.z)/s[1*i+1],t.x=(s[0*i+3]-s[0*i+2]*t.z-s[0*i+1]*t.y)/s[0*i+0],isNaN(t.x)||isNaN(t.y)||isNaN(t.z)||t.x===1/0||t.y===1/0||t.z===1/0)throw`Could not solve equation! Got x=[${t.toString()}], b=[${e.toString()}], A=[${this.toString()}]`;return t}e(e,t,n){if(n===void 0)return this.elements[t+3*e];this.elements[t+3*e]=n}copy(e){for(let t=0;t<e.elements.length;t++)this.elements[t]=e.elements[t];return this}toString(){let e="";for(let n=0;n<9;n++)e+=this.elements[n]+",";return e}reverse(e){e===void 0&&(e=new Sg);const t=3,n=6,i=Mj;let s,o;for(s=0;s<3;s++)for(o=0;o<3;o++)i[s+n*o]=this.elements[s+3*o];i[3]=1,i[9]=0,i[15]=0,i[4]=0,i[10]=1,i[16]=0,i[5]=0,i[11]=0,i[17]=1;let l=3;const c=l;let u;const h=n;let A;do{if(s=c-l,i[s+n*s]===0){for(o=s+1;o<c;o++)if(i[s+n*o]!==0){u=h;do A=h-u,i[A+n*s]+=i[A+n*o];while(--u);break}}if(i[s+n*s]!==0)for(o=s+1;o<c;o++){const f=i[s+n*o]/i[s+n*s];u=h;do A=h-u,i[A+n*o]=A<=s?0:i[A+n*o]-i[A+n*s]*f;while(--u)}}while(--l);s=2;do{o=s-1;do{const f=i[s+n*o]/i[s+n*s];u=n;do A=n-u,i[A+n*o]=i[A+n*o]-i[A+n*s]*f;while(--u)}while(o--)}while(--s);s=2;do{const f=1/i[s+n*s];u=n;do A=n-u,i[A+n*s]=i[A+n*s]*f;while(--u)}while(s--);s=2;do{o=2;do{if(A=i[t+o+n*s],isNaN(A)||A===1/0)throw`Could not reverse! A=[${this.toString()}]`;e.e(s,o,A)}while(o--)}while(s--);return e}setRotationFromQuaternion(e){const t=e.x,n=e.y,i=e.z,s=e.w,o=t+t,l=n+n,c=i+i,u=t*o,h=t*l,A=t*c,f=n*l,p=n*c,y=i*c,G=s*o,B=s*l,S=s*c,N=this.elements;return N[0]=1-(f+y),N[1]=h-S,N[2]=A+B,N[3]=h+S,N[4]=1-(u+y),N[5]=p-G,N[6]=A-B,N[7]=p+G,N[8]=1-(u+f),this}transpose(e){e===void 0&&(e=new Sg);const t=this.elements,n=e.elements;let i;return n[0]=t[0],n[4]=t[4],n[8]=t[8],i=t[1],n[1]=t[3],n[3]=i,i=t[2],n[2]=t[6],n[6]=i,i=t[5],n[5]=t[7],n[7]=i,e}}const Mj=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];class me{constructor(e,t,n){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),this.x=e,this.y=t,this.z=n}cross(e,t){t===void 0&&(t=new me);const n=e.x,i=e.y,s=e.z,o=this.x,l=this.y,c=this.z;return t.x=l*s-c*i,t.y=c*n-o*s,t.z=o*i-l*n,t}set(e,t,n){return this.x=e,this.y=t,this.z=n,this}setZero(){this.x=this.y=this.z=0}vadd(e,t){if(t)t.x=e.x+this.x,t.y=e.y+this.y,t.z=e.z+this.z;else return new me(this.x+e.x,this.y+e.y,this.z+e.z)}vsub(e,t){if(t)t.x=this.x-e.x,t.y=this.y-e.y,t.z=this.z-e.z;else return new me(this.x-e.x,this.y-e.y,this.z-e.z)}crossmat(){return new Sg([0,-this.z,this.y,this.z,0,-this.x,-this.y,this.x,0])}normalize(){const e=this.x,t=this.y,n=this.z,i=Math.sqrt(e*e+t*t+n*n);if(i>0){const s=1/i;this.x*=s,this.y*=s,this.z*=s}else this.x=0,this.y=0,this.z=0;return i}unit(e){e===void 0&&(e=new me);const t=this.x,n=this.y,i=this.z;let s=Math.sqrt(t*t+n*n+i*i);return s>0?(s=1/s,e.x=t*s,e.y=n*s,e.z=i*s):(e.x=1,e.y=0,e.z=0),e}length(){const e=this.x,t=this.y,n=this.z;return Math.sqrt(e*e+t*t+n*n)}lengthSquared(){return this.dot(this)}distanceTo(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z;return Math.sqrt((s-t)*(s-t)+(o-n)*(o-n)+(l-i)*(l-i))}distanceSquared(e){const t=this.x,n=this.y,i=this.z,s=e.x,o=e.y,l=e.z;return(s-t)*(s-t)+(o-n)*(o-n)+(l-i)*(l-i)}scale(e,t){t===void 0&&(t=new me);const n=this.x,i=this.y,s=this.z;return t.x=e*n,t.y=e*i,t.z=e*s,t}vmul(e,t){return t===void 0&&(t=new me),t.x=e.x*this.x,t.y=e.y*this.y,t.z=e.z*this.z,t}addScaledVector(e,t,n){return n===void 0&&(n=new me),n.x=this.x+e*t.x,n.y=this.y+e*t.y,n.z=this.z+e*t.z,n}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}isZero(){return this.x===0&&this.y===0&&this.z===0}negate(e){return e===void 0&&(e=new me),e.x=-this.x,e.y=-this.y,e.z=-this.z,e}tangents(e,t){const n=this.length();if(n>0){const i=_j,s=1/n;i.set(this.x*s,this.y*s,this.z*s);const o=Xj;Math.abs(i.x)<.9?(o.set(1,0,0),i.cross(o,e)):(o.set(0,1,0),i.cross(o,e)),i.cross(e,t)}else e.set(1,0,0),t.set(0,1,0)}toString(){return`${this.x},${this.y},${this.z}`}toArray(){return[this.x,this.y,this.z]}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}lerp(e,t,n){const i=this.x,s=this.y,o=this.z;n.x=i+(e.x-i)*t,n.y=s+(e.y-s)*t,n.z=o+(e.z-o)*t}almostEquals(e,t){return t===void 0&&(t=1e-6),!(Math.abs(this.x-e.x)>t||Math.abs(this.y-e.y)>t||Math.abs(this.z-e.z)>t)}almostZero(e){return e===void 0&&(e=1e-6),!(Math.abs(this.x)>e||Math.abs(this.y)>e||Math.abs(this.z)>e)}isAntiparallelTo(e,t){return this.negate(V1),V1.almostEquals(e,t)}clone(){return new me(this.x,this.y,this.z)}}me.ZERO=new me(0,0,0);me.UNIT_X=new me(1,0,0);me.UNIT_Y=new me(0,1,0);me.UNIT_Z=new me(0,0,1);const _j=new me,Xj=new me,V1=new me;class jr{constructor(e){e===void 0&&(e={}),this.lowerBound=new me,this.upperBound=new me,e.lowerBound&&this.lowerBound.copy(e.lowerBound),e.upperBound&&this.upperBound.copy(e.upperBound)}setFromPoints(e,t,n,i){const s=this.lowerBound,o=this.upperBound,l=n;s.copy(e[0]),l&&l.vmult(s,s),o.copy(s);for(let c=1;c<e.length;c++){let u=e[c];l&&(l.vmult(u,M1),u=M1),u.x>o.x&&(o.x=u.x),u.x<s.x&&(s.x=u.x),u.y>o.y&&(o.y=u.y),u.y<s.y&&(s.y=u.y),u.z>o.z&&(o.z=u.z),u.z<s.z&&(s.z=u.z)}return t&&(t.vadd(s,s),t.vadd(o,o)),i&&(s.x-=i,s.y-=i,s.z-=i,o.x+=i,o.y+=i,o.z+=i),this}copy(e){return this.lowerBound.copy(e.lowerBound),this.upperBound.copy(e.upperBound),this}clone(){return new jr().copy(this)}extend(e){this.lowerBound.x=Math.min(this.lowerBound.x,e.lowerBound.x),this.upperBound.x=Math.max(this.upperBound.x,e.upperBound.x),this.lowerBound.y=Math.min(this.lowerBound.y,e.lowerBound.y),this.upperBound.y=Math.max(this.upperBound.y,e.upperBound.y),this.lowerBound.z=Math.min(this.lowerBound.z,e.lowerBound.z),this.upperBound.z=Math.max(this.upperBound.z,e.upperBound.z)}overlaps(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound,o=i.x<=n.x&&n.x<=s.x||t.x<=s.x&&s.x<=n.x,l=i.y<=n.y&&n.y<=s.y||t.y<=s.y&&s.y<=n.y,c=i.z<=n.z&&n.z<=s.z||t.z<=s.z&&s.z<=n.z;return o&&l&&c}volume(){const e=this.lowerBound,t=this.upperBound;return(t.x-e.x)*(t.y-e.y)*(t.z-e.z)}contains(e){const t=this.lowerBound,n=this.upperBound,i=e.lowerBound,s=e.upperBound;return t.x<=i.x&&n.x>=s.x&&t.y<=i.y&&n.y>=s.y&&t.z<=i.z&&n.z>=s.z}getCorners(e,t,n,i,s,o,l,c){const u=this.lowerBound,h=this.upperBound;e.copy(u),t.set(h.x,u.y,u.z),n.set(h.x,h.y,u.z),i.set(u.x,h.y,h.z),s.set(h.x,u.y,h.z),o.set(u.x,h.y,u.z),l.set(u.x,u.y,h.z),c.copy(h)}toLocalFrame(e,t){const n=_1,i=n[0],s=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],A=n[7];this.getCorners(i,s,o,l,c,u,h,A);for(let f=0;f!==8;f++){const p=n[f];e.pointToLocal(p,p)}return t.setFromPoints(n)}toWorldFrame(e,t){const n=_1,i=n[0],s=n[1],o=n[2],l=n[3],c=n[4],u=n[5],h=n[6],A=n[7];this.getCorners(i,s,o,l,c,u,h,A);for(let f=0;f!==8;f++){const p=n[f];e.pointToWorld(p,p)}return t.setFromPoints(n)}overlapsRay(e){const{direction:t,from:n}=e,i=1/t.x,s=1/t.y,o=1/t.z,l=(this.lowerBound.x-n.x)*i,c=(this.upperBound.x-n.x)*i,u=(this.lowerBound.y-n.y)*s,h=(this.upperBound.y-n.y)*s,A=(this.lowerBound.z-n.z)*o,f=(this.upperBound.z-n.z)*o,p=Math.max(Math.max(Math.min(l,c),Math.min(u,h)),Math.min(A,f)),y=Math.min(Math.min(Math.max(l,c),Math.max(u,h)),Math.max(A,f));return!(y<0||p>y)}}const M1=new me,_1=[new me,new me,new me,new me,new me,new me,new me,new me];class mo{constructor(e,t,n,i){e===void 0&&(e=0),t===void 0&&(t=0),n===void 0&&(n=0),i===void 0&&(i=1),this.x=e,this.y=t,this.z=n,this.w=i}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}toString(){return`${this.x},${this.y},${this.z},${this.w}`}toArray(){return[this.x,this.y,this.z,this.w]}setFromAxisAngle(e,t){const n=Math.sin(t*.5);return this.x=e.x*n,this.y=e.y*n,this.z=e.z*n,this.w=Math.cos(t*.5),this}toAxisAngle(e){e===void 0&&(e=new me),this.normalize();const t=2*Math.acos(this.w),n=Math.sqrt(1-this.w*this.w);return n<.001?(e.x=this.x,e.y=this.y,e.z=this.z):(e.x=this.x/n,e.y=this.y/n,e.z=this.z/n),[e,t]}setFromVectors(e,t){if(e.isAntiparallelTo(t)){const n=Yj,i=Hj;e.tangents(n,i),this.setFromAxisAngle(n,Math.PI)}else{const n=e.cross(t);this.x=n.x,this.y=n.y,this.z=n.z,this.w=Math.sqrt(e.length()**2*t.length()**2)+e.dot(t),this.normalize()}return this}mult(e,t){t===void 0&&(t=new mo);const n=this.x,i=this.y,s=this.z,o=this.w,l=e.x,c=e.y,u=e.z,h=e.w;return t.x=n*h+o*l+i*u-s*c,t.y=i*h+o*c+s*l-n*u,t.z=s*h+o*u+n*c-i*l,t.w=o*h-n*l-i*c-s*u,t}inverse(e){e===void 0&&(e=new mo);const t=this.x,n=this.y,i=this.z,s=this.w;this.conjugate(e);const o=1/(t*t+n*n+i*i+s*s);return e.x*=o,e.y*=o,e.z*=o,e.w*=o,e}conjugate(e){return e===void 0&&(e=new mo),e.x=-this.x,e.y=-this.y,e.z=-this.z,e.w=this.w,e}normalize(){let e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}normalizeFast(){const e=(3-(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w))/2;return e===0?(this.x=0,this.y=0,this.z=0,this.w=0):(this.x*=e,this.y*=e,this.z*=e,this.w*=e),this}vmult(e,t){t===void 0&&(t=new me);const n=e.x,i=e.y,s=e.z,o=this.x,l=this.y,c=this.z,u=this.w,h=u*n+l*s-c*i,A=u*i+c*n-o*s,f=u*s+o*i-l*n,p=-o*n-l*i-c*s;return t.x=h*u+p*-o+A*-c-f*-l,t.y=A*u+p*-l+f*-o-h*-c,t.z=f*u+p*-c+h*-l-A*-o,t}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w,this}toEuler(e,t){t===void 0&&(t="YZX");let n,i,s;const o=this.x,l=this.y,c=this.z,u=this.w;switch(t){case"YZX":const h=o*l+c*u;if(h>.499&&(n=2*Math.atan2(o,u),i=Math.PI/2,s=0),h<-.499&&(n=-2*Math.atan2(o,u),i=-Math.PI/2,s=0),n===void 0){const A=o*o,f=l*l,p=c*c;n=Math.atan2(2*l*u-2*o*c,1-2*f-2*p),i=Math.asin(2*h),s=Math.atan2(2*o*u-2*l*c,1-2*A-2*p)}break;default:throw new Error(`Euler order ${t} not supported yet.`)}e.y=n,e.z=i,e.x=s}setFromEuler(e,t,n,i){i===void 0&&(i="XYZ");const s=Math.cos(e/2),o=Math.cos(t/2),l=Math.cos(n/2),c=Math.sin(e/2),u=Math.sin(t/2),h=Math.sin(n/2);return i==="XYZ"?(this.x=c*o*l+s*u*h,this.y=s*u*l-c*o*h,this.z=s*o*h+c*u*l,this.w=s*o*l-c*u*h):i==="YXZ"?(this.x=c*o*l+s*u*h,this.y=s*u*l-c*o*h,this.z=s*o*h-c*u*l,this.w=s*o*l+c*u*h):i==="ZXY"?(this.x=c*o*l-s*u*h,this.y=s*u*l+c*o*h,this.z=s*o*h+c*u*l,this.w=s*o*l-c*u*h):i==="ZYX"?(this.x=c*o*l-s*u*h,this.y=s*u*l+c*o*h,this.z=s*o*h-c*u*l,this.w=s*o*l+c*u*h):i==="YZX"?(this.x=c*o*l+s*u*h,this.y=s*u*l+c*o*h,this.z=s*o*h-c*u*l,this.w=s*o*l-c*u*h):i==="XZY"&&(this.x=c*o*l-s*u*h,this.y=s*u*l-c*o*h,this.z=s*o*h+c*u*l,this.w=s*o*l+c*u*h),this}clone(){return new mo(this.x,this.y,this.z,this.w)}slerp(e,t,n){n===void 0&&(n=new mo);const i=this.x,s=this.y,o=this.z,l=this.w;let c=e.x,u=e.y,h=e.z,A=e.w,f,p,y,G,B;return p=i*c+s*u+o*h+l*A,p<0&&(p=-p,c=-c,u=-u,h=-h,A=-A),1-p>1e-6?(f=Math.acos(p),y=Math.sin(f),G=Math.sin((1-t)*f)/y,B=Math.sin(t*f)/y):(G=1-t,B=t),n.x=G*i+B*c,n.y=G*s+B*u,n.z=G*o+B*h,n.w=G*l+B*A,n}integrate(e,t,n,i){i===void 0&&(i=new mo);const s=e.x*n.x,o=e.y*n.y,l=e.z*n.z,c=this.x,u=this.y,h=this.z,A=this.w,f=t*.5;return i.x+=f*(s*A+o*h-l*u),i.y+=f*(o*A+l*c-s*h),i.z+=f*(l*A+s*u-o*c),i.w+=f*(-s*c-o*u-l*h),i}}const Yj=new me,Hj=new me,Ej={SPHERE:1,PLANE:2,BOX:4,COMPOUND:8,CONVEXPOLYHEDRON:16,HEIGHTFIELD:32,PARTICLE:64,CYLINDER:128,TRIMESH:256};class In{constructor(e){e===void 0&&(e={}),this.id=In.idCounter++,this.type=e.type||0,this.boundingSphereRadius=0,this.collisionResponse=e.collisionResponse?e.collisionResponse:!0,this.collisionFilterGroup=e.collisionFilterGroup!==void 0?e.collisionFilterGroup:1,this.collisionFilterMask=e.collisionFilterMask!==void 0?e.collisionFilterMask:-1,this.material=e.material?e.material:null,this.body=null}updateBoundingSphereRadius(){throw`computeBoundingSphereRadius() not implemented for shape type ${this.type}`}volume(){throw`volume() not implemented for shape type ${this.type}`}calculateLocalInertia(e,t){throw`calculateLocalInertia() not implemented for shape type ${this.type}`}calculateWorldAABB(e,t,n,i){throw`calculateWorldAABB() not implemented for shape type ${this.type}`}}In.idCounter=0;In.types=Ej;class zo{constructor(e){e===void 0&&(e={}),this.position=new me,this.quaternion=new mo,e.position&&this.position.copy(e.position),e.quaternion&&this.quaternion.copy(e.quaternion)}pointToLocal(e,t){return zo.pointToLocalFrame(this.position,this.quaternion,e,t)}pointToWorld(e,t){return zo.pointToWorldFrame(this.position,this.quaternion,e,t)}vectorToWorldFrame(e,t){return t===void 0&&(t=new me),this.quaternion.vmult(e,t),t}static pointToLocalFrame(e,t,n,i){return i===void 0&&(i=new me),n.vsub(e,i),t.conjugate(X1),X1.vmult(i,i),i}static pointToWorldFrame(e,t,n,i){return i===void 0&&(i=new me),t.vmult(n,i),i.vadd(e,i),i}static vectorToWorldFrame(e,t,n){return n===void 0&&(n=new me),e.vmult(t,n),n}static vectorToLocalFrame(e,t,n,i){return i===void 0&&(i=new me),t.w*=-1,t.vmult(n,i),t.w*=-1,i}}const X1=new mo;new me;new me;new me;new me;new me,new me,new me,new me,new me,new me,new me,new me;new me;new mo;new jr;new Sg;new Sg;new Sg;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new mo;new me;new me;new me;new me;class L2{constructor(){this.rayFromWorld=new me,this.rayToWorld=new me,this.hitNormalWorld=new me,this.hitPointWorld=new me,this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}reset(){this.rayFromWorld.setZero(),this.rayToWorld.setZero(),this.hitNormalWorld.setZero(),this.hitPointWorld.setZero(),this.hasHit=!1,this.shape=null,this.body=null,this.hitFaceIndex=-1,this.distance=-1,this.shouldStop=!1}abort(){this.shouldStop=!0}set(e,t,n,i,s,o,l){this.rayFromWorld.copy(e),this.rayToWorld.copy(t),this.hitNormalWorld.copy(n),this.hitPointWorld.copy(i),this.shape=s,this.body=o,this.distance=l}}let J3,P3,Q3,q3,$3,eM,tM;const gx={CLOSEST:1,ANY:2,ALL:4};J3=In.types.SPHERE;P3=In.types.PLANE;Q3=In.types.BOX;q3=In.types.CYLINDER;$3=In.types.CONVEXPOLYHEDRON;eM=In.types.HEIGHTFIELD;tM=In.types.TRIMESH;class ks{get[J3](){return this._intersectSphere}get[P3](){return this._intersectPlane}get[Q3](){return this._intersectBox}get[q3](){return this._intersectConvex}get[$3](){return this._intersectConvex}get[eM](){return this._intersectHeightfield}get[tM](){return this._intersectTrimesh}constructor(e,t){e===void 0&&(e=new me),t===void 0&&(t=new me),this.from=e.clone(),this.to=t.clone(),this.direction=new me,this.precision=1e-4,this.checkCollisionResponse=!0,this.skipBackfaces=!1,this.collisionFilterMask=-1,this.collisionFilterGroup=-1,this.mode=ks.ANY,this.result=new L2,this.hasHit=!1,this.callback=n=>{}}intersectWorld(e,t){return this.mode=t.mode||ks.ANY,this.result=t.result||new L2,this.skipBackfaces=!!t.skipBackfaces,this.collisionFilterMask=typeof t.collisionFilterMask<"u"?t.collisionFilterMask:-1,this.collisionFilterGroup=typeof t.collisionFilterGroup<"u"?t.collisionFilterGroup:-1,this.checkCollisionResponse=typeof t.checkCollisionResponse<"u"?t.checkCollisionResponse:!0,t.from&&this.from.copy(t.from),t.to&&this.to.copy(t.to),this.callback=t.callback||(()=>{}),this.hasHit=!1,this.result.reset(),this.updateDirection(),this.getAABB(Y1),FB.length=0,e.broadphase.aabbQuery(e,Y1,FB),this.intersectBodies(FB),this.hasHit}intersectBody(e,t){t&&(this.result=t,this.updateDirection());const n=this.checkCollisionResponse;if(n&&!e.collisionResponse||(this.collisionFilterGroup&e.collisionFilterMask)===0||(e.collisionFilterGroup&this.collisionFilterMask)===0)return;const i=Fj,s=Kj;for(let o=0,l=e.shapes.length;o<l;o++){const c=e.shapes[o];if(!(n&&!c.collisionResponse)&&(e.quaternion.mult(e.shapeOrientations[o],s),e.quaternion.vmult(e.shapeOffsets[o],i),i.vadd(e.position,i),this.intersectShape(c,s,i,e),this.result.shouldStop))break}}intersectBodies(e,t){t&&(this.result=t,this.updateDirection());for(let n=0,i=e.length;!this.result.shouldStop&&n<i;n++)this.intersectBody(e[n])}updateDirection(){this.to.vsub(this.from,this.direction),this.direction.normalize()}intersectShape(e,t,n,i){const s=this.from;if(eJ(s,this.direction,n)>e.boundingSphereRadius)return;const l=this[e.type];l&&l.call(this,e,t,n,i,e)}_intersectBox(e,t,n,i,s){return this._intersectConvex(e.convexPolyhedronRepresentation,t,n,i,s)}_intersectPlane(e,t,n,i,s){const o=this.from,l=this.to,c=this.direction,u=new me(0,0,1);t.vmult(u,u);const h=new me;o.vsub(n,h);const A=h.dot(u);l.vsub(n,h);const f=h.dot(u);if(A*f>0||o.distanceTo(l)<A)return;const p=u.dot(c);if(Math.abs(p)<this.precision)return;const y=new me,G=new me,B=new me;o.vsub(n,y);const S=-u.dot(y)/p;c.scale(S,G),o.vadd(G,B),this.reportIntersection(u,B,s,i,-1)}getAABB(e){const{lowerBound:t,upperBound:n}=e,i=this.to,s=this.from;t.x=Math.min(i.x,s.x),t.y=Math.min(i.y,s.y),t.z=Math.min(i.z,s.z),n.x=Math.max(i.x,s.x),n.y=Math.max(i.y,s.y),n.z=Math.max(i.z,s.z)}_intersectHeightfield(e,t,n,i,s){e.data,e.elementSize;const o=Tj;o.from.copy(this.from),o.to.copy(this.to),zo.pointToLocalFrame(n,t,o.from,o.from),zo.pointToLocalFrame(n,t,o.to,o.to),o.updateDirection();const l=zj;let c,u,h,A;c=u=0,h=A=e.data.length-1;const f=new jr;o.getAABB(f),e.getIndexOfPosition(f.lowerBound.x,f.lowerBound.y,l,!0),c=Math.max(c,l[0]),u=Math.max(u,l[1]),e.getIndexOfPosition(f.upperBound.x,f.upperBound.y,l,!0),h=Math.min(h,l[0]+1),A=Math.min(A,l[1]+1);for(let p=c;p<h;p++)for(let y=u;y<A;y++){if(this.result.shouldStop)return;if(e.getAabbAtIndex(p,y,f),!!f.overlapsRay(o)){if(e.getConvexTrianglePillar(p,y,!1),zo.pointToWorldFrame(n,t,e.pillarOffset,n0),this._intersectConvex(e.pillarConvex,t,n0,i,s,H1),this.result.shouldStop)return;e.getConvexTrianglePillar(p,y,!0),zo.pointToWorldFrame(n,t,e.pillarOffset,n0),this._intersectConvex(e.pillarConvex,t,n0,i,s,H1)}}}_intersectSphere(e,t,n,i,s){const o=this.from,l=this.to,c=e.radius,u=(l.x-o.x)**2+(l.y-o.y)**2+(l.z-o.z)**2,h=2*((l.x-o.x)*(o.x-n.x)+(l.y-o.y)*(o.y-n.y)+(l.z-o.z)*(o.z-n.z)),A=(o.x-n.x)**2+(o.y-n.y)**2+(o.z-n.z)**2-c**2,f=h**2-4*u*A,p=Lj,y=kj;if(!(f<0))if(f===0)o.lerp(l,f,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1);else{const G=(-h-Math.sqrt(f))/(2*u),B=(-h+Math.sqrt(f))/(2*u);if(G>=0&&G<=1&&(o.lerp(l,G,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1)),this.result.shouldStop)return;B>=0&&B<=1&&(o.lerp(l,B,p),p.vsub(n,y),y.normalize(),this.reportIntersection(y,p,s,i,-1))}}_intersectConvex(e,t,n,i,s,o){const l=Uj,c=E1,u=o&&o.faceList||null,h=e.faces,A=e.vertices,f=e.faceNormals,p=this.direction,y=this.from,G=this.to,B=y.distanceTo(G),S=u?u.length:h.length,N=this.result;for(let R=0;!N.shouldStop&&R<S;R++){const w=u?u[R]:R,V=h[w],H=f[w],X=t,Y=n;c.copy(A[V[0]]),X.vmult(c,c),c.vadd(Y,c),c.vsub(y,c),X.vmult(H,l);const M=p.dot(l);if(Math.abs(M)<this.precision)continue;const E=l.dot(c)/M;if(!(E<0)){p.scale(E,Fo),Fo.vadd(y,Fo),Bl.copy(A[V[0]]),X.vmult(Bl,Bl),Y.vadd(Bl,Bl);for(let O=1;!N.shouldStop&&O<V.length-1;O++){Ac.copy(A[V[O]]),fc.copy(A[V[O+1]]),X.vmult(Ac,Ac),X.vmult(fc,fc),Y.vadd(Ac,Ac),Y.vadd(fc,fc);const P=Fo.distanceTo(y);!(ks.pointInTriangle(Fo,Bl,Ac,fc)||ks.pointInTriangle(Fo,Ac,Bl,fc))||P>B||this.reportIntersection(l,Fo,s,i,w)}}}}_intersectTrimesh(e,t,n,i,s,o){const l=Dj,c=qj,u=$j,h=E1,A=Oj,f=jj,p=Jj,y=Qj,G=Pj,B=e.indices;e.vertices;const S=this.from,N=this.to,R=this.direction;u.position.copy(n),u.quaternion.copy(t),zo.vectorToLocalFrame(n,t,R,A),zo.pointToLocalFrame(n,t,S,f),zo.pointToLocalFrame(n,t,N,p),p.x*=e.scale.x,p.y*=e.scale.y,p.z*=e.scale.z,f.x*=e.scale.x,f.y*=e.scale.y,f.z*=e.scale.z,p.vsub(f,A),A.normalize();const w=f.distanceSquared(p);e.tree.rayQuery(this,u,c);for(let V=0,H=c.length;!this.result.shouldStop&&V!==H;V++){const X=c[V];e.getNormal(X,l),e.getVertex(B[X*3],Bl),Bl.vsub(f,h);const Y=A.dot(l),M=l.dot(h)/Y;if(M<0)continue;A.scale(M,Fo),Fo.vadd(f,Fo),e.getVertex(B[X*3+1],Ac),e.getVertex(B[X*3+2],fc);const E=Fo.distanceSquared(f);!(ks.pointInTriangle(Fo,Ac,Bl,fc)||ks.pointInTriangle(Fo,Bl,Ac,fc))||E>w||(zo.vectorToWorldFrame(t,l,G),zo.pointToWorldFrame(n,t,Fo,y),this.reportIntersection(G,y,s,i,X))}c.length=0}reportIntersection(e,t,n,i,s){const o=this.from,l=this.to,c=o.distanceTo(t),u=this.result;if(!(this.skipBackfaces&&e.dot(this.direction)>0))switch(u.hitFaceIndex=typeof s<"u"?s:-1,this.mode){case ks.ALL:this.hasHit=!0,u.set(o,l,e,t,n,i,c),u.hasHit=!0,this.callback(u);break;case ks.CLOSEST:(c<u.distance||!u.hasHit)&&(this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,c));break;case ks.ANY:this.hasHit=!0,u.hasHit=!0,u.set(o,l,e,t,n,i,c),u.shouldStop=!0;break}}static pointInTriangle(e,t,n,i){i.vsub(t,$d),n.vsub(t,bf),e.vsub(t,KB);const s=$d.dot($d),o=$d.dot(bf),l=$d.dot(KB),c=bf.dot(bf),u=bf.dot(KB);let h,A;return(h=c*l-o*u)>=0&&(A=s*u-o*l)>=0&&h+A<s*c-o*o}}ks.CLOSEST=gx.CLOSEST;ks.ANY=gx.ANY;ks.ALL=gx.ALL;const Y1=new jr,FB=[],bf=new me,KB=new me,Fj=new me,Kj=new mo,Fo=new me,Bl=new me,Ac=new me,fc=new me;new me;new L2;const H1={faceList:[0]},n0=new me,Tj=new ks,zj=[],Lj=new me,kj=new me,Uj=new me;new me;new me;const E1=new me,Dj=new me,Oj=new me,jj=new me,Jj=new me,Pj=new me,Qj=new me;new jr;const qj=[],$j=new zo,$d=new me,i0=new me;function eJ(a,e,t){t.vsub(a,$d);const n=$d.dot(e);return e.scale(n,i0),i0.vadd(a,i0),t.distanceTo(i0)}new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new ks;new me;new me;new me;new me(1,0,0),new me(0,1,0),new me(0,0,1);new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new jr;new me;new jr;new me;new me;new me;new me;new me;new me;new me;new jr;new me;new zo;new jr;In.types.SPHERE,In.types.SPHERE|In.types.PLANE,In.types.BOX|In.types.BOX,In.types.SPHERE|In.types.BOX,In.types.PLANE|In.types.BOX,In.types.CONVEXPOLYHEDRON,In.types.SPHERE|In.types.CONVEXPOLYHEDRON,In.types.PLANE|In.types.CONVEXPOLYHEDRON,In.types.BOX|In.types.CONVEXPOLYHEDRON,In.types.SPHERE|In.types.HEIGHTFIELD,In.types.BOX|In.types.HEIGHTFIELD,In.types.CONVEXPOLYHEDRON|In.types.HEIGHTFIELD,In.types.PARTICLE|In.types.SPHERE,In.types.PLANE|In.types.PARTICLE,In.types.BOX|In.types.PARTICLE,In.types.PARTICLE|In.types.CONVEXPOLYHEDRON,In.types.CYLINDER,In.types.SPHERE|In.types.CYLINDER,In.types.PLANE|In.types.CYLINDER,In.types.BOX|In.types.CYLINDER,In.types.CONVEXPOLYHEDRON|In.types.CYLINDER,In.types.HEIGHTFIELD|In.types.CYLINDER,In.types.PARTICLE|In.types.CYLINDER,In.types.SPHERE|In.types.TRIMESH,In.types.PLANE|In.types.TRIMESH;new me;new me;new me;new me;new me;new mo;new mo;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new jr;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me,new me,new me,new me,new me,new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new me;new mo;new me;new me;new me;new me;new me;new me;new me;new me;new me;new jr;new ks;const yf=globalThis.performance||{};if(!yf.now){let a=Date.now();yf.timing&&yf.timing.navigationStart&&(a=yf.timing.navigationStart),yf.now=()=>Date.now()-a}new me;const tJ=J.createContext(null),nJ=()=>J.useContext(tJ),nM=J.createContext(null),iJ=()=>{const a=J.useContext(nM);if(!a)throw new Error("Physics context not found. @react-three/cannon & components can only be used within a Physics provider");return a};new ue(1,1,1);new ue;new pn;const F1=new ti;function aJ(a){const e=J.useRef(null);return a&&typeof a!="function"?a:e}function K1(a){return a.charAt(0).toUpperCase()+a.slice(1)}function ps(a,e){const t=e===void 0?"":`/${e}`;return typeof a=="function"?null:a&&a.current&&`${a.current.uuid}${t}`}const sJ=new vo,oJ=new xa,rJ=a=>e=>a(sJ.setFromQuaternion(oJ.fromArray(e)).toArray());let iM=0;function TB(a,e,t,n,i,s){return s===void 0&&(s="bodies"),o=>{const l=iM++;t[l]={[n]:o};const c=ps(a,i);return c&&e.subscribe({props:{id:l,target:s,type:n},uuid:c}),()=>{delete t[l],e.unsubscribe({props:l})}}}function T1(a,e){let{position:t=[0,0,0],rotation:n=[0,0,0],userData:i={}}=e;a.userData=i,a.position.set(...t),a.rotation.set(...n),a.updateMatrix()}function z1(a,e,t){let{onCollide:n,onCollideBegin:i,onCollideEnd:s}=e;a[t]={collide:n,collideBegin:i,collideEnd:s}}function ux(a,e,t,n,i){n===void 0&&(n=null),i===void 0&&(i=[]);const s=aJ(n),{events:o,refs:l,scaleOverrides:c,subscriptions:u,worker:h}=iJ(),A=nJ();J.useLayoutEffect(()=>{s.current||(s.current=new ti);const p=s.current,y=h,G=p instanceof dC?(p.instanceMatrix.setUsage(sV),p.count):1,B=p instanceof dC?new Array(G).fill(0).map((N,R)=>`${p.uuid}/${R}`):[p.uuid],S=p instanceof dC?B.map((N,R)=>{const w=e(R);return T1(F1,w),p.setMatrixAt(R,F1.matrix),p.instanceMatrix.needsUpdate=!0,l[N]=p,A?.add(N,w,a),z1(o,w,N),{...w,args:t(w.args)}}):B.map((N,R)=>{const w=e(R);return T1(p,w),l[N]=p,A?.add(N,w,a),z1(o,w,N),{...w,args:t(w.args)}});return y.addBodies({props:S.map(N=>{let{onCollide:R,onCollideBegin:w,onCollideEnd:V,...H}=N;return{onCollide:!!R,...H}}),type:a,uuid:B}),()=>{B.forEach(N=>{delete l[N],A?.remove(N),delete o[N]}),y.removeBodies({uuid:B})}},i);const f=J.useMemo(()=>{const p=(R,w)=>{const V=`set${K1(R)}`;return{set:H=>{const X=ps(s,w);X&&h[V]({props:H,uuid:X})},subscribe:TB(s,h,u,R,w)}},y=R=>({copy:V=>{let{w:H,x:X,y:Y,z:M}=V;const E=ps(s,R);E&&h.setQuaternion({props:[X,Y,M,H],uuid:E})},set:(V,H,X,Y)=>{const M=ps(s,R);M&&h.setQuaternion({props:[V,H,X,Y],uuid:M})},subscribe:TB(s,h,u,"quaternion",R)}),G=R=>({copy:w=>{let{x:V,y:H,z:X}=w;const Y=ps(s,R);Y&&h.setRotation({props:[V,H,X],uuid:Y})},set:(w,V,H)=>{const X=ps(s,R);X&&h.setRotation({props:[w,V,H],uuid:X})},subscribe:w=>{const V=iM++,H="bodies",X="quaternion",Y=ps(s,R);return u[V]={[X]:rJ(w)},Y&&h.subscribe({props:{id:V,target:H,type:X},uuid:Y}),()=>{delete u[V],h.unsubscribe({props:V})}}}),B=(R,w)=>{const V=`set${K1(R)}`;return{copy:H=>{let{x:X,y:Y,z:M}=H;const E=ps(s,w);E&&h[V]({props:[X,Y,M],uuid:E})},set:(H,X,Y)=>{const M=ps(s,w);M&&h[V]({props:[H,X,Y],uuid:M})},subscribe:TB(s,h,u,R,w)}};function S(R){return{allowSleep:p("allowSleep",R),angularDamping:p("angularDamping",R),angularFactor:B("angularFactor",R),angularVelocity:B("angularVelocity",R),applyForce(w,V){const H=ps(s,R);H&&h.applyForce({props:[w,V],uuid:H})},applyImpulse(w,V){const H=ps(s,R);H&&h.applyImpulse({props:[w,V],uuid:H})},applyLocalForce(w,V){const H=ps(s,R);H&&h.applyLocalForce({props:[w,V],uuid:H})},applyLocalImpulse(w,V){const H=ps(s,R);H&&h.applyLocalImpulse({props:[w,V],uuid:H})},applyTorque(w){const V=ps(s,R);V&&h.applyTorque({props:[w],uuid:V})},collisionFilterGroup:p("collisionFilterGroup",R),collisionFilterMask:p("collisionFilterMask",R),collisionResponse:p("collisionResponse",R),fixedRotation:p("fixedRotation",R),isTrigger:p("isTrigger",R),linearDamping:p("linearDamping",R),linearFactor:B("linearFactor",R),mass:p("mass",R),material:p("material",R),position:B("position",R),quaternion:y(R),rotation:G(R),scaleOverride(w){const V=ps(s,R);V&&(c[V]=new ue(...w))},sleep(){const w=ps(s,R);w&&h.sleep({uuid:w})},sleepSpeedLimit:p("sleepSpeedLimit",R),sleepTimeLimit:p("sleepTimeLimit",R),userData:p("userData",R),velocity:B("velocity",R),wakeUp(){const w=ps(s,R);w&&h.wakeUp({uuid:w})}}}const N={};return{...S(void 0),at:R=>N[R]||(N[R]=S(R))}},[]);return[s,f]}function zB(a){return a instanceof ue?[a.x,a.y,a.z]:a}function Wf(a,e,t){return ux("Plane",a,()=>[],e,t)}function lJ(a,e,t){const n=[1,1,1];return ux("Box",a,function(i){return i===void 0&&(i=n),i},e,t)}function aM(a,e,t){return ux("ConvexPolyhedron",a,function(n){let[i,s,o,l,c]=n===void 0?[]:n;return[i&&i.map(zB),s,o&&o.map(zB),l&&l.map(zB),c]},e,t)}const cJ=new ue,gJ=new ue(1,1,1),uJ=new xa,a0=new pn;function L1(a,e,t,n,i){return n===void 0&&(n=gJ),a!==void 0?(a0.compose(cJ.fromArray(e,a*3),uJ.fromArray(t,a*4),n),i&&(i.matrixAutoUpdate=!1,i.matrix.copy(a0)),a0):a0.identity()}const dJ=()=>{const a=[];return e=>a.includes(e)?!1:!!a.push(e)};function IJ(a){let{allowSleep:e=!1,axisIndex:t=0,broadphase:n="Naive",children:i,defaultContactMaterial:s={contactEquationStiffness:1e6},frictionGravity:o=null,gravity:l=[0,-9.81,0],isPaused:c=!1,iterations:u=5,maxSubSteps:h=10,quatNormalizeFast:A=!1,quatNormalizeSkip:f=0,shouldInvalidate:p=!0,size:y=1e3,solver:G="GS",stepSize:B=1/60,tolerance:S=.001}=a;const{invalidate:N}=Gs(),[{bodies:R,events:w,refs:V,scaleOverrides:H,subscriptions:X,worker:Y}]=J.useState(()=>({bodies:{},events:{},refs:{},scaleOverrides:{},subscriptions:{},worker:new gj({allowSleep:e,axisIndex:t,broadphase:n,defaultContactMaterial:s,frictionGravity:o,gravity:l,iterations:u,quatNormalizeFast:A,quatNormalizeSkip:f,size:y,solver:G,tolerance:S})}));let M=0;const E=J.useCallback((j,Q)=>{c||(M+=Q,Y.step({maxSubSteps:h,stepSize:B,timeSinceLastCalled:M}),M=0)},[c,h,B]),O=j=>{var Q;let{body:ce,contact:{bi:oe,bj:T,...$},target:ae,...Ie}=j;const be=(Q=w[ae])==null?void 0:Q.collide;be&&be({body:V[ce],contact:{bi:V[oe],bj:V[T],...$},target:V[ae],...Ie})},P=j=>{var Q,ce;let{bodyA:oe,bodyB:T}=j;const $=(Q=w[oe])==null?void 0:Q.collideBegin;$&&$({body:V[T],op:"event",target:V[oe],type:"collideBegin"});const ae=(ce=w[T])==null?void 0:ce.collideBegin;ae&&ae({body:V[oe],op:"event",target:V[T],type:"collideBegin"})},q=j=>{var Q,ce;let{bodyA:oe,bodyB:T}=j;const $=(Q=w[oe])==null?void 0:Q.collideEnd;$&&$({body:V[T],op:"event",target:V[oe],type:"collideEnd"});const ae=(ce=w[T])==null?void 0:ce.collideEnd;ae&&ae({body:V[oe],op:"event",target:V[T],type:"collideEnd"})},k=j=>{let{active:Q,bodies:ce=[],observations:oe,positions:T,quaternions:$}=j;for(let ae=0;ae<ce.length;ae++)R[ce[ae]]=ae;if(oe.forEach(ae=>{let[Ie,be,D]=ae;const ee=(X[Ie]||{})[D];ee&&ee(be)}),!!Q){for(const ae of Object.values(V).filter(dJ()))if(ae instanceof dC)for(let Ie=0;Ie<ae.count;Ie++){const be=`${ae.uuid}/${Ie}`,D=R[be];D!==void 0&&(ae.setMatrixAt(Ie,L1(D,T,$,H[be])),ae.instanceMatrix.needsUpdate=!0)}else{const Ie=H[ae.uuid]||ae.scale;L1(R[ae.uuid],T,$,Ie,ae)}p&&N()}},le=j=>{var Q;let{body:ce,ray:{uuid:oe,...T},...$}=j;const ae=(Q=w[oe])==null?void 0:Q.rayhit;ae&&ae({body:ce?V[ce]:null,ray:{uuid:oe,...T},...$})};ox(E),J.useEffect(()=>(Y.connect(),Y.init(),Y.on("collide",O),Y.on("collideBegin",P),Y.on("collideEnd",q),Y.on("frame",k),Y.on("rayhit",le),()=>{Y.terminate(),Y.removeAllListeners()}),[]),J.useEffect(()=>{Y.axisIndex=t},[t]),J.useEffect(()=>{Y.broadphase=n},[n]),J.useEffect(()=>{Y.gravity=l},[l]),J.useEffect(()=>{Y.iterations=u},[u]),J.useEffect(()=>{Y.tolerance=S},[S]);const F=J.useMemo(()=>({bodies:R,events:w,refs:V,scaleOverrides:H,subscriptions:X,worker:Y}),[R,w,V,X,Y]);return m.jsx(nM.Provider,{value:F,children:i})}function Eu(){return Eu=Object.assign?Object.assign.bind():function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},Eu.apply(null,arguments)}const Gv=parseInt(wm.replace(/\D+/g,"")),sM=Gv>=125?"uv1":"uv2";var Tr=Uint8Array,Mu=Uint16Array,k2=Uint32Array,oM=new Tr([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),rM=new Tr([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),hJ=new Tr([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),lM=function(a,e){for(var t=new Mu(31),n=0;n<31;++n)t[n]=e+=1<<a[n-1];for(var i=new k2(t[30]),n=1;n<30;++n)for(var s=t[n];s<t[n+1];++s)i[s]=s-t[n]<<5|n;return[t,i]},cM=lM(oM,2),gM=cM[0],CJ=cM[1];gM[28]=258,CJ[258]=28;var AJ=lM(rM,0),fJ=AJ[0],U2=new Mu(32768);for(var Li=0;Li<32768;++Li){var Gu=(Li&43690)>>>1|(Li&21845)<<1;Gu=(Gu&52428)>>>2|(Gu&13107)<<2,Gu=(Gu&61680)>>>4|(Gu&3855)<<4,U2[Li]=((Gu&65280)>>>8|(Gu&255)<<8)>>>1}var Df=(function(a,e,t){for(var n=a.length,i=0,s=new Mu(e);i<n;++i)++s[a[i]-1];var o=new Mu(e);for(i=0;i<e;++i)o[i]=o[i-1]+s[i-1]<<1;var l;if(t){l=new Mu(1<<e);var c=15-e;for(i=0;i<n;++i)if(a[i])for(var u=i<<4|a[i],h=e-a[i],A=o[a[i]-1]++<<h,f=A|(1<<h)-1;A<=f;++A)l[U2[A]>>>c]=u}else for(l=new Mu(n),i=0;i<n;++i)a[i]&&(l[i]=U2[o[a[i]-1]++]>>>15-a[i]);return l}),Lm=new Tr(288);for(var Li=0;Li<144;++Li)Lm[Li]=8;for(var Li=144;Li<256;++Li)Lm[Li]=9;for(var Li=256;Li<280;++Li)Lm[Li]=7;for(var Li=280;Li<288;++Li)Lm[Li]=8;var uM=new Tr(32);for(var Li=0;Li<32;++Li)uM[Li]=5;var mJ=Df(Lm,9,1),pJ=Df(uM,5,1),LB=function(a){for(var e=a[0],t=1;t<a.length;++t)a[t]>e&&(e=a[t]);return e},Sl=function(a,e,t){var n=e/8|0;return(a[n]|a[n+1]<<8)>>(e&7)&t},kB=function(a,e){var t=e/8|0;return(a[t]|a[t+1]<<8|a[t+2]<<16)>>(e&7)},bJ=function(a){return(a/8|0)+(a&7&&1)},yJ=function(a,e,t){(t==null||t>a.length)&&(t=a.length);var n=new(a instanceof Mu?Mu:a instanceof k2?k2:Tr)(t-e);return n.set(a.subarray(e,t)),n},vJ=function(a,e,t){var n=a.length;if(!n||t&&!t.l&&n<5)return e||new Tr(0);var i=!e||t,s=!t||t.i;t||(t={}),e||(e=new Tr(n*3));var o=function(D){var de=e.length;if(D>de){var ee=new Tr(Math.max(de*2,D));ee.set(e),e=ee}},l=t.f||0,c=t.p||0,u=t.b||0,h=t.l,A=t.d,f=t.m,p=t.n,y=n*8;do{if(!h){t.f=l=Sl(a,c,1);var G=Sl(a,c+1,3);if(c+=3,G)if(G==1)h=mJ,A=pJ,f=9,p=5;else if(G==2){var R=Sl(a,c,31)+257,w=Sl(a,c+10,15)+4,V=R+Sl(a,c+5,31)+1;c+=14;for(var H=new Tr(V),X=new Tr(19),Y=0;Y<w;++Y)X[hJ[Y]]=Sl(a,c+Y*3,7);c+=w*3;for(var M=LB(X),E=(1<<M)-1,O=Df(X,M,1),Y=0;Y<V;){var P=O[Sl(a,c,E)];c+=P&15;var B=P>>>4;if(B<16)H[Y++]=B;else{var q=0,k=0;for(B==16?(k=3+Sl(a,c,3),c+=2,q=H[Y-1]):B==17?(k=3+Sl(a,c,7),c+=3):B==18&&(k=11+Sl(a,c,127),c+=7);k--;)H[Y++]=q}}var le=H.subarray(0,R),F=H.subarray(R);f=LB(le),p=LB(F),h=Df(le,f,1),A=Df(F,p,1)}else throw"invalid block type";else{var B=bJ(c)+4,S=a[B-4]|a[B-3]<<8,N=B+S;if(N>n){if(s)throw"unexpected EOF";break}i&&o(u+S),e.set(a.subarray(B,N),u),t.b=u+=S,t.p=c=N*8;continue}if(c>y){if(s)throw"unexpected EOF";break}}i&&o(u+131072);for(var j=(1<<f)-1,Q=(1<<p)-1,ce=c;;ce=c){var q=h[kB(a,c)&j],oe=q>>>4;if(c+=q&15,c>y){if(s)throw"unexpected EOF";break}if(!q)throw"invalid length/literal";if(oe<256)e[u++]=oe;else if(oe==256){ce=c,h=null;break}else{var T=oe-254;if(oe>264){var Y=oe-257,$=oM[Y];T=Sl(a,c,(1<<$)-1)+gM[Y],c+=$}var ae=A[kB(a,c)&Q],Ie=ae>>>4;if(!ae)throw"invalid distance";c+=ae&15;var F=fJ[Ie];if(Ie>3){var $=rM[Ie];F+=kB(a,c)&(1<<$)-1,c+=$}if(c>y){if(s)throw"unexpected EOF";break}i&&o(u+131072);for(var be=u+T;u<be;u+=4)e[u]=e[u-F],e[u+1]=e[u+1-F],e[u+2]=e[u+2-F],e[u+3]=e[u+3-F];u=be}}t.l=h,t.p=ce,t.b=u,h&&(l=1,t.m=f,t.d=A,t.n=p)}while(!l);return u==e.length?e:yJ(e,0,u)},GJ=new Tr(0),BJ=function(a){if((a[0]&15)!=8||a[0]>>>4>7||(a[0]<<8|a[1])%31)throw"invalid zlib data";if(a[1]&32)throw"invalid zlib data: preset dictionaries not supported"};function s0(a,e){return vJ((BJ(a),a.subarray(2,-4)),e)}var SJ=typeof TextDecoder<"u"&&new TextDecoder,xJ=0;try{SJ.decode(GJ,{stream:!0}),xJ=1}catch{}const ZJ=a=>a&&a.isCubeTexture;class wJ extends _i{constructor(e,t){var n,i;const s=ZJ(e),l=((i=s?(n=e.image[0])==null?void 0:n.width:e.image.width)!=null?i:1024)/4,c=Math.floor(Math.log2(l)),u=Math.pow(2,c),h=3*Math.max(u,112),A=4*u,f=[s?"#define ENVMAP_TYPE_CUBE":"",`#define CUBEUV_TEXEL_WIDTH ${1/h}`,`#define CUBEUV_TEXEL_HEIGHT ${1/A}`,`#define CUBEUV_MAX_MIP ${c}.0`],p=`
        varying vec3 vWorldPosition;
        void main() 
        {
            vec4 worldPosition = ( modelMatrix * vec4( position, 1.0 ) );
            vWorldPosition = worldPosition.xyz;
            
            gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
        }
        `,y=f.join(`
`)+`
        #define ENVMAP_TYPE_CUBE_UV
        varying vec3 vWorldPosition;
        uniform float radius;
        uniform float height;
        uniform float angle;
        #ifdef ENVMAP_TYPE_CUBE
            uniform samplerCube map;
        #else
            uniform sampler2D map;
        #endif
        // From: https://www.shadertoy.com/view/4tsBD7
        float diskIntersectWithBackFaceCulling( vec3 ro, vec3 rd, vec3 c, vec3 n, float r ) 
        {
            float d = dot ( rd, n );
            
            if( d > 0.0 ) { return 1e6; }
            
            vec3  o = ro - c;
            float t = - dot( n, o ) / d;
            vec3  q = o + rd * t;
            
            return ( dot( q, q ) < r * r ) ? t : 1e6;
        }
        // From: https://www.iquilezles.org/www/articles/intersectors/intersectors.htm
        float sphereIntersect( vec3 ro, vec3 rd, vec3 ce, float ra ) 
        {
            vec3 oc = ro - ce;
            float b = dot( oc, rd );
            float c = dot( oc, oc ) - ra * ra;
            float h = b * b - c;
            
            if( h < 0.0 ) { return -1.0; }
            
            h = sqrt( h );
            
            return - b + h;
        }
        vec3 project() 
        {
            vec3 p = normalize( vWorldPosition );
            vec3 camPos = cameraPosition;
            camPos.y -= height;
            float intersection = sphereIntersect( camPos, p, vec3( 0.0 ), radius );
            if( intersection > 0.0 ) {
                
                vec3 h = vec3( 0.0, - height, 0.0 );
                float intersection2 = diskIntersectWithBackFaceCulling( camPos, p, h, vec3( 0.0, 1.0, 0.0 ), radius );
                p = ( camPos + min( intersection, intersection2 ) * p ) / radius;
            } else {
                p = vec3( 0.0, 1.0, 0.0 );
            }
            return p;
        }
        #include <common>
        #include <cube_uv_reflection_fragment>
        void main() 
        {
            vec3 projectedWorldPosition = project();
            
            #ifdef ENVMAP_TYPE_CUBE
                vec3 outcolor = textureCube( map, projectedWorldPosition ).rgb;
            #else
                vec3 direction = normalize( projectedWorldPosition );
                vec2 uv = equirectUv( direction );
                vec3 outcolor = texture2D( map, uv ).rgb;
            #endif
            gl_FragColor = vec4( outcolor, 1.0 );
            #include <tonemapping_fragment>
            #include <${Gv>=154?"colorspace_fragment":"encodings_fragment"}>
        }
        `,G={map:{value:e},height:{value:t?.height||15},radius:{value:t?.radius||100}},B=new Hm(1,16),S=new Ds({uniforms:G,fragmentShader:y,vertexShader:p,side:po});super(B,S)}set radius(e){this.material.uniforms.radius.value=e}get radius(){return this.material.uniforms.radius.value}set height(e){this.material.uniforms.height.value=e}get height(){return this.material.uniforms.height.value}}var RJ=Object.defineProperty,NJ=(a,e,t)=>e in a?RJ(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,WJ=(a,e,t)=>(NJ(a,e+"",t),t);class VJ{constructor(){WJ(this,"_listeners")}addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const n=this._listeners;return n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const n=this._listeners[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,o=i.length;s<o;s++)i[s].call(this,e);e.target=null}}}var MJ=Object.defineProperty,_J=(a,e,t)=>e in a?MJ(a,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[e]=t,bn=(a,e,t)=>(_J(a,typeof e!="symbol"?e+"":e,t),t);const o0=new pI,k1=new yg,XJ=Math.cos(70*(Math.PI/180)),U1=(a,e)=>(a%e+e)%e;let YJ=class extends VJ{constructor(e,t){super(),bn(this,"object"),bn(this,"domElement"),bn(this,"enabled",!0),bn(this,"target",new ue),bn(this,"minDistance",0),bn(this,"maxDistance",1/0),bn(this,"minZoom",0),bn(this,"maxZoom",1/0),bn(this,"minPolarAngle",0),bn(this,"maxPolarAngle",Math.PI),bn(this,"minAzimuthAngle",-1/0),bn(this,"maxAzimuthAngle",1/0),bn(this,"enableDamping",!1),bn(this,"dampingFactor",.05),bn(this,"enableZoom",!0),bn(this,"zoomSpeed",1),bn(this,"enableRotate",!0),bn(this,"rotateSpeed",1),bn(this,"enablePan",!0),bn(this,"panSpeed",1),bn(this,"screenSpacePanning",!0),bn(this,"keyPanSpeed",7),bn(this,"zoomToCursor",!1),bn(this,"autoRotate",!1),bn(this,"autoRotateSpeed",2),bn(this,"reverseOrbit",!1),bn(this,"reverseHorizontalOrbit",!1),bn(this,"reverseVerticalOrbit",!1),bn(this,"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),bn(this,"mouseButtons",{LEFT:Dd.ROTATE,MIDDLE:Dd.DOLLY,RIGHT:Dd.PAN}),bn(this,"touches",{ONE:Od.ROTATE,TWO:Od.DOLLY_PAN}),bn(this,"target0"),bn(this,"position0"),bn(this,"zoom0"),bn(this,"_domElementKeyEvents",null),bn(this,"getPolarAngle"),bn(this,"getAzimuthalAngle"),bn(this,"setPolarAngle"),bn(this,"setAzimuthalAngle"),bn(this,"getDistance"),bn(this,"getZoomScale"),bn(this,"listenToKeyEvents"),bn(this,"stopListenToKeyEvents"),bn(this,"saveState"),bn(this,"reset"),bn(this,"update"),bn(this,"connect"),bn(this,"dispose"),bn(this,"dollyIn"),bn(this,"dollyOut"),bn(this,"getScale"),bn(this,"setScale"),this.object=e,this.domElement=t,this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=()=>h.phi,this.getAzimuthalAngle=()=>h.theta,this.setPolarAngle=he=>{let Ve=U1(he,2*Math.PI),Ct=h.phi;Ct<0&&(Ct+=2*Math.PI),Ve<0&&(Ve+=2*Math.PI);let ye=Math.abs(Ve-Ct);2*Math.PI-ye<ye&&(Ve<Ct?Ve+=2*Math.PI:Ct+=2*Math.PI),A.phi=Ve-Ct,n.update()},this.setAzimuthalAngle=he=>{let Ve=U1(he,2*Math.PI),Ct=h.theta;Ct<0&&(Ct+=2*Math.PI),Ve<0&&(Ve+=2*Math.PI);let ye=Math.abs(Ve-Ct);2*Math.PI-ye<ye&&(Ve<Ct?Ve+=2*Math.PI:Ct+=2*Math.PI),A.theta=Ve-Ct,n.update()},this.getDistance=()=>n.object.position.distanceTo(n.target),this.listenToKeyEvents=he=>{he.addEventListener("keydown",Me),this._domElementKeyEvents=he},this.stopListenToKeyEvents=()=>{this._domElementKeyEvents.removeEventListener("keydown",Me),this._domElementKeyEvents=null},this.saveState=()=>{n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=()=>{n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(i),n.update(),c=l.NONE},this.update=(()=>{const he=new ue,Ve=new ue(0,1,0),Ct=new xa().setFromUnitVectors(e.up,Ve),ye=Ct.clone().invert(),Re=new ue,lt=new xa,Kt=2*Math.PI;return function(){const qe=n.object.position;Ct.setFromUnitVectors(e.up,Ve),ye.copy(Ct).invert(),he.copy(qe).sub(n.target),he.applyQuaternion(Ct),h.setFromVector3(he),n.autoRotate&&c===l.NONE&&k(P()),n.enableDamping?(h.theta+=A.theta*n.dampingFactor,h.phi+=A.phi*n.dampingFactor):(h.theta+=A.theta,h.phi+=A.phi);let vt=n.minAzimuthAngle,Ut=n.maxAzimuthAngle;isFinite(vt)&&isFinite(Ut)&&(vt<-Math.PI?vt+=Kt:vt>Math.PI&&(vt-=Kt),Ut<-Math.PI?Ut+=Kt:Ut>Math.PI&&(Ut-=Kt),vt<=Ut?h.theta=Math.max(vt,Math.min(Ut,h.theta)):h.theta=h.theta>(vt+Ut)/2?Math.max(vt,h.theta):Math.min(Ut,h.theta)),h.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,h.phi)),h.makeSafe(),n.enableDamping===!0?n.target.addScaledVector(p,n.dampingFactor):n.target.add(p),n.zoomToCursor&&M||n.object.isOrthographicCamera?h.radius=ae(h.radius):h.radius=ae(h.radius*f),he.setFromSpherical(h),he.applyQuaternion(ye),qe.copy(n.target).add(he),n.object.matrixAutoUpdate||n.object.updateMatrix(),n.object.lookAt(n.target),n.enableDamping===!0?(A.theta*=1-n.dampingFactor,A.phi*=1-n.dampingFactor,p.multiplyScalar(1-n.dampingFactor)):(A.set(0,0,0),p.set(0,0,0));let Ot=!1;if(n.zoomToCursor&&M){let $t=null;if(n.object instanceof Ga&&n.object.isPerspectiveCamera){const Rn=he.length();$t=ae(Rn*f);const Kn=Rn-$t;n.object.position.addScaledVector(X,Kn),n.object.updateMatrixWorld()}else if(n.object.isOrthographicCamera){const Rn=new ue(Y.x,Y.y,0);Rn.unproject(n.object),n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix(),Ot=!0;const Kn=new ue(Y.x,Y.y,0);Kn.unproject(n.object),n.object.position.sub(Kn).add(Rn),n.object.updateMatrixWorld(),$t=he.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),n.zoomToCursor=!1;$t!==null&&(n.screenSpacePanning?n.target.set(0,0,-1).transformDirection(n.object.matrix).multiplyScalar($t).add(n.object.position):(o0.origin.copy(n.object.position),o0.direction.set(0,0,-1).transformDirection(n.object.matrix),Math.abs(n.object.up.dot(o0.direction))<XJ?e.lookAt(n.target):(k1.setFromNormalAndCoplanarPoint(n.object.up,n.target),o0.intersectPlane(k1,n.target))))}else n.object instanceof xc&&n.object.isOrthographicCamera&&(Ot=f!==1,Ot&&(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/f)),n.object.updateProjectionMatrix()));return f=1,M=!1,Ot||Re.distanceToSquared(n.object.position)>u||8*(1-lt.dot(n.object.quaternion))>u?(n.dispatchEvent(i),Re.copy(n.object.position),lt.copy(n.object.quaternion),Ot=!1,!0):!1}})(),this.connect=he=>{n.domElement=he,n.domElement.style.touchAction="none",n.domElement.addEventListener("contextmenu",Ht),n.domElement.addEventListener("pointerdown",st),n.domElement.addEventListener("pointercancel",z),n.domElement.addEventListener("wheel",He)},this.dispose=()=>{var he,Ve,Ct,ye,Re,lt;n.domElement&&(n.domElement.style.touchAction="auto"),(he=n.domElement)==null||he.removeEventListener("contextmenu",Ht),(Ve=n.domElement)==null||Ve.removeEventListener("pointerdown",st),(Ct=n.domElement)==null||Ct.removeEventListener("pointercancel",z),(ye=n.domElement)==null||ye.removeEventListener("wheel",He),(Re=n.domElement)==null||Re.ownerDocument.removeEventListener("pointermove",ie),(lt=n.domElement)==null||lt.ownerDocument.removeEventListener("pointerup",z),n._domElementKeyEvents!==null&&n._domElementKeyEvents.removeEventListener("keydown",Me)};const n=this,i={type:"change"},s={type:"start"},o={type:"end"},l={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=l.NONE;const u=1e-6,h=new V2,A=new V2;let f=1;const p=new ue,y=new yt,G=new yt,B=new yt,S=new yt,N=new yt,R=new yt,w=new yt,V=new yt,H=new yt,X=new ue,Y=new yt;let M=!1;const E=[],O={};function P(){return 2*Math.PI/60/60*n.autoRotateSpeed}function q(){return Math.pow(.95,n.zoomSpeed)}function k(he){n.reverseOrbit||n.reverseHorizontalOrbit?A.theta+=he:A.theta-=he}function le(he){n.reverseOrbit||n.reverseVerticalOrbit?A.phi+=he:A.phi-=he}const F=(()=>{const he=new ue;return function(Ct,ye){he.setFromMatrixColumn(ye,0),he.multiplyScalar(-Ct),p.add(he)}})(),j=(()=>{const he=new ue;return function(Ct,ye){n.screenSpacePanning===!0?he.setFromMatrixColumn(ye,1):(he.setFromMatrixColumn(ye,0),he.crossVectors(n.object.up,he)),he.multiplyScalar(Ct),p.add(he)}})(),Q=(()=>{const he=new ue;return function(Ct,ye){const Re=n.domElement;if(Re&&n.object instanceof Ga&&n.object.isPerspectiveCamera){const lt=n.object.position;he.copy(lt).sub(n.target);let Kt=he.length();Kt*=Math.tan(n.object.fov/2*Math.PI/180),F(2*Ct*Kt/Re.clientHeight,n.object.matrix),j(2*ye*Kt/Re.clientHeight,n.object.matrix)}else Re&&n.object instanceof xc&&n.object.isOrthographicCamera?(F(Ct*(n.object.right-n.object.left)/n.object.zoom/Re.clientWidth,n.object.matrix),j(ye*(n.object.top-n.object.bottom)/n.object.zoom/Re.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}})();function ce(he){n.object instanceof Ga&&n.object.isPerspectiveCamera||n.object instanceof xc&&n.object.isOrthographicCamera?f=he:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function oe(he){ce(f/he)}function T(he){ce(f*he)}function $(he){if(!n.zoomToCursor||!n.domElement)return;M=!0;const Ve=n.domElement.getBoundingClientRect(),Ct=he.clientX-Ve.left,ye=he.clientY-Ve.top,Re=Ve.width,lt=Ve.height;Y.x=Ct/Re*2-1,Y.y=-(ye/lt)*2+1,X.set(Y.x,Y.y,1).unproject(n.object).sub(n.object.position).normalize()}function ae(he){return Math.max(n.minDistance,Math.min(n.maxDistance,he))}function Ie(he){y.set(he.clientX,he.clientY)}function be(he){$(he),w.set(he.clientX,he.clientY)}function D(he){S.set(he.clientX,he.clientY)}function de(he){G.set(he.clientX,he.clientY),B.subVectors(G,y).multiplyScalar(n.rotateSpeed);const Ve=n.domElement;Ve&&(k(2*Math.PI*B.x/Ve.clientHeight),le(2*Math.PI*B.y/Ve.clientHeight)),y.copy(G),n.update()}function ee(he){V.set(he.clientX,he.clientY),H.subVectors(V,w),H.y>0?oe(q()):H.y<0&&T(q()),w.copy(V),n.update()}function Ce(he){N.set(he.clientX,he.clientY),R.subVectors(N,S).multiplyScalar(n.panSpeed),Q(R.x,R.y),S.copy(N),n.update()}function we(he){$(he),he.deltaY<0?T(q()):he.deltaY>0&&oe(q()),n.update()}function Ye(he){let Ve=!1;switch(he.code){case n.keys.UP:Q(0,n.keyPanSpeed),Ve=!0;break;case n.keys.BOTTOM:Q(0,-n.keyPanSpeed),Ve=!0;break;case n.keys.LEFT:Q(n.keyPanSpeed,0),Ve=!0;break;case n.keys.RIGHT:Q(-n.keyPanSpeed,0),Ve=!0;break}Ve&&(he.preventDefault(),n.update())}function Ee(){if(E.length==1)y.set(E[0].pageX,E[0].pageY);else{const he=.5*(E[0].pageX+E[1].pageX),Ve=.5*(E[0].pageY+E[1].pageY);y.set(he,Ve)}}function pt(){if(E.length==1)S.set(E[0].pageX,E[0].pageY);else{const he=.5*(E[0].pageX+E[1].pageX),Ve=.5*(E[0].pageY+E[1].pageY);S.set(he,Ve)}}function Ke(){const he=E[0].pageX-E[1].pageX,Ve=E[0].pageY-E[1].pageY,Ct=Math.sqrt(he*he+Ve*Ve);w.set(0,Ct)}function Qe(){n.enableZoom&&Ke(),n.enablePan&&pt()}function Le(){n.enableZoom&&Ke(),n.enableRotate&&Ee()}function dt(he){if(E.length==1)G.set(he.pageX,he.pageY);else{const Ct=ot(he),ye=.5*(he.pageX+Ct.x),Re=.5*(he.pageY+Ct.y);G.set(ye,Re)}B.subVectors(G,y).multiplyScalar(n.rotateSpeed);const Ve=n.domElement;Ve&&(k(2*Math.PI*B.x/Ve.clientHeight),le(2*Math.PI*B.y/Ve.clientHeight)),y.copy(G)}function se(he){if(E.length==1)N.set(he.pageX,he.pageY);else{const Ve=ot(he),Ct=.5*(he.pageX+Ve.x),ye=.5*(he.pageY+Ve.y);N.set(Ct,ye)}R.subVectors(N,S).multiplyScalar(n.panSpeed),Q(R.x,R.y),S.copy(N)}function ht(he){const Ve=ot(he),Ct=he.pageX-Ve.x,ye=he.pageY-Ve.y,Re=Math.sqrt(Ct*Ct+ye*ye);V.set(0,Re),H.set(0,Math.pow(V.y/w.y,n.zoomSpeed)),oe(H.y),w.copy(V)}function it(he){n.enableZoom&&ht(he),n.enablePan&&se(he)}function Fe(he){n.enableZoom&&ht(he),n.enableRotate&&dt(he)}function st(he){var Ve,Ct;n.enabled!==!1&&(E.length===0&&((Ve=n.domElement)==null||Ve.ownerDocument.addEventListener("pointermove",ie),(Ct=n.domElement)==null||Ct.ownerDocument.addEventListener("pointerup",z)),kt(he),he.pointerType==="touch"?It(he):Ae(he))}function ie(he){n.enabled!==!1&&(he.pointerType==="touch"?ft(he):Oe(he))}function z(he){var Ve,Ct,ye;Pe(he),E.length===0&&((Ve=n.domElement)==null||Ve.releasePointerCapture(he.pointerId),(Ct=n.domElement)==null||Ct.ownerDocument.removeEventListener("pointermove",ie),(ye=n.domElement)==null||ye.ownerDocument.removeEventListener("pointerup",z)),n.dispatchEvent(o),c=l.NONE}function Ae(he){let Ve;switch(he.button){case 0:Ve=n.mouseButtons.LEFT;break;case 1:Ve=n.mouseButtons.MIDDLE;break;case 2:Ve=n.mouseButtons.RIGHT;break;default:Ve=-1}switch(Ve){case Dd.DOLLY:if(n.enableZoom===!1)return;be(he),c=l.DOLLY;break;case Dd.ROTATE:if(he.ctrlKey||he.metaKey||he.shiftKey){if(n.enablePan===!1)return;D(he),c=l.PAN}else{if(n.enableRotate===!1)return;Ie(he),c=l.ROTATE}break;case Dd.PAN:if(he.ctrlKey||he.metaKey||he.shiftKey){if(n.enableRotate===!1)return;Ie(he),c=l.ROTATE}else{if(n.enablePan===!1)return;D(he),c=l.PAN}break;default:c=l.NONE}c!==l.NONE&&n.dispatchEvent(s)}function Oe(he){if(n.enabled!==!1)switch(c){case l.ROTATE:if(n.enableRotate===!1)return;de(he);break;case l.DOLLY:if(n.enableZoom===!1)return;ee(he);break;case l.PAN:if(n.enablePan===!1)return;Ce(he);break}}function He(he){n.enabled===!1||n.enableZoom===!1||c!==l.NONE&&c!==l.ROTATE||(he.preventDefault(),n.dispatchEvent(s),we(he),n.dispatchEvent(o))}function Me(he){n.enabled===!1||n.enablePan===!1||Ye(he)}function It(he){switch(je(he),E.length){case 1:switch(n.touches.ONE){case Od.ROTATE:if(n.enableRotate===!1)return;Ee(),c=l.TOUCH_ROTATE;break;case Od.PAN:if(n.enablePan===!1)return;pt(),c=l.TOUCH_PAN;break;default:c=l.NONE}break;case 2:switch(n.touches.TWO){case Od.DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;Qe(),c=l.TOUCH_DOLLY_PAN;break;case Od.DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Le(),c=l.TOUCH_DOLLY_ROTATE;break;default:c=l.NONE}break;default:c=l.NONE}c!==l.NONE&&n.dispatchEvent(s)}function ft(he){switch(je(he),c){case l.TOUCH_ROTATE:if(n.enableRotate===!1)return;dt(he),n.update();break;case l.TOUCH_PAN:if(n.enablePan===!1)return;se(he),n.update();break;case l.TOUCH_DOLLY_PAN:if(n.enableZoom===!1&&n.enablePan===!1)return;it(he),n.update();break;case l.TOUCH_DOLLY_ROTATE:if(n.enableZoom===!1&&n.enableRotate===!1)return;Fe(he),n.update();break;default:c=l.NONE}}function Ht(he){n.enabled!==!1&&he.preventDefault()}function kt(he){E.push(he)}function Pe(he){delete O[he.pointerId];for(let Ve=0;Ve<E.length;Ve++)if(E[Ve].pointerId==he.pointerId){E.splice(Ve,1);return}}function je(he){let Ve=O[he.pointerId];Ve===void 0&&(Ve=new yt,O[he.pointerId]=Ve),Ve.set(he.pageX,he.pageY)}function ot(he){const Ve=he.pointerId===E[0].pointerId?E[1]:E[0];return O[Ve.pointerId]}this.dollyIn=(he=q())=>{T(he),n.update()},this.dollyOut=(he=q())=>{oe(he),n.update()},this.getScale=()=>f,this.setScale=he=>{ce(he),n.update()},this.getZoomScale=()=>q(),t!==void 0&&this.connect(t),this.update()}};class HJ extends kS{constructor(e){super(e),this.type=Aa}parse(e){const o=function(Y,M){switch(Y){case 1:throw new Error("THREE.RGBELoader: Read Error: "+(M||""));case 2:throw new Error("THREE.RGBELoader: Write Error: "+(M||""));case 3:throw new Error("THREE.RGBELoader: Bad File Format: "+(M||""));default:case 4:throw new Error("THREE.RGBELoader: Memory Error: "+(M||""))}},A=function(Y,M,E){M=M||1024;let P=Y.pos,q=-1,k=0,le="",F=String.fromCharCode.apply(null,new Uint16Array(Y.subarray(P,P+128)));for(;0>(q=F.indexOf(`
`))&&k<M&&P<Y.byteLength;)le+=F,k+=F.length,P+=128,F+=String.fromCharCode.apply(null,new Uint16Array(Y.subarray(P,P+128)));return-1<q?(Y.pos+=k+q+1,le+F.slice(0,q)):!1},f=function(Y){const M=/^#\?(\S+)/,E=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,O=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,P=/^\s*FORMAT=(\S+)\s*$/,q=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,k={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let le,F;for((Y.pos>=Y.byteLength||!(le=A(Y)))&&o(1,"no header found"),(F=le.match(M))||o(3,"bad initial token"),k.valid|=1,k.programtype=F[1],k.string+=le+`
`;le=A(Y),le!==!1;){if(k.string+=le+`
`,le.charAt(0)==="#"){k.comments+=le+`
`;continue}if((F=le.match(E))&&(k.gamma=parseFloat(F[1])),(F=le.match(O))&&(k.exposure=parseFloat(F[1])),(F=le.match(P))&&(k.valid|=2,k.format=F[1]),(F=le.match(q))&&(k.valid|=4,k.height=parseInt(F[1],10),k.width=parseInt(F[2],10)),k.valid&2&&k.valid&4)break}return k.valid&2||o(3,"missing format specifier"),k.valid&4||o(3,"missing image size specifier"),k},p=function(Y,M,E){const O=M;if(O<8||O>32767||Y[0]!==2||Y[1]!==2||Y[2]&128)return new Uint8Array(Y);O!==(Y[2]<<8|Y[3])&&o(3,"wrong scanline width");const P=new Uint8Array(4*M*E);P.length||o(4,"unable to allocate buffer space");let q=0,k=0;const le=4*O,F=new Uint8Array(4),j=new Uint8Array(le);let Q=E;for(;Q>0&&k<Y.byteLength;){k+4>Y.byteLength&&o(1),F[0]=Y[k++],F[1]=Y[k++],F[2]=Y[k++],F[3]=Y[k++],(F[0]!=2||F[1]!=2||(F[2]<<8|F[3])!=O)&&o(3,"bad rgbe scanline format");let ce=0,oe;for(;ce<le&&k<Y.byteLength;){oe=Y[k++];const $=oe>128;if($&&(oe-=128),(oe===0||ce+oe>le)&&o(3,"bad scanline data"),$){const ae=Y[k++];for(let Ie=0;Ie<oe;Ie++)j[ce++]=ae}else j.set(Y.subarray(k,k+oe),ce),ce+=oe,k+=oe}const T=O;for(let $=0;$<T;$++){let ae=0;P[q]=j[$+ae],ae+=O,P[q+1]=j[$+ae],ae+=O,P[q+2]=j[$+ae],ae+=O,P[q+3]=j[$+ae],q+=4}Q--}return P},y=function(Y,M,E,O){const P=Y[M+3],q=Math.pow(2,P-128)/255;E[O+0]=Y[M+0]*q,E[O+1]=Y[M+1]*q,E[O+2]=Y[M+2]*q,E[O+3]=1},G=function(Y,M,E,O){const P=Y[M+3],q=Math.pow(2,P-128)/255;E[O+0]=sI.toHalfFloat(Math.min(Y[M+0]*q,65504)),E[O+1]=sI.toHalfFloat(Math.min(Y[M+1]*q,65504)),E[O+2]=sI.toHalfFloat(Math.min(Y[M+2]*q,65504)),E[O+3]=sI.toHalfFloat(1)},B=new Uint8Array(e);B.pos=0;const S=f(B),N=S.width,R=S.height,w=p(B.subarray(B.pos),N,R);let V,H,X;switch(this.type){case $i:X=w.length/4;const Y=new Float32Array(X*4);for(let E=0;E<X;E++)y(w,E*4,Y,E*4);V=Y,H=$i;break;case Aa:X=w.length/4;const M=new Uint16Array(X*4);for(let E=0;E<X;E++)G(w,E*4,M,E*4);V=M,H=Aa;break;default:throw new Error("THREE.RGBELoader: Unsupported type: "+this.type)}return{width:N,height:R,data:V,header:S.string,gamma:S.gamma,exposure:S.exposure,type:H}}setDataType(e){return this.type=e,this}load(e,t,n,i){function s(o,l){switch(o.type){case $i:case Aa:"colorSpace"in o?o.colorSpace="srgb-linear":o.encoding=3e3,o.minFilter=Pn,o.magFilter=Pn,o.generateMipmaps=!1,o.flipY=!0;break}t&&t(o,l)}return super.load(e,s,n,i)}}const vf=Gv>=152;class EJ extends kS{constructor(e){super(e),this.type=Aa}parse(e){const M=Math.pow(2.7182818,2.2);function E(U,te){for(var pe=0,Ne=0;Ne<65536;++Ne)(Ne==0||U[Ne>>3]&1<<(Ne&7))&&(te[pe++]=Ne);for(var De=pe-1;pe<65536;)te[pe++]=0;return De}function O(U){for(var te=0;te<16384;te++)U[te]={},U[te].len=0,U[te].lit=0,U[te].p=null}const P={l:0,c:0,lc:0};function q(U,te,pe,Ne,De){for(;pe<U;)te=te<<8|ot(Ne,De),pe+=8;pe-=U,P.l=te>>pe&(1<<U)-1,P.c=te,P.lc=pe}const k=new Array(59);function le(U){for(var te=0;te<=58;++te)k[te]=0;for(var te=0;te<65537;++te)k[U[te]]+=1;for(var pe=0,te=58;te>0;--te){var Ne=pe+k[te]>>1;k[te]=pe,pe=Ne}for(var te=0;te<65537;++te){var De=U[te];De>0&&(U[te]=De|k[De]++<<6)}}function F(U,te,pe,Ne,De,ke,wt){for(var At=pe,bt=0,ct=0;De<=ke;De++){if(At.value-pe.value>Ne)return!1;q(6,bt,ct,U,At);var _t=P.l;if(bt=P.c,ct=P.lc,wt[De]=_t,_t==63){if(At.value-pe.value>Ne)throw"Something wrong with hufUnpackEncTable";q(8,bt,ct,U,At);var $e=P.l+6;if(bt=P.c,ct=P.lc,De+$e>ke+1)throw"Something wrong with hufUnpackEncTable";for(;$e--;)wt[De++]=0;De--}else if(_t>=59){var $e=_t-59+2;if(De+$e>ke+1)throw"Something wrong with hufUnpackEncTable";for(;$e--;)wt[De++]=0;De--}}le(wt)}function j(U){return U&63}function Q(U){return U>>6}function ce(U,te,pe,Ne){for(;te<=pe;te++){var De=Q(U[te]),ke=j(U[te]);if(De>>ke)throw"Invalid table entry";if(ke>14){var wt=Ne[De>>ke-14];if(wt.len)throw"Invalid table entry";if(wt.lit++,wt.p){var At=wt.p;wt.p=new Array(wt.lit);for(var bt=0;bt<wt.lit-1;++bt)wt.p[bt]=At[bt]}else wt.p=new Array(1);wt.p[wt.lit-1]=te}else if(ke)for(var ct=0,bt=1<<14-ke;bt>0;bt--){var wt=Ne[(De<<14-ke)+ct];if(wt.len||wt.p)throw"Invalid table entry";wt.len=ke,wt.lit=te,ct++}}return!0}const oe={c:0,lc:0};function T(U,te,pe,Ne){U=U<<8|ot(pe,Ne),te+=8,oe.c=U,oe.lc=te}const $={c:0,lc:0};function ae(U,te,pe,Ne,De,ke,wt,At,bt,ct){if(U==te){Ne<8&&(T(pe,Ne,De,wt),pe=oe.c,Ne=oe.lc),Ne-=8;var _t=pe>>Ne,_t=new Uint8Array([_t])[0];if(bt.value+_t>ct)return!1;for(var $e=At[bt.value-1];_t-- >0;)At[bt.value++]=$e}else if(bt.value<ct)At[bt.value++]=U;else return!1;$.c=pe,$.lc=Ne}function Ie(U){return U&65535}function be(U){var te=Ie(U);return te>32767?te-65536:te}const D={a:0,b:0};function de(U,te){var pe=be(U),Ne=be(te),De=Ne,ke=pe+(De&1)+(De>>1),wt=ke,At=ke-De;D.a=wt,D.b=At}function ee(U,te){var pe=Ie(U),Ne=Ie(te),De=pe-(Ne>>1)&65535,ke=Ne+De-32768&65535;D.a=ke,D.b=De}function Ce(U,te,pe,Ne,De,ke,wt){for(var At=wt<16384,bt=pe>De?De:pe,ct=1,_t;ct<=bt;)ct<<=1;for(ct>>=1,_t=ct,ct>>=1;ct>=1;){for(var $e=0,ne=$e+ke*(De-_t),ve=ke*ct,xe=ke*_t,We=Ne*ct,Ze=Ne*_t,St,Xt,Yt,xt;$e<=ne;$e+=xe){for(var Wt=$e,qt=$e+Ne*(pe-_t);Wt<=qt;Wt+=Ze){var Et=Wt+We,Tt=Wt+ve,fn=Tt+We;At?(de(U[Wt+te],U[Tt+te]),St=D.a,Yt=D.b,de(U[Et+te],U[fn+te]),Xt=D.a,xt=D.b,de(St,Xt),U[Wt+te]=D.a,U[Et+te]=D.b,de(Yt,xt),U[Tt+te]=D.a,U[fn+te]=D.b):(ee(U[Wt+te],U[Tt+te]),St=D.a,Yt=D.b,ee(U[Et+te],U[fn+te]),Xt=D.a,xt=D.b,ee(St,Xt),U[Wt+te]=D.a,U[Et+te]=D.b,ee(Yt,xt),U[Tt+te]=D.a,U[fn+te]=D.b)}if(pe&ct){var Tt=Wt+ve;At?de(U[Wt+te],U[Tt+te]):ee(U[Wt+te],U[Tt+te]),St=D.a,U[Tt+te]=D.b,U[Wt+te]=St}}if(De&ct)for(var Wt=$e,qt=$e+Ne*(pe-_t);Wt<=qt;Wt+=Ze){var Et=Wt+We;At?de(U[Wt+te],U[Et+te]):ee(U[Wt+te],U[Et+te]),St=D.a,U[Et+te]=D.b,U[Wt+te]=St}_t=ct,ct>>=1}return $e}function we(U,te,pe,Ne,De,ke,wt,At,bt,ct){for(var _t=0,$e=0,ne=At,ve=Math.trunc(De.value+(ke+7)/8);De.value<ve;)for(T(_t,$e,pe,De),_t=oe.c,$e=oe.lc;$e>=14;){var xe=_t>>$e-14&16383,We=te[xe];if(We.len)$e-=We.len,ae(We.lit,wt,_t,$e,pe,Ne,De,bt,ct,ne),_t=$.c,$e=$.lc;else{if(!We.p)throw"hufDecode issues";var Ze;for(Ze=0;Ze<We.lit;Ze++){for(var St=j(U[We.p[Ze]]);$e<St&&De.value<ve;)T(_t,$e,pe,De),_t=oe.c,$e=oe.lc;if($e>=St&&Q(U[We.p[Ze]])==(_t>>$e-St&(1<<St)-1)){$e-=St,ae(We.p[Ze],wt,_t,$e,pe,Ne,De,bt,ct,ne),_t=$.c,$e=$.lc;break}}if(Ze==We.lit)throw"hufDecode issues"}}var Xt=8-ke&7;for(_t>>=Xt,$e-=Xt;$e>0;){var We=te[_t<<14-$e&16383];if(We.len)$e-=We.len,ae(We.lit,wt,_t,$e,pe,Ne,De,bt,ct,ne),_t=$.c,$e=$.lc;else throw"hufDecode issues"}return!0}function Ye(U,te,pe,Ne,De,ke){var wt={value:0},At=pe.value,bt=je(te,pe),ct=je(te,pe);pe.value+=4;var _t=je(te,pe);if(pe.value+=4,bt<0||bt>=65537||ct<0||ct>=65537)throw"Something wrong with HUF_ENCSIZE";var $e=new Array(65537),ne=new Array(16384);O(ne);var ve=Ne-(pe.value-At);if(F(U,te,pe,ve,bt,ct,$e),_t>8*(Ne-(pe.value-At)))throw"Something wrong with hufUncompress";ce($e,bt,ct,ne),we($e,ne,U,te,pe,_t,ct,ke,De,wt)}function Ee(U,te,pe){for(var Ne=0;Ne<pe;++Ne)te[Ne]=U[te[Ne]]}function pt(U){for(var te=1;te<U.length;te++){var pe=U[te-1]+U[te]-128;U[te]=pe}}function Ke(U,te){for(var pe=0,Ne=Math.floor((U.length+1)/2),De=0,ke=U.length-1;!(De>ke||(te[De++]=U[pe++],De>ke));)te[De++]=U[Ne++]}function Qe(U){for(var te=U.byteLength,pe=new Array,Ne=0,De=new DataView(U);te>0;){var ke=De.getInt8(Ne++);if(ke<0){var wt=-ke;te-=wt+1;for(var At=0;At<wt;At++)pe.push(De.getUint8(Ne++))}else{var wt=ke;te-=2;for(var bt=De.getUint8(Ne++),At=0;At<wt+1;At++)pe.push(bt)}}return pe}function Le(U,te,pe,Ne,De,ke){var Et=new DataView(ke.buffer),wt=pe[U.idx[0]].width,At=pe[U.idx[0]].height,bt=3,ct=Math.floor(wt/8),_t=Math.ceil(wt/8),$e=Math.ceil(At/8),ne=wt-(_t-1)*8,ve=At-($e-1)*8,xe={value:0},We=new Array(bt),Ze=new Array(bt),St=new Array(bt),Xt=new Array(bt),Yt=new Array(bt);for(let sn=0;sn<bt;++sn)Yt[sn]=te[U.idx[sn]],We[sn]=sn<1?0:We[sn-1]+_t*$e,Ze[sn]=new Float32Array(64),St[sn]=new Uint16Array(64),Xt[sn]=new Uint16Array(_t*64);for(let sn=0;sn<$e;++sn){var xt=8;sn==$e-1&&(xt=ve);var Wt=8;for(let rn=0;rn<_t;++rn){rn==_t-1&&(Wt=ne);for(let jt=0;jt<bt;++jt)St[jt].fill(0),St[jt][0]=De[We[jt]++],dt(xe,Ne,St[jt]),se(St[jt],Ze[jt]),ht(Ze[jt]);it(Ze);for(let jt=0;jt<bt;++jt)Fe(Ze[jt],Xt[jt],rn*64)}let Jt=0;for(let rn=0;rn<bt;++rn){const jt=pe[U.idx[rn]].type;for(let ni=8*sn;ni<8*sn+xt;++ni){Jt=Yt[rn][ni];for(let Ei=0;Ei<ct;++Ei){const zn=Ei*64+(ni&7)*8;Et.setUint16(Jt+0*jt,Xt[rn][zn+0],!0),Et.setUint16(Jt+2*jt,Xt[rn][zn+1],!0),Et.setUint16(Jt+4*jt,Xt[rn][zn+2],!0),Et.setUint16(Jt+6*jt,Xt[rn][zn+3],!0),Et.setUint16(Jt+8*jt,Xt[rn][zn+4],!0),Et.setUint16(Jt+10*jt,Xt[rn][zn+5],!0),Et.setUint16(Jt+12*jt,Xt[rn][zn+6],!0),Et.setUint16(Jt+14*jt,Xt[rn][zn+7],!0),Jt+=16*jt}}if(ct!=_t)for(let ni=8*sn;ni<8*sn+xt;++ni){const Ei=Yt[rn][ni]+8*ct*2*jt,zn=ct*64+(ni&7)*8;for(let Xi=0;Xi<Wt;++Xi)Et.setUint16(Ei+Xi*2*jt,Xt[rn][zn+Xi],!0)}}}for(var qt=new Uint16Array(wt),Et=new DataView(ke.buffer),Tt=0;Tt<bt;++Tt){pe[U.idx[Tt]].decoded=!0;var fn=pe[U.idx[Tt]].type;if(pe[Tt].type==2)for(var Tn=0;Tn<At;++Tn){const sn=Yt[Tt][Tn];for(var yn=0;yn<wt;++yn)qt[yn]=Et.getUint16(sn+yn*2*fn,!0);for(var yn=0;yn<wt;++yn)Et.setFloat32(sn+yn*2*fn,Re(qt[yn]),!0)}}}function dt(U,te,pe){for(var Ne,De=1;De<64;)Ne=te[U.value],Ne==65280?De=64:Ne>>8==255?De+=Ne&255:(pe[De]=Ne,De++),U.value++}function se(U,te){te[0]=Re(U[0]),te[1]=Re(U[1]),te[2]=Re(U[5]),te[3]=Re(U[6]),te[4]=Re(U[14]),te[5]=Re(U[15]),te[6]=Re(U[27]),te[7]=Re(U[28]),te[8]=Re(U[2]),te[9]=Re(U[4]),te[10]=Re(U[7]),te[11]=Re(U[13]),te[12]=Re(U[16]),te[13]=Re(U[26]),te[14]=Re(U[29]),te[15]=Re(U[42]),te[16]=Re(U[3]),te[17]=Re(U[8]),te[18]=Re(U[12]),te[19]=Re(U[17]),te[20]=Re(U[25]),te[21]=Re(U[30]),te[22]=Re(U[41]),te[23]=Re(U[43]),te[24]=Re(U[9]),te[25]=Re(U[11]),te[26]=Re(U[18]),te[27]=Re(U[24]),te[28]=Re(U[31]),te[29]=Re(U[40]),te[30]=Re(U[44]),te[31]=Re(U[53]),te[32]=Re(U[10]),te[33]=Re(U[19]),te[34]=Re(U[23]),te[35]=Re(U[32]),te[36]=Re(U[39]),te[37]=Re(U[45]),te[38]=Re(U[52]),te[39]=Re(U[54]),te[40]=Re(U[20]),te[41]=Re(U[22]),te[42]=Re(U[33]),te[43]=Re(U[38]),te[44]=Re(U[46]),te[45]=Re(U[51]),te[46]=Re(U[55]),te[47]=Re(U[60]),te[48]=Re(U[21]),te[49]=Re(U[34]),te[50]=Re(U[37]),te[51]=Re(U[47]),te[52]=Re(U[50]),te[53]=Re(U[56]),te[54]=Re(U[59]),te[55]=Re(U[61]),te[56]=Re(U[35]),te[57]=Re(U[36]),te[58]=Re(U[48]),te[59]=Re(U[49]),te[60]=Re(U[57]),te[61]=Re(U[58]),te[62]=Re(U[62]),te[63]=Re(U[63])}function ht(U){const te=.5*Math.cos(.7853975),pe=.5*Math.cos(3.14159/16),Ne=.5*Math.cos(3.14159/8),De=.5*Math.cos(3*3.14159/16),ke=.5*Math.cos(5*3.14159/16),wt=.5*Math.cos(3*3.14159/8),At=.5*Math.cos(7*3.14159/16);for(var bt=new Array(4),ct=new Array(4),_t=new Array(4),$e=new Array(4),ne=0;ne<8;++ne){var ve=ne*8;bt[0]=Ne*U[ve+2],bt[1]=wt*U[ve+2],bt[2]=Ne*U[ve+6],bt[3]=wt*U[ve+6],ct[0]=pe*U[ve+1]+De*U[ve+3]+ke*U[ve+5]+At*U[ve+7],ct[1]=De*U[ve+1]-At*U[ve+3]-pe*U[ve+5]-ke*U[ve+7],ct[2]=ke*U[ve+1]-pe*U[ve+3]+At*U[ve+5]+De*U[ve+7],ct[3]=At*U[ve+1]-ke*U[ve+3]+De*U[ve+5]-pe*U[ve+7],_t[0]=te*(U[ve+0]+U[ve+4]),_t[3]=te*(U[ve+0]-U[ve+4]),_t[1]=bt[0]+bt[3],_t[2]=bt[1]-bt[2],$e[0]=_t[0]+_t[1],$e[1]=_t[3]+_t[2],$e[2]=_t[3]-_t[2],$e[3]=_t[0]-_t[1],U[ve+0]=$e[0]+ct[0],U[ve+1]=$e[1]+ct[1],U[ve+2]=$e[2]+ct[2],U[ve+3]=$e[3]+ct[3],U[ve+4]=$e[3]-ct[3],U[ve+5]=$e[2]-ct[2],U[ve+6]=$e[1]-ct[1],U[ve+7]=$e[0]-ct[0]}for(var xe=0;xe<8;++xe)bt[0]=Ne*U[16+xe],bt[1]=wt*U[16+xe],bt[2]=Ne*U[48+xe],bt[3]=wt*U[48+xe],ct[0]=pe*U[8+xe]+De*U[24+xe]+ke*U[40+xe]+At*U[56+xe],ct[1]=De*U[8+xe]-At*U[24+xe]-pe*U[40+xe]-ke*U[56+xe],ct[2]=ke*U[8+xe]-pe*U[24+xe]+At*U[40+xe]+De*U[56+xe],ct[3]=At*U[8+xe]-ke*U[24+xe]+De*U[40+xe]-pe*U[56+xe],_t[0]=te*(U[xe]+U[32+xe]),_t[3]=te*(U[xe]-U[32+xe]),_t[1]=bt[0]+bt[3],_t[2]=bt[1]-bt[2],$e[0]=_t[0]+_t[1],$e[1]=_t[3]+_t[2],$e[2]=_t[3]-_t[2],$e[3]=_t[0]-_t[1],U[0+xe]=$e[0]+ct[0],U[8+xe]=$e[1]+ct[1],U[16+xe]=$e[2]+ct[2],U[24+xe]=$e[3]+ct[3],U[32+xe]=$e[3]-ct[3],U[40+xe]=$e[2]-ct[2],U[48+xe]=$e[1]-ct[1],U[56+xe]=$e[0]-ct[0]}function it(U){for(var te=0;te<64;++te){var pe=U[0][te],Ne=U[1][te],De=U[2][te];U[0][te]=pe+1.5747*De,U[1][te]=pe-.1873*Ne-.4682*De,U[2][te]=pe+1.8556*Ne}}function Fe(U,te,pe){for(var Ne=0;Ne<64;++Ne)te[pe+Ne]=sI.toHalfFloat(st(U[Ne]))}function st(U){return U<=1?Math.sign(U)*Math.pow(Math.abs(U),2.2):Math.sign(U)*Math.pow(M,Math.abs(U)-1)}function ie(U){return new DataView(U.array.buffer,U.offset.value,U.size)}function z(U){var te=U.viewer.buffer.slice(U.offset.value,U.offset.value+U.size),pe=new Uint8Array(Qe(te)),Ne=new Uint8Array(pe.length);return pt(pe),Ke(pe,Ne),new DataView(Ne.buffer)}function Ae(U){var te=U.array.slice(U.offset.value,U.offset.value+U.size),pe=s0(te),Ne=new Uint8Array(pe.length);return pt(pe),Ke(pe,Ne),new DataView(Ne.buffer)}function Oe(U){for(var te=U.viewer,pe={value:U.offset.value},Ne=new Uint16Array(U.width*U.scanlineBlockSize*(U.channels*U.type)),De=new Uint8Array(8192),ke=0,wt=new Array(U.channels),At=0;At<U.channels;At++)wt[At]={},wt[At].start=ke,wt[At].end=wt[At].start,wt[At].nx=U.width,wt[At].ny=U.lines,wt[At].size=U.type,ke+=wt[At].nx*wt[At].ny*wt[At].size;var bt=lt(te,pe),ct=lt(te,pe);if(ct>=8192)throw"Something is wrong with PIZ_COMPRESSION BITMAP_SIZE";if(bt<=ct)for(var At=0;At<ct-bt+1;At++)De[At+bt]=he(te,pe);var _t=new Uint16Array(65536),$e=E(De,_t),ne=je(te,pe);Ye(U.array,te,pe,ne,Ne,ke);for(var At=0;At<U.channels;++At)for(var ve=wt[At],xe=0;xe<wt[At].size;++xe)Ce(Ne,ve.start+xe,ve.nx,ve.size,ve.ny,ve.nx*ve.size,$e);Ee(_t,Ne,ke);for(var We=0,Ze=new Uint8Array(Ne.buffer.byteLength),St=0;St<U.lines;St++)for(var Xt=0;Xt<U.channels;Xt++){var ve=wt[Xt],Yt=ve.nx*ve.size,xt=new Uint8Array(Ne.buffer,ve.end*2,Yt*2);Ze.set(xt,We),We+=Yt*2,ve.end+=Yt}return new DataView(Ze.buffer)}function He(U){var te=U.array.slice(U.offset.value,U.offset.value+U.size),pe=s0(te);const Ne=U.lines*U.channels*U.width,De=U.type==1?new Uint16Array(Ne):new Uint32Array(Ne);let ke=0,wt=0;const At=new Array(4);for(let bt=0;bt<U.lines;bt++)for(let ct=0;ct<U.channels;ct++){let _t=0;switch(U.type){case 1:At[0]=ke,At[1]=At[0]+U.width,ke=At[1]+U.width;for(let $e=0;$e<U.width;++$e){const ne=pe[At[0]++]<<8|pe[At[1]++];_t+=ne,De[wt]=_t,wt++}break;case 2:At[0]=ke,At[1]=At[0]+U.width,At[2]=At[1]+U.width,ke=At[2]+U.width;for(let $e=0;$e<U.width;++$e){const ne=pe[At[0]++]<<24|pe[At[1]++]<<16|pe[At[2]++]<<8;_t+=ne,De[wt]=_t,wt++}break}}return new DataView(De.buffer)}function Me(U){var te=U.viewer,pe={value:U.offset.value},Ne=new Uint8Array(U.width*U.lines*(U.channels*U.type*2)),De={version:Ve(te,pe),unknownUncompressedSize:Ve(te,pe),unknownCompressedSize:Ve(te,pe),acCompressedSize:Ve(te,pe),dcCompressedSize:Ve(te,pe),rleCompressedSize:Ve(te,pe),rleUncompressedSize:Ve(te,pe),rleRawSize:Ve(te,pe),totalAcUncompressedCount:Ve(te,pe),totalDcUncompressedCount:Ve(te,pe),acCompression:Ve(te,pe)};if(De.version<2)throw"EXRLoader.parse: "+Mt.compression+" version "+De.version+" is unsupported";for(var ke=new Array,wt=lt(te,pe)-2;wt>0;){var At=It(te.buffer,pe),bt=he(te,pe),ct=bt>>2&3,_t=(bt>>4)-1,$e=new Int8Array([_t])[0],ne=he(te,pe);ke.push({name:At,index:$e,type:ne,compression:ct}),wt-=At.length+3}for(var ve=Mt.channels,xe=new Array(U.channels),We=0;We<U.channels;++We){var Ze=xe[We]={},St=ve[We];Ze.name=St.name,Ze.compression=0,Ze.decoded=!1,Ze.type=St.pixelType,Ze.pLinear=St.pLinear,Ze.width=U.width,Ze.height=U.lines}for(var Xt={idx:new Array(3)},Yt=0;Yt<U.channels;++Yt)for(var Ze=xe[Yt],We=0;We<ke.length;++We){var xt=ke[We];Ze.name==xt.name&&(Ze.compression=xt.compression,xt.index>=0&&(Xt.idx[xt.index]=Yt),Ze.offset=Yt)}if(De.acCompressedSize>0)switch(De.acCompression){case 0:var Et=new Uint16Array(De.totalAcUncompressedCount);Ye(U.array,te,pe,De.acCompressedSize,Et,De.totalAcUncompressedCount);break;case 1:var Wt=U.array.slice(pe.value,pe.value+De.totalAcUncompressedCount),qt=s0(Wt),Et=new Uint16Array(qt.buffer);pe.value+=De.totalAcUncompressedCount;break}if(De.dcCompressedSize>0){var Tt={array:U.array,offset:pe,size:De.dcCompressedSize},fn=new Uint16Array(Ae(Tt).buffer);pe.value+=De.dcCompressedSize}if(De.rleRawSize>0){var Wt=U.array.slice(pe.value,pe.value+De.rleCompressedSize),qt=s0(Wt),Tn=Qe(qt.buffer);pe.value+=De.rleCompressedSize}for(var yn=0,sn=new Array(xe.length),We=0;We<sn.length;++We)sn[We]=new Array;for(var Jt=0;Jt<U.lines;++Jt)for(var rn=0;rn<xe.length;++rn)sn[rn].push(yn),yn+=xe[rn].width*U.type*2;Le(Xt,sn,xe,Et,fn,Ne);for(var We=0;We<xe.length;++We){var Ze=xe[We];if(!Ze.decoded)switch(Ze.compression){case 2:for(var jt=0,ni=0,Jt=0;Jt<U.lines;++Jt){for(var Ei=sn[We][jt],zn=0;zn<Ze.width;++zn){for(var Xi=0;Xi<2*Ze.type;++Xi)Ne[Ei++]=Tn[ni+Xi*Ze.width*Ze.height];ni++}jt++}break;default:throw"EXRLoader.parse: unsupported channel compression"}}return new DataView(Ne.buffer)}function It(U,te){for(var pe=new Uint8Array(U),Ne=0;pe[te.value+Ne]!=0;)Ne+=1;var De=new TextDecoder().decode(pe.slice(te.value,te.value+Ne));return te.value=te.value+Ne+1,De}function ft(U,te,pe){var Ne=new TextDecoder().decode(new Uint8Array(U).slice(te.value,te.value+pe));return te.value=te.value+pe,Ne}function Ht(U,te){var pe=Pe(U,te),Ne=je(U,te);return[pe,Ne]}function kt(U,te){var pe=je(U,te),Ne=je(U,te);return[pe,Ne]}function Pe(U,te){var pe=U.getInt32(te.value,!0);return te.value=te.value+4,pe}function je(U,te){var pe=U.getUint32(te.value,!0);return te.value=te.value+4,pe}function ot(U,te){var pe=U[te.value];return te.value=te.value+1,pe}function he(U,te){var pe=U.getUint8(te.value);return te.value=te.value+1,pe}const Ve=function(U,te){let pe;return"getBigInt64"in DataView.prototype?pe=Number(U.getBigInt64(te.value,!0)):pe=U.getUint32(te.value+4,!0)+Number(U.getUint32(te.value,!0)<<32),te.value+=8,pe};function Ct(U,te){var pe=U.getFloat32(te.value,!0);return te.value+=4,pe}function ye(U,te){return sI.toHalfFloat(Ct(U,te))}function Re(U){var te=(U&31744)>>10,pe=U&1023;return(U>>15?-1:1)*(te?te===31?pe?NaN:1/0:Math.pow(2,te-15)*(1+pe/1024):6103515625e-14*(pe/1024))}function lt(U,te){var pe=U.getUint16(te.value,!0);return te.value+=2,pe}function Kt(U,te){return Re(lt(U,te))}function gt(U,te,pe,Ne){for(var De=pe.value,ke=[];pe.value<De+Ne-1;){var wt=It(te,pe),At=Pe(U,pe),bt=he(U,pe);pe.value+=3;var ct=Pe(U,pe),_t=Pe(U,pe);ke.push({name:wt,pixelType:At,pLinear:bt,xSampling:ct,ySampling:_t})}return pe.value+=1,ke}function qe(U,te){var pe=Ct(U,te),Ne=Ct(U,te),De=Ct(U,te),ke=Ct(U,te),wt=Ct(U,te),At=Ct(U,te),bt=Ct(U,te),ct=Ct(U,te);return{redX:pe,redY:Ne,greenX:De,greenY:ke,blueX:wt,blueY:At,whiteX:bt,whiteY:ct}}function vt(U,te){var pe=["NO_COMPRESSION","RLE_COMPRESSION","ZIPS_COMPRESSION","ZIP_COMPRESSION","PIZ_COMPRESSION","PXR24_COMPRESSION","B44_COMPRESSION","B44A_COMPRESSION","DWAA_COMPRESSION","DWAB_COMPRESSION"],Ne=he(U,te);return pe[Ne]}function Ut(U,te){var pe=je(U,te),Ne=je(U,te),De=je(U,te),ke=je(U,te);return{xMin:pe,yMin:Ne,xMax:De,yMax:ke}}function Ot(U,te){var pe=["INCREASING_Y"],Ne=he(U,te);return pe[Ne]}function $t(U,te){var pe=Ct(U,te),Ne=Ct(U,te);return[pe,Ne]}function Rn(U,te){var pe=Ct(U,te),Ne=Ct(U,te),De=Ct(U,te);return[pe,Ne,De]}function Kn(U,te,pe,Ne,De){if(Ne==="string"||Ne==="stringvector"||Ne==="iccProfile")return ft(te,pe,De);if(Ne==="chlist")return gt(U,te,pe,De);if(Ne==="chromaticities")return qe(U,pe);if(Ne==="compression")return vt(U,pe);if(Ne==="box2i")return Ut(U,pe);if(Ne==="lineOrder")return Ot(U,pe);if(Ne==="float")return Ct(U,pe);if(Ne==="v2f")return $t(U,pe);if(Ne==="v3f")return Rn(U,pe);if(Ne==="int")return Pe(U,pe);if(Ne==="rational")return Ht(U,pe);if(Ne==="timecode")return kt(U,pe);if(Ne==="preview")return pe.value+=De,"skipped";pe.value+=De}function Ci(U,te,pe){const Ne={};if(U.getUint32(0,!0)!=20000630)throw"THREE.EXRLoader: provided file doesn't appear to be in OpenEXR format.";Ne.version=U.getUint8(4);const De=U.getUint8(5);Ne.spec={singleTile:!!(De&2),longName:!!(De&4),deepFormat:!!(De&8),multiPart:!!(De&16)},pe.value=8;for(var ke=!0;ke;){var wt=It(te,pe);if(wt==0)ke=!1;else{var At=It(te,pe),bt=je(U,pe),ct=Kn(U,te,pe,At,bt);ct===void 0?console.warn(`EXRLoader.parse: skipped unknown header attribute type '${At}'.`):Ne[wt]=ct}}if((De&-5)!=0)throw console.error("EXRHeader:",Ne),"THREE.EXRLoader: provided file is currently unsupported.";return Ne}function Ge(U,te,pe,Ne,De){const ke={size:0,viewer:te,array:pe,offset:Ne,width:U.dataWindow.xMax-U.dataWindow.xMin+1,height:U.dataWindow.yMax-U.dataWindow.yMin+1,channels:U.channels.length,bytesPerLine:null,lines:null,inputSize:null,type:U.channels[0].pixelType,uncompress:null,getter:null,format:null,[vf?"colorSpace":"encoding"]:null};switch(U.compression){case"NO_COMPRESSION":ke.lines=1,ke.uncompress=ie;break;case"RLE_COMPRESSION":ke.lines=1,ke.uncompress=z;break;case"ZIPS_COMPRESSION":ke.lines=1,ke.uncompress=Ae;break;case"ZIP_COMPRESSION":ke.lines=16,ke.uncompress=Ae;break;case"PIZ_COMPRESSION":ke.lines=32,ke.uncompress=Oe;break;case"PXR24_COMPRESSION":ke.lines=16,ke.uncompress=He;break;case"DWAA_COMPRESSION":ke.lines=32,ke.uncompress=Me;break;case"DWAB_COMPRESSION":ke.lines=256,ke.uncompress=Me;break;default:throw"EXRLoader.parse: "+U.compression+" is unsupported"}if(ke.scanlineBlockSize=ke.lines,ke.type==1)switch(De){case $i:ke.getter=Kt,ke.inputSize=2;break;case Aa:ke.getter=lt,ke.inputSize=2;break}else if(ke.type==2)switch(De){case $i:ke.getter=Ct,ke.inputSize=4;break;case Aa:ke.getter=ye,ke.inputSize=4}else throw"EXRLoader.parse: unsupported pixelType "+ke.type+" for "+U.compression+".";ke.blockCount=(U.dataWindow.yMax+1)/ke.scanlineBlockSize;for(var wt=0;wt<ke.blockCount;wt++)Ve(te,Ne);ke.outputChannels=ke.channels==3?4:ke.channels;const At=ke.width*ke.height*ke.outputChannels;switch(De){case $i:ke.byteArray=new Float32Array(At),ke.channels<ke.outputChannels&&ke.byteArray.fill(1,0,At);break;case Aa:ke.byteArray=new Uint16Array(At),ke.channels<ke.outputChannels&&ke.byteArray.fill(15360,0,At);break;default:console.error("THREE.EXRLoader: unsupported type: ",De);break}return ke.bytesPerLine=ke.width*ke.inputSize*ke.channels,ke.outputChannels==4?ke.format=Sa:ke.format=Wm,vf?ke.colorSpace="srgb-linear":ke.encoding=3e3,ke}const Xe=new DataView(e),Je=new Uint8Array(e),Zt={value:0},Mt=Ci(Xe,e,Zt),Gt=Ge(Mt,Xe,Je,Zt,this.type),Ft={value:0},Vt={R:0,G:1,B:2,A:3,Y:0};for(let U=0;U<Gt.height/Gt.scanlineBlockSize;U++){const te=je(Xe,Zt);Gt.size=je(Xe,Zt),Gt.lines=te+Gt.scanlineBlockSize>Gt.height?Gt.height-te:Gt.scanlineBlockSize;const Ne=Gt.size<Gt.lines*Gt.bytesPerLine?Gt.uncompress(Gt):ie(Gt);Zt.value+=Gt.size;for(let De=0;De<Gt.scanlineBlockSize;De++){const ke=De+U*Gt.scanlineBlockSize;if(ke>=Gt.height)break;for(let wt=0;wt<Gt.channels;wt++){const At=Vt[Mt.channels[wt].name];for(let bt=0;bt<Gt.width;bt++){Ft.value=(De*(Gt.channels*Gt.width)+wt*Gt.width+bt)*Gt.inputSize;const ct=(Gt.height-1-ke)*(Gt.width*Gt.outputChannels)+bt*Gt.outputChannels+At;Gt.byteArray[ct]=Gt.getter(Ne,Ft)}}}}return{header:Mt,width:Gt.width,height:Gt.height,data:Gt.byteArray,format:Gt.format,[vf?"colorSpace":"encoding"]:Gt[vf?"colorSpace":"encoding"],type:this.type}}setDataType(e){return this.type=e,this}load(e,t,n,i){function s(o,l){vf?o.colorSpace=l.colorSpace:o.encoding=l.encoding,o.minFilter=Pn,o.magFilter=Pn,o.generateMipmaps=!1,o.flipY=!1,t&&t(o,l)}return super.load(e,s,n,i)}}const D1=new Za,r0=new ue;class dx extends mv{constructor(){super(),this.isLineSegmentsGeometry=!0,this.type="LineSegmentsGeometry";const e=[-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],t=[-1,2,1,2,-1,1,1,1,-1,-1,1,-1,-1,-2,1,-2],n=[0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5];this.setIndex(n),this.setAttribute("position",new an(e,3)),this.setAttribute("uv",new an(t,2))}applyMatrix4(e){const t=this.attributes.instanceStart,n=this.attributes.instanceEnd;return t!==void 0&&(t.applyMatrix4(e),n.applyMatrix4(e),t.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}setPositions(e){let t;e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e));const n=new by(t,6,1);return this.setAttribute("instanceStart",new hr(n,3,0)),this.setAttribute("instanceEnd",new hr(n,3,3)),this.computeBoundingBox(),this.computeBoundingSphere(),this}setColors(e,t=3){let n;e instanceof Float32Array?n=e:Array.isArray(e)&&(n=new Float32Array(e));const i=new by(n,t*2,1);return this.setAttribute("instanceColorStart",new hr(i,t,0)),this.setAttribute("instanceColorEnd",new hr(i,t,t)),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new ES(e.geometry)),this}fromLineSegments(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Za);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;e!==void 0&&t!==void 0&&(this.boundingBox.setFromBufferAttribute(e),D1.setFromBufferAttribute(t),this.boundingBox.union(D1))}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Ha),this.boundingBox===null&&this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(e!==void 0&&t!==void 0){const n=this.boundingSphere.center;this.boundingBox.getCenter(n);let i=0;for(let s=0,o=e.count;s<o;s++)r0.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(r0)),r0.fromBufferAttribute(t,s),i=Math.max(i,n.distanceToSquared(r0));this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error("THREE.LineSegmentsGeometry.computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}toJSON(){}applyMatrix(e){return console.warn("THREE.LineSegmentsGeometry: applyMatrix() has been renamed to applyMatrix4()."),this.applyMatrix4(e)}}class dM extends dx{constructor(){super(),this.isLineGeometry=!0,this.type="LineGeometry"}setPositions(e){const t=e.length-3,n=new Float32Array(2*t);for(let i=0;i<t;i+=3)n[2*i]=e[i],n[2*i+1]=e[i+1],n[2*i+2]=e[i+2],n[2*i+3]=e[i+3],n[2*i+4]=e[i+4],n[2*i+5]=e[i+5];return super.setPositions(n),this}setColors(e,t=3){const n=e.length-t,i=new Float32Array(2*n);if(t===3)for(let s=0;s<n;s+=t)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5];else for(let s=0;s<n;s+=t)i[2*s]=e[s],i[2*s+1]=e[s+1],i[2*s+2]=e[s+2],i[2*s+3]=e[s+3],i[2*s+4]=e[s+4],i[2*s+5]=e[s+5],i[2*s+6]=e[s+6],i[2*s+7]=e[s+7];return super.setColors(i,t),this}fromLine(e){const t=e.geometry;return this.setPositions(t.attributes.position.array),this}}class Ix extends Ds{constructor(e){super({type:"LineMaterial",uniforms:Im.clone(Im.merge([Pt.common,Pt.fog,{worldUnits:{value:1},linewidth:{value:1},resolution:{value:new yt(1,1)},dashOffset:{value:0},dashScale:{value:1},dashSize:{value:1},gapSize:{value:1}}])),vertexShader:`
				#include <common>
				#include <fog_pars_vertex>
				#include <logdepthbuf_pars_vertex>
				#include <clipping_planes_pars_vertex>

				uniform float linewidth;
				uniform vec2 resolution;

				attribute vec3 instanceStart;
				attribute vec3 instanceEnd;

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
						attribute vec4 instanceColorStart;
						attribute vec4 instanceColorEnd;
					#else
						varying vec3 vLineColor;
						attribute vec3 instanceColorStart;
						attribute vec3 instanceColorEnd;
					#endif
				#endif

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#ifdef USE_DASH

					uniform float dashScale;
					attribute float instanceDistanceStart;
					attribute float instanceDistanceEnd;
					varying float vLineDistance;

				#endif

				void trimSegment( const in vec4 start, inout vec4 end ) {

					// trim end segment so it terminates between the camera plane and the near plane

					// conservative estimate of the near plane
					float a = projectionMatrix[ 2 ][ 2 ]; // 3nd entry in 3th column
					float b = projectionMatrix[ 3 ][ 2 ]; // 3nd entry in 4th column
					float nearEstimate = - 0.5 * b / a;

					float alpha = ( nearEstimate - start.z ) / ( end.z - start.z );

					end.xyz = mix( start.xyz, end.xyz, alpha );

				}

				void main() {

					#ifdef USE_COLOR

						vLineColor = ( position.y < 0.5 ) ? instanceColorStart : instanceColorEnd;

					#endif

					#ifdef USE_DASH

						vLineDistance = ( position.y < 0.5 ) ? dashScale * instanceDistanceStart : dashScale * instanceDistanceEnd;
						vUv = uv;

					#endif

					float aspect = resolution.x / resolution.y;

					// camera space
					vec4 start = modelViewMatrix * vec4( instanceStart, 1.0 );
					vec4 end = modelViewMatrix * vec4( instanceEnd, 1.0 );

					#ifdef WORLD_UNITS

						worldStart = start.xyz;
						worldEnd = end.xyz;

					#else

						vUv = uv;

					#endif

					// special case for perspective projection, and segments that terminate either in, or behind, the camera plane
					// clearly the gpu firmware has a way of addressing this issue when projecting into ndc space
					// but we need to perform ndc-space calculations in the shader, so we must address this issue directly
					// perhaps there is a more elegant solution -- WestLangley

					bool perspective = ( projectionMatrix[ 2 ][ 3 ] == - 1.0 ); // 4th entry in the 3rd column

					if ( perspective ) {

						if ( start.z < 0.0 && end.z >= 0.0 ) {

							trimSegment( start, end );

						} else if ( end.z < 0.0 && start.z >= 0.0 ) {

							trimSegment( end, start );

						}

					}

					// clip space
					vec4 clipStart = projectionMatrix * start;
					vec4 clipEnd = projectionMatrix * end;

					// ndc space
					vec3 ndcStart = clipStart.xyz / clipStart.w;
					vec3 ndcEnd = clipEnd.xyz / clipEnd.w;

					// direction
					vec2 dir = ndcEnd.xy - ndcStart.xy;

					// account for clip-space aspect ratio
					dir.x *= aspect;
					dir = normalize( dir );

					#ifdef WORLD_UNITS

						// get the offset direction as perpendicular to the view vector
						vec3 worldDir = normalize( end.xyz - start.xyz );
						vec3 offset;
						if ( position.y < 0.5 ) {

							offset = normalize( cross( start.xyz, worldDir ) );

						} else {

							offset = normalize( cross( end.xyz, worldDir ) );

						}

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						float forwardOffset = dot( worldDir, vec3( 0.0, 0.0, 1.0 ) );

						// don't extend the line if we're rendering dashes because we
						// won't be rendering the endcaps
						#ifndef USE_DASH

							// extend the line bounds to encompass  endcaps
							start.xyz += - worldDir * linewidth * 0.5;
							end.xyz += worldDir * linewidth * 0.5;

							// shift the position of the quad so it hugs the forward edge of the line
							offset.xy -= dir * forwardOffset;
							offset.z += 0.5;

						#endif

						// endcaps
						if ( position.y > 1.0 || position.y < 0.0 ) {

							offset.xy += dir * 2.0 * forwardOffset;

						}

						// adjust for linewidth
						offset *= linewidth * 0.5;

						// set the world position
						worldPos = ( position.y < 0.5 ) ? start : end;
						worldPos.xyz += offset;

						// project the worldpos
						vec4 clip = projectionMatrix * worldPos;

						// shift the depth of the projected points so the line
						// segments overlap neatly
						vec3 clipPose = ( position.y < 0.5 ) ? ndcStart : ndcEnd;
						clip.z = clipPose.z * clip.w;

					#else

						vec2 offset = vec2( dir.y, - dir.x );
						// undo aspect ratio adjustment
						dir.x /= aspect;
						offset.x /= aspect;

						// sign flip
						if ( position.x < 0.0 ) offset *= - 1.0;

						// endcaps
						if ( position.y < 0.0 ) {

							offset += - dir;

						} else if ( position.y > 1.0 ) {

							offset += dir;

						}

						// adjust for linewidth
						offset *= linewidth;

						// adjust for clip-space to screen-space conversion // maybe resolution should be based on viewport ...
						offset /= resolution.y;

						// select end
						vec4 clip = ( position.y < 0.5 ) ? clipStart : clipEnd;

						// back to clip space
						offset *= clip.w;

						clip.xy += offset;

					#endif

					gl_Position = clip;

					vec4 mvPosition = ( position.y < 0.5 ) ? start : end; // this is an approximation

					#include <logdepthbuf_vertex>
					#include <clipping_planes_vertex>
					#include <fog_vertex>

				}
			`,fragmentShader:`
				uniform vec3 diffuse;
				uniform float opacity;
				uniform float linewidth;

				#ifdef USE_DASH

					uniform float dashOffset;
					uniform float dashSize;
					uniform float gapSize;

				#endif

				varying float vLineDistance;

				#ifdef WORLD_UNITS

					varying vec4 worldPos;
					varying vec3 worldStart;
					varying vec3 worldEnd;

					#ifdef USE_DASH

						varying vec2 vUv;

					#endif

				#else

					varying vec2 vUv;

				#endif

				#include <common>
				#include <fog_pars_fragment>
				#include <logdepthbuf_pars_fragment>
				#include <clipping_planes_pars_fragment>

				#ifdef USE_COLOR
					#ifdef USE_LINE_COLOR_ALPHA
						varying vec4 vLineColor;
					#else
						varying vec3 vLineColor;
					#endif
				#endif

				vec2 closestLineToLine(vec3 p1, vec3 p2, vec3 p3, vec3 p4) {

					float mua;
					float mub;

					vec3 p13 = p1 - p3;
					vec3 p43 = p4 - p3;

					vec3 p21 = p2 - p1;

					float d1343 = dot( p13, p43 );
					float d4321 = dot( p43, p21 );
					float d1321 = dot( p13, p21 );
					float d4343 = dot( p43, p43 );
					float d2121 = dot( p21, p21 );

					float denom = d2121 * d4343 - d4321 * d4321;

					float numer = d1343 * d4321 - d1321 * d4343;

					mua = numer / denom;
					mua = clamp( mua, 0.0, 1.0 );
					mub = ( d1343 + d4321 * ( mua ) ) / d4343;
					mub = clamp( mub, 0.0, 1.0 );

					return vec2( mua, mub );

				}

				void main() {

					#include <clipping_planes_fragment>

					#ifdef USE_DASH

						if ( vUv.y < - 1.0 || vUv.y > 1.0 ) discard; // discard endcaps

						if ( mod( vLineDistance + dashOffset, dashSize + gapSize ) > dashSize ) discard; // todo - FIX

					#endif

					float alpha = opacity;

					#ifdef WORLD_UNITS

						// Find the closest points on the view ray and the line segment
						vec3 rayEnd = normalize( worldPos.xyz ) * 1e5;
						vec3 lineDir = worldEnd - worldStart;
						vec2 params = closestLineToLine( worldStart, worldEnd, vec3( 0.0, 0.0, 0.0 ), rayEnd );

						vec3 p1 = worldStart + lineDir * params.x;
						vec3 p2 = rayEnd * params.y;
						vec3 delta = p1 - p2;
						float len = length( delta );
						float norm = len / linewidth;

						#ifndef USE_DASH

							#ifdef USE_ALPHA_TO_COVERAGE

								float dnorm = fwidth( norm );
								alpha = 1.0 - smoothstep( 0.5 - dnorm, 0.5 + dnorm, norm );

							#else

								if ( norm > 0.5 ) {

									discard;

								}

							#endif

						#endif

					#else

						#ifdef USE_ALPHA_TO_COVERAGE

							// artifacts appear on some hardware if a derivative is taken within a conditional
							float a = vUv.x;
							float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
							float len2 = a * a + b * b;
							float dlen = fwidth( len2 );

							if ( abs( vUv.y ) > 1.0 ) {

								alpha = 1.0 - smoothstep( 1.0 - dlen, 1.0 + dlen, len2 );

							}

						#else

							if ( abs( vUv.y ) > 1.0 ) {

								float a = vUv.x;
								float b = ( vUv.y > 0.0 ) ? vUv.y - 1.0 : vUv.y + 1.0;
								float len2 = a * a + b * b;

								if ( len2 > 1.0 ) discard;

							}

						#endif

					#endif

					vec4 diffuseColor = vec4( diffuse, alpha );
					#ifdef USE_COLOR
						#ifdef USE_LINE_COLOR_ALPHA
							diffuseColor *= vLineColor;
						#else
							diffuseColor.rgb *= vLineColor;
						#endif
					#endif

					#include <logdepthbuf_fragment>

					gl_FragColor = diffuseColor;

					#include <tonemapping_fragment>
					#include <${Gv>=154?"colorspace_fragment":"encodings_fragment"}>
					#include <fog_fragment>
					#include <premultiplied_alpha_fragment>

				}
			`,clipping:!0}),this.isLineMaterial=!0,this.onBeforeCompile=function(){this.transparent?this.defines.USE_LINE_COLOR_ALPHA="1":delete this.defines.USE_LINE_COLOR_ALPHA},Object.defineProperties(this,{color:{enumerable:!0,get:function(){return this.uniforms.diffuse.value},set:function(t){this.uniforms.diffuse.value=t}},worldUnits:{enumerable:!0,get:function(){return"WORLD_UNITS"in this.defines},set:function(t){t===!0?this.defines.WORLD_UNITS="":delete this.defines.WORLD_UNITS}},linewidth:{enumerable:!0,get:function(){return this.uniforms.linewidth.value},set:function(t){this.uniforms.linewidth.value=t}},dashed:{enumerable:!0,get:function(){return"USE_DASH"in this.defines},set(t){!!t!="USE_DASH"in this.defines&&(this.needsUpdate=!0),t===!0?this.defines.USE_DASH="":delete this.defines.USE_DASH}},dashScale:{enumerable:!0,get:function(){return this.uniforms.dashScale.value},set:function(t){this.uniforms.dashScale.value=t}},dashSize:{enumerable:!0,get:function(){return this.uniforms.dashSize.value},set:function(t){this.uniforms.dashSize.value=t}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},gapSize:{enumerable:!0,get:function(){return this.uniforms.gapSize.value},set:function(t){this.uniforms.gapSize.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},alphaToCoverage:{enumerable:!0,get:function(){return"USE_ALPHA_TO_COVERAGE"in this.defines},set:function(t){!!t!="USE_ALPHA_TO_COVERAGE"in this.defines&&(this.needsUpdate=!0),t===!0?(this.defines.USE_ALPHA_TO_COVERAGE="",this.extensions.derivatives=!0):(delete this.defines.USE_ALPHA_TO_COVERAGE,this.extensions.derivatives=!1)}}}),this.setValues(e)}}const UB=new ri,O1=new ue,j1=new ue,fs=new ri,ms=new ri,mc=new ri,DB=new ue,OB=new pn,vs=new a3,J1=new ue,l0=new Za,c0=new Ha,pc=new ri;let vc,uI;function P1(a,e,t){return pc.set(0,0,-e,1).applyMatrix4(a.projectionMatrix),pc.multiplyScalar(1/pc.w),pc.x=uI/t.width,pc.y=uI/t.height,pc.applyMatrix4(a.projectionMatrixInverse),pc.multiplyScalar(1/pc.w),Math.abs(Math.max(pc.x,pc.y))}function FJ(a,e){const t=a.matrixWorld,n=a.geometry,i=n.attributes.instanceStart,s=n.attributes.instanceEnd,o=Math.min(n.instanceCount,i.count);for(let l=0,c=o;l<c;l++){vs.start.fromBufferAttribute(i,l),vs.end.fromBufferAttribute(s,l),vs.applyMatrix4(t);const u=new ue,h=new ue;vc.distanceSqToSegment(vs.start,vs.end,h,u),h.distanceTo(u)<uI*.5&&e.push({point:h,pointOnLine:u,distance:vc.origin.distanceTo(h),object:a,face:null,faceIndex:l,uv:null,[sM]:null})}}function KJ(a,e,t){const n=e.projectionMatrix,s=a.material.resolution,o=a.matrixWorld,l=a.geometry,c=l.attributes.instanceStart,u=l.attributes.instanceEnd,h=Math.min(l.instanceCount,c.count),A=-e.near;vc.at(1,mc),mc.w=1,mc.applyMatrix4(e.matrixWorldInverse),mc.applyMatrix4(n),mc.multiplyScalar(1/mc.w),mc.x*=s.x/2,mc.y*=s.y/2,mc.z=0,DB.copy(mc),OB.multiplyMatrices(e.matrixWorldInverse,o);for(let f=0,p=h;f<p;f++){if(fs.fromBufferAttribute(c,f),ms.fromBufferAttribute(u,f),fs.w=1,ms.w=1,fs.applyMatrix4(OB),ms.applyMatrix4(OB),fs.z>A&&ms.z>A)continue;if(fs.z>A){const R=fs.z-ms.z,w=(fs.z-A)/R;fs.lerp(ms,w)}else if(ms.z>A){const R=ms.z-fs.z,w=(ms.z-A)/R;ms.lerp(fs,w)}fs.applyMatrix4(n),ms.applyMatrix4(n),fs.multiplyScalar(1/fs.w),ms.multiplyScalar(1/ms.w),fs.x*=s.x/2,fs.y*=s.y/2,ms.x*=s.x/2,ms.y*=s.y/2,vs.start.copy(fs),vs.start.z=0,vs.end.copy(ms),vs.end.z=0;const G=vs.closestPointToPointParameter(DB,!0);vs.at(G,J1);const B=cV.lerp(fs.z,ms.z,G),S=B>=-1&&B<=1,N=DB.distanceTo(J1)<uI*.5;if(S&&N){vs.start.fromBufferAttribute(c,f),vs.end.fromBufferAttribute(u,f),vs.start.applyMatrix4(o),vs.end.applyMatrix4(o);const R=new ue,w=new ue;vc.distanceSqToSegment(vs.start,vs.end,w,R),t.push({point:w,pointOnLine:R,distance:vc.origin.distanceTo(w),object:a,face:null,faceIndex:f,uv:null,[sM]:null})}}}class IM extends _i{constructor(e=new dx,t=new Ix({color:Math.random()*16777215})){super(e,t),this.isLineSegments2=!0,this.type="LineSegments2"}computeLineDistances(){const e=this.geometry,t=e.attributes.instanceStart,n=e.attributes.instanceEnd,i=new Float32Array(2*t.count);for(let o=0,l=0,c=t.count;o<c;o++,l+=2)O1.fromBufferAttribute(t,o),j1.fromBufferAttribute(n,o),i[l]=l===0?0:i[l-1],i[l+1]=i[l]+O1.distanceTo(j1);const s=new by(i,2,1);return e.setAttribute("instanceDistanceStart",new hr(s,1,0)),e.setAttribute("instanceDistanceEnd",new hr(s,1,1)),this}raycast(e,t){const n=this.material.worldUnits,i=e.camera;i===null&&!n&&console.error('LineSegments2: "Raycaster.camera" needs to be set in order to raycast against LineSegments2 while worldUnits is set to false.');const s=e.params.Line2!==void 0&&e.params.Line2.threshold||0;vc=e.ray;const o=this.matrixWorld,l=this.geometry,c=this.material;uI=c.linewidth+s,l.boundingSphere===null&&l.computeBoundingSphere(),c0.copy(l.boundingSphere).applyMatrix4(o);let u;if(n)u=uI*.5;else{const A=Math.max(i.near,c0.distanceToPoint(vc.origin));u=P1(i,A,c.resolution)}if(c0.radius+=u,vc.intersectsSphere(c0)===!1)return;l.boundingBox===null&&l.computeBoundingBox(),l0.copy(l.boundingBox).applyMatrix4(o);let h;if(n)h=uI*.5;else{const A=Math.max(i.near,l0.distanceToPoint(vc.origin));h=P1(i,A,c.resolution)}l0.expandByScalar(h),vc.intersectsBox(l0)!==!1&&(n?FJ(this,t):KJ(this,i,t))}onBeforeRender(e){const t=this.material.uniforms;t&&t.resolution&&(e.getViewport(UB),this.material.uniforms.resolution.value.set(UB.z,UB.w))}}class TJ extends IM{constructor(e=new dM,t=new Ix({color:Math.random()*16777215})){super(e,t),this.isLine2=!0,this.type="Line2"}}const zJ=J.forwardRef(function({points:e,color:t=16777215,vertexColors:n,linewidth:i,lineWidth:s,segments:o,dashed:l,...c},u){var h,A;const f=Gs(S=>S.size),p=J.useMemo(()=>o?new IM:new TJ,[o]),[y]=J.useState(()=>new Ix),G=(n==null||(h=n[0])==null?void 0:h.length)===4?4:3,B=J.useMemo(()=>{const S=o?new dx:new dM,N=e.map(R=>{const w=Array.isArray(R);return R instanceof ue||R instanceof ri?[R.x,R.y,R.z]:R instanceof yt?[R.x,R.y,0]:w&&R.length===3?[R[0],R[1],R[2]]:w&&R.length===2?[R[0],R[1],0]:R});if(S.setPositions(N.flat()),n){t=16777215;const R=n.map(w=>w instanceof tn?w.toArray():w);S.setColors(R.flat(),G)}return S},[e,o,n,G]);return J.useLayoutEffect(()=>{p.computeLineDistances()},[e,p]),J.useLayoutEffect(()=>{l?y.defines.USE_DASH="":delete y.defines.USE_DASH,y.needsUpdate=!0},[l,y]),J.useEffect(()=>()=>{B.dispose(),y.dispose()},[B]),J.createElement("primitive",Eu({object:p,ref:u},c),J.createElement("primitive",{object:B,attach:"geometry"}),J.createElement("primitive",Eu({object:y,attach:"material",color:t,vertexColors:!!n,resolution:[f.width,f.height],linewidth:(A=i??s)!==null&&A!==void 0?A:1,dashed:l,transparent:G===4},c)))});function LJ(){var a=Object.create(null);function e(i,s){var o=i.id,l=i.name,c=i.dependencies;c===void 0&&(c=[]);var u=i.init;u===void 0&&(u=function(){});var h=i.getTransferables;if(h===void 0&&(h=null),!a[o])try{c=c.map(function(f){return f&&f.isWorkerModule&&(e(f,function(p){if(p instanceof Error)throw p}),f=a[f.id].value),f}),u=n("<"+l+">.init",u),h&&(h=n("<"+l+">.getTransferables",h));var A=null;typeof u=="function"?A=u.apply(void 0,c):console.error("worker module init function failed to rehydrate"),a[o]={id:o,value:A,getTransferables:h},s(A)}catch(f){f&&f.noLog||console.error(f),s(f)}}function t(i,s){var o,l=i.id,c=i.args;(!a[l]||typeof a[l].value!="function")&&s(new Error("Worker module "+l+": not found or its 'init' did not return a function"));try{var u=(o=a[l]).value.apply(o,c);u&&typeof u.then=="function"?u.then(h,function(A){return s(A instanceof Error?A:new Error(""+A))}):h(u)}catch(A){s(A)}function h(A){try{var f=a[l].getTransferables&&a[l].getTransferables(A);(!f||!Array.isArray(f)||!f.length)&&(f=void 0),s(A,f)}catch(p){console.error(p),s(p)}}}function n(i,s){var o=void 0;self.troikaDefine=function(c){return o=c};var l=URL.createObjectURL(new Blob(["/** "+i.replace(/\*/g,"")+` **/

troikaDefine(
`+s+`
)`],{type:"application/javascript"}));try{importScripts(l)}catch(c){console.error(c)}return URL.revokeObjectURL(l),delete self.troikaDefine,o}self.addEventListener("message",function(i){var s=i.data,o=s.messageId,l=s.action,c=s.data;try{l==="registerModule"&&e(c,function(u){u instanceof Error?postMessage({messageId:o,success:!1,error:u.message}):postMessage({messageId:o,success:!0,result:{isCallable:typeof u=="function"}})}),l==="callModule"&&t(c,function(u,h){u instanceof Error?postMessage({messageId:o,success:!1,error:u.message}):postMessage({messageId:o,success:!0,result:u},h||void 0)})}catch(u){postMessage({messageId:o,success:!1,error:u.stack})}})}function kJ(a){var e=function(){for(var t=[],n=arguments.length;n--;)t[n]=arguments[n];return e._getInitResult().then(function(i){if(typeof i=="function")return i.apply(void 0,t);throw new Error("Worker module function was called but `init` did not return a callable function")})};return e._getInitResult=function(){var t=a.dependencies,n=a.init;t=Array.isArray(t)?t.map(function(s){return s&&(s=s.onMainThread||s,s._getInitResult&&(s=s._getInitResult())),s}):[];var i=Promise.all(t).then(function(s){return n.apply(null,s)});return e._getInitResult=function(){return i},i},e}var hM=function(){var a=!1;if(typeof window<"u"&&typeof window.document<"u")try{var e=new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"})));e.terminate(),a=!0}catch(t){console.log("Troika createWorkerModule: web workers not allowed; falling back to main thread execution. Cause: ["+t.message+"]")}return hM=function(){return a},a},UJ=0,DJ=0,jB=!1,Of=Object.create(null),jf=Object.create(null),D2=Object.create(null);function VC(a){if((!a||typeof a.init!="function")&&!jB)throw new Error("requires `options.init` function");var e=a.dependencies,t=a.init,n=a.getTransferables,i=a.workerId,s=kJ(a);i==null&&(i="#default");var o="workerModule"+ ++UJ,l=a.name||o,c=null;e=e&&e.map(function(h){return typeof h=="function"&&!h.workerModuleData&&(jB=!0,h=VC({workerId:i,name:"<"+l+"> function dependency: "+h.name,init:`function(){return (
`+v0(h)+`
)}`}),jB=!1),h&&h.workerModuleData&&(h=h.workerModuleData),h});function u(){for(var h=[],A=arguments.length;A--;)h[A]=arguments[A];if(!hM())return s.apply(void 0,h);if(!c){c=Q1(i,"registerModule",u.workerModuleData);var f=function(){c=null,jf[i].delete(f)};(jf[i]||(jf[i]=new Set)).add(f)}return c.then(function(p){var y=p.isCallable;if(y)return Q1(i,"callModule",{id:o,args:h});throw new Error("Worker module function was called but `init` did not return a callable function")})}return u.workerModuleData={isWorkerModule:!0,id:o,name:l,dependencies:e,init:v0(t),getTransferables:n&&v0(n)},u.onMainThread=s,u}function OJ(a){jf[a]&&jf[a].forEach(function(e){e()}),Of[a]&&(Of[a].terminate(),delete Of[a])}function v0(a){var e=a.toString();return!/^function/.test(e)&&/^\w+\s*\(/.test(e)&&(e="function "+e),e}function jJ(a){var e=Of[a];if(!e){var t=v0(LJ);e=Of[a]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+a.replace(/\*/g,"")+` **/

;(`+t+")()"],{type:"application/javascript"}))),e.onmessage=function(n){var i=n.data,s=i.messageId,o=D2[s];if(!o)throw new Error("WorkerModule response with empty or unknown messageId");delete D2[s],o(i)}}return e}function Q1(a,e,t){return new Promise(function(n,i){var s=++DJ;D2[s]=function(o){o.success?n(o.result):i(new Error("Error in worker "+e+" call: "+o.error))},jJ(a).postMessage({messageId:s,action:e,data:t})})}function CM(){var a=(function(e){function t(ce,oe,T,$,ae,Ie,be,D){var de=1-be;D.x=de*de*ce+2*de*be*T+be*be*ae,D.y=de*de*oe+2*de*be*$+be*be*Ie}function n(ce,oe,T,$,ae,Ie,be,D,de,ee){var Ce=1-de;ee.x=Ce*Ce*Ce*ce+3*Ce*Ce*de*T+3*Ce*de*de*ae+de*de*de*be,ee.y=Ce*Ce*Ce*oe+3*Ce*Ce*de*$+3*Ce*de*de*Ie+de*de*de*D}function i(ce,oe){for(var T=/([MLQCZ])([^MLQCZ]*)/g,$,ae,Ie,be,D;$=T.exec(ce);){var de=$[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map(function(ee){return parseFloat(ee)});switch($[1]){case"M":be=ae=de[0],D=Ie=de[1];break;case"L":(de[0]!==be||de[1]!==D)&&oe("L",be,D,be=de[0],D=de[1]);break;case"Q":{oe("Q",be,D,be=de[2],D=de[3],de[0],de[1]);break}case"C":{oe("C",be,D,be=de[4],D=de[5],de[0],de[1],de[2],de[3]);break}case"Z":(be!==ae||D!==Ie)&&oe("L",be,D,ae,Ie);break}}}function s(ce,oe,T){T===void 0&&(T=16);var $={x:0,y:0};i(ce,function(ae,Ie,be,D,de,ee,Ce,we,Ye){switch(ae){case"L":oe(Ie,be,D,de);break;case"Q":{for(var Ee=Ie,pt=be,Ke=1;Ke<T;Ke++)t(Ie,be,ee,Ce,D,de,Ke/(T-1),$),oe(Ee,pt,$.x,$.y),Ee=$.x,pt=$.y;break}case"C":{for(var Qe=Ie,Le=be,dt=1;dt<T;dt++)n(Ie,be,ee,Ce,we,Ye,D,de,dt/(T-1),$),oe(Qe,Le,$.x,$.y),Qe=$.x,Le=$.y;break}}})}var o="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",l="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",c=new WeakMap,u={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function h(ce,oe){var T=ce.getContext?ce.getContext("webgl",u):ce,$=c.get(T);if(!$){let Qe=function(Fe){var st=Ie[Fe];if(!st&&(st=Ie[Fe]=T.getExtension(Fe),!st))throw new Error(Fe+" not supported");return st},Le=function(Fe,st){var ie=T.createShader(st);return T.shaderSource(ie,Fe),T.compileShader(ie),ie},dt=function(Fe,st,ie,z){if(!be[Fe]){var Ae={},Oe={},He=T.createProgram();T.attachShader(He,Le(st,T.VERTEX_SHADER)),T.attachShader(He,Le(ie,T.FRAGMENT_SHADER)),T.linkProgram(He),be[Fe]={program:He,transaction:function(It){T.useProgram(He),It({setUniform:function(Ht,kt){for(var Pe=[],je=arguments.length-2;je-- >0;)Pe[je]=arguments[je+2];var ot=Oe[kt]||(Oe[kt]=T.getUniformLocation(He,kt));T["uniform"+Ht].apply(T,[ot].concat(Pe))},setAttribute:function(Ht,kt,Pe,je,ot){var he=Ae[Ht];he||(he=Ae[Ht]={buf:T.createBuffer(),loc:T.getAttribLocation(He,Ht),data:null}),T.bindBuffer(T.ARRAY_BUFFER,he.buf),T.vertexAttribPointer(he.loc,kt,T.FLOAT,!1,0,0),T.enableVertexAttribArray(he.loc),ae?T.vertexAttribDivisor(he.loc,je):Qe("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(he.loc,je),ot!==he.data&&(T.bufferData(T.ARRAY_BUFFER,ot,Pe),he.data=ot)}})}}}be[Fe].transaction(z)},se=function(Fe,st){de++;try{T.activeTexture(T.TEXTURE0+de);var ie=D[Fe];ie||(ie=D[Fe]=T.createTexture(),T.bindTexture(T.TEXTURE_2D,ie),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MIN_FILTER,T.NEAREST),T.texParameteri(T.TEXTURE_2D,T.TEXTURE_MAG_FILTER,T.NEAREST)),T.bindTexture(T.TEXTURE_2D,ie),st(ie,de)}finally{de--}},ht=function(Fe,st,ie){var z=T.createFramebuffer();ee.push(z),T.bindFramebuffer(T.FRAMEBUFFER,z),T.activeTexture(T.TEXTURE0+st),T.bindTexture(T.TEXTURE_2D,Fe),T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_2D,Fe,0);try{ie(z)}finally{T.deleteFramebuffer(z),T.bindFramebuffer(T.FRAMEBUFFER,ee[--ee.length-1]||null)}},it=function(){Ie={},be={},D={},de=-1,ee.length=0};var Ce=Qe,we=Le,Ye=dt,Ee=se,pt=ht,Ke=it,ae=typeof WebGL2RenderingContext<"u"&&T instanceof WebGL2RenderingContext,Ie={},be={},D={},de=-1,ee=[];T.canvas.addEventListener("webglcontextlost",function(Fe){it(),Fe.preventDefault()},!1),c.set(T,$={gl:T,isWebGL2:ae,getExtension:Qe,withProgram:dt,withTexture:se,withTextureFramebuffer:ht,handleContextLoss:it})}oe($)}function A(ce,oe,T,$,ae,Ie,be,D){be===void 0&&(be=15),D===void 0&&(D=null),h(ce,function(de){var ee=de.gl,Ce=de.withProgram,we=de.withTexture;we("copy",function(Ye,Ee){ee.texImage2D(ee.TEXTURE_2D,0,ee.RGBA,ae,Ie,0,ee.RGBA,ee.UNSIGNED_BYTE,oe),Ce("copy",o,l,function(pt){var Ke=pt.setUniform,Qe=pt.setAttribute;Qe("aUV",2,ee.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),Ke("1i","image",Ee),ee.bindFramebuffer(ee.FRAMEBUFFER,D||null),ee.disable(ee.BLEND),ee.colorMask(be&8,be&4,be&2,be&1),ee.viewport(T,$,ae,Ie),ee.scissor(T,$,ae,Ie),ee.drawArrays(ee.TRIANGLES,0,3)})})})}function f(ce,oe,T){var $=ce.width,ae=ce.height;h(ce,function(Ie){var be=Ie.gl,D=new Uint8Array($*ae*4);be.readPixels(0,0,$,ae,be.RGBA,be.UNSIGNED_BYTE,D),ce.width=oe,ce.height=T,A(be,D,0,0,$,ae)})}var p=Object.freeze({__proto__:null,withWebGLContext:h,renderImageData:A,resizeWebGLCanvasWithoutClearing:f});function y(ce,oe,T,$,ae,Ie){Ie===void 0&&(Ie=1);var be=new Uint8Array(ce*oe),D=$[2]-$[0],de=$[3]-$[1],ee=[];s(T,function(Qe,Le,dt,se){ee.push({x1:Qe,y1:Le,x2:dt,y2:se,minX:Math.min(Qe,dt),minY:Math.min(Le,se),maxX:Math.max(Qe,dt),maxY:Math.max(Le,se)})}),ee.sort(function(Qe,Le){return Qe.maxX-Le.maxX});for(var Ce=0;Ce<ce;Ce++)for(var we=0;we<oe;we++){var Ye=pt($[0]+D*(Ce+.5)/ce,$[1]+de*(we+.5)/oe),Ee=Math.pow(1-Math.abs(Ye)/ae,Ie)/2;Ye<0&&(Ee=1-Ee),Ee=Math.max(0,Math.min(255,Math.round(Ee*255))),be[we*ce+Ce]=Ee}return be;function pt(Qe,Le){for(var dt=1/0,se=1/0,ht=ee.length;ht--;){var it=ee[ht];if(it.maxX+se<=Qe)break;if(Qe+se>it.minX&&Le-se<it.maxY&&Le+se>it.minY){var Fe=S(Qe,Le,it.x1,it.y1,it.x2,it.y2);Fe<dt&&(dt=Fe,se=Math.sqrt(dt))}}return Ke(Qe,Le)&&(se=-se),se}function Ke(Qe,Le){for(var dt=0,se=ee.length;se--;){var ht=ee[se];if(ht.maxX<=Qe)break;var it=ht.y1>Le!=ht.y2>Le&&Qe<(ht.x2-ht.x1)*(Le-ht.y1)/(ht.y2-ht.y1)+ht.x1;it&&(dt+=ht.y1<ht.y2?1:-1)}return dt!==0}}function G(ce,oe,T,$,ae,Ie,be,D,de,ee){Ie===void 0&&(Ie=1),D===void 0&&(D=0),de===void 0&&(de=0),ee===void 0&&(ee=0),B(ce,oe,T,$,ae,Ie,be,null,D,de,ee)}function B(ce,oe,T,$,ae,Ie,be,D,de,ee,Ce){Ie===void 0&&(Ie=1),de===void 0&&(de=0),ee===void 0&&(ee=0),Ce===void 0&&(Ce=0);for(var we=y(ce,oe,T,$,ae,Ie),Ye=new Uint8Array(we.length*4),Ee=0;Ee<we.length;Ee++)Ye[Ee*4+Ce]=we[Ee];A(be,Ye,de,ee,ce,oe,1<<3-Ce,D)}function S(ce,oe,T,$,ae,Ie){var be=ae-T,D=Ie-$,de=be*be+D*D,ee=de?Math.max(0,Math.min(1,((ce-T)*be+(oe-$)*D)/de)):0,Ce=ce-(T+ee*be),we=oe-($+ee*D);return Ce*Ce+we*we}var N=Object.freeze({__proto__:null,generate:y,generateIntoCanvas:G,generateIntoFramebuffer:B}),R="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",w="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",V="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",H=new Float32Array([0,0,2,0,0,2]),X=null,Y=!1,M={},E=new WeakMap;function O(ce){if(!Y&&!le(ce))throw new Error("WebGL generation not supported")}function P(ce,oe,T,$,ae,Ie,be){if(Ie===void 0&&(Ie=1),be===void 0&&(be=null),!be&&(be=X,!be)){var D=typeof OffscreenCanvas=="function"?new OffscreenCanvas(1,1):typeof document<"u"?document.createElement("canvas"):null;if(!D)throw new Error("OffscreenCanvas or DOM canvas not supported");be=X=D.getContext("webgl",{depth:!1})}O(be);var de=new Uint8Array(ce*oe*4);h(be,function(Ye){var Ee=Ye.gl,pt=Ye.withTexture,Ke=Ye.withTextureFramebuffer;pt("readable",function(Qe,Le){Ee.texImage2D(Ee.TEXTURE_2D,0,Ee.RGBA,ce,oe,0,Ee.RGBA,Ee.UNSIGNED_BYTE,null),Ke(Qe,Le,function(dt){k(ce,oe,T,$,ae,Ie,Ee,dt,0,0,0),Ee.readPixels(0,0,ce,oe,Ee.RGBA,Ee.UNSIGNED_BYTE,de)})})});for(var ee=new Uint8Array(ce*oe),Ce=0,we=0;Ce<de.length;Ce+=4)ee[we++]=de[Ce];return ee}function q(ce,oe,T,$,ae,Ie,be,D,de,ee){Ie===void 0&&(Ie=1),D===void 0&&(D=0),de===void 0&&(de=0),ee===void 0&&(ee=0),k(ce,oe,T,$,ae,Ie,be,null,D,de,ee)}function k(ce,oe,T,$,ae,Ie,be,D,de,ee,Ce){Ie===void 0&&(Ie=1),de===void 0&&(de=0),ee===void 0&&(ee=0),Ce===void 0&&(Ce=0),O(be);var we=[];s(T,function(Ye,Ee,pt,Ke){we.push(Ye,Ee,pt,Ke)}),we=new Float32Array(we),h(be,function(Ye){var Ee=Ye.gl,pt=Ye.isWebGL2,Ke=Ye.getExtension,Qe=Ye.withProgram,Le=Ye.withTexture,dt=Ye.withTextureFramebuffer,se=Ye.handleContextLoss;if(Le("rawDistances",function(ht,it){(ce!==ht._lastWidth||oe!==ht._lastHeight)&&Ee.texImage2D(Ee.TEXTURE_2D,0,Ee.RGBA,ht._lastWidth=ce,ht._lastHeight=oe,0,Ee.RGBA,Ee.UNSIGNED_BYTE,null),Qe("main",R,w,function(Fe){var st=Fe.setAttribute,ie=Fe.setUniform,z=!pt&&Ke("ANGLE_instanced_arrays"),Ae=!pt&&Ke("EXT_blend_minmax");st("aUV",2,Ee.STATIC_DRAW,0,H),st("aLineSegment",4,Ee.DYNAMIC_DRAW,1,we),ie.apply(void 0,["4f","uGlyphBounds"].concat($)),ie("1f","uMaxDistance",ae),ie("1f","uExponent",Ie),dt(ht,it,function(Oe){Ee.enable(Ee.BLEND),Ee.colorMask(!0,!0,!0,!0),Ee.viewport(0,0,ce,oe),Ee.scissor(0,0,ce,oe),Ee.blendFunc(Ee.ONE,Ee.ONE),Ee.blendEquationSeparate(Ee.FUNC_ADD,pt?Ee.MAX:Ae.MAX_EXT),Ee.clear(Ee.COLOR_BUFFER_BIT),pt?Ee.drawArraysInstanced(Ee.TRIANGLES,0,3,we.length/4):z.drawArraysInstancedANGLE(Ee.TRIANGLES,0,3,we.length/4)})}),Qe("post",o,V,function(Fe){Fe.setAttribute("aUV",2,Ee.STATIC_DRAW,0,H),Fe.setUniform("1i","tex",it),Ee.bindFramebuffer(Ee.FRAMEBUFFER,D),Ee.disable(Ee.BLEND),Ee.colorMask(Ce===0,Ce===1,Ce===2,Ce===3),Ee.viewport(de,ee,ce,oe),Ee.scissor(de,ee,ce,oe),Ee.drawArrays(Ee.TRIANGLES,0,3)})}),Ee.isContextLost())throw se(),new Error("webgl context lost")})}function le(ce){var oe=!ce||ce===X?M:ce.canvas||ce,T=E.get(oe);if(T===void 0){Y=!0;var $=null;try{var ae=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],Ie=P(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,ce);T=Ie&&ae.length===Ie.length&&Ie.every(function(be,D){return be===ae[D]}),T||($="bad trial run results",console.info(ae,Ie))}catch(be){T=!1,$=be.message}$&&console.warn("WebGL SDF generation not supported:",$),Y=!1,E.set(oe,T)}return T}var F=Object.freeze({__proto__:null,generate:P,generateIntoCanvas:q,generateIntoFramebuffer:k,isSupported:le});function j(ce,oe,T,$,ae,Ie){ae===void 0&&(ae=Math.max($[2]-$[0],$[3]-$[1])/2),Ie===void 0&&(Ie=1);try{return P.apply(F,arguments)}catch(be){return console.info("WebGL SDF generation failed, falling back to JS",be),y.apply(N,arguments)}}function Q(ce,oe,T,$,ae,Ie,be,D,de,ee){ae===void 0&&(ae=Math.max($[2]-$[0],$[3]-$[1])/2),Ie===void 0&&(Ie=1),D===void 0&&(D=0),de===void 0&&(de=0),ee===void 0&&(ee=0);try{return q.apply(F,arguments)}catch(Ce){return console.info("WebGL SDF generation failed, falling back to JS",Ce),G.apply(N,arguments)}}return e.forEachPathCommand=i,e.generate=j,e.generateIntoCanvas=Q,e.javascript=N,e.pathToLineSegments=s,e.webgl=F,e.webglUtils=p,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return a}function JJ(){var a=(function(e){var t={R:"13k,1a,2,3,3,2+1j,ch+16,a+1,5+2,2+n,5,a,4,6+16,4+3,h+1b,4mo,179q,2+9,2+11,2i9+7y,2+68,4,3+4,5+13,4+3,2+4k,3+29,8+cf,1t+7z,w+17,3+3m,1t+3z,16o1+5r,8+30,8+mc,29+1r,29+4v,75+73",EN:"1c+9,3d+1,6,187+9,513,4+5,7+9,sf+j,175h+9,qw+q,161f+1d,4xt+a,25i+9",ES:"17,2,6dp+1,f+1,av,16vr,mx+1,4o,2",ET:"z+2,3h+3,b+1,ym,3e+1,2o,p4+1,8,6u,7c,g6,1wc,1n9+4,30+1b,2n,6d,qhx+1,h0m,a+1,49+2,63+1,4+1,6bb+3,12jj",AN:"16o+5,2j+9,2+1,35,ed,1ff2+9,87+u",CS:"18,2+1,b,2u,12k,55v,l,17v0,2,3,53,2+1,b",B:"a,3,f+2,2v,690",S:"9,2,k",WS:"c,k,4f4,1vk+a,u,1j,335",ON:"x+1,4+4,h+5,r+5,r+3,z,5+3,2+1,2+1,5,2+2,3+4,o,w,ci+1,8+d,3+d,6+8,2+g,39+1,9,6+1,2,33,b8,3+1,3c+1,7+1,5r,b,7h+3,sa+5,2,3i+6,jg+3,ur+9,2v,ij+1,9g+9,7+a,8m,4+1,49+x,14u,2+2,c+2,e+2,e+2,e+1,i+n,e+e,2+p,u+2,e+2,36+1,2+3,2+1,b,2+2,6+5,2,2,2,h+1,5+4,6+3,3+f,16+2,5+3l,3+81,1y+p,2+40,q+a,m+13,2r+ch,2+9e,75+hf,3+v,2+2w,6e+5,f+6,75+2a,1a+p,2+2g,d+5x,r+b,6+3,4+o,g,6+1,6+2,2k+1,4,2j,5h+z,1m+1,1e+f,t+2,1f+e,d+3,4o+3,2s+1,w,535+1r,h3l+1i,93+2,2s,b+1,3l+x,2v,4g+3,21+3,kz+1,g5v+1,5a,j+9,n+v,2,3,2+8,2+1,3+2,2,3,46+1,4+4,h+5,r+5,r+a,3h+2,4+6,b+4,78,1r+24,4+c,4,1hb,ey+6,103+j,16j+c,1ux+7,5+g,fsh,jdq+1t,4,57+2e,p1,1m,1m,1m,1m,4kt+1,7j+17,5+2r,d+e,3+e,2+e,2+10,m+4,w,1n+5,1q,4z+5,4b+rb,9+c,4+c,4+37,d+2g,8+b,l+b,5+1j,9+9,7+13,9+t,3+1,27+3c,2+29,2+3q,d+d,3+4,4+2,6+6,a+o,8+6,a+2,e+6,16+42,2+1i",BN:"0+8,6+d,2s+5,2+p,e,4m9,1kt+2,2b+5,5+5,17q9+v,7k,6p+8,6+1,119d+3,440+7,96s+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+1,1ekf+75,6p+2rz,1ben+1,1ekf+1,1ekf+1",NSM:"lc+33,7o+6,7c+18,2,2+1,2+1,2,21+a,1d+k,h,2u+6,3+5,3+1,2+3,10,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,g+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+g,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,k1+w,2db+2,3y,2p+v,ff+3,30+1,n9x+3,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,r2,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+5,3+1,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2d+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,f0c+4,1o+6,t5,1s+3,2a,f5l+1,43t+2,i+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,gzhy+6n",AL:"16w,3,2,e+1b,z+2,2+2s,g+1,8+1,b+m,2+t,s+2i,c+e,4h+f,1d+1e,1bwe+dp,3+3z,x+c,2+1,35+3y,2rm+z,5+7,b+5,dt+l,c+u,17nl+27,1t+27,4x+6n,3+d",LRO:"6ct",RLO:"6cu",LRE:"6cq",RLE:"6cr",PDF:"6cs",LRI:"6ee",RLI:"6ef",FSI:"6eg",PDI:"6eh"},n={},i={};n.L=1,i[1]="L",Object.keys(t).forEach(function(se,ht){n[se]=1<<ht+1,i[n[se]]=se}),Object.freeze(n);var s=n.LRI|n.RLI|n.FSI,o=n.L|n.R|n.AL,l=n.B|n.S|n.WS|n.ON|n.FSI|n.LRI|n.RLI|n.PDI,c=n.BN|n.RLE|n.LRE|n.RLO|n.LRO|n.PDF,u=n.S|n.WS|n.B|s|n.PDI|c,h=null;function A(){if(!h){h=new Map;var se=function(it){if(t.hasOwnProperty(it)){var Fe=0;t[it].split(",").forEach(function(st){var ie=st.split("+"),z=ie[0],Ae=ie[1];z=parseInt(z,36),Ae=Ae?parseInt(Ae,36):0,h.set(Fe+=z,n[it]);for(var Oe=0;Oe<Ae;Oe++)h.set(++Fe,n[it])})}};for(var ht in t)se(ht)}}function f(se){return A(),h.get(se.codePointAt(0))||n.L}function p(se){return i[f(se)]}var y={pairs:"14>1,1e>2,u>2,2wt>1,1>1,1ge>1,1wp>1,1j>1,f>1,hm>1,1>1,u>1,u6>1,1>1,+5,28>1,w>1,1>1,+3,b8>1,1>1,+3,1>3,-1>-1,3>1,1>1,+2,1s>1,1>1,x>1,th>1,1>1,+2,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,4q>1,1e>2,u>2,2>1,+1",canonical:"6f1>-6dx,6dy>-6dx,6ec>-6ed,6ee>-6ed,6ww>2jj,-2ji>2jj,14r4>-1e7l,1e7m>-1e7l,1e7m>-1e5c,1e5d>-1e5b,1e5c>-14qx,14qy>-14qx,14vn>-1ecg,1ech>-1ecg,1edu>-1ecg,1eci>-1ecg,1eda>-1ecg,1eci>-1ecg,1eci>-168q,168r>-168q,168s>-14ye,14yf>-14ye"};function G(se,ht){var it=36,Fe=0,st=new Map,ie=ht&&new Map,z;return se.split(",").forEach(function Ae(Oe){if(Oe.indexOf("+")!==-1)for(var He=+Oe;He--;)Ae(z);else{z=Oe;var Me=Oe.split(">"),It=Me[0],ft=Me[1];It=String.fromCodePoint(Fe+=parseInt(It,it)),ft=String.fromCodePoint(Fe+=parseInt(ft,it)),st.set(It,ft),ht&&ie.set(ft,It)}}),{map:st,reverseMap:ie}}var B,S,N;function R(){if(!B){var se=G(y.pairs,!0),ht=se.map,it=se.reverseMap;B=ht,S=it,N=G(y.canonical,!1).map}}function w(se){return R(),B.get(se)||null}function V(se){return R(),S.get(se)||null}function H(se){return R(),N.get(se)||null}var X=n.L,Y=n.R,M=n.EN,E=n.ES,O=n.ET,P=n.AN,q=n.CS,k=n.B,le=n.S,F=n.ON,j=n.BN,Q=n.NSM,ce=n.AL,oe=n.LRO,T=n.RLO,$=n.LRE,ae=n.RLE,Ie=n.PDF,be=n.LRI,D=n.RLI,de=n.FSI,ee=n.PDI;function Ce(se,ht){for(var it=125,Fe=new Uint32Array(se.length),st=0;st<se.length;st++)Fe[st]=f(se[st]);var ie=new Map;function z(Fa,xs){var la=Fe[Fa];Fe[Fa]=xs,ie.set(la,ie.get(la)-1),la&l&&ie.set(l,ie.get(l)-1),ie.set(xs,(ie.get(xs)||0)+1),xs&l&&ie.set(l,(ie.get(l)||0)+1)}for(var Ae=new Uint8Array(se.length),Oe=new Map,He=[],Me=null,It=0;It<se.length;It++)Me||He.push(Me={start:It,end:se.length-1,level:ht==="rtl"?1:ht==="ltr"?0:ku(It,!1)}),Fe[It]&k&&(Me.end=It,Me=null);for(var ft=ae|$|T|oe|s|ee|Ie|k,Ht=function(Fa){return Fa+(Fa&1?1:2)},kt=function(Fa){return Fa+(Fa&1?2:1)},Pe=0;Pe<He.length;Pe++){Me=He[Pe];var je=[{_level:Me.level,_override:0,_isolate:0}],ot=void 0,he=0,Ve=0,Ct=0;ie.clear();for(var ye=Me.start;ye<=Me.end;ye++){var Re=Fe[ye];if(ot=je[je.length-1],ie.set(Re,(ie.get(Re)||0)+1),Re&l&&ie.set(l,(ie.get(l)||0)+1),Re&ft)if(Re&(ae|$)){Ae[ye]=ot._level;var lt=(Re===ae?kt:Ht)(ot._level);lt<=it&&!he&&!Ve?je.push({_level:lt,_override:0,_isolate:0}):he||Ve++}else if(Re&(T|oe)){Ae[ye]=ot._level;var Kt=(Re===T?kt:Ht)(ot._level);Kt<=it&&!he&&!Ve?je.push({_level:Kt,_override:Re&T?Y:X,_isolate:0}):he||Ve++}else if(Re&s){Re&de&&(Re=ku(ye+1,!0)===1?D:be),Ae[ye]=ot._level,ot._override&&z(ye,ot._override);var gt=(Re===D?kt:Ht)(ot._level);gt<=it&&he===0&&Ve===0?(Ct++,je.push({_level:gt,_override:0,_isolate:1,_isolInitIndex:ye})):he++}else if(Re&ee){if(he>0)he--;else if(Ct>0){for(Ve=0;!je[je.length-1]._isolate;)je.pop();var qe=je[je.length-1]._isolInitIndex;qe!=null&&(Oe.set(qe,ye),Oe.set(ye,qe)),je.pop(),Ct--}ot=je[je.length-1],Ae[ye]=ot._level,ot._override&&z(ye,ot._override)}else Re&Ie?(he===0&&(Ve>0?Ve--:!ot._isolate&&je.length>1&&(je.pop(),ot=je[je.length-1])),Ae[ye]=ot._level):Re&k&&(Ae[ye]=Me.level);else Ae[ye]=ot._level,ot._override&&Re!==j&&z(ye,ot._override)}for(var vt=[],Ut=null,Ot=Me.start;Ot<=Me.end;Ot++){var $t=Fe[Ot];if(!($t&c)){var Rn=Ae[Ot],Kn=$t&s,Ci=$t===ee;Ut&&Rn===Ut._level?(Ut._end=Ot,Ut._endsWithIsolInit=Kn):vt.push(Ut={_start:Ot,_end:Ot,_level:Rn,_startsWithPDI:Ci,_endsWithIsolInit:Kn})}}for(var Ge=[],Xe=0;Xe<vt.length;Xe++){var Je=vt[Xe];if(!Je._startsWithPDI||Je._startsWithPDI&&!Oe.has(Je._start)){for(var Zt=[Ut=Je],Mt=void 0;Ut&&Ut._endsWithIsolInit&&(Mt=Oe.get(Ut._end))!=null;)for(var Gt=Xe+1;Gt<vt.length;Gt++)if(vt[Gt]._start===Mt){Zt.push(Ut=vt[Gt]);break}for(var Ft=[],Vt=0;Vt<Zt.length;Vt++)for(var U=Zt[Vt],te=U._start;te<=U._end;te++)Ft.push(te);for(var pe=Ae[Ft[0]],Ne=Me.level,De=Ft[0]-1;De>=0;De--)if(!(Fe[De]&c)){Ne=Ae[De];break}var ke=Ft[Ft.length-1],wt=Ae[ke],At=Me.level;if(!(Fe[ke]&s)){for(var bt=ke+1;bt<=Me.end;bt++)if(!(Fe[bt]&c)){At=Ae[bt];break}}Ge.push({_seqIndices:Ft,_sosType:Math.max(Ne,pe)%2?Y:X,_eosType:Math.max(At,wt)%2?Y:X})}}for(var ct=0;ct<Ge.length;ct++){var _t=Ge[ct],$e=_t._seqIndices,ne=_t._sosType,ve=_t._eosType,xe=Ae[$e[0]]&1?Y:X;if(ie.get(Q))for(var We=0;We<$e.length;We++){var Ze=$e[We];if(Fe[Ze]&Q){for(var St=ne,Xt=We-1;Xt>=0;Xt--)if(!(Fe[$e[Xt]]&c)){St=Fe[$e[Xt]];break}z(Ze,St&(s|ee)?F:St)}}if(ie.get(M))for(var Yt=0;Yt<$e.length;Yt++){var xt=$e[Yt];if(Fe[xt]&M)for(var Wt=Yt-1;Wt>=-1;Wt--){var qt=Wt===-1?ne:Fe[$e[Wt]];if(qt&o){qt===ce&&z(xt,P);break}}}if(ie.get(ce))for(var Et=0;Et<$e.length;Et++){var Tt=$e[Et];Fe[Tt]&ce&&z(Tt,Y)}if(ie.get(E)||ie.get(q))for(var fn=1;fn<$e.length-1;fn++){var Tn=$e[fn];if(Fe[Tn]&(E|q)){for(var yn=0,sn=0,Jt=fn-1;Jt>=0&&(yn=Fe[$e[Jt]],!!(yn&c));Jt--);for(var rn=fn+1;rn<$e.length&&(sn=Fe[$e[rn]],!!(sn&c));rn++);yn===sn&&(Fe[Tn]===E?yn===M:yn&(M|P))&&z(Tn,yn)}}if(ie.get(M))for(var jt=0;jt<$e.length;jt++){var ni=$e[jt];if(Fe[ni]&M){for(var Ei=jt-1;Ei>=0&&Fe[$e[Ei]]&(O|c);Ei--)z($e[Ei],M);for(jt++;jt<$e.length&&Fe[$e[jt]]&(O|c|M);jt++)Fe[$e[jt]]!==M&&z($e[jt],M)}}if(ie.get(O)||ie.get(E)||ie.get(q))for(var zn=0;zn<$e.length;zn++){var Xi=$e[zn];if(Fe[Xi]&(O|E|q)){z(Xi,F);for(var On=zn-1;On>=0&&Fe[$e[On]]&c;On--)z($e[On],F);for(var yi=zn+1;yi<$e.length&&Fe[$e[yi]]&c;yi++)z($e[yi],F)}}if(ie.get(M))for(var Yi=0,Fi=ne;Yi<$e.length;Yi++){var Ki=$e[Yi],ko=Fe[Ki];ko&M?Fi===X&&z(Ki,X):ko&o&&(Fi=ko)}if(ie.get(l)){var fa=Y|M|P,Lu=fa|X,Mc=[];{for(var So=[],Ea=0;Ea<$e.length;Ea++)if(Fe[$e[Ea]]&l){var Uo=se[$e[Ea]],_c=void 0;if(w(Uo)!==null)if(So.length<63)So.push({char:Uo,seqIndex:Ea});else break;else if((_c=V(Uo))!==null)for(var js=So.length-1;js>=0;js--){var xo=So[js].char;if(xo===_c||xo===V(H(Uo))||w(H(xo))===Uo){Mc.push([So[js].seqIndex,Ea]),So.length=js;break}}}Mc.sort(function(Fa,xs){return Fa[0]-xs[0]})}for(var Xc=0;Xc<Mc.length;Xc++){for(var Yc=Mc[Xc],Yl=Yc[0],Do=Yc[1],Js=!1,Pa=0,Jr=Yl+1;Jr<Do;Jr++){var Oo=$e[Jr];if(Fe[Oo]&Lu){Js=!0;var Hc=Fe[Oo]&fa?Y:X;if(Hc===xe){Pa=Hc;break}}}if(Js&&!Pa){Pa=ne;for(var Zo=Yl-1;Zo>=0;Zo--){var Ec=$e[Zo];if(Fe[Ec]&Lu){var pr=Fe[Ec]&fa?Y:X;pr!==xe?Pa=pr:Pa=xe;break}}}if(Pa){if(Fe[$e[Yl]]=Fe[$e[Do]]=Pa,Pa!==xe){for(var jo=Yl+1;jo<$e.length;jo++)if(!(Fe[$e[jo]]&c)){f(se[$e[jo]])&Q&&(Fe[$e[jo]]=Pa);break}}if(Pa!==xe){for(var Pr=Do+1;Pr<$e.length;Pr++)if(!(Fe[$e[Pr]]&c)){f(se[$e[Pr]])&Q&&(Fe[$e[Pr]]=Pa);break}}}}for(var Ri=0;Ri<$e.length;Ri++)if(Fe[$e[Ri]]&l){for(var Jo=Ri,Qr=Ri,rs=ne,br=Ri-1;br>=0;br--)if(Fe[$e[br]]&c)Jo=br;else{rs=Fe[$e[br]]&fa?Y:X;break}for(var Fc=ve,Po=Ri+1;Po<$e.length;Po++)if(Fe[$e[Po]]&(l|c))Qr=Po;else{Fc=Fe[$e[Po]]&fa?Y:X;break}for(var yr=Jo;yr<=Qr;yr++)Fe[$e[yr]]=rs===Fc?rs:xe;Ri=Qr}}}for(var ma=Me.start;ma<=Me.end;ma++){var GI=Ae[ma],ki=Fe[ma];if(GI&1?ki&(X|M|P)&&Ae[ma]++:ki&Y?Ae[ma]++:ki&(P|M)&&(Ae[ma]+=2),ki&c&&(Ae[ma]=ma===0?Me.level:Ae[ma-1]),ma===Me.end||f(se[ma])&(le|k))for(var Kc=ma;Kc>=0&&f(se[Kc])&u;Kc--)Ae[Kc]=Me.level}}return{levels:Ae,paragraphs:He};function ku(Fa,xs){for(var la=Fa;la<se.length;la++){var wo=Fe[la];if(wo&(Y|ce))return 1;if(wo&(k|X)||xs&&wo===ee)return 0;if(wo&s){var Uu=Vg(la);la=Uu===-1?se.length:Uu}}return 0}function Vg(Fa){for(var xs=1,la=Fa+1;la<se.length;la++){var wo=Fe[la];if(wo&k)break;if(wo&ee){if(--xs===0)return la}else wo&s&&xs++}return-1}}var we="14>1,j>2,t>2,u>2,1a>g,2v3>1,1>1,1ge>1,1wd>1,b>1,1j>1,f>1,ai>3,-2>3,+1,8>1k0,-1jq>1y7,-1y6>1hf,-1he>1h6,-1h5>1ha,-1h8>1qi,-1pu>1,6>3u,-3s>7,6>1,1>1,f>1,1>1,+2,3>1,1>1,+13,4>1,1>1,6>1eo,-1ee>1,3>1mg,-1me>1mk,-1mj>1mi,-1mg>1mi,-1md>1,1>1,+2,1>10k,-103>1,1>1,4>1,5>1,1>1,+10,3>1,1>8,-7>8,+1,-6>7,+1,a>1,1>1,u>1,u6>1,1>1,+5,26>1,1>1,2>1,2>2,8>1,7>1,4>1,1>1,+5,b8>1,1>1,+3,1>3,-2>1,2>1,1>1,+2,c>1,3>1,1>1,+2,h>1,3>1,a>1,1>1,2>1,3>1,1>1,d>1,f>1,3>1,1a>1,1>1,6>1,7>1,13>1,k>1,1>1,+19,4>1,1>1,+2,2>1,1>1,+18,m>1,a>1,1>1,lk>1,1>1,4>1,2>1,f>1,3>1,1>1,+3,db>1,1>1,+3,3>1,1>1,+2,14qm>1,1>1,+1,6>1,4j>1,j>2,t>2,u>2,2>1,+1",Ye;function Ee(){if(!Ye){var se=G(we,!0),ht=se.map,it=se.reverseMap;it.forEach(function(Fe,st){ht.set(st,Fe)}),Ye=ht}}function pt(se){return Ee(),Ye.get(se)||null}function Ke(se,ht,it,Fe){var st=se.length;it=Math.max(0,it==null?0:+it),Fe=Math.min(st-1,Fe==null?st-1:+Fe);for(var ie=new Map,z=it;z<=Fe;z++)if(ht[z]&1){var Ae=pt(se[z]);Ae!==null&&ie.set(z,Ae)}return ie}function Qe(se,ht,it,Fe){var st=se.length;it=Math.max(0,it==null?0:+it),Fe=Math.min(st-1,Fe==null?st-1:+Fe);var ie=[];return ht.paragraphs.forEach(function(z){var Ae=Math.max(it,z.start),Oe=Math.min(Fe,z.end);if(Ae<Oe){for(var He=ht.levels.slice(Ae,Oe+1),Me=Oe;Me>=Ae&&f(se[Me])&u;Me--)He[Me]=z.level;for(var It=z.level,ft=1/0,Ht=0;Ht<He.length;Ht++){var kt=He[Ht];kt>It&&(It=kt),kt<ft&&(ft=kt|1)}for(var Pe=It;Pe>=ft;Pe--)for(var je=0;je<He.length;je++)if(He[je]>=Pe){for(var ot=je;je+1<He.length&&He[je+1]>=Pe;)je++;je>ot&&ie.push([ot+Ae,je+Ae])}}}),ie}function Le(se,ht,it,Fe){var st=dt(se,ht,it,Fe),ie=[].concat(se);return st.forEach(function(z,Ae){ie[Ae]=(ht.levels[z]&1?pt(se[z]):null)||se[z]}),ie.join("")}function dt(se,ht,it,Fe){for(var st=Qe(se,ht,it,Fe),ie=[],z=0;z<se.length;z++)ie[z]=z;return st.forEach(function(Ae){for(var Oe=Ae[0],He=Ae[1],Me=ie.slice(Oe,He+1),It=Me.length;It--;)ie[He-It]=Me[It]}),ie}return e.closingToOpeningBracket=V,e.getBidiCharType=f,e.getBidiCharTypeName=p,e.getCanonicalBracket=H,e.getEmbeddingLevels=Ce,e.getMirroredCharacter=pt,e.getMirroredCharactersMap=Ke,e.getReorderSegments=Qe,e.getReorderedIndices=dt,e.getReorderedString=Le,e.openingToClosingBracket=w,Object.defineProperty(e,"__esModule",{value:!0}),e})({});return a}const AM=/\bvoid\s+main\s*\(\s*\)\s*{/g;function O2(a){const e=/^[ \t]*#include +<([\w\d./]+)>/gm;function t(n,i){let s=Yn[i];return s?O2(s):n}return a.replace(e,t)}const bs=[];for(let a=0;a<256;a++)bs[a]=(a<16?"0":"")+a.toString(16);function PJ(){const a=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(bs[a&255]+bs[a>>8&255]+bs[a>>16&255]+bs[a>>24&255]+"-"+bs[e&255]+bs[e>>8&255]+"-"+bs[e>>16&15|64]+bs[e>>24&255]+"-"+bs[t&63|128]+bs[t>>8&255]+"-"+bs[t>>16&255]+bs[t>>24&255]+bs[n&255]+bs[n>>8&255]+bs[n>>16&255]+bs[n>>24&255]).toUpperCase()}const Ld=Object.assign||function(){let a=arguments[0];for(let e=1,t=arguments.length;e<t;e++){let n=arguments[e];if(n)for(let i in n)Object.prototype.hasOwnProperty.call(n,i)&&(a[i]=n[i])}return a},QJ=Date.now(),q1=new WeakMap,$1=new Map;let qJ=1e10;function j2(a,e){const t=n4(e);let n=q1.get(a);if(n||q1.set(a,n=Object.create(null)),n[t])return new n[t];const i=`_onBeforeCompile${t}`,s=function(u,h){a.onBeforeCompile.call(this,u,h);const A=this.customProgramCacheKey()+"|"+u.vertexShader+"|"+u.fragmentShader;let f=$1[A];if(!f){const p=$J(this,u,e,t);f=$1[A]=p}u.vertexShader=f.vertexShader,u.fragmentShader=f.fragmentShader,Ld(u.uniforms,this.uniforms),e.timeUniform&&(u.uniforms[e.timeUniform]={get value(){return Date.now()-QJ}}),this[i]&&this[i](u)},o=function(){return l(e.chained?a:a.clone())},l=function(u){const h=Object.create(u,c);return Object.defineProperty(h,"baseMaterial",{value:a}),Object.defineProperty(h,"id",{value:qJ++}),h.uuid=PJ(),h.uniforms=Ld({},u.uniforms,e.uniforms),h.defines=Ld({},u.defines,e.defines),h.defines[`TROIKA_DERIVED_MATERIAL_${t}`]="",h.extensions=Ld({},u.extensions,e.extensions),h._listeners=void 0,h},c={constructor:{value:o},isDerivedMaterial:{value:!0},type:{get:()=>a.type,set:u=>{a.type=u}},isDerivedFrom:{writable:!0,configurable:!0,value:function(u){const h=this.baseMaterial;return u===h||h.isDerivedMaterial&&h.isDerivedFrom(u)||!1}},customProgramCacheKey:{writable:!0,configurable:!0,value:function(){return a.customProgramCacheKey()+"|"+t}},onBeforeCompile:{get(){return s},set(u){this[i]=u}},copy:{writable:!0,configurable:!0,value:function(u){return a.copy.call(this,u),!a.isShaderMaterial&&!a.isDerivedMaterial&&(Ld(this.extensions,u.extensions),Ld(this.defines,u.defines),Ld(this.uniforms,Im.clone(u.uniforms))),this}},clone:{writable:!0,configurable:!0,value:function(){const u=new a.constructor;return l(u).copy(this)}},getDepthMaterial:{writable:!0,configurable:!0,value:function(){let u=this._depthMaterial;return u||(u=this._depthMaterial=j2(a.isDerivedMaterial?a.getDepthMaterial():new Iv({depthPacking:QW}),e),u.defines.IS_DEPTH_MATERIAL="",u.uniforms=this.uniforms),u}},getDistanceMaterial:{writable:!0,configurable:!0,value:function(){let u=this._distanceMaterial;return u||(u=this._distanceMaterial=j2(a.isDerivedMaterial?a.getDistanceMaterial():new hv,e),u.defines.IS_DISTANCE_MATERIAL="",u.uniforms=this.uniforms),u}},dispose:{writable:!0,configurable:!0,value(){const{_depthMaterial:u,_distanceMaterial:h}=this;u&&u.dispose(),h&&h.dispose(),a.dispose.call(this)}}};return n[t]=o,new o}function $J(a,{vertexShader:e,fragmentShader:t},n,i){let{vertexDefs:s,vertexMainIntro:o,vertexMainOutro:l,vertexTransform:c,fragmentDefs:u,fragmentMainIntro:h,fragmentMainOutro:A,fragmentColorTransform:f,customRewriter:p,timeUniform:y}=n;if(s=s||"",o=o||"",l=l||"",u=u||"",h=h||"",A=A||"",(c||p)&&(e=O2(e)),(f||p)&&(t=t.replace(/^[ \t]*#include <((?:tonemapping|encodings|colorspace|fog|premultiplied_alpha|dithering)_fragment)>/gm,`
//!BEGIN_POST_CHUNK $1
$&
//!END_POST_CHUNK
`),t=O2(t)),p){let G=p({vertexShader:e,fragmentShader:t});e=G.vertexShader,t=G.fragmentShader}if(f){let G=[];t=t.replace(/^\/\/!BEGIN_POST_CHUNK[^]+?^\/\/!END_POST_CHUNK/gm,B=>(G.push(B),"")),A=`${f}
${G.join(`
`)}
${A}`}if(y){const G=`
uniform float ${y};
`;s=G+s,u=G+u}return c&&(e=`vec3 troika_position_${i};
vec3 troika_normal_${i};
vec2 troika_uv_${i};
${e}
`,s=`${s}
void troikaVertexTransform${i}(inout vec3 position, inout vec3 normal, inout vec2 uv) {
  ${c}
}
`,o=`
troika_position_${i} = vec3(position);
troika_normal_${i} = vec3(normal);
troika_uv_${i} = vec2(uv);
troikaVertexTransform${i}(troika_position_${i}, troika_normal_${i}, troika_uv_${i});
${o}
`,e=e.replace(/\b(position|normal|uv)\b/g,(G,B,S,N)=>/\battribute\s+vec[23]\s+$/.test(N.substr(0,S))?B:`troika_${B}_${i}`),a.map&&a.map.channel>0||(e=e.replace(/\bMAP_UV\b/g,`troika_uv_${i}`))),e=eN(e,i,s,o,l),t=eN(t,i,u,h,A),{vertexShader:e,fragmentShader:t}}function eN(a,e,t,n,i){return(n||i||t)&&(a=a.replace(AM,`
${t}
void troikaOrigMain${e}() {`),a+=`
void main() {
  ${n}
  troikaOrigMain${e}();
  ${i}
}`),a}function e4(a,e){return a==="uniforms"?void 0:typeof e=="function"?e.toString():e}let t4=0;const tN=new Map;function n4(a){const e=JSON.stringify(a,e4);let t=tN.get(e);return t==null&&tN.set(e,t=++t4),t}function i4(){return typeof window>"u"&&(self.window=self),(function(a){var e={parse:function(i){var s=e._bin,o=new Uint8Array(i);if(s.readASCII(o,0,4)=="ttcf"){var l=4;s.readUshort(o,l),l+=2,s.readUshort(o,l),l+=2;var c=s.readUint(o,l);l+=4;for(var u=[],h=0;h<c;h++){var A=s.readUint(o,l);l+=4,u.push(e._readFont(o,A))}return u}return[e._readFont(o,0)]},_readFont:function(i,s){var o=e._bin,l=s;o.readFixed(i,s),s+=4;var c=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2;for(var u=["cmap","head","hhea","maxp","hmtx","name","OS/2","post","loca","glyf","kern","CFF ","GDEF","GPOS","GSUB","SVG "],h={_data:i,_offset:l},A={},f=0;f<c;f++){var p=o.readASCII(i,s,4);s+=4,o.readUint(i,s),s+=4;var y=o.readUint(i,s);s+=4;var G=o.readUint(i,s);s+=4,A[p]={offset:y,length:G}}for(f=0;f<u.length;f++){var B=u[f];A[B]&&(h[B.trim()]=e[B.trim()].parse(i,A[B].offset,A[B].length,h))}return h},_tabOffset:function(i,s,o){for(var l=e._bin,c=l.readUshort(i,o+4),u=o+12,h=0;h<c;h++){var A=l.readASCII(i,u,4);u+=4,l.readUint(i,u),u+=4;var f=l.readUint(i,u);if(u+=4,l.readUint(i,u),u+=4,A==s)return f}return 0}};e._bin={readFixed:function(i,s){return(i[s]<<8|i[s+1])+(i[s+2]<<8|i[s+3])/65540},readF2dot14:function(i,s){return e._bin.readShort(i,s)/16384},readInt:function(i,s){return e._bin._view(i).getInt32(s)},readInt8:function(i,s){return e._bin._view(i).getInt8(s)},readShort:function(i,s){return e._bin._view(i).getInt16(s)},readUshort:function(i,s){return e._bin._view(i).getUint16(s)},readUshorts:function(i,s,o){for(var l=[],c=0;c<o;c++)l.push(e._bin.readUshort(i,s+2*c));return l},readUint:function(i,s){return e._bin._view(i).getUint32(s)},readUint64:function(i,s){return 4294967296*e._bin.readUint(i,s)+e._bin.readUint(i,s+4)},readASCII:function(i,s,o){for(var l="",c=0;c<o;c++)l+=String.fromCharCode(i[s+c]);return l},readUnicode:function(i,s,o){for(var l="",c=0;c<o;c++){var u=i[s++]<<8|i[s++];l+=String.fromCharCode(u)}return l},_tdec:typeof window<"u"&&window.TextDecoder?new window.TextDecoder:null,readUTF8:function(i,s,o){var l=e._bin._tdec;return l&&s==0&&o==i.length?l.decode(i):e._bin.readASCII(i,s,o)},readBytes:function(i,s,o){for(var l=[],c=0;c<o;c++)l.push(i[s+c]);return l},readASCIIArray:function(i,s,o){for(var l=[],c=0;c<o;c++)l.push(String.fromCharCode(i[s+c]));return l},_view:function(i){return i._dataView||(i._dataView=i.buffer?new DataView(i.buffer,i.byteOffset,i.byteLength):new DataView(new Uint8Array(i).buffer))}},e._lctf={},e._lctf.parse=function(i,s,o,l,c){var u=e._bin,h={},A=s;u.readFixed(i,s),s+=4;var f=u.readUshort(i,s);s+=2;var p=u.readUshort(i,s);s+=2;var y=u.readUshort(i,s);return s+=2,h.scriptList=e._lctf.readScriptList(i,A+f),h.featureList=e._lctf.readFeatureList(i,A+p),h.lookupList=e._lctf.readLookupList(i,A+y,c),h},e._lctf.readLookupList=function(i,s,o){var l=e._bin,c=s,u=[],h=l.readUshort(i,s);s+=2;for(var A=0;A<h;A++){var f=l.readUshort(i,s);s+=2;var p=e._lctf.readLookupTable(i,c+f,o);u.push(p)}return u},e._lctf.readLookupTable=function(i,s,o){var l=e._bin,c=s,u={tabs:[]};u.ltype=l.readUshort(i,s),s+=2,u.flag=l.readUshort(i,s),s+=2;var h=l.readUshort(i,s);s+=2;for(var A=u.ltype,f=0;f<h;f++){var p=l.readUshort(i,s);s+=2;var y=o(i,A,c+p,u);u.tabs.push(y)}return u},e._lctf.numOfOnes=function(i){for(var s=0,o=0;o<32;o++)(i>>>o&1)!=0&&s++;return s},e._lctf.readClassDef=function(i,s){var o=e._bin,l=[],c=o.readUshort(i,s);if(s+=2,c==1){var u=o.readUshort(i,s);s+=2;var h=o.readUshort(i,s);s+=2;for(var A=0;A<h;A++)l.push(u+A),l.push(u+A),l.push(o.readUshort(i,s)),s+=2}if(c==2){var f=o.readUshort(i,s);for(s+=2,A=0;A<f;A++)l.push(o.readUshort(i,s)),s+=2,l.push(o.readUshort(i,s)),s+=2,l.push(o.readUshort(i,s)),s+=2}return l},e._lctf.getInterval=function(i,s){for(var o=0;o<i.length;o+=3){var l=i[o],c=i[o+1];if(i[o+2],l<=s&&s<=c)return o}return-1},e._lctf.readCoverage=function(i,s){var o=e._bin,l={};l.fmt=o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);return s+=2,l.fmt==1&&(l.tab=o.readUshorts(i,s,c)),l.fmt==2&&(l.tab=o.readUshorts(i,s,3*c)),l},e._lctf.coverageIndex=function(i,s){var o=i.tab;if(i.fmt==1)return o.indexOf(s);if(i.fmt==2){var l=e._lctf.getInterval(o,s);if(l!=-1)return o[l+2]+(s-o[l])}return-1},e._lctf.readFeatureList=function(i,s){var o=e._bin,l=s,c=[],u=o.readUshort(i,s);s+=2;for(var h=0;h<u;h++){var A=o.readASCII(i,s,4);s+=4;var f=o.readUshort(i,s);s+=2;var p=e._lctf.readFeatureTable(i,l+f);p.tag=A.trim(),c.push(p)}return c},e._lctf.readFeatureTable=function(i,s){var o=e._bin,l=s,c={},u=o.readUshort(i,s);s+=2,u>0&&(c.featureParams=l+u);var h=o.readUshort(i,s);s+=2,c.tab=[];for(var A=0;A<h;A++)c.tab.push(o.readUshort(i,s+2*A));return c},e._lctf.readScriptList=function(i,s){var o=e._bin,l=s,c={},u=o.readUshort(i,s);s+=2;for(var h=0;h<u;h++){var A=o.readASCII(i,s,4);s+=4;var f=o.readUshort(i,s);s+=2,c[A.trim()]=e._lctf.readScriptTable(i,l+f)}return c},e._lctf.readScriptTable=function(i,s){var o=e._bin,l=s,c={},u=o.readUshort(i,s);s+=2,u>0&&(c.default=e._lctf.readLangSysTable(i,l+u));var h=o.readUshort(i,s);s+=2;for(var A=0;A<h;A++){var f=o.readASCII(i,s,4);s+=4;var p=o.readUshort(i,s);s+=2,c[f.trim()]=e._lctf.readLangSysTable(i,l+p)}return c},e._lctf.readLangSysTable=function(i,s){var o=e._bin,l={};o.readUshort(i,s),s+=2,l.reqFeature=o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);return s+=2,l.features=o.readUshorts(i,s,c),l},e.CFF={},e.CFF.parse=function(i,s,o){var l=e._bin;(i=new Uint8Array(i.buffer,s,o))[s=0],i[++s],i[++s],i[++s],s++;var c=[];s=e.CFF.readIndex(i,s,c);for(var u=[],h=0;h<c.length-1;h++)u.push(l.readASCII(i,s+c[h],c[h+1]-c[h]));s+=c[c.length-1];var A=[];s=e.CFF.readIndex(i,s,A);var f=[];for(h=0;h<A.length-1;h++)f.push(e.CFF.readDict(i,s+A[h],s+A[h+1]));s+=A[A.length-1];var p=f[0],y=[];s=e.CFF.readIndex(i,s,y);var G=[];for(h=0;h<y.length-1;h++)G.push(l.readASCII(i,s+y[h],y[h+1]-y[h]));if(s+=y[y.length-1],e.CFF.readSubrs(i,s,p),p.CharStrings){s=p.CharStrings,y=[],s=e.CFF.readIndex(i,s,y);var B=[];for(h=0;h<y.length-1;h++)B.push(l.readBytes(i,s+y[h],y[h+1]-y[h]));p.CharStrings=B}if(p.ROS){s=p.FDArray;var S=[];for(s=e.CFF.readIndex(i,s,S),p.FDArray=[],h=0;h<S.length-1;h++){var N=e.CFF.readDict(i,s+S[h],s+S[h+1]);e.CFF._readFDict(i,N,G),p.FDArray.push(N)}s+=S[S.length-1],s=p.FDSelect,p.FDSelect=[];var R=i[s];if(s++,R!=3)throw R;var w=l.readUshort(i,s);for(s+=2,h=0;h<w+1;h++)p.FDSelect.push(l.readUshort(i,s),i[s+2]),s+=3}return p.Encoding&&(p.Encoding=e.CFF.readEncoding(i,p.Encoding,p.CharStrings.length)),p.charset&&(p.charset=e.CFF.readCharset(i,p.charset,p.CharStrings.length)),e.CFF._readFDict(i,p,G),p},e.CFF._readFDict=function(i,s,o){var l;for(var c in s.Private&&(l=s.Private[1],s.Private=e.CFF.readDict(i,l,l+s.Private[0]),s.Private.Subrs&&e.CFF.readSubrs(i,l+s.Private.Subrs,s.Private)),s)["FamilyName","FontName","FullName","Notice","version","Copyright"].indexOf(c)!=-1&&(s[c]=o[s[c]-426+35])},e.CFF.readSubrs=function(i,s,o){var l=e._bin,c=[];s=e.CFF.readIndex(i,s,c);var u,h=c.length;u=h<1240?107:h<33900?1131:32768,o.Bias=u,o.Subrs=[];for(var A=0;A<c.length-1;A++)o.Subrs.push(l.readBytes(i,s+c[A],c[A+1]-c[A]))},e.CFF.tableSE=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,0,111,112,113,114,0,115,116,117,118,119,120,121,122,0,123,0,124,125,126,127,128,129,130,131,0,132,133,0,134,135,136,137,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,138,0,139,0,0,0,0,140,141,142,143,0,0,0,0,0,144,0,0,0,145,0,0,146,147,148,149,0,0,0,0],e.CFF.glyphByUnicode=function(i,s){for(var o=0;o<i.charset.length;o++)if(i.charset[o]==s)return o;return-1},e.CFF.glyphBySE=function(i,s){return s<0||s>255?-1:e.CFF.glyphByUnicode(i,e.CFF.tableSE[s])},e.CFF.readEncoding=function(i,s,o){e._bin;var l=[".notdef"],c=i[s];if(s++,c!=0)throw"error: unknown encoding format: "+c;var u=i[s];s++;for(var h=0;h<u;h++)l.push(i[s+h]);return l},e.CFF.readCharset=function(i,s,o){var l=e._bin,c=[".notdef"],u=i[s];if(s++,u==0)for(var h=0;h<o;h++){var A=l.readUshort(i,s);s+=2,c.push(A)}else{if(u!=1&&u!=2)throw"error: format: "+u;for(;c.length<o;){A=l.readUshort(i,s),s+=2;var f=0;for(u==1?(f=i[s],s++):(f=l.readUshort(i,s),s+=2),h=0;h<=f;h++)c.push(A),A++}}return c},e.CFF.readIndex=function(i,s,o){var l=e._bin,c=l.readUshort(i,s)+1,u=i[s+=2];if(s++,u==1)for(var h=0;h<c;h++)o.push(i[s+h]);else if(u==2)for(h=0;h<c;h++)o.push(l.readUshort(i,s+2*h));else if(u==3)for(h=0;h<c;h++)o.push(16777215&l.readUint(i,s+3*h-1));else if(c!=1)throw"unsupported offset size: "+u+", count: "+c;return(s+=c*u)-1},e.CFF.getCharString=function(i,s,o){var l=e._bin,c=i[s],u=i[s+1];i[s+2],i[s+3],i[s+4];var h=1,A=null,f=null;c<=20&&(A=c,h=1),c==12&&(A=100*c+u,h=2),21<=c&&c<=27&&(A=c,h=1),c==28&&(f=l.readShort(i,s+1),h=3),29<=c&&c<=31&&(A=c,h=1),32<=c&&c<=246&&(f=c-139,h=1),247<=c&&c<=250&&(f=256*(c-247)+u+108,h=2),251<=c&&c<=254&&(f=256*-(c-251)-u-108,h=2),c==255&&(f=l.readInt(i,s+1)/65535,h=5),o.val=f??"o"+A,o.size=h},e.CFF.readCharString=function(i,s,o){for(var l=s+o,c=e._bin,u=[];s<l;){var h=i[s],A=i[s+1];i[s+2],i[s+3],i[s+4];var f=1,p=null,y=null;h<=20&&(p=h,f=1),h==12&&(p=100*h+A,f=2),h!=19&&h!=20||(p=h,f=2),21<=h&&h<=27&&(p=h,f=1),h==28&&(y=c.readShort(i,s+1),f=3),29<=h&&h<=31&&(p=h,f=1),32<=h&&h<=246&&(y=h-139,f=1),247<=h&&h<=250&&(y=256*(h-247)+A+108,f=2),251<=h&&h<=254&&(y=256*-(h-251)-A-108,f=2),h==255&&(y=c.readInt(i,s+1)/65535,f=5),u.push(y??"o"+p),s+=f}return u},e.CFF.readDict=function(i,s,o){for(var l=e._bin,c={},u=[];s<o;){var h=i[s],A=i[s+1];i[s+2],i[s+3],i[s+4];var f=1,p=null,y=null;if(h==28&&(y=l.readShort(i,s+1),f=3),h==29&&(y=l.readInt(i,s+1),f=5),32<=h&&h<=246&&(y=h-139,f=1),247<=h&&h<=250&&(y=256*(h-247)+A+108,f=2),251<=h&&h<=254&&(y=256*-(h-251)-A-108,f=2),h==255)throw y=l.readInt(i,s+1)/65535,f=5,"unknown number";if(h==30){var G=[];for(f=1;;){var B=i[s+f];f++;var S=B>>4,N=15&B;if(S!=15&&G.push(S),N!=15&&G.push(N),N==15)break}for(var R="",w=[0,1,2,3,4,5,6,7,8,9,".","e","e-","reserved","-","endOfNumber"],V=0;V<G.length;V++)R+=w[G[V]];y=parseFloat(R)}h<=21&&(p=["version","Notice","FullName","FamilyName","Weight","FontBBox","BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StdHW","StdVW","escape","UniqueID","XUID","charset","Encoding","CharStrings","Private","Subrs","defaultWidthX","nominalWidthX"][h],f=1,h==12&&(p=["Copyright","isFixedPitch","ItalicAngle","UnderlinePosition","UnderlineThickness","PaintType","CharstringType","FontMatrix","StrokeWidth","BlueScale","BlueShift","BlueFuzz","StemSnapH","StemSnapV","ForceBold",0,0,"LanguageGroup","ExpansionFactor","initialRandomSeed","SyntheticBase","PostScript","BaseFontName","BaseFontBlend",0,0,0,0,0,0,"ROS","CIDFontVersion","CIDFontRevision","CIDFontType","CIDCount","UIDBase","FDArray","FDSelect","FontName"][A],f=2)),p!=null?(c[p]=u.length==1?u[0]:u,u=[]):u.push(y),s+=f}return c},e.cmap={},e.cmap.parse=function(i,s,o){i=new Uint8Array(i.buffer,s,o),s=0;var l=e._bin,c={};l.readUshort(i,s),s+=2;var u=l.readUshort(i,s);s+=2;var h=[];c.tables=[];for(var A=0;A<u;A++){var f=l.readUshort(i,s);s+=2;var p=l.readUshort(i,s);s+=2;var y=l.readUint(i,s);s+=4;var G="p"+f+"e"+p,B=h.indexOf(y);if(B==-1){var S;B=c.tables.length,h.push(y);var N=l.readUshort(i,y);N==0?S=e.cmap.parse0(i,y):N==4?S=e.cmap.parse4(i,y):N==6?S=e.cmap.parse6(i,y):N==12?S=e.cmap.parse12(i,y):console.debug("unknown format: "+N,f,p,y),c.tables.push(S)}if(c[G]!=null)throw"multiple tables for one platform+encoding";c[G]=B}return c},e.cmap.parse0=function(i,s){var o=e._bin,l={};l.format=o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2,l.map=[];for(var u=0;u<c-6;u++)l.map.push(i[s+u]);return l},e.cmap.parse4=function(i,s){var o=e._bin,l=s,c={};c.format=o.readUshort(i,s),s+=2;var u=o.readUshort(i,s);s+=2,o.readUshort(i,s),s+=2;var h=o.readUshort(i,s);s+=2;var A=h/2;c.searchRange=o.readUshort(i,s),s+=2,c.entrySelector=o.readUshort(i,s),s+=2,c.rangeShift=o.readUshort(i,s),s+=2,c.endCount=o.readUshorts(i,s,A),s+=2*A,s+=2,c.startCount=o.readUshorts(i,s,A),s+=2*A,c.idDelta=[];for(var f=0;f<A;f++)c.idDelta.push(o.readShort(i,s)),s+=2;for(c.idRangeOffset=o.readUshorts(i,s,A),s+=2*A,c.glyphIdArray=[];s<l+u;)c.glyphIdArray.push(o.readUshort(i,s)),s+=2;return c},e.cmap.parse6=function(i,s){var o=e._bin,l={};l.format=o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,o.readUshort(i,s),s+=2,l.firstCode=o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);s+=2,l.glyphIdArray=[];for(var u=0;u<c;u++)l.glyphIdArray.push(o.readUshort(i,s)),s+=2;return l},e.cmap.parse12=function(i,s){var o=e._bin,l={};l.format=o.readUshort(i,s),s+=2,s+=2,o.readUint(i,s),s+=4,o.readUint(i,s),s+=4;var c=o.readUint(i,s);s+=4,l.groups=[];for(var u=0;u<c;u++){var h=s+12*u,A=o.readUint(i,h+0),f=o.readUint(i,h+4),p=o.readUint(i,h+8);l.groups.push([A,f,p])}return l},e.glyf={},e.glyf.parse=function(i,s,o,l){for(var c=[],u=0;u<l.maxp.numGlyphs;u++)c.push(null);return c},e.glyf._parseGlyf=function(i,s){var o=e._bin,l=i._data,c=e._tabOffset(l,"glyf",i._offset)+i.loca[s];if(i.loca[s]==i.loca[s+1])return null;var u={};if(u.noc=o.readShort(l,c),c+=2,u.xMin=o.readShort(l,c),c+=2,u.yMin=o.readShort(l,c),c+=2,u.xMax=o.readShort(l,c),c+=2,u.yMax=o.readShort(l,c),c+=2,u.xMin>=u.xMax||u.yMin>=u.yMax)return null;if(u.noc>0){u.endPts=[];for(var h=0;h<u.noc;h++)u.endPts.push(o.readUshort(l,c)),c+=2;var A=o.readUshort(l,c);if(c+=2,l.length-c<A)return null;u.instructions=o.readBytes(l,c,A),c+=A;var f=u.endPts[u.noc-1]+1;for(u.flags=[],h=0;h<f;h++){var p=l[c];if(c++,u.flags.push(p),(8&p)!=0){var y=l[c];c++;for(var G=0;G<y;G++)u.flags.push(p),h++}}for(u.xs=[],h=0;h<f;h++){var B=(2&u.flags[h])!=0,S=(16&u.flags[h])!=0;B?(u.xs.push(S?l[c]:-l[c]),c++):S?u.xs.push(0):(u.xs.push(o.readShort(l,c)),c+=2)}for(u.ys=[],h=0;h<f;h++)B=(4&u.flags[h])!=0,S=(32&u.flags[h])!=0,B?(u.ys.push(S?l[c]:-l[c]),c++):S?u.ys.push(0):(u.ys.push(o.readShort(l,c)),c+=2);var N=0,R=0;for(h=0;h<f;h++)N+=u.xs[h],R+=u.ys[h],u.xs[h]=N,u.ys[h]=R}else{var w;u.parts=[];do{w=o.readUshort(l,c),c+=2;var V={m:{a:1,b:0,c:0,d:1,tx:0,ty:0},p1:-1,p2:-1};if(u.parts.push(V),V.glyphIndex=o.readUshort(l,c),c+=2,1&w){var H=o.readShort(l,c);c+=2;var X=o.readShort(l,c);c+=2}else H=o.readInt8(l,c),c++,X=o.readInt8(l,c),c++;2&w?(V.m.tx=H,V.m.ty=X):(V.p1=H,V.p2=X),8&w?(V.m.a=V.m.d=o.readF2dot14(l,c),c+=2):64&w?(V.m.a=o.readF2dot14(l,c),c+=2,V.m.d=o.readF2dot14(l,c),c+=2):128&w&&(V.m.a=o.readF2dot14(l,c),c+=2,V.m.b=o.readF2dot14(l,c),c+=2,V.m.c=o.readF2dot14(l,c),c+=2,V.m.d=o.readF2dot14(l,c),c+=2)}while(32&w);if(256&w){var Y=o.readUshort(l,c);for(c+=2,u.instr=[],h=0;h<Y;h++)u.instr.push(l[c]),c++}}return u},e.GDEF={},e.GDEF.parse=function(i,s,o,l){var c=s;s+=4;var u=e._bin.readUshort(i,s);return{glyphClassDef:u===0?null:e._lctf.readClassDef(i,c+u)}},e.GPOS={},e.GPOS.parse=function(i,s,o,l){return e._lctf.parse(i,s,o,l,e.GPOS.subt)},e.GPOS.subt=function(i,s,o,l){var c=e._bin,u=o,h={};if(h.fmt=c.readUshort(i,o),o+=2,s==1||s==2||s==3||s==7||s==8&&h.fmt<=2){var A=c.readUshort(i,o);o+=2,h.coverage=e._lctf.readCoverage(i,A+u)}if(s==1&&h.fmt==1){var f=c.readUshort(i,o);o+=2,f!=0&&(h.pos=e.GPOS.readValueRecord(i,o,f))}else if(s==2&&h.fmt>=1&&h.fmt<=2){f=c.readUshort(i,o),o+=2;var p=c.readUshort(i,o);o+=2;var y=e._lctf.numOfOnes(f),G=e._lctf.numOfOnes(p);if(h.fmt==1){h.pairsets=[];var B=c.readUshort(i,o);o+=2;for(var S=0;S<B;S++){var N=u+c.readUshort(i,o);o+=2;var R=c.readUshort(i,N);N+=2;for(var w=[],V=0;V<R;V++){var H=c.readUshort(i,N);N+=2,f!=0&&(P=e.GPOS.readValueRecord(i,N,f),N+=2*y),p!=0&&(q=e.GPOS.readValueRecord(i,N,p),N+=2*G),w.push({gid2:H,val1:P,val2:q})}h.pairsets.push(w)}}if(h.fmt==2){var X=c.readUshort(i,o);o+=2;var Y=c.readUshort(i,o);o+=2;var M=c.readUshort(i,o);o+=2;var E=c.readUshort(i,o);for(o+=2,h.classDef1=e._lctf.readClassDef(i,u+X),h.classDef2=e._lctf.readClassDef(i,u+Y),h.matrix=[],S=0;S<M;S++){var O=[];for(V=0;V<E;V++){var P=null,q=null;f!=0&&(P=e.GPOS.readValueRecord(i,o,f),o+=2*y),p!=0&&(q=e.GPOS.readValueRecord(i,o,p),o+=2*G),O.push({val1:P,val2:q})}h.matrix.push(O)}}}else if(s==4&&h.fmt==1)h.markCoverage=e._lctf.readCoverage(i,c.readUshort(i,o)+u),h.baseCoverage=e._lctf.readCoverage(i,c.readUshort(i,o+2)+u),h.markClassCount=c.readUshort(i,o+4),h.markArray=e.GPOS.readMarkArray(i,c.readUshort(i,o+6)+u),h.baseArray=e.GPOS.readBaseArray(i,c.readUshort(i,o+8)+u,h.markClassCount);else if(s==6&&h.fmt==1)h.mark1Coverage=e._lctf.readCoverage(i,c.readUshort(i,o)+u),h.mark2Coverage=e._lctf.readCoverage(i,c.readUshort(i,o+2)+u),h.markClassCount=c.readUshort(i,o+4),h.mark1Array=e.GPOS.readMarkArray(i,c.readUshort(i,o+6)+u),h.mark2Array=e.GPOS.readBaseArray(i,c.readUshort(i,o+8)+u,h.markClassCount);else{if(s==9&&h.fmt==1){var k=c.readUshort(i,o);o+=2;var le=c.readUint(i,o);if(o+=4,l.ltype==9)l.ltype=k;else if(l.ltype!=k)throw"invalid extension substitution";return e.GPOS.subt(i,l.ltype,u+le)}console.debug("unsupported GPOS table LookupType",s,"format",h.fmt)}return h},e.GPOS.readValueRecord=function(i,s,o){var l=e._bin,c=[];return c.push(1&o?l.readShort(i,s):0),s+=1&o?2:0,c.push(2&o?l.readShort(i,s):0),s+=2&o?2:0,c.push(4&o?l.readShort(i,s):0),s+=4&o?2:0,c.push(8&o?l.readShort(i,s):0),s+=8&o?2:0,c},e.GPOS.readBaseArray=function(i,s,o){var l=e._bin,c=[],u=s,h=l.readUshort(i,s);s+=2;for(var A=0;A<h;A++){for(var f=[],p=0;p<o;p++)f.push(e.GPOS.readAnchorRecord(i,u+l.readUshort(i,s))),s+=2;c.push(f)}return c},e.GPOS.readMarkArray=function(i,s){var o=e._bin,l=[],c=s,u=o.readUshort(i,s);s+=2;for(var h=0;h<u;h++){var A=e.GPOS.readAnchorRecord(i,o.readUshort(i,s+2)+c);A.markClass=o.readUshort(i,s),l.push(A),s+=4}return l},e.GPOS.readAnchorRecord=function(i,s){var o=e._bin,l={};return l.fmt=o.readUshort(i,s),l.x=o.readShort(i,s+2),l.y=o.readShort(i,s+4),l},e.GSUB={},e.GSUB.parse=function(i,s,o,l){return e._lctf.parse(i,s,o,l,e.GSUB.subt)},e.GSUB.subt=function(i,s,o,l){var c=e._bin,u=o,h={};if(h.fmt=c.readUshort(i,o),o+=2,s!=1&&s!=2&&s!=4&&s!=5&&s!=6)return null;if(s==1||s==2||s==4||s==5&&h.fmt<=2||s==6&&h.fmt<=2){var A=c.readUshort(i,o);o+=2,h.coverage=e._lctf.readCoverage(i,u+A)}if(s==1&&h.fmt>=1&&h.fmt<=2){if(h.fmt==1)h.delta=c.readShort(i,o),o+=2;else if(h.fmt==2){var f=c.readUshort(i,o);o+=2,h.newg=c.readUshorts(i,o,f),o+=2*h.newg.length}}else if(s==2&&h.fmt==1){f=c.readUshort(i,o),o+=2,h.seqs=[];for(var p=0;p<f;p++){var y=c.readUshort(i,o)+u;o+=2;var G=c.readUshort(i,y);h.seqs.push(c.readUshorts(i,y+2,G))}}else if(s==4)for(h.vals=[],f=c.readUshort(i,o),o+=2,p=0;p<f;p++){var B=c.readUshort(i,o);o+=2,h.vals.push(e.GSUB.readLigatureSet(i,u+B))}else if(s==5&&h.fmt==2){if(h.fmt==2){var S=c.readUshort(i,o);o+=2,h.cDef=e._lctf.readClassDef(i,u+S),h.scset=[];var N=c.readUshort(i,o);for(o+=2,p=0;p<N;p++){var R=c.readUshort(i,o);o+=2,h.scset.push(R==0?null:e.GSUB.readSubClassSet(i,u+R))}}}else if(s==6&&h.fmt==3){if(h.fmt==3){for(p=0;p<3;p++){f=c.readUshort(i,o),o+=2;for(var w=[],V=0;V<f;V++)w.push(e._lctf.readCoverage(i,u+c.readUshort(i,o+2*V)));o+=2*f,p==0&&(h.backCvg=w),p==1&&(h.inptCvg=w),p==2&&(h.ahedCvg=w)}f=c.readUshort(i,o),o+=2,h.lookupRec=e.GSUB.readSubstLookupRecords(i,o,f)}}else{if(s==7&&h.fmt==1){var H=c.readUshort(i,o);o+=2;var X=c.readUint(i,o);if(o+=4,l.ltype==9)l.ltype=H;else if(l.ltype!=H)throw"invalid extension substitution";return e.GSUB.subt(i,l.ltype,u+X)}console.debug("unsupported GSUB table LookupType",s,"format",h.fmt)}return h},e.GSUB.readSubClassSet=function(i,s){var o=e._bin.readUshort,l=s,c=[],u=o(i,s);s+=2;for(var h=0;h<u;h++){var A=o(i,s);s+=2,c.push(e.GSUB.readSubClassRule(i,l+A))}return c},e.GSUB.readSubClassRule=function(i,s){var o=e._bin.readUshort,l={},c=o(i,s),u=o(i,s+=2);s+=2,l.input=[];for(var h=0;h<c-1;h++)l.input.push(o(i,s)),s+=2;return l.substLookupRecords=e.GSUB.readSubstLookupRecords(i,s,u),l},e.GSUB.readSubstLookupRecords=function(i,s,o){for(var l=e._bin.readUshort,c=[],u=0;u<o;u++)c.push(l(i,s),l(i,s+2)),s+=4;return c},e.GSUB.readChainSubClassSet=function(i,s){var o=e._bin,l=s,c=[],u=o.readUshort(i,s);s+=2;for(var h=0;h<u;h++){var A=o.readUshort(i,s);s+=2,c.push(e.GSUB.readChainSubClassRule(i,l+A))}return c},e.GSUB.readChainSubClassRule=function(i,s){for(var o=e._bin,l={},c=["backtrack","input","lookahead"],u=0;u<c.length;u++){var h=o.readUshort(i,s);s+=2,u==1&&h--,l[c[u]]=o.readUshorts(i,s,h),s+=2*l[c[u]].length}return h=o.readUshort(i,s),s+=2,l.subst=o.readUshorts(i,s,2*h),s+=2*l.subst.length,l},e.GSUB.readLigatureSet=function(i,s){var o=e._bin,l=s,c=[],u=o.readUshort(i,s);s+=2;for(var h=0;h<u;h++){var A=o.readUshort(i,s);s+=2,c.push(e.GSUB.readLigature(i,l+A))}return c},e.GSUB.readLigature=function(i,s){var o=e._bin,l={chain:[]};l.nglyph=o.readUshort(i,s),s+=2;var c=o.readUshort(i,s);s+=2;for(var u=0;u<c-1;u++)l.chain.push(o.readUshort(i,s)),s+=2;return l},e.head={},e.head.parse=function(i,s,o){var l=e._bin,c={};return l.readFixed(i,s),s+=4,c.fontRevision=l.readFixed(i,s),s+=4,l.readUint(i,s),s+=4,l.readUint(i,s),s+=4,c.flags=l.readUshort(i,s),s+=2,c.unitsPerEm=l.readUshort(i,s),s+=2,c.created=l.readUint64(i,s),s+=8,c.modified=l.readUint64(i,s),s+=8,c.xMin=l.readShort(i,s),s+=2,c.yMin=l.readShort(i,s),s+=2,c.xMax=l.readShort(i,s),s+=2,c.yMax=l.readShort(i,s),s+=2,c.macStyle=l.readUshort(i,s),s+=2,c.lowestRecPPEM=l.readUshort(i,s),s+=2,c.fontDirectionHint=l.readShort(i,s),s+=2,c.indexToLocFormat=l.readShort(i,s),s+=2,c.glyphDataFormat=l.readShort(i,s),s+=2,c},e.hhea={},e.hhea.parse=function(i,s,o){var l=e._bin,c={};return l.readFixed(i,s),s+=4,c.ascender=l.readShort(i,s),s+=2,c.descender=l.readShort(i,s),s+=2,c.lineGap=l.readShort(i,s),s+=2,c.advanceWidthMax=l.readUshort(i,s),s+=2,c.minLeftSideBearing=l.readShort(i,s),s+=2,c.minRightSideBearing=l.readShort(i,s),s+=2,c.xMaxExtent=l.readShort(i,s),s+=2,c.caretSlopeRise=l.readShort(i,s),s+=2,c.caretSlopeRun=l.readShort(i,s),s+=2,c.caretOffset=l.readShort(i,s),s+=2,s+=8,c.metricDataFormat=l.readShort(i,s),s+=2,c.numberOfHMetrics=l.readUshort(i,s),s+=2,c},e.hmtx={},e.hmtx.parse=function(i,s,o,l){for(var c=e._bin,u={aWidth:[],lsBearing:[]},h=0,A=0,f=0;f<l.maxp.numGlyphs;f++)f<l.hhea.numberOfHMetrics&&(h=c.readUshort(i,s),s+=2,A=c.readShort(i,s),s+=2),u.aWidth.push(h),u.lsBearing.push(A);return u},e.kern={},e.kern.parse=function(i,s,o,l){var c=e._bin,u=c.readUshort(i,s);if(s+=2,u==1)return e.kern.parseV1(i,s-2,o,l);var h=c.readUshort(i,s);s+=2;for(var A={glyph1:[],rval:[]},f=0;f<h;f++){s+=2,o=c.readUshort(i,s),s+=2;var p=c.readUshort(i,s);s+=2;var y=p>>>8;if((y&=15)!=0)throw"unknown kern table format: "+y;s=e.kern.readFormat0(i,s,A)}return A},e.kern.parseV1=function(i,s,o,l){var c=e._bin;c.readFixed(i,s),s+=4;var u=c.readUint(i,s);s+=4;for(var h={glyph1:[],rval:[]},A=0;A<u;A++){c.readUint(i,s),s+=4;var f=c.readUshort(i,s);s+=2,c.readUshort(i,s),s+=2;var p=f>>>8;if((p&=15)!=0)throw"unknown kern table format: "+p;s=e.kern.readFormat0(i,s,h)}return h},e.kern.readFormat0=function(i,s,o){var l=e._bin,c=-1,u=l.readUshort(i,s);s+=2,l.readUshort(i,s),s+=2,l.readUshort(i,s),s+=2,l.readUshort(i,s),s+=2;for(var h=0;h<u;h++){var A=l.readUshort(i,s);s+=2;var f=l.readUshort(i,s);s+=2;var p=l.readShort(i,s);s+=2,A!=c&&(o.glyph1.push(A),o.rval.push({glyph2:[],vals:[]}));var y=o.rval[o.rval.length-1];y.glyph2.push(f),y.vals.push(p),c=A}return s},e.loca={},e.loca.parse=function(i,s,o,l){var c=e._bin,u=[],h=l.head.indexToLocFormat,A=l.maxp.numGlyphs+1;if(h==0)for(var f=0;f<A;f++)u.push(c.readUshort(i,s+(f<<1))<<1);if(h==1)for(f=0;f<A;f++)u.push(c.readUint(i,s+(f<<2)));return u},e.maxp={},e.maxp.parse=function(i,s,o){var l=e._bin,c={},u=l.readUint(i,s);return s+=4,c.numGlyphs=l.readUshort(i,s),s+=2,u==65536&&(c.maxPoints=l.readUshort(i,s),s+=2,c.maxContours=l.readUshort(i,s),s+=2,c.maxCompositePoints=l.readUshort(i,s),s+=2,c.maxCompositeContours=l.readUshort(i,s),s+=2,c.maxZones=l.readUshort(i,s),s+=2,c.maxTwilightPoints=l.readUshort(i,s),s+=2,c.maxStorage=l.readUshort(i,s),s+=2,c.maxFunctionDefs=l.readUshort(i,s),s+=2,c.maxInstructionDefs=l.readUshort(i,s),s+=2,c.maxStackElements=l.readUshort(i,s),s+=2,c.maxSizeOfInstructions=l.readUshort(i,s),s+=2,c.maxComponentElements=l.readUshort(i,s),s+=2,c.maxComponentDepth=l.readUshort(i,s),s+=2),c},e.name={},e.name.parse=function(i,s,o){var l=e._bin,c={};l.readUshort(i,s),s+=2;var u=l.readUshort(i,s);s+=2,l.readUshort(i,s);for(var h,A=["copyright","fontFamily","fontSubfamily","ID","fullName","version","postScriptName","trademark","manufacturer","designer","description","urlVendor","urlDesigner","licence","licenceURL","---","typoFamilyName","typoSubfamilyName","compatibleFull","sampleText","postScriptCID","wwsFamilyName","wwsSubfamilyName","lightPalette","darkPalette"],f=s+=2,p=0;p<u;p++){var y=l.readUshort(i,s);s+=2;var G=l.readUshort(i,s);s+=2;var B=l.readUshort(i,s);s+=2;var S=l.readUshort(i,s);s+=2;var N=l.readUshort(i,s);s+=2;var R=l.readUshort(i,s);s+=2;var w,V=A[S],H=f+12*u+R;if(y==0)w=l.readUnicode(i,H,N/2);else if(y==3&&G==0)w=l.readUnicode(i,H,N/2);else if(G==0)w=l.readASCII(i,H,N);else if(G==1)w=l.readUnicode(i,H,N/2);else if(G==3)w=l.readUnicode(i,H,N/2);else{if(y!=1)throw"unknown encoding "+G+", platformID: "+y;w=l.readASCII(i,H,N),console.debug("reading unknown MAC encoding "+G+" as ASCII")}var X="p"+y+","+B.toString(16);c[X]==null&&(c[X]={}),c[X][V!==void 0?V:S]=w,c[X]._lang=B}for(var Y in c)if(c[Y].postScriptName!=null&&c[Y]._lang==1033)return c[Y];for(var Y in c)if(c[Y].postScriptName!=null&&c[Y]._lang==0)return c[Y];for(var Y in c)if(c[Y].postScriptName!=null&&c[Y]._lang==3084)return c[Y];for(var Y in c)if(c[Y].postScriptName!=null)return c[Y];for(var Y in c){h=Y;break}return console.debug("returning name table with languageID "+c[h]._lang),c[h]},e["OS/2"]={},e["OS/2"].parse=function(i,s,o){var l=e._bin.readUshort(i,s);s+=2;var c={};if(l==0)e["OS/2"].version0(i,s,c);else if(l==1)e["OS/2"].version1(i,s,c);else if(l==2||l==3||l==4)e["OS/2"].version2(i,s,c);else{if(l!=5)throw"unknown OS/2 table version: "+l;e["OS/2"].version5(i,s,c)}return c},e["OS/2"].version0=function(i,s,o){var l=e._bin;return o.xAvgCharWidth=l.readShort(i,s),s+=2,o.usWeightClass=l.readUshort(i,s),s+=2,o.usWidthClass=l.readUshort(i,s),s+=2,o.fsType=l.readUshort(i,s),s+=2,o.ySubscriptXSize=l.readShort(i,s),s+=2,o.ySubscriptYSize=l.readShort(i,s),s+=2,o.ySubscriptXOffset=l.readShort(i,s),s+=2,o.ySubscriptYOffset=l.readShort(i,s),s+=2,o.ySuperscriptXSize=l.readShort(i,s),s+=2,o.ySuperscriptYSize=l.readShort(i,s),s+=2,o.ySuperscriptXOffset=l.readShort(i,s),s+=2,o.ySuperscriptYOffset=l.readShort(i,s),s+=2,o.yStrikeoutSize=l.readShort(i,s),s+=2,o.yStrikeoutPosition=l.readShort(i,s),s+=2,o.sFamilyClass=l.readShort(i,s),s+=2,o.panose=l.readBytes(i,s,10),s+=10,o.ulUnicodeRange1=l.readUint(i,s),s+=4,o.ulUnicodeRange2=l.readUint(i,s),s+=4,o.ulUnicodeRange3=l.readUint(i,s),s+=4,o.ulUnicodeRange4=l.readUint(i,s),s+=4,o.achVendID=[l.readInt8(i,s),l.readInt8(i,s+1),l.readInt8(i,s+2),l.readInt8(i,s+3)],s+=4,o.fsSelection=l.readUshort(i,s),s+=2,o.usFirstCharIndex=l.readUshort(i,s),s+=2,o.usLastCharIndex=l.readUshort(i,s),s+=2,o.sTypoAscender=l.readShort(i,s),s+=2,o.sTypoDescender=l.readShort(i,s),s+=2,o.sTypoLineGap=l.readShort(i,s),s+=2,o.usWinAscent=l.readUshort(i,s),s+=2,o.usWinDescent=l.readUshort(i,s),s+=2},e["OS/2"].version1=function(i,s,o){var l=e._bin;return s=e["OS/2"].version0(i,s,o),o.ulCodePageRange1=l.readUint(i,s),s+=4,o.ulCodePageRange2=l.readUint(i,s),s+=4},e["OS/2"].version2=function(i,s,o){var l=e._bin;return s=e["OS/2"].version1(i,s,o),o.sxHeight=l.readShort(i,s),s+=2,o.sCapHeight=l.readShort(i,s),s+=2,o.usDefault=l.readUshort(i,s),s+=2,o.usBreak=l.readUshort(i,s),s+=2,o.usMaxContext=l.readUshort(i,s),s+=2},e["OS/2"].version5=function(i,s,o){var l=e._bin;return s=e["OS/2"].version2(i,s,o),o.usLowerOpticalPointSize=l.readUshort(i,s),s+=2,o.usUpperOpticalPointSize=l.readUshort(i,s),s+=2},e.post={},e.post.parse=function(i,s,o){var l=e._bin,c={};return c.version=l.readFixed(i,s),s+=4,c.italicAngle=l.readFixed(i,s),s+=4,c.underlinePosition=l.readShort(i,s),s+=2,c.underlineThickness=l.readShort(i,s),s+=2,c},e==null&&(e={}),e.U==null&&(e.U={}),e.U.codeToGlyph=function(i,s){var o=i.cmap,l=-1;if(o.p0e4!=null?l=o.p0e4:o.p3e1!=null?l=o.p3e1:o.p1e0!=null?l=o.p1e0:o.p0e3!=null&&(l=o.p0e3),l==-1)throw"no familiar platform and encoding!";var c=o.tables[l];if(c.format==0)return s>=c.map.length?0:c.map[s];if(c.format==4){for(var u=-1,h=0;h<c.endCount.length;h++)if(s<=c.endCount[h]){u=h;break}return u==-1||c.startCount[u]>s?0:65535&(c.idRangeOffset[u]!=0?c.glyphIdArray[s-c.startCount[u]+(c.idRangeOffset[u]>>1)-(c.idRangeOffset.length-u)]:s+c.idDelta[u])}if(c.format==12){if(s>c.groups[c.groups.length-1][1])return 0;for(h=0;h<c.groups.length;h++){var A=c.groups[h];if(A[0]<=s&&s<=A[1])return A[2]+(s-A[0])}return 0}throw"unknown cmap table format "+c.format},e.U.glyphToPath=function(i,s){var o={cmds:[],crds:[]};if(i.SVG&&i.SVG.entries[s]){var l=i.SVG.entries[s];return l==null?o:(typeof l=="string"&&(l=e.SVG.toPath(l),i.SVG.entries[s]=l),l)}if(i.CFF){var c={x:0,y:0,stack:[],nStems:0,haveWidth:!1,width:i.CFF.Private?i.CFF.Private.defaultWidthX:0,open:!1},u=i.CFF,h=i.CFF.Private;if(u.ROS){for(var A=0;u.FDSelect[A+2]<=s;)A+=2;h=u.FDArray[u.FDSelect[A+1]].Private}e.U._drawCFF(i.CFF.CharStrings[s],c,u,h,o)}else i.glyf&&e.U._drawGlyf(s,i,o);return o},e.U._drawGlyf=function(i,s,o){var l=s.glyf[i];l==null&&(l=s.glyf[i]=e.glyf._parseGlyf(s,i)),l!=null&&(l.noc>-1?e.U._simpleGlyph(l,o):e.U._compoGlyph(l,s,o))},e.U._simpleGlyph=function(i,s){for(var o=0;o<i.noc;o++){for(var l=o==0?0:i.endPts[o-1]+1,c=i.endPts[o],u=l;u<=c;u++){var h=u==l?c:u-1,A=u==c?l:u+1,f=1&i.flags[u],p=1&i.flags[h],y=1&i.flags[A],G=i.xs[u],B=i.ys[u];if(u==l)if(f){if(!p){e.U.P.moveTo(s,G,B);continue}e.U.P.moveTo(s,i.xs[h],i.ys[h])}else p?e.U.P.moveTo(s,i.xs[h],i.ys[h]):e.U.P.moveTo(s,(i.xs[h]+G)/2,(i.ys[h]+B)/2);f?p&&e.U.P.lineTo(s,G,B):y?e.U.P.qcurveTo(s,G,B,i.xs[A],i.ys[A]):e.U.P.qcurveTo(s,G,B,(G+i.xs[A])/2,(B+i.ys[A])/2)}e.U.P.closePath(s)}},e.U._compoGlyph=function(i,s,o){for(var l=0;l<i.parts.length;l++){var c={cmds:[],crds:[]},u=i.parts[l];e.U._drawGlyf(u.glyphIndex,s,c);for(var h=u.m,A=0;A<c.crds.length;A+=2){var f=c.crds[A],p=c.crds[A+1];o.crds.push(f*h.a+p*h.b+h.tx),o.crds.push(f*h.c+p*h.d+h.ty)}for(A=0;A<c.cmds.length;A++)o.cmds.push(c.cmds[A])}},e.U._getGlyphClass=function(i,s){var o=e._lctf.getInterval(s,i);return o==-1?0:s[o+2]},e.U._applySubs=function(i,s,o,l){for(var c=i.length-s-1,u=0;u<o.tabs.length;u++)if(o.tabs[u]!=null){var h,A=o.tabs[u];if(!A.coverage||(h=e._lctf.coverageIndex(A.coverage,i[s]))!=-1){if(o.ltype==1)i[s],A.fmt==1?i[s]=i[s]+A.delta:i[s]=A.newg[h];else if(o.ltype==4)for(var f=A.vals[h],p=0;p<f.length;p++){var y=f[p],G=y.chain.length;if(!(G>c)){for(var B=!0,S=0,N=0;N<G;N++){for(;i[s+S+(1+N)]==-1;)S++;y.chain[N]!=i[s+S+(1+N)]&&(B=!1)}if(B){for(i[s]=y.nglyph,N=0;N<G+S;N++)i[s+N+1]=-1;break}}}else if(o.ltype==5&&A.fmt==2)for(var R=e._lctf.getInterval(A.cDef,i[s]),w=A.cDef[R+2],V=A.scset[w],H=0;H<V.length;H++){var X=V[H],Y=X.input;if(!(Y.length>c)){for(B=!0,N=0;N<Y.length;N++){var M=e._lctf.getInterval(A.cDef,i[s+1+N]);if(R==-1&&A.cDef[M+2]!=Y[N]){B=!1;break}}if(B){var E=X.substLookupRecords;for(p=0;p<E.length;p+=2)E[p],E[p+1]}}}else if(o.ltype==6&&A.fmt==3){if(!e.U._glsCovered(i,A.backCvg,s-A.backCvg.length)||!e.U._glsCovered(i,A.inptCvg,s)||!e.U._glsCovered(i,A.ahedCvg,s+A.inptCvg.length))continue;var O=A.lookupRec;for(H=0;H<O.length;H+=2){R=O[H];var P=l[O[H+1]];e.U._applySubs(i,s+R,P,l)}}}}},e.U._glsCovered=function(i,s,o){for(var l=0;l<s.length;l++)if(e._lctf.coverageIndex(s[l],i[o+l])==-1)return!1;return!0},e.U.glyphsToPath=function(i,s,o){for(var l={cmds:[],crds:[]},c=0,u=0;u<s.length;u++){var h=s[u];if(h!=-1){for(var A=u<s.length-1&&s[u+1]!=-1?s[u+1]:0,f=e.U.glyphToPath(i,h),p=0;p<f.crds.length;p+=2)l.crds.push(f.crds[p]+c),l.crds.push(f.crds[p+1]);for(o&&l.cmds.push(o),p=0;p<f.cmds.length;p++)l.cmds.push(f.cmds[p]);o&&l.cmds.push("X"),c+=i.hmtx.aWidth[h],u<s.length-1&&(c+=e.U.getPairAdjustment(i,h,A))}}return l},e.U.P={},e.U.P.moveTo=function(i,s,o){i.cmds.push("M"),i.crds.push(s,o)},e.U.P.lineTo=function(i,s,o){i.cmds.push("L"),i.crds.push(s,o)},e.U.P.curveTo=function(i,s,o,l,c,u,h){i.cmds.push("C"),i.crds.push(s,o,l,c,u,h)},e.U.P.qcurveTo=function(i,s,o,l,c){i.cmds.push("Q"),i.crds.push(s,o,l,c)},e.U.P.closePath=function(i){i.cmds.push("Z")},e.U._drawCFF=function(i,s,o,l,c){for(var u=s.stack,h=s.nStems,A=s.haveWidth,f=s.width,p=s.open,y=0,G=s.x,B=s.y,S=0,N=0,R=0,w=0,V=0,H=0,X=0,Y=0,M=0,E=0,O={val:0,size:0};y<i.length;){e.CFF.getCharString(i,y,O);var P=O.val;if(y+=O.size,P=="o1"||P=="o18")u.length%2!=0&&!A&&(f=u.shift()+l.nominalWidthX),h+=u.length>>1,u.length=0,A=!0;else if(P=="o3"||P=="o23")u.length%2!=0&&!A&&(f=u.shift()+l.nominalWidthX),h+=u.length>>1,u.length=0,A=!0;else if(P=="o4")u.length>1&&!A&&(f=u.shift()+l.nominalWidthX,A=!0),p&&e.U.P.closePath(c),B+=u.pop(),e.U.P.moveTo(c,G,B),p=!0;else if(P=="o5")for(;u.length>0;)G+=u.shift(),B+=u.shift(),e.U.P.lineTo(c,G,B);else if(P=="o6"||P=="o7")for(var q=u.length,k=P=="o6",le=0;le<q;le++){var F=u.shift();k?G+=F:B+=F,k=!k,e.U.P.lineTo(c,G,B)}else if(P=="o8"||P=="o24"){q=u.length;for(var j=0;j+6<=q;)S=G+u.shift(),N=B+u.shift(),R=S+u.shift(),w=N+u.shift(),G=R+u.shift(),B=w+u.shift(),e.U.P.curveTo(c,S,N,R,w,G,B),j+=6;P=="o24"&&(G+=u.shift(),B+=u.shift(),e.U.P.lineTo(c,G,B))}else{if(P=="o11")break;if(P=="o1234"||P=="o1235"||P=="o1236"||P=="o1237")P=="o1234"&&(N=B,R=(S=G+u.shift())+u.shift(),E=w=N+u.shift(),H=w,Y=B,G=(X=(V=(M=R+u.shift())+u.shift())+u.shift())+u.shift(),e.U.P.curveTo(c,S,N,R,w,M,E),e.U.P.curveTo(c,V,H,X,Y,G,B)),P=="o1235"&&(S=G+u.shift(),N=B+u.shift(),R=S+u.shift(),w=N+u.shift(),M=R+u.shift(),E=w+u.shift(),V=M+u.shift(),H=E+u.shift(),X=V+u.shift(),Y=H+u.shift(),G=X+u.shift(),B=Y+u.shift(),u.shift(),e.U.P.curveTo(c,S,N,R,w,M,E),e.U.P.curveTo(c,V,H,X,Y,G,B)),P=="o1236"&&(S=G+u.shift(),N=B+u.shift(),R=S+u.shift(),E=w=N+u.shift(),H=w,X=(V=(M=R+u.shift())+u.shift())+u.shift(),Y=H+u.shift(),G=X+u.shift(),e.U.P.curveTo(c,S,N,R,w,M,E),e.U.P.curveTo(c,V,H,X,Y,G,B)),P=="o1237"&&(S=G+u.shift(),N=B+u.shift(),R=S+u.shift(),w=N+u.shift(),M=R+u.shift(),E=w+u.shift(),V=M+u.shift(),H=E+u.shift(),X=V+u.shift(),Y=H+u.shift(),Math.abs(X-G)>Math.abs(Y-B)?G=X+u.shift():B=Y+u.shift(),e.U.P.curveTo(c,S,N,R,w,M,E),e.U.P.curveTo(c,V,H,X,Y,G,B));else if(P=="o14"){if(u.length>0&&!A&&(f=u.shift()+o.nominalWidthX,A=!0),u.length==4){var Q=u.shift(),ce=u.shift(),oe=u.shift(),T=u.shift(),$=e.CFF.glyphBySE(o,oe),ae=e.CFF.glyphBySE(o,T);e.U._drawCFF(o.CharStrings[$],s,o,l,c),s.x=Q,s.y=ce,e.U._drawCFF(o.CharStrings[ae],s,o,l,c)}p&&(e.U.P.closePath(c),p=!1)}else if(P=="o19"||P=="o20")u.length%2!=0&&!A&&(f=u.shift()+l.nominalWidthX),h+=u.length>>1,u.length=0,A=!0,y+=h+7>>3;else if(P=="o21")u.length>2&&!A&&(f=u.shift()+l.nominalWidthX,A=!0),B+=u.pop(),G+=u.pop(),p&&e.U.P.closePath(c),e.U.P.moveTo(c,G,B),p=!0;else if(P=="o22")u.length>1&&!A&&(f=u.shift()+l.nominalWidthX,A=!0),G+=u.pop(),p&&e.U.P.closePath(c),e.U.P.moveTo(c,G,B),p=!0;else if(P=="o25"){for(;u.length>6;)G+=u.shift(),B+=u.shift(),e.U.P.lineTo(c,G,B);S=G+u.shift(),N=B+u.shift(),R=S+u.shift(),w=N+u.shift(),G=R+u.shift(),B=w+u.shift(),e.U.P.curveTo(c,S,N,R,w,G,B)}else if(P=="o26")for(u.length%2&&(G+=u.shift());u.length>0;)S=G,N=B+u.shift(),G=R=S+u.shift(),B=(w=N+u.shift())+u.shift(),e.U.P.curveTo(c,S,N,R,w,G,B);else if(P=="o27")for(u.length%2&&(B+=u.shift());u.length>0;)N=B,R=(S=G+u.shift())+u.shift(),w=N+u.shift(),G=R+u.shift(),B=w,e.U.P.curveTo(c,S,N,R,w,G,B);else if(P=="o10"||P=="o29"){var Ie=P=="o10"?l:o;if(u.length==0)console.debug("error: empty stack");else{var be=u.pop(),D=Ie.Subrs[be+Ie.Bias];s.x=G,s.y=B,s.nStems=h,s.haveWidth=A,s.width=f,s.open=p,e.U._drawCFF(D,s,o,l,c),G=s.x,B=s.y,h=s.nStems,A=s.haveWidth,f=s.width,p=s.open}}else if(P=="o30"||P=="o31"){var de=u.length,ee=(j=0,P=="o31");for(j+=de-(q=-3&de);j<q;)ee?(N=B,R=(S=G+u.shift())+u.shift(),B=(w=N+u.shift())+u.shift(),q-j==5?(G=R+u.shift(),j++):G=R,ee=!1):(S=G,N=B+u.shift(),R=S+u.shift(),w=N+u.shift(),G=R+u.shift(),q-j==5?(B=w+u.shift(),j++):B=w,ee=!0),e.U.P.curveTo(c,S,N,R,w,G,B),j+=4}else{if((P+"").charAt(0)=="o")throw console.debug("Unknown operation: "+P,i),P;u.push(P)}}}s.x=G,s.y=B,s.nStems=h,s.haveWidth=A,s.width=f,s.open=p};var t=e,n={Typr:t};return a.Typr=t,a.default=n,Object.defineProperty(a,"__esModule",{value:!0}),a})({}).Typr}function a4(){return(function(a){var e=Uint8Array,t=Uint16Array,n=Uint32Array,i=new e([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new e([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),o=new e([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),l=function(P,q){for(var k=new t(31),le=0;le<31;++le)k[le]=q+=1<<P[le-1];var F=new n(k[30]);for(le=1;le<30;++le)for(var j=k[le];j<k[le+1];++j)F[j]=j-k[le]<<5|le;return[k,F]},c=l(i,2),u=c[0],h=c[1];u[28]=258,h[258]=28;for(var A=l(s,0)[0],f=new t(32768),p=0;p<32768;++p){var y=(43690&p)>>>1|(21845&p)<<1;y=(61680&(y=(52428&y)>>>2|(13107&y)<<2))>>>4|(3855&y)<<4,f[p]=((65280&y)>>>8|(255&y)<<8)>>>1}var G=function(P,q,k){for(var le=P.length,F=0,j=new t(q);F<le;++F)++j[P[F]-1];var Q,ce=new t(q);for(F=0;F<q;++F)ce[F]=ce[F-1]+j[F-1]<<1;{Q=new t(1<<q);var oe=15-q;for(F=0;F<le;++F)if(P[F])for(var T=F<<4|P[F],$=q-P[F],ae=ce[P[F]-1]++<<$,Ie=ae|(1<<$)-1;ae<=Ie;++ae)Q[f[ae]>>>oe]=T}return Q},B=new e(288);for(p=0;p<144;++p)B[p]=8;for(p=144;p<256;++p)B[p]=9;for(p=256;p<280;++p)B[p]=7;for(p=280;p<288;++p)B[p]=8;var S=new e(32);for(p=0;p<32;++p)S[p]=5;var N=G(B,9),R=G(S,5),w=function(P){for(var q=P[0],k=1;k<P.length;++k)P[k]>q&&(q=P[k]);return q},V=function(P,q,k){var le=q/8|0;return(P[le]|P[le+1]<<8)>>(7&q)&k},H=function(P,q){var k=q/8|0;return(P[k]|P[k+1]<<8|P[k+2]<<16)>>(7&q)},X=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Y=function(P,q,k){var le=new Error(q||X[P]);if(le.code=P,Error.captureStackTrace&&Error.captureStackTrace(le,Y),!k)throw le;return le},M=function(P,q,k){var le=P.length;if(!le||k&&!k.l&&le<5)return q||new e(0);var F=!q||k,j=!k||k.i;k||(k={}),q||(q=new e(3*le));var Q,ce=function(ot){var he=q.length;if(ot>he){var Ve=new e(Math.max(2*he,ot));Ve.set(q),q=Ve}},oe=k.f||0,T=k.p||0,$=k.b||0,ae=k.l,Ie=k.d,be=k.m,D=k.n,de=8*le;do{if(!ae){k.f=oe=V(P,T,1);var ee=V(P,T+1,3);if(T+=3,!ee){var Ce=P[(it=((Q=T)/8|0)+(7&Q&&1)+4)-4]|P[it-3]<<8,we=it+Ce;if(we>le){j&&Y(0);break}F&&ce($+Ce),q.set(P.subarray(it,we),$),k.b=$+=Ce,k.p=T=8*we;continue}if(ee==1)ae=N,Ie=R,be=9,D=5;else if(ee==2){var Ye=V(P,T,31)+257,Ee=V(P,T+10,15)+4,pt=Ye+V(P,T+5,31)+1;T+=14;for(var Ke=new e(pt),Qe=new e(19),Le=0;Le<Ee;++Le)Qe[o[Le]]=V(P,T+3*Le,7);T+=3*Ee;var dt=w(Qe),se=(1<<dt)-1,ht=G(Qe,dt);for(Le=0;Le<pt;){var it,Fe=ht[V(P,T,se)];if(T+=15&Fe,(it=Fe>>>4)<16)Ke[Le++]=it;else{var st=0,ie=0;for(it==16?(ie=3+V(P,T,3),T+=2,st=Ke[Le-1]):it==17?(ie=3+V(P,T,7),T+=3):it==18&&(ie=11+V(P,T,127),T+=7);ie--;)Ke[Le++]=st}}var z=Ke.subarray(0,Ye),Ae=Ke.subarray(Ye);be=w(z),D=w(Ae),ae=G(z,be),Ie=G(Ae,D)}else Y(1);if(T>de){j&&Y(0);break}}F&&ce($+131072);for(var Oe=(1<<be)-1,He=(1<<D)-1,Me=T;;Me=T){var It=(st=ae[H(P,T)&Oe])>>>4;if((T+=15&st)>de){j&&Y(0);break}if(st||Y(2),It<256)q[$++]=It;else{if(It==256){Me=T,ae=null;break}var ft=It-254;if(It>264){var Ht=i[Le=It-257];ft=V(P,T,(1<<Ht)-1)+u[Le],T+=Ht}var kt=Ie[H(P,T)&He],Pe=kt>>>4;if(kt||Y(3),T+=15&kt,Ae=A[Pe],Pe>3&&(Ht=s[Pe],Ae+=H(P,T)&(1<<Ht)-1,T+=Ht),T>de){j&&Y(0);break}F&&ce($+131072);for(var je=$+ft;$<je;$+=4)q[$]=q[$-Ae],q[$+1]=q[$+1-Ae],q[$+2]=q[$+2-Ae],q[$+3]=q[$+3-Ae];$=je}}k.l=ae,k.p=Me,k.b=$,ae&&(oe=1,k.m=be,k.d=Ie,k.n=D)}while(!oe);return $==q.length?q:(function(ot,he,Ve){(Ve==null||Ve>ot.length)&&(Ve=ot.length);var Ct=new(ot instanceof t?t:ot instanceof n?n:e)(Ve-he);return Ct.set(ot.subarray(he,Ve)),Ct})(q,0,$)},E=new e(0),O=typeof TextDecoder<"u"&&new TextDecoder;try{O.decode(E,{stream:!0})}catch{}return a.convert_streams=function(P){var q=new DataView(P),k=0;function le(){var Ye=q.getUint16(k);return k+=2,Ye}function F(){var Ye=q.getUint32(k);return k+=4,Ye}function j(Ye){Ce.setUint16(we,Ye),we+=2}function Q(Ye){Ce.setUint32(we,Ye),we+=4}for(var ce={signature:F(),flavor:F(),length:F(),numTables:le(),reserved:le(),totalSfntSize:F(),majorVersion:le(),minorVersion:le(),metaOffset:F(),metaLength:F(),metaOrigLength:F(),privOffset:F(),privLength:F()},oe=0;Math.pow(2,oe)<=ce.numTables;)oe++;oe--;for(var T=16*Math.pow(2,oe),$=16*ce.numTables-T,ae=12,Ie=[],be=0;be<ce.numTables;be++)Ie.push({tag:F(),offset:F(),compLength:F(),origLength:F(),origChecksum:F()}),ae+=16;var D,de=new Uint8Array(12+16*Ie.length+Ie.reduce((function(Ye,Ee){return Ye+Ee.origLength+4}),0)),ee=de.buffer,Ce=new DataView(ee),we=0;return Q(ce.flavor),j(ce.numTables),j(T),j(oe),j($),Ie.forEach((function(Ye){Q(Ye.tag),Q(Ye.origChecksum),Q(ae),Q(Ye.origLength),Ye.outOffset=ae,(ae+=Ye.origLength)%4!=0&&(ae+=4-ae%4)})),Ie.forEach((function(Ye){var Ee,pt=P.slice(Ye.offset,Ye.offset+Ye.compLength);if(Ye.compLength!=Ye.origLength){var Ke=new Uint8Array(Ye.origLength);Ee=new Uint8Array(pt,2),M(Ee,Ke)}else Ke=new Uint8Array(pt);de.set(Ke,Ye.outOffset);var Qe=0;(ae=Ye.outOffset+Ye.origLength)%4!=0&&(Qe=4-ae%4),de.set(new Uint8Array(Qe).buffer,Ye.outOffset+Ye.origLength),D=ae+Qe})),ee.slice(0,D)},Object.defineProperty(a,"__esModule",{value:!0}),a})({}).convert_streams}function s4(a,e){const t={M:2,L:2,Q:4,C:6,Z:0},n={C:"18g,ca,368,1kz",D:"17k,6,2,2+4,5+c,2+6,2+1,10+1,9+f,j+11,2+1,a,2,2+1,15+2,3,j+2,6+3,2+8,2,2,2+1,w+a,4+e,3+3,2,3+2,3+5,23+w,2f+4,3,2+9,2,b,2+3,3,1k+9,6+1,3+1,2+2,2+d,30g,p+y,1,1+1g,f+x,2,sd2+1d,jf3+4,f+3,2+4,2+2,b+3,42,2,4+2,2+1,2,3,t+1,9f+w,2,el+2,2+g,d+2,2l,2+1,5,3+1,2+1,2,3,6,16wm+1v",R:"17m+3,2,2,6+3,m,15+2,2+2,h+h,13,3+8,2,2,3+1,2,p+1,x,5+4,5,a,2,2,3,u,c+2,g+1,5,2+1,4+1,5j,6+1,2,b,2+2,f,2+1,1s+2,2,3+1,7,1ez0,2,2+1,4+4,b,4,3,b,42,2+2,4,3,2+1,2,o+3,ae,ep,x,2o+2,3+1,3,5+1,6",L:"x9u,jff,a,fd,jv",T:"4t,gj+33,7o+4,1+1,7c+18,2,2+1,2+1,2,21+a,2,1b+k,h,2u+6,3+5,3+1,2+3,y,2,v+q,2k+a,1n+8,a,p+3,2+8,2+2,2+4,18+2,3c+e,2+v,1k,2,5+7,5,4+6,b+1,u,1n,5+3,9,l+1,r,3+1,1m,5+1,5+1,3+2,4,v+1,4,c+1,1m,5+4,2+1,5,l+1,n+5,2,1n,3,2+3,9,8+1,c+1,v,1q,d,1f,4,1m+2,6+2,2+3,8+1,c+1,u,1n,3,7,6+1,l+1,t+1,1m+1,5+3,9,l+1,u,21,8+2,2,2j,3+6,d+7,2r,3+8,c+5,23+1,s,2,2,1k+d,2+4,2+1,6+a,2+z,a,2v+3,2+5,2+1,3+1,q+1,5+2,h+3,e,3+1,7,g,jk+2,qb+2,u+2,u+1,v+1,1t+1,2+6,9,3+a,a,1a+2,3c+1,z,3b+2,5+1,a,7+2,64+1,3,1n,2+6,2,2,3+7,7+9,3,1d+d,1,1+1,1s+3,1d,2+4,2,6,15+8,d+1,x+3,3+1,2+2,1l,2+1,4,2+2,1n+7,3+1,49+2,2+c,2+6,5,7,4+1,5j+1l,2+4,ek,3+1,r+4,1e+4,6+5,2p+c,1+3,1,1+2,1+b,2db+2,3y,2p+v,ff+3,30+1,n9x,1+2,2+9,x+1,29+1,7l,4,5,q+1,6,48+1,r+h,e,13+7,q+a,1b+2,1d,3+3,3+1,14,1w+5,3+1,3+1,d,9,1c,1g,2+2,3+1,6+1,2,17+1,9,6n,3,5,fn5,ki+f,h+f,5s,6y+2,ea,6b,46+4,1af+2,2+1,6+3,15+2,5,4m+1,fy+3,as+1,4a+a,4x,1j+e,1l+2,1e+3,3+1,1y+2,11+4,2+7,1r,d+1,1h+8,b+3,3,2o+2,3,2+1,7,4h,4+7,m+1,1m+1,4,12+6,4+4,5g+7,3+2,2,o,2d+5,2,5+1,2+1,6n+3,7+1,2+1,s+1,2e+7,3,2+1,2z,2,3+5,2,2u+2,3+3,2+4,78+8,2+1,75+1,2,5,41+3,3+1,5,x+9,15+5,3+3,9,a+5,3+2,1b+c,2+1,bb+6,2+5,2,2b+l,3+6,2+1,2+1,3f+5,4,2+1,2+6,2,21+1,4,2,9o+1,470+8,at4+4,1o+6,t5,1s+3,2a,f5l+1,2+3,43o+2,a+7,1+7,3+6,v+3,45+2,1j0+1i,5+1d,9,f,n+4,2+e,11t+6,2+g,3+6,2+1,2+4,7a+6,c6+3,15t+6,32+6,1,gzau,v+2n,3l+6n"},i=1,s=2,o=4,l=8,c=16,u=32;let h;function A(X){if(!h){const Y={R:s,L:i,D:o,C:c,U:u,T:l};h=new Map;for(let M in n){let E=0;n[M].split(",").forEach(O=>{let[P,q]=O.split("+");P=parseInt(P,36),q=q?parseInt(q,36):0,h.set(E+=P,Y[M]);for(let k=q;k--;)h.set(++E,Y[M])})}}return h.get(X)||u}const f=1,p=2,y=3,G=4,B=[null,"isol","init","fina","medi"];function S(X){const Y=new Uint8Array(X.length);let M=u,E=f,O=-1;for(let P=0;P<X.length;P++){const q=X.codePointAt(P);let k=A(q)|0,le=f;k&l||(M&(i|o|c)?k&(s|o|c)?(le=y,(E===f||E===y)&&Y[O]++):k&(i|u)&&(E===p||E===G)&&Y[O]--:M&(s|u)&&(E===p||E===G)&&Y[O]--,E=Y[P]=le,M=k,O=P,q>65535&&P++)}return Y}function N(X,Y){const M=[];for(let O=0;O<Y.length;O++){const P=Y.codePointAt(O);P>65535&&O++,M.push(a.U.codeToGlyph(X,P))}const E=X.GSUB;if(E){const{lookupList:O,featureList:P}=E;let q;const k=/^(rlig|liga|mset|isol|init|fina|medi|half|pres|blws|ccmp)$/,le=[];P.forEach(F=>{if(k.test(F.tag))for(let j=0;j<F.tab.length;j++){if(le[F.tab[j]])continue;le[F.tab[j]]=!0;const Q=O[F.tab[j]],ce=/^(isol|init|fina|medi)$/.test(F.tag);ce&&!q&&(q=S(Y));for(let oe=0;oe<M.length;oe++)(!q||!ce||B[q[oe]]===F.tag)&&a.U._applySubs(M,oe,Q,O)}})}return M}function R(X,Y){const M=new Int16Array(Y.length*3);let E=0;for(;E<Y.length;E++){const k=Y[E];if(k===-1)continue;M[E*3+2]=X.hmtx.aWidth[k];const le=X.GPOS;if(le){const F=le.lookupList;for(let j=0;j<F.length;j++){const Q=F[j];for(let ce=0;ce<Q.tabs.length;ce++){const oe=Q.tabs[ce];if(Q.ltype===1){if(a._lctf.coverageIndex(oe.coverage,k)!==-1&&oe.pos){q(oe.pos,E);break}}else if(Q.ltype===2){let T=null,$=O();if($!==-1){const ae=a._lctf.coverageIndex(oe.coverage,Y[$]);if(ae!==-1){if(oe.fmt===1){const Ie=oe.pairsets[ae];for(let be=0;be<Ie.length;be++)Ie[be].gid2===k&&(T=Ie[be])}else if(oe.fmt===2){const Ie=a.U._getGlyphClass(Y[$],oe.classDef1),be=a.U._getGlyphClass(k,oe.classDef2);T=oe.matrix[Ie][be]}if(T){T.val1&&q(T.val1,$),T.val2&&q(T.val2,E);break}}}}else if(Q.ltype===4){const T=a._lctf.coverageIndex(oe.markCoverage,k);if(T!==-1){const $=O(P),ae=$===-1?-1:a._lctf.coverageIndex(oe.baseCoverage,Y[$]);if(ae!==-1){const Ie=oe.markArray[T],be=oe.baseArray[ae][Ie.markClass];M[E*3]=be.x-Ie.x+M[$*3]-M[$*3+2],M[E*3+1]=be.y-Ie.y+M[$*3+1];break}}}else if(Q.ltype===6){const T=a._lctf.coverageIndex(oe.mark1Coverage,k);if(T!==-1){const $=O();if($!==-1){const ae=Y[$];if(w(X,ae)===3){const Ie=a._lctf.coverageIndex(oe.mark2Coverage,ae);if(Ie!==-1){const be=oe.mark1Array[T],D=oe.mark2Array[Ie][be.markClass];M[E*3]=D.x-be.x+M[$*3]-M[$*3+2],M[E*3+1]=D.y-be.y+M[$*3+1];break}}}}}}}}else if(X.kern&&!X.cff){const F=O();if(F!==-1){const j=X.kern.glyph1.indexOf(Y[F]);if(j!==-1){const Q=X.kern.rval[j].glyph2.indexOf(k);Q!==-1&&(M[F*3+2]+=X.kern.rval[j].vals[Q])}}}}return M;function O(k){for(let le=E-1;le>=0;le--)if(Y[le]!==-1&&(!k||k(Y[le])))return le;return-1}function P(k){return w(X,k)===1}function q(k,le){for(let F=0;F<3;F++)M[le*3+F]+=k[F]||0}}function w(X,Y){const M=X.GDEF&&X.GDEF.glyphClassDef;return M?a.U._getGlyphClass(Y,M):0}function V(...X){for(let Y=0;Y<X.length;Y++)if(typeof X[Y]=="number")return X[Y]}function H(X){const Y=Object.create(null),M=X["OS/2"],E=X.hhea,O=X.head.unitsPerEm,P=V(M&&M.sTypoAscender,E&&E.ascender,O),q={unitsPerEm:O,ascender:P,descender:V(M&&M.sTypoDescender,E&&E.descender,0),capHeight:V(M&&M.sCapHeight,P),xHeight:V(M&&M.sxHeight,P),lineGap:V(M&&M.sTypoLineGap,E&&E.lineGap),supportsCodePoint(k){return a.U.codeToGlyph(X,k)>0},forEachGlyph(k,le,F,j){let Q=0;const ce=1/q.unitsPerEm*le,oe=N(X,k);let T=0;const $=R(X,oe);return oe.forEach((ae,Ie)=>{if(ae!==-1){let be=Y[ae];if(!be){const{cmds:D,crds:de}=a.U.glyphToPath(X,ae);let ee="",Ce=0;for(let Ke=0,Qe=D.length;Ke<Qe;Ke++){const Le=t[D[Ke]];ee+=D[Ke];for(let dt=1;dt<=Le;dt++)ee+=(dt>1?",":"")+de[Ce++]}let we,Ye,Ee,pt;if(de.length){we=Ye=1/0,Ee=pt=-1/0;for(let Ke=0,Qe=de.length;Ke<Qe;Ke+=2){let Le=de[Ke],dt=de[Ke+1];Le<we&&(we=Le),dt<Ye&&(Ye=dt),Le>Ee&&(Ee=Le),dt>pt&&(pt=dt)}}else we=Ee=Ye=pt=0;be=Y[ae]={index:ae,advanceWidth:X.hmtx.aWidth[ae],xMin:we,yMin:Ye,xMax:Ee,yMax:pt,path:ee}}j.call(null,be,Q+$[Ie*3]*ce,$[Ie*3+1]*ce,T),Q+=$[Ie*3+2]*ce,F&&(Q+=F*le)}T+=k.codePointAt(T)>65535?2:1}),Q}};return q}return function(Y){const M=new Uint8Array(Y,0,4),E=a._bin.readASCII(M,0,4);if(E==="wOFF")Y=e(Y);else if(E==="wOF2")throw new Error("woff2 fonts not supported");return H(a.parse(Y)[0])}}const o4=VC({name:"Typr Font Parser",dependencies:[i4,a4,s4],init(a,e,t){const n=a(),i=e();return t(n,i)}});function r4(){return(function(a){var e=function(){this.buckets=new Map};e.prototype.add=function(R){var w=R>>5;this.buckets.set(w,(this.buckets.get(w)||0)|1<<(31&R))},e.prototype.has=function(R){var w=this.buckets.get(R>>5);return w!==void 0&&(w&1<<(31&R))!=0},e.prototype.serialize=function(){var R=[];return this.buckets.forEach((function(w,V){R.push((+V).toString(36)+":"+w.toString(36))})),R.join(",")},e.prototype.deserialize=function(R){var w=this;this.buckets.clear(),R.split(",").forEach((function(V){var H=V.split(":");w.buckets.set(parseInt(H[0],36),parseInt(H[1],36))}))};var t=Math.pow(2,8),n=t-1,i=~n;function s(R){var w=(function(H){return H&i})(R).toString(16),V=(function(H){return(H&i)+t-1})(R).toString(16);return"codepoint-index/plane"+(R>>16)+"/"+w+"-"+V+".json"}function o(R,w){var V=R&n,H=w.codePointAt(V/6|0);return((H=(H||48)-48)&1<<V%6)!=0}function l(R,w){var V;(V=R,V.replace(/U\+/gi,"").replace(/^,+|,+$/g,"").split(/,+/).map((function(H){return H.split("-").map((function(X){return parseInt(X.trim(),16)}))}))).forEach((function(H){var X=H[0],Y=H[1];Y===void 0&&(Y=X),w(X,Y)}))}function c(R,w){l(R,(function(V,H){for(var X=V;X<=H;X++)w(X)}))}var u={},h={},A=new WeakMap,f="https://cdn.jsdelivr.net/gh/lojjic/unicode-font-resolver@v1.0.1/packages/data";function p(R){var w=A.get(R);return w||(w=new e,c(R.ranges,(function(V){return w.add(V)})),A.set(R,w)),w}var y,G=new Map;function B(R,w,V){return R[w]?w:R[V]?V:(function(H){for(var X in H)return X})(R)}function S(R,w){var V=w;if(!R.includes(V)){V=1/0;for(var H=0;H<R.length;H++)Math.abs(R[H]-w)<Math.abs(V-w)&&(V=R[H])}return V}function N(R){return y||(y=new Set,c("9-D,20,85,A0,1680,2000-200A,2028-202F,205F,3000",(function(w){y.add(w)}))),y.has(R)}return a.CodePointSet=e,a.clearCache=function(){u={},h={}},a.getFontsForString=function(R,w){w===void 0&&(w={});var V,H=w.lang;H===void 0&&(H=new RegExp("\\p{Script=Hangul}","u").test(V=R)?"ko":new RegExp("\\p{Script=Hiragana}|\\p{Script=Katakana}","u").test(V)?"ja":"en");var X=w.category;X===void 0&&(X="sans-serif");var Y=w.style;Y===void 0&&(Y="normal");var M=w.weight;M===void 0&&(M=400);var E=(w.dataUrl||f).replace(/\/$/g,""),O=new Map,P=new Uint8Array(R.length),q={},k={},le=new Array(R.length),F=new Map,j=!1;function Q(T){var $=G.get(T);return $||($=fetch(E+"/"+T).then((function(ae){if(!ae.ok)throw new Error(ae.statusText);return ae.json().then((function(Ie){if(!Array.isArray(Ie)||Ie[0]!==1)throw new Error("Incorrect schema version; need 1, got "+Ie[0]);return Ie[1]}))})).catch((function(ae){if(E!==f)return j||(console.error('unicode-font-resolver: Failed loading from dataUrl "'+E+'", trying default CDN. '+ae.message),j=!0),E=f,G.delete(T),Q(T);throw ae})),G.set(T,$)),$}for(var ce=function(T){var $=R.codePointAt(T),ae=s($);le[T]=ae,u[ae]||F.has(ae)||F.set(ae,Q(ae).then((function(Ie){u[ae]=Ie}))),$>65535&&(T++,oe=T)},oe=0;oe<R.length;oe++)ce(oe);return Promise.all(F.values()).then((function(){F.clear();for(var T=function(ae){var Ie=R.codePointAt(ae),be=null,D=u[le[ae]],de=void 0;for(var ee in D){var Ce=k[ee];if(Ce===void 0&&(Ce=k[ee]=new RegExp(ee).test(H||"en")),Ce){for(var we in de=ee,D[ee])if(o(Ie,D[ee][we])){be=we;break}break}}if(!be){e:for(var Ye in D)if(Ye!==de){for(var Ee in D[Ye])if(o(Ie,D[Ye][Ee])){be=Ee;break e}}}be||(console.debug("No font coverage for U+"+Ie.toString(16)),be="latin"),le[ae]=be,h[be]||F.has(be)||F.set(be,Q("font-meta/"+be+".json").then((function(pt){h[be]=pt}))),Ie>65535&&(ae++,$=ae)},$=0;$<R.length;$++)T($);return Promise.all(F.values())})).then((function(){for(var T,$=null,ae=0;ae<R.length;ae++){var Ie=R.codePointAt(ae);if($&&(N(Ie)||p($).has(Ie)))P[ae]=P[ae-1];else{$=h[le[ae]];var be=q[$.id];if(!be){var D=$.typeforms,de=B(D,X,"sans-serif"),ee=B(D[de],Y,"normal"),Ce=S((T=D[de])===null||T===void 0?void 0:T[ee],M);be=q[$.id]=E+"/font-files/"+$.id+"/"+de+"."+ee+"."+Ce+".woff"}var we=O.get(be);we==null&&(we=O.size,O.set(be,we)),P[ae]=we}Ie>65535&&(ae++,P[ae]=P[ae-1])}return{fontUrls:Array.from(O.keys()),chars:P}}))},Object.defineProperty(a,"__esModule",{value:!0}),a})({})}function l4(a,e){const t=Object.create(null),n=Object.create(null);function i(o,l){const c=u=>{console.error(`Failure loading font ${o}`,u)};try{const u=new XMLHttpRequest;u.open("get",o,!0),u.responseType="arraybuffer",u.onload=function(){if(u.status>=400)c(new Error(u.statusText));else if(u.status>0)try{const h=a(u.response);h.src=o,l(h)}catch(h){c(h)}},u.onerror=c,u.send()}catch(u){c(u)}}function s(o,l){let c=t[o];c?l(c):n[o]?n[o].push(l):(n[o]=[l],i(o,u=>{u.src=o,t[o]=u,n[o].forEach(h=>h(u)),delete n[o]}))}return function(o,l,{lang:c,fonts:u=[],style:h="normal",weight:A="normal",unicodeFontsURL:f}={}){const p=new Uint8Array(o.length),y=[];o.length||N();const G=new Map,B=[];if(h!=="italic"&&(h="normal"),typeof A!="number"&&(A=A==="bold"?700:400),u&&!Array.isArray(u)&&(u=[u]),u=u.slice().filter(w=>!w.lang||w.lang.test(c)).reverse(),u.length){let X=0;(function Y(M=0){for(let E=M,O=o.length;E<O;E++){const P=o.codePointAt(E);if(X===1&&y[p[E-1]].supportsCodePoint(P)||E>0&&/\s/.test(o[E]))p[E]=p[E-1],X===2&&(B[B.length-1][1]=E);else for(let q=p[E],k=u.length;q<=k;q++)if(q===k){const le=X===2?B[B.length-1]:B[B.length]=[E,E];le[1]=E,X=2}else{p[E]=q;const{src:le,unicodeRange:F}=u[q];if(!F||R(P,F)){const j=t[le];if(!j){s(le,()=>{Y(E)});return}if(j.supportsCodePoint(P)){let Q=G.get(j);typeof Q!="number"&&(Q=y.length,y.push(j),G.set(j,Q)),p[E]=Q,X=1;break}}}P>65535&&E+1<O&&(p[E+1]=p[E],E++,X===2&&(B[B.length-1][1]=E))}S()})()}else B.push([0,o.length-1]),S();function S(){if(B.length){const w=B.map(V=>o.substring(V[0],V[1]+1)).join(`
`);e.getFontsForString(w,{lang:c||void 0,style:h,weight:A,dataUrl:f}).then(({fontUrls:V,chars:H})=>{const X=y.length;let Y=0;B.forEach(E=>{for(let O=0,P=E[1]-E[0];O<=P;O++)p[E[0]+O]=H[Y++]+X;Y++});let M=0;V.forEach((E,O)=>{s(E,P=>{y[O+X]=P,++M===V.length&&N()})})})}else N()}function N(){l({chars:p,fonts:y})}function R(w,V){for(let H=0;H<V.length;H++){const[X,Y=X]=V[H];if(X<=w&&w<=Y)return!0}return!1}}}const c4=VC({name:"FontResolver",dependencies:[l4,o4,r4],init(a,e,t){return a(e,t())}});function g4(a,e){const n=/[\u00AD\u034F\u061C\u115F-\u1160\u17B4-\u17B5\u180B-\u180E\u200B-\u200F\u202A-\u202E\u2060-\u206F\u3164\uFE00-\uFE0F\uFEFF\uFFA0\uFFF0-\uFFF8]/,i="[^\\S\\u00A0]",s=new RegExp(`${i}|[\\-\\u007C\\u00AD\\u2010\\u2012-\\u2014\\u2027\\u2056\\u2E17\\u2E40]`);function o({text:y,lang:G,fonts:B,style:S,weight:N,preResolvedFonts:R,unicodeFontsURL:w},V){const H=({chars:X,fonts:Y})=>{let M,E;const O=[];for(let P=0;P<X.length;P++)X[P]!==E?(E=X[P],O.push(M={start:P,end:P,fontObj:Y[X[P]]})):M.end=P;V(O)};R?H(R):a(y,H,{lang:G,fonts:B,style:S,weight:N,unicodeFontsURL:w})}function l({text:y="",font:G,lang:B,sdfGlyphSize:S=64,fontSize:N=400,fontWeight:R=1,fontStyle:w="normal",letterSpacing:V=0,lineHeight:H="normal",maxWidth:X=1/0,direction:Y,textAlign:M="left",textIndent:E=0,whiteSpace:O="normal",overflowWrap:P="normal",anchorX:q=0,anchorY:k=0,metricsOnly:le=!1,unicodeFontsURL:F,preResolvedFonts:j=null,includeCaretPositions:Q=!1,chunkedBoundsSize:ce=8192,colorRanges:oe=null},T){const $=A(),ae={fontLoad:0,typesetting:0};y.indexOf("\r")>-1&&(console.info("Typesetter: got text with \\r chars; normalizing to \\n"),y=y.replace(/\r\n/g,`
`).replace(/\r/g,`
`)),N=+N,V=+V,X=+X,H=H||"normal",E=+E,o({text:y,lang:B,style:w,weight:R,fonts:typeof G=="string"?[{src:G}]:G,unicodeFontsURL:F,preResolvedFonts:j},Ie=>{ae.fontLoad=A()-$;const be=isFinite(X);let D=null,de=null,ee=null,Ce=null,we=null,Ye=null,Ee=null,pt=null,Ke=0,Qe=0,Le=O!=="nowrap";const dt=new Map,se=A();let ht=E,it=0,Fe=new f;const st=[Fe];Ie.forEach(He=>{const{fontObj:Me}=He,{ascender:It,descender:ft,unitsPerEm:Ht,lineGap:kt,capHeight:Pe,xHeight:je}=Me;let ot=dt.get(Me);if(!ot){const Re=N/Ht,lt=H==="normal"?(It-ft+kt)*Re:H*N,Kt=(lt-(It-ft)*Re)/2,gt=Math.min(lt,(It-ft)*Re),qe=(It+ft)/2*Re+gt/2;ot={index:dt.size,src:Me.src,fontObj:Me,fontSizeMult:Re,unitsPerEm:Ht,ascender:It*Re,descender:ft*Re,capHeight:Pe*Re,xHeight:je*Re,lineHeight:lt,baseline:-Kt-It*Re,caretTop:qe,caretBottom:qe-gt},dt.set(Me,ot)}const{fontSizeMult:he}=ot,Ve=y.slice(He.start,He.end+1);let Ct,ye;Me.forEachGlyph(Ve,N,V,(Re,lt,Kt,gt)=>{lt+=it,gt+=He.start,Ct=lt,ye=Re;const qe=y.charAt(gt),vt=Re.advanceWidth*he,Ut=Fe.count;let Ot;if("isEmpty"in Re||(Re.isWhitespace=!!qe&&new RegExp(i).test(qe),Re.canBreakAfter=!!qe&&s.test(qe),Re.isEmpty=Re.xMin===Re.xMax||Re.yMin===Re.yMax||n.test(qe)),!Re.isWhitespace&&!Re.isEmpty&&Qe++,Le&&be&&!Re.isWhitespace&&lt+vt+ht>X&&Ut){if(Fe.glyphAt(Ut-1).glyphObj.canBreakAfter)Ot=new f,ht=-lt;else for(let Rn=Ut;Rn--;)if(Rn===0&&P==="break-word"){Ot=new f,ht=-lt;break}else if(Fe.glyphAt(Rn).glyphObj.canBreakAfter){Ot=Fe.splitAt(Rn+1);const Kn=Ot.glyphAt(0).x;ht-=Kn;for(let Ci=Ot.count;Ci--;)Ot.glyphAt(Ci).x-=Kn;break}Ot&&(Fe.isSoftWrapped=!0,Fe=Ot,st.push(Fe),Ke=X)}let $t=Fe.glyphAt(Fe.count);$t.glyphObj=Re,$t.x=lt+ht,$t.y=Kt,$t.width=vt,$t.charIndex=gt,$t.fontData=ot,qe===`
`&&(Fe=new f,st.push(Fe),ht=-(lt+vt+V*N)+E)}),it=Ct+ye.advanceWidth*he+V*N});let ie=0;st.forEach(He=>{let Me=!0;for(let It=He.count;It--;){const ft=He.glyphAt(It);Me&&!ft.glyphObj.isWhitespace&&(He.width=ft.x+ft.width,He.width>Ke&&(Ke=He.width),Me=!1);let{lineHeight:Ht,capHeight:kt,xHeight:Pe,baseline:je}=ft.fontData;Ht>He.lineHeight&&(He.lineHeight=Ht);const ot=je-He.baseline;ot<0&&(He.baseline+=ot,He.cap+=ot,He.ex+=ot),He.cap=Math.max(He.cap,He.baseline+kt),He.ex=Math.max(He.ex,He.baseline+Pe)}He.baseline-=ie,He.cap-=ie,He.ex-=ie,ie+=He.lineHeight});let z=0,Ae=0;if(q&&(typeof q=="number"?z=-q:typeof q=="string"&&(z=-Ke*(q==="left"?0:q==="center"?.5:q==="right"?1:u(q)))),k&&(typeof k=="number"?Ae=-k:typeof k=="string"&&(Ae=k==="top"?0:k==="top-baseline"?-st[0].baseline:k==="top-cap"?-st[0].cap:k==="top-ex"?-st[0].ex:k==="middle"?ie/2:k==="bottom"?ie:k==="bottom-baseline"?-st[st.length-1].baseline:u(k)*ie)),!le){const He=e.getEmbeddingLevels(y,Y);D=new Uint16Array(Qe),de=new Uint8Array(Qe),ee=new Float32Array(Qe*2),Ce={},Ee=[1/0,1/0,-1/0,-1/0],pt=[],Q&&(Ye=new Float32Array(y.length*4)),oe&&(we=new Uint8Array(Qe*3));let Me=0,It=-1,ft=-1,Ht,kt;if(st.forEach((Pe,je)=>{let{count:ot,width:he}=Pe;if(ot>0){let Ve=0;for(let gt=ot;gt--&&Pe.glyphAt(gt).glyphObj.isWhitespace;)Ve++;let Ct=0,ye=0;if(M==="center")Ct=(Ke-he)/2;else if(M==="right")Ct=Ke-he;else if(M==="justify"&&Pe.isSoftWrapped){let gt=0;for(let qe=ot-Ve;qe--;)Pe.glyphAt(qe).glyphObj.isWhitespace&&gt++;ye=(Ke-he)/gt}if(ye||Ct){let gt=0;for(let qe=0;qe<ot;qe++){let vt=Pe.glyphAt(qe);const Ut=vt.glyphObj;vt.x+=Ct+gt,ye!==0&&Ut.isWhitespace&&qe<ot-Ve&&(gt+=ye,vt.width+=ye)}}const Re=e.getReorderSegments(y,He,Pe.glyphAt(0).charIndex,Pe.glyphAt(Pe.count-1).charIndex);for(let gt=0;gt<Re.length;gt++){const[qe,vt]=Re[gt];let Ut=1/0,Ot=-1/0;for(let $t=0;$t<ot;$t++)if(Pe.glyphAt($t).charIndex>=qe){let Rn=$t,Kn=$t;for(;Kn<ot;Kn++){let Ci=Pe.glyphAt(Kn);if(Ci.charIndex>vt)break;Kn<ot-Ve&&(Ut=Math.min(Ut,Ci.x),Ot=Math.max(Ot,Ci.x+Ci.width))}for(let Ci=Rn;Ci<Kn;Ci++){const Ge=Pe.glyphAt(Ci);Ge.x=Ot-(Ge.x+Ge.width-Ut)}break}}let lt;const Kt=gt=>lt=gt;for(let gt=0;gt<ot;gt++){const qe=Pe.glyphAt(gt);lt=qe.glyphObj;const vt=lt.index,Ut=He.levels[qe.charIndex]&1;if(Ut){const Ot=e.getMirroredCharacter(y[qe.charIndex]);Ot&&qe.fontData.fontObj.forEachGlyph(Ot,0,0,Kt)}if(Q){const{charIndex:Ot,fontData:$t}=qe,Rn=qe.x+z,Kn=qe.x+qe.width+z;Ye[Ot*4]=Ut?Kn:Rn,Ye[Ot*4+1]=Ut?Rn:Kn,Ye[Ot*4+2]=Pe.baseline+$t.caretBottom+Ae,Ye[Ot*4+3]=Pe.baseline+$t.caretTop+Ae;const Ci=Ot-It;Ci>1&&h(Ye,It,Ci),It=Ot}if(oe){const{charIndex:Ot}=qe;for(;Ot>ft;)ft++,oe.hasOwnProperty(ft)&&(kt=oe[ft])}if(!lt.isWhitespace&&!lt.isEmpty){const Ot=Me++,{fontSizeMult:$t,src:Rn,index:Kn}=qe.fontData,Ci=Ce[Rn]||(Ce[Rn]={});Ci[vt]||(Ci[vt]={path:lt.path,pathBounds:[lt.xMin,lt.yMin,lt.xMax,lt.yMax]});const Ge=qe.x+z,Xe=qe.y+Pe.baseline+Ae;ee[Ot*2]=Ge,ee[Ot*2+1]=Xe;const Je=Ge+lt.xMin*$t,Zt=Xe+lt.yMin*$t,Mt=Ge+lt.xMax*$t,Gt=Xe+lt.yMax*$t;Je<Ee[0]&&(Ee[0]=Je),Zt<Ee[1]&&(Ee[1]=Zt),Mt>Ee[2]&&(Ee[2]=Mt),Gt>Ee[3]&&(Ee[3]=Gt),Ot%ce===0&&(Ht={start:Ot,end:Ot,rect:[1/0,1/0,-1/0,-1/0]},pt.push(Ht)),Ht.end++;const Ft=Ht.rect;if(Je<Ft[0]&&(Ft[0]=Je),Zt<Ft[1]&&(Ft[1]=Zt),Mt>Ft[2]&&(Ft[2]=Mt),Gt>Ft[3]&&(Ft[3]=Gt),D[Ot]=vt,de[Ot]=Kn,oe){const Vt=Ot*3;we[Vt]=kt>>16&255,we[Vt+1]=kt>>8&255,we[Vt+2]=kt&255}}}}}),Ye){const Pe=y.length-It;Pe>1&&h(Ye,It,Pe)}}const Oe=[];dt.forEach(({index:He,src:Me,unitsPerEm:It,ascender:ft,descender:Ht,lineHeight:kt,capHeight:Pe,xHeight:je})=>{Oe[He]={src:Me,unitsPerEm:It,ascender:ft,descender:Ht,lineHeight:kt,capHeight:Pe,xHeight:je}}),ae.typesetting=A()-se,T({glyphIds:D,glyphFontIndices:de,glyphPositions:ee,glyphData:Ce,fontData:Oe,caretPositions:Ye,glyphColors:we,chunkedBounds:pt,fontSize:N,topBaseline:Ae+st[0].baseline,blockBounds:[z,Ae-ie,z+Ke,Ae],visibleBounds:Ee,timings:ae})})}function c(y,G){l({...y,metricsOnly:!0},B=>{const[S,N,R,w]=B.blockBounds;G({width:R-S,height:w-N})})}function u(y){let G=y.match(/^([\d.]+)%$/),B=G?parseFloat(G[1]):NaN;return isNaN(B)?0:B/100}function h(y,G,B){const S=y[G*4],N=y[G*4+1],R=y[G*4+2],w=y[G*4+3],V=(N-S)/B;for(let H=0;H<B;H++){const X=(G+H)*4;y[X]=S+V*H,y[X+1]=S+V*(H+1),y[X+2]=R,y[X+3]=w}}function A(){return(self.performance||Date).now()}function f(){this.data=[]}const p=["glyphObj","x","y","width","charIndex","fontData"];return f.prototype={width:0,lineHeight:0,baseline:0,cap:0,ex:0,isSoftWrapped:!1,get count(){return Math.ceil(this.data.length/p.length)},glyphAt(y){let G=f.flyweight;return G.data=this.data,G.index=y,G},splitAt(y){let G=new f;return G.data=this.data.splice(y*p.length),G}},f.flyweight=p.reduce((y,G,B,S)=>(Object.defineProperty(y,G,{get(){return this.data[this.index*p.length+B]},set(N){this.data[this.index*p.length+B]=N}}),y),{data:null,index:0}),{typeset:l,measure:c}}const dI=()=>(self.performance||Date).now(),Bv=CM();let nN;function u4(a,e,t,n,i,s,o,l,c,u,h=!0){return h?I4(a,e,t,n,i,s,o,l,c,u).then(null,A=>(nN||(console.warn("WebGL SDF generation failed, falling back to JS",A),nN=!0),aN(a,e,t,n,i,s,o,l,c,u))):aN(a,e,t,n,i,s,o,l,c,u)}const G0=[],d4=5;let J2=0;function fM(){const a=dI();for(;G0.length&&dI()-a<d4;)G0.shift()();J2=G0.length?setTimeout(fM,0):0}const I4=(...a)=>new Promise((e,t)=>{G0.push(()=>{const n=dI();try{Bv.webgl.generateIntoCanvas(...a),e({timing:dI()-n})}catch(i){t(i)}}),J2||(J2=setTimeout(fM,0))}),h4=4,C4=2e3,iN={};let A4=0;function aN(a,e,t,n,i,s,o,l,c,u){const h="TroikaTextSDFGenerator_JS_"+A4++%h4;let A=iN[h];return A||(A=iN[h]={workerModule:VC({name:h,workerId:h,dependencies:[CM,dI],init(f,p){const y=f().javascript.generate;return function(...G){const B=p();return{textureData:y(...G),timing:p()-B}}},getTransferables(f){return[f.textureData.buffer]}}),requests:0,idleTimer:null}),A.requests++,clearTimeout(A.idleTimer),A.workerModule(a,e,t,n,i,s).then(({textureData:f,timing:p})=>{const y=dI(),G=new Uint8Array(f.length*4);for(let B=0;B<f.length;B++)G[B*4+u]=f[B];return Bv.webglUtils.renderImageData(o,G,l,c,a,e,1<<3-u),p+=dI()-y,--A.requests===0&&(A.idleTimer=setTimeout(()=>{OJ(h)},C4)),{timing:p}})}function f4(a){a._warm||(Bv.webgl.isSupported(a),a._warm=!0)}const m4=Bv.webglUtils.resizeWebGLCanvasWithoutClearing,Vf={unicodeFontsURL:null,sdfGlyphSize:64,sdfMargin:1/16,sdfExponent:9,textureWidth:2048},p4=new tn;function qh(){return(self.performance||Date).now()}const sN=Object.create(null);function mM(a,e){a=v4({},a);const t=qh(),n=[];if(a.font&&n.push({label:"user",src:G4(a.font)}),a.font=n,a.text=""+a.text,a.sdfGlyphSize=a.sdfGlyphSize||Vf.sdfGlyphSize,a.unicodeFontsURL=a.unicodeFontsURL||Vf.unicodeFontsURL,a.colorRanges!=null){let f={};for(let p in a.colorRanges)if(a.colorRanges.hasOwnProperty(p)){let y=a.colorRanges[p];typeof y!="number"&&(y=p4.set(y).getHex()),f[p]=y}a.colorRanges=f}Object.freeze(a);const{textureWidth:i,sdfExponent:s}=Vf,{sdfGlyphSize:o}=a,l=i/o*4;let c=sN[o];if(!c){const f=document.createElement("canvas");f.width=i,f.height=o*256/l,c=sN[o]={glyphCount:0,sdfGlyphSize:o,sdfCanvas:f,sdfTexture:new fi(f,void 0,void 0,void 0,Pn,Pn),contextLost:!1,glyphsByFont:new Map},c.sdfTexture.generateMipmaps=!1,b4(c)}const{sdfTexture:u,sdfCanvas:h}=c;yM(a).then(f=>{const{glyphIds:p,glyphFontIndices:y,fontData:G,glyphPositions:B,fontSize:S,timings:N}=f,R=[],w=new Float32Array(p.length*4);let V=0,H=0;const X=qh(),Y=G.map(q=>{let k=c.glyphsByFont.get(q.src);return k||c.glyphsByFont.set(q.src,k=new Map),k});p.forEach((q,k)=>{const le=y[k],{src:F,unitsPerEm:j}=G[le];let Q=Y[le].get(q);if(!Q){const{path:ae,pathBounds:Ie}=f.glyphData[F][q],be=Math.max(Ie[2]-Ie[0],Ie[3]-Ie[1])/o*(Vf.sdfMargin*o+.5),D=c.glyphCount++,de=[Ie[0]-be,Ie[1]-be,Ie[2]+be,Ie[3]+be];Y[le].set(q,Q={path:ae,atlasIndex:D,sdfViewBox:de}),R.push(Q)}const{sdfViewBox:ce}=Q,oe=B[H++],T=B[H++],$=S/j;w[V++]=oe+ce[0]*$,w[V++]=T+ce[1]*$,w[V++]=oe+ce[2]*$,w[V++]=T+ce[3]*$,p[k]=Q.atlasIndex}),N.quads=(N.quads||0)+(qh()-X);const M=qh();N.sdf={};const E=h.height,O=Math.ceil(c.glyphCount/l),P=Math.pow(2,Math.ceil(Math.log2(O*o)));P>E&&(console.info(`Increasing SDF texture size ${E}->${P}`),m4(h,i,P),u.dispose()),Promise.all(R.map(q=>pM(q,c,a.gpuAccelerateSDF).then(({timing:k})=>{N.sdf[q.atlasIndex]=k}))).then(()=>{R.length&&!c.contextLost&&(bM(c),u.needsUpdate=!0),N.sdfTotal=qh()-M,N.total=qh()-t,e(Object.freeze({parameters:a,sdfTexture:u,sdfGlyphSize:o,sdfExponent:s,glyphBounds:w,glyphAtlasIndices:p,glyphColors:f.glyphColors,caretPositions:f.caretPositions,chunkedBounds:f.chunkedBounds,ascender:f.ascender,descender:f.descender,lineHeight:f.lineHeight,capHeight:f.capHeight,xHeight:f.xHeight,topBaseline:f.topBaseline,blockBounds:f.blockBounds,visibleBounds:f.visibleBounds,timings:f.timings}))})}),Promise.resolve().then(()=>{c.contextLost||f4(h)})}function pM({path:a,atlasIndex:e,sdfViewBox:t},{sdfGlyphSize:n,sdfCanvas:i,contextLost:s},o){if(s)return Promise.resolve({timing:-1});const{textureWidth:l,sdfExponent:c}=Vf,u=Math.max(t[2]-t[0],t[3]-t[1]),h=Math.floor(e/4),A=h%(l/n)*n,f=Math.floor(h/(l/n))*n,p=e%4;return u4(n,n,a,t,u,c,i,A,f,p,o)}function b4(a){const e=a.sdfCanvas;e.addEventListener("webglcontextlost",t=>{console.log("Context Lost",t),t.preventDefault(),a.contextLost=!0}),e.addEventListener("webglcontextrestored",t=>{console.log("Context Restored",t),a.contextLost=!1;const n=[];a.glyphsByFont.forEach(i=>{i.forEach(s=>{n.push(pM(s,a,!0))})}),Promise.all(n).then(()=>{bM(a),a.sdfTexture.needsUpdate=!0})})}function y4({font:a,characters:e,sdfGlyphSize:t},n){let i=Array.isArray(e)?e.join(`
`):""+e;mM({font:a,sdfGlyphSize:t,text:i},n)}function v4(a,e){for(let t in e)e.hasOwnProperty(t)&&(a[t]=e[t]);return a}let g0;function G4(a){return g0||(g0=typeof document>"u"?{}:document.createElement("a")),g0.href=a,g0.href}function bM(a){if(typeof createImageBitmap!="function"){console.info("Safari<15: applying SDF canvas workaround");const{sdfCanvas:e,sdfTexture:t}=a,{width:n,height:i}=e,s=a.sdfCanvas.getContext("webgl");let o=t.image.data;(!o||o.length!==n*i*4)&&(o=new Uint8Array(n*i*4),t.image={width:n,height:i,data:o},t.flipY=!1,t.isDataTexture=!0),s.readPixels(0,0,n,i,s.RGBA,s.UNSIGNED_BYTE,o)}}const B4=VC({name:"Typesetter",dependencies:[g4,c4,JJ],init(a,e,t){return a(e,t())}}),yM=VC({name:"Typesetter",dependencies:[B4],init(a){return function(e){return new Promise(t=>{a.typeset(e,t)})}},getTransferables(a){const e=[];for(let t in a)a[t]&&a[t].buffer&&e.push(a[t].buffer);return e}});yM.onMainThread;const oN={};function S4(a){let e=oN[a];return e||(e=oN[a]=new Xl(1,1,a,a).translate(.5,.5,0)),e}const x4="aTroikaGlyphBounds",rN="aTroikaGlyphIndex",Z4="aTroikaGlyphColor";class w4 extends mv{constructor(){super(),this.detail=1,this.curveRadius=0,this.groups=[{start:0,count:1/0,materialIndex:0},{start:0,count:1/0,materialIndex:1}],this.boundingSphere=new Ha,this.boundingBox=new Za}computeBoundingSphere(){}computeBoundingBox(){}set detail(e){if(e!==this._detail){this._detail=e,(typeof e!="number"||e<1)&&(e=1);let t=S4(e);["position","normal","uv"].forEach(n=>{this.attributes[n]=t.attributes[n].clone()}),this.setIndex(t.getIndex().clone())}}get detail(){return this._detail}set curveRadius(e){e!==this._curveRadius&&(this._curveRadius=e,this._updateBounds())}get curveRadius(){return this._curveRadius}updateGlyphs(e,t,n,i,s){this.updateAttributeData(x4,e,4),this.updateAttributeData(rN,t,1),this.updateAttributeData(Z4,s,3),this._blockBounds=n,this._chunkedBounds=i,this.instanceCount=t.length,this._updateBounds()}_updateBounds(){const e=this._blockBounds;if(e){const{curveRadius:t,boundingBox:n}=this;if(t){const{PI:i,floor:s,min:o,max:l,sin:c,cos:u}=Math,h=i/2,A=i*2,f=Math.abs(t),p=e[0]/f,y=e[2]/f,G=s((p+h)/A)!==s((y+h)/A)?-f:o(c(p)*f,c(y)*f),B=s((p-h)/A)!==s((y-h)/A)?f:l(c(p)*f,c(y)*f),S=s((p+i)/A)!==s((y+i)/A)?f*2:l(f-u(p)*f,f-u(y)*f);n.min.set(G,e[1],t<0?-S:0),n.max.set(B,e[3],t<0?0:S)}else n.min.set(e[0],e[1],0),n.max.set(e[2],e[3],0);n.getBoundingSphere(this.boundingSphere)}}applyClipRect(e){let t=this.getAttribute(rN).count,n=this._chunkedBounds;if(n)for(let i=n.length;i--;){t=n[i].end;let s=n[i].rect;if(s[1]<e.w&&s[3]>e.y&&s[0]<e.z&&s[2]>e.x)break}this.instanceCount=t}updateAttributeData(e,t,n){const i=this.getAttribute(e);t?i&&i.array.length===t.length?(i.array.set(t),i.needsUpdate=!0):(this.setAttribute(e,new CI(t,n)),delete this._maxInstanceCount,this.dispose()):i&&this.deleteAttribute(e)}}const R4=`
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform vec4 uTroikaTotalBounds;
uniform vec4 uTroikaClipRect;
uniform mat3 uTroikaOrient;
uniform bool uTroikaUseGlyphColors;
uniform float uTroikaEdgeOffset;
uniform float uTroikaBlurRadius;
uniform vec2 uTroikaPositionOffset;
uniform float uTroikaCurveRadius;
attribute vec4 aTroikaGlyphBounds;
attribute float aTroikaGlyphIndex;
attribute vec3 aTroikaGlyphColor;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec3 vTroikaGlyphColor;
varying vec2 vTroikaGlyphDimensions;
`,N4=`
vec4 bounds = aTroikaGlyphBounds;
bounds.xz += uTroikaPositionOffset.x;
bounds.yw -= uTroikaPositionOffset.y;

vec4 outlineBounds = vec4(
  bounds.xy - uTroikaEdgeOffset - uTroikaBlurRadius,
  bounds.zw + uTroikaEdgeOffset + uTroikaBlurRadius
);
vec4 clippedBounds = vec4(
  clamp(outlineBounds.xy, uTroikaClipRect.xy, uTroikaClipRect.zw),
  clamp(outlineBounds.zw, uTroikaClipRect.xy, uTroikaClipRect.zw)
);

vec2 clippedXY = (mix(clippedBounds.xy, clippedBounds.zw, position.xy) - bounds.xy) / (bounds.zw - bounds.xy);

position.xy = mix(bounds.xy, bounds.zw, clippedXY);

uv = (position.xy - uTroikaTotalBounds.xy) / (uTroikaTotalBounds.zw - uTroikaTotalBounds.xy);

float rad = uTroikaCurveRadius;
if (rad != 0.0) {
  float angle = position.x / rad;
  position.xz = vec2(sin(angle) * rad, rad - cos(angle) * rad);
  normal.xz = vec2(sin(angle), cos(angle));
}
  
position = uTroikaOrient * position;
normal = uTroikaOrient * normal;

vTroikaGlyphUV = clippedXY.xy;
vTroikaGlyphDimensions = vec2(bounds[2] - bounds[0], bounds[3] - bounds[1]);


float txCols = uTroikaSDFTextureSize.x / uTroikaSDFGlyphSize;
vec2 txUvPerSquare = uTroikaSDFGlyphSize / uTroikaSDFTextureSize;
vec2 txStartUV = txUvPerSquare * vec2(
  mod(floor(aTroikaGlyphIndex / 4.0), txCols),
  floor(floor(aTroikaGlyphIndex / 4.0) / txCols)
);
vTroikaTextureUVBounds = vec4(txStartUV, vec2(txStartUV) + txUvPerSquare);
vTroikaTextureChannel = mod(aTroikaGlyphIndex, 4.0);
`,W4=`
uniform sampler2D uTroikaSDFTexture;
uniform vec2 uTroikaSDFTextureSize;
uniform float uTroikaSDFGlyphSize;
uniform float uTroikaSDFExponent;
uniform float uTroikaEdgeOffset;
uniform float uTroikaFillOpacity;
uniform float uTroikaBlurRadius;
uniform vec3 uTroikaStrokeColor;
uniform float uTroikaStrokeWidth;
uniform float uTroikaStrokeOpacity;
uniform bool uTroikaSDFDebug;
varying vec2 vTroikaGlyphUV;
varying vec4 vTroikaTextureUVBounds;
varying float vTroikaTextureChannel;
varying vec2 vTroikaGlyphDimensions;

float troikaSdfValueToSignedDistance(float alpha) {
  // Inverse of exponential encoding in webgl-sdf-generator
  
  float maxDimension = max(vTroikaGlyphDimensions.x, vTroikaGlyphDimensions.y);
  float absDist = (1.0 - pow(2.0 * (alpha > 0.5 ? 1.0 - alpha : alpha), 1.0 / uTroikaSDFExponent)) * maxDimension;
  float signedDist = absDist * (alpha > 0.5 ? -1.0 : 1.0);
  return signedDist;
}

float troikaGlyphUvToSdfValue(vec2 glyphUV) {
  vec2 textureUV = mix(vTroikaTextureUVBounds.xy, vTroikaTextureUVBounds.zw, glyphUV);
  vec4 rgba = texture2D(uTroikaSDFTexture, textureUV);
  float ch = floor(vTroikaTextureChannel + 0.5); //NOTE: can't use round() in WebGL1
  return ch == 0.0 ? rgba.r : ch == 1.0 ? rgba.g : ch == 2.0 ? rgba.b : rgba.a;
}

float troikaGlyphUvToDistance(vec2 uv) {
  return troikaSdfValueToSignedDistance(troikaGlyphUvToSdfValue(uv));
}

float troikaGetAADist() {
  
  #if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300
  return length(fwidth(vTroikaGlyphUV * vTroikaGlyphDimensions)) * 0.5;
  #else
  return vTroikaGlyphDimensions.x / 64.0;
  #endif
}

float troikaGetFragDistValue() {
  vec2 clampedGlyphUV = clamp(vTroikaGlyphUV, 0.5 / uTroikaSDFGlyphSize, 1.0 - 0.5 / uTroikaSDFGlyphSize);
  float distance = troikaGlyphUvToDistance(clampedGlyphUV);
 
  // Extrapolate distance when outside bounds:
  distance += clampedGlyphUV == vTroikaGlyphUV ? 0.0 : 
    length((vTroikaGlyphUV - clampedGlyphUV) * vTroikaGlyphDimensions);

  

  return distance;
}

float troikaGetEdgeAlpha(float distance, float distanceOffset, float aaDist) {
  #if defined(IS_DEPTH_MATERIAL) || defined(IS_DISTANCE_MATERIAL)
  float alpha = step(-distanceOffset, -distance);
  #else

  float alpha = smoothstep(
    distanceOffset + aaDist,
    distanceOffset - aaDist,
    distance
  );
  #endif

  return alpha;
}
`,V4=`
float aaDist = troikaGetAADist();
float fragDistance = troikaGetFragDistValue();
float edgeAlpha = uTroikaSDFDebug ?
  troikaGlyphUvToSdfValue(vTroikaGlyphUV) :
  troikaGetEdgeAlpha(fragDistance, uTroikaEdgeOffset, max(aaDist, uTroikaBlurRadius));

#if !defined(IS_DEPTH_MATERIAL) && !defined(IS_DISTANCE_MATERIAL)
vec4 fillRGBA = gl_FragColor;
fillRGBA.a *= uTroikaFillOpacity;
vec4 strokeRGBA = uTroikaStrokeWidth == 0.0 ? fillRGBA : vec4(uTroikaStrokeColor, uTroikaStrokeOpacity);
if (fillRGBA.a == 0.0) fillRGBA.rgb = strokeRGBA.rgb;
gl_FragColor = mix(fillRGBA, strokeRGBA, smoothstep(
  -uTroikaStrokeWidth - aaDist,
  -uTroikaStrokeWidth + aaDist,
  fragDistance
));
gl_FragColor.a *= edgeAlpha;
#endif

if (edgeAlpha == 0.0) {
  discard;
}
`;function M4(a){const e=j2(a,{chained:!0,extensions:{derivatives:!0},uniforms:{uTroikaSDFTexture:{value:null},uTroikaSDFTextureSize:{value:new yt},uTroikaSDFGlyphSize:{value:0},uTroikaSDFExponent:{value:0},uTroikaTotalBounds:{value:new ri(0,0,0,0)},uTroikaClipRect:{value:new ri(0,0,0,0)},uTroikaEdgeOffset:{value:0},uTroikaFillOpacity:{value:1},uTroikaPositionOffset:{value:new yt},uTroikaCurveRadius:{value:0},uTroikaBlurRadius:{value:0},uTroikaStrokeWidth:{value:0},uTroikaStrokeColor:{value:new tn},uTroikaStrokeOpacity:{value:1},uTroikaOrient:{value:new Vn},uTroikaUseGlyphColors:{value:!0},uTroikaSDFDebug:{value:!1}},vertexDefs:R4,vertexTransform:N4,fragmentDefs:W4,fragmentColorTransform:V4,customRewriter({vertexShader:t,fragmentShader:n}){let i=/\buniform\s+vec3\s+diffuse\b/;return i.test(n)&&(n=n.replace(i,"varying vec3 vTroikaGlyphColor").replace(/\bdiffuse\b/g,"vTroikaGlyphColor"),i.test(t)||(t=t.replace(AM,`uniform vec3 diffuse;
$&
vTroikaGlyphColor = uTroikaUseGlyphColors ? aTroikaGlyphColor / 255.0 : diffuse;
`))),{vertexShader:t,fragmentShader:n}}});return e.transparent=!0,e.forceSinglePass=!0,Object.defineProperties(e,{isTroikaTextMaterial:{value:!0},shadowSide:{get(){return this.side},set(){}}}),e}const hx=new Wc({color:16777215,side:po,transparent:!0}),lN=8421504,cN=new pn,u0=new ue,JB=new ue,Gf=[],_4=new ue,PB="+x+y";function gN(a){return Array.isArray(a)?a[0]:a}let vM=()=>{const a=new _i(new Xl(1,1),hx);return vM=()=>a,a},GM=()=>{const a=new _i(new Xl(1,1,32,1),hx);return GM=()=>a,a};const X4={type:"syncstart"},Y4={type:"synccomplete"},BM=["font","fontSize","fontStyle","fontWeight","lang","letterSpacing","lineHeight","maxWidth","overflowWrap","text","direction","textAlign","textIndent","whiteSpace","anchorX","anchorY","colorRanges","sdfGlyphSize"],H4=BM.concat("material","color","depthOffset","clipRect","curveRadius","orientation","glyphGeometryDetail");let SM=class extends _i{constructor(){const e=new w4;super(e,null),this.text="",this.anchorX=0,this.anchorY=0,this.curveRadius=0,this.direction="auto",this.font=null,this.unicodeFontsURL=null,this.fontSize=.1,this.fontWeight="normal",this.fontStyle="normal",this.lang=null,this.letterSpacing=0,this.lineHeight="normal",this.maxWidth=1/0,this.overflowWrap="normal",this.textAlign="left",this.textIndent=0,this.whiteSpace="normal",this.material=null,this.color=null,this.colorRanges=null,this.outlineWidth=0,this.outlineColor=0,this.outlineOpacity=1,this.outlineBlur=0,this.outlineOffsetX=0,this.outlineOffsetY=0,this.strokeWidth=0,this.strokeColor=lN,this.strokeOpacity=1,this.fillOpacity=1,this.depthOffset=0,this.clipRect=null,this.orientation=PB,this.glyphGeometryDetail=1,this.sdfGlyphSize=null,this.gpuAccelerateSDF=!0,this.debugSDF=!1}sync(e){this._needsSync&&(this._needsSync=!1,this._isSyncing?(this._queuedSyncs||(this._queuedSyncs=[])).push(e):(this._isSyncing=!0,this.dispatchEvent(X4),mM({text:this.text,font:this.font,lang:this.lang,fontSize:this.fontSize||.1,fontWeight:this.fontWeight||"normal",fontStyle:this.fontStyle||"normal",letterSpacing:this.letterSpacing||0,lineHeight:this.lineHeight||"normal",maxWidth:this.maxWidth,direction:this.direction||"auto",textAlign:this.textAlign,textIndent:this.textIndent,whiteSpace:this.whiteSpace,overflowWrap:this.overflowWrap,anchorX:this.anchorX,anchorY:this.anchorY,colorRanges:this.colorRanges,includeCaretPositions:!0,sdfGlyphSize:this.sdfGlyphSize,gpuAccelerateSDF:this.gpuAccelerateSDF,unicodeFontsURL:this.unicodeFontsURL},t=>{this._isSyncing=!1,this._textRenderInfo=t,this.geometry.updateGlyphs(t.glyphBounds,t.glyphAtlasIndices,t.blockBounds,t.chunkedBounds,t.glyphColors);const n=this._queuedSyncs;n&&(this._queuedSyncs=null,this._needsSync=!0,this.sync(()=>{n.forEach(i=>i&&i())})),this.dispatchEvent(Y4),e&&e()})))}onBeforeRender(e,t,n,i,s,o){this.sync(),s.isTroikaTextMaterial&&this._prepareForRender(s)}dispose(){this.geometry.dispose()}get textRenderInfo(){return this._textRenderInfo||null}createDerivedMaterial(e){return M4(e)}get material(){let e=this._derivedMaterial;const t=this._baseMaterial||this._defaultMaterial||(this._defaultMaterial=hx.clone());if((!e||!e.isDerivedFrom(t))&&(e=this._derivedMaterial=this.createDerivedMaterial(t),t.addEventListener("dispose",function n(){t.removeEventListener("dispose",n),e.dispose()})),this.hasOutline()){let n=e._outlineMtl;return n||(n=e._outlineMtl=Object.create(e,{id:{value:e.id+.1}}),n.isTextOutlineMaterial=!0,n.depthWrite=!1,n.map=null,e.addEventListener("dispose",function i(){e.removeEventListener("dispose",i),n.dispose()})),[n,e]}else return e}set material(e){e&&e.isTroikaTextMaterial?(this._derivedMaterial=e,this._baseMaterial=e.baseMaterial):this._baseMaterial=e}hasOutline(){return!!(this.outlineWidth||this.outlineBlur||this.outlineOffsetX||this.outlineOffsetY)}get glyphGeometryDetail(){return this.geometry.detail}set glyphGeometryDetail(e){this.geometry.detail=e}get curveRadius(){return this.geometry.curveRadius}set curveRadius(e){this.geometry.curveRadius=e}get customDepthMaterial(){return gN(this.material).getDepthMaterial()}set customDepthMaterial(e){}get customDistanceMaterial(){return gN(this.material).getDistanceMaterial()}set customDistanceMaterial(e){}_prepareForRender(e){const t=e.isTextOutlineMaterial,n=e.uniforms,i=this.textRenderInfo;if(i){const{sdfTexture:l,blockBounds:c}=i;n.uTroikaSDFTexture.value=l,n.uTroikaSDFTextureSize.value.set(l.image.width,l.image.height),n.uTroikaSDFGlyphSize.value=i.sdfGlyphSize,n.uTroikaSDFExponent.value=i.sdfExponent,n.uTroikaTotalBounds.value.fromArray(c),n.uTroikaUseGlyphColors.value=!t&&!!i.glyphColors;let u=0,h=0,A=0,f,p,y,G=0,B=0;if(t){let{outlineWidth:N,outlineOffsetX:R,outlineOffsetY:w,outlineBlur:V,outlineOpacity:H}=this;u=this._parsePercent(N)||0,h=Math.max(0,this._parsePercent(V)||0),f=H,G=this._parsePercent(R)||0,B=this._parsePercent(w)||0}else A=Math.max(0,this._parsePercent(this.strokeWidth)||0),A&&(y=this.strokeColor,n.uTroikaStrokeColor.value.set(y??lN),p=this.strokeOpacity,p==null&&(p=1)),f=this.fillOpacity;n.uTroikaEdgeOffset.value=u,n.uTroikaPositionOffset.value.set(G,B),n.uTroikaBlurRadius.value=h,n.uTroikaStrokeWidth.value=A,n.uTroikaStrokeOpacity.value=p,n.uTroikaFillOpacity.value=f??1,n.uTroikaCurveRadius.value=this.curveRadius||0;let S=this.clipRect;if(S&&Array.isArray(S)&&S.length===4)n.uTroikaClipRect.value.fromArray(S);else{const N=(this.fontSize||.1)*100;n.uTroikaClipRect.value.set(c[0]-N,c[1]-N,c[2]+N,c[3]+N)}this.geometry.applyClipRect(n.uTroikaClipRect.value)}n.uTroikaSDFDebug.value=!!this.debugSDF,e.polygonOffset=!!this.depthOffset,e.polygonOffsetFactor=e.polygonOffsetUnits=this.depthOffset||0;const s=t?this.outlineColor||0:this.color;if(s==null)delete e.color;else{const l=e.hasOwnProperty("color")?e.color:e.color=new tn;(s!==l._input||typeof s=="object")&&l.set(l._input=s)}let o=this.orientation||PB;if(o!==e._orientation){let l=n.uTroikaOrient.value;o=o.replace(/[^-+xyz]/g,"");let c=o!==PB&&o.match(/^([-+])([xyz])([-+])([xyz])$/);if(c){let[,u,h,A,f]=c;u0.set(0,0,0)[h]=u==="-"?1:-1,JB.set(0,0,0)[f]=A==="-"?-1:1,cN.lookAt(_4,u0.cross(JB),JB),l.setFromMatrix4(cN)}else l.identity();e._orientation=o}}_parsePercent(e){if(typeof e=="string"){let t=e.match(/^(-?[\d.]+)%$/),n=t?parseFloat(t[1]):NaN;e=(isNaN(n)?0:n/100)*this.fontSize}return e}localPositionToTextCoords(e,t=new yt){t.copy(e);const n=this.curveRadius;return n&&(t.x=Math.atan2(e.x,Math.abs(n)-Math.abs(e.z))*Math.abs(n)),t}worldPositionToTextCoords(e,t=new yt){return u0.copy(e),this.localPositionToTextCoords(this.worldToLocal(u0),t)}raycast(e,t){const{textRenderInfo:n,curveRadius:i}=this;if(n){const s=n.blockBounds,o=i?GM():vM(),l=o.geometry,{position:c,uv:u}=l.attributes;for(let h=0;h<u.count;h++){let A=s[0]+u.getX(h)*(s[2]-s[0]);const f=s[1]+u.getY(h)*(s[3]-s[1]);let p=0;i&&(p=i-Math.cos(A/i)*i,A=Math.sin(A/i)*i),c.setXYZ(h,A,f,p)}l.boundingSphere=this.geometry.boundingSphere,l.boundingBox=this.geometry.boundingBox,o.matrixWorld=this.matrixWorld,o.material.side=this.material.side,Gf.length=0,o.raycast(e,Gf);for(let h=0;h<Gf.length;h++)Gf[h].object=this,t.push(Gf[h])}}copy(e){const t=this.geometry;return super.copy(e),this.geometry=t,H4.forEach(n=>{this[n]=e[n]}),this}clone(){return new this.constructor().copy(this)}};BM.forEach(a=>{const e="_private_"+a;Object.defineProperty(SM.prototype,a,{get(){return this[e]},set(t){t!==this[e]&&(this[e]=t,this._needsSync=!0)}})});new Za;new tn;const Cx=J.forwardRef(({sdfGlyphSize:a=64,anchorX:e="center",anchorY:t="middle",font:n,fontSize:i=1,children:s,characters:o,onSync:l,...c},u)=>{const h=Gs(({invalidate:y})=>y),[A]=J.useState(()=>new SM),[f,p]=J.useMemo(()=>{const y=[];let G="";return J.Children.forEach(s,B=>{typeof B=="string"||typeof B=="number"?G+=B:y.push(B)}),[y,G]},[s]);return C3(()=>new Promise(y=>y4({font:n,characters:o},y)),["troika-text",n,o]),J.useLayoutEffect(()=>{A.sync(()=>{h(),l&&l(A)})}),J.useEffect(()=>()=>A.dispose(),[A]),J.createElement("primitive",Eu({object:A,ref:u,font:n,text:p,anchorX:e,anchorY:t,fontSize:i,sdfGlyphSize:a},c),f)}),QB=a=>a===Object(a)&&!Array.isArray(a)&&typeof a!="function";function MC(a,e){const t=Gs(s=>s.gl),n=wg(Av,QB(a)?Object.values(a):a);return J.useLayoutEffect(()=>{e?.(n)},[e]),J.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(n)?s=n:n instanceof fi?s=[n]:QB(n)&&(s=Object.values(n)),s.forEach(o=>{o instanceof fi&&t.initTexture(o)})}},[t,n]),J.useMemo(()=>{if(QB(a)){const s={};let o=0;for(const l in a)s[l]=n[o++];return s}else return n},[a,n])}MC.preload=a=>wg.preload(Av,a);MC.clear=a=>wg.clear(Av,a);const Ax=J.forwardRef(({threshold:a=15,geometry:e,...t},n)=>{const i=J.useRef(null);J.useImperativeHandle(n,()=>i.current,[]);const s=J.useMemo(()=>[0,0,0,1,0,0],[]),o=J.useRef(null),l=J.useRef(null);return J.useLayoutEffect(()=>{const c=i.current.parent,u=e??c?.geometry;if(!u||o.current===u&&l.current===a)return;o.current=u,l.current=a;const A=new WS(u,a).attributes.position.array;i.current.geometry.setPositions(A),i.current.geometry.attributes.instanceStart.needsUpdate=!0,i.current.geometry.attributes.instanceEnd.needsUpdate=!0,i.current.computeLineDistances()}),J.createElement(zJ,Eu({segments:!0,points:s,ref:i,raycast:()=>null},t))}),E4=J.forwardRef(({makeDefault:a,camera:e,regress:t,domElement:n,enableDamping:i=!0,keyEvents:s=!1,onChange:o,onStart:l,onEnd:c,...u},h)=>{const A=Gs(H=>H.invalidate),f=Gs(H=>H.camera),p=Gs(H=>H.gl),y=Gs(H=>H.events),G=Gs(H=>H.setEvents),B=Gs(H=>H.set),S=Gs(H=>H.get),N=Gs(H=>H.performance),R=e||f,w=n||y.connected||p.domElement,V=J.useMemo(()=>new YJ(R),[R]);return ox(()=>{V.enabled&&V.update()},-1),J.useEffect(()=>(s&&V.connect(s===!0?w:s),V.connect(w),()=>{V.dispose()}),[s,w,t,V,A]),J.useEffect(()=>{const H=M=>{A(),t&&N.regress(),o&&o(M)},X=M=>{l&&l(M)},Y=M=>{c&&c(M)};return V.addEventListener("change",H),V.addEventListener("start",X),V.addEventListener("end",Y),()=>{V.removeEventListener("start",X),V.removeEventListener("end",Y),V.removeEventListener("change",H)}},[o,l,c,V,A,G]),J.useEffect(()=>{if(a){const H=S().controls;return B({controls:V}),()=>B({controls:H})}},[a,V]),J.createElement("primitive",Eu({ref:h,object:V,enableDamping:i},u))}),xM=(a,e,t)=>{let n;switch(a){case os:n=new Uint8ClampedArray(e*t*4);break;case Aa:n=new Uint16Array(e*t*4);break;case fr:n=new Uint32Array(e*t*4);break;case Yy:n=new Int8Array(e*t*4);break;case Hy:n=new Int16Array(e*t*4);break;case Nm:n=new Int32Array(e*t*4);break;case $i:n=new Float32Array(e*t*4);break;default:throw new Error("Unsupported data type")}return n};let d0;const F4=(a,e,t,n)=>{if(d0!==void 0)return d0;const i=new yo(1,1,n);e.setRenderTarget(i);const s=new _i(new Xl,new Wc({color:16777215}));e.render(s,t),e.setRenderTarget(null);const o=xM(a,i.width,i.height);return e.readRenderTargetPixels(i,0,0,i.width,i.height,o),i.dispose(),s.geometry.dispose(),s.material.dispose(),d0=o[0]!==0,d0};class fx{_renderer;_rendererIsDisposable=!1;_material;_scene;_camera;_quad;_renderTarget;_width;_height;_type;_colorSpace;_supportsReadPixels=!0;constructor(e){this._width=e.width,this._height=e.height,this._type=e.type,this._colorSpace=e.colorSpace;const t={format:Sa,depthBuffer:!1,stencilBuffer:!1,type:this._type,colorSpace:this._colorSpace,anisotropy:e.renderTargetOptions?.anisotropy!==void 0?e.renderTargetOptions?.anisotropy:1,generateMipmaps:e.renderTargetOptions?.generateMipmaps!==void 0?e.renderTargetOptions?.generateMipmaps:!1,magFilter:e.renderTargetOptions?.magFilter!==void 0?e.renderTargetOptions?.magFilter:Pn,minFilter:e.renderTargetOptions?.minFilter!==void 0?e.renderTargetOptions?.minFilter:Pn,samples:e.renderTargetOptions?.samples!==void 0?e.renderTargetOptions?.samples:void 0,wrapS:e.renderTargetOptions?.wrapS!==void 0?e.renderTargetOptions?.wrapS:Ca,wrapT:e.renderTargetOptions?.wrapT!==void 0?e.renderTargetOptions?.wrapT:Ca};if(this._material=e.material,e.renderer?this._renderer=e.renderer:(this._renderer=fx.instantiateRenderer(),this._rendererIsDisposable=!0),this._scene=new _m,this._camera=new xc,this._camera.position.set(0,0,10),this._camera.left=-.5,this._camera.right=.5,this._camera.top=.5,this._camera.bottom=-.5,this._camera.updateProjectionMatrix(),!F4(this._type,this._renderer,this._camera,t)){let n;this._type===Aa&&(n=this._renderer.extensions.has("EXT_color_buffer_float")?$i:void 0),n!==void 0?(console.warn(`This browser does not support reading pixels from ${this._type} RenderTargets, switching to ${$i}`),this._type=n):(this._supportsReadPixels=!1,console.warn("This browser dos not support toArray or toDataTexture, calls to those methods will result in an error thrown"))}this._quad=new _i(new Xl,this._material),this._quad.geometry.computeBoundingBox(),this._scene.add(this._quad),this._renderTarget=new yo(this.width,this.height,t),this._renderTarget.texture.mapping=e.renderTargetOptions?.mapping!==void 0?e.renderTargetOptions?.mapping:_u}static instantiateRenderer(){const e=new ex;return e.setSize(128,128),e}render=()=>{this._renderer.setRenderTarget(this._renderTarget);try{this._renderer.render(this._scene,this._camera)}catch(e){throw this._renderer.setRenderTarget(null),e}this._renderer.setRenderTarget(null)};toArray(){if(!this._supportsReadPixels)throw new Error("Can't read pixels in this browser");const e=xM(this._type,this._width,this._height);return this._renderer.readRenderTargetPixels(this._renderTarget,0,0,this._width,this._height,e),e}toDataTexture(e){const t=new Lr(this.toArray(),this.width,this.height,Sa,this._type,e?.mapping||_u,e?.wrapS||Ca,e?.wrapT||Ca,e?.magFilter||Pn,e?.minFilter||Pn,e?.anisotropy||1,Ml);return t.generateMipmaps=e?.generateMipmaps!==void 0?e?.generateMipmaps:!1,t}disposeOnDemandRenderer(){this._renderer.setRenderTarget(null),this._rendererIsDisposable&&(this._renderer.dispose(),this._renderer.forceContextLoss())}dispose(e){this.disposeOnDemandRenderer(),e&&this.renderTarget.dispose(),this.material instanceof Ds&&Object.values(this.material.uniforms).forEach(t=>{t.value instanceof fi&&t.value.dispose()}),Object.values(this.material).forEach(t=>{t instanceof fi&&t.dispose()}),this.material.dispose(),this._quad.geometry.dispose()}get width(){return this._width}set width(e){this._width=e,this._renderTarget.setSize(this._width,this._height)}get height(){return this._height}set height(e){this._height=e,this._renderTarget.setSize(this._width,this._height)}get renderer(){return this._renderer}get renderTarget(){return this._renderTarget}set renderTarget(e){this._renderTarget=e,this._width=e.width,this._height=e.height}get material(){return this._material}get type(){return this._type}get colorSpace(){return this._colorSpace}}class ZM extends Error{}class wM extends Error{}const Bf=(a,e,t)=>{const n=new RegExp(`${e}="([^"]*)"`,"i").exec(a);if(n)return n[1];const i=new RegExp(`<${e}[^>]*>([\\s\\S]*?)</${e}>`,"i").exec(a);if(i){const s=i[1].match(/<rdf:li>([^<]*)<\/rdf:li>/g);return s&&s.length===3?s.map(o=>o.replace(/<\/?rdf:li>/g,"")):i[1].trim()}if(t!==void 0)return t;throw new Error(`Can't find ${e} in gainmap metadata`)},K4=a=>{let e;typeof TextDecoder<"u"?e=new TextDecoder().decode(a):e=a.toString();let t=e.indexOf("<x:xmpmeta");for(;t!==-1;){const n=e.indexOf("x:xmpmeta>",t),i=e.slice(t,n+10);try{const s=Bf(i,"hdrgm:GainMapMin","0"),o=Bf(i,"hdrgm:GainMapMax"),l=Bf(i,"hdrgm:Gamma","1"),c=Bf(i,"hdrgm:OffsetSDR","0.015625"),u=Bf(i,"hdrgm:OffsetHDR","0.015625"),h=/hdrgm:HDRCapacityMin="([^"]*)"/.exec(i),A=h?h[1]:"0",f=/hdrgm:HDRCapacityMax="([^"]*)"/.exec(i);if(!f)throw new Error("Incomplete gainmap metadata");const p=f[1];return{gainMapMin:Array.isArray(s)?s.map(y=>parseFloat(y)):[parseFloat(s),parseFloat(s),parseFloat(s)],gainMapMax:Array.isArray(o)?o.map(y=>parseFloat(y)):[parseFloat(o),parseFloat(o),parseFloat(o)],gamma:Array.isArray(l)?l.map(y=>parseFloat(y)):[parseFloat(l),parseFloat(l),parseFloat(l)],offsetSdr:Array.isArray(c)?c.map(y=>parseFloat(y)):[parseFloat(c),parseFloat(c),parseFloat(c)],offsetHdr:Array.isArray(u)?u.map(y=>parseFloat(y)):[parseFloat(u),parseFloat(u),parseFloat(u)],hdrCapacityMin:parseFloat(A),hdrCapacityMax:parseFloat(p)}}catch{}t=e.indexOf("<x:xmpmeta",n)}};class T4{options;constructor(e){this.options={debug:e&&e.debug!==void 0?e.debug:!1,extractFII:e&&e.extractFII!==void 0?e.extractFII:!0,extractNonFII:e&&e.extractNonFII!==void 0?e.extractNonFII:!0}}extract(e){return new Promise((t,n)=>{const i=this.options.debug,s=new DataView(e.buffer);if(s.getUint16(0)!==65496){n(new Error("Not a valid jpeg"));return}const o=s.byteLength;let l=2,c=0,u;for(;l<o;){if(++c>250){n(new Error(`Found no marker after ${c} loops `));return}if(s.getUint8(l)!==255){n(new Error(`Not a valid marker at offset 0x${l.toString(16)}, found: 0x${s.getUint8(l).toString(16)}`));return}if(u=s.getUint8(l+1),i&&console.log(`Marker: ${u.toString(16)}`),u===226){i&&console.log("Found APP2 marker (0xffe2)");const h=l+4;if(s.getUint32(h)===1297106432){const A=h+4;let f;if(s.getUint16(A)===18761)f=!1;else if(s.getUint16(A)===19789)f=!0;else{n(new Error("No valid endianness marker found in TIFF header"));return}if(s.getUint16(A+2,!f)!==42){n(new Error("Not valid TIFF data! (no 0x002A marker)"));return}const p=s.getUint32(A+4,!f);if(p<8){n(new Error("Not valid TIFF data! (First offset less than 8)"));return}const y=A+p,G=s.getUint16(y,!f),B=y+2;let S=0;for(let V=B;V<B+12*G;V+=12)s.getUint16(V,!f)===45057&&(S=s.getUint32(V+8,!f));const R=y+2+G*12+4,w=[];for(let V=R;V<R+S*16;V+=16){const H={MPType:s.getUint32(V,!f),size:s.getUint32(V+4,!f),dataOffset:s.getUint32(V+8,!f),dependantImages:s.getUint32(V+12,!f),start:-1,end:-1,isFII:!1};H.dataOffset?(H.start=A+H.dataOffset,H.isFII=!1):(H.start=0,H.isFII=!0),H.end=H.start+H.size,w.push(H)}if(this.options.extractNonFII&&w.length){const V=new Blob([s]),H=[];for(const X of w){if(X.isFII&&!this.options.extractFII)continue;const Y=V.slice(X.start,X.end+1,"image/jpeg");H.push(Y)}t(H)}}}l+=2+s.getUint16(l+2)}})}}const z4=async a=>{const e=K4(a);if(!e)throw new wM("Gain map XMP metadata not found");const n=await new T4({extractFII:!0,extractNonFII:!0}).extract(a);if(n.length!==2)throw new ZM("Gain map recovery image not found");return{sdr:new Uint8Array(await n[0].arrayBuffer()),gainMap:new Uint8Array(await n[1].arrayBuffer()),metadata:e}},uN=a=>new Promise((e,t)=>{const n=document.createElement("img");n.onload=()=>{e(n)},n.onerror=i=>{t(i)},n.src=URL.createObjectURL(a)});class L4 extends Bo{_renderer;_renderTargetOptions;_internalLoadingManager;_config;constructor(e,t){super(t),this._config=e,e.renderer&&(this._renderer=e.renderer),this._internalLoadingManager=new Cv}setRenderer(e){return this._renderer=e,this}setRenderTargetOptions(e){return this._renderTargetOptions=e,this}prepareQuadRenderer(){this._renderer||console.warn("WARNING: A Renderer was not passed to this Loader constructor or in setRenderer, the result of this Loader will need to be converted to a Data Texture with toDataTexture() before you can use it in your renderer.");const e=this._config.createMaterial({gainMapMax:[1,1,1],gainMapMin:[0,0,0],gamma:[1,1,1],offsetHdr:[1,1,1],offsetSdr:[1,1,1],hdrCapacityMax:1,hdrCapacityMin:0,maxDisplayBoost:1,gainMap:new fi,sdr:new fi});return this._config.createQuadRenderer({width:16,height:16,type:Aa,colorSpace:Ml,material:e,renderer:this._renderer,renderTargetOptions:this._renderTargetOptions})}async processImages(e,t,n){const i=t?new Blob([t],{type:"image/jpeg"}):void 0,s=new Blob([e],{type:"image/jpeg"});let o,l,c=!1;if(typeof createImageBitmap>"u"){const u=await Promise.all([i?uN(i):Promise.resolve(void 0),uN(s)]);l=u[0],o=u[1],c=n==="flipY"}else{const u=await Promise.all([i?createImageBitmap(i,{imageOrientation:n||"flipY"}):Promise.resolve(void 0),createImageBitmap(s,{imageOrientation:n||"flipY"})]);l=u[0],o=u[1]}return{sdrImage:o,gainMapImage:l,needsFlip:c}}createTextures(e,t,n){const i=new fi(t||new ImageData(2,2),_u,Ca,Ca,Pn,G2,Sa,os,1,Ml);i.flipY=n,i.needsUpdate=!0;const s=new fi(e,_u,Ca,Ca,Pn,G2,Sa,os,1,Bs);return s.flipY=n,s.needsUpdate=!0,{gainMap:i,sdr:s}}updateQuadRenderer(e,t,n,i,s){e.width=t.width,e.height=t.height,e.material.gainMap=n,e.material.sdr=i,e.material.gainMapMin=s.gainMapMin,e.material.gainMapMax=s.gainMapMax,e.material.offsetHdr=s.offsetHdr,e.material.offsetSdr=s.offsetSdr,e.material.gamma=s.gamma,e.material.hdrCapacityMin=s.hdrCapacityMin,e.material.hdrCapacityMax=s.hdrCapacityMax,e.material.maxDisplayBoost=Math.pow(2,s.hdrCapacityMax),e.material.needsUpdate=!0}}const k4=`
varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}
`,U4=`
// min half float value
#define HALF_FLOAT_MIN vec3( -65504, -65504, -65504 )
// max half float value
#define HALF_FLOAT_MAX vec3( 65504, 65504, 65504 )

uniform sampler2D sdr;
uniform sampler2D gainMap;
uniform vec3 gamma;
uniform vec3 offsetHdr;
uniform vec3 offsetSdr;
uniform vec3 gainMapMin;
uniform vec3 gainMapMax;
uniform float weightFactor;

varying vec2 vUv;

void main() {
  vec3 rgb = texture2D( sdr, vUv ).rgb;
  vec3 recovery = texture2D( gainMap, vUv ).rgb;
  vec3 logRecovery = pow( recovery, gamma );
  vec3 logBoost = gainMapMin * ( 1.0 - logRecovery ) + gainMapMax * logRecovery;
  vec3 hdrColor = (rgb + offsetSdr) * exp2( logBoost * weightFactor ) - offsetHdr;
  vec3 clampedHdrColor = max( HALF_FLOAT_MIN, min( HALF_FLOAT_MAX, hdrColor ));
  gl_FragColor = vec4( clampedHdrColor , 1.0 );
}
`;class D4 extends Ds{_maxDisplayBoost;_hdrCapacityMin;_hdrCapacityMax;constructor({gamma:e,offsetHdr:t,offsetSdr:n,gainMapMin:i,gainMapMax:s,maxDisplayBoost:o,hdrCapacityMin:l,hdrCapacityMax:c,sdr:u,gainMap:h}){super({name:"GainMapDecoderMaterial",vertexShader:k4,fragmentShader:U4,uniforms:{sdr:{value:u},gainMap:{value:h},gamma:{value:new ue(1/e[0],1/e[1],1/e[2])},offsetHdr:{value:new ue().fromArray(t)},offsetSdr:{value:new ue().fromArray(n)},gainMapMin:{value:new ue().fromArray(i)},gainMapMax:{value:new ue().fromArray(s)},weightFactor:{value:(Math.log2(o)-l)/(c-l)}},blending:Wl,depthTest:!1,depthWrite:!1}),this._maxDisplayBoost=o,this._hdrCapacityMin=l,this._hdrCapacityMax=c,this.needsUpdate=!0,this.uniformsNeedUpdate=!0}get sdr(){return this.uniforms.sdr.value}set sdr(e){this.uniforms.sdr.value=e}get gainMap(){return this.uniforms.gainMap.value}set gainMap(e){this.uniforms.gainMap.value=e}get offsetHdr(){return this.uniforms.offsetHdr.value.toArray()}set offsetHdr(e){this.uniforms.offsetHdr.value.fromArray(e)}get offsetSdr(){return this.uniforms.offsetSdr.value.toArray()}set offsetSdr(e){this.uniforms.offsetSdr.value.fromArray(e)}get gainMapMin(){return this.uniforms.gainMapMin.value.toArray()}set gainMapMin(e){this.uniforms.gainMapMin.value.fromArray(e)}get gainMapMax(){return this.uniforms.gainMapMax.value.toArray()}set gainMapMax(e){this.uniforms.gainMapMax.value.fromArray(e)}get gamma(){const e=this.uniforms.gamma.value;return[1/e.x,1/e.y,1/e.z]}set gamma(e){const t=this.uniforms.gamma.value;t.x=1/e[0],t.y=1/e[1],t.z=1/e[2]}get hdrCapacityMin(){return this._hdrCapacityMin}set hdrCapacityMin(e){this._hdrCapacityMin=e,this.calculateWeight()}get hdrCapacityMax(){return this._hdrCapacityMax}set hdrCapacityMax(e){this._hdrCapacityMax=e,this.calculateWeight()}get maxDisplayBoost(){return this._maxDisplayBoost}set maxDisplayBoost(e){this._maxDisplayBoost=Math.max(1,Math.min(65504,e)),this.calculateWeight()}calculateWeight(){const e=(Math.log2(this._maxDisplayBoost)-this._hdrCapacityMin)/(this._hdrCapacityMax-this._hdrCapacityMin);this.uniforms.weightFactor.value=Math.max(0,Math.min(1,e))}}class RM extends L4{constructor(e,t){super({renderer:e,createMaterial:n=>new D4(n),createQuadRenderer:n=>new fx(n)},t)}async render(e,t,n,i){const{sdrImage:s,gainMapImage:o,needsFlip:l}=await this.processImages(n,i,"flipY"),{gainMap:c,sdr:u}=this.createTextures(s,o,l);this.updateQuadRenderer(e,s,c,u,t),e.render()}}class O4 extends RM{load([e,t,n],i,s,o){const l=this.prepareQuadRenderer();let c,u,h;const A=async()=>{if(c&&u&&h){try{await this.render(l,h,c,u)}catch(M){this.manager.itemError(e),this.manager.itemError(t),this.manager.itemError(n),typeof o=="function"&&o(M),l.disposeOnDemandRenderer();return}typeof i=="function"&&i(l),this.manager.itemEnd(e),this.manager.itemEnd(t),this.manager.itemEnd(n),l.disposeOnDemandRenderer()}};let f=!0,p=0,y=0,G=!0,B=0,S=0,N=!0,R=0,w=0;const V=()=>{if(typeof s=="function"){const M=p+B+R,E=y+S+w,O=f&&G&&N;s(new ProgressEvent("progress",{lengthComputable:O,loaded:E,total:M}))}};this.manager.itemStart(e),this.manager.itemStart(t),this.manager.itemStart(n);const H=new Ar(this._internalLoadingManager);H.setResponseType("arraybuffer"),H.setRequestHeader(this.requestHeader),H.setPath(this.path),H.setWithCredentials(this.withCredentials),H.load(e,async M=>{if(typeof M=="string")throw new Error("Invalid sdr buffer");c=M,await A()},M=>{f=M.lengthComputable,y=M.loaded,p=M.total,V()},M=>{this.manager.itemError(e),typeof o=="function"&&o(M)});const X=new Ar(this._internalLoadingManager);X.setResponseType("arraybuffer"),X.setRequestHeader(this.requestHeader),X.setPath(this.path),X.setWithCredentials(this.withCredentials),X.load(t,async M=>{if(typeof M=="string")throw new Error("Invalid gainmap buffer");u=M,await A()},M=>{G=M.lengthComputable,S=M.loaded,B=M.total,V()},M=>{this.manager.itemError(t),typeof o=="function"&&o(M)});const Y=new Ar(this._internalLoadingManager);return Y.setRequestHeader(this.requestHeader),Y.setPath(this.path),Y.setWithCredentials(this.withCredentials),Y.load(n,async M=>{if(typeof M!="string")throw new Error("Invalid metadata string");h=JSON.parse(M),await A()},M=>{N=M.lengthComputable,w=M.loaded,R=M.total,V()},M=>{this.manager.itemError(n),typeof o=="function"&&o(M)}),l}}class j4 extends RM{load(e,t,n,i){const s=this.prepareQuadRenderer(),o=new Ar(this._internalLoadingManager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(this.withCredentials),this.manager.itemStart(e),o.load(e,async l=>{if(typeof l=="string")throw new Error("Invalid buffer, received [string], was expecting [ArrayBuffer]");const c=new Uint8Array(l);let u,h,A;try{const f=await z4(c);u=f.sdr,h=f.gainMap,A=f.metadata}catch(f){if(f instanceof wM||f instanceof ZM)console.warn(`Failure to reconstruct an HDR image from ${e}: Gain map metadata not found in the file, HDRJPGLoader will render the SDR jpeg`),A={gainMapMin:[0,0,0],gainMapMax:[1,1,1],gamma:[1,1,1],hdrCapacityMin:0,hdrCapacityMax:1,offsetHdr:[0,0,0],offsetSdr:[0,0,0]},u=c;else throw f}try{await this.render(s,A,u.buffer,h?.buffer)}catch(f){this.manager.itemError(e),typeof i=="function"&&i(f),s.disposeOnDemandRenderer();return}typeof t=="function"&&t(s),this.manager.itemEnd(e),s.disposeOnDemandRenderer()},n,l=>{this.manager.itemError(e),typeof i=="function"&&i(l)}),s}}const vm={apartment:"lebombo_1k.hdr",city:"potsdamer_platz_1k.hdr",dawn:"kiara_1_dawn_1k.hdr",forest:"forest_slope_1k.hdr",lobby:"st_fagans_interior_1k.hdr",night:"dikhololo_night_1k.hdr",park:"rooitou_park_1k.hdr",studio:"studio_small_03_1k.hdr",sunset:"venice_sunset_1k.hdr",warehouse:"empty_warehouse_01_1k.hdr"},NM="https://raw.githack.com/pmndrs/drei-assets/456060a26bbeb8fdf79326f224b6d99b8bcce736/hdri/",hC=a=>Array.isArray(a),mx=["/px.png","/nx.png","/py.png","/ny.png","/pz.png","/nz.png"];function Sv({files:a=mx,path:e="",preset:t=void 0,colorSpace:n=void 0,extensions:i}={}){t&&(px(t),a=vm[t],e=NM);const s=hC(a),{extension:o,isCubemap:l}=bx(a),c=yx(o);if(!c)throw new Error("useEnvironment: Unrecognized file extension: "+a);const u=Gs(p=>p.gl);J.useLayoutEffect(()=>{if(o!=="webp"&&o!=="jpg"&&o!=="jpeg")return;function p(){wg.clear(c,s?[a]:a)}u.domElement.addEventListener("webglcontextlost",p,{once:!0})},[a,u.domElement]);const h=wg(c,s?[a]:a,p=>{(o==="webp"||o==="jpg"||o==="jpeg")&&p.setRenderer(u),p.setPath==null||p.setPath(e),i&&i(p)});let A=s?h[0]:h;if(o==="jpg"||o==="jpeg"||o==="webp"){var f;A=(f=A.renderTarget)==null?void 0:f.texture}return A.mapping=l?Vl:CC,A.colorSpace=n??(l?"srgb":"srgb-linear"),A}const J4={files:mx,path:"",preset:void 0,extensions:void 0};Sv.preload=a=>{const e={...J4,...a};let{files:t,path:n=""}=e;const{preset:i,extensions:s}=e;i&&(px(i),t=vm[i],n=NM);const{extension:o}=bx(t);if(o==="webp"||o==="jpg"||o==="jpeg")throw new Error("useEnvironment: Preloading gainmaps is not supported");const l=yx(o);if(!l)throw new Error("useEnvironment: Unrecognized file extension: "+t);wg.preload(l,hC(t)?[t]:t,c=>{c.setPath==null||c.setPath(n),s&&s(c)})};const P4={files:mx,preset:void 0};Sv.clear=a=>{const e={...P4,...a};let{files:t}=e;const{preset:n}=e;n&&(px(n),t=vm[n]);const{extension:i}=bx(t),s=yx(i);if(!s)throw new Error("useEnvironment: Unrecognized file extension: "+t);wg.clear(s,hC(t)?[t]:t)};function px(a){if(!(a in vm))throw new Error("Preset must be one of: "+Object.keys(vm).join(", "))}function bx(a){var e;const t=hC(a)&&a.length===6,n=hC(a)&&a.length===3&&a.some(o=>o.endsWith("json")),i=hC(a)?a[0]:a;return{extension:t?"cube":n?"webp":i.startsWith("data:application/exr")?"exr":i.startsWith("data:application/hdr")?"hdr":i.startsWith("data:image/jpeg")?"jpg":(e=i.split(".").pop())==null||(e=e.split("?"))==null||(e=e.shift())==null?void 0:e.toLowerCase(),isCubemap:t,isGainmap:n}}function yx(a){return a==="cube"?UV:a==="hdr"?HJ:a==="exr"?EJ:a==="jpg"||a==="jpeg"?j4:a==="webp"?O4:null}const Q4=a=>a.current&&a.current.isScene,q4=a=>Q4(a)?a.current:a;function vx(a,e,t,n,i={}){var s,o,l,c;i={backgroundBlurriness:0,backgroundIntensity:1,backgroundRotation:[0,0,0],environmentIntensity:1,environmentRotation:[0,0,0],...i};const u=q4(e||t),h=u.background,A=u.environment,f={backgroundBlurriness:u.backgroundBlurriness,backgroundIntensity:u.backgroundIntensity,backgroundRotation:(s=(o=u.backgroundRotation)==null||o.clone==null?void 0:o.clone())!==null&&s!==void 0?s:[0,0,0],environmentIntensity:u.environmentIntensity,environmentRotation:(l=(c=u.environmentRotation)==null||c.clone==null?void 0:c.clone())!==null&&l!==void 0?l:[0,0,0]};return a!=="only"&&(u.environment=n),a&&(u.background=n),yc(u,i),()=>{a!=="only"&&(u.environment=A),a&&(u.background=h),yc(u,f)}}function Gx({scene:a,background:e=!1,map:t,...n}){const i=Gs(s=>s.scene);return J.useLayoutEffect(()=>{if(t)return vx(e,a,i,t,n)}),null}function WM({background:a=!1,scene:e,blur:t,backgroundBlurriness:n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:o,environmentRotation:l,...c}){const u=Sv(c),h=Gs(A=>A.scene);return J.useLayoutEffect(()=>vx(a,e,h,u,{backgroundBlurriness:t??n,backgroundIntensity:i,backgroundRotation:s,environmentIntensity:o,environmentRotation:l})),J.useEffect(()=>()=>{u.dispose()},[u]),null}function $4({children:a,near:e=.1,far:t=1e3,resolution:n=256,frames:i=1,map:s,background:o=!1,blur:l,backgroundBlurriness:c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:A,environmentRotation:f,scene:p,files:y,path:G,preset:B=void 0,extensions:S}){const N=Gs(Y=>Y.gl),R=Gs(Y=>Y.scene),w=J.useRef(null),[V]=J.useState(()=>new _m),H=J.useMemo(()=>{const Y=new jy(n);return Y.texture.type=Aa,Y},[n]);J.useEffect(()=>()=>{H.dispose()},[H]),J.useLayoutEffect(()=>{if(i===1){const Y=N.autoClear;N.autoClear=!0,w.current.update(N,V),N.autoClear=Y}return vx(o,p,R,H.texture,{backgroundBlurriness:l??c,backgroundIntensity:u,backgroundRotation:h,environmentIntensity:A,environmentRotation:f})},[a,V,H.texture,p,R,o,i,N]);let X=1;return ox(()=>{if(i===1/0||X<i){const Y=N.autoClear;N.autoClear=!0,w.current.update(N,V),N.autoClear=Y,X++}}),J.createElement(J.Fragment,null,KO(J.createElement(J.Fragment,null,a,J.createElement("cubeCamera",{ref:w,args:[e,t,H]}),y||B?J.createElement(WM,{background:!0,files:y,preset:B,path:G,extensions:S}):s?J.createElement(Gx,{background:!0,map:s,extensions:S}):null),V))}function eP(a){var e,t,n,i;const s=Sv(a),o=a.map||s;J.useMemo(()=>Z3({GroundProjectedEnvImpl:wJ}),[]),J.useEffect(()=>()=>{s.dispose()},[s]);const l=J.useMemo(()=>[o],[o]),c=(e=a.ground)==null?void 0:e.height,u=(t=a.ground)==null?void 0:t.radius,h=(n=(i=a.ground)==null?void 0:i.scale)!==null&&n!==void 0?n:1e3;return J.createElement(J.Fragment,null,J.createElement(Gx,Eu({},a,{map:o})),J.createElement("groundProjectedEnvImpl",{args:l,scale:h,height:c,radius:u}))}function tP(a){return a.ground?J.createElement(eP,a):a.map?J.createElement(Gx,a):a.children?J.createElement($4,a):J.createElement(WM,a)}function nP(){const[a]=Wf(()=>({rotation:[-Math.PI/2,0,0],position:[0,0,0],material:{friction:.3,restitution:.1}}));return m.jsxs("group",{children:[m.jsx("mesh",{ref:a,visible:!1,children:m.jsx("planeGeometry",{args:[100,100]})}),m.jsxs("mesh",{position:[0,-.01,0],rotation:[-Math.PI/2,0,0],receiveShadow:!0,children:[m.jsx("planeGeometry",{args:[100,100]}),m.jsx("shadowMaterial",{color:"#000000",transparent:!0,opacity:.3})]})]})}function iP(){return Wf(()=>({position:[0,0,-6],rotation:[0,0,0]})),Wf(()=>({position:[0,0,6],rotation:[0,-Math.PI,0]})),Wf(()=>({position:[-11,0,0],rotation:[0,Math.PI/2,0]})),Wf(()=>({position:[11,0,0],rotation:[0,-Math.PI/2,0]})),null}const aP=(a=1.3,e=1.3)=>{const t=[],n=[],i=[],o=e,l=a,c=Math.pow(Math.tan(18*(Math.PI/180)),2),u=o*c,h=[];h.push(new ue(0,o,0)),h.push(new ue(0,-o,0));const A=Math.PI/5;for(let y=0;y<10;y++){const G=y*A,B=y%2===0;t.push(l*Math.cos(G),B?u:-u,l*Math.sin(G)),h.push(new ue(l*Math.cos(G),B?u:-u,l*Math.sin(G)))}t.unshift(0,-o,0),t.unshift(0,o,0);const f=y=>2+(y%10+10)%10;for(let y=0;y<10;y++){const G=f(y),B=f(y+1);y%2,n.push(0,G,B),n.push(1,B,G)}for(let y=0;y<10;y++){if(y%2!==0){const B=f(y+1),S=f(y),N=f(y-1);i.push(0,B,S,N)}if(y%2===0){const B=f(y-1),S=f(y),N=f(y+1);i.push(1,B,S,N)}}const p=[];for(let y=0;y<10;y++){const G=y%2===0;let B,S,N,R,w=!1;G?(w=!1,B=h[1],S=h[f(y)],N=h[f(y-1)],R=h[f(y+1)]):(w=!0,B=h[0],S=h[f(y)],N=h[f(y+1)],R=h[f(y-1)]);const V=new ue().lerpVectors(S,B,.4),H=new ue().subVectors(B,V).normalize(),X=new ue().subVectors(R,N).normalize(),Y=new ue().crossVectors(X,H).normalize(),M=V.clone().add(Y.clone().multiplyScalar(.04)),E=new pn;E.makeBasis(X,H,Y);const O=new vo;O.setFromRotationMatrix(E);let P=y+1;w?P=y+1:(P=y+1,P===10&&(P=0)),p.push({position:[M.x,M.y,M.z],rotation:[O.x,O.y,O.z],value:P===0?10:P,normal:[Y.x,Y.y,Y.z],isTop:w})}return{vertices:Float32Array.from(t),indices:n,physicsIndices:i,faceData:p}},dN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3e%3ctitle%3eface_1-2%3c/title%3e%3c/svg%3e",IN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20701.25%20702.89'%3e%3cdefs%3e%3cstyle%3e.a{fill:%23fff;}%3c/style%3e%3c/defs%3e%3ctitle%3eface_3-4%3c/title%3e%3cpath%20class='a'%20d='M636.85,836.73c-6.36-13.2-12.93-26.28-19.06-39.61-9.91-21.61-17.86-45.75-53.14-28.63l-.19-5.94A128.07,128.07,0,0,1,577,744.15c28.71-30.11,58-59.74,86.82-89.77,15.55-16.2,13.53-24.38-8.17-31.15a106.39,106.39,0,0,0-28.11-4.59c-29-.79-26.93,0-33.08,28.16-5.72,26.26-19.48,49.82-41.52,73.48-7.56-26.16-12.92-47.8-20.32-68.71-2.48-7-10.06-12.23-15.3-18.25-5.11,5.62-10.51,11-15.12,16.88a26.33,26.33,0,0,0-3.26,9.62c-5.28,21.82-15.61,44.94,21.75,57.07-23.72,13.06-42.57,10.87-55.19-.41-18.74-16.66-32.84-38.43-49.36-57.66a32.17,32.17,0,0,0-14.49-10.93,123.24,123.24,0,0,0-30.44-3.12c-5.49.17-11,3-16.54,4.63,1.69,5.35,2,12,5.39,15.93,18.61,21.79,38.26,42.73,57.12,64.26,20.08,22.85,19.92,24.41,3.58,49.08-10.52,15.88-20.79,32-31.27,47.86-.23.34-1.27,0-3.1.43.82-12.86,1.6-25.59,2.7-43.75l-35.3,20.56-4.18-2.57c6.43-11.85,13.31-23.5,19-35.66,2.07-4.45,3.72-11.72,1.41-14.88s-9.8-3.79-14.47-2.62c-22,4.81-43.88,9.94-65.59,15.8-25,6.74-27.14,5-23.39-21.43q2.22-16.27,3.87-32.51c1.57-15.22-4.81-22.48-20.74-23.12-46.88-1.9-46.6-2.19-26.48-45.84,3.84-8.08,4.53-17.49,6.7-26.29a187.94,187.94,0,0,0-27.16,3.12c-14.76,3.88-29.14,9.14-43.66,14l-3.11-5c13.56-16.83,25.61-34.84,41-49.68,40.65-39.1,55.83-88.66,64-142.06a308,308,0,0,1,11.27-43.49c7.91-25.67,5.82-30.68-19.31-42.46a61.33,61.33,0,0,1-8.78-5.09c-1-.67-1.34-2.22-2.86-4.91,26.49-6.14,23-21.24,14.1-40.92-7.41-16.57-10.1-35.3-14.41-53.16-5.2-21.68-9.92-43.51-15.07-66.1,19.81,18.11,39.05,37.62,60.33,54.57,19.48,15.52,41.17,28.28,61.95,42.25,1.09.74,2.73.89,3.62,1.81,22.11,22.21,45.8,38.5,78.58,21.46,40,25.78,78.81-13.67,119-2a145.17,145.17,0,0,0,48.17,3.63,41.88,41.88,0,0,0,25.33-11.56c36.31-37.69,71.81-76.09,107-114.85,11.65-12.67,21.89-26.9,32.78-40.37l6.18,2.27c-2.93,28.79-6.36,57.59-8.51,86.36-.88,12.33,1.79,25.2,2.2,37.85.14,4.43-2.59,9-2.36,13.4a211.17,211.17,0,0,0,3.27,22.65c1,6.4,2.66,12.75,3.15,19.21.08,2.33-2,5-3.41,7.32-18.31,31.13-20.82,63-9.17,97.66,6.16,18.42,6.7,38.9,8.47,58.56,1.66,18.4,8.69,32,25.12,41.71,22.1,13,43.27,27.64,69.6,44.67l-51.32,18c-21.77,7.63-22.27,9.86-10.88,30.24,9,16.11,16.92,32.91,25.32,49.37l-5.23,5.58c-14.88-3.63-29.63-7.25-44.57-10.3a62.46,62.46,0,0,0-15.39.7c.16,5.12-.64,10.8,1.31,15.21,9.42,21.54,19.65,42.74,29.6,64l-4.31,4.93-63.16-30.08-6.23,5.29,43.87,89.6c-15.57-3.6-25.78-5.07-35.4-8.25-19.39-6.47-38.56-13.69-57.7-21-11.45-4.39-16.66-.49-17.59,11.35-1.23,15.29-2.87,30.55-4.31,45.85ZM461.92,523c-4.93-9.35-10.91-24.49-20.1-37.32C424.27,461.25,367.47,458,349.4,480c-16.57,20.09-32.77,40.57-47.91,61.76A21.18,21.18,0,0,0,300.38,561a238.29,238.29,0,0,0,32,39.69c20.9,20.32,43.94,21.55,68.33,6,8-5.06,16.41-9.79,24.71-14.49C449.8,578.42,459.29,556.26,461.92,523Zm193-62.59C623.11,464,591,478,569.64,511c-8.94,13.82-13.12,28.1-4.61,44.22,10.26,19.35,59.44,43.19,80.56,38.42a17.08,17.08,0,0,0,5.76-2c23.72-17.16,48.73-32.55,59-62.69C723.28,491.35,700.22,458.76,654.89,460.38Z'%20transform='translate(-155.97%20-133.83)'/%3e%3c/svg%3e",sP="/Assimilacao-RPG-Manager/assets/face_5-Deu_WqkK.svg",oP="/Assimilacao-RPG-Manager/assets/face_6-DkZc4qdA.svg",rP="/Assimilacao-RPG-Manager/assets/face_7-hLl4lXoG.svg",lP="/Assimilacao-RPG-Manager/assets/face_8-CORFa3kF.svg",cP="/Assimilacao-RPG-Manager/assets/face_9-ve6IVDt2.svg",gP="/Assimilacao-RPG-Manager/assets/face_10-CZW-rl86.svg",hN={1:{path:dN,scale:1},2:{path:dN,scale:1},3:{path:IN,scale:1},4:{path:IN,scale:1},5:{path:sP,scale:1.2},6:{path:oP,scale:1},7:{path:rP,scale:1.2},8:{path:lP,scale:1.2},9:{path:cP,scale:1.3},10:{path:gP,scale:1.3}},uP=({value:a,detectedValue:e,position:t,rotation:n})=>{const i=hN[a]||hN[1],s=MC(i.path);s.center.set(.5,.5),s.repeat.set(1,1);const o=e===a,l=o?"#39ff14":"#ffffff",c=new ue(...t).multiplyScalar(.97);return m.jsxs("mesh",{position:c,rotation:n,children:[m.jsx("planeGeometry",{args:[i.scale,i.scale]}),m.jsx("meshStandardMaterial",{map:s,transparent:!0,side:po,color:l,emissive:l,emissiveIntensity:o?4:2,toneMapped:!1,roughness:.1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4})]})},dP=({position:a=[0,5,0],onStop:e})=>{const{vertices:t,indices:n,physicsIndices:i,faceData:s}=J.useMemo(()=>aP(1.5,1.2),[]),o=J.useMemo(()=>{const y=[];for(let B=0;B<t.length;B+=3)y.push([t[B],t[B+1],t[B+2]]);const G=[];for(let B=0;B<i.length;B+=4)G.push([i[B],i[B+1],i[B+2],i[B+3]]);return[y,G]},[t,i]),[l,c]=aM(()=>({mass:1,position:a,args:o,material:{friction:.1,restitution:.5},linearDamping:.2,angularDamping:.2})),u=J.useRef([0,0,0]),h=J.useRef(!0),A=J.useRef([]);A.current.length!==10&&(A.current=Array(10).fill(null));const[f,p]=J.useState(null);return J.useEffect(()=>{c.wakeUp();const y=[(Math.random()-.5)*4,12+Math.random()*5,-25-Math.random()*10];c.applyImpulse(y,[Math.random(),-1,Math.random()]),c.applyTorque([(Math.random()-.5)*35,(Math.random()-.5)*35,(Math.random()-.5)*35])},[c]),J.useEffect(()=>c.velocity.subscribe(y=>u.current=y),[c.velocity]),J.useEffect(()=>{const y=new ue,G=new xa,B=new ue,S=setInterval(()=>{if(!h.current)return;const N=u.current;if(Math.abs(N[0])<.05&&Math.abs(N[1])<.05&&Math.abs(N[2])<.05&&l.current){let R=-1/0,w=-1;if(A.current.forEach((V,H)=>{V&&(V.getWorldPosition(y),y.y>R&&(R=y.y,w=H))}),w!==-1){if(A.current[w].getWorldQuaternion(G),B.set(0,0,1).applyQuaternion(G),B.y<.9){c.wakeUp(),c.applyImpulse([0,8,0],[Math.random()*.1,-1,Math.random()*.1]);return}h.current=!1;const H=s[w].value;p(H),e&&e(H)}}},200);return()=>clearInterval(S)},[s,e,c]),m.jsxs("mesh",{ref:l,castShadow:!0,receiveShadow:!0,children:[m.jsxs("bufferGeometry",{onUpdate:y=>y.computeVertexNormals(),children:[m.jsx("bufferAttribute",{attach:"attributes-position",count:t.length/3,itemSize:3,array:t,args:[t,3]}),m.jsx("bufferAttribute",{attach:"index",count:n.length,itemSize:1,array:new Uint16Array(n),args:[new Uint16Array(n),1]})]}),m.jsx("meshPhysicalMaterial",{color:"#1a1a3a",transmission:.95,thickness:2,roughness:.1,metalness:0,ior:1.5,clearcoat:1,side:wc,transparent:!0}),m.jsx(Ax,{threshold:30,color:"#ffffff"}),s.map((y,G)=>m.jsxs(xg.Fragment,{children:[m.jsx(uP,{value:y.value,detectedValue:f,position:y.position,rotation:y.rotation}),m.jsx("group",{position:y.position,rotation:y.rotation,ref:B=>A.current[G]=B,children:m.jsx(Cx,{visible:!1,fontSize:.5,children:y.value===10?"0":y.value.toString()})})]},G))]})},IP=(a=1.5)=>{const e=(1+Math.sqrt(5))/2,t=[[-1,-1,-1],[-1,-1,1],[-1,1,-1],[-1,1,1],[1,-1,-1],[1,-1,1],[1,1,-1],[1,1,1],[0,-1/e,-e],[0,-1/e,e],[0,1/e,-e],[0,1/e,e],[-1/e,-e,0],[-1/e,e,0],[1/e,-e,0],[1/e,e,0],[-e,0,-1/e],[e,0,-1/e],[-e,0,1/e],[e,0,1/e]].map(l=>new ue(l[0],l[1],l[2]).normalize().multiplyScalar(a)),n=[];t.forEach(l=>n.push(l.x,l.y,l.z));const i=[[3,11,7,15,13],[7,19,17,6,15],[17,4,8,10,6],[8,0,16,2,10],[0,12,1,18,16],[6,10,2,13,15],[2,16,18,3,13],[18,1,9,11,3],[4,14,12,0,8],[11,9,5,19,7],[19,5,14,4,17],[1,12,14,5,9]],s=[];i.forEach(l=>{s.push(l[0],l[1],l[2]),s.push(l[0],l[2],l[3]),s.push(l[0],l[3],l[4])});const o=[];return i.forEach((l,c)=>{const u=new ue;l.forEach(f=>u.add(t[f])),u.divideScalar(5);const h=u.clone().normalize(),A=new ti;A.position.copy(u),A.lookAt(u.clone().add(h)),A.rotateZ(Math.PI/1),o.push({position:[u.x,u.y,u.z],rotation:[A.rotation.x,A.rotation.y,A.rotation.z],value:c+1})}),{vertices:Float32Array.from(n),indices:s,physicsIndices:i.flat(),physicsFaces:i,faceData:o}},CN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3e%3ctitle%3eface_1-2%3c/title%3e%3c/svg%3e",AN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20701.25%20702.89'%3e%3cdefs%3e%3cstyle%3e.a{fill:%23fff;}%3c/style%3e%3c/defs%3e%3ctitle%3eface_3-4%3c/title%3e%3cpath%20class='a'%20d='M636.85,836.73c-6.36-13.2-12.93-26.28-19.06-39.61-9.91-21.61-17.86-45.75-53.14-28.63l-.19-5.94A128.07,128.07,0,0,1,577,744.15c28.71-30.11,58-59.74,86.82-89.77,15.55-16.2,13.53-24.38-8.17-31.15a106.39,106.39,0,0,0-28.11-4.59c-29-.79-26.93,0-33.08,28.16-5.72,26.26-19.48,49.82-41.52,73.48-7.56-26.16-12.92-47.8-20.32-68.71-2.48-7-10.06-12.23-15.3-18.25-5.11,5.62-10.51,11-15.12,16.88a26.33,26.33,0,0,0-3.26,9.62c-5.28,21.82-15.61,44.94,21.75,57.07-23.72,13.06-42.57,10.87-55.19-.41-18.74-16.66-32.84-38.43-49.36-57.66a32.17,32.17,0,0,0-14.49-10.93,123.24,123.24,0,0,0-30.44-3.12c-5.49.17-11,3-16.54,4.63,1.69,5.35,2,12,5.39,15.93,18.61,21.79,38.26,42.73,57.12,64.26,20.08,22.85,19.92,24.41,3.58,49.08-10.52,15.88-20.79,32-31.27,47.86-.23.34-1.27,0-3.1.43.82-12.86,1.6-25.59,2.7-43.75l-35.3,20.56-4.18-2.57c6.43-11.85,13.31-23.5,19-35.66,2.07-4.45,3.72-11.72,1.41-14.88s-9.8-3.79-14.47-2.62c-22,4.81-43.88,9.94-65.59,15.8-25,6.74-27.14,5-23.39-21.43q2.22-16.27,3.87-32.51c1.57-15.22-4.81-22.48-20.74-23.12-46.88-1.9-46.6-2.19-26.48-45.84,3.84-8.08,4.53-17.49,6.7-26.29a187.94,187.94,0,0,0-27.16,3.12c-14.76,3.88-29.14,9.14-43.66,14l-3.11-5c13.56-16.83,25.61-34.84,41-49.68,40.65-39.1,55.83-88.66,64-142.06a308,308,0,0,1,11.27-43.49c7.91-25.67,5.82-30.68-19.31-42.46a61.33,61.33,0,0,1-8.78-5.09c-1-.67-1.34-2.22-2.86-4.91,26.49-6.14,23-21.24,14.1-40.92-7.41-16.57-10.1-35.3-14.41-53.16-5.2-21.68-9.92-43.51-15.07-66.1,19.81,18.11,39.05,37.62,60.33,54.57,19.48,15.52,41.17,28.28,61.95,42.25,1.09.74,2.73.89,3.62,1.81,22.11,22.21,45.8,38.5,78.58,21.46,40,25.78,78.81-13.67,119-2a145.17,145.17,0,0,0,48.17,3.63,41.88,41.88,0,0,0,25.33-11.56c36.31-37.69,71.81-76.09,107-114.85,11.65-12.67,21.89-26.9,32.78-40.37l6.18,2.27c-2.93,28.79-6.36,57.59-8.51,86.36-.88,12.33,1.79,25.2,2.2,37.85.14,4.43-2.59,9-2.36,13.4a211.17,211.17,0,0,0,3.27,22.65c1,6.4,2.66,12.75,3.15,19.21.08,2.33-2,5-3.41,7.32-18.31,31.13-20.82,63-9.17,97.66,6.16,18.42,6.7,38.9,8.47,58.56,1.66,18.4,8.69,32,25.12,41.71,22.1,13,43.27,27.64,69.6,44.67l-51.32,18c-21.77,7.63-22.27,9.86-10.88,30.24,9,16.11,16.92,32.91,25.32,49.37l-5.23,5.58c-14.88-3.63-29.63-7.25-44.57-10.3a62.46,62.46,0,0,0-15.39.7c.16,5.12-.64,10.8,1.31,15.21,9.42,21.54,19.65,42.74,29.6,64l-4.31,4.93-63.16-30.08-6.23,5.29,43.87,89.6c-15.57-3.6-25.78-5.07-35.4-8.25-19.39-6.47-38.56-13.69-57.7-21-11.45-4.39-16.66-.49-17.59,11.35-1.23,15.29-2.87,30.55-4.31,45.85ZM461.92,523c-4.93-9.35-10.91-24.49-20.1-37.32C424.27,461.25,367.47,458,349.4,480c-16.57,20.09-32.77,40.57-47.91,61.76A21.18,21.18,0,0,0,300.38,561a238.29,238.29,0,0,0,32,39.69c20.9,20.32,43.94,21.55,68.33,6,8-5.06,16.41-9.79,24.71-14.49C449.8,578.42,459.29,556.26,461.92,523Zm193-62.59C623.11,464,591,478,569.64,511c-8.94,13.82-13.12,28.1-4.61,44.22,10.26,19.35,59.44,43.19,80.56,38.42a17.08,17.08,0,0,0,5.76-2c23.72-17.16,48.73-32.55,59-62.69C723.28,491.35,700.22,458.76,654.89,460.38Z'%20transform='translate(-155.97%20-133.83)'/%3e%3c/svg%3e",hP="/Assimilacao-RPG-Manager/assets/face_5-nml9OUZ7.svg",CP="/Assimilacao-RPG-Manager/assets/face_6-DkZc4qdA.svg",AP="/Assimilacao-RPG-Manager/assets/face_7-tUXIo1nP.svg",fP="/Assimilacao-RPG-Manager/assets/face_8-CJ4R6EOx.svg",mP="/Assimilacao-RPG-Manager/assets/face_9-CZ6rSCP2.svg",pP="/Assimilacao-RPG-Manager/assets/face_10-B8XKAlO6.svg",bP="/Assimilacao-RPG-Manager/assets/face_11-D9ltscgb.svg",yP="/Assimilacao-RPG-Manager/assets/face_12-BfE6W8ho.svg",fN={1:{path:CN,scale:1},2:{path:CN,scale:1},3:{path:AN,scale:1},4:{path:AN,scale:1},5:{path:hP,scale:1.2},6:{path:CP,scale:1},7:{path:AP,scale:1.2},8:{path:fP,scale:1.2},9:{path:mP,scale:1.2},10:{path:pP,scale:1.2},11:{path:bP,scale:1.4},12:{path:yP,scale:1.2}},vP=({value:a,detectedValue:e,position:t,rotation:n})=>{const i=fN[a]||fN[1],s=MC(i.path);s.center.set(.5,.5),s.repeat.set(1,1);const o=e===a,l=o?"#39ff14":"#ffffff",c=new ue(...t).multiplyScalar(.97);return m.jsxs("mesh",{position:c,rotation:n,children:[m.jsx("planeGeometry",{args:[i.scale,i.scale]}),m.jsx("meshStandardMaterial",{map:s,transparent:!0,side:po,color:l,emissive:l,emissiveIntensity:o?4:2,toneMapped:!1,roughness:.1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4})]})},GP=({position:a=[0,5,0],onStop:e})=>{const{vertices:t,indices:n,physicsFaces:i,faceData:s}=J.useMemo(()=>IP(1.5),[]),o=J.useMemo(()=>{const y=[];for(let G=0;G<t.length;G+=3)y.push([t[G],t[G+1],t[G+2]]);return[y,i]},[t,i]),[l,c]=aM(()=>({mass:1,position:a,args:o,material:{friction:.1,restitution:.5},linearDamping:.2,angularDamping:.2})),u=J.useRef([0,0,0]),h=J.useRef(!0),A=J.useRef([]);A.current.length!==12&&(A.current=Array(12).fill(null));const[f,p]=J.useState(null);return J.useEffect(()=>{c.wakeUp();const y=[(Math.random()-.5)*4,12+Math.random()*5,-25-Math.random()*10];c.applyImpulse(y,[Math.random(),-1,Math.random()]),c.applyTorque([(Math.random()-.5)*35,(Math.random()-.5)*35,(Math.random()-.5)*35])},[c]),J.useEffect(()=>c.velocity.subscribe(y=>u.current=y),[c.velocity]),J.useEffect(()=>{const y=new ue,G=new xa,B=new ue,S=setInterval(()=>{if(!h.current)return;const N=u.current;if(Math.abs(N[0])<.05&&Math.abs(N[1])<.05&&Math.abs(N[2])<.05&&l.current){let R=-1/0,w=-1;if(A.current.forEach((V,H)=>{V&&(V.getWorldPosition(y),y.y>R&&(R=y.y,w=H))}),w!==-1){if(A.current[w].getWorldQuaternion(G),B.set(0,0,1).applyQuaternion(G),B.y<.9){c.wakeUp(),c.applyImpulse([0,7,0],[Math.random()*.1,-1,Math.random()*.1]);return}h.current=!1;const H=s[w].value;p(H),e&&e(H)}}},200);return()=>clearInterval(S)},[s,e,c]),m.jsxs("mesh",{ref:l,castShadow:!0,receiveShadow:!0,children:[m.jsxs("bufferGeometry",{onUpdate:y=>y.computeVertexNormals(),children:[m.jsx("bufferAttribute",{attach:"attributes-position",count:t.length/3,itemSize:3,array:t,args:[t,3]}),m.jsx("bufferAttribute",{attach:"index",count:n.length,itemSize:1,array:new Uint16Array(n),args:[new Uint16Array(n),1]})]}),m.jsx("meshPhysicalMaterial",{color:"#1a1a3a",transmission:.95,thickness:2,roughness:.1,metalness:0,ior:1.5,clearcoat:1,side:Ss,flatShading:!0,transparent:!0}),m.jsx(Ax,{threshold:30,color:"#ffffff"}),s.map((y,G)=>m.jsxs(xg.Fragment,{children:[m.jsx(vP,{value:y.value,detectedValue:f,position:y.position,rotation:y.rotation}),m.jsx("group",{position:y.position,rotation:y.rotation,ref:B=>A.current[G]=B,children:m.jsx(Cx,{visible:!1,fontSize:.5,children:y.value.toString()})})]},G))]})},BP=(a=2)=>{const e=a*.5,t=[-e,-e,-e,e,-e,-e,e,e,-e,-e,e,-e,-e,-e,e,e,-e,e,e,e,e,-e,e,e],n=[2,1,0,0,3,2,0,4,7,7,3,0,1,2,6,6,5,1,4,5,6,6,7,4,3,7,6,6,2,3,0,1,5,5,4,0],i=[3,2,1,0,4,5,6,7,3,7,4,0,1,2,6,5,2,3,7,6,0,4,5,1],s=[{position:[0,-e,0],rotation:[Math.PI/2,0,0],value:1},{position:[0,e,0],rotation:[-Math.PI/2,0,0],value:6},{position:[0,0,-e],rotation:[0,Math.PI,0],value:2},{position:[0,0,e],rotation:[0,0,0],value:5},{position:[-e,0,0],rotation:[0,-Math.PI/2,0],value:3},{position:[e,0,0],rotation:[0,Math.PI/2,0],value:4}];return{vertices:Float32Array.from(t),indices:n,physicsIndices:i,faceData:s}},P2="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%200%200'%3e%3ctitle%3eface_1-2%3c/title%3e%3c/svg%3e",mN="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20701.25%20702.89'%3e%3cdefs%3e%3cstyle%3e.a{fill:%23fff;}%3c/style%3e%3c/defs%3e%3ctitle%3eface_3-4%3c/title%3e%3cpath%20class='a'%20d='M636.85,836.73c-6.36-13.2-12.93-26.28-19.06-39.61-9.91-21.61-17.86-45.75-53.14-28.63l-.19-5.94A128.07,128.07,0,0,1,577,744.15c28.71-30.11,58-59.74,86.82-89.77,15.55-16.2,13.53-24.38-8.17-31.15a106.39,106.39,0,0,0-28.11-4.59c-29-.79-26.93,0-33.08,28.16-5.72,26.26-19.48,49.82-41.52,73.48-7.56-26.16-12.92-47.8-20.32-68.71-2.48-7-10.06-12.23-15.3-18.25-5.11,5.62-10.51,11-15.12,16.88a26.33,26.33,0,0,0-3.26,9.62c-5.28,21.82-15.61,44.94,21.75,57.07-23.72,13.06-42.57,10.87-55.19-.41-18.74-16.66-32.84-38.43-49.36-57.66a32.17,32.17,0,0,0-14.49-10.93,123.24,123.24,0,0,0-30.44-3.12c-5.49.17-11,3-16.54,4.63,1.69,5.35,2,12,5.39,15.93,18.61,21.79,38.26,42.73,57.12,64.26,20.08,22.85,19.92,24.41,3.58,49.08-10.52,15.88-20.79,32-31.27,47.86-.23.34-1.27,0-3.1.43.82-12.86,1.6-25.59,2.7-43.75l-35.3,20.56-4.18-2.57c6.43-11.85,13.31-23.5,19-35.66,2.07-4.45,3.72-11.72,1.41-14.88s-9.8-3.79-14.47-2.62c-22,4.81-43.88,9.94-65.59,15.8-25,6.74-27.14,5-23.39-21.43q2.22-16.27,3.87-32.51c1.57-15.22-4.81-22.48-20.74-23.12-46.88-1.9-46.6-2.19-26.48-45.84,3.84-8.08,4.53-17.49,6.7-26.29a187.94,187.94,0,0,0-27.16,3.12c-14.76,3.88-29.14,9.14-43.66,14l-3.11-5c13.56-16.83,25.61-34.84,41-49.68,40.65-39.1,55.83-88.66,64-142.06a308,308,0,0,1,11.27-43.49c7.91-25.67,5.82-30.68-19.31-42.46a61.33,61.33,0,0,1-8.78-5.09c-1-.67-1.34-2.22-2.86-4.91,26.49-6.14,23-21.24,14.1-40.92-7.41-16.57-10.1-35.3-14.41-53.16-5.2-21.68-9.92-43.51-15.07-66.1,19.81,18.11,39.05,37.62,60.33,54.57,19.48,15.52,41.17,28.28,61.95,42.25,1.09.74,2.73.89,3.62,1.81,22.11,22.21,45.8,38.5,78.58,21.46,40,25.78,78.81-13.67,119-2a145.17,145.17,0,0,0,48.17,3.63,41.88,41.88,0,0,0,25.33-11.56c36.31-37.69,71.81-76.09,107-114.85,11.65-12.67,21.89-26.9,32.78-40.37l6.18,2.27c-2.93,28.79-6.36,57.59-8.51,86.36-.88,12.33,1.79,25.2,2.2,37.85.14,4.43-2.59,9-2.36,13.4a211.17,211.17,0,0,0,3.27,22.65c1,6.4,2.66,12.75,3.15,19.21.08,2.33-2,5-3.41,7.32-18.31,31.13-20.82,63-9.17,97.66,6.16,18.42,6.7,38.9,8.47,58.56,1.66,18.4,8.69,32,25.12,41.71,22.1,13,43.27,27.64,69.6,44.67l-51.32,18c-21.77,7.63-22.27,9.86-10.88,30.24,9,16.11,16.92,32.91,25.32,49.37l-5.23,5.58c-14.88-3.63-29.63-7.25-44.57-10.3a62.46,62.46,0,0,0-15.39.7c.16,5.12-.64,10.8,1.31,15.21,9.42,21.54,19.65,42.74,29.6,64l-4.31,4.93-63.16-30.08-6.23,5.29,43.87,89.6c-15.57-3.6-25.78-5.07-35.4-8.25-19.39-6.47-38.56-13.69-57.7-21-11.45-4.39-16.66-.49-17.59,11.35-1.23,15.29-2.87,30.55-4.31,45.85ZM461.92,523c-4.93-9.35-10.91-24.49-20.1-37.32C424.27,461.25,367.47,458,349.4,480c-16.57,20.09-32.77,40.57-47.91,61.76A21.18,21.18,0,0,0,300.38,561a238.29,238.29,0,0,0,32,39.69c20.9,20.32,43.94,21.55,68.33,6,8-5.06,16.41-9.79,24.71-14.49C449.8,578.42,459.29,556.26,461.92,523Zm193-62.59C623.11,464,591,478,569.64,511c-8.94,13.82-13.12,28.1-4.61,44.22,10.26,19.35,59.44,43.19,80.56,38.42a17.08,17.08,0,0,0,5.76-2c23.72-17.16,48.73-32.55,59-62.69C723.28,491.35,700.22,458.76,654.89,460.38Z'%20transform='translate(-155.97%20-133.83)'/%3e%3c/svg%3e",SP="/Assimilacao-RPG-Manager/assets/face_5-DpjbH29W.svg",xP="/Assimilacao-RPG-Manager/assets/face_6-DkZc4qdA.svg",pN={1:{path:P2,scale:1},2:{path:P2,scale:1},3:{path:mN,scale:1.5},4:{path:mN,scale:1.5},5:{path:SP,scale:1.9},6:{path:xP,scale:1.5}};MC.preload(P2);const ZP=({value:a,detectedValue:e,position:t,rotation:n})=>{const i=pN[a]||pN[1],s=MC(i.path);s.center.set(.5,.5),s.repeat.set(1,1);const o=e===a,l=o?"#39ff14":"#ffffff",c=new ue(...t).multiplyScalar(.99);return m.jsxs("mesh",{position:c,rotation:n,children:[m.jsx("planeGeometry",{args:[i.scale,i.scale]}),m.jsx("meshStandardMaterial",{map:s,transparent:!0,side:po,color:l,emissive:l,emissiveIntensity:o?4:2,toneMapped:!1,roughness:.1,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:-4})]})},wP=({position:a=[0,5,0],onStop:e})=>{const{vertices:t,indices:n,faceData:i}=J.useMemo(()=>BP(2),[]),[s,o]=lJ(()=>({mass:1.5,position:a,args:[2,2,2],material:{friction:.1,restitution:.5},linearDamping:.2,angularDamping:.2})),l=J.useRef([0,0,0]),c=J.useRef(!0),u=J.useRef([]);u.current.length!==6&&(u.current=Array(6).fill(null));const[h,A]=J.useState(null);return J.useEffect(()=>{o.wakeUp();const f=[(Math.random()-.5)*4,12+Math.random()*5,-25-Math.random()*10];o.applyImpulse(f,[Math.random(),-1,Math.random()]),o.applyTorque([(Math.random()-.5)*35,(Math.random()-.5)*35,(Math.random()-.5)*35])},[o]),J.useEffect(()=>o.velocity.subscribe(f=>l.current=f),[o.velocity]),J.useEffect(()=>{const f=new ue,p=new xa,y=new ue,G=setInterval(()=>{if(!c.current)return;const B=l.current;if(Math.abs(B[0])<.05&&Math.abs(B[1])<.05&&Math.abs(B[2])<.05&&s.current){let S=-1/0,N=-1;if(u.current.forEach((R,w)=>{R&&(R.getWorldPosition(f),f.y>S&&(S=f.y,N=w))}),N!==-1){if(u.current[N].getWorldQuaternion(p),y.set(0,0,1).applyQuaternion(p),y.y<.9){o.wakeUp(),o.applyImpulse([0,6,0],[Math.random()*.1,-1,Math.random()*.1]);return}c.current=!1;const w=i[N].value;A(w),e&&e(w)}}},200);return()=>clearInterval(G)},[i,e,o]),m.jsxs("mesh",{ref:s,castShadow:!0,receiveShadow:!0,children:[m.jsxs("bufferGeometry",{onUpdate:f=>f.computeVertexNormals(),children:[m.jsx("bufferAttribute",{attach:"attributes-position",count:t.length/3,itemSize:3,array:t,args:[t,3]}),m.jsx("bufferAttribute",{attach:"index",count:n.length,itemSize:1,array:new Uint16Array(n),args:[new Uint16Array(n),1]})]}),m.jsx("meshPhysicalMaterial",{color:"#1a1a3a",transmission:.95,thickness:2,roughness:.1,metalness:0,ior:1.5,clearcoat:1,side:Ss,transparent:!0}),m.jsx(Ax,{threshold:30,color:"#ffffff"}),i.map((f,p)=>m.jsxs(xg.Fragment,{children:[m.jsx(ZP,{value:f.value,detectedValue:h,position:f.position,rotation:f.rotation}),m.jsx("group",{position:f.position,rotation:f.rotation,ref:y=>u.current[p]=y,children:m.jsx(Cx,{visible:!1,fontSize:.5,children:f.value.toString()})})]},p))]})},RP=({selectedInstincts:a,selectedAptitudes:e,isAssimilatedMode:t})=>{const[n,i]=J.useState([]),s=J.useRef(null),[o,l]=J.useState(!1),[c,u]=J.useState(!1),[h,A]=J.useState({d6:0,d10:0,d12:0}),f=(G,B)=>{A(S=>({...S,[G]:Math.max(0,S[G]+B)}))},p=()=>{s.current&&(s.current.target.set(0,0,0),s.current.object.position.set(0,20,0),s.current.update());const G=[],B=Date.now();if(c){if(h.d6===0&&h.d10===0&&h.d12===0){l(!0);return}for(let S=0;S<h.d6;S++)G.push({id:`Manual-D6-${B}-${S}`,type:"D6",pos:[(Math.random()-.5)*4,2+S*.5,6+Math.random()]});for(let S=0;S<h.d10;S++)G.push({id:`Manual-D10-${B}-${S}`,type:"D10",pos:[(Math.random()-.5)*4,2+S*.5,6+Math.random()]});for(let S=0;S<h.d12;S++)G.push({id:`Manual-D12-${B}-${S}`,type:"D12",pos:[(Math.random()-.5)*4,2+S*.5,6+Math.random()]})}else{const S=a.reduce((w,V)=>w+V.value,0),N=e.reduce((w,V)=>w+V.value,0);if(S===0&&N===0){l(!0);return}const R=t?"D12":"D6";for(let w=0;w<S;w++)G.push({id:`${R}-${B}-${w}`,type:R,pos:[(Math.random()-.5)*4,2+w*.5,6+Math.random()*2]});for(let w=0;w<N;w++)G.push({id:`D10-${B}-${w}`,type:"D10",pos:[(Math.random()-.5)*4,2+w*.5,6+Math.random()*2]})}i(G)},y={padding:"10px 25px",fontSize:"0.9rem",fontWeight:"bold",letterSpacing:"1px",background:"rgba(0, 0, 0, 0.4)",border:"1px solid var(--cor-tema)",color:"var(--cor-tema)",textShadow:"0 0 5px rgba(0,0,0,0.5)",boxShadow:"0 0 15px rgba(0,0,0,0.2)",borderRadius:"4px",cursor:"pointer",backdropFilter:"blur(4px)",transition:"all 0.2s ease",textTransform:"uppercase",minWidth:"150px",textAlign:"center"};return m.jsxs("div",{style:{display:"flex",flexDirection:"column",width:"100%",height:"100%",overflow:"hidden"},children:[m.jsxs("div",{style:{flex:1,position:"relative",width:"100%",minHeight:0},children:[c&&m.jsxs("div",{style:{position:"absolute",bottom:15,left:"50%",transform:"translateX(-50%)",zIndex:20,display:"flex",flexDirection:"row",alignItems:"center",gap:"25px",background:"rgba(0, 0, 0, 0.7)",padding:"10px 30px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",backdropFilter:"blur(5px)"},children:[m.jsx(qB,{label:"D6",value:h.d6,onDec:()=>f("d6",-1),onInc:()=>f("d6",1)}),m.jsx("div",{style:{width:1,height:"40px",background:"rgba(255,255,255,0.1)"}}),m.jsx(qB,{label:"D10",value:h.d10,onDec:()=>f("d10",-1),onInc:()=>f("d10",1)}),m.jsx("div",{style:{width:1,height:"40px",background:"rgba(255,255,255,0.1)"}}),m.jsx(qB,{label:"D12",value:h.d12,onDec:()=>f("d12",-1),onInc:()=>f("d12",1)})]}),o&&m.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.85)",zIndex:50,display:"flex",alignItems:"center",justifyContent:"center",backdropFilter:"blur(5px)"},children:m.jsxs("div",{style:{background:"#1a1a1a",border:"1px solid var(--cor-tema)",padding:"30px",borderRadius:"8px",textAlign:"center",maxWidth:"80%",boxShadow:"0 0 30px var(--cor-tema-glow)"},children:[m.jsx("h3",{style:{color:"var(--cor-tema)",margin:"0 0 15px 0",textTransform:"uppercase"},children:c?"Nenhum Dado Selecionado":"Ao Invlida"}),m.jsx("p",{style:{color:"#ccc",marginBottom:"25px",lineHeight:"1.5"},children:c?"Selecione a quantidade de dados no painel abaixo.":"Nenhum atributo selecionado na ficha. Selecione Instintos/Aptides ou use o MODO MANUAL."}),m.jsx("button",{onClick:()=>l(!1),style:{background:"transparent",color:"var(--cor-tema)",border:"1px solid var(--cor-tema)",padding:"8px 25px",cursor:"pointer",borderRadius:"4px",textTransform:"uppercase",fontWeight:"bold"},children:"OK"})]})}),m.jsxs(qO,{shadows:!0,camera:{position:[0,17,0],fov:40,rotation:[-Math.PI/2,0,0]},children:[m.jsx("color",{attach:"background",args:["#0a0a0a"]}),m.jsx("ambientLight",{intensity:.5}),m.jsx("spotLight",{position:[10,20,10],angle:.3,penumbra:1,intensity:1.5,castShadow:!0}),m.jsx(tP,{preset:"city"}),m.jsx(E4,{ref:s,maxPolarAngle:Math.PI/2.1}),m.jsx(IJ,{gravity:[0,-50,0],defaultContactMaterial:{friction:.4,restitution:.3},children:m.jsxs(J.Suspense,{fallback:null,children:[m.jsx(nP,{}),m.jsx(iP,{}),n.map(G=>G.type==="D6"?m.jsx(wP,{position:G.pos},G.id):G.type==="D10"?m.jsx(dP,{position:G.pos},G.id):G.type==="D12"?m.jsx(GP,{position:G.pos},G.id):null)]})})]})]}),m.jsxs("div",{style:{flexShrink:0,display:"flex",gap:"20px",justifyContent:"center",padding:"12px",background:"rgba(0,0,0,0.3)",borderTop:"1px solid rgba(255,255,255,0.05)"},children:[m.jsx("button",{className:"dice-trigger",onClick:p,style:y,onMouseOver:G=>{G.currentTarget.style.boxShadow="0 0 15px var(--cor-tema-glow)",G.currentTarget.style.background="rgba(0, 0, 0, 0.8)"},onMouseOut:G=>{G.currentTarget.style.boxShadow="0 0 15px rgba(0,0,0,0.2)",G.currentTarget.style.background="rgba(0, 0, 0, 0.4)"},children:"LANAR DADOS"}),m.jsx("button",{onClick:()=>u(!c),style:y,onMouseOver:G=>{G.currentTarget.style.boxShadow="0 0 15px var(--cor-tema-glow)",G.currentTarget.style.background="rgba(0, 0, 0, 0.8)"},onMouseOut:G=>{G.currentTarget.style.boxShadow="0 0 15px rgba(0,0,0,0.2)",G.currentTarget.style.background="rgba(0, 0, 0, 0.4)"},children:c?"VOLTAR":"MODO MANUAL"})]})]})},qB=({label:a,value:e,onInc:t,onDec:n})=>m.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.7rem",color:"#888",marginBottom:"2px"},children:a}),m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[m.jsx("button",{onClick:n,style:{width:"24px",height:"24px",background:"#222",border:"1px solid #444",color:"white",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"-"}),m.jsx("span",{style:{width:"20px",textAlign:"center",fontWeight:"bold",color:"white"},children:e}),m.jsx("button",{onClick:t,style:{width:"24px",height:"24px",background:"#222",border:"1px solid #444",color:"white",borderRadius:"50%",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"},children:"+"})]})]});function NP(){const{id:a}=ON(),e=Ng(),t=J.useRef(null),[n,i]=J.useState(null),[s,o]=J.useState(!0),[l,c]=J.useState({instincts:[],aptitudes:[],isAssimilated:!1});J.useEffect(()=>{if(!a)return;(async()=>{try{const B=await qi.getCharacterById(a);if(!B)throw new Error("Personagem no encontrado");i(B)}catch(B){console.error(B),e("/dashboard/infectados")}finally{o(!1)}})()},[a,e]);const u=async G=>{if(n){i(B=>B?{...B,...G}:null);try{await qi.updateCharacter(n.id,G)}catch(B){console.error("Erro ao salvar progresso:",B)}}},h=async G=>{if(n){i(B=>B?{...B,background:G}:null);try{await qi.updateCharacter(n.id,{background:G})}catch(B){console.error("Erro ao salvar origens:",B)}}},A=(G,B)=>{i(S=>S?{...S,background:{...S.background,[G]:B}}:null)},f=async()=>{if(n)try{await qi.updateCharacter(n.id,{background:n.background})}catch(G){console.error("Erro ao salvar dados de texto:",G)}},p=()=>{t.current&&t.current.click()},y=async G=>{if(G.target.files&&G.target.files[0]&&n){const B=G.target.files[0];if(B.size>2*1024*1024){alert("Imagem muito grande (Max 2MB)");return}try{const S=await qi.uploadAvatar(B,n.user_id);await u({avatar_url:S})}catch(S){console.error(S),alert("Falha ao atualizar imagem.")}}};return s||!n?m.jsx("div",{className:"sheet-container",children:"Carregando Ficha..."}):m.jsxs("div",{className:"sheet-container",children:[m.jsx(QE,{name:n.name,generation:n.generation,occupation:n.background.occupation,onBack:()=>e("/dashboard/infectados")}),m.jsx("input",{type:"file",ref:t,style:{display:"none"},accept:"image/*",onChange:y}),m.jsx("div",{className:"sheet-scrollable-area",children:m.jsxs("div",{className:"sheet-grid",children:[m.jsxs("main",{className:"sheet-content",children:[m.jsx("div",{className:"snap-section",children:m.jsx(e9,{background:n.background,onSave:h})}),m.jsx("hr",{style:{borderColor:"rgba(255,255,255,0.05)",margin:"5px 0 15px 0"}}),m.jsx("div",{className:"snap-section",children:m.jsxs("div",{className:"sheet-content-top",children:[m.jsx(n9,{instincts:n.instincts,aptitudes:n.aptitudes,currentAssimilation:n.vitals.assimilation.current,currentDetermination:n.vitals.determination.current,onSpendAssimilation:()=>{const G=Math.max(0,n.vitals.assimilation.current-1);u({vitals:{...n.vitals,assimilation:{...n.vitals.assimilation,current:G}}})},onSpendDetermination:G=>{const B=Math.max(0,n.vitals.determination.current-G);u({vitals:{...n.vitals,determination:{...n.vitals.determination,current:B}}})},onUpdate:G=>u({instincts:G.instincts,aptitudes:G.aptitudes}),onSelectionChange:(G,B,S)=>{let N=[];if(S&&G.length>0)if(G.length===1){const w=n.instincts[G[0]];N=[{key:G[0],value:w},{key:`${G[0]}_clone`,value:w}]}else N=G.map(w=>({key:w,value:n.instincts[w]}));else N=G.map(w=>({key:w,value:n.instincts[w]}));const R=B.map(w=>({key:w,value:n.aptitudes[w]}));c({instincts:N,aptitudes:R,isAssimilated:S})}}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[m.jsx("span",{className:"section-title",children:"Monitor de Dados"}),m.jsx("div",{className:"dice-stage-container",children:m.jsx(RP,{selectedInstincts:l.instincts,selectedAptitudes:l.aptitudes,isAssimilatedMode:l.isAssimilated})})]})]})}),m.jsxs("div",{className:"snap-section",children:[m.jsx("hr",{style:{borderColor:"rgba(255,255,255,0.05)",margin:"5px 0 15px 0"}}),m.jsxs("div",{className:"split-50-50",children:[m.jsx(l9,{ids:n.characteristics_ids,instincts:n.instincts,aptitudes:n.aptitudes,onUpdate:G=>u({characteristics_ids:G})}),m.jsx(i9,{characterId:n.id})]})]}),m.jsxs("div",{className:"snap-section",children:[m.jsx("hr",{style:{borderColor:"rgba(255,255,255,0.05)",margin:"5px 0 5px 0"}}),m.jsx(c9,{characterId:n.id})]}),m.jsxs("div",{className:"snap-section",children:[m.jsx("hr",{style:{borderColor:"rgba(255,255,255,0.05)",margin:"5px 0 15px 0"}}),m.jsxs("div",{className:"split-50-50",style:{alignItems:"stretch"},children:[m.jsxs("div",{className:"desc-box-container",style:{height:"100%",background:"rgba(0,0,0,0.2)"},children:[m.jsx("span",{className:"section-title",children:"Descrio Visual"}),m.jsx("textarea",{className:"desc-textarea",value:n.background.description||"",onChange:G=>A("description",G.target.value),onBlur:f,placeholder:"Aparncia fsica, vestimentas e traos visveis..."})]}),m.jsxs("div",{className:"desc-box-container",style:{height:"100%",background:"rgba(0,0,0,0.2)"},children:[m.jsx("span",{className:"section-title",children:"Anotaes / Dirio"}),m.jsx("textarea",{className:"desc-textarea",value:n.background.notes||"",onChange:G=>A("notes",G.target.value),onBlur:f,placeholder:"Lembretes, pistas, nomes de NPCs ou objetivos..."})]})]})]})]}),m.jsxs("aside",{className:"sheet-sidebar",children:[m.jsxs("div",{className:"char-avatar-box",onClick:p,children:[n.avatar_url?m.jsx("img",{src:n.avatar_url,alt:"Avatar",className:"char-avatar-img"}):m.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"3rem",color:"#333"},children:"?"}),m.jsx("div",{className:"char-avatar-overlay",children:"Alterar"})]}),m.jsx($E,{health:n.vitals.health,instincts:n.instincts,onUpdate:G=>u({vitals:{...n.vitals,health:G}}),onStatusChange:G=>{n.status!==G&&u({status:G})}}),m.jsx(qE,{determination:n.vitals.determination,assimilation:n.vitals.assimilation,onUpdate:G=>u({vitals:{...n.vitals,...G}})})]})]})})]})}function WP(){const[a,e]=J.useState("menu"),[t,n]=J.useState(0),[i,s]=J.useState(""),[o,l]=J.useState(["","",""]),[c,u]=J.useState(["","",""]),h=(A,f,p)=>{if(p==="p"){const y=[...o];y[A]=f,l(y)}else{const y=[...c];y[A]=f,u(y)}};return a==="menu"?m.jsxs("div",{className:"threat-container",children:[m.jsxs("header",{className:"threat-header",children:[m.jsx("h1",{children:"Criador de Ameaas"}),m.jsx("p",{children:"Selecione o mdulo de gesto para sua cena."})]}),m.jsxs("div",{className:"menu-selection-grid",children:[m.jsxs("div",{className:"selection-card",onClick:()=>e("conflitos"),children:[m.jsx("div",{className:"card-icon",children:""}),m.jsx("h2",{children:"Gerenciar Conflitos"}),m.jsx("p",{children:"Defina nomes, objetivos principais e secundrios da cena."})]}),m.jsxs("div",{className:"selection-card",onClick:()=>e("ameacas"),children:[m.jsx("div",{className:"card-icon",children:""}),m.jsx("h2",{children:"Nvel de Ameaa"}),m.jsx("p",{children:"Monitore o risco e a urgncia das aes dos Infectados."})]})]})]}):a==="conflitos"?m.jsxs("div",{className:"threat-container",children:[m.jsx("button",{className:"back-btn",onClick:()=>e("menu"),children:" Voltar ao Menu"}),m.jsxs("div",{className:"setup-card",children:[m.jsxs("div",{className:"form-group",children:[m.jsx("label",{children:"Nome do Conflito"}),m.jsx("input",{type:"text",placeholder:"Ex: Fuga do Armazm",value:i,onChange:A=>s(A.target.value)})]}),m.jsxs("div",{className:"objectives-grid",children:[m.jsxs("div",{className:"obj-section",children:[m.jsx("h4",{children:"Objetivos Principais"}),o.map((A,f)=>m.jsx("input",{type:"text",value:A,onChange:p=>h(f,p.target.value,"p")},`p-${f}`))]}),m.jsxs("div",{className:"obj-section",children:[m.jsx("h4",{children:"Objetivos Secundrios"}),c.map((A,f)=>m.jsx("input",{type:"text",value:A,onChange:p=>h(f,p.target.value,"s")},`s-${f}`))]})]})]})]}):m.jsxs("div",{className:"threat-container",children:[m.jsx("button",{className:"back-btn",onClick:()=>e("menu"),children:" Voltar ao Menu"}),m.jsxs("div",{className:"threat-card center-card",children:[m.jsx("span",{className:"level-number",children:t}),m.jsx("div",{className:"progress-bar-bg",children:m.jsx("div",{className:"progress-bar-fill",style:{width:`${t/5*100}%`,backgroundColor:t>3?"#ff4444":"#ff9900"}})}),m.jsxs("div",{className:"threat-controls",children:[m.jsx("button",{onClick:()=>n(Math.max(0,t-1)),children:"Reduzir"}),m.jsx("button",{onClick:()=>n(Math.min(5,t+1)),children:"Aumentar"})]})]})]})}const Oa={async getMyLibraries(){const{data:{user:a}}=await Lt.auth.getUser();if(!a)throw new Error("Usurio no logado");const{data:e,error:t}=await Lt.from("item_libraries").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(t)throw t;return e},async getPublicLibraries(){const{data:{user:a}}=await Lt.auth.getUser(),{data:e,error:t}=await Lt.from("item_libraries").select("*, profiles(username)").or("is_public.eq.true,is_official.eq.true").neq("user_id",a?.id||"").order("name",{ascending:!0});if(t)throw t;return e},async createLibrary(a){const{data:{user:e}}=await Lt.auth.getUser();if(!e)throw new Error("Sesso invlida.");const{data:t,error:n}=await Lt.rpc("create_library_clone",{new_lib_name:a.name?.trim(),new_lib_desc:a.description||"",is_lib_public:!!a.is_public,owner_id:e.id});if(n)throw new Error(`Falha ao criar depsito: ${n.message}`);const{data:i}=await Lt.from("item_libraries").select("*").eq("id",t.id).single();return i},async updateLibrary(a,e){const{error:t}=await Lt.from("item_libraries").update(e).eq("id",a);if(t)throw t},async deleteLibrary(a){const{error:e}=await Lt.from("item_libraries").delete().eq("id",a);if(e)throw e},async getMyFavorites(){const{data:{user:a}}=await Lt.auth.getUser(),{data:e}=await Lt.from("item_user_favorite_libraries").select("library:item_libraries(*)").eq("user_id",a?.id);return e?.map(t=>t.library)||[]},async toggleFavorite(a){const{data:{user:e}}=await Lt.auth.getUser();if(!e)return!1;const{data:t}=await Lt.from("item_user_favorite_libraries").select("id").eq("user_id",e.id).eq("library_id",a).single();return t?(await Lt.from("item_user_favorite_libraries").delete().eq("id",t.id),!1):(await Lt.from("item_user_favorite_libraries").insert([{user_id:e.id,library_id:a}]),!0)},async getFavoriteIds(){const{data:{user:a}}=await Lt.auth.getUser(),{data:e}=await Lt.from("item_user_favorite_libraries").select("library_id").eq("user_id",a?.id);return e?.map(t=>t.library_id)||[]},async getItemsByLibrary(a){const{data:e,error:t}=await Lt.from("items").select("*").eq("library_id",a).order("name",{ascending:!0});if(t)throw t;return e},async createItem(a){const{data:{user:e}}=await Lt.auth.getUser(),t={library_id:a.library_id,name:a.name,description:a.description,slots:a.slots,category:a.category,charges:a.charges,quality:a.quality,traits:a.traits||[],created_by:e?.id},{data:n,error:i}=await Lt.from("items").insert([t]).select().single();if(i)throw i;return n},async updateItem(a,e){const{error:t}=await Lt.from("items").update(e).eq("id",a);if(t)throw t},async deleteItem(a){const{error:e}=await Lt.from("items").delete().eq("id",a);if(e)throw e},async getTraitsByLibrary(a){const{data:e,error:t}=await Lt.from("item_traits").select("*").eq("library_id",a).order("name",{ascending:!0});if(t)throw t;return e.map(n=>({...n,mechanics:n.automation_config||{effects:[],cooldown:{type:"unlimited"}}}))},async saveTrait(a){const{data:{user:e}}=await Lt.auth.getUser(),t={name:a.name,description:a.description,cost:a.cost||0,library_id:a.library_id,automation_config:a.mechanics,created_by:e?.id};if(a.id){const{data:n,error:i}=await Lt.from("item_traits").update(t).eq("id",a.id).select().single();if(i)throw i;return n}else{const{data:n,error:i}=await Lt.from("item_traits").insert([t]).select().single();if(i)throw i;return n}},async deleteTrait(a){const{error:e}=await Lt.from("item_traits").delete().eq("id",a);if(e)throw e},async getKitsByLibrary(a){const{data:e,error:t}=await Lt.from("item_kits").select("*").eq("library_id",a).order("name",{ascending:!0});if(t)throw t;return e.map(n=>({id:n.id,library_id:n.library_id,name:n.name,description:n.description,items:Array.isArray(n.items)?n.items.map(i=>i.item_id):[],created_by:n.created_by}))},async saveKit(a){const{data:{user:e}}=await Lt.auth.getUser(),t=a.items?a.items.map(i=>({item_id:i,quantity:1})):[],n={library_id:a.library_id,name:a.name,description:a.description,items:t,created_by:e?.id};if(a.id){const{data:i,error:s}=await Lt.from("item_kits").update(n).eq("id",a.id).select().single();if(s)throw s;return i}else{const{data:i,error:s}=await Lt.from("item_kits").insert([n]).select().single();if(s)throw s;return i}},async deleteKit(a){const{error:e}=await Lt.from("item_kits").delete().eq("id",a);if(e)throw e}},kd={influencia:"Influncia",percepcao:"Percepo",potencia:"Potncia",reacao:"Reao",resolucao:"Resoluo",sagacidade:"Sagacidade",biologia:"Biologia",erudicao:"Erudio",engenharia:"Engenharia",geografia:"Geografia",medicina:"Medicina",seguranca:"Segurana",armas:"Armas",atletismo:"Atletismo",expressao:"Expresso",furtividade:"Furtividade",manufaturas:"Manufaturas",sobrevivencia:"Sobrevivncia","health.current":"Ponto de Vida","health.temp":"Vida Temporria","determination.current":"Ponto de Determinao","assimilation.current":"Ponto de Assimilao",item_pressure:"Ponto de Presso no Item",success:"Sucesso",adaptation:"Adaptao",pressure:"Presso"},Ia={instincts:["influencia","percepcao","potencia","reacao","resolucao","sagacidade"],knowledges:["biologia","erudicao","engenharia","geografia","medicina","seguranca"],practices:["armas","atletismo","expressao","furtividade","manufaturas","sobrevivencia"],targets:["success","adaptation","pressure","health.current","health.temp","determination.current","assimilation.current","item_pressure"]},$B={0:{label:"Nvel 0 (Quebrado)",desc:"Inutilizado. O equipamento no pode ser usado.",bonus:"Nenhum"},1:{label:"Nvel 1 (Defeituoso)",desc:"Frgil. Com 1 presso investida, cai de nvel (quebra).",bonus:"Nenhum"},2:{label:"Nvel 2 (Comprometido)",desc:"Instvel. Precisa de 2 presses investidas para cair de nvel.",bonus:"Nenhum"},3:{label:"Nvel 3 (Padro)",desc:"Comum. Precisa de 3 presses investidas para cair de nvel.",bonus:"Nenhum"},4:{label:"Nvel 4 (Reforado)",desc:"Robusto. Precisa de 4 presses investidas para cair de nvel.",bonus:"+1 Sucesso (1x por sesso)"},5:{label:"Nvel 5 (Superior)",desc:"Excelente. Precisa de 5 presses investidas para cair de nvel.",bonus:"+1 Sucesso (at 2x por sesso)"},6:{label:"Nvel 6 (Obra-Prima)",desc:"Lendrio. Precisa de 6 presses investidas para cair de nvel.",bonus:"+1 Sucesso (at 3x por sesso)"}},VP=({isOpen:a,onClose:e,onSave:t,initialData:n})=>{const i=()=>Date.now().toString(36)+Math.random().toString(36).substr(2),s={name:"",description:"",library_id:"",cost:0,mechanics:{effects:[],cooldown:{type:"unlimited"}}},[o,l]=J.useState(s),[c,u]=J.useState("info");if(J.useEffect(()=>{l(n?{...s,...n,mechanics:n.mechanics||s.mechanics}:s),u("info")},[n,a]),!a)return null;const h=(w=!1)=>({id:i(),trigger_type:w?"instinct":"practice",trigger_val_1:w?Ia.instincts[0]:Ia.practices[0],action:w?"remove":"add",target_qty:1,target_resource:w?"health.current":"success",source_qty:1,source_resource:"success",is_mandatory:!0,negate_main_effect_on_failure:!1,apply_on_first_use:!1,risk_condition:"always",difficulty_mode:"fixed",difficulty_target:1,difficulty_resource:"success",penalty:w?void 0:{enabled:!1,description:"",consequences:[]}}),A=()=>{l(w=>({...w,mechanics:{...w.mechanics,effects:[...w.mechanics.effects,h(!1)]}}))},f=w=>{l(V=>({...V,mechanics:{...V.mechanics,effects:V.mechanics.effects.filter(H=>H.id!==w)}}))},p=(w,V,H)=>{l(X=>({...X,mechanics:{...X.mechanics,effects:X.mechanics.effects.map(Y=>{if(Y.id!==w)return Y;if(V==="penalty")return{...Y,penalty:{...Y.penalty,...H}};const M={...Y,[V]:H};return V==="trigger_type"&&(M.trigger_val_2=void 0,H==="instinct"?M.trigger_val_1=Ia.instincts[0]:H==="knowledge"?M.trigger_val_1=Ia.knowledges[0]:H==="practice"?M.trigger_val_1=Ia.practices[0]:H==="specific_roll"?(M.trigger_val_1=Ia.instincts[0],M.trigger_val_2=Ia.practices[0]):M.trigger_val_1="always"),M})}}))},y=w=>{l(V=>({...V,mechanics:{...V.mechanics,effects:V.mechanics.effects.map(H=>H.id!==w?H:{...H,penalty:{...H.penalty,consequences:[...H.penalty?.consequences||[],h(!0)]}})}}))},G=(w,V)=>{l(H=>({...H,mechanics:{...H.mechanics,effects:H.mechanics.effects.map(X=>X.id!==w?X:{...X,penalty:{...X.penalty,consequences:X.penalty.consequences.filter(Y=>Y.id!==V)}})}}))},B=(w,V,H,X)=>{l(Y=>({...Y,mechanics:{...Y.mechanics,effects:Y.mechanics.effects.map(M=>M.id!==w?M:{...M,penalty:{...M.penalty,consequences:M.penalty.consequences.map(E=>{if(E.id!==V)return E;const O={...E,[H]:X};return H==="trigger_type"&&(O.trigger_val_2=void 0,X==="instinct"?O.trigger_val_1=Ia.instincts[0]:X==="knowledge"?O.trigger_val_1=Ia.knowledges[0]:X==="practice"?O.trigger_val_1=Ia.practices[0]:X==="specific_roll"?(O.trigger_val_1=Ia.instincts[0],O.trigger_val_2=Ia.practices[0]):O.trigger_val_1="always"),O})}})}}))},S=(w,V)=>{l(H=>({...H,mechanics:{...H.mechanics,cooldown:{...H.mechanics.cooldown,[w]:V}}}))},N=w=>w==="practice"?"QUAL PRTICA?":w==="instinct"?"QUAL INSTINTO?":w==="knowledge"?"QUAL CONHECIMENTO?":w==="specific_roll"?"COMBINAO EXATA":"DETALHE",R=(w,V,H,X)=>{const Y=H?(k,le,F)=>B(X,k,le,F):p,M=H?k=>G(X,k):f,E=H?"rgba(255,100,100,0.3)":"rgba(255,255,255,0.05)",O=H?"rgba(50,0,0,0.2)":"rgba(0,0,0,0.2)",P=H?"CONSEQUNCIA":"EFEITO",q=H?"#ff6666":"var(--cor-tema)";return m.jsxs("div",{className:"effect-row-container",style:{position:"relative",padding:"15px",background:O,border:`1px solid ${E}`,borderRadius:"6px",marginBottom:"10px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px",borderBottom:"1px solid rgba(255,255,255,0.1)",paddingBottom:"5px"},children:[m.jsxs("span",{className:"effect-number",style:{fontWeight:"bold",color:q},children:[P," #",V+1]}),m.jsx("button",{className:"btn-icon-small danger",onClick:()=>M(w.id),style:{background:"transparent",border:"none",color:"#ff5555",cursor:"pointer",fontSize:"1.2rem"},children:""})]}),H&&m.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"15px",paddingBottom:"10px",borderBottom:"1px dashed rgba(255,255,255,0.1)"},children:[m.jsxs("div",{style:{flex:1},children:[m.jsx("label",{className:"input-label",style:{color:"#ffaa88"},children:"QUANDO OCORRE ESSE RISCO?"}),m.jsxs("select",{className:"input-dark-sheet",value:w.risk_condition||"always",onChange:k=>Y(w.id,"risk_condition",k.target.value),children:[m.jsx("option",{value:"always",children:"Sempre (Todas as cenas)"}),m.jsx("option",{value:"conflict",children:"Somente em Conflito"}),m.jsx("option",{value:"non_conflict",children:"Fora de Conflito (Pacfico)"})]})]}),m.jsx("div",{style:{width:"120px",display:"flex",flexDirection:"column",justifyContent:"center"},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.7rem",color:"#aaa"},children:"NO 1 USO?"}),m.jsxs("label",{className:"tech-switch",style:{transform:"scale(0.8)"},children:[m.jsx("input",{type:"checkbox",checked:w.apply_on_first_use,onChange:k=>Y(w.id,"apply_on_first_use",k.target.checked)}),m.jsx("span",{className:"tech-slider"})]})]})})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px"},children:[m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[m.jsx("label",{className:"input-label",style:{color:"#aaa",fontWeight:600},children:H?"TESTE PARA EVITAR A PENALIDADE":"CONDIO DE ATIVAO"}),m.jsx("select",{className:"input-dark-sheet",value:w.trigger_type,onChange:k=>Y(w.id,"trigger_type",k.target.value),children:H?m.jsxs(m.Fragment,{children:[m.jsx("option",{value:"instinct",children:"Rolagem com Instinto ..."}),m.jsx("option",{value:"knowledge",children:"Rolagem com Conhecimento ..."}),m.jsx("option",{value:"practice",children:"Rolagem com Prtica ..."}),m.jsx("option",{value:"specific_roll",children:"Rolagem especfica (Instinto + Aptido)"}),m.jsx("option",{value:"always",children:"Automtico (Falha Crtica / Sem teste)"})]}):m.jsxs(m.Fragment,{children:[m.jsx("option",{value:"practice",children:"Rolagem com Prtica ..."}),m.jsx("option",{value:"instinct",children:"Rolagem com Instinto ..."}),m.jsx("option",{value:"knowledge",children:"Rolagem com Conhecimento ..."}),m.jsx("option",{value:"specific_roll",children:"Rolagem especfica (Instinto + Aptido)"}),m.jsx("option",{value:"always",children:"Sempre / Ao Usar"})]})}),w.trigger_type!=="always"?m.jsxs("div",{children:[m.jsx("label",{className:"input-label",style:{fontSize:"0.75rem",marginTop:"5px"},children:N(w.trigger_type)}),w.trigger_type==="specific_roll"?m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("select",{className:"input-dark-sheet",value:w.trigger_val_1,onChange:k=>Y(w.id,"trigger_val_1",k.target.value),children:Ia.instincts.map(k=>m.jsx("option",{value:k,children:kd[k]},k))}),m.jsx("span",{style:{alignSelf:"center",color:"#666"},children:"+"}),m.jsx("select",{className:"input-dark-sheet",value:w.trigger_val_2,onChange:k=>Y(w.id,"trigger_val_2",k.target.value),children:[...Ia.practices,...Ia.knowledges].map(k=>m.jsx("option",{value:k,children:kd[k]},k))})]}):m.jsx("select",{className:"input-dark-sheet",value:w.trigger_val_1,onChange:k=>Y(w.id,"trigger_val_1",k.target.value),children:(w.trigger_type==="instinct"?Ia.instincts:w.trigger_type==="knowledge"?Ia.knowledges:Ia.practices).map(k=>m.jsx("option",{value:k,children:kd[k]||k},k))})]}):m.jsx("input",{className:"input-dark-sheet",disabled:!0,value:"Acontece Automaticamente",style:{opacity:.5,fontStyle:"italic",marginTop:"5px"}}),H&&w.trigger_type!=="always"&&m.jsxs("div",{style:{marginTop:"10px",padding:"8px",background:"rgba(50,0,0,0.2)",borderRadius:"4px"},children:[m.jsx("label",{className:"input-label",style:{fontSize:"0.7rem",color:"#ffaaaa",marginBottom:"5px"},children:"DIFICULDADE DESTE TESTE"}),m.jsx("div",{style:{display:"flex",gap:"5px",marginBottom:"5px"},children:m.jsxs("select",{className:"input-dark-sheet",style:{fontSize:"0.8rem"},value:w.difficulty_mode||"fixed",onChange:k=>Y(w.id,"difficulty_mode",k.target.value),children:[m.jsx("option",{value:"fixed",children:"Fixo (Dificuldade constante)"}),m.jsx("option",{value:"increasing",children:"Crescente (Valor x Usos)"})]})}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("input",{type:"number",className:"input-dark-sheet",style:{width:"50px",textAlign:"center"},value:w.difficulty_target??1,onChange:k=>Y(w.id,"difficulty_target",Number(k.target.value))}),m.jsx("select",{className:"input-dark-sheet",style:{flex:1,fontSize:"0.8rem"},value:w.difficulty_resource??"success",onChange:k=>Y(w.id,"difficulty_resource",k.target.value),children:Ia.targets.map(k=>m.jsx("option",{value:k,children:kd[k]||k},k))})]})]})]}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:[m.jsx("label",{className:"input-label",style:{color:"#aaa",fontWeight:600},children:H?"CONSEQUNCIA":"EFEITO"}),m.jsxs("select",{className:"input-dark-sheet",value:w.action,onChange:k=>Y(w.id,"action",k.target.value),children:[m.jsx("option",{value:"add",children:"Gerar / Adicionar (+)"}),m.jsx("option",{value:"remove",children:"Remover / Dano (-)"}),m.jsx("option",{value:"convert",children:"Converter"}),m.jsx("option",{value:"none",children:"Nenhum (Apenas Informativo)"})]}),w.action!=="none"&&m.jsx("div",{style:{marginTop:"5px"},children:w.action==="convert"?m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",background:"rgba(255,255,255,0.03)",padding:"8px",borderRadius:"4px"},children:[m.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.6rem",width:"25px"},children:"DE:"}),m.jsx("input",{type:"number",className:"input-dark-sheet",style:{width:"50px",textAlign:"center"},value:w.source_qty??1,onChange:k=>Y(w.id,"source_qty",Number(k.target.value))}),m.jsx("select",{className:"input-dark-sheet",style:{flex:1},value:w.source_resource??"success",onChange:k=>Y(w.id,"source_resource",k.target.value),children:Ia.targets.map(k=>m.jsx("option",{value:k,children:kd[k]||k},k))})]}),m.jsxs("div",{style:{display:"flex",gap:"5px",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.6rem",width:"25px"},children:"PARA:"}),m.jsx("input",{type:"number",className:"input-dark-sheet",style:{width:"50px",textAlign:"center"},value:w.target_qty,onChange:k=>Y(w.id,"target_qty",Number(k.target.value))}),m.jsx("select",{className:"input-dark-sheet",style:{flex:1},value:w.target_resource,onChange:k=>Y(w.id,"target_resource",k.target.value),children:Ia.targets.map(k=>m.jsx("option",{value:k,children:kd[k]||k},k))})]})]}):m.jsxs("div",{style:{display:"flex",gap:"8px"},children:[m.jsx("input",{type:"number",className:"input-dark-sheet",style:{width:"70px",textAlign:"center"},value:w.target_qty,onChange:k=>Y(w.id,"target_qty",Number(k.target.value))}),m.jsx("select",{className:"input-dark-sheet",style:{flex:1},value:w.target_resource,onChange:k=>Y(w.id,"target_resource",k.target.value),children:Ia.targets.map(k=>m.jsx("option",{value:k,children:kd[k]||k},k))})]})}),m.jsx("div",{style:{marginTop:"auto",paddingTop:"10px",display:"flex",flexDirection:"column",gap:"10px"},children:m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.8rem",color:H?"#ff6666":"#888"},children:H?"ANULA O EFEITO PRINCIPAL?":"OBRIGATRIO?"}),m.jsxs("label",{className:"tech-switch",children:[H?m.jsx("input",{type:"checkbox",checked:w.negate_main_effect_on_failure,onChange:k=>Y(w.id,"negate_main_effect_on_failure",k.target.checked)}):m.jsx("input",{type:"checkbox",checked:w.is_mandatory,onChange:k=>Y(w.id,"is_mandatory",k.target.checked)}),m.jsx("span",{className:"tech-slider"})]})]})})]})]}),!H&&m.jsxs("div",{style:{marginTop:"20px",paddingTop:"10px",borderTop:"1px dashed rgba(255,255,255,0.1)"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.8rem",fontWeight:"bold",color:w.penalty?.enabled?"#ff5555":"#666"},children:" RISCO / PENALIDADE NESTE EFEITO"}),m.jsxs("label",{className:"tech-switch",children:[m.jsx("input",{type:"checkbox",checked:w.penalty?.enabled,onChange:k=>p(w.id,"penalty",{...w.penalty,enabled:k.target.checked})}),m.jsx("span",{className:"tech-slider"})]})]}),w.penalty?.enabled&&m.jsxs("div",{style:{marginTop:"15px",padding:"10px",background:"rgba(50,0,0,0.15)",borderRadius:"4px",borderLeft:"3px solid #ff5555"},children:[m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",style:{color:"#ff8888"},children:"DESCRIO NARRATIVA DO RISCO"}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Ex: Causa superaquecimento se falhar...",value:w.penalty.description||"",onChange:k=>p(w.id,"penalty",{...w.penalty,description:k.target.value})})]}),m.jsx("div",{className:"im-section-title",style:{fontSize:"0.75rem",color:"#ff8888",border:"none",padding:0,marginTop:"10px"},children:"CONSEQUNCIAS (LISTA DE RISCOS)"}),w.penalty.consequences?.map((k,le)=>R(k,le,!0,w.id)),m.jsx("button",{type:"button",className:"btn-action-outline danger",style:{width:"100%",marginTop:"5px",padding:"6px",fontSize:"0.7rem",borderStyle:"dashed",borderColor:"#ff4444",color:"#ff8888"},onClick:()=>y(w.id),children:"+ ADICIONAR NOVA CONSEQUNCIA"})]})]})]},w.id)};return m.jsx("div",{className:"modal-overlay",style:{zIndex:2100},children:m.jsxs("div",{className:"modal-box",style:{maxWidth:"900px",width:"95%"},children:[m.jsxs("div",{className:"modal-header-row",children:[m.jsx("h3",{className:"modal-title",children:n?"EDITAR CARACTERSTICA":"NOVA CARACTERSTICA"}),m.jsxs("div",{className:"im-tabs-inner",style:{marginBottom:0},children:[m.jsx("button",{className:`im-inner-tab ${c==="info"?"active":""}`,onClick:()=>u("info"),children:"DADOS"}),m.jsx("button",{className:`im-inner-tab ${c==="mechanics"?"active":""}`,onClick:()=>u("mechanics"),children:"MECNICA"})]})]}),c==="info"&&m.jsxs("div",{className:"modal-body-scroll",children:[m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"4fr 1fr",gap:"15px",marginBottom:"15px"},children:[m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"NOME"}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Nome...",value:o.name,onChange:w=>l({...o,name:w.target.value}),autoFocus:!0})]}),m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"CUSTO"}),m.jsx("input",{type:"number",className:"input-dark-sheet",style:{textAlign:"center"},value:o.cost,onChange:w=>l({...o,cost:Number(w.target.value)})})]})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"DESCRIO"}),m.jsx("textarea",{className:"input-dark-sheet",rows:4,value:o.description,onChange:w=>l({...o,description:w.target.value})})]})]}),c==="mechanics"&&m.jsxs("div",{className:"modal-body-scroll",children:[m.jsx("div",{className:"im-section-title",style:{border:"none",padding:0,marginBottom:"15px"},children:"EFEITOS E GATILHOS"}),o.mechanics.effects.map((w,V)=>R(w,V,!1)),m.jsx("button",{type:"button",className:"btn-action-outline",style:{width:"100%",marginTop:"10px",marginBottom:"30px",padding:"12px",borderStyle:"dashed"},onClick:A,children:"+ ADICIONAR EFEITO"}),m.jsx("div",{className:"im-section-title",style:{border:"none",padding:0,marginBottom:"10px"},children:"LIMITAES (TEMPO)"}),m.jsx("div",{className:"sync-panel",children:m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"COOLDOWN (FREQUNCIA DE USO)"}),m.jsxs("select",{className:"input-dark-sheet",value:o.mechanics.cooldown.type,onChange:w=>S("type",w.target.value),children:[m.jsx("option",{value:"unlimited",children:"Ilimitado"}),m.jsx("option",{value:"1_scene",children:"1x por Cena"}),m.jsx("option",{value:"1_session",children:"1x por Sesso"}),m.jsx("option",{value:"1_day",children:"1x por Dia"})]})]})})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"CANCELAR"}),m.jsx("button",{className:"btn-primary-action",onClick:()=>t(o),children:n?"ATUALIZAR":"CRIAR"})]})]})})},MP=({isOpen:a,onClose:e,onSave:t,initialData:n,availableTraits:i,onCreateTrait:s,currentLibraryId:o})=>{const l={name:"",description:"",slots:1,category:"Geral",charges:0,quality:3,traits:[],library_id:n?.library_id||o||""},[c,u]=J.useState(l),[h,A]=J.useState("info");if(J.useEffect(()=>{a&&(u(n?{...l,...n}:{...l,library_id:o,traits:[]}),A("info"))},[n,a,o]),!a)return null;const f=y=>{const G=c.traits.find(S=>S.id===y.id);let B;G?B=c.traits.filter(S=>S.id!==y.id):B=[...c.traits,{id:y.id,name:y.name}],u({...c,traits:B})},p=()=>{if(!c.name.trim())return alert("O item precisa de um nome.");if(!c.library_id)return console.error("ERRO: library_id est vazio.",c),alert("Erro: Biblioteca no identificada. Recarregue a pgina.");t(c)};return m.jsx("div",{className:"modal-overlay",style:{zIndex:2100},children:m.jsxs("div",{className:"modal-box",style:{maxWidth:"700px"},children:[m.jsxs("div",{className:"modal-header-row",children:[m.jsx("h3",{className:"modal-title",children:n?"RECALIBRAR ITEM":"FORJAR NOVO ITEM"}),m.jsxs("div",{className:"im-tabs-inner",style:{marginBottom:0},children:[m.jsx("button",{className:`im-inner-tab ${h==="info"?"active":""}`,onClick:()=>A("info"),children:"DADOS FSICOS"}),m.jsx("button",{className:`im-inner-tab ${h==="traits"?"active":""}`,onClick:()=>A("traits"),children:"CARACTERSTICAS"})]})]}),h==="info"&&m.jsxs("div",{className:"modal-body-scroll",children:[m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"NOME"}),m.jsx("input",{className:"input-dark-sheet",value:c.name,onChange:y=>u({...c,name:y.target.value}),autoFocus:!0})]}),m.jsxs("div",{className:"grid-2col mb-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"CATEGORIA"}),m.jsxs("select",{className:"input-dark-sheet",value:c.category,onChange:y=>u({...c,category:y.target.value}),children:[m.jsx("option",{children:"Geral"}),m.jsx("option",{children:"Arma"}),m.jsx("option",{children:"Proteo"}),m.jsx("option",{children:"Consumvel"}),m.jsx("option",{children:"Ferramenta"}),m.jsx("option",{children:"Vesturio"}),m.jsx("option",{children:"Acessrio"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"ESPAO (SLOTS)"}),m.jsx("input",{type:"number",className:"input-dark-sheet",value:c.slots,onChange:y=>u({...c,slots:Number(y.target.value)}),step:"0.5"})]})]}),m.jsxs("div",{className:"mb-2",style:{background:"rgba(255,255,255,0.03)",padding:"10px",borderRadius:"4px",border:"1px solid rgba(255,255,255,0.1)"},children:[m.jsx("label",{className:"input-label",style:{color:"var(--cor-tema)"},children:"QUALIDADE & DURABILIDADE"}),m.jsx("select",{className:"input-dark-sheet",value:c.quality??3,onChange:y=>u({...c,quality:Number(y.target.value)}),style:{fontWeight:"bold"},children:Object.entries($B).map(([y,G])=>m.jsx("option",{value:y,children:G.label},y))}),m.jsxs("div",{style:{marginTop:"8px",fontSize:"0.8rem",color:"#ccc",paddingLeft:"5px",borderLeft:"2px solid var(--cor-tema)"},children:[m.jsxs("div",{style:{marginBottom:"4px"},children:[" ",m.jsx("b",{children:"Regra:"})," ",$B[c.quality??3]?.desc]}),m.jsxs("div",{children:[" ",m.jsx("b",{children:"Bnus:"})," ",$B[c.quality??3]?.bonus]})]})]}),(c.category==="Consumvel"||c.category==="Arma"||c.category==="Ferramenta")&&m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"CARGAS / DOSES / MUNIO"}),m.jsx("input",{type:"number",className:"input-dark-sheet",value:c.charges,onChange:y=>u({...c,charges:Number(y.target.value)})})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"DESCRIO"}),m.jsx("textarea",{className:"input-dark-sheet",rows:4,value:c.description,onChange:y=>u({...c,description:y.target.value})})]})]}),h==="traits"&&m.jsxs("div",{className:"modal-body-scroll",children:[m.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:"15px"},children:m.jsx("button",{className:"btn-action-outline",onClick:s,style:{fontSize:"0.7rem"},children:"+ NOVA CARACTERSTICA"})}),m.jsx("div",{className:"im-section-title",style:{border:"none",padding:0},children:"SELECIONAR CARACTERSTICAS"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[i.map(y=>{const G=c.traits.some(B=>B.id===y.id);return m.jsxs("div",{onClick:()=>f(y),style:{padding:"10px",background:G?"rgba(var(--cor-tema-rgb), 0.2)":"rgba(255,255,255,0.05)",border:G?"1px solid var(--cor-tema)":"1px solid transparent",cursor:"pointer",borderRadius:"4px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[m.jsxs("div",{children:[m.jsx("span",{style:{fontWeight:"bold",color:G?"#fff":"#ccc"},children:y.name}),y.cost!==0&&m.jsxs("span",{style:{fontSize:"0.7rem",color:"#888",marginLeft:"8px"},children:["Custo: ",y.cost]}),m.jsx("div",{style:{fontSize:"0.8rem",color:"#666"},children:y.description?y.description.substring(0,50)+"...":"Sem descrio"})]}),G&&m.jsx("span",{style:{color:"var(--cor-tema)"},children:""})]},y.id)}),i.length===0&&m.jsx("div",{className:"empty-state-mini",children:"Nenhuma caracterstica encontrada. Crie uma nova."})]})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"CANCELAR"}),m.jsx("button",{className:"btn-primary-action",onClick:p,children:"SALVAR"})]})]})})},_P=({isOpen:a,onClose:e,onSave:t,initialData:n})=>{const[i,s]=J.useState(""),[o,l]=J.useState(""),[c,u]=J.useState(!1);return J.useEffect(()=>{n?(s(n.name),l(n.description||""),u(n.is_public)):(s(""),l(""),u(!1))},[n,a]),a?m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box",children:[m.jsx("h3",{className:"modal-title",children:n?"EDITAR DEPSITO":"NOVO DEPSITO"}),m.jsx("input",{className:"input-dark-sheet mb-2",placeholder:"Nome da Coleo",value:i,onChange:h=>s(h.target.value),autoFocus:!0}),m.jsx("textarea",{className:"input-dark-sheet mb-2",placeholder:"Descrio",rows:3,value:o,onChange:h=>l(h.target.value)}),m.jsxs("div",{className:"tech-toggle-container mb-2",children:[m.jsx("span",{className:"tech-toggle-label",children:"Disponibilizar para a Comunidade"}),m.jsxs("label",{className:"tech-switch",children:[m.jsx("input",{type:"checkbox",checked:c,onChange:h=>u(h.target.checked)}),m.jsx("span",{className:"tech-slider"})]})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"CANCELAR"}),m.jsx("button",{className:"btn-primary-action",onClick:()=>t({name:i,description:o,is_public:c}),children:"SALVAR"})]})]})}):null},XP=({isOpen:a,onClose:e,onClone:t})=>{const[n,i]=J.useState([]),[s,o]=J.useState([]),[l,c]=J.useState(!1),[u,h]=J.useState(null);J.useEffect(()=>{a&&A()},[a]);const A=async()=>{c(!0);try{const[y,G]=await Promise.all([Oa.getPublicLibraries(),Oa.getFavoriteIds()]);i(y||[]),o(G||[])}catch(y){console.error("Erro ao carregar comunidade de itens",y)}finally{c(!1)}},f=async y=>{try{const G=await Oa.toggleFavorite(y);o(G?[...s,y]:s.filter(B=>B!==y)),t()}catch(G){console.error(G),alert("Erro ao favoritar")}},p=async y=>{if(confirm(`Clonar "${y.name}" para seus depsitos?`)){h(y.id);try{await Oa.createLibrary(y),alert("Depsito clonado com sucesso!"),t(),e()}catch(G){console.error(G),alert("Erro ao clonar depsito.")}finally{h(null)}}};return a?m.jsx("div",{className:"modal-overlay",style:{zIndex:2200},children:m.jsxs("div",{className:"modal-box large-modal",style:{maxWidth:"900px",height:"80vh",display:"flex",flexDirection:"column"},children:[m.jsxs("div",{className:"modal-header-row",children:[m.jsx("h3",{className:"modal-title",children:"COMUNIDADE DE ITENS"}),m.jsx("button",{className:"btn-close-x",onClick:e,style:{fontSize:"1.5rem",background:"none",border:"none",color:"#fff",cursor:"pointer"},children:""})]}),m.jsxs("div",{className:"community-list-scroll",style:{flex:1,overflowY:"auto",padding:"10px"},children:[l&&m.jsx("div",{className:"loading-text",children:"Buscando sinais na rede..."}),!l&&m.jsx("div",{className:"bib-card-grid",children:n.map(y=>{const G=s.includes(y.id);return m.jsxs("div",{className:`bib-card ${y.is_official?"official":""}`,style:{minHeight:"auto"},children:[m.jsxs("div",{className:"bib-card-header",children:[m.jsx("span",{className:"bib-card-title",children:y.name}),m.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"5px",alignItems:"center"},children:[y.is_public&&m.jsx("span",{className:"badge-public",children:"PBLICO"}),y.is_official&&m.jsx("span",{className:"badge-official",children:"SISTEMA"})]}),m.jsxs("span",{className:"bib-car-author",children:["Criado por: ",y.profiles?.username||"Desconhecido"]})]}),m.jsx("div",{className:"bib-card-body",style:{fontSize:"0.85rem",marginBottom:"15px"},children:y.description||"Sem descrio."}),m.jsxs("div",{className:"bib-card-footer",style:{paddingTop:"10px",gap:"10px"},children:[m.jsx("button",{className:"bib-btn-explore",onClick:()=>f(y.id),title:G?"Remover dos favoritos":"Adicionar aos favoritos",style:{flex:1,height:"32px",padding:0,"--cor-tema":G?"gold":"#888","--cor-tema-rgb":G?"255, 215, 0":"136, 136, 136","--cor-tema-glow":G?"gold":"rgba(136,136,136,0.5)",borderColor:G?"gold":"#444"},children:m.jsx("span",{style:{fontSize:"1.2rem",lineHeight:0},children:G?"":""})}),m.jsx("button",{className:"btn-action-primary",style:{flex:3,fontSize:"0.75rem"},onClick:()=>p(y),disabled:u===y.id,children:u===y.id?"...":"CLONAR"})]})]},y.id)})}),!l&&n.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhum depsito pblico encontrado."})]})]})}):null},YP=({isOpen:a,onClose:e,onSave:t,initialData:n,availableItems:i})=>{const[s,o]=J.useState(""),[l,c]=J.useState([]);J.useEffect(()=>{a&&(n?(o(n.name),c(n.items||[])):u())},[a,n]);const u=()=>{o(""),c([])},h=()=>{if(!s.trim())return alert("Nome  obrigatrio");t({id:n?.id,name:s,items:l})},A=y=>{l.includes(y)?c(l.filter(G=>G!==y)):c([...l,y])};if(!a)return null;const f=i.filter(y=>l.includes(y.id)),p=i.filter(y=>!l.includes(y.id));return m.jsx("div",{className:"modal-overlay",children:m.jsxs("div",{className:"modal-box",style:{maxWidth:"700px"},children:[m.jsx("h3",{className:"modal-title",children:n?"Editar Kit":"Novo Kit"}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"Nome do Kit"}),m.jsx("input",{className:"input-dark-sheet",value:s,onChange:y=>o(y.target.value),placeholder:"Ex: Kit de Sobrevivncia",autoFocus:!0})]}),m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginTop:"20px",height:"300px"},children:[m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx("label",{className:"input-label",style:{color:"#888"},children:"Itens Disponveis"}),m.jsxs("div",{className:"input-dark-sheet",style:{flex:1,overflowY:"auto",padding:"5px"},children:[p.length===0&&m.jsx("div",{style:{padding:"10px",color:"#666",fontSize:"0.8rem"},children:"Sem itens disponveis."}),p.map(y=>m.jsxs("div",{onClick:()=>A(y.id),style:{padding:"8px",borderBottom:"1px solid #333",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseEnter:G=>G.currentTarget.style.background="#222",onMouseLeave:G=>G.currentTarget.style.background="transparent",children:[m.jsx("span",{style:{fontSize:"0.85rem"},children:y.name}),m.jsx("span",{style:{color:"var(--cor-tema)",fontWeight:"bold"},children:"+"})]},y.id))]})]}),m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsxs("label",{className:"input-label",style:{color:"#aaffaa"},children:["Itens no Kit (",f.length,")"]}),m.jsxs("div",{className:"input-dark-sheet",style:{flex:1,overflowY:"auto",padding:"5px",borderColor:"rgba(100,255,100,0.3)"},children:[f.length===0&&m.jsx("div",{style:{padding:"10px",color:"#666",fontSize:"0.8rem"},children:"Nenhum item selecionado."}),f.map(y=>m.jsxs("div",{onClick:()=>A(y.id),style:{padding:"8px",borderBottom:"1px solid #333",cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"center"},onMouseEnter:G=>G.currentTarget.style.background="rgba(255,0,0,0.1)",onMouseLeave:G=>G.currentTarget.style.background="transparent",children:[m.jsx("span",{style:{fontSize:"0.85rem"},children:y.name}),m.jsx("span",{style:{color:"#ff6666",fontWeight:"bold"},children:""})]},y.id))]})]})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"Cancelar"}),m.jsx("button",{className:"btn-primary-action",onClick:h,children:"Salvar Kit"})]})]})})};function HP(){const[a,e]=J.useState("libraries"),[t,n]=J.useState([]),[i,s]=J.useState([]),[o,l]=J.useState(null),[c,u]=J.useState("items"),[h,A]=J.useState([]),[f,p]=J.useState([]),[y,G]=J.useState([]),[B,S]=J.useState(!1),[N,R]=J.useState(!1),[w,V]=J.useState(!1),[H,X]=J.useState(!1),[Y,M]=J.useState(!1),[E,O]=J.useState(null);J.useEffect(()=>{a==="libraries"&&P()},[a]),J.useEffect(()=>{a==="items"&&o&&(k(o.id),q(o.id),c==="kits"&&le(o.id))},[a,o,c]);const P=async()=>{try{const[D,de]=await Promise.all([Oa.getMyLibraries(),Oa.getMyFavorites()]),ee=(Ce,we)=>Ce.is_official===we.is_official?0:Ce.is_official?-1:1;n(D.sort(ee)),s(de.sort(ee))}catch(D){console.error(D)}},q=async D=>{try{const de=await Oa.getItemsByLibrary(D);A(de)}catch(de){console.error(de)}},k=async D=>{try{const de=await Oa.getTraitsByLibrary(D);p(de)}catch(de){console.error(de)}},le=async D=>{try{const de=await Oa.getKitsByLibrary(D);G(de)}catch(de){console.error("Erro ao carregar kits",de)}},F=async D=>{try{E?await Oa.updateLibrary(E.id,D):await Oa.createLibrary(D),S(!1),P()}catch{alert("Erro ao salvar.")}},j=async D=>{confirm("Tem certeza?")&&(await Oa.deleteLibrary(D),P())},Q=async D=>{try{E&&E.id?await Oa.updateItem(E.id,D):await Oa.createItem({...D,library_id:o.id}),R(!1),q(o.id)}catch(de){console.error(de),alert("Erro ao salvar item.")}},ce=async D=>{confirm("Apagar item?")&&(await Oa.deleteItem(D),q(o.id))},oe=async D=>{try{await Oa.saveTrait({...D,library_id:o.id}),V(!1),k(o.id)}catch{alert("Erro ao salvar caracterstica.")}},T=async D=>{confirm("Apagar caracterstica?")&&(await Oa.deleteTrait(D),k(o.id))},$=async D=>{try{await Oa.saveKit({...D,library_id:o.id}),X(!1),le(o.id)}catch{alert("Erro ao salvar kit.")}},ae=async D=>{confirm("Apagar kit?")&&(await Oa.deleteKit(D),le(o.id))},Ie=()=>{R(!1),O(null),V(!0),u("traits")},be=(D,de)=>m.jsxs("div",{className:`bib-card ${D.is_official?"official":""}`,children:[m.jsxs("div",{className:"bib-card-header",children:[m.jsx("span",{className:"bib-card-title",children:D.name}),(D.is_public||D.is_official)&&m.jsxs("div",{children:[D.is_public&&m.jsx("span",{className:"bib-badge-public",children:"PBLICO"}),D.is_official&&m.jsx("span",{className:"bib-badge-official",children:"SISTEMA"})]})]}),m.jsx("div",{className:"bib-card-body",children:D.description||"Sem descrio."}),m.jsxs("div",{className:"bib-card-footer",children:[m.jsx("button",{className:"btn-open-lib",onClick:()=>{l(D),e("items"),u("items")},children:"ABRIR"}),de&&m.jsxs("div",{className:"bib-card-actions",children:[m.jsx("button",{className:"btn-icon",onClick:()=>{O(D),S(!0)},children:""}),!D.is_official&&m.jsx("button",{className:"btn-icon danger",onClick:()=>j(D.id),children:""})]})]})]},D.id);return m.jsxs("div",{children:[m.jsx("div",{className:"im-header",children:a==="libraries"?m.jsxs(m.Fragment,{children:[m.jsx("h1",{className:"chars-title",children:"Depsitos de Itens"}),m.jsxs("div",{className:"im-actions-top",children:[m.jsx("button",{className:"btn-action-outline",onClick:()=>M(!0),children:"EXPLORAR COMUNIDADE"}),m.jsx("button",{className:"btn-action-primary",onClick:()=>{O(null),S(!0)},children:"+ NOVO"})]})]}):m.jsxs("div",{className:"im-breadcrumbs",children:[m.jsx("button",{className:"btn-back-text",onClick:()=>e("libraries"),children:" VOLTAR"}),m.jsx("span",{className:"im-separator",children:"/"}),m.jsx("span",{className:"im-current-lib",children:o?.name})]})}),m.jsxs("div",{className:"im-content",children:[a==="libraries"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"im-section",children:[m.jsx("h3",{className:"im-section-title",children:"MEUS DEPSITOS"}),m.jsxs("div",{className:"bib-card-grid",children:[t.map(D=>be(D,!0)),t.length===0&&m.jsx("div",{className:"empty-state-mini",children:"Sem depsitos."})]})]}),m.jsxs("div",{className:"im-section",children:[m.jsx("h3",{className:"im-section-title",children:"MEUS FAVORITOS"}),m.jsx("div",{className:"bib-card-grid",children:i.map(D=>be(D,!1))})]})]}),a==="items"&&o&&m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"im-tabs-inner",style:{marginBottom:"20px",display:"flex",gap:"5px",borderBottom:"1px solid rgba(255,255,255,0.1)"},children:["items","traits","kits"].map(D=>m.jsx("button",{onClick:()=>u(D),style:{background:c===D?"var(--cor-tema)":"transparent",color:c===D?"#000":"#888",border:"none",padding:"10px 20px",fontWeight:"800",textTransform:"uppercase",cursor:"pointer",borderRadius:"4px 4px 0 0"},children:D==="items"?"Itens":D==="traits"?"Caractersticas":"Kits"},D))}),c==="items"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"im-toolbar",children:[m.jsxs("span",{className:"im-counter",children:[h.length," ITENS"]}),t.some(D=>D.id===o.id)&&m.jsx("button",{className:"btn-action-primary",onClick:()=>{O(null),R(!0)},children:"+ NOVO ITEM"})]}),m.jsxs("div",{className:"items-list-container",children:[h.map(D=>m.jsxs("div",{className:"item-row",children:[m.jsxs("div",{className:"item-info",children:[m.jsxs("div",{className:"item-main",children:[m.jsx("span",{className:"item-name",children:D.name}),m.jsx("span",{className:"item-cat",children:D.category})]}),m.jsx("p",{className:"item-desc",children:D.description}),m.jsx("div",{style:{display:"flex",gap:"5px",marginTop:"5px"},children:D.traits&&D.traits.map(de=>m.jsx("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(255,255,255,0.1)",borderRadius:"3px",color:"#aaa"},children:de.name},de.id))})]}),m.jsxs("div",{className:"item-meta",children:[m.jsxs("span",{className:"item-slots",children:[D.slots," SLOT(S)"]}),t.some(de=>de.id===o.id)&&m.jsxs("div",{className:"item-actions",children:[m.jsx("button",{className:"btn-icon-small",onClick:()=>{O(D),R(!0)},children:""}),m.jsx("button",{className:"btn-icon-small danger",onClick:()=>ce(D.id),children:""})]})]})]},D.id)),h.length===0&&m.jsx("div",{className:"empty-state",children:"Depsito vazio."})]})]}),c==="traits"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"im-toolbar",children:[m.jsxs("span",{className:"im-counter",children:[f.length," CARACTERSTICAS"]}),t.some(D=>D.id===o.id)&&m.jsx("button",{className:"btn-action-primary",onClick:()=>{O(null),V(!0)},children:"+ NOVA CARAC."})]}),m.jsxs("div",{className:"items-list-container",children:[f.map(D=>m.jsxs("div",{className:"item-row",children:[m.jsxs("div",{className:"item-info",children:[m.jsxs("div",{className:"item-main",children:[m.jsx("span",{className:"item-name",style:{color:"#ffd700"},children:D.name}),D.cost!==0&&m.jsxs("span",{style:{fontSize:"0.7rem",color:"#888",marginLeft:"8px"},children:["Custo: ",D.cost]})]}),m.jsx("p",{className:"item-desc",children:D.description})]}),t.some(de=>de.id===o.id)&&m.jsxs("div",{className:"item-actions",children:[m.jsx("button",{className:"btn-icon-small",onClick:()=>{O(D),V(!0)},children:""}),m.jsx("button",{className:"btn-icon-small danger",onClick:()=>T(D.id),children:""})]})]},D.id)),f.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhuma caracterstica."})]})]}),c==="kits"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"im-toolbar",children:[m.jsxs("span",{className:"im-counter",children:[y.length," KITS"]}),t.some(D=>D.id===o.id)&&m.jsx("button",{className:"btn-action-primary",onClick:()=>{O(null),X(!0)},children:"+ NOVO KIT"})]}),m.jsxs("div",{className:"items-list-container",children:[y.map(D=>m.jsxs("div",{className:"item-row",children:[m.jsxs("div",{className:"item-info",children:[m.jsx("div",{className:"item-main",children:m.jsxs("span",{className:"item-name",style:{color:"#aaffaa"},children:[" ",D.name]})}),m.jsx("p",{className:"item-desc",children:D.description}),m.jsx("div",{style:{display:"flex",gap:"5px",flexWrap:"wrap",marginTop:"5px"},children:D.items&&D.items.length>0?D.items.map(de=>{const ee=h.find(Ce=>Ce.id===de);return ee?m.jsx("span",{style:{fontSize:"0.65rem",padding:"2px 6px",background:"rgba(100,255,100,0.1)",borderRadius:"3px",color:"#afa"},children:ee.name},de):null}):m.jsx("span",{style:{fontSize:"0.7rem",color:"#555"},children:"Kit vazio"})})]}),t.some(de=>de.id===o.id)&&m.jsxs("div",{className:"item-actions",children:[m.jsx("button",{className:"btn-icon-small",onClick:()=>{O(D),X(!0)},children:""}),m.jsx("button",{className:"btn-icon-small danger",onClick:()=>ae(D.id),children:""})]})]},D.id)),y.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhum kit criado."})]})]})]})]}),m.jsx(_P,{isOpen:B,onClose:()=>S(!1),onSave:F,initialData:E}),m.jsx(MP,{isOpen:N,onClose:()=>R(!1),onSave:Q,initialData:E,availableTraits:f,onCreateTrait:Ie,currentLibraryId:o?.id}),m.jsx(VP,{isOpen:w,onClose:()=>V(!1),onSave:oe,initialData:E}),m.jsx(YP,{isOpen:H,onClose:()=>X(!1),onSave:$,initialData:E,availableItems:h}),m.jsx(XP,{isOpen:Y,onClose:()=>M(!1),onClone:P})]})}const zs={async getMyLibraries(){const{data:{user:a}}=await Lt.auth.getUser();if(!a)return[];const{data:e,error:t}=await Lt.from("world_libraries").select("*").eq("user_id",a.id).order("created_at",{ascending:!1});if(t)throw t;return e},async getMyFavorites(){const{data:{user:a}}=await Lt.auth.getUser();if(!a)return[];const{data:e,error:t}=await Lt.from("world_user_favorite_libraries").select("library_id, world_libraries(*)").eq("user_id",a.id);return t?(console.warn("Erro ao buscar favoritos:",t.message),[]):e.map(i=>i.world_libraries).filter(Boolean)},async getPublicLibraries(){const{data:{user:a}}=await Lt.auth.getUser(),{data:e,error:t}=await Lt.from("world_libraries").select("*").or("is_public.eq.true,is_official.eq.true").neq("user_id",a?.id||"").order("is_official",{ascending:!1}).order("name",{ascending:!0});if(t)throw t;return e},async toggleFavorite(a){const{data:{user:e}}=await Lt.auth.getUser();if(!e)return!1;const{data:t}=await Lt.from("world_user_favorite_libraries").select("id").eq("user_id",e.id).eq("library_id",a).single();return t?(await Lt.from("world_user_favorite_libraries").delete().eq("id",t.id),!1):(await Lt.from("world_user_favorite_libraries").insert({user_id:e.id,library_id:a}),!0)},async createLibrary(a){const{data:{user:e}}=await Lt.auth.getUser();if(!e)throw new Error("Sesso invlida.");const{data:t}=await Lt.from("world_libraries").select("settings").eq("is_official",!0).single(),n=t?.settings||{biomes:[],archetypes:[],constructions:[]},{data:i,error:s}=await Lt.from("world_libraries").insert({user_id:e.id,name:a.name,description:a.description,is_public:a.is_public,settings:n}).select().single();if(s)throw new Error(s.message);return i},async updateLibrary(a,e){const{data:{user:t}}=await Lt.auth.getUser();if(!t)throw new Error("Usurio no autenticado");const{error:n}=await Lt.from("world_libraries").update(e).eq("id",a).eq("user_id",t.id);if(n)throw n},async deleteLibrary(a){const{error:e}=await Lt.from("world_libraries").delete().eq("id",a);if(e)throw e},async cloneLibrary(a){const{data:{user:e}}=await Lt.auth.getUser();if(!e)throw new Error("Usurio no logado");const{data:t}=await Lt.from("world_libraries").select("*").eq("id",a).single();if(!t)throw new Error("Erro ao clonar");const{data:n}=await Lt.from("world_libraries").insert({user_id:e.id,name:`${t.name} (Cpia)`,description:t.description,is_public:!1,is_official:!1,settings:t.settings}).select().single();if(!n)throw new Error("Erro ao criar cpia");const{data:i}=await Lt.from("world_regions").select("*").eq("library_id",a);if(i&&i.length>0){const o=i.map(l=>({...l,id:void 0,library_id:n.id}));await Lt.from("world_regions").insert(o)}const{data:s}=await Lt.from("world_refuges").select("*").eq("library_id",a);if(s&&s.length>0){const o=s.map(l=>({...l,id:void 0,library_id:n.id}));await Lt.from("world_refuges").insert(o)}return n},async getRegions(a){const{data:e}=await Lt.from("world_regions").select("*").eq("library_id",a).order("name");return e},async saveRegion(a){const e={...a},t=e.id;delete e.id,t?await Lt.from("world_regions").update(e).eq("id",t):await Lt.from("world_regions").insert(e)},async deleteRegion(a){await Lt.from("world_regions").delete().eq("id",a)},async getRefuges(a){const{data:e}=await Lt.from("world_refuges").select("*").eq("library_id",a).order("name");return e},async saveRefuge(a){const e={...a},t=e.id;delete e.id,t?await Lt.from("world_refuges").update(e).eq("id",t):await Lt.from("world_refuges").insert(e)},async deleteRefuge(a){await Lt.from("world_refuges").delete().eq("id",a)},async updateLibrarySettings(a,e){const{data:{user:t}}=await Lt.auth.getUser();if(!t)throw new Error("Usurio no autenticado");const{error:n}=await Lt.from("world_libraries").update({settings:e}).eq("id",a).eq("user_id",t.id);if(n)throw n}},EP=({isOpen:a,onClose:e,onSave:t,initialData:n})=>{const[i,s]=J.useState({name:"",description:"",is_public:!1});return J.useEffect(()=>{s(n?{name:n.name,description:n.description,is_public:n.is_public}:{name:"",description:"",is_public:!1})},[n,a]),a?m.jsx("div",{className:"modal-overlay",style:{zIndex:2200},children:m.jsxs("div",{className:"modal-box",style:{maxWidth:"500px"},children:[m.jsx("h3",{className:"modal-title",children:n?"EDITAR MUNDO":"CRIAR NOVO MUNDO"}),m.jsxs("div",{className:"modal-body",children:[!n&&m.jsx("div",{style:{padding:"10px",background:"rgba(var(--cor-tema-rgb), 0.1)",borderRadius:"4px",marginBottom:"15px",border:"1px solid var(--cor-tema)",fontSize:"0.85rem",color:"#fff"},children:' Ao criar um novo mundo, ele ser populado automaticamente com todos os Biomas (Floresta, Deserto, etc.), Arqutipos (Agrocultura, Gangue, etc.) e Construes oficiais do livro "Assimilao". Voc poder edit-los depois.'}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"NOME DO MUNDO"}),m.jsx("input",{className:"input-dark-sheet",value:i.name,onChange:o=>s({...i,name:o.target.value}),autoFocus:!0})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"DESCRIO"}),m.jsx("textarea",{className:"input-dark-sheet",rows:3,value:i.description,onChange:o=>s({...i,description:o.target.value})})]}),m.jsxs("div",{className:"mb-2",children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"rgba(255,255,255,0.05)",padding:"10px",borderRadius:"4px"},children:[m.jsx("span",{style:{fontWeight:"bold"},children:"Tornar Pblico?"}),m.jsxs("label",{className:"tech-switch",children:[m.jsx("input",{type:"checkbox",checked:i.is_public,onChange:o=>s({...i,is_public:o.target.checked})}),m.jsx("span",{className:"tech-slider"})]})]}),m.jsx("span",{style:{fontSize:"0.7rem",color:"#888"},children:"Outros jogadores podero ver e clonar seu mundo."})]})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"CANCELAR"}),m.jsx("button",{className:"btn-primary-action",onClick:()=>t(i),children:n?"SALVAR ALTERAES":"CRIAR MUNDO"})]})]})}):null},FP=({library:a,onUpdateSettings:e,readOnly:t=!1})=>{const[n,i]=J.useState("biomes"),[s,o]=J.useState(a.settings),[l,c]=J.useState(""),[u,h]=J.useState(""),[A,f]=J.useState("community"),[p,y]=J.useState(""),[G,B]=J.useState(""),[S,N]=J.useState(null),[R,w]=J.useState(""),[V,H]=J.useState(""),[X,Y]=J.useState("community"),[M,E]=J.useState(""),[O,P]=J.useState(""),q=ee=>{o(ee),e(ee)},k=(ee,Ce,we)=>{t||(N(ee),w(Ce.name),we==="biome"?H(Ce.description):we==="archetype"?(H(Ce.description),Y(Ce.type)):we==="construction"&&(E(Ce.effect),P(Ce.cost||"")))},le=()=>{N(null),w(""),H(""),E(""),P("")},F=()=>{if(!l)return;const ee={...s,biomes:[...s.biomes||[],{name:l,description:u}]};q(ee),c(""),h("")},j=()=>{if(S===null||!R)return;const ee=[...s.biomes];ee[S]={name:R,description:V},q({...s,biomes:ee}),le()},Q=ee=>{if(!confirm("Remover este bioma?"))return;const Ce=[...s.biomes];Ce.splice(ee,1),q({...s,biomes:Ce})},ce=()=>{if(!l)return;const ee={...s,archetypes:[...s.archetypes||[],{name:l,description:u,type:A}]};q(ee),c(""),h("")},oe=()=>{if(S===null||!R)return;const ee=[...s.archetypes||[]];ee[S]={name:R,description:V,type:X},q({...s,archetypes:ee}),le()},T=ee=>{if(!confirm("Remover arqutipo?"))return;const Ce=[...s.archetypes||[]];Ce.splice(ee,1),q({...s,archetypes:Ce})},$=()=>{if(!l)return;const ee={...s,constructions:[...s.constructions||[],{name:l,effect:p,cost:G}]};q(ee),c(""),y(""),B("")},ae=()=>{if(S===null||!R)return;const ee=[...s.constructions||[]];ee[S]={name:R,effect:M,cost:O},q({...s,constructions:ee}),le()},Ie=ee=>{if(!confirm("Remover construo?"))return;const Ce=[...s.constructions||[]];Ce.splice(ee,1),q({...s,constructions:Ce})},be=()=>m.jsxs("div",{className:"settings-panel",children:[!t&&m.jsxs("div",{className:"im-toolbar",style:{background:"rgba(0,0,0,0.3)",marginBottom:"10px"},children:[m.jsx("input",{className:"input-dark-sheet",placeholder:"Novo Bioma (Ex: Selva Txica)",value:l,onChange:ee=>c(ee.target.value),style:{flex:1}}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Descrio rpida...",value:u,onChange:ee=>h(ee.target.value),style:{flex:2}}),m.jsx("button",{className:"btn-action-primary",onClick:F,children:"+ ADICIONAR"})]}),m.jsx("div",{className:"settings-list",children:s.biomes?.map((ee,Ce)=>{const we=S===Ce;return m.jsx("div",{className:"setting-item",style:{background:we?"rgba(var(--cor-tema-rgb), 0.1)":void 0,borderLeftColor:we?"var(--cor-tema)":"transparent"},children:we?m.jsxs("div",{style:{display:"flex",gap:"10px",width:"100%",alignItems:"center"},children:[m.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[m.jsx("input",{className:"input-dark-sheet",value:R,onChange:Ye=>w(Ye.target.value),autoFocus:!0}),m.jsx("textarea",{className:"input-dark-sheet",value:V,onChange:Ye=>H(Ye.target.value),rows:2})]}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-icon",style:{color:"#88ff88"},onClick:j,children:""}),m.jsx("button",{className:"btn-icon danger",onClick:le,children:""})]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{children:[m.jsx("div",{style:{fontWeight:"bold",color:"var(--cor-tema)"},children:ee.name}),m.jsx("div",{style:{fontSize:"0.8rem",color:"#aaa"},children:ee.description})]}),!t&&m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-icon",onClick:()=>k(Ce,ee,"biome"),children:""}),m.jsx("button",{className:"btn-icon danger",onClick:()=>Q(Ce),children:""})]})]})},Ce)})})]}),D=()=>m.jsxs("div",{className:"settings-panel",children:[!t&&m.jsxs("div",{className:"im-toolbar",style:{background:"rgba(0,0,0,0.3)",marginBottom:"10px",gap:"10px"},children:[m.jsxs("select",{className:"input-dark-sheet",value:A,onChange:ee=>f(ee.target.value),style:{width:"120px"},children:[m.jsx("option",{value:"community",children:"Comunidade"}),m.jsx("option",{value:"group",children:"Grupo"})]}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Nome (Ex: Culto Solar)",value:l,onChange:ee=>c(ee.target.value),style:{flex:1}}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Descrio...",value:u,onChange:ee=>h(ee.target.value),style:{flex:2}}),m.jsx("button",{className:"btn-action-primary",onClick:ce,children:"+ ADICIONAR"})]}),m.jsx("div",{className:"settings-list",children:s.archetypes?.map((ee,Ce)=>{const we=S===Ce;return m.jsx("div",{className:"setting-item",style:{background:we?"rgba(var(--cor-tema-rgb), 0.1)":void 0,borderLeftColor:we?"var(--cor-tema)":"transparent"},children:we?m.jsxs("div",{style:{display:"flex",gap:"10px",width:"100%",alignItems:"center"},children:[m.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:"5px"},children:[m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsxs("select",{className:"input-dark-sheet",value:X,onChange:Ye=>Y(Ye.target.value),style:{width:"120px"},children:[m.jsx("option",{value:"community",children:"Comunidade"}),m.jsx("option",{value:"group",children:"Grupo"})]}),m.jsx("input",{className:"input-dark-sheet",value:R,onChange:Ye=>w(Ye.target.value),style:{flex:1},autoFocus:!0})]}),m.jsx("textarea",{className:"input-dark-sheet",value:V,onChange:Ye=>H(Ye.target.value),rows:2})]}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-icon",style:{color:"#88ff88"},onClick:oe,children:""}),m.jsx("button",{className:"btn-icon danger",onClick:le,children:""})]})]}):m.jsxs(m.Fragment,{children:[m.jsxs("div",{children:[m.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[m.jsxs("span",{style:{fontWeight:"bold",color:ee.type==="community"?"#aaffaa":"#aaaaff"},children:[ee.type==="community"?"":""," ",ee.name]}),m.jsx("span",{style:{fontSize:"0.6rem",padding:"2px 5px",background:"rgba(255,255,255,0.1)",borderRadius:"3px"},children:ee.type==="community"?"FIXO":"MVEL"})]}),m.jsx("div",{style:{fontSize:"0.8rem",color:"#aaa"},children:ee.description})]}),!t&&m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-icon",onClick:()=>k(Ce,ee,"archetype"),children:""}),m.jsx("button",{className:"btn-icon danger",onClick:()=>T(Ce),children:""})]})]})},Ce)})})]}),de=()=>m.jsxs("div",{className:"settings-panel",children:[!t&&m.jsxs("div",{className:"im-toolbar",style:{background:"rgba(0,0,0,0.3)",marginBottom:"10px",display:"grid",gridTemplateColumns:"1fr 2fr 1fr 120px",gap:"10px"},children:[m.jsx("input",{className:"input-dark-sheet",placeholder:"Nome (Ex: Enfermaria)",value:l,onChange:ee=>c(ee.target.value)}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Efeito / Regra",value:p,onChange:ee=>y(ee.target.value)}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Custo (Opcional)",value:G,onChange:ee=>B(ee.target.value)}),m.jsx("button",{className:"btn-action-primary",onClick:$,children:"+ ADD"})]}),m.jsxs("div",{className:"settings-list",children:[m.jsxs("div",{style:{display:"grid",gridTemplateColumns:t?"1fr 2fr 1fr":"1fr 2fr 1fr 60px",padding:"0 10px",color:"#888",fontSize:"0.7rem",fontWeight:"bold",gap:"10px"},children:[m.jsx("span",{children:"NOME"}),m.jsx("span",{children:"EFEITO"}),m.jsx("span",{children:"CUSTO"}),!t&&m.jsx("span",{})]}),s.constructions?.map((ee,Ce)=>{const we=S===Ce;return m.jsx("div",{className:"setting-item",style:{display:"block",padding:we?"10px":"12px"},children:we?m.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[m.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr 1fr",gap:"10px",flex:1},children:[m.jsx("input",{className:"input-dark-sheet",value:R,onChange:Ye=>w(Ye.target.value),autoFocus:!0}),m.jsx("input",{className:"input-dark-sheet",value:M,onChange:Ye=>E(Ye.target.value)}),m.jsx("input",{className:"input-dark-sheet",value:O,onChange:Ye=>P(Ye.target.value)})]}),m.jsxs("div",{style:{display:"flex",gap:"5px"},children:[m.jsx("button",{className:"btn-icon",style:{color:"#88ff88"},onClick:ae,children:""}),m.jsx("button",{className:"btn-icon danger",onClick:le,children:""})]})]}):m.jsxs("div",{style:{display:"grid",gridTemplateColumns:t?"1fr 2fr 1fr":"1fr 2fr 1fr 60px",gap:"10px",alignItems:"center"},children:[m.jsx("div",{style:{fontWeight:"bold",color:"var(--cor-tema)"},children:ee.name}),m.jsx("div",{style:{fontSize:"0.85rem",color:"#ccc"},children:ee.effect}),m.jsx("div",{style:{fontSize:"0.8rem",color:"#88ff88"},children:ee.cost||"-"}),!t&&m.jsxs("div",{style:{display:"flex",gap:"5px",justifyContent:"flex-end"},children:[m.jsx("button",{className:"btn-icon",onClick:()=>k(Ce,ee,"construction"),children:""}),m.jsx("button",{className:"btn-icon danger",onClick:()=>Ie(Ce),children:""})]})]})},Ce)}),(!s.constructions||s.constructions.length===0)&&m.jsx("div",{className:"empty-state-mini",style:{textAlign:"center",marginTop:"20px"},children:"Nenhuma construo cadastrada."})]})]});return m.jsxs("div",{children:[m.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"15px",flexWrap:"wrap"},children:[m.jsx("button",{className:`btn-action-outline ${n==="biomes"?"active":""}`,onClick:()=>i("biomes"),children:"BIOMAS"}),m.jsx("button",{className:`btn-action-outline ${n==="archetypes"?"active":""}`,onClick:()=>i("archetypes"),children:"ARQUTIPOS"}),m.jsx("button",{className:`btn-action-outline ${n==="constructions"?"active":""}`,onClick:()=>i("constructions"),children:"CONSTRUES"})]}),n==="biomes"&&be(),n==="archetypes"&&D(),n==="constructions"&&de()]})},bN={size:"Tamanho",danger:"Perigo",habitation:"Habitao",resources_level:"Nvel de Recursos",contamination:"Contaminao",displacement:"Deslocamento"},KP=({isOpen:a,onClose:e,onSave:t,library:n,initialData:i})=>{const s={size:0,danger:0,habitation:0,resources_level:0,contamination:0,displacement:0},o={size:"",danger:"",habitation:"",resources:"",contamination:"",displacement:"",general:""},[l,c]=J.useState({library_id:n.id,name:"",biome:n.settings.biomes?.[0]?.name||"",stats:s,descriptions:o,details:{resource_types_found:[],landmarks:[],adventure_hooks:""}}),[u,h]=J.useState("geral"),[A,f]=J.useState({name:"",description:"",is_visible:!0}),[p,y]=J.useState("");if(J.useEffect(()=>{a&&(c(i?JSON.parse(JSON.stringify(i)):{library_id:n.id,name:"",biome:n.settings.biomes?.[0]?.name||"",stats:s,descriptions:o,details:{resource_types_found:[],landmarks:[],adventure_hooks:""}}),h("geral"))},[a,i,n]),!a)return null;const G=(Y,M)=>{const E={...l.stats,[Y]:M};Y==="size"&&E.habitation>M&&(E.habitation=M),Y==="habitation"&&M>E.size&&(E.habitation=E.size),c({...l,stats:E})},B=(Y,M)=>{c({...l,descriptions:{...l.descriptions,[Y]:M}})},S=()=>{A.name&&(c({...l,details:{...l.details,landmarks:[...l.details.landmarks,A]}}),f({name:"",description:"",is_visible:!0}))},N=Y=>{const M=[...l.details.landmarks];M[Y].is_visible===void 0&&(M[Y].is_visible=!0),M[Y].is_visible=!M[Y].is_visible,c({...l,details:{...l.details,landmarks:M}})},R=Y=>{const M=[...l.details.landmarks];M.splice(Y,1),c({...l,details:{...l.details,landmarks:M}})},w=()=>{p&&(c({...l,details:{...l.details,resource_types_found:[...l.details.resource_types_found,p]}}),y(""))},V=Y=>{const M=[...l.details.resource_types_found];M.splice(Y,1),c({...l,details:{...l.details,resource_types_found:M}})},H=()=>{if(!l.name)return alert("A regio precisa de um nome.");t(l)},X=["size","danger","habitation","resources_level","contamination","displacement"];return m.jsx("div",{className:"modal-overlay",style:{zIndex:2200},children:m.jsxs("div",{className:"modal-box",style:{maxWidth:"800px",height:"85vh",display:"flex",flexDirection:"column"},children:[m.jsxs("div",{className:"modal-header-row",children:[m.jsx("h3",{className:"modal-title",children:i?"EDITAR REGIO":"NOVA REGIO"}),m.jsxs("div",{className:"wm-tabs",style:{marginBottom:0,borderBottom:"none"},children:[m.jsx("button",{className:`wm-tab ${u==="geral"?"active":""}`,onClick:()=>h("geral"),children:"GERAL"}),m.jsx("button",{className:`wm-tab ${u==="stats"?"active":""}`,onClick:()=>h("stats"),children:"ESTATSTICAS"}),m.jsx("button",{className:`wm-tab ${u==="marcos"?"active":""}`,onClick:()=>h("marcos"),children:"MARCOS"})]})]}),m.jsxs("div",{className:"modal-body-scroll",style:{flex:1,overflowY:"auto",padding:"20px"},children:[u==="geral"&&m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[m.jsxs("div",{className:"wm-grid-2col",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"NOME DA REGIO"}),m.jsx("input",{className:"input-dark-sheet",value:l.name,onChange:Y=>c({...l,name:Y.target.value}),autoFocus:!0})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"BIOMA DOMINANTE"}),m.jsx("select",{className:"input-dark-sheet",value:l.biome,onChange:Y=>c({...l,biome:Y.target.value}),children:n.settings.biomes.map((Y,M)=>m.jsx("option",{value:Y.name,children:Y.name},M))}),m.jsx("div",{style:{fontSize:"0.85rem",color:"#ccc",marginTop:"10px",lineHeight:"1.5",textAlign:"justify",textIndent:"2em",background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"4px",borderLeft:"2px solid var(--cor-tema)"},children:n.settings.biomes.find(Y=>Y.name===l.biome)?.description})]})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"DESCRIO GERAL / VISUAL"}),m.jsx("textarea",{className:"input-dark-sheet",style:{height:"100%"},value:l.descriptions.general,onChange:Y=>B("general",Y.target.value),placeholder:"Como  a atmosfera deste lugar? Descreva o ambiente..."})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"input-label",children:"GANCHOS DE AVENTURA"}),m.jsx("textarea",{className:"input-dark-sheet",rows:4,placeholder:"Oportunidades, Oposies e Consequncias nesta regio...",value:l.details.adventure_hooks,onChange:Y=>c({...l,details:{...l.details,adventure_hooks:Y.target.value}})})]})]}),u==="stats"&&m.jsxs("div",{children:[m.jsxs("div",{style:{marginBottom:"15px",padding:"10px",background:"rgba(255,200,0,0.1)",borderLeft:"3px solid gold",fontSize:"0.8rem"},children:[" ",m.jsx("b",{children:"Regra:"})," O nvel de ",m.jsx("b",{children:"Habitao"})," no pode exceder o nvel de ",m.jsx("b",{children:"Tamanho"}),"."]}),m.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:X.map(Y=>{const M=Y==="resources_level",E=l.stats[Y];return m.jsxs("div",{className:"stat-box",style:{background:"rgba(255,255,255,0.03)",padding:"15px",borderRadius:"6px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px",alignItems:"center"},children:[m.jsx("label",{className:"input-label",style:{color:"var(--cor-tema)",margin:0,fontSize:"1rem"},children:bN[Y]}),m.jsx("span",{style:{fontWeight:"bold",fontSize:"1.2rem",background:"#000",padding:"2px 10px",borderRadius:"4px"},children:E})]}),m.jsx("input",{type:"range",min:"0",max:"6",step:"1",className:"tech-range",value:E,onChange:O=>G(Y,Number(O.target.value))}),M?m.jsxs("div",{style:{marginTop:"15px",background:"rgba(0,0,0,0.2)",padding:"10px",borderRadius:"4px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",fontSize:"0.8rem",color:"#aaa"},children:[m.jsx("span",{children:"Recursos em Abundncia"}),m.jsxs("span",{style:{color:l.details.resource_types_found.length>E?"#ff6666":"#88ff88"},children:[l.details.resource_types_found.length," / ",E===0?"Escasso":E," slots ocupados"]})]}),m.jsxs("div",{className:"im-toolbar",style:{padding:"0",background:"transparent",marginBottom:"10px"},children:[m.jsx("input",{className:"input-dark-sheet",placeholder:"Adicionar recurso (Ex: Sucata Tecnolgica)...",value:p,onChange:O=>y(O.target.value),onKeyDown:O=>O.key==="Enter"&&w()}),m.jsx("button",{className:"btn-action-primary",onClick:w,disabled:E===0||l.details.resource_types_found.length>=E,children:"+"})]}),m.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[l.details.resource_types_found.map((O,P)=>m.jsxs("span",{style:{padding:"5px 10px",background:"rgba(255,255,255,0.1)",borderRadius:"4px",display:"flex",alignItems:"center",gap:"8px",fontSize:"0.9rem"},children:[O,m.jsx("span",{style:{cursor:"pointer",color:"#ff6666",fontWeight:"bold"},onClick:()=>V(P),children:""})]},P)),l.details.resource_types_found.length===0&&m.jsx("span",{style:{color:"#666",fontSize:"0.8rem",fontStyle:"italic"},children:"Nenhum recurso definido."})]})]}):m.jsx("textarea",{className:"input-dark-sheet",rows:2,placeholder:`Descreva narrativamente o motivo do ${bN[Y]} ser ${E}...`,value:l.descriptions[Y],onChange:O=>B(Y,O.target.value),style:{marginTop:"10px",fontSize:"0.9rem"}})]},Y)})})]}),u==="marcos"&&m.jsxs("div",{children:[m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"NOVO MARCO"}),m.jsxs("div",{className:"wm-landmark-grid landmark-input-group",style:{padding:0},children:[m.jsx("input",{className:"input-dark-sheet",placeholder:"Nome (Ex: A Torre)",value:A.name,onChange:Y=>f({...A,name:Y.target.value})}),m.jsx("input",{className:"input-dark-sheet",placeholder:"Descrio...",value:A.description,onChange:Y=>f({...A,description:Y.target.value})}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[m.jsx("span",{style:{fontSize:"0.6rem",color:"#aaa",marginBottom:"2px"},children:"VISVEL?"}),m.jsxs("label",{className:"tech-switch",children:[m.jsx("input",{type:"checkbox",checked:A.is_visible,onChange:Y=>f({...A,is_visible:Y.target.checked})}),m.jsx("span",{className:"tech-slider"})]})]}),m.jsx("button",{className:"btn-action-primary",onClick:S,children:"+"})]})]}),m.jsx("hr",{style:{borderColor:"rgba(255,255,255,0.1)",margin:"20px 0"}}),m.jsx("label",{className:"input-label",children:"MARCOS EXISTENTES"}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px"},children:[m.jsxs("div",{className:"wm-landmark-grid",style:{color:"#888",textTransform:"uppercase",fontWeight:"bold",fontSize:"0.7rem"},children:[m.jsx("span",{children:"Nome"}),m.jsx("span",{children:"Descrio"}),m.jsx("span",{style:{textAlign:"center"},children:"Visvel"}),m.jsx("span",{})]}),l.details.landmarks.map((Y,M)=>m.jsxs("div",{className:"wm-landmark-item",children:[m.jsx("div",{style:{fontWeight:"bold",color:"#ffd700"},children:Y.name}),m.jsx("div",{style:{color:"#ccc",fontSize:"0.9rem"},children:Y.description}),m.jsx("div",{style:{display:"flex",justifyContent:"center"},children:m.jsxs("label",{className:"tech-switch",children:[m.jsx("input",{type:"checkbox",checked:Y.is_visible!==!1,onChange:()=>N(M)}),m.jsx("span",{className:"tech-slider"})]})}),m.jsx("button",{className:"btn-icon danger",onClick:()=>R(M),children:""})]},M)),l.details.landmarks.length===0&&m.jsx("div",{className:"empty-state-mini",children:"Nenhum marco geogrfico adicionado."})]})]})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"CANCELAR"}),m.jsx("button",{className:"btn-primary-action",onClick:H,children:"SALVAR REGIO"})]})]})})},yN={mobility:"Mobilidade",defense:"Defesa",morale:"Moral",belligerence:"Beligerncia"},TP=({isOpen:a,onClose:e,onSave:t,library:n,initialData:i})=>{const s={population:{current:0,max:0},reserves:{current:0,max:0},mobility:0,defense:0,morale:0,belligerence:0},o={population:"",reserves:"",mobility:"",defense:"",morale:"",belligerence:"",general:""},[l,c]=J.useState({library_id:n.id,name:"",type:"community",archetype:"",stats:s,descriptions:o,assets:{constructions:[],stock:{}}}),[u,h]=J.useState("geral"),[A,f]=J.useState({name:"",notes:""}),[p,y]=J.useState({name:"",quantity:1}),G=n.settings.archetypes?.filter(Y=>Y.type===l.type)||[];if(J.useEffect(()=>{a&&(c(i?JSON.parse(JSON.stringify(i)):{library_id:n.id,name:"",type:"community",archetype:"",stats:s,descriptions:o,assets:{constructions:[],stock:{}}}),h("geral"))},[a,i,n]),!a)return null;const B=(Y,M)=>{c({...l,stats:{...l.stats,[Y]:M}})},S=(Y,M,E)=>{c({...l,stats:{...l.stats,[Y]:{...l.stats[Y],[M]:E}}})},N=(Y,M)=>{c({...l,descriptions:{...l.descriptions,[Y]:M}})},R=()=>{A.name&&(c({...l,assets:{...l.assets,constructions:[...l.assets.constructions,A]}}),f({name:"",notes:""}))},w=Y=>{const M=[...l.assets.constructions];M.splice(Y,1),c({...l,assets:{...l.assets,constructions:M}})},V=()=>{p.name&&(c({...l,assets:{...l.assets,stock:{...l.assets.stock,[p.name]:p.quantity}}}),y({name:"",quantity:1}))},H=Y=>{const M={...l.assets.stock};delete M[Y],c({...l,assets:{...l.assets,stock:M}})},X=()=>{if(!l.name)return alert("O refgio precisa de um nome.");t(l)};return m.jsx("div",{className:"modal-overlay",style:{zIndex:2200},children:m.jsxs("div",{className:"modal-box",style:{maxWidth:"800px",height:"85vh",display:"flex",flexDirection:"column"},children:[m.jsxs("div",{className:"modal-header-row",children:[m.jsx("h3",{className:"modal-title",children:i?"EDITAR REFGIO":"NOVO REFGIO"}),m.jsxs("div",{className:"wm-tabs",style:{marginBottom:0,borderBottom:"none"},children:[m.jsx("button",{className:`wm-tab ${u==="geral"?"active":""}`,onClick:()=>h("geral"),children:"GERAL"}),m.jsx("button",{className:`wm-tab ${u==="stats"?"active":""}`,onClick:()=>h("stats"),children:"ESTATSTICAS"}),m.jsx("button",{className:`wm-tab ${u==="ativos"?"active":""}`,onClick:()=>h("ativos"),children:"ATIVOS"})]})]}),m.jsxs("div",{className:"modal-body-scroll",style:{flex:1,overflowY:"auto",padding:"20px"},children:[u==="geral"&&m.jsxs("div",{className:"wm-grid-2col",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"NOME DO REFGIO"}),m.jsx("input",{className:"input-dark-sheet",value:l.name,onChange:Y=>c({...l,name:Y.target.value}),autoFocus:!0})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"TIPO"}),m.jsxs("div",{style:{display:"flex",gap:"10px"},children:[m.jsx("button",{className:"btn-action-primary",style:{flex:1,opacity:l.type==="community"?1:.4},onClick:()=>c({...l,type:"community"}),children:" COMUNIDADE"}),m.jsx("button",{className:"btn-action-primary",style:{flex:1,opacity:l.type==="group"?1:.4},onClick:()=>c({...l,type:"group"}),children:" GRUPO MVEL"})]})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"ARQUTIPO"}),m.jsxs("select",{className:"input-dark-sheet",value:l.archetype,onChange:Y=>c({...l,archetype:Y.target.value}),children:[m.jsx("option",{value:"",children:"Selecione..."}),G.map((Y,M)=>m.jsx("option",{value:Y.name,children:Y.name},M))]}),m.jsx("div",{style:{fontSize:"0.85rem",color:"#ccc",marginTop:"10px",lineHeight:"1.5",textAlign:"justify",textIndent:"2em",background:"rgba(0,0,0,0.2)",padding:"15px",borderRadius:"4px",borderLeft:"2px solid var(--cor-tema)"},children:n.settings.archetypes.find(Y=>Y.name===l.archetype)?.description||"Selecione um arqutipo para ver a descrio."})]})]}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"DESCRIO GERAL / VISUAL"}),m.jsx("textarea",{className:"input-dark-sheet",style:{height:"100%"},value:l.descriptions.general,onChange:Y=>N("general",Y.target.value),placeholder:"Como este grupo ou lugar se parece? Cheiros, sons, aparncia..."})]})]}),u==="stats"&&m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:[["population","reserves"].map(Y=>{const M=Y,E=Y==="population"?"Populao":"Reservas",O=l.stats[M];return m.jsxs("div",{className:"stat-box",style:{background:"rgba(255,255,255,0.03)",padding:"15px",borderRadius:"6px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",alignItems:"center"},children:[m.jsx("label",{className:"input-label",style:{color:"var(--cor-tema)",margin:0,fontSize:"1rem"},children:E.toUpperCase()}),m.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center",fontSize:"0.9rem"},children:[m.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"5px"},children:[m.jsx("span",{children:"Atual:"}),m.jsx("input",{type:"number",className:"input-dark-sheet",style:{width:"60px",textAlign:"center",padding:"2px",background:"rgba(0,0,0,0.3)"},value:O.current,onChange:P=>S(M,"current",Number(P.target.value))})]}),m.jsxs("span",{children:["Mx: ",m.jsx("b",{children:O.max})]})]})]}),m.jsx("input",{type:"range",min:"0",max:"6",step:"1",className:"tech-range",value:O.max,onChange:P=>S(M,"max",Number(P.target.value))}),m.jsx("textarea",{className:"input-dark-sheet",rows:2,placeholder:`Detalhes sobre ${E.toLowerCase()}...`,value:l.descriptions[Y],onChange:P=>N(Y,P.target.value),style:{marginTop:"10px",fontSize:"0.9rem"}})]},Y)}),["mobility","defense","morale","belligerence"].map(Y=>{const M=l.stats[Y];return m.jsxs("div",{className:"stat-box",style:{background:"rgba(255,255,255,0.03)",padding:"15px",borderRadius:"6px"},children:[m.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"5px",alignItems:"center"},children:[m.jsx("label",{className:"input-label",style:{color:"var(--cor-tema)",margin:0,fontSize:"1rem"},children:yN[Y].toUpperCase()}),m.jsx("span",{style:{fontWeight:"bold",fontSize:"1.2rem",background:"#000",padding:"2px 10px",borderRadius:"4px"},children:M})]}),m.jsx("input",{type:"range",min:"0",max:"6",step:"1",className:"tech-range",value:M,onChange:E=>B(Y,Number(E.target.value))}),m.jsx("textarea",{className:"input-dark-sheet",rows:2,placeholder:`Descreva o nvel de ${yN[Y].toLowerCase()}...`,value:l.descriptions[Y],onChange:E=>N(Y,E.target.value),style:{marginTop:"10px",fontSize:"0.9rem"}})]},Y)})]}),u==="ativos"&&m.jsxs("div",{children:[m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"CONSTRUES / PROJETOS"}),m.jsxs("div",{className:"wm-landmark-grid landmark-input-group",style:{gridTemplateColumns:"1fr 2fr 40px",padding:0},children:[m.jsxs("select",{className:"input-dark-sheet",value:A.name,onChange:Y=>f({...A,name:Y.target.value}),children:[m.jsx("option",{value:"",children:"Selecione..."}),n.settings.constructions.map((Y,M)=>m.jsx("option",{value:Y.name,children:Y.name},M)),m.jsx("option",{value:"Personalizado",children:"Personalizado..."})]}),A.name==="Personalizado"?m.jsx("input",{className:"input-dark-sheet",placeholder:"Nome da construo...",onChange:Y=>f({...A,name:Y.target.value})}):m.jsx("input",{className:"input-dark-sheet",placeholder:"Notas (opcional)...",value:A.notes,onChange:Y=>f({...A,notes:Y.target.value})}),m.jsx("button",{className:"btn-action-primary",onClick:R,children:"+"})]}),m.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"5px",marginTop:"10px"},children:[m.jsxs("div",{className:"wm-landmark-grid",style:{color:"#888",fontSize:"0.7rem",fontWeight:"bold",gridTemplateColumns:"1fr 2fr 40px"},children:[m.jsx("span",{children:"Nome"}),m.jsx("span",{children:"Detalhes / Efeito"}),m.jsx("span",{})]}),l.assets.constructions.map((Y,M)=>{const E=n.settings.constructions.find(O=>O.name===Y.name);return m.jsxs("div",{className:"wm-landmark-item",style:{gridTemplateColumns:"1fr 2fr 40px"},children:[m.jsx("div",{style:{fontWeight:"bold",color:"#ffd700"},children:Y.name}),m.jsxs("div",{style:{fontSize:"0.85rem",color:"#ccc"},children:[E?m.jsxs("span",{style:{fontStyle:"italic",color:"#aaa"},children:[E.effect," "]}):"",Y.notes&&m.jsxs("span",{children:[" ",Y.notes]})]}),m.jsx("button",{className:"btn-icon danger",onClick:()=>w(M),style:{justifySelf:"end"},children:""})]},M)}),l.assets.constructions.length===0&&m.jsx("div",{className:"empty-state-mini",children:"Nenhuma construo listada."})]})]}),m.jsx("hr",{style:{borderColor:"rgba(255,255,255,0.1)",margin:"20px 0"}}),m.jsxs("div",{className:"mb-2",children:[m.jsx("label",{className:"input-label",children:"ESTOQUE / RECURSOS"}),m.jsxs("div",{className:"wm-landmark-grid landmark-input-group",style:{gridTemplateColumns:"2fr 1fr 40px",padding:0},children:[m.jsx("input",{className:"input-dark-sheet",placeholder:"Item (Ex: gua, Munio)...",value:p.name,onChange:Y=>y({...p,name:Y.target.value})}),m.jsx("input",{type:"number",className:"input-dark-sheet",placeholder:"Qtd",value:p.quantity,onChange:Y=>y({...p,quantity:Number(Y.target.value)})}),m.jsx("button",{className:"btn-action-primary",onClick:V,children:"+"})]}),m.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:"10px",marginTop:"10px"},children:[Object.entries(l.assets.stock).map(([Y,M])=>m.jsxs("div",{style:{background:"rgba(255,255,255,0.05)",padding:"5px 10px",borderRadius:"4px",display:"flex",alignItems:"center",gap:"10px",border:"1px solid rgba(255,255,255,0.1)"},children:[m.jsxs("span",{children:[Y,": ",m.jsx("b",{children:M})]}),m.jsx("button",{className:"btn-icon danger",onClick:()=>H(Y),style:{padding:"0 5px"},children:""})]},Y)),Object.keys(l.assets.stock).length===0&&m.jsx("div",{className:"empty-state-mini",style:{width:"100%"},children:"Estoque vazio."})]})]})]})]}),m.jsxs("div",{className:"modal-actions",children:[m.jsx("button",{className:"btn-secondary-action",onClick:e,children:"CANCELAR"}),m.jsx("button",{className:"btn-primary-action",onClick:X,children:"SALVAR REFGIO"})]})]})})},zP=({isOpen:a,onClose:e,onClone:t})=>{const[n,i]=J.useState([]),[s,o]=J.useState([]),[l,c]=J.useState(!1),[u,h]=J.useState(null);J.useEffect(()=>{a&&A()},[a]);const A=async()=>{c(!0);try{const[y,G]=await Promise.all([zs.getPublicLibraries(),zs.getMyFavorites()]);i(y),o(G.map(B=>B.id))}catch(y){console.error("Erro ao carregar dados",y)}finally{c(!1)}},f=async y=>{if(confirm(`Importar "${y.name}"? Isso criar uma cpia editvel nos seus mundos.`)){h(y.id);try{await zs.cloneLibrary(y.id),alert("Mundo importado com sucesso!"),t(),e()}catch(G){console.error(G),alert("Erro ao importar.")}finally{h(null)}}},p=async y=>{try{const G=await zs.toggleFavorite(y.id);o(G?[...s,y.id]:s.filter(B=>B!==y.id)),t()}catch(G){console.error(G)}};return a?m.jsx("div",{className:"modal-overlay",style:{zIndex:2200},children:m.jsxs("div",{className:"modal-box large-modal",style:{maxWidth:"900px",height:"80vh",display:"flex",flexDirection:"column"},children:[m.jsxs("div",{className:"modal-header-row",children:[m.jsx("h3",{className:"modal-title",children:"COMUNIDADE DE MUNDOS"}),m.jsx("button",{className:"btn-close-x",onClick:e,style:{fontSize:"1.5rem",background:"none",border:"none",color:"#fff",cursor:"pointer"},children:""})]}),m.jsxs("div",{className:"community-list-scroll",style:{flex:1,overflowY:"auto",padding:"10px"},children:[l&&m.jsx("div",{className:"loading-text",children:"Carregando universos..."}),!l&&m.jsx("div",{className:"bib-card-grid",children:n.map(y=>{const G=s.includes(y.id);return m.jsxs("div",{className:`bib-card ${y.is_official?"official":""}`,style:{minHeight:"auto"},children:[m.jsxs("div",{className:"bib-card-header",children:[m.jsx("span",{className:"bib-card-title",children:y.name}),(y.is_public||y.is_official)&&m.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[y.is_public&&m.jsx("span",{className:"badge-public",children:"PBLICO"}),y.is_official&&m.jsx("span",{className:"badge-official",children:"SISTEMA"})]}),m.jsxs("span",{className:"bib-car-author",children:["Criado por: ",y.profiles?.username||"Desconhecido"]})]}),m.jsx("div",{className:"bib-card-body",style:{fontSize:"0.85rem",marginBottom:"15px"},children:y.description||"Sem descrio."}),m.jsxs("div",{className:"bib-card-footer",style:{paddingTop:"10px",gap:"10px"},children:[m.jsx("button",{className:"bib-btn-explore",onClick:()=>p(y),title:G?"Remover dos favoritos":"Adicionar aos favoritos",style:{flex:1,height:"32px",padding:0,"--cor-tema":G?"gold":"#888","--cor-tema-rgb":G?"255, 215, 0":"136, 136, 136","--cor-tema-glow":G?"gold":"rgba(136,136,136,0.5)",borderColor:G?"gold":"#444"},children:m.jsx("span",{style:{fontSize:"1.2rem",lineHeight:0},children:G?"":""})}),m.jsx("button",{className:"bib-btn-action",style:{flex:3,fontSize:"0.75rem"},onClick:()=>f(y),disabled:u===y.id,children:u===y.id?"...":"ASSIMILAR"})]})]},y.id)})}),!l&&n.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhum mundo pblico encontrado."})]})]})}):null};function LP(){const[a,e]=J.useState("list"),[t,n]=J.useState([]),[i,s]=J.useState([]),[o,l]=J.useState(null),[c,u]=J.useState("regions"),[h,A]=J.useState([]),[f,p]=J.useState([]),[y,G]=J.useState(!1),[B,S]=J.useState(!1),[N,R]=J.useState(null),[w,V]=J.useState(!1),[H,X]=J.useState(null),[Y,M]=J.useState(!1),[E,O]=J.useState(null),P=o?t.some(D=>D.id===o.id):!1;J.useEffect(()=>{a==="list"&&q()},[a]),J.useEffect(()=>{a==="details"&&o&&(c==="regions"&&k(),c==="refuges"&&le())},[a,o,c]);const q=async()=>{try{const[D,de]=await Promise.all([zs.getMyLibraries(),zs.getMyFavorites()]),ee=(Ce,we)=>Ce.is_official===we.is_official?0:Ce.is_official?-1:1;n(D.sort(ee)),s(de.sort(ee))}catch(D){console.error(D)}},k=async()=>{if(o)try{const D=await zs.getRegions(o.id);A(D)}catch(D){console.error(D)}},le=async()=>{if(o)try{const D=await zs.getRefuges(o.id);p(D)}catch(D){console.error(D)}},F=async D=>{try{N?await zs.updateLibrary(N.id,D):await zs.createLibrary(D),G(!1),q()}catch{alert("Erro ao salvar mundo.")}},j=async D=>{if(confirm("Tem certeza? Isso apagar todas as regies e refgios deste mundo."))try{await zs.deleteLibrary(D),q()}catch{alert("Erro ao apagar.")}},Q=async D=>{if(o){if(!P){alert("Modo Visualizao: Voc no tem permisso para alterar as configuraes deste mundo.");return}try{await zs.updateLibrarySettings(o.id,D),l({...o,settings:D})}catch{alert("Erro ao salvar configuraes.")}}},ce=async D=>{try{await zs.saveRegion(D),V(!1),k()}catch(de){console.error(de),alert("Erro ao salvar regio.")}},oe=async D=>{if(confirm("Apagar regio?"))try{await zs.deleteRegion(D),k()}catch{alert("Erro ao apagar.")}},T=async D=>{try{await zs.saveRefuge(D),M(!1),le()}catch(de){console.error(de),alert("Erro ao salvar refgio.")}},$=async D=>{if(confirm("Apagar refgio?"))try{await zs.deleteRefuge(D),le()}catch{alert("Erro ao apagar.")}},ae=(D,de)=>m.jsxs("div",{className:`bib-card ${D.is_official?"official":""}`,children:[m.jsxs("div",{className:"bib-card-header",children:[m.jsx("span",{className:"bib-card-title",children:D.name}),(D.is_public||D.is_official)&&m.jsxs("div",{style:{display:"flex",flexWrap:"wrap"},children:[D.is_public&&m.jsx("span",{className:"bib-badge-public",children:"PBLICO"}),D.is_official&&m.jsx("span",{className:"bib-badge-official",children:"SISTEMA"})]})]}),m.jsx("div",{className:"bib-card-body",children:D.description||"Sem descrio."}),m.jsxs("div",{className:"bib-card-footer",children:[m.jsx("button",{className:"btn-open-lib",onClick:()=>{l(D),e("details"),u("regions")},children:"ABRIR"}),de&&m.jsxs("div",{className:"bib-card-actions",children:[m.jsx("button",{className:"btn-icon",onClick:()=>{R(D),G(!0)},children:""}),!D.is_official&&m.jsx("button",{className:"btn-icon danger",onClick:()=>j(D.id),children:""})]})]})]},D.id),Ie=D=>{const de=D.details.resource_types_found.length>0?D.details.resource_types_found.join(", "):"Nenhum recurso.",ee=D.details.landmarks.length>0?D.details.landmarks.map(Ce=>`${Ce.name}${Ce.is_visible===!1?" (inv)":""}`).join(", "):"Nenhum marco.";return m.jsxs("div",{className:"wm-stat-card",children:[m.jsxs("div",{className:"stat-card-header",children:[m.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[m.jsx("span",{style:{fontWeight:"bold",fontSize:"1.1rem"},children:D.name}),m.jsxs("span",{style:{opacity:.7,fontSize:"0.8em",fontWeight:"normal"},children:["(BIOMA: ",D.biome,")"]})]}),P&&m.jsxs("div",{className:"bib-card-mini-actions",children:[m.jsx("button",{className:"btn-mini-action",onClick:()=>{X(D),V(!0)},style:{margin:0},children:""}),m.jsx("button",{className:"btn-mini-action danger",onClick:()=>oe(D.id),style:{margin:0},children:""})]})]}),m.jsxs("div",{className:"stat-row-grid cols-3",children:[m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Tamanho"}),m.jsx("span",{className:"stat-value",children:D.stats.size})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Perigo"}),m.jsx("span",{className:"stat-value",style:{color:"#ff6666"},children:D.stats.danger})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Habitao"}),m.jsx("span",{className:"stat-value",children:D.stats.habitation})]})]}),m.jsxs("div",{className:"stat-section-wide",children:[m.jsxs("div",{className:"stat-header-inline",children:[m.jsx("span",{className:"stat-label",style:{color:"#fff",marginBottom:0},children:"Recursos"}),m.jsx("span",{className:"stat-value",style:{fontSize:"1.2rem"},children:D.stats.resources_level})]}),m.jsx("span",{className:"stat-resources-text",children:de})]}),m.jsxs("div",{className:"stat-row-grid cols-2",children:[m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Contaminao"}),m.jsx("span",{className:"stat-value",style:{color:"#adff2f"},children:D.stats.contamination})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Deslocamento"}),m.jsx("span",{className:"stat-value",children:D.stats.displacement})]})]}),m.jsxs("div",{className:"stat-footer",children:[m.jsx("b",{style:{color:"#fff",fontSize:"0.75rem"},children:"Marcos:"})," ",ee]})]},D.id)},be=D=>{const de=D.type==="community"?"":"",ee=D.assets.constructions.length>0?D.assets.constructions.map(Ce=>Ce.name).join(", "):"Nenhuma.";return m.jsxs("div",{className:"wm-stat-card",children:[m.jsxs("div",{className:"stat-card-header",children:[m.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column"},children:[m.jsxs("span",{style:{fontWeight:"bold",fontSize:"1.1rem"},children:[de," ",D.name]}),m.jsxs("span",{style:{opacity:.7,fontSize:"0.8em",fontWeight:"normal"},children:["(",D.archetype,")"]})]}),P&&m.jsxs("div",{className:"bib-card-mini-actions",children:[m.jsx("button",{className:"btn-mini-action",onClick:()=>{O(D),M(!0)},style:{margin:0},children:""}),m.jsx("button",{className:"btn-mini-action danger",onClick:()=>$(D.id),style:{margin:0},children:""})]})]}),m.jsxs("div",{className:"stat-row-grid cols-2",children:[m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Populao"}),m.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"3px"},children:[m.jsx("span",{className:"stat-value",children:D.stats.population.current}),m.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:["/ ",D.stats.population.max]})]})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Reservas"}),m.jsxs("div",{style:{display:"flex",alignItems:"baseline",gap:"3px"},children:[m.jsx("span",{className:"stat-value",style:{color:"#88ff88"},children:D.stats.reserves.current}),m.jsxs("span",{style:{fontSize:"0.8rem",color:"#888"},children:["/ ",D.stats.reserves.max]})]})]})]}),m.jsxs("div",{className:"stat-row-grid",style:{gridTemplateColumns:"1fr 1fr 1fr 1fr"},children:[m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Mob."}),m.jsx("span",{className:"stat-value",style:{fontSize:"1rem"},children:D.stats.mobility})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Def."}),m.jsx("span",{className:"stat-value",style:{fontSize:"1rem"},children:D.stats.defense})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Moral"}),m.jsx("span",{className:"stat-value",style:{fontSize:"1rem"},children:D.stats.morale})]}),m.jsxs("div",{className:"stat-cell",children:[m.jsx("span",{className:"stat-label",children:"Belig."}),m.jsx("span",{className:"stat-value",style:{fontSize:"1rem"},children:D.stats.belligerence})]})]}),m.jsxs("div",{className:"stat-footer",children:[m.jsx("b",{style:{color:"#fff",fontSize:"0.75rem"},children:"Construes:"})," ",ee]})]},D.id)};return m.jsxs("div",{className:"wm-container",children:[m.jsxs("div",{className:"wm-header",children:[m.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[m.jsx("h1",{className:"chars-title",children:"Assimilador de Mundos"}),a==="details"&&o&&m.jsxs("div",{className:"wm-breadcrumbs",children:[m.jsx("button",{className:"btn-back-text",onClick:()=>e("list"),children:" VOLTAR"}),m.jsx("span",{style:{margin:"0 5px"},children:" / "}),m.jsx("span",{className:"wm-current-lib",children:o.name})]})]}),m.jsx("div",{className:"wm-actions-top",children:a==="list"&&m.jsxs(m.Fragment,{children:[m.jsx("button",{className:"bib-btn-explore",onClick:()=>S(!0),children:"EXPLORAR COMUNIDADE"}),m.jsx("button",{className:"bib-btn-action",onClick:()=>{R(null),G(!0)},children:"+ NOVO"})]})})]}),a==="list"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"im-section",style:{marginBottom:"40px"},children:[m.jsx("h3",{className:"im-section-title",style:{color:"#888",fontSize:"0.9rem",fontWeight:700,letterSpacing:"1.5px",marginBottom:"15px",textTransform:"uppercase",borderLeft:"3px solid var(--cor-tema)",paddingLeft:"10px"},children:"MEUS MUNDOS"}),m.jsxs("div",{className:"bib-card-grid",children:[t.map(D=>ae(D,!0)),t.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhum mundo criado."})]})]}),m.jsxs("div",{className:"im-section",children:[m.jsx("h3",{className:"im-section-title",style:{color:"#888",fontSize:"0.9rem",fontWeight:700,letterSpacing:"1.5px",marginBottom:"15px",textTransform:"uppercase",borderLeft:"3px solid gold",paddingLeft:"10px"},children:"MUNDOS FAVORITOS"}),m.jsxs("div",{className:"bib-card-grid",children:[i.map(D=>ae(D,!1)),i.length===0&&m.jsx("div",{className:"empty-state-mini",children:"Nenhum mundo favorito."})]})]})]}),a==="details"&&o&&m.jsxs("div",{children:[m.jsxs("div",{className:"wm-tabs",children:[m.jsx("button",{className:`wm-tab ${c==="regions"?"active":""}`,onClick:()=>u("regions"),children:"REGIES"}),m.jsx("button",{className:`wm-tab ${c==="refuges"?"active":""}`,onClick:()=>u("refuges"),children:"REFGIOS"}),m.jsx("button",{className:`wm-tab ${c==="settings"?"active":""}`,onClick:()=>u("settings"),children:"CONFIGURAES"})]}),c==="regions"&&m.jsxs("div",{children:[m.jsxs("div",{className:"wm-toolbar",children:[m.jsxs("span",{children:[h.length," Regies cadastradas"]}),P&&m.jsx("button",{className:"bib-btn-action",onClick:()=>{X(null),V(!0)},children:"+ NOVA REGIO"})]}),m.jsxs("div",{className:"bib-card-grid",children:[h.map(D=>Ie(D)),h.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhuma regio criada."})]})]}),c==="refuges"&&m.jsxs("div",{children:[m.jsxs("div",{className:"wm-toolbar",children:[m.jsxs("span",{children:[f.length," Refgios cadastrados"]}),P&&m.jsx("button",{className:"bib-btn-action",onClick:()=>{O(null),M(!0)},children:"+ NOVO REFGIO"})]}),m.jsxs("div",{className:"bib-card-grid",children:[f.map(D=>be(D)),f.length===0&&m.jsx("div",{className:"empty-state",children:"Nenhum refgio cadastrado."})]})]}),c==="settings"&&m.jsx(FP,{library:o,onUpdateSettings:Q,readOnly:!P})]}),m.jsx(EP,{isOpen:y,onClose:()=>G(!1),onSave:F,initialData:N}),o&&m.jsx(KP,{isOpen:w,onClose:()=>V(!1),onSave:ce,library:o,initialData:H}),o&&m.jsx(TP,{isOpen:Y,onClose:()=>M(!1),onSave:T,library:o,initialData:E}),m.jsx(zP,{isOpen:B,onClose:()=>S(!1),onClone:q})]})}const kP=OX([{path:"/",element:m.jsx(FE,{}),errorElement:m.jsx(KE,{})},{path:"/login",element:m.jsx(kE,{})},{path:"/dashboard",element:m.jsx(OE,{}),children:[{index:!0,element:m.jsx(jE,{})},{path:"infectados",element:m.jsx(JE,{})},{path:"criador-de-infectado/:id?",element:m.jsx(PE,{})},{path:"ficha-interativa/:id",element:m.jsx(NP,{})},{path:"gestao-de-ameacas",element:m.jsx(WP,{})},{path:"gestao-de-itens",element:m.jsx(HP,{})},{path:"gestao-de-mundo",element:m.jsx(LP,{})}]}]);M5.createRoot(document.getElementById("root")).render(m.jsx(xg.StrictMode,{children:m.jsx(UE,{children:m.jsx(sY,{router:kP})})}));
